/*! duel v2.5.8 - Built 2016-01-14, 12:02 PM PST - Copyright (c) 2016 */
define("starfield/sf.session",["i18n!starfield/sf.i18n/duel","css!starfield/sf.core.css","starfield/sf.dialog","jq!starfield/jquery.mod","css!starfield/sf.session.css","domReady!"],function(a){return function(b){var c={commands:["destroy","timeout","close","reset"],properties:["getTimeLeft"],valueDiv:null,timer:null,pageTitle:"",options:{txt:a["sf.session"],duration:0,warningDuration:60,startTime:void 0,onKeepAlive:void 0,onWarning:void 0,onLogout:void 0},_create:function(){b.isFunction(this.options.onKeepAlive)&&b.isFunction(this.options.onLogout)||alert("Session Timeout requires onKeepAlive and onLogout callbacks"),"number"!=typeof this.options.startTime&&(this.options.startTime=(new Date).getTime()),this.valueDiv=b('<span class="sf-time-value">10</span>');var a=b('<span class="sf-time-label"/>').html(this.options.txt.timeLeft),c=b('<div class="sf-time-visual"/>').append(this.valueDiv).append(a),d=b('<div class="sf-time-copy"/>').html(this.options.txt.message);this.timeDiv=b('<div class="sf-time"/>').append(c).append(d),this.isOpen=!1;var e=this;document.body.appendChild(this.element[0]),this.element.empty().append(this.timeDiv).sfDialog({autoOpen:!1,title:this.options.txt.title,cancelDisabled:!0,closeOnEscape:!1,buttons:[{text:this.options.txt.keepAlive,onClick:function(){e.onKeepAlive()}},{text:this.options.txt.logout,cancel:!0,onClick:function(){e.onLogout()}}]}),this.pageTitle=b("head > title").html(),this.timer=setInterval(function(){e.tickTock()},1e3)},getTimeLeft:function(a){"number"!=typeof a&&(a=(new Date).getTime());var b=this.options.duration;if(0===b&&(b=this.options.warningDuration,this.isVisible()===!1))return b;var c=parseInt(Math.ceil(b-(a-this.options.startTime)/1e3));return c>0?c:0},isVisible:function(){return this.isOpen},tickTock:function(){var a=this.isVisible(),b=(new Date).getTime(),c=this.getTimeLeft(b);if(0>=c)return void this.onLogout();var d=!a&&this.options.duration>0&&c<=this.options.warningDuration;if((d||a)&&this.valueDiv){c%2==0?this.updateTitle("..."):this.updateTitle(this.options.txt.attention),10>=c?this.timeDiv.addClass("sf-time-alert"):this.timeDiv.removeClass("sf-time-alert");var e=c.toString();e.length>3&&(e="999+"),this.valueDiv.text(e)}d&&this.timeout()},timeout:function(){return 0===this.options.duration&&this.reset(),1==b.isFunction(this.options.onWarning)&&this.options.onWarning(this.element)===!1?void this.reset():(this.isOpen=!0,void this.element.sfDialog("open"))},close:function(){this.isOpen=!1,this.element.sfDialog("close"),this.updateTitle()},reset:function(){this.options.startTime=(new Date).getTime(),this.tickTock()},updateTitle:function(a){"string"!=typeof a&&(a=this.pageTitle),document.title=a},destroy:function(a){this.close(),this.timer&&(clearInterval(this.timer),this.timer=null),this.valueDiv=null,this.timeDiv=null;try{this.element.sfDialog("destroy")}catch(b){}this.element.empty(),this._execSuper("destroy",a)},onKeepAlive:function(){this.reset(),b.isFunction(this.options.onKeepAlive)&&this.options.onKeepAlive(this),this.close()},onLogout:function(){b.isFunction(this.options.onLogout)&&this.options.onLogout(this),this.destroy()}};return $sf.util.module("Session",c)}($sf.getjQuery())});