define(["knockout","jquery","wsbcore","common/regexhelper/regexhelper","common/stats/googleanalytics","/i18n/resources/client","common/util/documentHelper","common/api/api.guid","libs/jquery/plugins/jquery.watermark/jquery.watermark","wsbcore/tipper","wsbcore/colorpicker","wsbcore/droplist","libs/jquery/jquery.throttle","libs/knockout/ko.observables"],function(e,t,n,r,i,a,o,s){function l(t){var n=t(),r={},i=n;return e.isObservable(i)||(r=e.utils.unwrapObservable(n.options)||{},i=n.value),{options:r,value:i}}function u(e){try{if("undefined"!=typeof window.getSelection&&"undefined"!=typeof document.createRange){var t=document.createRange();t.selectNodeContents(e),t.collapse(!1);var n=window.getSelection();n.removeAllRanges(),n.addRange(t)}else if("undefined"!=typeof document.body.createTextRange){var r=document.body.createTextRange();r.moveToElementText(e),r.collapse(!1),r.select()}}catch(i){}}function d(e){setTimeout(function(){var t,n;window.getSelection&&document.createRange?(n=document.createRange(),n.selectNodeContents(e),t=window.getSelection(),t.removeAllRanges(),t.addRange(n)):document.body.createTextRange&&(n=document.body.createTextRange(),n.moveToElementText(div),n.select())},1)}var c=10;e.bindingHandlers.delegatedEvent={init:function(n,r){var i=r()||{};t.isArray(i)||(i=[i]),e.utils.arrayForEach(i,function(r){var i=t(r.attachTo||n),a=r.event+".knockout";i.on(a,r.selector,function(t){var n=e.contextFor(t.target),i=n&&n.$data,a=e.utils.unwrapObservable(r.thisValue)||i;r.callback.apply(a,[i,t,n])}),e.utils.domNodeDisposal.addDisposeCallback(n,function(){i.off(a,r.selector)})})}},e.bindingHandlers.checkboxList={init:function(){return{controlsDescendantBindings:!0}},update:function(n,r,i,a,o){function s(){var e,t=[],n="0123456789abcdef";for(e=0;10>e;e++)t[e]=n.substr(Math.floor(16*Math.random()),1);var r=t.join("");return r}function l(n,r,i,a,l,u,d){var c="cbl-"+s(),p=t('<input type="checkbox">').attr({id:c,"data-bind":"checked: "+(u||"check")+(d?", attr: { 'data-aid': "+d+" }":"")}),f=t("<label data-bind='text: "+l+"' for='"+c+"'>"),v=t("<td>").append(p).append(f),b=o.createChildContext(i,v[0]);return a&&e.utils.extend(b,{selectedData:a,check:e.computed({read:function(){return a.indexOf(i)>=0},write:function(e){return e?a.push(i):a.remove(i),e}})}),e.applyBindings(b,v[0]),v}var u,d=t(n),c=d.find("input:checked").length,p=e.utils.unwrapObservable(r());if(p){var f,v,b,m,g=e.utils.unwrapObservable(p.data),h=p.selectedData,w=Math.max("number"==typeof p.columns?p.columns:1,1),y=e.utils.unwrapObservable(p.textBinding)||"description",k=e.utils.unwrapObservable(p.checkedBinding)||null,O=g.length,x=Math.ceil(O/w),C=0,T=[],F=[],D=0;if(c!==g.length){for(;d.children().length>0;)u=d.children().first(),e.cleanNode(u[0]),u.remove();for(v=0;w>v;v++)T.push([]);for(f=0,v=0;O>v;v++)C++,T[f].push(l(v,d,g[v],h,y,k,e.utils.unwrapObservable(p.automationIdBinding))),T[f].length>=x&&(T[f].length>D&&(D=T[f].length),f++);for(v=0;D>v;v++)for(F[v]=[],b=0;b<T.length;b++)v<T[b].length&&F[v].push(T[b][v]);for(v=0;v<F.length;v++){for(m=t("<tr>"),b=0;b<F[v].length;b++)m.append(F[v][b]);d.append(m)}e.utils.triggerEvent(n,"change")}}}},e.bindingHandlers.background={update:function(n,r){var i=r(),a=e.utils.unwrapObservable(i.color),o=e.utils.unwrapObservable(i.color2),s=i.gradientType?e.utils.unwrapObservable(i.gradientType):"none",l=e.utils.unwrapObservable(i.direction);"none"===s?(n.style.backgroundImage="",n.style.filter&&(n.style.filter=n.style.filter.replace(/progid:DXImageTransform\.Microsoft\.gradient\(.*?\)/,"")),n.style.backgroundColor=a):(n.style.backgroundColor="",t.browser.msie&&t.browser.version.split(".")[0]<10?n.style.filter=(n.style.filter||"")+"progid:DXImageTransform.Microsoft.gradient(gradientType="+("horizontal"===l?1:0)+", startColorstr='"+a.replace("transparent","#00000000")+"', endColorstr='"+o.replace("transparent","#00000000")+"')":n.style.backgroundImage=t.browser.webkit?"-webkit-linear-gradient("+("horizontal"===l?"left":"top")+", "+a+", "+o+")":"linear-gradient(to "+("horizontal"===l?"right":"bottom")+", "+a+", "+o+")")}},e.bindingHandlers.ellipsizedText={init:function(n,r,i,a,o){var s,u=l(r),d=t("<span/>").appendTo(t(n));o.ellipsizeContext={created:!1},e.utils.domNodeDisposal.addDisposeCallback(n,function(){try{clearTimeout(s),o.ellipsizeContext.created&&d.trigger("destroy")}catch(e){}}),u.value.isTruncated=e.observable(!1),s=setTimeout(function(){d.dotdotdot(u.options),d.text(e.utils.unwrapObservable(u.value)),u.value.isTruncated(d.triggerHandler("isTruncated.dot")),o.ellipsizeContext.created=!0},10)},update:function(n,r){var i=l(r),a=t(n).find("span");a.text(e.utils.unwrapObservable(i.value)),i.value.isTruncated(a.triggerHandler("isTruncated.dot"))}},e.bindingHandlers.tooltip={init:function(n,r){function i(){a();var t,n,r=e.utils.unwrapObservable(s);"object"==typeof r?(t=r.content,n=r.style||"qt"):(t=r,n="qt"),t&&(o.sfTipper({content:t,style:n}),l=!0)}function a(){l&&(o.sfTipper({destroy:!0}),l=!1)}var o=t(n),s=r(),l=!1;e.isObservable(s)&&s.subscribe(i),i(),e.utils.domNodeDisposal.addDisposeCallback(n,function(){try{a()}catch(e){}})}},e.bindingHandlers.cssSizeEditor={init:function(n,r,i){function a(t){function n(t){for(var n=e.utils.unwrapObservable(r.unitTypes),i=0;i<n.length;i++)if(n[i].value===t)return n[i];return{text:"",value:t}}var r=this;this.unitTypes=e.observableArray(e.utils.unwrapObservable(t().units)),this.valueParsed=e.computed(function(){var i=e.utils.unwrapObservable(t().value).match(/^(\d+(?:\.\d+)?)(.*)$/);return{value:i[1],unit:n(i.length>2?i[2]:r.unitTypes[0])}}),this.value=e.computed({read:function(){return r.valueParsed().value},write:function(e){t().value(e+r.valueParsed().unit.value)}}),this.unit=e.computed({read:function(){return r.valueParsed().unit},write:function(e){t().value(r.valueParsed().value+e.value)}})}var o=t(n).attr("class"),s=t(n).attr("style"),l=t("<div data-bind=\"template: 'mutator-template-cssSizeEditor'\"/>").replaceAll(t(n)).attr({"class":o,style:s});e.applyBindings(new a(r,i),l[0])}},e.bindingHandlers.animated={update:function(n,r){var i=r();t(n).animate(e.utils.unwrapObservable(i.properties),e.utils.unwrapObservable(i.duration),e.utils.unwrapObservable(i.easing))}},e.bindingHandlers.slideDown={update:function(n,r){var i=r(),a=e.utils.unwrapObservable(r.duration),o=t(n);e.utils.unwrapObservable(i.visible)?o.slideDown(a):o.slideUp(a)}},e.bindingHandlers.slider={init:function(n,r,i){function a(){function n(){return l.stopDragging(),!1}function a(e){return 27===e.which?(l.stopDragging(),!1):void 0}function s(e){var t=i(),n=e-o.offset().left,r=Math.min(1,Math.max(0,n/o.find(".slider-track").width())),a=d().fromFactor(f()+l.range()*r),s=l.inc();return s&&(a=Math.floor(a/s)*s),t.value(a),!1}var l=this,u=function(e){return e},d=e.computed(function(){var t=e.utils.unwrapObservable(r().scale);switch(t){case"log":return{toFactor:Math.log,fromFactor:Math.exp};case"linear":default:return{toFactor:u,fromFactor:u}}}),p=e.utils.unwrapObservable(r().width);p&&t(o[0]).width(p),this.min=e.computed(function(){return e.utils.unwrapObservable(r().min)}),this.max=e.computed(function(){return e.utils.unwrapObservable(r().max)}),this.inc=e.computed(function(){return e.utils.unwrapObservable(r().inc)}),this.value=e.computed(function(){return e.utils.unwrapObservable(i().value)});var f=e.computed(function(){return d().toFactor(l.min())});this.range=e.computed(function(){return d().toFactor(l.max())-f()}),this.percent=e.computed(function(){return(d().toFactor(l.value())-f())/l.range()}),this.jumpToPosition=function(e,t){return s(t.pageX),!1};var v=t.throttle(c,function(e){return s(e.pageX),!1});this.startDrag=function(){return t(document).on("mousemove",v).on("mouseup",n).on("keypress",a),!1},this.stopDragging=function(){t(document).off("mousemove",v).off("mouseup",n).off("keypress",a)}}var o=t('<div data-bind="template: \'slider\'" class="slider-container"/>').replaceAll(t(n));e.applyBindings(new a(r,i),o[0])}},function(){function r(t,n,r){if(r){var i=t.sfDropList("box").find(".sf-droplist-selectcontent")[0],a=n.createChildContext(e.dataFor(r));e.cleanNode(i),e.applyBindingsToDescendants(a,i)}}e.bindingHandlers.dropList={init:function(i,a,o,s,l){function u(){var i=a(),o={ensureTopZIndex:!0,onValueChanged:function(t,n,i){var o=a();e.utils.unwrapObservable(o.isNumeric)&&(i=parseInt(i,10)),o.value(i),e.isObservable(o.selectedText)&&o.selectedText(n.text()),r(d,l,n[0])}},s=e.utils.unwrapObservable(i.inDialog)===!0;s&&(o.onOpen=function(e){var r=e.parent();if(s){t(".sflayer-dialog").append(r);var i=n.util.zIndex.getLayerForElement(r),a=n.util.zIndex.maxForLayer(i)+1;r.css("z-index",a)}}),i.width&&(o.width=e.utils.unwrapObservable(i.width)),i.listWidth&&(o.listWidth=e.utils.unwrapObservable(i.listWidth)),i.listMaxHeight&&(o.listMaxHeight=e.utils.unwrapObservable(i.listMaxHeight)),i.sfDropList=d.sfDropList(o);var u=i.sfDropList.sfDropList("box");c.tooltip&&(d.unbind("mouseover.sfTipper"),u.sfTipper({content:e.utils.unwrapObservable(c.tooltip),style:"qt"})),i.cssClass&&u.addClass(e.utils.unwrapObservable(i.cssClass)),r(d,l,d.sfDropList("selectedItem")[0]),d.sfDropList("selectItem",d.find('li[data-value="'+e.utils.unwrapObservable(i.value)+'"]')),e.isObservable(i.value)&&i.value.subscribe(function(e){d.sfDropList("selectItem",d.find('li[data-value="'+e+'"]'))}),"isEnabled"in i&&(d.sfDropList(e.utils.unwrapObservable(i.isEnabled)?"enable":"disable"),e.isObservable(i.isEnabled)&&i.isEnabled.subscribe(function(e){d.sfDropList(e?"enable":"disable")}))}var d=t(i),c=o();setTimeout(u,1),e.utils.domNodeDisposal.addDisposeCallback(i,function(){var e=t(i);e.sfDropList("destroy")})}}}(),function(){function r(e){return e&&"none"!==e?e:"transparent"}function i(e){return e&&"transparent"!==e?e:"none"}function a(e,t){e.color(e.allowNull!==!0||t&&"none"!==t?r(t):null)}e.bindingHandlers.colorPicker={init:function(r,o){var s=o(),l=t(r),u=e.utils.unwrapObservable(s.inDialog)===!0,d=s.zIndex?e.utils.unwrapObservable(s.zIndex):void 0,c=!1;l.sfColorPicker({initColor:i(e.utils.unwrapObservable(s.color)),liveUpdates:!0,canBeSetToNone:void 0===s.allowTransparent?!0:e.utils.unwrapObservable(s.allowTransparent),zIndex:d,onOpen:function(e){if(t(".sf-btn-primary").removeClass("sf-btn-primary").addClass("btn").addClass("btn-inverse-grey"),c=!1,u){var r=e.sfColorPicker("getPickerElement").sfFlyout("content"),i=r.parent().parent().parent();t(".sflayer-dialog").append(i);var a=n.util.zIndex.getLayerForElement(i),o=n.util.zIndex.maxForLayer(a)+1;i.css("z-index",o)}},onChange:function(n,r,o,l){if(t(".sf-btn-primary").removeClass("sf-btn-primary"),e.utils.unwrapObservable(s.closeOnSelect||!0)){var u=l.sfColorPicker("getPickerElement").sfFlyout("content").find("td.advanced:visible").length>0;if(!u){if(c)return;return"live"===r&&l.sfColorPicker("getPickerElement").sfFlyout("content").find("input.Hex").val().length>=6&&(c=!0,l.sfColorPicker("changeColor",i(n),"commit"),l.sfColorPicker("close")),a(s,n),void(c=!1)}}else a(s,n)},onPersist:function(e){a(s,e),s.onChange&&s.onChange(e)}}),e.utils.domNodeDisposal.addDisposeCallback(r,function(){l.sfColorPicker("destroy")})},update:function(n,r){var a=r(),o=e.utils.unwrapObservable(a.color);t(n).sfColorPicker("changeColor",i(o),"commit")}}}(),e.bindingHandlers.picker={init:function(n,r,i,o){function s(){return l.value(""),!1}var l=r(),u=e.observable(!1),d=e.computed(function(){return e.utils.unwrapObservable(l.placeholderCssClass||"")});l.value.subscribe(function(){u(!1)});var c={i18Dict:{Loading:a.resources.Loading,Clear_selection:a.resources.Clear_selection},value:l.value,editorTemplate:l.editorTemplate,editorModel:l.editorModel||o,watermark:l.watermark,normalize:l.normalize,isPlaceholder:l.isPlaceholder,placeholderText:l.placeholderText,placeholderCssClass:d,placeholderTooltip:l.placeholderTooltip,clear:s,flyoutCssClass:l.flyoutCssClass,flyoutTemplate:l.flyoutTemplate,flyoutWidth:l.flyoutWidth||230,flyoutModel:l.flyoutModel||o,flyoutOpen:l.flyoutOpen,dismissOtherFlyouts:void 0===l.dismissOtherFlyouts?!1:l.dismissOtherFlyouts,isFlyoutOpen:u,showError:l.showError,loading:l.loading||e.observable(!1)},p=t("<div data-bind=\"template: 'picker-template'\"/>").replaceAll(t(n));e.applyBindings(c,p[0])}};var p,f,v,b=/^(page|file):([0-9a-f:\-]+)$/i,m=/^\d+$/;e.bindingHandlers.urlPicker={init:function(n,o){var l,u=o(),d=e.computed(function(){return e.utils.unwrapObservable(u.url)}),c=!1;null!=d()&&d().length>0&&(c=!0);var g={i18Dict:{LinkToColon:a.resources.Server__Link_to_colon,Loading:a.resources.Loading,Upload:a.resources.Server__Upload},url:u.url,pages:u.pages,files:e.observableArray([]),archivedFiles:e.observableArray([]),loading:e.observable(!1),showUploader:e.observable(void 0===u.disableUpload||u.disableUpload===!1),dismissOtherFlyouts:u.dismissOtherFlyouts||!1,showError:u.showError||!1,centerAgainstAnchor:u.centerAgainstAnchor||!0,linkType:e.computed(function(){var e=d(),t=e&&e.match(b);return t?t[1]:"external"}),linkId:e.computed(function(){var e=d(),t=e&&e.match(b);if(!t)return!1;var n=t[2];return m.test(n)&&(n=s.toUuid(n)),n}),isSelected:e.computed(function(){var e=d();return e&&b.test(e)}),validate:u.validate||!1,isValid:u.validate?u.isValid:void 0,validationMessage:u.validate?u.validationMessage:void 0};g.selectable=e.computed(function(){var t=u.pages().sort(function(t,n){return t=e.unwrap(t.name).toLowerCase(),n=e.unwrap(n.name).toLowerCase(),n>t?-1:t>n?1:0});return t.concat(g.files())},{deferEvaluation:!0}),g.select=function(t){if(e.isObservable(u.url)&&t){var n;t=e.toJS(t),t.type&&(n="page"===t.type?"page:"+t.id:"file:"+t.referenceId),n&&(u.url(n),u.url.valueHasMutated())}return!1},g.selected=e.computed(function(){var t=g.linkId();if(t!==!1){var n=g.linkType();if("page"===n){for(var r=e.toJS(g.pages()),i={name:"Missing Page",type:"page"},a=0;a<r.length;a++)if((r[a].id||"").toString()===t){i=r[a];break}return i}for(var o=g.files().concat(g.archivedFiles()),s={name:"Missing File",type:"file",mime:"unknown"},l=0;l<o.length;l++)if(o[l].referenceId===t||o[l].id===t){s=o[l];break}return s}return!1}),g.selectedName=e.computed(function(){var t=g.selected();return t?e.utils.unwrapObservable(t.name):""}),g.selectedCssClass=e.computed(function(){var e=g.selected(),t="";return e&&(t+="url-picker-item-icon ",t+="page"==e.type?"url-picker-icon-page":"wsb-mime wsb-mime-"+e.mime),t}),g.onFlyoutOpen=function(e){l=e;var t=e.parents(".sf-flyout");t.css("left",parseFloat(t.css("left"))-12+"px")},g.watermark=a.resources.Destination,void 0!==u.validate&&u.validate===!0&&(u.url.extend({validation:{custom:[{message:a.resources.Enter_a_valid_url_or_select_page_slash_file,test:function(e){return c?e&&e.length:!0}},{message:a.resources.Enter_a_valid_url_or_select_page_slash_file,test:function(e){var n=t.trim(e);return n.length>0||c?(c=!0,r.validateUrl(n)):!0}}]}}),void 0!=g.isValid&&u.url.isValid.subscribe(function(e){g.isValid(e)}),void 0!=g.validationMessage&&u.url.validationMessage.subscribe(function(e){g.validationMessage(e)})),void 0!==u.normalizeUrl&&(t.isFunction(u.normalizeUrl)?g.normalizeUrl=u.normalizeUrl:u.normalizeUrl===!1&&(g.normalizeUrl=function(e){return e})),g.normalizeUrl||(g.normalizeUrl=function(e){var n=e.value(),r=t.trim(n);r&&-1===r.indexOf(":")&&(r=(-1!==r.indexOf("@")?"mailto:":"http://")+r),r!==n&&e.value(r)});var h=t('<div class="'+(u.cssClass||"")+'" data-bind="template: \'url-picker\'"/>').replaceAll(t(n));if(g.showUploader()){var w=function(){f.subscribe(function(e){g.files(e)}),v.subscribe(function(e){g.archivedFiles(e)}),g.files(f()),g.archivedFiles(v()),g.openUploader=function(){t.isFunction(u.onOpen)&&u.onOpen(),l&&l.length&&l.sfContext("close");var e=[];"file"===g.linkType()&&e.push({id:g.linkId()}),i.trackEvent("image_settings","upload","link"),p.openFiles(!1,e,function(e){var n=void 0;if(e&&e.length){for(var r=g.files(),i=0;i<r.length;i++)if(r[i].referenceId===e[0].id){n=r[i];break}g.select(n)}t.isFunction(u.onClose)&&u.onClose(n)})}};p&&f?w():(g.loading(!0),require(["designer/app/builder/ui/controls/media/chooser/media.chooser"],function(e){p=e,p.getFiles(function(e){f=e,p.getArchivedFiles(function(e){v=e,w(),g.loading(!1)},!0)},!0)}))}e.applyBindings(g,h[0])}},e.bindingHandlers.imagePicker={init:function(n,r){var i=t(n),o=new e.bindingHandlers.imagePicker.Model(r);t("<span/>").addClass("btn btn-inverse-grey wsb-add-images-btn").html('<i class="icon-img icon-wsb-white"></i> '+a.resources.Client__Add_Image).bind("click",function(){o.openChooser()}).insertAfter(i),i=t('<div class="wsb-canvas-mutator-ctrl-input mutator-imagepicker-control clearfix" data-bind="template: { name: \'image-picker-template\', afterRender: afterRender }"/>').replaceAll(i),e.applyBindings(o,i[0])},Model:function(t){this.$element=!1,this.subscription=!1,this.model=t(),this.showImage=e.computed(this.validDocId,this,{deferEvaluation:!0})}},e.bindingHandlers.imagePicker.Model.prototype={validDocId:function(){var e=this.model.docId();return"0"!==(e||"0").toString()},removeImage:function(){this.model.docId("0")},afterRender:function(e,n){n.$element=t(e).parent(),n.subscription=n.model.docId.subscribe(function(e){"0"!==(e||"0").toString()&&n.createImage()}),n.showImage()&&n.createImage()},createImage:function(){var e=this,n=this.$element.find("div").html("").addClass("loading"),r=t("<img/>").bind("load",function(){r.appendTo(n.removeClass("loading")).css(e.getAutofitCSS(r,n)).unbind("load")}),i=o.getDocumentUrl(this.model.docId());return r[0].src=i,i},getAutofitCSS:function(e,t){var n=e.width(),r=e.height(),i=r/n,a=t.width(),o=t.height(),s=o/a,l=0,u=0,d=void 0,c=void 0;return 1>i?1>s&&i>s?u=a:l=o:i>1?s>1&&s>i?l=o:u=a:1>s?u=a:l=o,l?d=-(n*(l/r)-a)/2:c=-(r*(u/n)-o)/2,{width:u||"auto",height:l||"auto",left:d,top:c}},openChooser:function(){var e=this;if(p){var t=[],n=this.model.docId();n>0&&t.push({id:n}),i.trackEvent("wsb-designer-media-chooser-image","open","imagepicker"),p.openImages(!1,t,function(t){t&&t.length&&e.model.docId(t[0].id)})}else require(["designer/app/builder/ui/controls/media/chooser/media.chooser"],function(t){p=t,e.openChooser()})}},function(){var n={required:function(e){return e&&t.trim(e).length}};e.extenders.validation=function(t,r){var i=(r.custom||[]).slice(0);for(var a in r)"custom"!==a&&r.hasOwnProperty(a)&&a in n&&i.push({test:n[a],message:r[a]});var o=e.observable(""),s=e.observable(),l=e.computed(function(){for(var e=t(),n=0;n<i.length;n++){var r=i[n];if(!r.test(e))return o(r.message),!1}return o(""),s(e),!0});return t.isValid=l,t.validationMessage=o,t.lastGoodValue=s,t}}(),e.extenders.numericMinMax=function(n,r){var i=r&&t.isNumeric(r.min)?parseFloat(r.min):1,a=r&&t.isNumeric(r.max)?parseFloat(r.max):10,o=e.computed({read:n,write:function(e){var t=parseFloat(n()),r=parseFloat(e);isFinite(r)?(i>r?r=i:r>a&&(r=a),r!==t?n(r):n.notifySubscribers(t)):n(isFinite(t)?t:i)}});return o},e.bindingHandlers.inlineEditor={init:function(n,r,i,a){var o=r(),s=e.utils.unwrapObservable(o.onfocus),l=e.utils.unwrapObservable(o.onblur),c=e.utils.unwrapObservable(o.text),p=e.utils.unwrapObservable(o.validator),f=t(n),v=a;e.utils.registerEventHandler(n,"mousedown",function(){return"edit"===v.state()?!0:(f.attr("contentEditable","true").focus(),u(n),void s(f))}),e.utils.registerEventHandler(n,"keyup",function(){var e=t(n),r=e.text(),i=p(r);o.text(i)}),e.utils.registerEventHandler(n,"focus",function(){d(n)}),e.utils.registerEventHandler(n,"blur",function(){t(n).removeAttr("contentEditable"),l()}),f.text(c)},update:function(n,r){var i=r(),a=e.utils.unwrapObservable(i.text),o=t(n);o.text(a),t(document.activeElement).attr("contentEditable")&&u(n)}},e.bindingHandlers.optionslist={init:function(n,r){var i=e.utils.unwrapObservable(r()),a=i[0],o=function(e){var r=n.value.split(/\n/gm),i=[];return t.each(r,function(n,r){if(e){if(""===t.trim(r))return;if(t.inArray(r,i)>-1)return}i.push(r)}),n.value=i.join("\n"),i},s=function(){var e=r(),t=o(!1);e(t)},l=function(){var e=r(),t=o(!0);0==t.length&&(t[0]=n.value=a),e(t)};e.utils.registerEventHandler(n,"keyup",s),e.utils.registerEventHandler(n,"change",l),e.utils.registerEventHandler(n,"blur",l)},update:function(n,r){var i=e.utils.unwrapObservable(r()).join("\n");t(n).is("textarea:focus")||(n.value=i)}},e.bindingHandlers.watermark={update:function(n,r){var i=e.utils.unwrapObservable(r());t(n).watermark(i)}},e.bindingHandlers.preventBubble={init:function(n,r){var i=e.utils.unwrapObservable(r());if("string"==typeof i&&(i=[i]),t.isArray(i))for(var a=0;a<i.length;a++)e.utils.registerEventHandler(n,i[a],function(e){e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation()})}},e.bindingHandlers.mousewheel={init:function(n,r){var i=e.utils.unwrapObservable(r());t.isFunction(i)&&require(["libs/jquery/plugins/jquery.mousewheel"],function(){t(n).mousewheel(i)})}},e.utils.getRenderedTemplate=function(n,r){var i=t("<div></div>");e.applyBindingsToNode(i[0],{template:{name:n,data:r}});var a=i.html();return i.remove(),a}});
//# sourceMappingURL=ko.addins_v2.js.map