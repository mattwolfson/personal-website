(function(){function e(e,t,n){n=(n||0)-1;for(var i=e?e.length:0;++n<i;)if(e[n]===t)return n;return-1}function t(t,n){var i=typeof n;if(t=t.l,"boolean"==i||null==n)return t[n]?0:-1;"number"!=i&&"string"!=i&&(i="object");var a="number"==i?n:f+n;return t=(t=t[i])&&t[a],"object"==i?t&&-1<e(t,n)?0:-1:t?0:-1}function n(e){var t=this.l,n=typeof e;if("boolean"==n||null==e)t[e]=!0;else{"number"!=n&&"string"!=n&&(n="object");var i="number"==n?e:f+e,t=t[n]||(t[n]={});"object"==n?(t[i]||(t[i]=[])).push(e):t[i]=!0}}function i(e){return e.charCodeAt(0)}function a(e,t){for(var n=e.m,i=t.m,a=-1,r=n.length;++a<r;){var o=n[a],s=i[a];if(o!==s){if(o>s||"undefined"==typeof o)return 1;if(s>o||"undefined"==typeof s)return-1}}return e.n-t.n}function r(e){var t=-1,i=e.length,a=e[0],r=e[i/2|0],o=e[i-1];if(a&&"object"==typeof a&&r&&"object"==typeof r&&o&&"object"==typeof o)return!1;for(a=l(),a["false"]=a["null"]=a["true"]=a.undefined=!1,r=l(),r.k=e,r.l=a,r.push=n;++t<i;)r.push(e[t]);return r}function o(e){return"\\"+$[e]}function s(){return h.pop()||[]}function l(){return m.pop()||{k:null,l:null,m:null,"false":!1,n:0,"null":!1,number:null,object:null,push:null,string:null,"true":!1,undefined:!1,o:null}}function d(e){e.length=0,h.length<y&&h.push(e)}function c(e){var t=e.l;t&&c(t),e.k=e.l=e.m=e.object=e.number=e.string=e.o=null,m.length<y&&m.push(e)}function u(e,t,n){t||(t=0),"undefined"==typeof n&&(n=e?e.length:0);var i=-1;n=n-t||0;for(var a=Array(0>n?0:n);++i<n;)a[i]=e[t+i];return a}function p(n){function h(e,t,n){if(!e||!q[typeof e])return e;t=t&&"undefined"==typeof n?t:tt(t,n,3);for(var i=-1,a=q[typeof e]&&Fn(e),r=a?a.length:0;++i<r&&(n=a[i],!1!==t(e[n],n,e)););return e}function m(e,t,n){var i;if(!e||!q[typeof e])return e;t=t&&"undefined"==typeof n?t:tt(t,n,3);for(i in e)if(!1===t(e[i],i,e))break;return e}function y(e,t,n){var i,a=e,r=a;if(!a)return r;for(var o=arguments,s=0,l="number"==typeof n?2:o.length;++s<l;)if((a=o[s])&&q[typeof a])for(var d=-1,c=q[typeof a]&&Fn(a),u=c?c.length:0;++d<u;)i=c[d],"undefined"==typeof r[i]&&(r[i]=a[i]);return r}function $(e,t,n){var i,a=e,r=a;if(!a)return r;var o=arguments,s=0,l="number"==typeof n?2:o.length;if(l>3&&"function"==typeof o[l-2])var d=tt(o[--l-1],o[l--],2);else l>2&&"function"==typeof o[l-1]&&(d=o[--l]);for(;++s<l;)if((a=o[s])&&q[typeof a])for(var c=-1,u=q[typeof a]&&Fn(a),p=u?u.length:0;++c<p;)i=u[c],r[i]=d?d(r[i],a[i]):a[i];return r}function K(e){var t,n=[];if(!e||!q[typeof e])return n;for(t in e)vn.call(e,t)&&n.push(t);return n}function Y(e){return e&&"object"==typeof e&&!Bn(e)&&vn.call(e,"__wrapped__")?e:new J(e)}function J(e,t){this.__chain__=!!t,this.__wrapped__=e}function Z(e){function t(){if(i){var e=u(i);yn.apply(e,arguments)}if(this instanceof t){var r=et(n.prototype),e=n.apply(r,e||arguments);return wt(e)?e:r}return n.apply(a,e||arguments)}var n=e[0],i=e[2],a=e[4];return Nn(t,e),t}function Q(e,t,n,i,a){if(n){var r=n(e);if("undefined"!=typeof r)return r}if(!wt(e))return e;var o=un.call(e);if(!j[o])return e;var l=On[o];switch(o){case N:case B:return new l(+e);case R:case z:return new l(e);case V:return r=l(e.source,C.exec(e)),r.lastIndex=e.lastIndex,r}if(o=Bn(e),t){var c=!i;i||(i=s()),a||(a=s());for(var p=i.length;p--;)if(i[p]==e)return a[p];r=o?l(e.length):{}}else r=o?u(e):$({},e);return o&&(vn.call(e,"index")&&(r.index=e.index),vn.call(e,"input")&&(r.input=e.input)),t?(i.push(e),a.push(r),(o?Dt:h)(e,function(e,o){r[o]=Q(e,t,n,i,a)}),c&&(d(i),d(a)),r):r}function et(e){return wt(e)?xn(e):{}}function tt(e,t,n){if("function"!=typeof e)return $t;if("undefined"==typeof t||!("prototype"in e))return e;var i=e.__bindData__;if("undefined"==typeof i&&(Ln.funcNames&&(i=!e.name),i=i||!Ln.funcDecomp,!i)){var a=bn.call(e);Ln.funcNames||(i=!T.test(a)),i||(i=I.test(a),Nn(e,i))}if(!1===i||!0!==i&&1&i[1])return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,i){return e.call(t,n,i)};case 3:return function(n,i,a){return e.call(t,n,i,a)};case 4:return function(n,i,a,r){return e.call(t,n,i,a,r)}}return Wt(e,t)}function nt(e){function t(){var e=l?o:this;if(a){var h=u(a);yn.apply(h,arguments)}return(r||c)&&(h||(h=u(arguments)),r&&yn.apply(h,r),c&&h.length<s)?(i|=16,nt([n,p?i:-4&i,h,null,o,s])):(h||(h=arguments),d&&(n=e[g]),this instanceof t?(e=et(n.prototype),h=n.apply(e,h),wt(h)?h:e):n.apply(e,h))}var n=e[0],i=e[1],a=e[2],r=e[3],o=e[4],s=e[5],l=1&i,d=2&i,c=4&i,p=8&i,g=n;return Nn(t,e),t}function it(n,i){var a=-1,o=pt(),s=n?n.length:0,l=s>=v&&o===e,d=[];if(l){var u=r(i);u?(o=t,i=u):l=!1}for(;++a<s;)u=n[a],0>o(i,u)&&d.push(u);return l&&c(i),d}function at(e,t,n,i){i=(i||0)-1;for(var a=e?e.length:0,r=[];++i<a;){var o=e[i];if(o&&"object"==typeof o&&"number"==typeof o.length&&(Bn(o)||bt(o))){t||(o=at(o,t,n));var s=-1,l=o.length,d=r.length;for(r.length+=l;++s<l;)r[d++]=o[s]}else n||r.push(o)}return r}function rt(e,t,n,i,a,r){if(n){var o=n(e,t);if("undefined"!=typeof o)return!!o}if(e===t)return 0!==e||1/e==1/t;if(e===e&&!(e&&q[typeof e]||t&&q[typeof t]))return!1;if(null==e||null==t)return e===t;var l=un.call(e),c=un.call(t);if(l==O&&(l=H),c==O&&(c=H),l!=c)return!1;switch(l){case N:case B:return+e==+t;case R:return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case V:case z:return e==on(t)}if(c=l==L,!c){var u=vn.call(e,"__wrapped__"),p=vn.call(t,"__wrapped__");if(u||p)return rt(u?e.__wrapped__:e,p?t.__wrapped__:t,n,i,a,r);if(l!=H)return!1;if(l=e.constructor,u=t.constructor,l!=u&&!(_t(l)&&l instanceof l&&_t(u)&&u instanceof u)&&"constructor"in e&&"constructor"in t)return!1}for(l=!a,a||(a=s()),r||(r=s()),u=a.length;u--;)if(a[u]==e)return r[u]==t;var g=0,o=!0;if(a.push(e),r.push(t),c){if(u=e.length,g=t.length,(o=g==u)||i)for(;g--;)if(c=u,p=t[g],i)for(;c--&&!(o=rt(e[c],p,n,i,a,r)););else if(!(o=rt(e[g],p,n,i,a,r)))break}else m(t,function(t,s,l){return vn.call(l,s)?(g++,o=vn.call(e,s)&&rt(e[s],t,n,i,a,r)):void 0}),o&&!i&&m(e,function(e,t,n){return vn.call(n,t)?o=-1<--g:void 0});return a.pop(),r.pop(),l&&(d(a),d(r)),o}function ot(e,t,n,i,a){(Bn(t)?Dt:h)(t,function(t,r){var o,s,l=t,d=e[r];if(t&&((s=Bn(t))||jn(t))){for(l=i.length;l--;)if(o=i[l]==t){d=a[l];break}if(!o){var c;n&&(l=n(d,t),c="undefined"!=typeof l)&&(d=l),c||(d=s?Bn(d)?d:[]:jn(d)?d:{}),i.push(t),a.push(d),c||ot(d,t,n,i,a)}}else n&&(l=n(d,t),"undefined"==typeof l&&(l=t)),"undefined"!=typeof l&&(d=l);e[r]=d})}function st(e,t){return e+mn(Mn()*(t-e+1))}function lt(n,i,a){var o=-1,l=pt(),u=n?n.length:0,p=[],g=!i&&u>=v&&l===e,h=a||g?s():p;for(g&&(h=r(h),l=t);++o<u;){var m=n[o],b=a?a(m,o,n):m;(i?!o||h[h.length-1]!==b:0>l(h,b))&&((a||g)&&h.push(b),p.push(m))}return g?(d(h.k),c(h)):a&&d(h),p}function dt(e){return function(t,n,i){var a={};n=Y.createCallback(n,i,3),i=-1;var r=t?t.length:0;if("number"==typeof r)for(;++i<r;){var o=t[i];e(a,o,n(o,i,t),t)}else h(t,function(t,i,r){e(a,t,n(t,i,r),r)});return a}}function ct(e,t,n,i,a,r){var o=1&t,s=4&t,l=16&t,d=32&t;if(!(2&t||_t(e)))throw new sn;l&&!n.length&&(t&=-17,l=n=!1),d&&!i.length&&(t&=-33,d=i=!1);var c=e&&e.__bindData__;return c&&!0!==c?(c=u(c),c[2]&&(c[2]=u(c[2])),c[3]&&(c[3]=u(c[3])),!o||1&c[1]||(c[4]=a),!o&&1&c[1]&&(t|=8),!s||4&c[1]||(c[5]=r),l&&yn.apply(c[2]||(c[2]=[]),n),d&&Sn.apply(c[3]||(c[3]=[]),i),c[1]|=t,ct.apply(null,c)):(1==t||17===t?Z:nt)([e,t,n,i,a,r])}function ut(e){return Rn[e]}function pt(){var t=(t=Y.indexOf)===Rt?e:t;return t}function gt(e){return"function"==typeof e&&pn.test(e)}function ht(e){var t,n;return e&&un.call(e)==H&&(t=e.constructor,!_t(t)||t instanceof t)?(m(e,function(e,t){n=t}),"undefined"==typeof n||vn.call(e,n)):!1}function mt(e){return Hn[e]}function bt(e){return e&&"object"==typeof e&&"number"==typeof e.length&&un.call(e)==O||!1}function ft(e,t,n){var i=Fn(e),a=i.length;for(t=tt(t,n,3);a--&&(n=i[a],!1!==t(e[n],n,e)););return e}function vt(e){var t=[];return m(e,function(e,n){_t(e)&&t.push(n)}),t.sort()}function yt(e){for(var t=-1,n=Fn(e),i=n.length,a={};++t<i;){var r=n[t];a[e[r]]=r}return a}function _t(e){return"function"==typeof e}function wt(e){return!(!e||!q[typeof e])}function St(e){return"number"==typeof e||e&&"object"==typeof e&&un.call(e)==R||!1}function kt(e){return"string"==typeof e||e&&"object"==typeof e&&un.call(e)==z||!1}function xt(e){for(var t=-1,n=Fn(e),i=n.length,a=Zt(i);++t<i;)a[t]=e[n[t]];return a}function Ct(e,t,n){var i=-1,a=pt(),r=e?e.length:0,o=!1;return n=(0>n?Dn(0,r+n):n)||0,Bn(e)?o=-1<a(e,t,n):"number"==typeof r?o=-1<(kt(e)?e.indexOf(t,n):a(e,t,n)):h(e,function(e){return++i<n?void 0:!(o=e===t)}),o}function Tt(e,t,n){var i=!0;t=Y.createCallback(t,n,3),n=-1;var a=e?e.length:0;if("number"==typeof a)for(;++n<a&&(i=!!t(e[n],n,e)););else h(e,function(e,n,a){return i=!!t(e,n,a)});return i}function Et(e,t,n){var i=[];t=Y.createCallback(t,n,3),n=-1;var a=e?e.length:0;if("number"==typeof a)for(;++n<a;){var r=e[n];t(r,n,e)&&i.push(r)}else h(e,function(e,n,a){t(e,n,a)&&i.push(e)});return i}function Pt(e,t,n){t=Y.createCallback(t,n,3),n=-1;var i=e?e.length:0;if("number"!=typeof i){var a;return h(e,function(e,n,i){return t(e,n,i)?(a=e,!1):void 0}),a}for(;++n<i;){var r=e[n];if(t(r,n,e))return r}}function Dt(e,t,n){var i=-1,a=e?e.length:0;if(t=t&&"undefined"==typeof n?t:tt(t,n,3),"number"==typeof a)for(;++i<a&&!1!==t(e[i],i,e););else h(e,t);return e}function It(e,t,n){var i=e?e.length:0;if(t=t&&"undefined"==typeof n?t:tt(t,n,3),"number"==typeof i)for(;i--&&!1!==t(e[i],i,e););else{var a=Fn(e),i=a.length;h(e,function(e,n,r){return n=a?a[--i]:--i,t(r[n],n,r)})}return e}function At(e,t,n){var i=-1,a=e?e.length:0;if(t=Y.createCallback(t,n,3),"number"==typeof a)for(var r=Zt(a);++i<a;)r[i]=t(e[i],i,e);else r=[],h(e,function(e,n,a){r[++i]=t(e,n,a)});return r}function Mt(e,t,n){var a=-1/0,r=a;if("function"!=typeof t&&n&&n[t]===e&&(t=null),null==t&&Bn(e)){n=-1;for(var o=e.length;++n<o;){var s=e[n];s>r&&(r=s)}}else t=null==t&&kt(e)?i:Y.createCallback(t,n,3),Dt(e,function(e,n,i){n=t(e,n,i),n>a&&(a=n,r=e)});return r}function Ot(e,t,n,i){if(!e)return n;var a=3>arguments.length;t=Y.createCallback(t,i,4);var r=-1,o=e.length;if("number"==typeof o)for(a&&(n=e[++r]);++r<o;)n=t(n,e[r],r,e);else h(e,function(e,i,r){n=a?(a=!1,e):t(n,e,i,r)});return n}function Lt(e,t,n,i){var a=3>arguments.length;return t=Y.createCallback(t,i,4),It(e,function(e,i,r){n=a?(a=!1,e):t(n,e,i,r)}),n}function Nt(e){var t=-1,n=e?e.length:0,i=Zt("number"==typeof n?n:0);return Dt(e,function(e){var n=st(0,++t);i[t]=i[n],i[n]=e}),i}function Bt(e,t,n){var i;t=Y.createCallback(t,n,3),n=-1;var a=e?e.length:0;if("number"==typeof a)for(;++n<a&&!(i=t(e[n],n,e)););else h(e,function(e,n,a){return!(i=t(e,n,a))});return!!i}function Ft(e,t,n){var i=0,a=e?e.length:0;if("number"!=typeof t&&null!=t){var r=-1;for(t=Y.createCallback(t,n,3);++r<a&&t(e[r],r,e);)i++}else if(i=t,null==i||n)return e?e[0]:g;return u(e,0,In(Dn(0,i),a))}function Rt(t,n,i){if("number"==typeof i){var a=t?t.length:0;i=0>i?Dn(0,a+i):i||0}else if(i)return i=Vt(t,n),t[i]===n?i:-1;return e(t,n,i)}function Ht(e,t,n){if("number"!=typeof t&&null!=t){var i=0,a=-1,r=e?e.length:0;for(t=Y.createCallback(t,n,3);++a<r&&t(e[a],a,e);)i++}else i=null==t||n?1:Dn(0,t);return u(e,i)}function Vt(e,t,n,i){var a=0,r=e?e.length:a;for(n=n?Y.createCallback(n,i,1):$t,t=n(t);r>a;)i=a+r>>>1,n(e[i])<t?a=i+1:r=i;return a}function zt(e,t,n,i){return"boolean"!=typeof t&&null!=t&&(i=n,n="function"!=typeof t&&i&&i[t]===e?null:t,t=!1),null!=n&&(n=Y.createCallback(n,i,3)),lt(e,t,n)}function jt(){for(var e=1<arguments.length?arguments:arguments[0],t=-1,n=e?Mt($n(e,"length")):0,i=Zt(0>n?0:n);++t<n;)i[t]=$n(e,t);return i}function Ut(e,t){var n=-1,i=e?e.length:0,a={};for(t||!i||Bn(e[0])||(t=[]);++n<i;){var r=e[n];t?a[r]=t[n]:r&&(a[r[0]]=r[1])}return a}function Wt(e,t){return 2<arguments.length?ct(e,17,u(arguments,2),null,t):ct(e,1,null,null,t)}function qt(e,t,n){function i(){c&&hn(c),o=c=u=g,(m||h!==t)&&(p=Gn(),s=e.apply(d,r),c||o||(r=d=null))}function a(){var n=t-(Gn()-l);n>0?c=_n(a,n):(o&&hn(o),n=u,o=c=u=g,n&&(p=Gn(),s=e.apply(d,r),c||o||(r=d=null)))}var r,o,s,l,d,c,u,p=0,h=!1,m=!0;if(!_t(e))throw new sn;if(t=Dn(0,t)||0,!0===n)var b=!0,m=!1;else wt(n)&&(b=n.leading,h="maxWait"in n&&(Dn(t,n.maxWait)||0),m="trailing"in n?n.trailing:m);return function(){if(r=arguments,l=Gn(),d=this,u=m&&(c||!b),!1===h)var n=b&&!c;else{o||b||(p=l);var g=h-(l-p),f=0>=g;f?(o&&(o=hn(o)),p=l,s=e.apply(d,r)):o||(o=_n(i,g))}return f&&c?c=hn(c):c||t===h||(c=_n(a,t)),n&&(f=!0,s=e.apply(d,r)),!f||c||o||(r=d=null),s}}function $t(e){return e}function Gt(e,t,n){var i=!0,a=t&&vt(t);t&&(n||a.length)||(null==n&&(n=t),r=J,t=e,e=Y,a=vt(t)),!1===n?i=!1:wt(n)&&"chain"in n&&(i=n.chain);var r=e,o=_t(r);Dt(a,function(n){var a=e[n]=t[n];o&&(r.prototype[n]=function(){var t=this.__chain__,n=this.__wrapped__,o=[n];if(yn.apply(o,arguments),o=a.apply(e,o),i||t){if(n===o&&wt(o))return this;o=new r(o),o.__chain__=t}return o})})}function Kt(){}function Yt(e){return function(t){return t[e]}}function Jt(){return this.__wrapped__}n=n?X.defaults(G.Object(),n,X.pick(G,M)):G;var Zt=n.Array,Xt=n.Boolean,Qt=n.Date,en=n.Function,tn=n.Math,nn=n.Number,an=n.Object,rn=n.RegExp,on=n.String,sn=n.TypeError,ln=[],dn=an.prototype,cn=n._,un=dn.toString,pn=rn("^"+on(un).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),gn=tn.ceil,hn=n.clearTimeout,mn=tn.floor,bn=en.prototype.toString,fn=gt(fn=an.getPrototypeOf)&&fn,vn=dn.hasOwnProperty,yn=ln.push,_n=n.setTimeout,wn=ln.splice,Sn=ln.unshift,kn=function(){try{var e={},t=gt(t=an.defineProperty)&&t,n=t(e,e,e)&&t}catch(i){}return n}(),xn=gt(xn=an.create)&&xn,Cn=gt(Cn=Zt.isArray)&&Cn,Tn=n.isFinite,En=n.isNaN,Pn=gt(Pn=an.keys)&&Pn,Dn=tn.max,In=tn.min,An=n.parseInt,Mn=tn.random,On={};On[L]=Zt,On[N]=Xt,On[B]=Qt,On[F]=en,On[H]=an,On[R]=nn,On[V]=rn,On[z]=on,J.prototype=Y.prototype;var Ln=Y.support={};Ln.funcDecomp=!gt(n.a)&&I.test(p),Ln.funcNames="string"==typeof en.name,Y.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:E,variable:"",imports:{_:Y}},xn||(et=function(){function e(){}return function(t){if(wt(t)){e.prototype=t;var i=new e;e.prototype=null}return i||n.Object()}}());var Nn=kn?function(e,t){W.value=t,kn(e,"__bindData__",W)}:Kt,Bn=Cn||function(e){return e&&"object"==typeof e&&"number"==typeof e.length&&un.call(e)==L||!1},Fn=Pn?function(e){return wt(e)?Pn(e):[]}:K,Rn={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Hn=yt(Rn),Vn=rn("("+Fn(Hn).join("|")+")","g"),zn=rn("["+Fn(Rn).join("")+"]","g"),jn=fn?function(e){if(!e||un.call(e)!=H)return!1;var t=e.valueOf,n=gt(t)&&(n=fn(t))&&fn(n);return n?e==n||fn(e)==n:ht(e)}:ht,Un=dt(function(e,t,n){vn.call(e,n)?e[n]++:e[n]=1}),Wn=dt(function(e,t,n){(vn.call(e,n)?e[n]:e[n]=[]).push(t)}),qn=dt(function(e,t,n){e[n]=t}),$n=At,Gn=gt(Gn=Qt.now)&&Gn||function(){return(new Qt).getTime()},Kn=8==An(_+"08")?An:function(e,t){return An(kt(e)?e.replace(P,""):e,t||0)};return Y.after=function(e,t){if(!_t(t))throw new sn;return function(){return 1>--e?t.apply(this,arguments):void 0}},Y.assign=$,Y.at=function(e){for(var t=arguments,n=-1,i=at(t,!0,!1,1),t=t[2]&&t[2][t[1]]===e?1:i.length,a=Zt(t);++n<t;)a[n]=e[i[n]];return a},Y.bind=Wt,Y.bindAll=function(e){for(var t=1<arguments.length?at(arguments,!0,!1,1):vt(e),n=-1,i=t.length;++n<i;){var a=t[n];e[a]=ct(e[a],1,null,null,e)}return e},Y.bindKey=function(e,t){return 2<arguments.length?ct(t,19,u(arguments,2),null,e):ct(t,3,null,null,e)},Y.chain=function(e){return e=new J(e),e.__chain__=!0,e},Y.compact=function(e){for(var t=-1,n=e?e.length:0,i=[];++t<n;){var a=e[t];a&&i.push(a)}return i},Y.compose=function(){for(var e=arguments,t=e.length;t--;)if(!_t(e[t]))throw new sn;return function(){for(var t=arguments,n=e.length;n--;)t=[e[n].apply(this,t)];return t[0]}},Y.constant=function(e){return function(){return e}},Y.countBy=Un,Y.create=function(e,t){var n=et(e);return t?$(n,t):n},Y.createCallback=function(e,t,n){var i=typeof e;if(null==e||"function"==i)return tt(e,t,n);if("object"!=i)return Yt(e);var a=Fn(e),r=a[0],o=e[r];return 1!=a.length||o!==o||wt(o)?function(t){for(var n=a.length,i=!1;n--&&(i=rt(t[a[n]],e[a[n]],null,!0)););return i}:function(e){return e=e[r],o===e&&(0!==o||1/o==1/e)}},Y.curry=function(e,t){return t="number"==typeof t?t:+t||e.length,ct(e,4,null,null,null,t)},Y.debounce=qt,Y.defaults=y,Y.defer=function(e){if(!_t(e))throw new sn;var t=u(arguments,1);return _n(function(){e.apply(g,t)},1)},Y.delay=function(e,t){if(!_t(e))throw new sn;var n=u(arguments,2);return _n(function(){e.apply(g,n)},t)},Y.difference=function(e){return it(e,at(arguments,!0,!0,1))},Y.filter=Et,Y.flatten=function(e,t,n,i){return"boolean"!=typeof t&&null!=t&&(i=n,n="function"!=typeof t&&i&&i[t]===e?null:t,t=!1),null!=n&&(e=At(e,n,i)),at(e,t)},Y.forEach=Dt,Y.forEachRight=It,Y.forIn=m,Y.forInRight=function(e,t,n){var i=[];m(e,function(e,t){i.push(t,e)});var a=i.length;for(t=tt(t,n,3);a--&&!1!==t(i[a--],i[a],e););return e},Y.forOwn=h,Y.forOwnRight=ft,Y.functions=vt,Y.groupBy=Wn,Y.indexBy=qn,Y.initial=function(e,t,n){var i=0,a=e?e.length:0;if("number"!=typeof t&&null!=t){var r=a;for(t=Y.createCallback(t,n,3);r--&&t(e[r],r,e);)i++}else i=null==t||n?1:t||i;return u(e,0,In(Dn(0,a-i),a))},Y.intersection=function(){for(var n=[],i=-1,a=arguments.length,o=s(),l=pt(),u=l===e,p=s();++i<a;){var g=arguments[i];(Bn(g)||bt(g))&&(n.push(g),o.push(u&&g.length>=v&&r(i?n[i]:p)))}var u=n[0],h=-1,m=u?u.length:0,b=[];e:for(;++h<m;){var f=o[0],g=u[h];if(0>(f?t(f,g):l(p,g))){for(i=a,(f||p).push(g);--i;)if(f=o[i],0>(f?t(f,g):l(n[i],g)))continue e;b.push(g)}}for(;a--;)(f=o[a])&&c(f);return d(o),d(p),b},Y.invert=yt,Y.invoke=function(e,t){var n=u(arguments,2),i=-1,a="function"==typeof t,r=e?e.length:0,o=Zt("number"==typeof r?r:0);return Dt(e,function(e){o[++i]=(a?t:e[t]).apply(e,n)}),o},Y.keys=Fn,Y.map=At,Y.mapValues=function(e,t,n){var i={};return t=Y.createCallback(t,n,3),h(e,function(e,n,a){i[n]=t(e,n,a)}),i},Y.max=Mt,Y.memoize=function(e,t){function n(){var i=n.cache,a=t?t.apply(this,arguments):f+arguments[0];return vn.call(i,a)?i[a]:i[a]=e.apply(this,arguments)}if(!_t(e))throw new sn;return n.cache={},n},Y.merge=function(e){var t=arguments,n=2;if(!wt(e))return e;if("number"!=typeof t[2]&&(n=t.length),n>3&&"function"==typeof t[n-2])var i=tt(t[--n-1],t[n--],2);else n>2&&"function"==typeof t[n-1]&&(i=t[--n]);for(var t=u(arguments,1,n),a=-1,r=s(),o=s();++a<n;)ot(e,t[a],i,r,o);return d(r),d(o),e},Y.min=function(e,t,n){var a=1/0,r=a;if("function"!=typeof t&&n&&n[t]===e&&(t=null),null==t&&Bn(e)){n=-1;for(var o=e.length;++n<o;){var s=e[n];r>s&&(r=s)}}else t=null==t&&kt(e)?i:Y.createCallback(t,n,3),Dt(e,function(e,n,i){n=t(e,n,i),a>n&&(a=n,r=e)});return r},Y.omit=function(e,t,n){var i={};if("function"!=typeof t){var a=[];m(e,function(e,t){a.push(t)});for(var a=it(a,at(arguments,!0,!1,1)),r=-1,o=a.length;++r<o;){var s=a[r];i[s]=e[s]}}else t=Y.createCallback(t,n,3),m(e,function(e,n,a){t(e,n,a)||(i[n]=e)});return i},Y.once=function(e){var t,n;if(!_t(e))throw new sn;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}},Y.pairs=function(e){for(var t=-1,n=Fn(e),i=n.length,a=Zt(i);++t<i;){var r=n[t];a[t]=[r,e[r]]}return a},Y.partial=function(e){return ct(e,16,u(arguments,1))},Y.partialRight=function(e){return ct(e,32,null,u(arguments,1))},Y.pick=function(e,t,n){var i={};if("function"!=typeof t)for(var a=-1,r=at(arguments,!0,!1,1),o=wt(e)?r.length:0;++a<o;){var s=r[a];s in e&&(i[s]=e[s])}else t=Y.createCallback(t,n,3),m(e,function(e,n,a){t(e,n,a)&&(i[n]=e)});return i},Y.pluck=$n,Y.property=Yt,Y.pull=function(e){for(var t=arguments,n=0,i=t.length,a=e?e.length:0;++n<i;)for(var r=-1,o=t[n];++r<a;)e[r]===o&&(wn.call(e,r--,1),a--);return e},Y.range=function(e,t,n){e=+e||0,n="number"==typeof n?n:+n||1,null==t&&(t=e,e=0);var i=-1;t=Dn(0,gn((t-e)/(n||1)));for(var a=Zt(t);++i<t;)a[i]=e,e+=n;return a},Y.reject=function(e,t,n){return t=Y.createCallback(t,n,3),Et(e,function(e,n,i){return!t(e,n,i)})},Y.remove=function(e,t,n){var i=-1,a=e?e.length:0,r=[];for(t=Y.createCallback(t,n,3);++i<a;)n=e[i],t(n,i,e)&&(r.push(n),wn.call(e,i--,1),a--);return r},Y.rest=Ht,Y.shuffle=Nt,Y.sortBy=function(e,t,n){var i=-1,r=Bn(t),o=e?e.length:0,u=Zt("number"==typeof o?o:0);for(r||(t=Y.createCallback(t,n,3)),Dt(e,function(e,n,a){var o=u[++i]=l();r?o.m=At(t,function(t){return e[t]}):(o.m=s())[0]=t(e,n,a),o.n=i,o.o=e}),o=u.length,u.sort(a);o--;)e=u[o],u[o]=e.o,r||d(e.m),c(e);return u},Y.tap=function(e,t){return t(e),e},Y.throttle=function(e,t,n){var i=!0,a=!0;if(!_t(e))throw new sn;return!1===n?i=!1:wt(n)&&(i="leading"in n?n.leading:i,a="trailing"in n?n.trailing:a),U.leading=i,U.maxWait=t,U.trailing=a,qt(e,t,U)},Y.times=function(e,t,n){e=-1<(e=+e)?e:0;var i=-1,a=Zt(e);for(t=tt(t,n,1);++i<e;)a[i]=t(i);return a},Y.toArray=function(e){return e&&"number"==typeof e.length?u(e):xt(e)},Y.transform=function(e,t,n,i){var a=Bn(e);if(null==n)if(a)n=[];else{var r=e&&e.constructor;n=et(r&&r.prototype)}return t&&(t=Y.createCallback(t,i,4),(a?Dt:h)(e,function(e,i,a){return t(n,e,i,a)})),n},Y.union=function(){return lt(at(arguments,!0,!0))},Y.uniq=zt,Y.values=xt,Y.where=Et,Y.without=function(e){return it(e,u(arguments,1))},Y.wrap=function(e,t){return ct(t,16,[e])},Y.xor=function(){for(var e=-1,t=arguments.length;++e<t;){var n=arguments[e];if(Bn(n)||bt(n))var i=i?lt(it(i,n).concat(it(n,i))):n}return i||[]},Y.zip=jt,Y.zipObject=Ut,Y.collect=At,Y.drop=Ht,Y.each=Dt,Y.eachRight=It,Y.extend=$,Y.methods=vt,Y.object=Ut,Y.select=Et,Y.tail=Ht,Y.unique=zt,Y.unzip=jt,Gt(Y),Y.clone=function(e,t,n,i){return"boolean"!=typeof t&&null!=t&&(i=n,n=t,t=!1),Q(e,t,"function"==typeof n&&tt(n,i,1))},Y.cloneDeep=function(e,t,n){return Q(e,!0,"function"==typeof t&&tt(t,n,1))},Y.contains=Ct,Y.escape=function(e){return null==e?"":on(e).replace(zn,ut)},Y.every=Tt,Y.find=Pt,Y.findIndex=function(e,t,n){var i=-1,a=e?e.length:0;for(t=Y.createCallback(t,n,3);++i<a;)if(t(e[i],i,e))return i;return-1},Y.findKey=function(e,t,n){var i;return t=Y.createCallback(t,n,3),h(e,function(e,n,a){return t(e,n,a)?(i=n,!1):void 0}),i},Y.findLast=function(e,t,n){var i;return t=Y.createCallback(t,n,3),It(e,function(e,n,a){return t(e,n,a)?(i=e,!1):void 0}),i},Y.findLastIndex=function(e,t,n){var i=e?e.length:0;for(t=Y.createCallback(t,n,3);i--;)if(t(e[i],i,e))return i;return-1},Y.findLastKey=function(e,t,n){var i;return t=Y.createCallback(t,n,3),ft(e,function(e,n,a){return t(e,n,a)?(i=n,!1):void 0}),i},Y.has=function(e,t){return e?vn.call(e,t):!1},Y.identity=$t,Y.indexOf=Rt,Y.isArguments=bt,Y.isArray=Bn,Y.isBoolean=function(e){return!0===e||!1===e||e&&"object"==typeof e&&un.call(e)==N||!1},Y.isDate=function(e){return e&&"object"==typeof e&&un.call(e)==B||!1},Y.isElement=function(e){return e&&1===e.nodeType||!1},Y.isEmpty=function(e){var t=!0;if(!e)return t;var n=un.call(e),i=e.length;return n==L||n==z||n==O||n==H&&"number"==typeof i&&_t(e.splice)?!i:(h(e,function(){return t=!1}),t)},Y.isEqual=function(e,t,n,i){return rt(e,t,"function"==typeof n&&tt(n,i,2))},Y.isFinite=function(e){return Tn(e)&&!En(parseFloat(e))},Y.isFunction=_t,Y.isNaN=function(e){return St(e)&&e!=+e},Y.isNull=function(e){return null===e},Y.isNumber=St,Y.isObject=wt,Y.isPlainObject=jn,Y.isRegExp=function(e){return e&&"object"==typeof e&&un.call(e)==V||!1},Y.isString=kt,Y.isUndefined=function(e){return"undefined"==typeof e},Y.lastIndexOf=function(e,t,n){var i=e?e.length:0;for("number"==typeof n&&(i=(0>n?Dn(0,i+n):In(n,i-1))+1);i--;)if(e[i]===t)return i;return-1},Y.mixin=Gt,Y.noConflict=function(){return n._=cn,this},Y.noop=Kt,Y.now=Gn,Y.parseInt=Kn,Y.random=function(e,t,n){var i=null==e,a=null==t;return null==n&&("boolean"==typeof e&&a?(n=e,e=1):a||"boolean"!=typeof t||(n=t,a=!0)),i&&a&&(t=1),e=+e||0,a?(t=e,e=0):t=+t||0,n||e%1||t%1?(n=Mn(),In(e+n*(t-e+parseFloat("1e-"+((n+"").length-1))),t)):st(e,t)},Y.reduce=Ot,Y.reduceRight=Lt,Y.result=function(e,t){if(e){var n=e[t];return _t(n)?e[t]():n}},Y.runInContext=p,Y.size=function(e){var t=e?e.length:0;return"number"==typeof t?t:Fn(e).length},Y.some=Bt,Y.sortedIndex=Vt,Y.template=function(e,t,n){var i=Y.templateSettings;e=on(e||""),n=y({},n,i);var a,r=y({},n.imports,i.imports),i=Fn(r),r=xt(r),s=0,l=n.interpolate||D,d="__p+='",l=rn((n.escape||D).source+"|"+l.source+"|"+(l===E?x:D).source+"|"+(n.evaluate||D).source+"|$","g");e.replace(l,function(t,n,i,r,l,c){return i||(i=r),d+=e.slice(s,c).replace(A,o),n&&(d+="'+__e("+n+")+'"),l&&(a=!0,d+="';"+l+";\n__p+='"),i&&(d+="'+((__t=("+i+"))==null?'':__t)+'"),s=c+t.length,t}),d+="';",l=n=n.variable,l||(n="obj",d="with("+n+"){"+d+"}"),d=(a?d.replace(w,""):d).replace(S,"$1").replace(k,"$1;"),d="function("+n+"){"+(l?"":n+"||("+n+"={});")+"var __t,__p='',__e=_.escape"+(a?",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}":";")+d+"return __p}";try{var c=en(i,"return "+d).apply(g,r)}catch(u){throw u.source=d,u}return t?c(t):(c.source=d,c)},Y.unescape=function(e){return null==e?"":on(e).replace(Vn,mt)},Y.uniqueId=function(e){var t=++b;return on(null==e?"":e)+t},Y.all=Tt,Y.any=Bt,Y.detect=Pt,Y.findWhere=Pt,Y.foldl=Ot,Y.foldr=Lt,Y.include=Ct,Y.inject=Ot,Gt(function(){var e={};return h(Y,function(t,n){Y.prototype[n]||(e[n]=t)}),e}(),!1),Y.first=Ft,Y.last=function(e,t,n){var i=0,a=e?e.length:0;if("number"!=typeof t&&null!=t){var r=a;for(t=Y.createCallback(t,n,3);r--&&t(e[r],r,e);)i++}else if(i=t,null==i||n)return e?e[a-1]:g;return u(e,Dn(0,a-i))},Y.sample=function(e,t,n){return e&&"number"!=typeof e.length&&(e=xt(e)),null==t||n?e?e[st(0,e.length-1)]:g:(e=Nt(e),e.length=In(Dn(0,t),e.length),e)},Y.take=Ft,Y.head=Ft,h(Y,function(e,t){var n="sample"!==t;Y.prototype[t]||(Y.prototype[t]=function(t,i){var a=this.__chain__,r=e(this.__wrapped__,t,i);return a||null!=t&&(!i||n&&"function"==typeof t)?new J(r,a):r})}),Y.VERSION="2.4.1",Y.prototype.chain=function(){return this.__chain__=!0,this},Y.prototype.toString=function(){return on(this.__wrapped__)},Y.prototype.value=Jt,Y.prototype.valueOf=Jt,Dt(["join","pop","shift"],function(e){var t=ln[e];Y.prototype[e]=function(){var e=this.__chain__,n=t.apply(this.__wrapped__,arguments);return e?new J(n,e):n}}),Dt(["push","reverse","sort","unshift"],function(e){var t=ln[e];Y.prototype[e]=function(){return t.apply(this.__wrapped__,arguments),this}}),Dt(["concat","slice","splice"],function(e){var t=ln[e];Y.prototype[e]=function(){return new J(t.apply(this.__wrapped__,arguments),this.__chain__)}}),Y}var g,h=[],m=[],b=0,f=+new Date+"",v=75,y=40,_=" 	\f ﻿\n\r\u2028\u2029 ᠎             　",w=/\b__p\+='';/g,S=/\b(__p\+=)''\+/g,k=/(__e\(.*?\)|\b__t\))\+'';/g,x=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,C=/\w*$/,T=/^\s*function[ \n\r\t]+\w/,E=/<%=([\s\S]+?)%>/g,P=RegExp("^["+_+"]*0+(?=.$)"),D=/($^)/,I=/\bthis\b/,A=/['\n\r\t\u2028\u2029\\]/g,M="Array Boolean Date Function Math Number Object RegExp String _ attachEvent clearTimeout isFinite isNaN parseInt setTimeout".split(" "),O="[object Arguments]",L="[object Array]",N="[object Boolean]",B="[object Date]",F="[object Function]",R="[object Number]",H="[object Object]",V="[object RegExp]",z="[object String]",j={};j[F]=!1,j[O]=j[L]=j[N]=j[B]=j[R]=j[H]=j[V]=j[z]=!0;var U={leading:!1,maxWait:0,trailing:!1},W={configurable:!1,enumerable:!1,value:null,writable:!1},q={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},$={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},G=q[typeof window]&&window||this,K=q[typeof exports]&&exports&&!exports.nodeType&&exports,Y=q[typeof module]&&module&&!module.nodeType&&module,J=Y&&Y.exports===K&&K,Z=q[typeof global]&&global;!Z||Z.global!==Z&&Z.window!==Z||(G=Z);var X=p();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(G._=X,define("lodash",[],function(){return X})):K&&Y?J?(Y.exports=X)._=X:K._=X:G._=X}).call(this),!function(){function e(){this._events={},this._conf&&t.call(this,this._conf)}function t(e){e&&(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),e.maxListeners&&(this._events.maxListeners=e.maxListeners),e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this.newListener=e.newListener),this.wildcard&&(this.listenerTree={}))}function n(e){this._events={},this.newListener=!1,t.call(this,e)}function i(e,t,n,a){if(!n)return[];var r,o,s,l,d,c,u,p=[],g=t.length,h=t[a],m=t[a+1];if(a===g&&n._listeners){if("function"==typeof n._listeners)return e&&e.push(n._listeners),[n];for(r=0,o=n._listeners.length;o>r;r++)e&&e.push(n._listeners[r]);return[n]}if("*"===h||"**"===h||n[h]){if("*"===h){for(s in n)"_listeners"!==s&&n.hasOwnProperty(s)&&(p=p.concat(i(e,t,n[s],a+1)));return p}if("**"===h){u=a+1===g||a+2===g&&"*"===m,u&&n._listeners&&(p=p.concat(i(e,t,n,g)));for(s in n)"_listeners"!==s&&n.hasOwnProperty(s)&&("*"===s||"**"===s?(n[s]._listeners&&!u&&(p=p.concat(i(e,t,n[s],g))),p=p.concat(i(e,t,n[s],a))):p=p.concat(s===m?i(e,t,n[s],a+2):i(e,t,n[s],a)));return p}p=p.concat(i(e,t,n[h],a+1))}if(l=n["*"],l&&i(e,t,l,a+1),d=n["**"])if(g>a){d._listeners&&i(e,t,d,g);for(s in d)"_listeners"!==s&&d.hasOwnProperty(s)&&(s===m?i(e,t,d[s],a+2):s===h?i(e,t,d[s],a+1):(c={},c[s]=d[s],i(e,t,{"**":c},a+1)))}else d._listeners?i(e,t,d,g):d["*"]&&d["*"]._listeners&&i(e,t,d["*"],g);return p}function a(e,t){e="string"==typeof e?e.split(this.delimiter):e.slice();for(var n=0,i=e.length;i>n+1;n++)if("**"===e[n]&&"**"===e[n+1])return;for(var a=this.listenerTree,s=e.shift();s;){if(a[s]||(a[s]={}),a=a[s],0===e.length){if(a._listeners){if("function"==typeof a._listeners)a._listeners=[a._listeners,t];else if(r(a._listeners)&&(a._listeners.push(t),!a._listeners.warned)){var l=o;"undefined"!=typeof this._events.maxListeners&&(l=this._events.maxListeners),l>0&&a._listeners.length>l&&(a._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",a._listeners.length),console.trace())}}else a._listeners=t;return!0}s=e.shift()}return!0}var r=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},o=10;n.prototype.delimiter=".",n.prototype.setMaxListeners=function(t){this._events||e.call(this),this._events.maxListeners=t,this._conf||(this._conf={}),this._conf.maxListeners=t},n.prototype.event="",n.prototype.once=function(e,t){return this.many(e,1,t),this},n.prototype.many=function(e,t,n){function i(){0===--t&&a.off(e,i),n.apply(this,arguments)}var a=this;if("function"!=typeof n)throw new Error("many only accepts instances of Function");return i._origin=n,this.on(e,i),a},n.prototype.emit=function(){this._events||e.call(this);var t=arguments[0];if("newListener"===t&&!this.newListener&&!this._events.newListener)return!1;if(this._all){for(var n=arguments.length,a=new Array(n-1),r=1;n>r;r++)a[r-1]=arguments[r];for(r=0,n=this._all.length;n>r;r++)this.event=t,this._all[r].apply(this,a)}if("error"===t&&!(this._all||this._events.error||this.wildcard&&this.listenerTree.error))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");var o;if(this.wildcard){o=[];var s="string"==typeof t?t.split(this.delimiter):t.slice();i.call(this,o,s,this.listenerTree,0)}else o=this._events[t];if("function"==typeof o){if(this.event=t,1===arguments.length)o.call(this);else if(arguments.length>1)switch(arguments.length){case 2:o.call(this,arguments[1]);break;case 3:o.call(this,arguments[1],arguments[2]);break;default:for(var n=arguments.length,a=new Array(n-1),r=1;n>r;r++)a[r-1]=arguments[r];o.apply(this,a)}return!0}if(o){for(var n=arguments.length,a=new Array(n-1),r=1;n>r;r++)a[r-1]=arguments[r];for(var l=o.slice(),r=0,n=l.length;n>r;r++)this.event=t,l[r].apply(this,a);return l.length>0||!!this._all}return!!this._all},n.prototype.on=function(t,n){if("function"==typeof t)return this.onAny(t),this;if("function"!=typeof n)throw new Error("on only accepts instances of Function");if(this._events||e.call(this),this.emit("newListener",t,n),this.wildcard)return a.call(this,t,n),this;if(this._events[t]){if("function"==typeof this._events[t])this._events[t]=[this._events[t],n];else if(r(this._events[t])&&(this._events[t].push(n),!this._events[t].warned)){var i=o;"undefined"!=typeof this._events.maxListeners&&(i=this._events.maxListeners),i>0&&this._events[t].length>i&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),console.trace())
}}else this._events[t]=n;return this},n.prototype.onAny=function(e){if("function"!=typeof e)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),this._all.push(e),this},n.prototype.addListener=n.prototype.on,n.prototype.off=function(e,t){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");var n,a=[];if(this.wildcard){var o="string"==typeof e?e.split(this.delimiter):e.slice();a=i.call(this,null,o,this.listenerTree,0)}else{if(!this._events[e])return this;n=this._events[e],a.push({_listeners:n})}for(var s=0;s<a.length;s++){var l=a[s];if(n=l._listeners,r(n)){for(var d=-1,c=0,u=n.length;u>c;c++)if(n[c]===t||n[c].listener&&n[c].listener===t||n[c]._origin&&n[c]._origin===t){d=c;break}if(0>d)continue;return this.wildcard?l._listeners.splice(d,1):this._events[e].splice(d,1),0===n.length&&(this.wildcard?delete l._listeners:delete this._events[e]),this}(n===t||n.listener&&n.listener===t||n._origin&&n._origin===t)&&(this.wildcard?delete l._listeners:delete this._events[e])}return this},n.prototype.offAny=function(e){var t,n=0,i=0;if(e&&this._all&&this._all.length>0){for(t=this._all,n=0,i=t.length;i>n;n++)if(e===t[n])return t.splice(n,1),this}else this._all=[];return this},n.prototype.removeListener=n.prototype.off,n.prototype.removeAllListeners=function(t){if(0===arguments.length)return!this._events||e.call(this),this;if(this.wildcard)for(var n="string"==typeof t?t.split(this.delimiter):t.slice(),a=i.call(this,null,n,this.listenerTree,0),r=0;r<a.length;r++){var o=a[r];o._listeners=null}else{if(!this._events[t])return this;this._events[t]=null}return this},n.prototype.listeners=function(t){if(this.wildcard){var n=[],a="string"==typeof t?t.split(this.delimiter):t.slice();return i.call(this,n,a,this.listenerTree,0),n}return this._events||e.call(this),this._events[t]||(this._events[t]=[]),r(this._events[t])||(this._events[t]=[this._events[t]]),this._events[t]},n.prototype.listenersAny=function(){return this._all?this._all:[]},"function"==typeof define&&define.amd?define("eventemitter",[],function(){return n}):"object"==typeof exports?exports.EventEmitter2=n:window.EventEmitter2=n}(),define("designer/app/event",["eventemitter"],function(e){var t=e.prototype;return t.events={element:{mouseDown:"elementMouseDown"},builder:{rendered:"builder-rendered"},flyoutClose:"flyoutClose",addNewPage:"addNewPage",refreshLocu:"refreshLocu",cssLoaded:"cssLoaded"},t}),define("userData",["knockout","async!initDataModel"],function(e,t){var n=t.UserData;return n.editMode=function(){switch(this.editingMode){case"UserMode":return"customer";case"ThemeEditMode":return"designer";default:return this.editingMode}},n.isReseller=1!=n.resellerId,n.isPublishingWebsite=e.observable(!1),n}),define("common/ui/dialog",["jquery","knockout","wsbcore","wsbcore/helper","libs/jquery/jqui","wsbcore/dialog"],function(e,t,n,i){function a(e){for(var t=i.isUxCore?"btn-primary":"btn-success",n=0;n<e.length;n++){var a=e[n];a.cancel||(a.enabledClasses||(a.enabledClasses="btn "+t),a.disabledClasses||(a.disabledClasses="btn "+t+" disabled"))}}e.fn.wsbDialog=function(){if(arguments.length){var t=arguments[0];if("object"==typeof t){t.buttons&&a(t.buttons);var i=t.onOpen;t.onOpen=function(a){a.find(".sf-icn").removeClass("sf-icn").addClass("wsb-x"),t.id&&a.attr("id",t.id),setTimeout(function(){a.click().focus();var e=a.find("input:visible,textarea:visible");e.length>0&&e.first().focus()},1),e(document).bind("keydown.dialog",function(e){if(8===e.which){var t=e.srcElement||e.target,n=t.tagName.toUpperCase(),i=t.type&&t.type.toUpperCase();return"INPUT"===n&&("TEXT"===i||"PASSWORD"===i||"URL"===i)||"TEXTAREA"===n||t.getAttribute("contenteditable")||"themeCssAceEditor"===t.getAttribute("id")}});var r=n.util.zIndex.getLayerForElement(a),o=n.util.zIndex.maxForLayer(r)+1;return t.veil&&(o=t.veil.zIndex()+1),a.css("z-index",o),i?i(a):void 0},t.destroyOnClose=t.destroyOnClose!==!1;var r=t.onClose;t.onClose=function(t,n){return e(document).unbind("keydown.dialog"),r?r(t,n):void 0}}"setButtons"===arguments[0]&&arguments[1]&&a(arguments[1])}var o=this.sfDialog.apply(this,arguments);return o},t.bindingHandlers.dialog={init:function(n,i,a,r,o){function s(e,n){t.isObservable(e.isEnabled)&&e.isEnabled.subscribe(function(e){c.wsbDialog(e?"enableButton":"disableButton",n)})}var l=i(),d=!1,c=e(n),u={id:t.utils.unwrapObservable(l.id),title:t.utils.unwrapObservable(l.title),modal:t.utils.unwrapObservable(l.isModal),autoOpen:t.utils.unwrapObservable(l.isOpen),zIndex:t.utils.unwrapObservable(l.zIndex),width:t.utils.unwrapObservable(l.width),autoResize:t.utils.unwrapObservable(l.autoResize),destroyOnClose:t.utils.unwrapObservable(l.destroyOnClose),cancelDisabled:t.utils.unwrapObservable(l.cancelDisabled),draggable:t.utils.unwrapObservable(l.draggable),closeOnEscape:t.utils.unwrapObservable(l.closeOnEscape),buttons:t.utils.unwrapObservable(l.buttons),onOpen:function(){if(!d){d=!0;var e=o.createChildContext(r);t.applyBindingsToDescendants(e,n)}c.wsbDialog("resize"),l.open&&l.open()},onButtonClick:l.buttonClick,onCancel:l.cancel,onClose:function(){u.destroyOnClose&&(c=null),l.isOpen(!1)}};return c.wsbDialog(u),u.buttons&&u.buttons.forEach(s),l.isOpen.subscribe(function(t){t&&null===c&&(c=e(n).wsbDialog(u)),null!==c&&c.wsbDialog(t?"open":"close")}),t.isObservable(l.title)&&l.title.subscribe(function(e){c.wsbDialog({title:e})}),{controlsDescendantBindings:!0}}}}),define("common/alertbox/alertbox",["jquery","/i18n/resources/client","common/ui/dialog"],function(e,t){var n={message:t.resources.Are_you_sure,okCallback:e.noop,title:t.resources.Alert,height:"",width:"",autoResize:!0,okButtonText:t.resources.OK,cancelDisabled:!1,closeOnEscape:!0,veil:void 0,destroyOnClose:void 0,onOkKeepOpen:!1,load:null,onOpen:e.noop,onClose:e.noop,onLoad:e.noop};return{show:function(t){var i=e.extend(!0,n,t||{}),a=e("<div>"+i.message+"</div>");return a.wsbDialog({height:i.height,width:i.width,autoResize:i.autoResize,cancelDisabled:i.cancelDisabled,closeOnEscape:i.closeOnEscape,title:i.title,veil:i.veil,onOkKeepOpen:i.onOkKeepOpen,onOpen:i.onOpen,onClose:i.onClose,load:i.load,onLoad:i.onLoad,destroyOnClose:i.destroyOnClose,buttons:[{id:"btnOK",text:i.okButtonText,onClick:function(){return i.okCallback.apply(),i.onOkKeepOpen||a.wsbDialog("close"),!1}}]}),a}}}),function(){var e=this.window||this;define("common/util/util.window",[],function(){return e})}(),define("common/browser/browser",["common/util/util.window"],function(e){var t=function(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||/(trident).*rv:([\d\.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},n=t(e.navigator.userAgent),i={msie:!1,webkit:!1,opera:!1,mozilla:!1,safari:!1,chrome:!1,isIE7orLower:!1,isIE8orLower:!1,isIE9:!1,OS:e.navigator.platform,window:e};return i.isMacKeyboard=e.navigator&&-1!==String(e.navigator.appVersion).indexOf("Mac"),i.isWindowsKeyboard=!i.isMacKeyboard,"trident"===n.browser&&(n.browser="msie"),n.browser&&(i[n.browser]=!0,i.version=n.version),i.chrome?i.webkit=!0:i.webkit&&(i.safari=!0),i.majorVersion=parseInt(i.version),i.msie&&i.majorVersion<=7&&(i.isIE7orLower=!0),i.msie&&i.majorVersion<=8&&(i.isIE8orLower=!0),i.msie&&9===i.majorVersion&&(i.isIE9=!0),i}),define("common/session/sessionTimeout",["jquery","lodash","userData","/i18n/resources/client","common/alertbox/alertbox","common/browser/browser","wsbcore/session","wsbcore/dialog"],function(e,t,n,i,a,r){function o(){this.options={},this.sessionTimeout=!1,this.sessionExpire=!1}return o.prototype={init:function(i){this.options=t.defaults({},i||{},{idleDuration:18e5,loginUrl:!1,logoutUrl:!1,keepAliveUrl:!1,onExpire:!1,onLogout:!1,uxcore:!1}),this.sessionTimeout=e("#sessionTimeout").sfSession({duration:this.options.idleDuration/1e3,onKeepAlive:this.keepAlive.bind(this,!0),onLogout:this.logout.bind(this)});var a=this.sessionTimeout.sfDialog("getButtons"),r=a[0],o=this.options.uxcore?"btn-primary":"btn-success";r.enabledClasses="btn "+o,r.disabledClasses="btn "+o+" disabled",this.sessionTimeout.sfDialog("setButtons",a);var s=n.millisecondsUntilAuthTimeout;this.sessionExpire=setTimeout(this.expire.bind(this),s>0?s:0)},keepAlive:function(t){this.sessionTimeout&&this.sessionTimeout.sfSession("reset"),t===!0&&this.options.keepAliveUrl&&e.ajax({url:this.options.keepAliveUrl,cache:!1}).always(this.keepAlive.bind(this,!1))},timeout:function(){this.sessionTimeout&&this.sessionTimeout.sfSession("timeout")},expire:function(){this.sessionTimeout&&this.sessionTimeout.sfSession("destroy"),this.sessionExpire&&clearTimeout(this.sessionExpire),t.isFunction(this.options.onExpire)?this.options.onExpire(this.onExpire.bind(this)):this.onExpire()},logout:function(){this.sessionExpire&&clearTimeout(this.sessionExpire),t.isFunction(this.options.onLogout)?this.options.onLogout(this.onLogout.bind(this)):this.onLogout()},login:function(){this.options.loginUrl?r.window.location=this.options.loginUrl:r.window.location.reload(!0)},onExpire:function(){a.show({title:i.resources.Logged_Out_Title,message:'<div style="padding: 15px;">'+i.resources.Logged_Out_Desc+"</div>",okButtonText:i.resources.Log_In,cancelDisabled:!0,closeOnEscape:!1,okCallback:this.logout.bind(this)})},onLogout:function(){this.options.logoutUrl?r.window.location=this.options.logoutUrl:r.window.location.reload(!0)}},new o}),define("common/util/stringHelper",[],function(){function e(e){var t={},n=e.indexOf("?");return-1!==n&&e.replace(/(^.*\?)|(#.*$)/g,"").split("&").map(function(e){return e.split("=")}).forEach(function(e){t[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}),t}function t(e){var t="http",n="",i={};0===e.indexOf("https")&&(t="https");var a=e.split("?");if(a.length>0&&(n=a[0].replace(/https:\/\//,""),n=n.replace(/http:\/\//,""),n=n.replace(/\/\//,"")),a.length>1)for(var r=a[1].split("&"),o=0;o<r.length;o++){var s=r[o].split("=");"undefined"==typeof i[s[0]]&&(i[s[0]]=s[1])}return{schema:t,path:n,query:i}}function n(e,t){var n="";if(t||(n+=e.schema+":"),n+="//"+e.path,Object.keys(e.query).length>0){n+="?";var i=[];for(var a in e.query)null!=e.query[a]&&i.push(a+"="+e.query[a]);n+=i.join("&")}return n}function i(e){return String(e).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function a(e){return String(e).replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">")}function r(e,t){return"undefined"==typeof t&&(t=!1),e?(e=$.trim(e),e&&l.test(e)?!0:!1):!t}function o(e,t){return"undefined"==typeof t&&(t=!1),e?(e=$.trim(e),e&&d.test(e)?!0:!1):!t}function s(e){if(!e)return{};var t=e.split(".");return 2===t.length?{domain:t[0],tld:t[1],domainAndTld:e}:t.length>2?{sub:t.slice(0,t.length-2).join("."),domain:t[t.length-2],tld:t[t.length-1],domainAndTld:t[t.length-2]+"."+t[t.length-1]}:{}}var l=/^([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.?)+$/i,d=/^(www\.)?([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}$/i;return String.prototype.format=function(){var e,t,n=this;for(e=0;e<arguments.length;e++)t="{"+e+"}",n=n.replace(t,arguments[e]);return n},String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)},{getDomainParts:s,getUrl:t,getUrlString:n,parseQueryString:e,htmlEncode:i,htmlDecode:a,validateSubDomain:r,validateExternalDomain:o}}),define("abTestingData",["async!initDataModel"],function(e){return e.AbTestingData}),define("common/abTesting/abTesting",["jquery","common/util/stringHelper","abTestingData"],function(e,t,n){var i=t.parseQueryString(location.href),a=/^ab-/;for(var r in i)a.test(r)&&(n[r.substr(3)]={SelectedOption:i[r]});var o=function(e,t){var i=n[e];return i&&i.SelectedOption?i.SelectedOption:t},s=function(e,t){var i=n[e];return i&&i.SelectedOption?i:t},l=function(e){return c(e,"enabled")},d=function(e){return c(e,"disabled")},c=function(e,t){return o(e)===t};return{getOption:o,getOptionAllData:s,isEnabled:l,isDisabled:d,isOptionSet:c}}),define("common/cookiemanager/cookiemanager",["common/util/util.window"],function(e){function t(e){if(a.cookie.length>0){var t=a.cookie.indexOf(e+"=");if(-1!==t){t=t+e.length+1;var n=a.cookie.indexOf(";",t);return-1===n&&(n=a.cookie.length),unescape(a.cookie.substring(t,n))}}return""}function n(e,t,n){var i=new Date;n&&i.setDate(i.getDate()+n);var r=e+"="+escape(t)+((null===n||"undefined"==typeof n?"":"; expires="+i.toUTCString())+"; path=/");a.cookie=r}function i(e){n(e,"",-1)}var a=e.document;return{getCookie:t,setCookie:n,eraseCookie:i}}),define("designer/app/builder/data/grandfatherConfig",[],function(){function e(e,t){var n={};return n.hasGrandFatheredAccess=function(n){var i=e.grandFatherDates;if(!i||!i[n])return!0;var a=new Date(Date.parse(t.CreateDate)),r=new Date(Date.parse(i[n]));return r>=a},n.isAccountType=function(e){var n=t&&t.Account&&t.Account.AccountType,i=t.accountTypes&&t.accountTypes[e];return n&&i&&n===i},n.canPublishMobile=function(){return!n.isAccountType("personal")||n.hasGrandFatheredAccess("mobilePublishForPersonal")},n}return{getConfig:e}}),define("websiteInfo",["jquery","knockout","async!initDataModel"],function(e,t,n){function i(t){e.ajax({url:"/api/websites/"+r.websiteId+"/WebsiteAccount",type:"get",success:function(e){a.Account=o.Account=e,o.ko.numberOfAllowedPages(parseInt(e.NumberOfAllowedPages,10)),o.ko.isSslCertificateInstalled(e.IsSslCertificateInstalled),"function"==typeof t&&t(e)}})}var a=n.WebsiteInfo,r=n.UserData,o={Account:a.Account,DomainName:a.DomainName,HomePageId:a.HomePageId,TemplateId:a.TemplateId,refresh:i,accountTypes:{personal:10,smallBusiness:20,unlimited:30},CreateDate:a.CreateDate};return o.ko={},o.ko.isSslCertificateInstalled=t.observable(a.Account.IsSslCertificateInstalled),o.ko.numberOfAllowedPages=t.observable(parseInt(a.Account.NumberOfAllowedPages,10)),o.ko.numberOfWebsitePages=t.observable(a.NumberOfWebsitePages),o.ko.accountType=t.observable(a.Account.AccountType),o.ko.domain=t.observable(a.Account.Domain),o.ko.domainToPublish=t.observable(a.Account.Domain),o.ko.showUpgrade=t.computed(function(){return o.ko.accountType()!==o.accountTypes.unlimited}),o.ko.isPublishing=t.observable(!1),o.ko.publishDomainOption=t.observable(),o.ko.printPageUsage=t.computed(function(){var e=o.ko.numberOfWebsitePages().toString(),t=o.ko.numberOfAllowedPages();return t&&999>t&&(e+="/"+t),e}),o}),define("appconfig",["lodash","async!initDataModel","designer/app/builder/data/grandfatherConfig","websiteInfo"],function(e,t,n,i){var a=t.AppConfig;return a=e.assign(a,n.getConfig(a,i))}),define("common/logger/logger",["appconfig","common/util/util.window"],function(e,t){for(var n,i,a=t.console=t.console||{},r=e.showConsoleLogs,o={},s=function(){},l="memory".split(","),d="assert,clear,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profileEnd,table,time,timeEnd,timeStamp,trace,warn".split(",");n=l.pop();)a[n]=a[n]||o;for(;i=d.pop();)a[i]=r?a[i]||s:s;return t.console}),define("common/util/util.synced",["lodash","common/cookiemanager/cookiemanager","common/abTesting/abTesting","common/logger/logger"],function(e,t,n,i){function a(){this.website=new r("websiteProviderC"),this.pages=new r("pageProviderC"),this.elements=new r("elementProviderC"),this.pagesAndElements=new o(this.pages,this.elements),this.parseCookie()}function r(e){this.synced=!1,this.provider=n.getOption.bind(n,e)}function o(){this.synced=!1,this.providers=Array.prototype.slice.call(arguments)}var s="wsb_sync",l="mixed",d="api";return a.prototype={parseCookie:function(){var e=t.getCookie(s);if(!e||!e.length)return this.reset();var n=e.split("|"),i=n.length;if(!i||i%2!==0)return this.reset();for(var a=0;i>a;a+=2){var r=n[a],o="1"===n[a+1];switch(r){case"w":this.website.synced!==o&&this.logChange("website",o),this.website.synced=o;break;case"p":this.pages.synced!==o&&this.logChange("pages",o),this.pages.synced=o;break;case"e":this.elements.synced!==o&&this.logChange("elements",o),this.elements.synced=o}}return this},reset:function(){return this.website.synced=!1,this.pages.synced=!1,this.elements.synced=!1,this.pagesAndElements.synced=!1,this},logChange:function(e,t){t||i.log(e+" is now "+(t?"synced":"out of sync"))}},r.prototype={writeToDotNet:function(){var e=this.provider();return e!==d},writeToApi:function(){this.provider();return!this.writeToDotNet()},readFromDotNet:function(){this.provider();return this.writeToDotNet()},readFromApi:function(){var e=this.provider();return e===d||this.synced&&e===l}},o.prototype={writeToDotNet:function(){return e.every(this.providers,function(e){return e.writeToDotNet()})},writeToApi:function(){return e.every(this.providers,function(e){return e.writeToApi()})},readFromDotNet:function(){return e.every(this.providers,function(e){return e.readFromDotNet()})},readFromApi:function(){return e.every(this.providers,function(e){return e.readFromApi()})}},new a}),define("common/persistence/persistence",["jquery","common/session/sessionTimeout","userData","/i18n/resources/client","common/abTesting/abTesting","common/util/util.synced","common/browser/browser"],function(e,t,n,i,a,r,o){function s(e,t){var a=e.indexOf("?")>0?"&":"?";return e=e.replace("{websiteId}",n.websiteId).replace("{editingMode}",n.editingMode),/\blocale=/.test(e)||(e=e+a+"locale="+i.locale),t||(a=e.indexOf("?")>0?"&":"?",e+=a+"nocache="+Math.random()),e}function l(e){var t=!1;return"string"!=typeof e&&(t=!!e.suppressTooBusyGrowl,e=e.path),{path:e,suppressTooBusyGrowl:t}}function d(){y=[]}function c(){return y}function u(n,i,a,o,d,c,u){t.keepAlive(!1);var p=l(n);d="undefined"!=typeof d&&d===!1?!1:!0,c=c||{},b({path:p.path,type:"POST"});var g={url:s(p.path),type:"POST",async:d,contentType:"application/json; charset=utf-8",data:JSON.stringify(i),headers:c};return u&&(g.timeout=u),e.ajax(g).done(function(t,n,i){r.parseCookie(),e.isFunction(a)&&a(t,n,i)}).fail(function(e,t,n){r.parseCookie(),f(e,t,n,o,p)})}function p(n,i,a,o){t.keepAlive(!1);var d=l(n);return b({path:d.path,type:"PUT"}),e.ajax({url:s(d.path),type:"PUT",contentType:"application/json; charset=utf-8",data:JSON.stringify(i)}).done(function(t,n,i){r.parseCookie(),e.isFunction(a)&&a(t,n,i)}).fail(function(e,t,n){r.parseCookie(),f(e,t,n,o,d)})}function g(n,i,a,o){i&&"function"==typeof i&&(o=a,a=i,i=void 0),t.keepAlive(!1);var d=l(n);return b({path:d.path,type:"DELETE"}),e.ajax({url:s(d.path),type:"DELETE",contentType:i&&"application/json; charset=utf-8",data:i&&JSON.stringify(i)}).done(function(t,n,i){r.parseCookie(),e.isFunction(a)&&a(t,n,i)}).fail(function(e,t,n){r.parseCookie(),f(e,t,n,o,d)})}function h(n,i,a,o,d){t.keepAlive(!1),o="undefined"!=typeof o&&o===!1?!1:!0;var c=l(n);return b({path:c.path,type:"GET"}),e.ajax({url:s(c.path,d),cache:d,async:o}).done(function(e,t,n){r.parseCookie(),v(e,t,n,i)}).fail(function(e,t,n){r.parseCookie(),f(e,t,n,a,c)})}function m(e){var t=[];if(arguments.length>1)for(var n=1;n<arguments.length;n++)t.push(arguments[n]);return function(){e(t)}}function b(e){var t="/api/websites/{websiteId}/logger";e&&e.path&&e.path!=t&&"enabled"===a.getOption("apiCallLogging")&&(e.version="builder",y.push({details:e,level:3}))}var f=function(t,n,a,r,s){try{if(429===t.status)return s.suppressTooBusyGrowl||e("<div></div>").sfGrowl({title:i.resources.Client__Designer__Whoa_slow_down,content:i.resources.Client__Designer__Youre_going_to_hurt_yourself.format('<a class="wsb-support-link" href="/help/support" target="_blank">',"</a>"),icon:"warning",fadetime:3e3}),void(e.isFunction(r)&&r("toobusy",t,n,a));var l;try{l=JSON.parse(t.responseText)}catch(d){l={},l.ExceptionMessage=t.responseText}l.status=t.status;var c=l.ExceptionMessage,u={path:s.path,isSuccessful:!1,errorMessage:c,error:l,type:n&&n.type};if(401===t.status||"InvalidSession"===c)return b(u),e(o.window).unbind("beforeunload"),o.window.UnloadingPage=!0,void(o.window.location="/home/logout");e.isFunction(r)&&r(l,t,n,a),b(u)}catch(p){b({path:s.path,exception:p,isSuccessful:!1,type:n&&n.type}),e.isFunction(r)&&r.apply(null,Array.prototype.slice.call(arguments,0,arguments.length-1))}},v=function(t,n,i,a){null!==i.getResponseHeader("InvalidSession")?location.reload():e.isFunction(a)&&a(t,n,i)},y=[];return{Post:u,Get:h,Put:p,Delete:g,CallBackWithParams:m,getLogBuffer:c,resetLogBuffer:d}}),define("designer/app/builder/data/dataUtil",["lodash","knockout"],function(e,t){function n(i){var a=["string","number","boolean"];if(-1!=a.indexOf(typeof i)||null===i||void 0===i)return t.observable(i);if(i instanceof Array){var r=e.map(i,function(e){return n(e)});return t.observableArray(r)}if(i instanceof Function)return i;for(var o in i)i[o]=n(i[o]);return i}return{observablize:n}}),define("websiteSettings",["async!initDataModel","designer/app/builder/data/dataUtil"],function(e,t){function n(e,n){return n.forEach(function(n){void 0!==e[n]&&(e[n]=t.observablize(e[n]))}),e}var i=["FaviconSmallUrl","FaviconMediumUrl","MobileEnabled","EnableAddThisSmartLayer","HeaderTags","BodyTags","DpsSubdomain"];return n(e.WebsiteSettings,i)}),define("common/logger/serverLogger",["common/persistence/persistence","userData","websiteSettings","websiteInfo","appconfig","common/abTesting/abTesting","common/cookiemanager/cookiemanager"],function(e,t,n,i,a,r,o){function l(e,t){if(f){f=!1;var n={action:e};t&&(n.details=t);var i,a=o.getCookie("navigatedToDesignerAt")||0,r=m.builderLoad.totalTime;if(v){i=a-window.performance.timing.navigationStart,0>i&&(i=0),r-=i,r=0>r?0:r,o.eraseCookie("navigatedToDesignerAt"),n.delta=new Date-window.performance.timing.navigationStart-i,n.timers={};for(var s in window.performance.timing)n.timers[s]=window.performance.timing[s]-window.performance.timing.navigationStart}S({firstClick:n,userPercievedLoadTime:r},g.Information)}}function d(e){var t,n={},i=void 0;for(var a in e){try{i=e[a],t=typeof i}catch(r){}"object"!=t&&"function"!=t&&(n[a]=i)}return n}function c(){return b}function u(){var e={version:"builder",navigator:d(navigator),screen:d(screen),history:d(history),userData:d(t),websiteSettings:d(n),websiteInfo:d(i),abTestingInfo:{menuStyle:r.getOption("actionMenuStyle")},referrer:document.referrer,clientDate:new Date};return window.performance&&window.performance.memory&&(e.performance=d(window.performance.memory)),e}function p(e){if(window.performance&&window.performance.memory&&"enabled"===r.getOption("traceClientMemory")){var t={};t[e]=window.performance.memory,S(t,g.Information)}}var g={Exception:0,Error:1,Warning:2,Information:3},h={},m={},b=!1,f=!0,v=window.performance&&window.performance.timing&&window.performance.timing.navigationStart,y=[],_="/api/websites/{websiteId}/logger",w=function(){var t=y.concat(e.getLogBuffer());e.resetLogBuffer(),y=[];var n=u();t.length>0&&e.Post({path:_,suppressTooBusyGrowl:!0},{clientData:n,logData:t})},S=function(e,t,n,i){if("disabled"!==r.getOption("clientSideLogging")||n===!0){var a={details:e,level:t};y.push(a),i&&w()}},k=function(e){if(e===b&&(b=!1),!isNaN(h[e])){var t={},n=(new Date).getTime()-h[e];t[e]=m[e],t[e].totalTime=n,S(t,g.Information)}},x=function(e){if(b=e,v){h[e]=window.performance.timing.navigationStart;var t=window.performance.timing.responseStart-window.performance.timing.navigationStart;m[e]={responseStart:{totalTime:t,delta:t}}}else h[e]=(new Date).getTime(),m[e]={}},C=function(e,t){if(!isNaN(h[t])){var n=new Date,i=t?n.getTime()-h[t]:null,a=0;for(s in m[t]){var r=m[t][s].totalTime;a=Math.max(r,a)}var o=i-a;m[t][e]={totalTime:i,delta:o}}};return window.onerror=function(){window.console&&window.console.error&&window.console.error.apply(window.console,arguments);var e={text:arguments[0].substring(0,254),file:arguments[1],line:arguments[2],column:arguments[3],stack:arguments[4]&&arguments[4].stack||"n/a"};return S(e,g.Exception),!1},setInterval(w,a.logInterval),{post:S,level:g,startPerformanceTimers:x,postPerformance:k,triggerTrace:C,postMemoryUsage:p,getCurrentBeacon:c,logFirstClick:l,beacons:{builderLoad:{name:"builderLoad",steps:{initApp:"initApp",loadBuilder:"loadBuilder",createCanvasViewModel:"createCanvasViewModel",bindCanvasViewModel:"bindCanvasViewModel",renderBuilder:"renderBuilder"}},controlPanelLoad:{name:"controlPanelLoad",steps:{pageLoaded:"pageLoaded"}},themePageLoad:{name:"themePageLoad",steps:{pageLoaded:"pageLoaded",allThemesLoaded:"allThemesLoaded"}},switchToPreview:{name:"builderSwitchToPreview",steps:{switchToPreviewStart:"builderSwitchToPreviewStart",switchToPreviewEnd:"builderSwitchToPreviewEnd"}},changePage:{name:"builderChangePage",steps:{changePageStart:"builderChangePageStart",changePageEnd:"builderChangePageEnd"}},publish:{name:"builderPublish",steps:{publishStart:"builderPublishStart",publishEnd:"builderPublishEnd"}}}}}),define("designer/app/logo",["jquery","userData"],function(e,t){return{setLogo:function(){var n=e("#app-logo");n.toggleClass("app-header-logo",!t.isReseller),t.isReseller?n.hide():n.show()}}}),define("designer/app/app",["jquery","lodash","designer/app/event","common/logger/serverLogger","designer/app/logo"],function(e,t,n,i,a){function r(e,t){var n=u(location.pathname,location.search);void 0===p&&(p=n.app);var i=n.app!=p||void 0==h[p].app;i?(g.controlContainer.hide(),g.headerContainer.hide(),s(),p=n.app,g.loading.show(),o(),d(n,e,t)):(l(),h[p].app.navigateToAddressBarState(n.parts,n.args))}function o(){g.headerBar.attr("class","clearfix wsb-undo-select").attr("style",""),a.setLogo()}function s(){if(g.apps[p].detach(),g.apps[p]){for(var e in g.controls[p])g.controls[p][e].detach();for(var t in g.headers[p])g.headers[p][t].detach();for(var n in g.head[p])g.head[p][n].detach()}}function l(){var e=g.apps[p].appendTo(g.appContainer);if(g.apps[p]){for(var t in g.controls[p])g.controls[p][t].appendTo(g.controlContainer);for(var n in g.headers[p])g.headers[p][n].appendTo(g.headerContainer);for(var i in g.head[p])g.head[p][i].appendTo(g.headContainer)}return e}function d(e,t,a){"builder"===p&&i.startPerformanceTimers(i.beacons.builderLoad.name),require([h[p].module],function(i){var r=l().hide();h[p].app=i,t&&t(),i.load(e.parts,e.args,function(){g.loading.fadeOut("fast"),g.controlContainer.show(),g.headerContainer.show(),r.show(),n.emit(p+"-rendered"),a&&a()})})}function c(t){g={body:t,wsb:t.find("#app"),headerBar:t.find("#app-header"),logo:t.find("#app-logo"),headerContainer:t.find("#app-headers").hide(),headers:{},appContainer:t.find("#app-webapps"),apps:{},controlContainer:t.find("#app-controls").hide(),controls:{},loading:t.find("#app-loading"),libraries:t.find("#app-libraries"),headContainer:e("head"),head:{}}}function u(e,t){for(var n=e.toLowerCase().split("/").slice(1),i=0;i<n.length;i++)if(f.test(n[i])){n=n.slice(i+1);break}var a=n[0].toLowerCase(),r=t.substring(1);return{app:h[a]?a:b,parts:n.slice(1),args:r?JSON.parse('{"'+decodeURI(r).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}'):{}}}var p,g={},h={builder:{module:"designer/app/builder/builder",id:"wa-builder"},menu:{module:"designer/app/menu/menu",id:"wa-menu"},zuberance:{module:"designer/app/zuberance/zuberance",id:"wa-zuberance"}},m=!1,b="builder",f=/wsb7_j_\d{8}_\d{4}_/i,v=function(t,n){c(t);for(var i in h)g.apps[i]=e("<div></div>").attr("id",h[i].id).appendTo(g.appContainer).detach();g.libraries.empty(),g.loading.show(),g.body.show(),g.headerContainer.show(),r(n,function(){y()})},y=function(){require(["modules/notice/notice","designer/app/builder/data/data","designer/app/builder/managers/addressManager","designer/app/builder/ui/controls/toolbox/toolbox"],function(t,n,i,a){function r(n){-1!==o.indexOf(n)?t.animateOut():("freetrial"!==t.getNoticeAction()||"true"!==e.trim(l.settings.DomainAttachFreeTrialRenewed).toLowerCase())&&t.animateIn()}var o=[i.actions.preview,i.actions.social],s="#app-loading, #app-webapps, #builder-toolbox, #builder-preview";t.init({animateOnLoad:!1,animateIn:function(n){var i=t.getHeight();e(s).animate({top:"+="+i},n,function(){a.onResize()})},animateOut:function(n){var i=t.getHeight();e(s).animate({top:"-="+i},n,function(){a.onResize()})},isDesigner:!0});var l=n.getDataModel(),d=l.address;d.currentAction.subscribe(function(e){r(e)}),r(d.currentAction())})},_=function(t,n,i){if(void 0==g.controls[n]&&(g.controls[n]={}),!g.controls[n][i]){var a=t instanceof jQuery?t:e(t);g.controls[n][i]=a.appendTo(g.controlContainer),g.controls[n][i].not("script").attr("id",i)}},w=function(t,n,i){if(void 0==g.headers[n]&&(g.headers[n]={}),!g.headers[n][i]){var a=t instanceof jQuery?t:e(t);g.headers[n][i]=a.attr("id",i).appendTo(g.headerContainer)}},S=function(t,n,i){if(void 0==g.head[n]&&(g.head[n]={}),!g.head[n][i]){var a=t instanceof jQuery?t:e(t);g.head[n][i]=a.attr("id",i).appendTo(g.headContainer)}};return window.wsb={updateAddress:function(e,t,n){if(m)return m=!1;var i=e&&"string"==typeof e;i||(e=""),e.length&&0!=e.indexOf("/")&&(e="/"+e),t=t||p,h[t].path=e;var a=n?"replaceState":"pushState";history[a]({method:a,app:t,path:e},t,"/"+t+e)},gotoAddress:function(e,t,n){return window.wsb.updateAddress(e,t,!1),history.state=!0,r(function(){void 0!==n&&h[t].app.setAppData(n)}),!1}},window.onpopstate=function(e){m=!!e.state,(m||location.pathname.split("/")[1]!==p)&&r()},e(window).resize(function(){n.emit("window-resize")}),{init:v,addControl:_,addHeader:w,addToHeadTag:S,parseAddress:u,currentApp:function(){return p},getConfiguration:function(){return{defaultApp:b,wsbAppsData:h}},getMap:function(){return g}}}),define("designer/app/builder/data/undoer",["lodash","knockout"],function(e,t){function n(){f.push=function(e){f.splice(v(),0,e),v(Math.min(v()+1,f.length))},f.empty=function(){f.length=0}}function i(){return k++}function a(t){return t instanceof Array?e.map(t,function(e){return e}):t}function r(e){if(!e.uid){var t=i();e.uid=t,S[t]=e,e.subscribe(function(e){switch(_){case y.init:case y.disable:return;case y.collect:if(v()<1&&v(1),v()>f.length&&v(f.length),w=f[v()-1],this.uid in w)break;w[this.uid]=a(e);break;case y.single:w={},w[this.uid]=a(e),f.push(w)}},e,"beforeChange")}}function o(){0!=v()&&_!=y.collect&&(v(Math.max(0,v()-1)),u("undoing"),l())}function s(){v()!=f.length&&_!=y.collect&&(u("undoing"),l(),v(Math.min(f.length,v()+1)))}function l(){var e=f[v()];for(var t in e){var n=S[t]();S[t](e[t]),e[t]=n}d("undoing")}function d(t,n){(t===b||n)&&(f[v()-1]&&e.isEmpty(f[v()-1])&&(v(v()-1),f.splice(v(),1)),_=y.single,b=void 0)}function c(){d(null,!0)}function u(e){b||(b=e,_=y.disable)}function p(e){b||(b=e,_!=y.collect&&(f.push({}),_=y.collect))}function g(){return{canUndo:C,canRedo:T,isEnabled:_===y.single,isDisabled:_===y.disable,isCollect:_===y.collect}}function h(){_!==y.init&&(v(0),f.empty(),d())}function m(e){e===b&&(_=y.single,b=void 0,o(),f.splice(v(),1),v.valueHasMutated())}var b,f=[],v=t.observable(0),y={init:0,collect:1,single:2,disable:3},_=y.init,w={},S={},k=0,x={swapForm:"swapForm",addElement:"addElement",mutator:"mutator"},C=t.computed(function(){return v()>0}),T=t.computed(function(){return v()<f.length});return n(),{subscribe:r,undo:o,redo:s,enable:d,forceEnable:c,collect:p,disable:u,getCurrentState:g,reset:h,cancelChanges:m,persistChanges:e.noop,collectChanges:e.noop,keys:function(){return x}}}),define("common/util/util.parseJSON",[],function(){return function(e,t){t="undefined"!=typeof t?t:{};try{return e?JSON.parse(e):t}catch(n){return t}}}),define("common/util/util.requestLogger",["common/abTesting/abTesting"],function(e){var t=[],n="/api/websites/{websiteId}/logger";return{push:function(i){i&&"enabled"===e.getOption("apiCallLogging")&&(i.path&&i.path===n||i.url&&i.url===n||(i.path||i.url)&&t.push(i))},getLogs:function(){return t},resetLogs:function(){t=[]}}}),define("common/persistence/urls",{API:{WEBSITE:"/websites/{websiteId}",PAGE:"/websites/{websiteId}/pages/{pageId}",LOCALE:"/locales",LANGUAGE:"/languages",REGION:"/regions",LOCUCATEGORY:"/categories/locu",THEMECATEGORY:"/categories/theme",BUSINESSCATEGORY:"/categories/business"},ACCOUNT_SWAP:"/api/websites/{websiteId}/accountSwap/",BACKGROUND:"/api/websites/{websiteId}/background",BACKUP:"/api/websites/{websiteId}/backups/{backupId}",BACKUPS:"/api/websites/{websiteId}/backups",BACKUP_RESTORE:"/api/websites/{websiteId}/backups/restore/{backupId}",BUSINESS_CATEGORIES:"/api/businessCategories",BUSINESS_CATEGORY_METRICS:"/api/websites/{websiteId}/businessCategoryMetrics",CLEAN_HTML:"/api/websites/{websiteId}/html/cleanhtml",DESIGNER_PREVIEW:"/Designer/Preview/{mode}",DOMAIN_SETTINGS_DIALOG:"/controlpanel/domainsettingsdialog",FACEBOOK_PAGE:"/api/websites/{websiteId}/facebookpage",FACEBOOK_REMOVE_PERMISSIONS:"/Facebook/RemovePermissions",FACEBOOK_REMOVE_PUBLISH_STREAM_PERMISSION:"/Facebook/RemovePublishStreamPermission",FACEBOOK_GET_CONNECTIVITY_STATE:"/Facebook/GetConnectivityState",FACEBOOK_GET_COVER_IMAGE_OPTIONS:"/Facebook/GetCoverImageOptions",FACEBOOK_GET_FACEBOOK_SETTING_FROM_FACEBOOK:"/Facebook/GetFacebookSettingFromFacebook",FACEBOOK_GET_PAGE_LIST:"/Facebook/GetPageList",FACEBOOK_GET_PERMISSIONS_AND_SETTINGS:"/Facebook/GetPermissionsAndSettings",FACEBOOK_GET_PROFILE_IMAGE_OPTIONS:"/Facebook/GetProfileImageOptions",FACEBOOK_PUBLISH_TO_FACEBOOK:"/Facebook/PublishToFacebook",FACEBOOK_SAVE_MANAGE_PAGE_ID:"/Facebook/SaveManagedPageId",FACEBOOK_SAVE_SETTINGS:"/Facebook/SaveSettings",FACEBOOK_UPDATE_FOR_PUBLISH:"/Facebook/UpdateForPublish",FORM_LABELS:"/api/formLabels",IMPRESSION:"/api/websites/{websiteId}/Impression",IN_APP_UPGRADE_STATUS:"/api/websites/{websiteId}/InAppUpgradeStatus",SESSION_IS_VALID:"/Session/IsValid",LOCALES:"/api/locales/",LOGGER:"/api/websites/{websiteId}/logger",NAPSOC_SETTINGS:"/api/websites/{websiteId}/napsocsettings/",OEMBED:"/api/oembed",PRODUCT_METRICS:"/api/websites/{websiteId}/productmetrics",PUBLISHES:"/api/websites/{websiteId}/publishes/",PUBLISH_STATUS:"/api/websites/{websiteId}/publishstatus/",RAA_VERIFICATION:"/api/websites/{websiteId}/RaaVerification",RETRIEVE_REAL_PAGE_ID:"/api/WebsitePageId/{websiteId}/{pageReferenceId}",SEO_BUSINESS:"/api/websites/{websiteId}/SeoBusiness",SEO_BUSINESS_LOCALE:"/api/websites/{websiteId}/SeoBusinessLocale",SEO_COMPLETION_STATUS:"/api/websites/{websiteId}/SeoCompletionStatus",SEO_FOCUS_KEYWORD:"/api/websites/{websiteId}/SeoFocusKeyword",SEO_KEYWORD_SUGGESTIONS:"/api/websites/{websiteId}/SeoKeywordSuggestions",SEO_KEYWORD_SUGGESTION_MODIFIER:"/api/websites/{websiteId}/SeoKeywordSuggestionModifier",SEO_LOCATION:"/api/websites/{websiteId}/SeoLocation",SEO_LOCATION_SERVICE_AREAS:"/api/websites/{websiteId}/SeoLocationServiceAreas",SEO_PAGE_DESCRIPTION:"/api/websites/{websiteId}/SeoPageDescription",SEO_PAGE_KEYWORDS:"/api/websites/{websiteId}/SeoPageKeywords",SEO_PAGE_TITLE:"/api/websites/{websiteId}/SeoPageTitle",SEO_PAGE_TITLE_MODIFIER:"/api/websites/{websiteId}/SeoPageTitleModifier",SEO_PRIMARY_LOCATION:"/api/websites/{websiteId}/SeoPrimaryLocation",SEO_PROJECT:"/api/websites/{websiteId}/SeoProject",SEO_PROJECT_CATEGORY:"/api/websites/{websiteId}/SeoProjectCategory",SEO_PROJECT_EXIST:"/api/websites/{websiteId}/SeoProjectExist",SEO_PROJECT_PAGE:"/api/websites/{websiteId}/SeoProjectPage",SEO_PROJECT_PAGE_EXIST:"/api/websites/{websiteId}/SeoProjectPageExist",SEO_PROJECT_PAGE_PHRASE:"/api/websites/{websiteId}/SeoProjectPagePhrase",SEO_PROJECT_REPLAY:"/api/websites/{websiteId}/SeoProjectReplay",SEO_PROJECT_RESTORE:"/api/websites/{websiteId}/SeoProjectRestore",SEO_PROJECT_STATUS:"/api/websites/{websiteId}/SeoProjectStatus",SEO_RANKING:"/api/websites/{websiteId}/SeoRanking",SEO_RANKING_HISTORY:"/api/websites/{websiteId}/SeoRankingHistory",SEO_SUGGESTION_MODIFIER:"/api/websites/{websiteId}/SeoKeywordSuggestionModifier",SET_HOMEPAGE:"/api/WebsitePages/SetHomePage/{websiteId}/{pageId}",SEVIMPORTS:"/api/websites/{websiteId}/sevimports",SHOPPER_ACCOUNTS:"/api/websites/{websiteId}/shopperAccounts/",SITEMAP:"/api/websites/{websiteId}/sitemap",STOCK_SOCIAL_MEDIA:"/api/websites/{websiteId}/StockSocialMedia",SUPPORT_URL:"/controlpanel/supporturl",TAG_FILTER:"/api/tag/filter",THEMES_DEV_DATE_BY_LOCALE:"/api/themes/{websiteId}/devDateByLocale",TWITTER_API_SEARCH:"/SocialMediaAuth/TwitterApiSearch/",TWITTER_API_USER_TIMELINE:"/SocialMediaAuth/TwitterApiUserTimeline/",TWITTER_SCREEN_NAME:"/SocialMediaAuth/TwitterScreenName/",TWITTER_VERIFY_SCREEN_NAME:"/SocialMediaAuth/TwitterVerifyScreenName/",UPLOAD_IMAGE_FROM_MODEL:"/api/websites/{websiteId}/websitedocuments/UploadImageFromModel",WEBSITE_BULK_UPDATE:"/api/websites/{websiteId}/websitebulkupdate",WEBSITE_CSS:"/api/websites/{websiteId}/websiteCss",WEBSITE_CUSTOM_FORM:"/api/websites/{websiteId}/CustomForm",WEBSITE_DOCUMENT:"/api/websites/{websiteId}/websitedocuments/{documentId}",WEBSITE_DOCUMENTS:"/api/websites/{websiteId}/websitedocuments",WEBSITE_DOMAIN:"/api/websites/{websiteId}/websitedomain",WEBSITE_FAVICON:"/api/websites/{websiteId}/favicon",WEBSITE_PAGE:"/api/websites/{websiteId}/websitepages/{pageId}",WEBSITE_PAGE_GROUP:"/api/websites/{websiteId}/websitepages/{groupId}",WEBSITE_PAGES:"/api/websites/{websiteId}/websitepages",WEBSITE_PAGE_BULK_UPDATE:"/api/websites/{websiteId}/websitepages/{pageId}/bulkupdate",WEBSITE_PAGE_ELEMENT_PROPERTIES:"/api/websites/{websiteId}/websitepages/{pageId}/websitepageelements/{elementId}/websitepageelementproperties",WEBSITE_PAGE_SETTINGS:"/api/websites/{websiteId}/websitepages/{pageId}/websitepagesettings",WEBSITE_SETTINGS:"/api/websites/{websiteId}/websitesettings",WEBSITE_THUMBNAIL_URLS:"/api/websites/{websiteId}/websitethumbnailurls"}),define("common/persistence/requests/serviceOperations",["common/persistence/urls"],function(e){var t="GET",n="POST",i="PUT",a="DELETE";
return{accountSwap:{create:{type:n,url:e.ACCOUNT_SWAP}},background:{get:{type:t,url:e.BACKGROUND},update:{type:i,url:e.BACKGROUND}},backups:{get:{type:t,url:e.BACKUPS},create:{type:n,url:e.BACKUPS},update:{type:i,url:e.BACKUP},restore:{type:i,url:e.BACKUP_RESTORE},destroy:{type:a,url:e.BACKUP}},businessCategories:{get:{type:t,url:e.BUSINESS_CATEGORIES}},businessCategoryMetrics:{create:{type:n,url:e.BUSINESS_CATEGORY_METRICS}},cleanHTML:{create:{type:n,url:e.CLEAN_HTML}},designer:{preview:{type:t,url:e.DESIGNER_PREVIEW}},domainSettingsDialog:{get:{type:t,url:e.DOMAIN_SETTINGS_DIALOG}},facebook:{getPage:{type:t,url:e.FACEBOOK_PAGE},getConnectivityState:{type:n,data:{},url:e.FACEBOOK_GET_CONNECTIVITY_STATE},getCoverImageOptions:{type:n,data:{},url:e.FACEBOOK_GET_COVER_IMAGE_OPTIONS},getFacebookSettingFromFacebook:{type:n,data:{},url:e.FACEBOOK_GET_FACEBOOK_SETTING_FROM_FACEBOOK},getPageList:{type:n,data:{},url:e.FACEBOOK_GET_PAGE_LIST},getPermissionsAndSettings:{type:n,data:{},url:e.FACEBOOK_GET_PERMISSIONS_AND_SETTINGS},getProfileImageOptions:{type:n,data:{},url:e.FACEBOOK_GET_PROFILE_IMAGE_OPTIONS},publishToFacebook:{type:n,data:{},urls:e.FACEBOOK_PUBLISH_TO_FACEBOOK},removePermissions:{type:n,data:{},url:e.FACEBOOK_REMOVE_PERMISSIONS},removePublishStreamPermission:{type:n,data:{},url:e.FACEBOOK_REMOVE_PUBLISH_STREAM_PERMISSION},saveManagePageId:{type:n,data:{},url:e.FACEBOOK_SAVE_MANAGE_PAGE_ID},saveSettings:{type:n,url:e.FACEBOOK_SAVE_SETTINGS},updateForPublish:{type:n,data:{},url:e.FACEBOOK_UPDATE_FOR_PUBLISH}},favicon:{create:{type:n,url:e.WEBSITE_FAVICON}},formLabels:{get:{type:t,url:e.FORM_LABELS}},impression:{create:{type:n,url:e.IMPRESSION}},inAppUpgradeStatus:{create:{type:n,urls:e.IN_APP_UPGRADE_STATUS}},locales:{get:{type:t,url:e.LOCALES}},logger:{create:{type:n,url:e.LOGGER}},napsocSettings:{update:{type:n,url:e.NAPSOC_SETTINGS}},oembed:{get:{type:t,url:e.OEMBED}},productMetrics:{create:{type:n,url:e.PRODUCT_METRICS}},publishes:{create:{type:n,url:e.PUBLISHES}},publishStatus:{get:{type:t,url:e.PUBLISH_STATUS},create:{type:n,url:e.PUBLISH_STATUS},update:{type:i,url:e.PUBLISH_STATUS}},raaVerification:{get:{type:t,url:e.RAA_VERIFICATION},create:{type:n,url:e.RAA_VERIFICATION}},retrieveRealPageId:{get:{type:t,url:e.RETRIEVE_REAL_PAGE_ID}},seoBusiness:{get:{type:t,url:e.SEO_BUSINESS},create:{type:n,url:e.SEO_BUSINESS}},seoBusinessLocale:{create:{type:n,url:e.SEO_BUSINESS_LOCALE}},seoCompletionStatus:{get:{type:t,url:e.SEO_COMPLETION_STATUS},update:{type:i,url:e.SEO_COMPLETION_STATUS}},seoFocusKeyword:{update:{type:i,url:e.SEO_FOCUS_KEYWORD}},seoKeywordSuggestionModifier:{create:{type:n,url:e.SEO_KEYWORD_SUGGESTION_MODIFIER}},seoKeywordSuggestions:{get:{type:t,url:e.SEO_KEYWORD_SUGGESTIONS}},seoLocation:{update:{type:i,url:e.SEO_LOCATION},destroy:{type:a,url:e.SEO_LOCATION}},seoLocationServiceAreas:{get:{type:t,url:e.SEO_LOCATION_SERVICE_AREAS},create:{type:n,url:e.SEO_LOCATION_SERVICE_AREAS},destroy:{type:a,url:e.SEO_LOCATION_SERVICE_AREAS}},seoPageDescription:{update:{type:i,url:e.SEO_PAGE_DESCRIPTION}},seoPageKeywords:{get:{type:t,url:e.SEO_PAGE_KEYWORDS},create:{type:n,url:e.SEO_PAGE_KEYWORDS}},seoPageTitle:{get:{type:t,url:e.SEO_PAGE_TITLE}},seoPageTitleModifier:{update:{type:i,url:e.SEO_PAGE_TITLE_MODIFIER}},seoPrimaryLocation:{create:{type:n,url:e.SEO_PRIMARY_LOCATION}},seoProject:{create:{type:n,url:e.SEO_PROJECT},update:{type:i,url:e.SEO_PROJECT}},seoProjectCategory:{update:{type:i,url:e.SEO_PROJECT_CATEGORY}},seoProjectExist:{get:{type:t,url:e.SEO_PROJECT_EXIST}},seoProjectPage:{create:{type:n,url:e.SEO_PROJECT_PAGE}},seoProjectPageExist:{get:{type:t,url:e.SEO_PROJECT_PAGE_EXIST}},seoProjectPagePhrase:{update:{type:i,url:e.SEO_PROJECT_PAGE_PHRASE}},seoProjectRestore:{update:{type:i,url:e.SEO_PROJECT_RESTORE}},seoProjectReplay:{create:{type:n,url:e.SEO_PROJECT_REPLAY}},seoProjectStatus:{update:{type:i,url:e.SEO_PROJECT_STATUS}},seoRanking:{get:{type:t,url:e.SEO_RANKING}},seoRankingHistory:{get:{type:t,url:e.SEO_RANKING_HISTORY}},sessionValidity:{get:{type:t,url:e.SESSION_IS_VALID}},setHomePage:{set:{type:n,url:e.SET_HOMEPAGE}},sevimports:{get:{type:t,url:e.SEVIMPORTS},create:{type:n,url:e.SEVIMPORTS}},shopperAccounts:{get:{type:t,url:e.SHOPPER_ACCOUNTS}},sitemap:{get:{type:t,url:e.SITEMAP},update:{type:i,url:e.SITEMAP}},stockSocialMedia:{get:{type:t,url:e.STOCK_SOCIAL_MEDIA},create:{type:n,url:e.STOCK_SOCIAL_MEDIA}},supportUrl:{get:{type:t,url:e.SUPPORT_URL}},tag:{filter:{type:n,url:e.TAG_FILTER}},themes:{devDateByLocale:{type:n,url:e.THEMES_DEV_DATE_BY_LOCALE}},twitterScreenName:{get:{type:t,url:e.TWITTER_SCREEN_NAME},verify:{type:t,url:e.TWITTER_VERIFY_SCREEN_NAME}},twitterApiSearch:{get:{type:t,url:e.TWITTER_API_SEARCH}},twitterApiUserTimeline:{get:{type:t,url:e.TWITTER_API_USER_TIMELINE}},websiteBulkUpdate:{perform:{type:n,url:e.WEBSITE_BULK_UPDATE,query:{editingMode:"{editingMode}"}}},websiteCss:{get:{type:t,url:e.WEBSITE_CSS}},websiteCustomForm:{get:{type:t,url:e.WEBSITE_CUSTOM_FORM},create:{type:n,url:e.WEBSITE_CUSTOM_FORM}},websiteDocuments:{get:{type:t,url:e.WEBSITE_DOCUMENTS},imageUpload:{type:n,url:e.UPLOAD_IMAGE_FROM_MODEL},update:{type:i,url:e.WEBSITE_DOCUMENT},destroy:{type:a,url:e.WEBSITE_DOCUMENTS}},websiteDomain:{create:{type:n,url:e.WEBSITE_DOMAIN}},websitePage:{get:{type:t,url:e.WEBSITE_PAGE},update:{type:i,url:e.WEBSITE_PAGE},destroy:{type:a,url:e.WEBSITE_PAGE},list:{type:t,pageId:"",url:e.WEBSITE_PAGE},create:{type:n,url:e.WEBSITE_PAGE_GROUP},setAsHomePage:{type:n,url:e.SET_HOMEPAGE}},websitePageGroup:{add:{type:n,url:e.WEBSITE_PAGE_GROUP}},websitePageBulkUpdate:{create:{type:n,url:e.WEBSITE_PAGE_BULK_UPDATE}},websitePageElementProperties:{create:{type:n,url:e.WEBSITE_PAGE_ELEMENT_PROPERTIES}},websitePageSettings:{update:{type:n,url:e.WEBSITE_PAGE_SETTINGS},create:{type:n,url:e.WEBSITE_PAGE_SETTINGS}},websiteThumbnailUrls:{create:{type:n,url:e.WEBSITE_THUMBNAIL_URLS}},websiteSettings:{create:{type:n,url:e.WEBSITE_SETTINGS}}}}),define("common/persistence/formatData",["userData","lodash"],function(e,t){return function(n){n&&t.isPlainObject(n)&&t.each(n,function(t,i){i in e&&t=="{"+i+"}"&&(n[i]=e[i])})}}),define("common/persistence/setupPath",["jquery","common/persistence/formatData","/i18n/resources/client","lodash","userData"],function(e,t,n,i,a){return function(r){var o=r.url,s=o.indexOf("?")>-1?"&":"?";r.query&&(t(r.query),o+=s+(i.isString(r.query)?r.query:e.param(r.query)),s="&"),o=o.replace(/\{(\w+)\}/g,function(e,t){return t in r?r[t]:t in a?a[t]:e}),/\blocale=/.test(o)||(o+=s+"locale="+n.locale,s="&"),r.cache||(o+=s+"nocache="+Math.random()),r.url=o}}),define("common/persistence/requests/serviceRequests",["/i18n/resources/client","jquery","userData","lodash","common/session/sessionTimeout","common/util/util.synced","common/util/util.requestLogger","common/persistence/requests/serviceOperations","common/persistence/setupPath","common/persistence/formatData"],function(e,t,n,i,a,r,o,s,l,d){function c(n,i,a,r){try{if(429===n.status)return r.suppressTooBusyGrowl||t("<div></div>").sfGrowl({title:e.resources.Client__Designer__Whoa_slow_down,content:e.resources.Client__Designer__Youre_going_to_hurt_yourself.format('<a class="wsb-support-link" href="/help/support" target="_blank">',"</a>"),icon:"warning",fadetime:3e3}),"toobusy";var o=JSON.parse(n.responseText),s=o.ExceptionMessage,l={path:r.url,isSuccessful:!1,errorMessage:s,error:o,type:i.type};return"InvalidSession"===s?(p(l),t(window).unbind("beforeunload"),window.UnloadingPage=!0,window.location.reload(),s):(p(l),!0)}catch(d){return p({path:r.url,exception:d,isSuccessful:!1,type:i.type}),d}}function u(e,t,n){null!==n.getResponseHeader("InvalidSession")&&window.location.reload()}function p(e){e.version="builder",o.push({details:e,level:3})}function g(e){return a.keepAlive(!1),e.data&&(d(e.data),e.contentType="application/json; charset=utf-8",e.data=JSON.stringify(e.data)),l(e),p({path:e.url,type:e.type}),t.Deferred(function(n){t.ajax(e).done(function(t,i,a){r.parseCookie(),u(t,i,a,e),n.resolve(t,i,a)}).fail(function(t,i,a){r.parseCookie(),n.reject(t,i,a,c(t,i,a,e))})}).promise()}var h={};return i.each(s,function(e,t){h[t]={},i.each(e,function(e,n){h[t][n]=function(t){return g(i.merge({},e,t))}})}),h}),define("common/api/api-proxy",["common/util/util.window","jquery","lodash","appconfig"],function(e,t,n,i){function a(){return(new Date).valueOf().toString(36)+Math.random().toString(36).replace("0.","")}function r(){return h.baseUrl=h.appconfig&&h.appconfig.apiBaseUrl.replace(/^(https?\:\/\/[^\/]+)(.*)$/,"$1")||"invalid:config"}function o(e){if(e.origin!==h.baseUrl)return 0;if("load"===e.data)return h.proxyReady(e.source),1;if("{"===e.data[0]){var t;try{t=JSON.parse(e.data)}catch(n){t={}}switch(t.type){case"ajax-response":return h.processAjaxResponse(t),2}}return h._window.console.log("Invalid API Message: "+e.origin+" > "+e.data),-1}function s(){g.enabled=!!(h.appconfig&&"true"===h.appconfig.forceApiProxy||h._window&&h._window.navigator&&(h._window.navigator.userAgent||"").indexOf("MSIE 9.")>=0),g.enabled&&(h.getBaseUrl(),h._window.addEventListener("message",h.windowMessageReceived,!1),h.proxyCreateFrame())}function l(){h.$("<iframe></iframe>").attr("id","wsb-api-proxy-frame").attr("src",h.baseUrl+"/pm-proxy").attr("style","margin:0;border:0;padding:0;position:relative;height:0;width:0;overflow:hidden;").appendTo("body")}function d(e){var t={id:h.getId(),type:"ajax",data:e};return h.handlers[t.id]=h.$.Deferred(),h.ready?h.proxyPostToProxyFrame(t):h.queue.push(t),h.handlers[t.id].promise()}function c(e){h.target.postMessage(JSON.stringify(e),h.baseUrl)}function u(e){for(h.target=e,h.ready=!0;h.queue.length;)h.proxyPostToProxyFrame(h.queue.shift())}function p(e){var t=h.handlers[e.id];return t?(delete h.handlers[e.id],e.error?t.reject(e.error.xhr,e.error.statusMessage,e.error.errorType):t.resolve(e.data)):void h._window.console.log("API Message Handler Not Found: "+JSON.stringify(e))}var g,h;return h={ready:!1,loadCalled:!1,queue:[],handlers:{},target:null,_window:e,$:t,_:n,appconfig:i,getId:a,getBaseUrl:r,windowMessageReceived:o,proxyLoad:s,proxyCreateFrame:l,proxySend:d,proxyPostToProxyFrame:c,proxyReady:u,processAjaxResponse:p},g={enabled:!1,getId:function(){return h.getId.apply(this,arguments)},load:function(){return h.loadCalled?void 0:(h.loadCalled=!0,h.proxyLoad.apply(this,arguments))},send:function(e){return g.enabled?h.proxySend(JSON.stringify(e)):null},__pvt__:h}}),define("common/api/apiHelper",["jquery","appconfig","userData","lodash","common/session/sessionTimeout","/i18n/resources/client","common/api/api-proxy","common/logger/serverLogger","common/browser/browser","websiteInfo"],function(e,t,n,i,a,r,o,s,l,d){function c(e){var i=e.baseUrl||t.apiBaseUrl,a=(e.url||"").replace("{orionId}",n.orionUid).replace("{websiteId}",n.websiteId).replace("{domainName}",d.Account.Domain).replace(/\{(\w+)\}/g,function(t,i){return i in n?n[i]:i in e?e[i]:t}),o=a.indexOf("?")>-1?"&":"?";e.url=i+a+o+"lang="+r.locale}function u(e){e=e||{},e.headers=e.headers||{},!e.headers["git-hash"]&&t.apiGitHash&&(e.headers["git-hash"]=t.apiGitHash),e.headers["x-shopper-id"]||(e.headers["x-shopper-id"]=n.shopperId)}function p(t){if(!i.isPlainObject(t))throw new Error("No options specified.");return o.load(),a.keepAlive(!1),u(t),c(t),t.xhrFields=t.xhrFields||{},t.xhrFields.withCredentials=!0,o.enabled?o.send(t):e.ajax(t)}function g(e,t,n){var a=e+(t||"");return i.assign({type:"GET",url:a,gracefulTimeout:!0},n)}function h(e){return e.prototype.uploadFile=b,e}function m(e,t){t=t||{};for(var n in t)t.hasOwnProperty(n)&&e.setRequestHeader(n,t[n])}function b(){var e=this.file;"undefined"!=typeof e&&(this.uploading=!0,this.mod.onUpload([this.file],function(t,n){if(0!=this.uploading){var i=e.xhr=new XMLHttpRequest;e.uploading=!0,this.mod.updateStatus(e);var a=this;i.upload.onprogress=function(e){e.lengthComputable&&a.onProgress(e)},i.onreadystatechange=function(){4==i.readyState&&a.onComplete()},i.open("POST",n,!0);var r=this.mod.options||{};u(r),m(i,r.headers),i.withCredentials=!0;var o=new FormData;o.append(e.name,e),i.send(o)}}))}return e.ajaxPrefilter(function(t,n,a){t.gracefulTimeout&&(t.timeout=2e4),a.fail(function(a,r){t.gracefulTimeout&&"timeout"===r?s.post({xhrOptions:i.omit(n,["headers","gracefulTimeout"]),action:"gracefulTimeout"},s.level.Error):401===a.status&&(e(l.window).unbind("beforeunload"),l.window.UnloadingPage=!0,l.window.location="/home/logout")})}),{ajax:p,getOptions:function(e){return i.wrap(e,g)},onGetUploader:h,setRequestHeaders:m}}),define("common/persistence/requests/apiRequests",["jquery","lodash","common/persistence/urls","common/persistence/formatData","common/api/apiHelper","/i18n/resources/client"],function(e,t,n,i,a,r){function o(n){if(n.data&&(i(n.data),n.contentType="application/json; charset=utf-8",n.data=JSON.stringify(n.data)),n.query){i(n.query);var a=n.url.indexOf("?")>-1?"&":"?";n.url+=a+(t.isString(n.query)?n.query:e.param(n.query))}return n}var s="GET",l={website:{get:{type:s,url:n.API.WEBSITE}},page:{get:{type:s,url:n.API.PAGE,query:{expand:1,shared:1}},list:{type:s,pageId:"",url:n.API.PAGE}},locale:{list:{type:s,url:n.API.LOCALE,query:{isDisplayed:!0,localeId:r.locale}}},language:{list:{type:s,url:n.API.LANGUAGE,query:{localeId:r.locale}}},region:{list:{type:s,url:n.API.REGION,query:{localeId:r.locale}}},locuCategory:{list:{type:s,url:n.API.LOCUCATEGORY,query:{localeId:r.locale}}},themeCategory:{list:{type:s,url:n.API.THEMECATEGORY,query:{localeId:r.locale}}},businessCategory:{list:{type:s,url:n.API.BUSINESSCATEGORY,query:{localeId:r.locale}}}},d={};return t.each(l,function(e,n){d[n]=d[n]||{},t.each(e,function(e,i){d[n][i]=function(n){return n=o(t.defaults({},n,e,{gracefulTimeout:!0})),a.ajax(n)}})}),d}),define("common/persistence/requests/overrideRequests",["lodash","jquery","common/util/util.parseJSON","common/util/util.synced","common/persistence/requests/serviceRequests","common/persistence/requests/apiRequests"],function(e,t,n,i,a,r){function o(e,t,n,i,a){return s(e,t,i,a)||l(t,n)}function s(e,t,n,i){if(e.readFromDotNet()){var a=n(i);return t&&a.done(function(){t.resolve.apply(t,arguments)}).fail(function(){t.reject.apply(t,arguments)}),a}}function l(e,n){return e?(e.reject.apply(e,n),e):t.Deferred(function(e){e.reject(new Error("unable to find a result for the requested resource"))}).promise()}function d(n,i,a,r,s){return s=s||function(e){return e},function(l){var d=e.cloneDeep(l);return n.readFromApi()?t.Deferred(function(e){a(s(d)).done(function(t,a,s){return t?r(t,e,s,d,l):void o(n,e,[s,d,new Error("No returned data.")],i,l)}).fail(function(){return o(n,e,arguments,i,l)})}).promise():o(n,null,[],i,l)}}function c(e){return e=e||"",e.substr(0,1).toUpperCase()+e.substr(1)}function u(e,t,n){e[c(n)]=t}function p(t){var n=t.properties||{},i=t.options||{};return g(n),{Id:t.id,ElementType:t.type,CreateDate:t.createDate,ElementTypeData:null,GroupId:null,ExtendedProperties:e.transform(e.merge({Shared:!!t.isShared},n,i),u)}}function g(e){"string"==typeof e.groupID&&(e.groupID=parseInt(e.groupID,0),isNaN(e.groupID)&&delete e.groupID)}function h(t){var i=t.properties||{},a=t.options||{},r=a.isHomepage||!1;return delete a.isHomepage,{Id:t.id,WebsiteId:t.websiteId,WebsitePageTypeId:"Standard",PageName:t.name,Name:t.name,PageTitle:t.title,PageKeywords:t.keywords,PageDescription:t.description,PageFilename:t.fileName,CreateDate:t.createDate,Settings:e.merge({},m,e.transform(e.merge(i,a,n(t.localizedPropertiesJson)),u)),Elements:e.map(t.expandedElements,p),IsHomePage:r,CanPageBePublished:a.canPageBePublished||!1,IsCopy:a.isCopy||i.copyPageId>0,CopyPageId:i.copyPageId,ExternalReferenceKeyPublish:i.externalReferenceKeyPublish,ExternalReferenceKeyRender:i.externalReferenceKeyRender}}var m={Background:"",Height:"",Style:"",Width:""},b={websitePage:{list:d(i.pagesAndElements,a.websitePage.list,r.page.list,function(t,n){n.resolve(e.map(t,h))}),get:d(i.pagesAndElements,a.websitePage.get,r.page.get,function(e,t){t.resolve(h(e))})},background:{get:d(i.website,a.background.get,r.website.get,function(e,t,r,s,l){if(!e.properties)return void o(i.website,t,[s,r,new Error("No properties on the returned data.")],a.background.get,l);var d=e.properties;t.resolve({BackgroundAlign:d.backgroundAlign,BackgroundColor:d.backgroundColor,BackgroundDocumentId:d.backgroundDocumentId,BackgroundGradient:d.backgroundGradient,BackgroundImage:d.backgroundImage,BackgroundRepeat:d.backgroundRepeat,BackgroundScrolling:d.backgroundScrolling,LocalizedProperties:n(e.localizedPropertiesJson,{})})})}};return b}),define("common/persistence/request",["lodash","common/persistence/requests/overrideRequests","common/persistence/requests/serviceRequests","common/persistence/requests/apiRequests"],function(e,t,n,i){var a=e.cloneDeep(n);return e.each(t,function(t,n){a[n]=a[n]||{},e.each(t,function(e,t){a[n][t]=e})}),a.api=i,a}),function(){function e(e){var n=!1;return function(){if(n)throw new Error("Callback was already called.");n=!0,e.apply(t,arguments)}}var t,n,i={};t=this,null!=t&&(n=t.async),i.noConflict=function(){return t.async=n,i};var a=function(e,t){if(e.forEach)return e.forEach(t);for(var n=0;n<e.length;n+=1)t(e[n],n,e)},r=function(e,t){if(e.map)return e.map(t);var n=[];return a(e,function(e,i,a){n.push(t(e,i,a))}),n},o=function(e,t,n){return e.reduce?e.reduce(t,n):(a(e,function(e,i,a){n=t(n,e,i,a)}),n)},s=function(e){if(Object.keys)return Object.keys(e);var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t};"undefined"!=typeof process&&process.nextTick?(i.nextTick=process.nextTick,i.setImmediate="undefined"!=typeof setImmediate?setImmediate:i.nextTick):"function"==typeof setImmediate?(i.nextTick=function(e){setImmediate(e)},i.setImmediate=i.nextTick):(i.nextTick=function(e){setTimeout(e,0)},i.setImmediate=i.nextTick),i.each=function(t,n,i){if(i=i||function(){},!t.length)return i();var r=0;a(t,function(a){n(a,e(function(e){e?(i(e),i=function(){}):(r+=1,r>=t.length&&i(null))}))})},i.forEach=i.each,i.eachSeries=function(e,t,n){if(n=n||function(){},!e.length)return n();var i=0,a=function(){t(e[i],function(t){t?(n(t),n=function(){}):(i+=1,i>=e.length?n(null):a())})};a()},i.forEachSeries=i.eachSeries,i.eachLimit=function(e,t,n,i){var a=l(t);a.apply(null,[e,n,i])},i.forEachLimit=i.eachLimit;var l=function(e){return function(t,n,i){if(i=i||function(){},!t.length||0>=e)return i();var a=0,r=0,o=0;!function s(){if(a>=t.length)return i();for(;e>o&&r<t.length;)r+=1,o+=1,n(t[r-1],function(e){e?(i(e),i=function(){}):(a+=1,o-=1,a>=t.length?i():s())})}()}},d=function(e){return function(){var t=Array.prototype.slice.call(arguments);return e.apply(null,[i.each].concat(t))}},c=function(e,t){return function(){var n=Array.prototype.slice.call(arguments);return t.apply(null,[l(e)].concat(n))}},u=function(e){return function(){var t=Array.prototype.slice.call(arguments);return e.apply(null,[i.eachSeries].concat(t))}},p=function(e,t,n,i){var a=[];t=r(t,function(e,t){return{index:t,value:e}}),e(t,function(e,t){n(e.value,function(n,i){a[e.index]=i,t(n)})},function(e){i(e,a)})};i.map=d(p),i.mapSeries=u(p),i.mapLimit=function(e,t,n,i){return g(t)(e,n,i)};var g=function(e){return c(e,p)};i.reduce=function(e,t,n,a){i.eachSeries(e,function(e,i){n(t,e,function(e,n){t=n,i(e)})},function(e){a(e,t)})},i.inject=i.reduce,i.foldl=i.reduce,i.reduceRight=function(e,t,n,a){var o=r(e,function(e){return e}).reverse();i.reduce(o,t,n,a)},i.foldr=i.reduceRight;var h=function(e,t,n,i){var a=[];t=r(t,function(e,t){return{index:t,value:e}}),e(t,function(e,t){n(e.value,function(n){n&&a.push(e),t()})},function(){i(r(a.sort(function(e,t){return e.index-t.index}),function(e){return e.value}))})};i.filter=d(h),i.filterSeries=u(h),i.select=i.filter,i.selectSeries=i.filterSeries;var m=function(e,t,n,i){var a=[];t=r(t,function(e,t){return{index:t,value:e}}),e(t,function(e,t){n(e.value,function(n){n||a.push(e),t()})},function(){i(r(a.sort(function(e,t){return e.index-t.index}),function(e){return e.value}))})};i.reject=d(m),i.rejectSeries=u(m);var b=function(e,t,n,i){e(t,function(e,t){n(e,function(n){n?(i(e),i=function(){}):t()})},function(){i()})};i.detect=d(b),i.detectSeries=u(b),i.some=function(e,t,n){i.each(e,function(e,i){t(e,function(e){e&&(n(!0),n=function(){}),i()})},function(){n(!1)})},i.any=i.some,i.every=function(e,t,n){i.each(e,function(e,i){t(e,function(e){e||(n(!1),n=function(){}),i()})},function(){n(!0)})},i.all=i.every,i.sortBy=function(e,t,n){i.map(e,function(e,n){t(e,function(t,i){t?n(t):n(null,{value:e,criteria:i})})},function(e,t){if(e)return n(e);var i=function(e,t){var n=e.criteria,i=t.criteria;return i>n?-1:n>i?1:0};n(null,r(t.sort(i),function(e){return e.value}))})},i.auto=function(e,t){t=t||function(){};var n=s(e);if(!n.length)return t(null);var r={},l=[],d=function(e){l.unshift(e)},c=function(e){for(var t=0;t<l.length;t+=1)if(l[t]===e)return void l.splice(t,1)},u=function(){a(l.slice(0),function(e){e()})};d(function(){s(r).length===n.length&&(t(null,r),t=function(){})}),a(n,function(n){var l=e[n]instanceof Function?[e[n]]:e[n],p=function(e){var o=Array.prototype.slice.call(arguments,1);if(o.length<=1&&(o=o[0]),e){var l={};a(s(r),function(e){l[e]=r[e]}),l[n]=o,t(e,l),t=function(){}}else r[n]=o,i.setImmediate(u)},g=l.slice(0,Math.abs(l.length-1))||[],h=function(){return o(g,function(e,t){return e&&r.hasOwnProperty(t)},!0)&&!r.hasOwnProperty(n)};if(h())l[l.length-1](p,r);else{var m=function(){h()&&(c(m),l[l.length-1](p,r))};d(m)}})},i.waterfall=function(e,t){if(t=t||function(){},e.constructor!==Array){var n=new Error("First argument to waterfall must be an array of functions");return t(n)}if(!e.length)return t();var a=function(e){return function(n){if(n)t.apply(null,arguments),t=function(){};else{var r=Array.prototype.slice.call(arguments,1),o=e.next();r.push(o?a(o):t),i.setImmediate(function(){e.apply(null,r)})}}};a(i.iterator(e))()};var f=function(e,t,n){if(n=n||function(){},t.constructor===Array)e.map(t,function(e,t){e&&e(function(e){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),t.call(null,e,n)})},n);else{var i={};e.each(s(t),function(e,n){t[e](function(t){var a=Array.prototype.slice.call(arguments,1);a.length<=1&&(a=a[0]),i[e]=a,n(t)})},function(e){n(e,i)})}};i.parallel=function(e,t){f({map:i.map,each:i.each},e,t)},i.parallelLimit=function(e,t,n){f({map:g(t),each:l(t)},e,n)},i.series=function(e,t){if(t=t||function(){},e.constructor===Array)i.mapSeries(e,function(e,t){e&&e(function(e){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),t.call(null,e,n)})},t);else{var n={};i.eachSeries(s(e),function(t,i){e[t](function(e){var a=Array.prototype.slice.call(arguments,1);a.length<=1&&(a=a[0]),n[t]=a,i(e)})},function(e){t(e,n)})}},i.iterator=function(e){var t=function(n){var i=function(){return e.length&&e[n].apply(null,arguments),i.next()};return i.next=function(){return n<e.length-1?t(n+1):null},i};return t(0)},i.apply=function(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t.concat(Array.prototype.slice.call(arguments)))}};var v=function(e,t,n,i){var a=[];e(t,function(e,t){n(e,function(e,n){a=a.concat(n||[]),t(e)})},function(e){i(e,a)})};i.concat=d(v),i.concatSeries=u(v),i.whilst=function(e,t,n){e()?t(function(a){return a?n(a):void i.whilst(e,t,n)}):n()},i.doWhilst=function(e,t,n){e(function(a){return a?n(a):void(t()?i.doWhilst(e,t,n):n())})},i.until=function(e,t,n){e()?n():t(function(a){return a?n(a):void i.until(e,t,n)})},i.doUntil=function(e,t,n){e(function(a){return a?n(a):void(t()?n():i.doUntil(e,t,n))})},i.queue=function(t,n){function r(e,t,r,o){t.constructor!==Array&&(t=[t]),a(t,function(t){var a={data:t,callback:"function"==typeof o?o:null};r?e.tasks.unshift(a):e.tasks.push(a),e.saturated&&e.tasks.length===n&&e.saturated(),i.setImmediate(e.process)})}void 0===n&&(n=1);var o=0,s={tasks:[],concurrency:n,saturated:null,empty:null,drain:null,push:function(e,t){r(s,e,!1,t)},unshift:function(e,t){r(s,e,!0,t)},process:function(){if(o<s.concurrency&&s.tasks.length){var n=s.tasks.shift();s.empty&&0===s.tasks.length&&s.empty(),o+=1;var i=function(){o-=1,n.callback&&n.callback.apply(n,arguments),s.drain&&s.tasks.length+o===0&&s.drain(),s.process()},a=e(i);t(n.data,a)}},length:function(){return s.tasks.length},running:function(){return o}};return s},i.cargo=function(e,t){var n=!1,o=[],s={tasks:o,payload:t,saturated:null,empty:null,drain:null,push:function(e,n){e.constructor!==Array&&(e=[e]),a(e,function(e){o.push({data:e,callback:"function"==typeof n?n:null}),s.saturated&&o.length===t&&s.saturated()}),i.setImmediate(s.process)},process:function l(){if(!n){if(0===o.length)return void(s.drain&&s.drain());var i="number"==typeof t?o.splice(0,t):o.splice(0),d=r(i,function(e){return e.data});s.empty&&s.empty(),n=!0,e(d,function(){n=!1;var e=arguments;a(i,function(t){t.callback&&t.callback.apply(null,e)}),l()})}},length:function(){return o.length},running:function(){return n}};return s};var y=function(e){return function(t){var n=Array.prototype.slice.call(arguments,1);t.apply(null,n.concat([function(t){var n=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(t?console.error&&console.error(t):console[e]&&a(n,function(t){console[e](t)}))}]))}};i.log=y("log"),i.dir=y("dir"),i.memoize=function(e,t){var n={},i={};t=t||function(e){return e};var a=function(){var a=Array.prototype.slice.call(arguments),r=a.pop(),o=t.apply(null,a);o in n?r.apply(null,n[o]):o in i?i[o].push(r):(i[o]=[r],e.apply(null,a.concat([function(){n[o]=arguments;var e=i[o];delete i[o];for(var t=0,a=e.length;a>t;t++)e[t].apply(null,arguments)}])))};return a.memo=n,a.unmemoized=e,a},i.unmemoize=function(e){return function(){return(e.unmemoized||e).apply(null,arguments)}},i.times=function(e,t,n){for(var a=[],r=0;e>r;r++)a.push(r);return i.map(a,t,n)},i.timesSeries=function(e,t,n){for(var a=[],r=0;e>r;r++)a.push(r);return i.mapSeries(a,t,n)},i.compose=function(){var e=Array.prototype.reverse.call(arguments);return function(){var t=this,n=Array.prototype.slice.call(arguments),a=n.pop();i.reduce(e,n,function(e,n,i){n.apply(t,e.concat([function(){var e=arguments[0],t=Array.prototype.slice.call(arguments,1);i(e,t)}]))},function(e,n){a.apply(t,[e].concat(n))})}};var _=function(e,t){var n=function(){var n=this,i=Array.prototype.slice.call(arguments),a=i.pop();return e(t,function(e,t){e.apply(n,i.concat([t]))},a)};if(arguments.length>2){var i=Array.prototype.slice.call(arguments,2);return n.apply(this,i)}return n};i.applyEach=d(_),i.applyEachSeries=u(_),i.forever=function(e,t){function n(i){if(i){if(t)return t(i);throw i}e(n)}n()},"undefined"!=typeof define&&define.amd?define("libs/async-util/async",[],function(){return i}):"object"==typeof module&&module.exports?module.exports=i:t.async=i}(),define("designer/app/builder/data/resync",["lodash","jquery","knockout","common/persistence/request","designer/app/builder/data/undoer","libs/async-util/async","common/abTesting/abTesting","/i18n/resources/client","common/logger/serverLogger"],function(e,t,n,i,a,r,o,s,l){function d(e,t,n,i){g=e,h=t,m=n,b=i}function c(t){i.websitePage.list().then(function(n){var i,r=e.transform(n.WebsitePages,function(e,t){return e[t.Id]=!0,t.IsHomePage&&(i=t.Id),e},{}),o=e.transform(g.website.pages(),function(e,t){t.Id()==i&&t.IsHomePage(!0),t.Id()in r||(e.push(t.Id()),t.isDeleted(!0),g.address.currentPage()==t.Id()&&(g.address.currentPage(i),a.reset()),l.post({resyncMessage:"resynced page "+t.Id()},l.level.Information))},[]);t(null,o)}).fail(function(e){t(e)})}function u(t,n){var a=e.difference(g.website.fullLoadedPageIds,t),o={};r.each(a,function(t,n){i.websitePage.get({pageId:t}).then(function(t){e.extend(o,e.transform(t.Elements,function(e,t){e[t.Id]=!0},{})),n()}).fail(function(e){n(e)})},function(i){if(i)l.post({resyncMessage:i},l.level.Error);else for(var a in h)if(!(a in o))if(a&&"number"!=typeof a){var r=m();b(a,r),h[r].isDeleted.valueHasMutated(),l.post({resyncMessage:"resynced element "+a},l.level.Information)}else!h[a].properties.Shared()&&e.contains(t,h[a].pageIds()[0])&&(h[a].isDeleted(!0),l.post({resyncMessage:"resynced element "+a},l.level.Information));n(i)})}function p(e){r.waterfall([c,u],function(t){e(t)})}var g,h,m,b;return{load:d,resync:p}}),define("common/i18n/localizableProperty",["knockout"],function(e){function t(t){var n=t.masterPropertyName||t.propertyName,r=t.localizedPropertyName||t.propertyName,o=t.masterProperties,s=t.localizedProperties,l=t.locale;return e.computed({read:function(){var t=e.utils.unwrapObservable(l);if(t){var i=e.utils.unwrapObservable(s)||{},a=e.utils.unwrapObservable(i[t])||{};if(r in a)return e.utils.unwrapObservable(a[r]);if(-1!==t.indexOf("-")){var d=t.replace(/-.*$/,""),c=e.utils.unwrapObservable(i[d])||{};if(r in c)return e.utils.unwrapObservable(c[r])}}return e.utils.unwrapObservable(o[n])},write:function(t){var d=e.utils.unwrapObservable(l);if(d){s.valueWillMutate();var c=e.utils.unwrapObservable(s);c||(c={},s(c));var u=e.utils.unwrapObservable(c[d]);u||(u={},c[d]=u),e.isObservable(u[r])?u[r](t):u[r]=t,a[d]||(a[d]=!0,i.modifiedLocales.push(d)),s.valueHasMutated()}else o[n](t)}})}function n(){i.modifiedLocales=[],a={}}var i=t;i.modifiedLocales=[],i.clearModifiedLocales=n;var a={};return i}),define("common/api/api.guid",[],function(){function e(){for(var e=new Array(16),t=0,n=0;16>t;t++)0===(3&t)&&(n=4294967296*Math.random()),e[t]=n>>>((3&t)<<3)&255;e[6]=15&e[6]|64,e[8]=63&e[8]|128;var i=0;return g[e[i++]]+g[e[i++]]+g[e[i++]]+g[e[i++]]+"-"+g[e[i++]]+g[e[i++]]+"-"+g[e[i++]]+g[e[i++]]+"-"+g[e[i++]]+g[e[i++]]+"-"+g[e[i++]]+g[e[i++]]+g[e[i++]]+g[e[i++]]+g[e[i++]]+g[e[i++]]}function t(e){return String(e).replace(u,"")}function n(e){var n=t(e);return n.substr(0,8)+"-"+n.substr(8,4)+"-"+n.substr(12,4)+"-"+n.substr(16,4)+"-"+n.substr(20,12)}function i(e){var t=n(e);return t===d}function a(e){return c.test(e)}function r(e){return a(e)&&!i(e)}function o(e){if(r(e)){var t=e.match(p);if(t&&2===t.length)return parseInt(t[1],10)}return 0}function s(e){if(r(e)){var t=e.match(p);if(t&&2===t.length)return parseInt(t[1],10).toString()}return e}function l(e){return e=parseInt(e||0,10),isNaN(e)||0>=e?d:(e+="",e=("000000000000"+e).substring(e.length),"00000000-0000-0000-0000-"+e)}for(var d="00000000-0000-0000-0000-000000000000",c=/^{?[0-9a-f]{8}-?[0-9a-f]{4}-?[0-9a-f]{4}-?[0-9a-f]{4}-?[0-9a-f]{12}}?$/i,u=/[ -]/g,p=/^{?0{8}-?0{4}-?0{4}-?0{4}-?(\d{12})$/,g=new Array(256),h=0;256>h;h++)g[h]=(h+256).toString(16).substr(1);return{v4:e,isEmpty:i,isValid:a,isValidAndNotEmpty:r,toLong:o,toLegacyIdString:s,toUuid:l,removeHyphens:t,addHyphens:n}}),define("designer/app/builder/data/saver",["lodash","jquery","knockout","appconfig","common/persistence/request","designer/app/builder/data/undoer","designer/app/builder/data/resync","libs/async-util/async","common/abTesting/abTesting","/i18n/resources/client","common/i18n/localizableProperty","common/logger/serverLogger","common/api/api.guid","common/browser/browser"],function(e,t,n,i,a,r,o,s,l,d,c,u,p,g){function h(e){var t=!1;try{(!e.message||e.message&&-1===e.message.indexOf("toobusy"))&&(500==e.status&&(t=!0),lt(),u.post({action:"savePageData",isGrowl:!0,errorMessage:"Error in forming save object: "+JSON.stringify(e)},u.level.error))}catch(n){}return t}function m(e,n){K=e,K.website.elements().forEach(function(e){ot[e.id()]=e}),o.load(e,ot,P,w),setInterval(function(){try{G()!==$.enable||at.retrySave||S()}catch(e){u.post({action:"master Save cycle failed",isGrowl:!0,errorMessage:"Master Save cycle failed: "+JSON.stringify(error)},u.level.error)}},tt),M=t("#sel-log"),t.isFunction(n)&&n()}function b(){for(var e in Z){var t=Z[e];t.originalValue=y(t())}Z={},st(!1)}function f(e,t){e.originalValue=y(e()),e.subscribe(function(){v(e,t);for(var n in Y)Y[n]=!0})}function v(e,t){t in L||G()===$.disable||(L[t]=e,st(!0))}function y(t){return t instanceof Array?e.map(t,function(e){return e}):t}function _(e,t,n){try{var n={message:n?n.message:e.statusText,response:e,status:t?t:e.status};return n
}catch(i){return{message:"error"}}}function w(e,t){var n=void 0,i=!1;for(var a in et)if(et[a]==e){et[a]=t,n=ot[a],i=!0;break}i||(et[e]=t,n=ot[e]),n&&(n.id.originalValue=e,n.id(t),M.text(t),ot[t]=n)}function S(n){var i=t.Deferred(),a=function(e,t){e?i.reject(e):i.resolve(t),n&&n(e,t)};if(G()==$.disable)return a(null,null),i.promise();var d=Q?!1:r.getCurrentState().isCollect;return d?(a(null,null),i.promise()):G()===$.saving?(at.retrySave=!0,at.callbacks.push(a),i.promise()):(e.extend(Z,L),L={},0===Object.keys(Z).length?(a(null,null),i.promise()):(G($.saving),J={},s.waterfall([k,x],function(e){function n(){O&&clearTimeout(O),O=setTimeout(function(){S(function(e){if(!e)for(at.retrySave=!1,rt=0;at.callbacks.length;){var n=at.callbacks.shift();t.isFunction(n)&&n(e,J)}})},1e3*rt)}var i=!1;e?(rt=rt>120?120:2*(rt+1),at.retrySave=!0,i=h(e),J.IsSuccess=!1):(b(),rt=0,J.IsSuccess=!0),G($.enable),at.retrySave?(a&&at.callbacks.push(a),i&&"enabled"==l.getOption("saverResync")?o.resync(n):n()):a(e,J)}),i.promise()))}function k(e){s.parallel([dt,mt,ht],function(t){e(t)})}function x(e){s.parallel([ct,ut,pt,gt],function(t){e(t)})}function C(){G()!==$.saving&&G($.enable)}function T(){G()!==$.saving&&G($.disable)}function E(){var e=G();return{state:G,changes:L,isSaving:e==$.saving,isEnable:e==$.enable,isDisable:e==$.disable,isDirty:st()||D(),hasChanges:D(),saveAgainRequest:at,saveWhileCollecting:Q}}function P(){return X--}function D(){return!e.isEmpty(L)||!e.isEmpty(Z)}function I(){return void 0===A&&(A=0,e.each(K.website.groups(),function(e){var t=parseInt(e.groupId());isNaN(t)||(A=Math.max(A,t))})),++A}var A,M,O,L={},N="||",B=/websiteData\|\|elements_((?:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})|(?:\-?\d+))\|\|properties_([a-zA-Z]+)\|\|(\w+)/,F="websiteData||pages",R="siteCss",H="customCss",V=/websiteData\|\|pages_((?:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})|(?:\-?\d+))\|\|isDeleted/,z=/websiteData\|\|pages_((?:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})|(?:\-?\d+))\|\|Settings\|\|(\w+)/,j=/websiteData\|\|pages_((?:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})|(?:\-?\d+))\|\|(?!isDeleted)([a-zA-Z]+)/,U=/websiteData\|\|pages_((?:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})|(?:\-?\d+))\|\|IsHomePage/,W=/websiteData\|\|elements_((?:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})|(?:\-?\d+))\|\|isDeleted/,q="websiteData||backgroundsettings||",$={enable:0,disable:1,saving:2},G=n.observable($.disable),K={},Y={},J={},Z={},X=-1,Q=!1,et={},tt=i.autoSaveTime||2e3,nt=/^-\d+$/,it=[{key:"websiteData||pages||Settings||Width",observable:void 0,pattern:/websiteData\|\|pages_((?:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})|(?:\-?\d+))\|\|Settings\|\|Width/},{key:"websiteData||pages||Settings||Style",observable:void 0,pattern:/websiteData\|\|pages_((?:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})|(?:\-?\d+))\|\|Settings\|\|Style/},{key:"websiteData||pages||Settings||Background",observable:void 0,pattern:/websiteData\|\|pages_((?:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})|(?:\-?\d+))\|\|Settings\|\|Background/}],at={retrySave:!1,callbacks:[]},rt=0,ot={},st=n.observable(!1),lt=function(){t("<div></div>").sfGrowl({title:d.resources.Client__Designer__Yikes_hit_a_snag,content:d.resources.Client__Designer__TryAgainCustomerSupport.format('<a class="wsb-support-link" href="/help/support" target="_blank">',"</a>"),icon:"error"})},dt=function(i){function o(e){if(!e.PageBulkUpdateData)return!1;for(pageId in e.PageBulkUpdateData){var t=e.PageBulkUpdateData[pageId];if(t.DeletedElements.length>0)return!0;if(t.SharedElements.Shared.length>0)return!0;if(t.SharedElements.UnShared.length>0)return!0;for(var n in t.UpsertedElements){if(nt.test((n||"").toString()))return!0;var i=t.UpsertedElements[n];if(!("LocalizedPropertiesJson"in i.ExtendedProperties))return!0}}return!1}function s(e,t,n){return B.test(e)?(e.replace(B,function(e,i,a,r){if("Type"!==r){var o=(i||"").toString();et[o]&&(o=et[o]),p.isValidAndNotEmpty(o)&&!ot[o].isDeleted()&&(et[o]&&p.isValidAndNotEmpty(et[o])&&(o=et[o]),n.AddUpsertedElement(o,a,r,t))}}),!0):!1}function l(e){var t=ot[e];return t&&t.properties&&t.properties.Shared?n.toJS(t.properties.Shared()):!1}function d(e){R in Z&&Z[R].originalValue!==Z[R]()&&e.addCss(Z[R](),"WebsiteCss"),H in Z&&Z[H].originalValue!==Z[H]()&&e.addCss(Z[H](),"ThemeCss")}function u(e){var t,n=[];for(var i in Z)if(W.test(i)){var a=Z[i]();i.replace(W,function(i,r){var o,s=(r||"").toString();a?p.isValidAndNotEmpty(s)&&!et[s]?(t=ot[s],e.AddDeletedElement(s,l(s))):(o=et[s],o&&p.isValidAndNotEmpty(o)&&e.AddDeletedElement(o,l(o))):a||(nt.test(s)&&!et[s]?n.push(s):(o=et[s],nt.test(o)&&n.push(o)))})}return n.length&&n.forEach(function(t){var n=ot[t];n&&e.AddInsertedElement(n)}),!0}function h(){function t(e,t){t.PageBulkUpdateData[e]||(t.PageBulkUpdateData[e]={DeletedElements:[],SharedElements:{Shared:[],UnShared:[]},UpsertedElements:{}})}function i(e){e.ExtendedProperties.GroupID="customform"!==e.ExtendedProperties.Type?0:e.ExtendedProperties.GroupID,"GroupId"in e.ExtendedProperties&&delete e.ExtendedProperties.GroupId;for(var t in K.config.propertiesToSerialize){var i=K.config.propertiesToSerialize[t];i in e.ExtendedProperties&&(e.ExtendedProperties[t]=n.toJSON(e.ExtendedProperties[i]))}return e}this.PageBulkUpdateData={},this.addCss=function(e,n){var i=K.website.pages()[0].Id();t(i,this),this.PageBulkUpdateData[i][n]=e?e:" "},this.AddUpsertedElement=function(e,n,i,a){if("shufflecontainer"!==n.toLowerCase()){var r=ot[e].pageIds()[0];t(r,this),e in this.PageBulkUpdateData[r].UpsertedElements||(this.PageBulkUpdateData[r].UpsertedElements[e]={Id:e,ElementType:n,ExtendedProperties:{Type:n}}),this.PageBulkUpdateData[r].UpsertedElements[e].ExtendedProperties[i]=a}},this.AddInsertedElement=function(e){if("shufflecontainer"!==e.properties.Type().toLowerCase()){var n=(e.id()||"").toString(),i=(e.pageIds()[0]||"").toString();t(i,this),this.PageBulkUpdateData[i]||(PageBulkUpdateData[i]={DeletedElements:[],SharedElements:{Shared:[],UnShared:[]},UpsertedElements:{}});var a={Id:n,ElementType:e.properties.Type(),ExtendedProperties:{}};for(var r in e.properties)a.ExtendedProperties[r]=e.properties[r]();e.properties.Shared()?this.PageBulkUpdateData[i].SharedElements.Shared.push(n):p.isValidAndNotEmpty(n)&&this.PageBulkUpdateData[i].SharedElements.UnShared.push(n),this.PageBulkUpdateData[i].UpsertedElements[n]=a}},this.AddDeletedElement=function(n,i){var a=(ot[n].pageIds()[0]||"").toString();t(a,this),e.contains(this.PageBulkUpdateData[a].DeletedElements,n)||this.PageBulkUpdateData[a].DeletedElements.push(n),i&&this.PageBulkUpdateData[a].SharedElements.UnShared.push(n)},this.create=function(){var e={PageBulkUpdateData:{}};for(var t in this.PageBulkUpdateData){e.PageBulkUpdateData[t]={DeletedElements:this.PageBulkUpdateData[t].DeletedElements,SharedElements:this.PageBulkUpdateData[t].SharedElements,UpsertedElements:[]},void 0!==this.PageBulkUpdateData[t].WebsiteCss&&(e.PageBulkUpdateData[t].WebsiteCss=this.PageBulkUpdateData[t].WebsiteCss),void 0!=this.PageBulkUpdateData[t].ThemeCss&&(e.PageBulkUpdateData[t].ThemeCss=this.PageBulkUpdateData[t].ThemeCss);for(var n in this.PageBulkUpdateData[t].UpsertedElements){var a=i(this.PageBulkUpdateData[t].UpsertedElements[n]);e.PageBulkUpdateData[t].UpsertedElements.push(a),a.ExtendedProperties&&"Shared"in a.ExtendedProperties&&p.isValidAndNotEmpty(a.Id)&&(a.ExtendedProperties.Shared?this.PageBulkUpdateData[t].SharedElements.Shared.push(a.Id):this.PageBulkUpdateData[t].SharedElements.UnShared.push(a.Id))}}return e}}function m(t,n,o){if(n||(n=null),J.UpdatePageElementsResponse=n,n){r.disable();var s=n.InsertedElementIdMapping;if(s&&e.forOwn(s,function(e,t){t in ot&&e&&w(t,e)}),o&&o.PageBulkUpdateData)for(var l in o.PageBulkUpdateData)o.PageBulkUpdateData[l].DeletedElements.forEach(function(e){w(e,P())});r.enable()}K.theme.isThemeEditMode&&a.themes.devDateByLocale({data:{modifiedLocales:f?[]:b,updateMasterTemplate:f}}).then(function(){f=!1}),i(t,"doPageElementUpdates")}var b=[],f=!1;try{var v=new h;u(v),d(v);for(var y in Z){var S=Z[y],k=S();!s(y,k,v)}var x=v.create();if(K.theme.isThemeEditMode&&(f=o(x),c&&c.modifiedLocales&&t.isArray(c.modifiedLocales)&&(b=c.modifiedLocales.slice(),c.clearModifiedLocales())),e.isEmpty(x.PageBulkUpdateData)&&!x.WebsiteCss)return m(null);a.websiteBulkUpdate.perform({data:x}).then(function(e){return m(null,e,x)}).fail(function(e,n,i){return 401===e.status?(t(g.window).unbind("beforeunload"),g.window.UnloadingPage=!0,void(g.window.location="/home/logout")):m(_(e,n,i),null,x)})}catch(C){return m(C,null,null)}},ct=function(e){var t=function(t,n){n||(n=null),J.AddPageResponse=n,e(t,"doAddPage")};try{if(!(F in Z))return t();for(var i=Z[F],r=i().length-1,o=null,l=r;l>=0;l--)if(nt.test(n.unwrap(i()[l].Id)+"")){o=i()[l];break}if(!o)return t();var d={Id:-1,Name:o.Name,PageName:o.PageName,Settings:o.Settings?n.toJS(o.Settings):{},Elements:[]};o.IsCopy&&(d.IsCopy=!0,d.CopyPageId=o.CopyPageId);var c,u=-1;s.series([function(t){a.websitePage.create({data:d,groupId:I()}).then(function(e){u=e.Id,A=void 0,t(null,"addPage")}).fail(function(t,n,i){return e(_(t,n,i),"addPage")})},function(t){a.websitePageSettings.update({pageId:u,data:d.Settings,async:!0}).then(function(){t(null,"updatePageSettings")}).fail(function(t,n,i){return e(_(t,n,i),"updatePageSettings")})},function(t){a.websitePage.get({pageId:u}).then(function(e){c=e,t(null,"getPage")}).fail(function(t,n,i){return e(_(t,n,i),"getPage")})}],function(e){t(e,c)})}catch(p){t(p,null)}},ut=function(e){try{var t;for(key in Z)if(V.test(key)&&Z[key]()){key.replace(V,function(e,n){t=n});break}if(!t||nt.test(t))return e(null,"doDeletePage");a.websitePage.destroy({pageId:t}).then(function(){J.DeletePageResponse=!0,e(null,"doDeletePage")}).fail(function(t,n,i){return e(_(t,n,i),"doDeletePage")})}catch(n){e(n,"doDeletePage")}},pt=function(e){try{var t;for(key in Z)if(j.test(key)&&Z[key]()&&(key.replace(j,function(e,n,i){"IsHomePage"!=i&&(t=(n||"").toString())}),t&&p.isValidAndNotEmpty(t)))break;if(!t||nt.test(t))return e(null,"doUpdatePage");for(var i=K.website.pages(),r=i.length,o=0;r>o;o++){var s=i[o];if(s.Id()==t){var l=n.toJS(s);l.Settings&&delete l.Settings.LocalizedProperties,a.websitePage.update({pageId:t,data:l}).then(function(t){J.UpdatePageResponse=t,e(null,"doUpdatePage")}).fail(function(t,n,i){return e(_(t,n,i),"doUpdatePage")});break}}}catch(d){e(d,"doUpdatePage")}},gt=function(e){try{var t;for(key in Z)if(U.test(key)&&Z[key]()){key.replace(U,function(e,n){t=(n||"").toString()});break}if(!t||nt.test(t))return e(null,"doSetHomePage");a.setHomePage.set({pageId:t}).then(function(){e(null,"doSetHomePage")}).fail(function(t,n,i){return e(_(t,n,i),"doSetHomePage")})}catch(n){e(n,"doSetHomePage")}},ht=function(t){try{var i=[];for(var r in Z)r.replace(z,function(e,t){-1===i.indexOf(t)&&i.push(t)}),i.length>0||e.forEach(it,function(t){if(t.key===r){var n=e.find(K.website.pages(),function(e){return!e.isDeleted()}).Id();return i.push(n),!1}});if(0===i.length)return t(null,"doSavePageSettings");var o=K.website.pages(),l=[];if(i.forEach(function(t){var i=e.find(o,function(e){return e.Id()==t});if(i&&i.Settings){var r=n.toJS(i.Settings);l.push(function(e){a.websitePageSettings.update({pageId:t,data:r,async:!0}).then(function(){e(null)}).fail(function(t,n,i){return e(_(t,n,i))})})}}),0===l.length)return t(null,"doSavePageSettings");s.parallel(l,function(e){t(e,"doSavePageSettings")})}catch(d){t(d,"doSavePageSettings")}},mt=function(e){try{var t=!1;for(var i in Z)if(0==i.indexOf(q)){t=!0;break}if(!t)return e(null,"doBackgroundSettings");var r=n.toJS(K.website.backgroundsettings);if(!r)return e(null,"doBackgroundSettings");a.background.update({data:r}).then(function(){e(null,"doBackgroundSettings")}).fail(function(t,n,i){return e(_(t,n,i),"doBackgroundSettings")})}catch(o){e(o,"doBackgroundSettings")}};return{load:m,keySplitString:N,subscribe:f,save:S,enable:C,disable:T,saveWhileCollecting:function(e){Q=e},getCurrentState:E,getElementsLookup:function(){return ot},generateNewElementId:P,setDirtyFlag:function(e,t){Y[e]=!!t},getDirtyFlag:function(e){return e in Y?Y[e]:!0},hasChanges:D,getNextGroupId:I,pageSettingsObservables:it}}),define("designer/app/builder/managers/addressManager",["knockout","jquery","lodash","common/stats/googleanalytics"],function(e,t,n){function i(e,n){return l=l||new r(e),t.isFunction(n)&&n(),l}function a(){return l}function r(i){function a(e){var a=[e.action||l.currentAction()||d.edit,e.platform||l.currentPlatform()||c.desktop,e.pageId||l.currentPage()||i];a[0]==d.edit&&(a[1]=c.desktop);var r=a.join("/");return e.urlArgs&&!n.isEmpty(e.urlArgs)?r=r+"?"+t.param(e.urlArgs):n.isEmpty(l.urlArgs())||(r=r+"?"+t.param(l.urlArgs())),r}var r,o,s,l=this;this.currentPage=e.observable(),this.currentAction=e.observable(),this.currentPlatform=e.observable(),this.urlArgs=e.observable({}),this.isSocialAction=e.computed(function(){return l.currentAction()==d.social}),this.isPreviewAction=e.computed(function(){return l.currentAction()==d.preview}),this.isSeoAction=e.computed(function(){return l.currentAction()==d.seo}),this.isEditAction=e.computed(function(){return l.currentAction()==d.edit}),this.isSeoWizardAction=e.computed(function(){return l.currentAction()===d.seoWizard}),this.isDesktop=e.computed(function(){return l.currentPlatform()==c.desktop}),this.isMobile=e.computed(function(){return l.currentPlatform()==c.mobile}),this.isDesktopEditAction=e.computed(function(){return l.isEditAction()&&l.isDesktop()}),this.isSocialOrPreviewAction=e.computed(function(){var e=l.isSocialAction(),t=l.isPreviewAction();return e||t}),this.currentPage.subscribe(function(e){e&&window.wsb.updateAddress(a({pageId:e}),null,void 0==r),r=e}),this.currentAction.subscribe(function(e){e&&window.wsb.updateAddress(a({action:e}),null,void 0==o||o===d.seoWizard),o=e}),this.currentAction.subscribe(function(e){l.previousAction=e},null,"beforeChange"),this.currentPlatform.subscribe(function(e){e&&window.wsb.updateAddress(a({platform:e}),null,void 0==s),s=e}),this.urlArgs.subscribe(function(e){e&&window.wsb.updateAddress(a({urlArgs:e}),null)}),this.action=e.observable()}function o(e,t,i){var a=l;a.currentAction(e[0]||d.edit),a.currentPlatform(e[1]||c.desktop),a.currentPage(e[2]||i),n.isEmpty(t)||a.urlArgs(t)}function s(){var e="/"+l.currentAction()+"/"+l.currentPlatform()+"/"+l.currentPage();return n.isEmpty(l.urlArgs())||(e=e+"?"+t.param(l.urlArgs())),e}var l,d={edit:"edit",preview:"preview",addPage:"addpage",publish:"publish",social:"social",seo:"seo",seoWizard:"seowizard"},c={desktop:"desktop",mobile:"mobile"};return{createAddressModel:i,getAddressModel:a,navigateToAddressBarState:o,actions:d,platforms:c,getCurrentPath:s}}),define("napsoc",["knockout","async!initDataModel"],function(e,t){function n(t){var n={};for(var i in t)n[i]=e.observable(void 0===t[i]||null===t[i]?"":t[i]),n[i].subscribe(function(e){t[i]=void 0===e||null===e?"":e});return t.observables=function(){return n},t}var i;return i=n(t.NapsocData.napsoc),i.themeNapsoc=n(t.NapsocData.napsocTheme),i}),define("toolboxData",["async!initDataModel"],function(e){return e.ToolBox}),define("websiteData",["async!initDataModel"],function(e){return e.WebsiteData}),define("libs/knockout/ko.observables",["knockout","jquery"],function(e,t){e.utils.isBound=function(t){return!!e.dataFor(t)},e.utils.confirmAppliedBindings=function(t,n,i,a){i=i||10,a=a||0;var r=null,o=0,s=!1;r=setInterval(function(){o++,s=e.utils.isBound(t),(s||a>0&&o>a)&&(clearInterval(r),"function"==typeof n&&n(s))},i)},e.pauseableComputed=function(t,n){var i,a=e.observable(!1),r=e.observable(0),o=[];return e.computed(function(){return a(r()>0)}),i=e.computed(function(){return a.peek()?(a(),i.peek()):n?t.call(n):t()}),i.pause=function(){return a()||(o.push(i.notifySubscribers),i.notifySubscribers=function(){}),r(r()+1)},i.resume=function(){return i.notifySubscribers=o[0],r(r()-1)},i},e.subscribable.fn.trimmed=function(){return e.computed({read:function(){var e=this();return e&&t.trim(e)},write:function(e){e=t.trim(e),this(e),this.valueHasMutated()},owner:this})}}),define("designer/app/builder/data/data",["jquery","lodash","knockout","designer/app/event","designer/app/builder/data/dataUtil","designer/app/builder/data/undoer","designer/app/builder/data/saver","designer/app/builder/managers/addressManager","appconfig","websiteInfo","napsoc","userData","websiteSettings","toolboxData","websiteData","async!designer/app/builder/data/themeData","libs/knockout/ko.observables"],function(e,t,n,i,a,r,o,s,l,d,c,u,p,g,h,m){function b(t,n,i){x=f(),o.load(x),s.navigateToAddressBarState(n,i,x.website.homePageId()),e.isFunction(t)&&t()}function f(){return x||(x=v()),x}function v(){l.propertiesToSerialize={CarouselAssetsJson:"CarouselAssets",NavItemsJson:"NavItems",GalleryAssetsJson:"GalleryAssets",AudioPlayerAssetsJson:"AudioPlayerAssets",LocalizedPropertiesJson:"LocalizedProperties"};var e=h.fullLoadedPageIds;delete h.fullLoadedPageIds;var t=s.createAddressModel(h.homePageId),n={website:_(h,"websiteData"),napsoc:_(c,"napsoc"),config:l,settings:p,user:u,toolbox:g,info:d,address:t,theme:m};return n.website.fullLoadedPageIds=e,n}function y(e){return t.contains(C,typeof e)||null===e||void 0===e}function _(e,i){var s,d=e;for(var c in e){var u=e[c];if(c in l.propertiesToSerialize&&(delete e[c],c=l.propertiesToSerialize[c],"object"!=typeof u))try{u=JSON.parse(u)}catch(p){u={}}if(s=k(c,e,i),y(u)){var g=void 0;t.forEach(o.pageSettingsObservables,function(e){return e.key===s?(void 0===e.observable?(g=n.observable(u),e.observable=g):g=e.observable,!1):void 0}),void 0===g&&(g=n.observable(u)),w(s)&&(r.subscribe(g),o.subscribe(g,s)),d[c]=g}else if(u instanceof Array){var h=t.map(u,function(e){return("websiteData||elements"===s||"websiteData||pages"==s)&&(e.isDeleted=!1),y(e)?e:_(e,s)}),m=n.observableArray(h);w(s)&&(r.subscribe(m),o.subscribe(m,s)),d[c]=m}else u instanceof Function?d[c]=u:"LocalizedProperties"===c?(d[c]=n.observable(a.observablize(u)),o.subscribe(d[c],s)):d[c]=_(u,s)}return d}function w(e){return"websiteData||elements"==e?!1:"websiteData||fullLoadedPageIds"==e?!1:T.test(e)?!1:E.test(e)?!1:P.test(e)?!1:D.test(e)?!1:!0}function S(e,t){if(!y(e))for(var i in e){var a=e[i],s=k(i,e,t);w(s)&&(n.isObservable(a)?(r.subscribe(a),o.subscribe(a,s)):S(a,s))}}function k(e,i,a){var r="id",s="Type",l="Id";return r in i?a+"_"+n.toJS(i[r])+o.keySplitString+e:l in i?a+"_"+n.toJS(i[l])+o.keySplitString+e:s in i?a+"_"+n.toJS(i[s])+o.keySplitString+e:(a+=o.keySplitString+e,t.forEach(o.pageSettingsObservables,function(e){return e.pattern.test(a)?(a=e.key,!1):void 0}),a)}var x,C=["string","number","boolean"],T=/websiteData\|\|elements_(?:(?:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})|(?:\-?\d+))\|\|properties_([a-z]+)\|\|Type/,E=/websiteData\|\|elements_(?:(?:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})|(?:\-?\d+))\|\|id/,P=/websiteData\|\|pages_(?:(?:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})|(?:\-?\d+))\|\|Id/,D=/websiteData\|\|elements_(?:(?:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})|(?:\-?\d+))\|\|pageIds/;return{getDataModel:f,load:b,observablizeAndSubscribe:_,addSubscriptions:S,undoer:r,saver:o}}),function(){var e=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],t=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,n=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,i="undefined"!=typeof location&&location.href,a=i&&location.protocol&&location.protocol.replace(/\:/,""),r=i&&location.hostname,o=i&&(location.port||void 0),s=[];define("text",[],function(){var l,d,c;return"undefined"!=typeof window&&window.navigator&&window.document?d=function(e,t){var n=l.createXhr();n.open("GET",e,!0),n.onreadystatechange=function(){4===n.readyState&&t(n.responseText)},n.send(null)}:"undefined"!=typeof process&&process.versions&&process.versions.node?(c=require.nodeRequire("fs"),d=function(e,t){var n=c.readFileSync(e,"utf8");0===n.indexOf("﻿")&&(n=n.substring(1)),t(n)}):"undefined"!=typeof Packages&&(d=function(e,t){var n,i,a="utf-8",r=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),s=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(r),a)),l="";try{for(n=new java.lang.StringBuffer,i=s.readLine(),i&&i.length()&&65279===i.charAt(0)&&(i=i.substring(1)),n.append(i);null!==(i=s.readLine());)n.append(o),n.append(i);l=String(n.toString())}finally{s.close()}t(l)}),l={version:"1.0.7",strip:function(e){if(e){e=e.replace(t,"");var i=e.match(n);i&&(e=i[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")},createXhr:function(){var t,n,i;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;for(n=0;3>n;n++){i=e[n];try{t=new ActiveXObject(i)}catch(a){}if(t){e=[i];break}}if(!t)throw new Error("createXhr(): XMLHttpRequest not available");return t},get:d,parseName:function(e){var t=!1,n=e.indexOf("."),i=e.substring(0,n),a=e.substring(n+1,e.length);return n=a.indexOf("!"),-1!==n&&(t=a.substring(n+1,a.length),t="strip"===t,a=a.substring(0,n)),{moduleName:i,ext:a,strip:t}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,t,n,i){var a,r,o,s=l.xdRegExp.exec(e);return s?(a=s[2],r=s[3],r=r.split(":"),o=r[1],r=r[0],!(a&&a!==t||r&&r!==n||(o||r)&&o!==i)):!0},finishLoad:function(e,t,n,i,a){n=t?l.strip(n):n,a.isBuild&&(s[e]=n),i(n)},load:function(e,t,n,s){if(s.isBuild&&!s.inlineText)return void n();var d=l.parseName(e),c=d.moduleName+"."+d.ext,u=t.toUrl(c),p=s&&s.text&&s.text.useXhr||l.useXhr;!i||p(u,a,r,o)?l.get(u,function(t){l.finishLoad(e,d.strip,t,n,s)}):t([c],function(e){l.finishLoad(d.moduleName+"."+d.ext,d.strip,e,n,s)})},write:function(e,t,n){if(t in s){var i=l.jsEscape(s[t]);n.asModule(e+"!"+t,"define(function () { return '"+i+"';});\n")}},writeFile:function(e,t,n,i,a){var r=l.parseName(t),o=r.moduleName+"."+r.ext,s=n.toUrl(r.moduleName+"."+r.ext)+".js";l.load(o,n,function(){var t=function(e){return i(s,e)};t.asModule=function(e,t){return i.asModule(e,s,t)},l.write(e,o,t,a)},a)}}})}(),define("text!designer/app/builder/ui/header/header.html",[],function(){return'<div id="builder-header">\r\n    <div id="header-title"></div>\r\n    <div id="header-themeLocale"></div>\r\n    <div id="header-links"></div>\r\n    <div id="header-hamburger"></div>\r\n    <div id="header-publish"></div>\r\n    <div id="header-preview"></div>\r\n    <div id="header-pageswitcher"></div>\r\n    <div id="header-undoer"></div>\r\n    <div id="header-saver"></div>\r\n</div>\r\n'}),define("libs/jquery/jquery.throttle",["jquery"],function(e){!function(t){"$:nomunge";var n;e.throttle=n=function(n,i,a,r){function o(){function e(){l=+new Date,a.apply(d,u)}function o(){s=t}var d=this,c=+new Date-l,u=arguments;r&&!s&&e(),s&&clearTimeout(s),r===t&&c>n?e():i!==!0&&(s=setTimeout(r?o:e,r===t?n-c:n))}var s,l=0;return"boolean"!=typeof i&&(r=a,a=i,i=t),e.guid&&(o.guid=a.guid=a.guid||e.guid++),o},e.debounce=function(e,i,a){return a===t?n(e,i,!1):n(e,a,i!==!1)}}()}),define("designer/app/builder/managers/elementManager",["knockout","lodash","designer/app/builder/data/data"],function(e,t,n){function i(e,t){for(var n=0;n<e.length;n++){var a=e[n];if(a.groupId().toString()===t.toString())return a;var r=i(a.groups(),t);if(r)return r}}function a(e){return i(N.groups(),e)}function r(e){var n=a(e);return n?t.filter(n.elements(),function(e){return!e.isDeleted()}):[]}function o(e,t){var n=s(e),i=s(t);return(l(n.left,i.left,i.right)||l(n.right,i.left,i.right)||l(i.left,n.left,n.right)||l(i.right,n.left,n.right))&&(l(n.top,i.top,i.bottom)||l(n.bottom,i.top,i.bottom)||l(i.top,n.top,n.bottom)||l(i.bottom,n.top,n.bottom))}function s(e){var t={left:e.pixelLeft(),top:e.pixelTop()};return t.right=t.left+e.outerWidth(),t.bottom=t.top+e.outerHeight(),t}function l(e,t,n){return e>t&&n>e}function d(e){N=e}function c(n){var i=n.Type||"default",r=e.unwrap(n.Shared)||["navigation"].indexOf(i)>-1,o=r?t.map(L.website.pages(),function(e){return e.Id()}):n.pageIds||[L.address.currentPage()],s=n.GroupID||"content",l=a(s),d=e.unwrap(n.Layer)||(l?l.maxZIndex()+1:10),c=n.Top,u=n.Left,p={id:n.Id||R.generateNewElementId(),groupId:s,pageIds:o,isDeleted:!0,properties:{Shared:r,Top:c,Left:u,Type:i,Layer:d}};for(var g in n)if("Id"!==g&&void 0===p.properties[g]&&void 0===p[g]){var h=n[g];p.properties[g]=h}return p}function u(e,n){var i=c(e);return t.isFunction(n)&&(i.callback=n),L.website.elements.push(i),i}function p(n,i,a){var r=t.transform(n,function(e,t){var n;return t.ExtendedProperties?!a&&t.ExtendedProperties.Shared&&g(t)||(n=P(t,i)):!a&&t.Shared&&g(t)||(n=c(t)),n?e.push(n):void 0});return i&&L.website.elements().forEach(function(t){t.properties&&e.unwrap(t.properties.Shared)&&t.pageIds.push(i)}),L.website.elements.push.apply(L.website.elements,r),r}function g(n){var i=e.unwrap(n.Id);return t.any(L.website.elements(),function(t){return e.unwrap(t.id)===i})}function h(e,t,n,i){var a={groupId:i||R.getNextGroupId(),pageIds:e,parentId:t,type:n};return L.website.groups.push(a),a}function m(n,i,r,o,s,l){if(n){if(n.ChildElements)return f(n,r,o,s,l);var d=n.ID(),c=i||n.GroupID(),u=a(c),p=t.filter(L.website.elements(),function(e){return e.id()===d})[0],g=e.toJS(p),h=R.generateNewElementId(),m=20;g.id=h,g.isDeleted=!0,g.pageIds=n.pageIds(),g.isCopy=!0,g.properties=e.toJS(p.properties),g.properties.ID=h,s?(g.properties.Top=s.top+m+"px",g.properties.Left=s.left+m+"px"):(g.properties.Top=n.pixelTop()+m+"px",g.properties.Left=n.pixelLeft()+m+"px"),g.properties.Layer=u.maxZIndex()+1,g.properties.Locked=!1,u.maxZIndex(g.properties.Layer),i&&(g.groupId=i,g.properties.GroupID=i),r&&(g.properties.Shared?g.pageIds.push(r):g.pageIds=[r]),l&&(g.callback=l),L.website.elements.push(g);var b=M(h);return b.selectElement(o),n.hideActionMenu(),b.hidden(!1),b}}function b(e){e.isDeleted(!0),e.hideActionMenu(),e.ChildElements&&t.each(e.ChildElements(),function(e){e.isDeleted(!0)})}function f(e,n,i,r,o){var s=t.map(e.ChildElements(),function(e){return e}),l=(s[0],h(e.pageIds(),e.GroupID(),"form")),d=l.groupId(),c=e.GroupID(),u=a(c),p=t.map(s,function(t){return r&&(r.top=r.top+(t.pixelTop()-e.pixelTop()),r.left=r.left+(t.pixelLeft()-e.pixelLeft())),m(t,d,n,i,r,null)});v(u,p,i,!0,o)}function v(e,t,n,i,a){var r=_(e.groupId(),t),o=e.maxZIndex()+1;if(r.properties.Layer=o,e.maxZIndex(o),a&&(r.callback=a),L.website.elements.push(r),i){var s=M(r.id());s.selectElement(n)}}function y(e){t.each(e,function(e){var n=e.groups();if(0!==n.length){var i=e.groupId(),a=[];t.each(n,function(e){var t=e.elements();0!==t.length&&a.push(_(i,t))}),a.length&&L.website.elements.push.apply(L.website.elements,a),y(n)}})}function _(e,t){var n={groupId:e,id:parseInt(t[0].GroupID()),pageIds:t[0].pageIds(),properties:w(t)};return n}function w(e){var n=e[0],i={Type:"shufflecontainer",Width:0,Height:0,Top:1/0,Left:1/0,Layer:n.Layer(),Shared:n.Shared(),Locked:n.Locked(),IncludeInMobileSite:n.IncludeInMobileSite()};return t.each(e,function(e){i.Width=Math.max(e.pixelWidth(),i.Width),i.Height+=e.pixelHeight(),i.Top=Math.min(e.pixelTop(),i.Top),i.Left=Math.min(e.pixelLeft(),i.Left)}),i.Width+=128,i.Height+=40,i.Width+="px",i.Height+="px",i.Top+="px",i.Left+="px",i}function S(e){for(var t=L.website.elements(),n=t.length-1,i=n;i>=0;i--)if(e==t[i].id())return t[i];return null}function k(){for(var e in H())F()[e].deselectElement()}function x(e){T(1,e)}function C(e){T(-1,e)}function T(e,n){var i=n.GroupID(),a=n.ID(),s=t.filter(r(i),function(e){return e.ID()!==a});if(s.length&&0!==e){var l=L.address.currentPage(),d=t.filter(s,function(e){return e.pageIds().indexOf(l)>-1&&o(n,e)});if(d.length){var c=n.Layer(),u=0>e?-1/0:1/0;t.each(d,function(t){var n=t.Layer();0>e&&c>n&&(u=Math.max(u,n)),e>0&&n>c&&(u=Math.min(u,n))}),isFinite(u)&&(n.Layer(u),t.each(s,function(t){var n=t.Layer();e>0&&u>=n&&t.Layer(Math.max(1,n-1)),0>e&&n>=u&&t.Layer(n+1)}))}}}function E(e,t){if(e.Shared()||e.isNewlyDragged()){var n=e.GroupID(),i="footer",a="content",r=e.pixelTop(),o=r+e.pixelHeight();switch(n){case i:if(o>0)break;e.GroupID(a),e.pixelTop(t+r);break;case a:if(t>o)break;e.GroupID(i),e.pixelTop(r-t)}}}function P(e,t){var n={};return n.id=e.Id,n.elementtypedata=null,n.ElementType=e.ElementType,n.properties=e.ExtendedProperties,n.pageIds=t?[t]:e.pageIds,n.isDeleted=!1,n.groupId=parseInt(n.properties.GroupID,10)?n.properties.GroupID:"footer"==n.properties.Anchor?"footer":"content",n}function D(){var e=L.address.currentPage();return t.filter(L.website.elements(),function(t){return-1!=t.pageIds().indexOf(e)})}function I(e){var n=L.address.currentPage();return t.values(e?t.pick(F(),function(e){return-1!=e.pageIds().indexOf(n)&&!e.isDeleted()}):t.pick(F(),function(e){return-1!=e.pageIds().indexOf(n)}))}function A(){var e=Object.keys(H());return N&&0!=e.length&&null!=S(e[0])?t.transform(e,function(e,t){var n=M(t);return n?e.push(n):void 0}):!1}function M(e){return e in F()?F()[e]:!1}function O(e){L=n.getDataModel(),e(null,"elementManager")}var L,N,B=e.observable({}),F=e.observable({}),R=n.saver,H=e.computed({read:function(){return B()},write:function(e){B(e)},throttle:100});return{load:O,setCanvasViewModel:d,copyElement:m,deleteElement:b,getElement:S,selectedElementIds:H,moveElementUp:x,moveElementDown:C,moveElementToAnotherGroupIfNeedBe:E,deselectAllElements:k,getAllElementsOnCurrentPage:D,getAllElementsByGroupId:r,getSelectedElements:A,getGroupById:a,addNewElementToCanvas:u,addNewElementsToCanvas:p,createNewGroup:h,CreateGroupContainerIfNeeded:y,elViewModelMap:F,getElementViewModel:M,getAllElementViewModelsOnCurrentPage:I,createNewShuffleContainer:v}}),define("designer/app/builder/ui/uiHelper",["jquery","libs/jquery/jquery.throttle","designer/app/event","designer/app/builder/data/data","designer/app/builder/managers/elementManager"],function(e,t,n,i,a){function r(t){var n=i.getDataModel();i.undoer.collect("LockAll");var r=n.website.elements(),o=n.address.currentPage();a.deselectAllElements(),e.each(r,function(n,i){-1==e.inArray(o,i.pageIds())||i.isDeleted()||i.properties.Locked(!!t)}),i.undoer.enable("LockAll")}function o(e){n.emit(n.events.flyoutClose,e)}function s(e){n.emit(n.events.addNewPage,e)}function l(){p=p.detach(),g=!1}function d(t,n,i){var a={x:t.initEvent.pageX,y:t.initEvent.pageY};n=n||e(document),i=i||e("body");var r={x:t.initEvent.pageX,y:t.initEvent.pageY};n.bind("mousemove.wsb",e.throttle(c,function(e){u(!0);var n={x:e.pageX-a.x,y:e.pageY-a.y},i={x:e.pageX-r.x,y:e.pageY-r.y};r.x=e.pageX,r.y=e.pageY;var o=Math.abs(i.x)+Math.abs(i.y);o>0&&t.dragCallback(n,o)})).bind("mouseup.wsb",function(e){return t.useDragCursor&&g&&l(),n.unbind("mousemove.wsb mouseup.wsb"),i.removeClass("wsb-undo-select"),t.finishedCallback&&t.finishedCallback(e),u()&&u(!1),!1})}var c=10,u=ko.observable(!1),p=!1,g=!1;return{setLockStateForAllElementsOnPage:r,closeFlyouts:o,addNewPage:s,captureDrag:d,isDragging:u}}),define("common/api/currencies/currenciesAPI",["common/api/apiHelper"],function(e){function t(t,i){var a=n("/"+t,i);return e.ajax(a)}var n=e.getOptions("/currencies");return{get:t}}),define("common/api/shoppers/shoppersAPI",["lodash","common/api/apiHelper"],function(e,t){function n(e){var n=d(null,e);return t.ajax(n)}function i(e){var n=d("/currency",e);return t.ajax(n)}function a(e){var n=d("/hasExpressCheckoutEnabled",e);return t.ajax(n)}function r(e){var n=d("/expressCheckoutPaymentInfo",e);return t.ajax(n)}function o(e){var n=d("/priceType",e);return t.ajax(n)}function s(e){var n=d("/availabledomains",e);return t.ajax(n)}function l(e){var n=d("/zonefiledomains",e);return t.ajax(n)}var d=t.getOptions("/shoppers/{shopperId}");return{get:n,getExpressCheckoutPaymentInfo:r,getPreferredCurrency:i,getPriceType:o,getHasExpressCheckout:a,getAvailableDomains:s,getZoneFileDomains:l}}),define("data/dataProvider",["userData","websiteSettings","common/abTesting/abTesting","common/api/api.guid"],function(e,t,n,i){function a(e){return o()?!0:"api"===n.getOption(e)
}function r(e){if(o())return{read:!0,failover:!1};var t=n.getOption(e),i=s.test(t);return{read:i,failover:i&&l.test(t)}}function o(){var a=e.websiteId;if(0===i.toLong(a)||t.ApiOnly&&"true"===t.ApiOnly.toLowerCase())return!0;var r=n.getOption("apiPrimary");return"api-all"===r}var s=/api$/,l=/^both-/;return{shouldWriteToApi:a,shouldReadFromApi:r}}),define("common/api/websites/websitesAPI",["jquery","lodash","userData","common/api/apiHelper","common/abTesting/abTesting","common/persistence/persistence","common/stats/googleanalytics","data/dataProvider"],function(e,t,n,i,a,r,o,s){function l(e,n){if(!e)throw new Error("no requestedFeature was given");var a=_("/upgrade",t.assign({data:{requestedFeature:e}},n));return i.ajax(a)}function d(e,n){if(!e.websiteId)throw new Error("websiteId is required");var a=i.getOptions("/websites/actions")("/enableAutorenew",t.assign({type:"POST",data:{websiteId:e.websiteId}},n));return i.ajax(a)}function c(e,n){if(!e.pfid)throw new Error("pfid is required");if(!e.treeId)throw new Error("treeId is required");if(!e.currentPlanName)throw new Error("currentPlanName is required");if(!e.requiredPlanName)throw new Error("requiredPlanName is required");var a=v(e),r=e.expressCheckout?"?expressCheckout=true":"",o=_("/upgrade"+r,t.assign({type:"POST",data:{itemTrackingCode:a,pfid:e.pfid,transactionCurrency:e.transactionCurrency?e.transactionCurrency+"":"",treeId:e.treeId+""}},n));return i.ajax(o)}function u(e){var t=_("/domainInfo",e);return i.ajax(t)}function p(){n.websiteId&&e.post("/api/websites/"+n.websiteId+"/websitedns")}function g(e,t){if(e){var n="SeoProjectReplay";r.Post("/api/websites/{websiteId}/SeoProjectReplay?domain="+e,null,function(){o.trackEvent(t,n,"success")},function(){o.trackEvent(t,n,"failed")})}}function h(e,n){if(!e.tid)throw new Error("tid is required");if(!e.pfid)throw new Error("pfid is required");if(!e.cid)throw new Error("cid is required");if(!e.currentPlanName)throw new Error("currentPlanName is required");if(!e.requiredPlanName)throw new Error("requiredPlanName is required");e.itc=v(e);var a=_("/upgrade/estimate",t.assign({data:t.pick(e,["tid","pfid","cid","itc"])},n));return i.ajax(a)}function m(e){var t=_("/domainoptions",e);return i.ajax(t)}function b(e){var n=_("/websitedomain",t.assign({OrionAccountUid:e.orionId,DomainName:e.domainName},e));return i.ajax(n)}function f(e,n){if(s.shouldWriteToApi("documentProvider")){t.defaults(e,{cropHeight:0,cropWidth:0,cropX:0,cropY:0,scaleHeight:0,scaleWidth:0});var a=t.pick(e,["scaleWidth","scaleHeight","cropX","cropY","cropWidth","cropHeight"]);a=t.transform(a,function(e,t,n){e[n]=parseInt(t,10)});var o=t.assign(_("/documents/"+e.id+"/actions/modify"),{data:a,type:"POST"},n);return i.ajax(o)}return r.Post("/api/websites/{websiteId}/favicon?id="+e.refId)}function v(e){var t=y(e.currentPlanName),n=y(e.requiredPlanName);return"app_wsb_"+t+"to"+n+"_upgrade"}function y(e){return e.replace(/personal/i,"P").replace(/business plus/i,"BP").replace(/business/i,"B")}var _=i.getOptions("/websites/{websiteId}");return{getUpgrade:l,postUpgrade:c,postFreeTrialRenewal:d,getDomainOptions:m,getEstimate:h,publishDomain:b,postDocumentModify:f,getDomainInfo:u,checkDpsDns:p,seoProjectReplay:g}}),define("common/inAppPurchase/inAppPurchaseData",["strings"],function(e){var t={social_branding:{name:"social_branding",stringPrefix:"Social_Branding",image:"http://img3.wsimg.com/wst/images/inAppUpgrade/features/5_connect_social_2.png",requiredPlan:"Business Plus"},ssl:{name:"ssl",stringPrefix:"SSL",image:"http://img3.wsimg.com/wst/images/inAppUpgrade/features/SSL_2.png",requiredPlan:"Business Plus"},aviary:{name:"aviary",stringPrefix:"Aviary",image:"http://img3.wsimg.com/wst/images/inAppUpgrade/features/3_enhance_image_editor_4.png",requiredPlan:"Business"},audio_player:{name:"audio_player",stringPrefix:"Audio_Player",image:"http://img3.wsimg.com/wst/images/inAppUpgrade/features/2_music_player_2.png",requiredPlan:"Business"},mobile:{name:"mobile",stringPrefix:"Mobile",image:"http://img3.wsimg.com/wst/images/inAppUpgrade/features/4_get_mobile_2.png",requiredPlan:"Business"},seo:{name:"seo",stringPrefix:"SEO",image:"http://img3.wsimg.com/wst/images/inAppUpgrade/features/seo_1.png",requiredPlan:"Business Plus"},yelp:{name:"yelp",stringPrefix:"Yelp",image:"http://img3.wsimg.com/wst/images/inAppUpgrade/features/10_yelp_2.png",requiredPlan:"Business"},paypal:{name:"paypal",stringPrefix:"Paypal",image:"http://img3.wsimg.com/wst/images/inAppUpgrade/features/9_paypal_2.png",requiredPlan:"Business"},locu:{name:"locu",stringPrefix:"Locu",image:"http://img3.wsimg.com/wst/images/inAppUpgrade/features/8_locu_3.png",requiredPlan:"Business"},custom_form:{name:"custom_form",stringPrefix:"Custom_Form",image:"http://img3.wsimg.com/wst/images/inAppUpgrade/features/Form_4.png",requiredPlan:"Business"},premium_themes:{name:"premium_themes",stringPrefix:"Premium_Themes",image:"http://img3.wsimg.com/wst/images/inAppUpgrade/features/7_website_themes_2.png",requiredPlan:"Business"},favicon:{name:"favicon",stringPrefix:"Favicon",image:"http://img3.wsimg.com/wst/images/inAppUpgrade/features/Favicon_3.png",requiredPlan:"Business"}},n=[{name:"social_branding",friendlyName:e.Social_Branding_Friendly_Name,requiredPlan:"Business Plus",requiredPlanID:3,comparePlan:['{"Personal":"False", "Business":"False", "Business Plus":"True" }']},{name:"ssl",friendlyName:e.SSL_Friendly_Name,requiredPlan:"Business Plus",requiredPlanID:3,comparePlan:['{"Personal":"False", "Business":"False", "Business Plus":"True" }']},{name:"aviary",friendlyName:e.Aviary_Friendly_Name,requiredPlan:"Business",requiredPlanID:2,comparePlan:['{"Personal":"False", "Business":"True", "Business Plus":"True"}']},{name:"audio_player",friendlyName:e.Audio_Player_Friendly_Name,requiredPlan:"Business",requiredPlanID:2,comparePlan:['{"Personal":"False", "Business":"True", "Business Plus":"True"}']},{name:"mobile",friendlyName:e.Mobile_Friendly_Name,requiredPlan:"Business",requiredPlanID:2,comparePlan:['{"Personal":"False", "Business":"True", "Business Plus":"True"}']},{name:"seo",friendlyName:e.SEO_Friendly_Name,requiredPlan:"Business Plus",requiredPlanID:3,comparePlan:['{"Personal":"False", "Business":"False", "Business Plus":"True"}']},{name:"yelp",friendlyName:e.Yelp_Friendly_Name,requiredPlan:"Business",requiredPlanID:2,comparePlan:['{"Personal":"False", "Business":"True", "Business Plus":"True"}']},{name:"paypal",friendlyName:e.Paypal_Friendly_Name,requiredPlan:"Business",requiredPlanID:2,comparePlan:['{"Personal":"False", "Business":"True", "Business Plus":"True"}']},{name:"locu",friendlyName:e.Locu_Friendly_Name,requiredPlan:"Business",requiredPlanID:2,hideFromResellers:!0,comparePlan:['{"Personal":"False", "Business":"True", "Business Plus":"True"}']},{name:"custom_form",friendlyName:e.Custom_Form_Friendly_Name,requiredPlan:"Business",requiredPlanID:2,comparePlan:['{"Personal":"False", "Business":"True", "Business Plus":"True"}']},{name:"premium_themes",friendlyName:e.Premium_Themes_Friendly_Name,requiredPlan:"Business",requiredPlanID:2,comparePlan:['{"Personal":"False", "Business":"True", "Business Plus":"True"}']},{name:"favicon",friendlyName:e.Favicon_Friendly_Name,requiredPlan:"Business",requiredPlanID:2,comparePlan:['{"Personal":"False", "Business":"True", "Business Plus":"True" }']}],i=function(n){var i=t[n];return i?e[i.stringPrefix+"_Friendly_Name"]:null};return{planComparisons:n,features:t,getFeatureFriendlyName:i}}),define("designer/util/util.i18n",["/i18n/resources/client"],function(e){function t(t){return t.replace(/@Strings.(\w+)/g,function(t,n){return e.resources[n]})}var n=function(){var t={au:"02 8023 8602",de:"069 9508 6491",es:"91 275 4890",fr:"91 275 4890",ie:"00 44 20 3027 4996","in":"1-800-121-0120",it:"02 9148 3553",nl:"020 206 1740",uk:"020 3027 4996",us:"(480) 624-2500"};return t[e.lang]||"(480) 624-2500"}();return{replaceRazorStringsWithI18n:t,resellerSupportPhoneNumber:n}}),define("common/inAppPurchase/featureViewModel",["knockout","strings"],function(e,t){function n(n){var i=this;i.strings=t,i.parent=n,i.ID=e.observable(""),i.name=e.observable(""),i.title=e.observable(""),i.summary=e.observable(""),i.highlights=e.observableArray(),i.image=e.observable(""),i.requiredPlan=e.observable(""),i.featureScreenshot=e.computed(function(){return i.image()}),i.featurePlaceholderClass=e.observable(""),i.update=function(e){var n=e.stringPrefix;i.ID(e.name),i.name(t[n+"_Friendly_Name"]),i.title(t[n+"_Title"]),i.summary(t[n+"_Summary"]),i.highlights([t[n+"_Highlight_1"],t[n+"_Highlight_2"],t[n+"_Highlight_3"]]),i.image(e.image),i.requiredPlan(e.requiredPlan),i.featurePlaceholderClass("inAppWidgetPlaceholder"+e.name)}}return n}),define("common/inAppPurchase/inAppPurchaseApi",["jquery","lodash","common/persistence/persistence","common/api/apiHelper"],function(e,t,n,i){function a(e,n){var a=function(e){return e.join("=")},r="?"+t.map(t.pairs(e),a).join("&"),s=o(r.length>1?r:null,n);return i.ajax(s)}function r(t){var i=e.Deferred(),a="/api/websites/{websiteId}/InAppUpgradeStatus",r={featureName:t.featureName,isUpgrading:t.isUpgrading,previousPlan:t.previousPlan,checkoutType:t.checkoutType},o=function(){i.resolve()},s=function(e){i.reject(e)};return n.Post(a,r,o,s),i.promise()}var o=i.getOptions("/features");return{getFeatures:a,setInAppUpgradeStatus:r}}),define("common/inAppPurchase/inAppPurchaseContainer",["jquery","knockout","common/stats/googleanalytics","common/logger/serverLogger"],function(e,t,n,i){var a,r,o,s,l,d,c=!1,u=["feature","compare"];return{initOnce:function(i,o){var s,l=this;d=o,a||(s=e(i),a=e("<div></div>"),a.append(s),s.on("click","a[data-ga]",function(){n.trackEvent("wsb-in-app-purchase",e(this).data("ga"),r)}),e("body").append(a),t.applyBindings(o,a[0]),a.on("click","#inAppPricePaymentDetails span.sf-tip",function(){var t=e(this);t.hasClass("sf-tipper-target")?l.trackEvent("info-icon-clicked"):e(this).sfTipper({title:o.strings.InAppUpgrade_FeatureModal_TotalChargeTooltip_Title,content:o.strings.InAppUpgrade_FeatureModal_TotalChargeTooltip_ContentLineOne+"<br><br>"+o.strings.InAppUpgrade_FeatureModal_TotalChargeTooltip_ContentLineTwo}).trigger("click")}))},createContainer:function(){},initTabs:function(){var e=this;a&&a.find("#InAppPurchaseTabs").sfTabs({onTabSelected:function(t,n){l=n,c||e.trackEvent("upgrade-tab-select"),c=!1}})},changeTab:function(e,t){c=!0,a&&(t&&t.action&&this.trackEvent(t.action),a.find("#InAppPurchaseTabs").sfTabs("select",e))},showDialog:function(t,n){var o=this;r=t,a.wsbDialog({id:"InAppPurchaseDuelHack",onClose:function(){var t;if(t=d.hasError()?"close-yikes":d.hasContentLoaded()?"close-loaded":"close-before-loaded",t&&o.trackEvent(t),n){var a=e("#"+n);a.length&&a.show()}i.post({timeInMs:o.closeDialogTimer(),action:"inAppDialogTimeOpenToClose"},i.level.Information)},onOpen:function(){o.closeDialogTimer=o.timeEvent(),o.trackEvent("open")},autoResize:!0,titleHidden:!0,buttons:[]})},closeDialog:function(){a&&a.wsbDialog("close")},setGAInfo:function(e,t){o=e,s=t},trackEvent:function(e){var t="upgrade-tab-select"===e?u[l]+"-tab-click":e;n.trackEvent("wsb-in-app-purchase",e,[r,o,s,t].join("_"))},timeEvent:function(e,t){var n=Date.now();return function(){var a=Date.now()-n;return e&&i.post({timeInMs:a,action:e},t||i.level.Information),a}}}}),define("common/metrics/productMetrics",["common/persistence/persistence"],function(e){function t(t,n,a,r){n||(n=null),a||(a=null),"boolean"!=typeof r&&(r=null),e.Post(i,{productMetricType:t,productMetricData:n,eventData:a,success:r})}function n(t){e.Post(a,t)}var i="/api/websites/{websiteId}/productmetrics",a="/api/websites/{websiteId}/businessCategoryMetrics";return{send:t,sendBusinessCategoryMetrics:n}}),define("libs/jquery/plugins/jquery.textWidth",["jquery"],function(){$.fn.textWidth=function(e,t){return $.fn.textWidth.fakeEl||($.fn.textWidth.fakeEl=$("<span>").hide().appendTo(document.body)),$.fn.textWidth.fakeEl.text(e||this.val()||this.text()).css("font",t||this.css("font")),$.fn.textWidth.fakeEl.width()}}),define("common/inAppPurchase/inAppPurchaseViewModel",["jquery","lodash","knockout","appconfig","websiteInfo","userData","common/abTesting/abTesting","common/logger/serverLogger","common/stats/googleanalytics","common/api/websites/websitesAPI","designer/util/util.i18n","common/inAppPurchase/featureViewModel","common/inAppPurchase/inAppPurchaseApi","common/inAppPurchase/inAppPurchaseContainer","common/util/util.window","/i18n/resources/client","common/metrics/productMetrics","libs/jquery/plugins/jquery.textWidth"],function(e,t,n,i,a,r,o,s,l,d,c,u,p,g,h,m,b){function f(e,t,i,a){var r=this;r.name=e,r.currentPlanValue=t,r.upgradePlanValue=i,r.selected=a,r.formatCheckboxOrEndash=function(e){return"True"===e?'<div class="absolute-center checkbox-icon-16"></div>':"&ndash;"},r.formattedValue=function(e){return"True"===e||"False"===e?r.formatCheckboxOrEndash(e):e},r.formattedCurrentValue=n.computed(function(){return r.formattedValue(r.currentPlanValue)}),r.formattedUpgradeValue=n.computed(function(){return r.formattedValue(r.upgradePlanValue)})}function v(e){var i=this;i.parent=e,i.currentPlan=n.observable(C()),i.upgradePlan=n.observable(""),i.selectedFeature=n.observable(""),i.features=n.observableArray(),i.ignoredFeatures=["ssl","premium_themes"],i.upgradePlanID=n.computed(function(){var e=["Personal","Business","Business Plus"];return e.indexOf(i.upgradePlan())+1}),i.shouldShowInGrid=function(e){return i.featureMeetsUpgradeRequirements(e.requiredPlanID)&&!i.isFeatureIgnored(e.name)&&!i.isFeatureDisabledForResellers(e)},i.isFeatureDisabledForResellers=function(e){return e.hideFromResellers&&r.isReseller},i.isFeatureIgnored=function(e){return i.ignoredFeatures.indexOf(e)>-1},i.featureMeetsUpgradeRequirements=function(e){return e<=i.upgradePlanID()},i.update=function(e){i.upgradePlan(e.requiredPlan),i.selectedFeature(e.selectedFeature);var n=t.where(e.planComparison,{requiredPlanID:2}),a=t.where(e.planComparison,{requiredPlanID:3}),r=a.concat(n),o=t.compact(r.map(function(e){if(i.shouldShowInGrid(e)){var t=JSON.parse(e.comparePlan);return new f(e.friendlyName,t[i.currentPlan()],t[i.upgradePlan()],i.selectedFeature()===e.name)}}));i.features(o)}}function y(){var i=this;i.currentPlan=new _,i.currentPlan.name(C()),i.requiredPlan=new _,i.requiredPlanName=n.observable(""),i.requiredPlanDisplayName=n.computed(function(){var e;switch(i.requiredPlanName()){case"Personal":e=P.Personal;break;case"Business":e=P.Business;break;case"Business Plus":e=P.Business_Plus;break;default:e=""}return e}),i.pricing=new w(i),i.is3LetterAccount=E,i.helpPhoneNumber=r.isReseller?c.resellerSupportPhoneNumber:P.Server__Customer_Support_Phone_New_Toll_Free,i.processPaymentErrorMessage=P.In_App_unable_to_process_payment_2.replace("{0}",i.helpPhoneNumber),i.strings=P,i.contactSupport=P.Client__Designer__TryAgainCustomerSupport,i.upgradeButtonText=n.computed(function(){var e=i.pricing.showExpressCheckout(),t=i.pricing.showStandardCheckout();return e?P.InAppPurchase_Place_Order:t?P.Upgrade:""}),i.hasContentLoaded=n.observable(!1),i.isLoading=n.observable(!0),i.isPastDue=n.observable(!1),i.loadingText=n.observable(P.Loading),i.hasError=n.observable(!1),i.feature=new u(i),i.featureGridViewModel=new v(i),i.upgradeStandardCheckoutClicked=n.observable(!1),i.computeOptions=function(){return{currentPlanName:i.currentPlan.name(),pfid:i.requiredPlan.pfid(),requiredPlanName:i.requiredPlanName(),treeId:i.requiredPlan.treeId()}},i.upgradeToCopy=n.computed(function(){return P.Upgrade_to.replace("{0}",i.requiredPlanDisplayName())}),i.upgradeButtonClick=function(){if(s.post({detail:i.pricing.checkoutType(),action:"inAppDialogUpgradeClick"},s.level.Information),i.pricing.showExpressCheckout()){var n=t.assign(i.computeOptions(),{expressCheckout:!0,transactionCurrency:i.pricing.transactionCurrency()}),r={featureName:i.feature.name(),isUpgrading:!0,previousPlan:C(),checkoutType:i.pricing.checkoutType()};i.setLoading(P.InAppPurchase_Wait_ExpressCheckout),g.trackEvent("upgrade-using-express-checkout"),e.when(d.postUpgrade(n,D),p.setInAppUpgradeStatus(r)).then(function(){if(!h.WSB_DISABLE_IN_APP){var e,t=a.Account.AccountType,n=0,r=function(o){var l=o.AccountType;e=l>t,e?(s.post({action:"inAppDialogExpressUpgradeSuccess"},s.level.Information),b.send("UpgradeComplete",null,i.eventData,!0),s.post({detail:i.pricing.checkoutType(),action:"inAppDialogBrowserReload"},s.level.Information),h.location.reload()):(n++,n>60?(g.closeDialog(),x({icon:"error",title:P.Yikes_with_exclamation,msg:P.Client__Designer__Yikes_hit_a_snag}),s.post({action:"inAppDialogExpressUpgradeTimeoutDisplayYikes"},s.level.Error)):setTimeout(function(){a.refresh(r)},1e3))};a.refresh(r)}}).fail(function(){g.trackEvent("express-checkout-failback-to-standard-checkout"),s.post({detail:"Express checkout failed; falling back to standard checkout",action:"inAppDialogExpressFailbackToStandard"},s.level.Warning),b.send("UpgradeComplete",null,i.eventData,!1),h.WSB_DISABLE_IN_APP||k(t.assign(i.computeOptions(),{viewModel:i}))})}else k(t.assign(i.computeOptions(),{viewModel:i}))},i.resetViewModel=function(){i.hasError(!1),i.hasContentLoaded(!1),i.pricing.resetViewModel(),i.setLoading()},i.updateFeatureViewModel=i.feature.update,i.updateCurrentPlanViewModel=i.currentPlan.update,i.updateRequiredPlanViewModel=i.requiredPlan.update,i.updateFeatureGridViewModel=i.featureGridViewModel.update,i.eventData={}}function _(){var e=this;e.strings=P,e.pfid=n.observable(""),e.name=n.observable(""),e.summary=n.observable(""),e.treeId=n.observable(""),e.duration=n.observable(0),e.durationType=n.observable("monthly"),e.cost=n.observable(0),e.durationInMonths=n.computed(function(){var t=e.duration();return"monthly"!==e.durationType()?12*t:t}),e.costPerMonth=n.computed(function(){var t=e.cost()/e.duration();return"monthly"!==e.durationType()&&(t/=12),t||0}),e.update=function(t){var n="undefined"!=typeof t.treeId&&null!==t.treeId?t.treeId:"",i=t.duration;e.pfid(t.pfid),e.name(t.name),e.summary(t.summary),e.treeId(n),e.cost(t.cost),i&&(e.duration(i.periods),e.durationType(i.type))}}function w(e){var t=this;t.showLoading=n.observable(!0),t.showContent=n.observable(!1),t.strings=P,t.decimalSeparator=n.observable("."),t.thousandsSeparator=n.observable(","),t.currencySymbol=n.observable(""),t.currencySymbolIsPrefixed=n.observable(!1),t.decimalPrecision=n.observable(0),t.totalCost=n.computed(function(){return e.requiredPlan.cost()-e.currentPlan.cost()}),t.perMonthSuffix=P.Per_month,t.perMonthClarificationText=P.Per_month_clarification,t.remainingTimeInPlan=n.computed(function(){var t=e.requiredPlan.durationInMonths(),n=parseInt(t),i=parseInt(30*(t-n)),a=P.Mo.replace("{0}",n),r=(1===i?P.Day:P.Days).replace("{0}",i);return a+" "+r}),t.priceDifferencePerMonth=n.computed(function(){var n=S(t.totalCost()/e.requiredPlan.durationInMonths(),t.decimalPrecision(),t.currencySymbol(),t.currencySymbolIsPrefixed(),t.decimalSeparator(),t.thousandsSeparator());return P.InAppPurchase_Month_diff.replace("{0}",n)}),t.displayTotal=n.computed(function(){return S(t.totalCost(),t.decimalPrecision(),t.currencySymbol(),t.currencySymbolIsPrefixed(),t.decimalSeparator(),t.thousandsSeparator())}),t.lastFour=n.observable(""),t.showLoading=n.observable(!0),t.showContent=n.observable(!1),t.allowExpressCheckout=n.observable(!1),t.showExpressCheckout=n.observable(!1),t.showStandardCheckout=n.observable(!1),t.paymentType=n.observable(""),t.paymentTypeFormatted=n.computed(function(){return t.paymentType().replace("_"," ").replace("paypal","PayPal").replace(/^.|\s./gi,function(e){return e.toUpperCase()})}),t.transactionCurrency=n.observable("USD"),t.checkoutType=n.computed(function(){return t.showExpressCheckout()?"express":"standard"}),t.resetViewModel=function(){t.showContent(!1),t.showLoading(!0),t.allowExpressCheckout(!1),t.showExpressCheckout(!1),t.showStandardCheckout(!1)},t.planUpgradeCopy=n.computed(function(){return P.InAppPurchase_Plan_Upgrade.replace("{0}",e.requiredPlanDisplayName())}),t.paymentNumbers=n.computed(function(){var e=t.paymentType(),n=t.lastFour();return"paypal"===e?"":" "+n}),t.paymentInfoText=n.observable(P.Total_charge_today),t.paymentFormatted=n.computed(function(){var e=t.paymentTypeFormatted(),n=t.paymentNumbers(),i="("+e+n+")";return i})}function S(e,t,n,i,a,r){var o=(Math.round(e)/Math.pow(10,t)).toFixed(t),s=o.split("."),l=s[0],d=l.replace(/\B(?=(\d{3})+(?!\d))/g,r),c=s[1],u=d+(c?a+c:"");return i?n+u:u+n}function k(t){var n=t.viewModel,i={featureName:n.feature.name(),isUpgrading:!0,previousPlan:C()};n.setLoading(P.InAppPurchase_Wait_LoadingStandardCheckout),g.trackEvent("add-upgrade-to-cart"),e.when(d.postUpgrade(t,D),p.setInAppUpgradeStatus(i)).then(function(){b.send("UpgradeComplete",null,n.eventData,!0),h.location=T.cartRedirectUrl}).fail(function(){b.send("UpgradeComplete",null,n.eventData,!1),x({icon:"error",title:P.Yikes_with_exclamation,msg:P.Client__Designer__Yikes_hit_a_snag}),n.setLoading(!1)})}function x(t){e("<div></div>").sfGrowl({icon:t.icon||"",title:t.title||"",content:t.msg,fadetime:0})}function C(){var e="Unknown";switch(a&&a.Account&&a.Account.AccountType&&(e=a.Account.AccountType),e){case 10:e="Personal";break;case 20:e="Business";break;case 30:e="Business Plus"}return e}var T=i.inAppUpgradeConfig,E=3===a.Account.ShopperId.length,P=m.resources,D={headers:{"X-Client-Source":"in-app"}};return y.prototype.setLoading=function(e){this.loadingText(e||P.Loading),this.isLoading(e!==!1)},y}),define("common/api/products/productsAPI",["lodash","common/api/apiHelper"],function(e,t){function n(n,a){return t.ajax(i("/"+n.pfid,{data:e.pick(n,["currencyCode","priceType"])},a))}var i=t.getOptions("/products");return{get:n}}),define("common/inAppPurchase/util/listPrices",["jquery","common/api/products/productsAPI"],function(e,t){function n(n,i){var a=e.Deferred();return e.when(t.get({pfid:n.currentPfid,currencyCode:n.currency,marketId:n.marketId,priceType:n.priceType},i),t.get({pfid:n.requiredPfid,currencyCode:n.currency,priceType:n.priceType},i)).then(function(e,t){e&&e.length&&(e=e[0]),t&&t.length&&(t=t[0]),a.resolve({currentPlan:{price:e.listPrice.amount,duration:e.duration},requiredPlan:{price:t.listPrice.amount,duration:t.duration}})}).fail(function(){a.reject.apply(a,[].slice.call(arguments))}),a.promise()}return{get:n}}),define("common/inAppPurchase/util/estimatedPrices",["jquery","lodash","common/api/websites/websitesAPI"],function(e,t,n){function i(e,i,a){return n.getEstimate(e,a).then(function(e){var n={price:0,duration:{periods:+(i/30).toFixed(2),type:"monthly"}};return{currentPlan:n,requiredPlan:t.merge({},n,{price:e.totalTotal})}})}return{get:i}}),define("common/util/localeHelper",["appconfig","userData"],function(e,t){var n=e.localeConfig||{},i=n.mightycall||[],a=n.subscribe||[],r=n.inapppurchase||[],o=t.locale?t.locale.toLowerCase():"en-us",s=i.indexOf(o)>-1,l=a.indexOf(o)>-1,d=r.indexOf(o)>-1;return{isMightyCallLocale:s,isSubscribeLocale:l,isInAppPurchaseLocale:d}}),define("common/mui/mui",["jquery","appconfig","userData","common/ui/dialog","css!common/mui/mui.css","websiteInfo","common/stats/googleanalytics","wsbcore/context","common/browser/browser","/i18n/resources/client","wsbcore/helper","wsbcore/growl"],function(e,t,n,i,a,r,o,s,l,d,c){function u(){var e=l.window.location.hash.toLowerCase().indexOf("mode=upgrade")>0,t=l.window.location.pathname+l.window.location.search+l.window.location.hash;e||(t+=(0===l.window.location.hash.length?"#/?":"#"===l.window.location.hash?"/?":"&")+"mode=upgrade");var i={ResourceId:n.orionUid,ResourceType:"WST",MuiUrlPrefix:n.muiUrlPrefix,TargetDivId:w,MuiProgId:n.prog_id,SpKey:n.spkey,IdpUrlParameters:"account_uid="+n.orionUid+"&returnUrl="+encodeURIComponent(t),HideControlCenterLink:1,HideCancelAccountLink:1,HideDebugInfo:1,ShowCustomize:0,OpenCallback:function(){h()},CloseCallback:function(){b(!1)},ExpressCheckoutCallback:function(){b(!0)},SharedCssIsLoaded:0,SharedJsIsLoaded:0,ShowExpressCheckout:1,CheckoutButtonOption:3,JqueryUiIsLoaded:1};return i}function p(t){C||(_=e.extend(_,T,t),_.intermediateDialogContentTemplateId?require(["text!/Mui"],function(t){0===e("#mui-templates").length&&e("body").append(t);var n=e(e("#"+_.intermediateDialogContentTemplateId).html());if(0===n.length)throw"MUI intermediate-dialog content template id not found: "+_.intermediateDialogContentTemplateId;var i=n.attr("data-dialog-type"),a=n.attr("data-ok-button-text");if("modal"===i)n.wsbDialog({buttons:[{text:a,onClick:function(){n.wsbDialog("close"),g()}},{text:d.resources.Cancel,onClick:function(){n.wsbDialog("close")},style:"link",cancel:!0}],onClose:function(){C=!1}});else{if("flyout"!==i)throw"MUI intermediate-dialog > unsupported data-dialog-type: "+i;var r=parseInt(n.css("width"),10);n.css("width","auto"),n.find(".wsb-mui-inter-flyout-buttons-ok").text(a),n.find(".wsb-mui-inter-flyout-title").text(n.attr("data-title"));var o=n.sfContext({anchor:e(_.clickedElement),width:r,positionIdeal:"mr",autoOpen:!0,onOpen:function(e){e.parents(".sf-flyout-inner:first").addClass("wsb-mui-inter-flyout-inner"),e.parents(".sf-flyout:first").addClass("wsb-mui-inter-flyout-container").find("> .sf-flyout-client-sf-context-tpr.sf-flyout-client-sf-context-tpr-middleright").addClass("wsb-mui-inter-flyout-arrow")}});o.find(".wsb-mui-inter-flyout-close").click(function(){return o.sfContext("close"),C=!1,!1}),o.find(".wsb-mui-inter-flyout-buttons-cancel").click(function(){return o.sfContext("close"),C=!1,!1}),o.find(".wsb-mui-inter-flyout-buttons-ok").click(function(){return o.sfContext("close"),C=!1,g(),!1})}}):g())}function g(){function i(){b(!1),e("<div></div>").sfGrowl({title:d.resources.Client__Designer__Yikes_hit_a_snag,content:d.resources.Server__There_has_been_an_unexpected_error,icon:"error"})}return l.msie?void(l.window.location=n.mya_mui_url):(C=!0,f(),y("wsb-mui-dialog-open"),void c.require(["js!"+t.muiClientUrl],function(){if(l.window.muiClient&&l.window.muiClient.ShowProductPopup){var e=u();l.window.muiClient.ShowProductPopup(e)}else i()},i))}function h(){k.hide().removeClass("wsb-mui-content-loading"),e(document).off("keyup",m).on("keyup",m),setTimeout(function(){k.css("margin",0);var e=k.outerWidth(!1),t=k.outerHeight(!1);k.css({"margin-left":-1*e/2+"px","margin-top":-1*t/2+"px"}),k.addClass("wsb-mui-content-loaded").show(),"function"==typeof _.onOpenCallback&&_.onOpenCallback()},500)}function m(t){27===t.keyCode&&(e(document).off("keyup",m),b(!1))}function b(e){y("wsb-mui-dialog-close");var n=e?parseInt(t.muiAccountRefreshDelayInMilliseconds,10):0;setTimeout(function(){r.refresh(function(e){"function"==typeof _.onCloseCallback&&_.onCloseCallback(e),v(),_=null,C=!1})},n)}function f(){S.show(),k.addClass("wsb-mui-content-loading").show().removeAttr("style")}function v(){S.hide(),k.hide().removeClass("wsb-mui-content-loaded").empty(),k.append(x)}function y(e){_.clientTrackingId&&o.trackEvent(_.clientTrackingId,e,_.clientTrackingValue)}var _,w="js-wsb-mui-content",S=e('<div class="wsb-mui-overlay"></div>').hide().appendTo("body"),k=e('<div class="wsb-mui-content wsb-mui-content-loading"></div>').attr("id",w).hide().appendTo("body"),x=e('<div class="wsb-mui-loading">'+d.resources.Client__Loading_upgrade_dialog+"</div>").appendTo(k),C=!1,T={clientTrackingId:null,clientTrackingValue:null,intermediateDialogContentTemplateId:null,clickedElement:null,onOpenCallback:null,onCloseCallback:null};return{ShowUpgradeDialog:p}}),define("common/inAppPurchase/inAppPurchase",["jquery","lodash","common/cookiemanager/cookiemanager","common/stats/googleanalytics","common/abTesting/abTesting","common/api/currencies/currenciesAPI","common/api/shoppers/shoppersAPI","common/api/websites/websitesAPI","common/inAppPurchase/inAppPurchaseData","common/inAppPurchase/inAppPurchaseViewModel","common/inAppPurchase/inAppPurchaseContainer","common/inAppPurchase/util/listPrices","common/inAppPurchase/util/estimatedPrices","common/logger/serverLogger","text!/InAppPurchase","common/util/localeHelper","common/mui/mui","common/metrics/productMetrics"],function(e,t,n,i,a,r,o,s,l,d,c,u,p,g,h,m,b,f){function v(t,n){function a(){d.hasError()||(i.trackEvent("wsb-in-app-purchase","open","in-app-yikes-shown"+(n?"-try-again":"")),g.post({detail:"yikes message shown",action:"inAppDialogYikes"+(n?"TryAgain":"")},g.level.Error)),f.send("UpgradeView",null,m,!1),d.hasError(!0),d.setLoading(!1)}var d=w();t=t||{},t.clientTrackingValue=t.clientTrackingValue||"general";var m={feature:{name:t.clientTrackingValue},source:t.clientTrackingId},b=c.timeEvent("inAppDialogTimeToShowPricing"),v=c.timeEvent("inAppDialogTimeToShowFeature"),S=c.timeEvent("inAppDialogTimeToShowPlanComparison");if(c.initOnce(h,d),t.presentingModalId){var k=e("#"+t.presentingModalId);k.length&&k.hide()}c.showDialog(t.clientTrackingValue,t.presentingModalId),c.trackEvent("open");var x=l.features[t.clientTrackingValue];if(!x)return a(),!0;d.updateFeatureViewModel(x),d.requiredPlanName(x.requiredPlan),c.trackEvent("display-feature"),v(),d.setLoading(!1),c.initTabs();var T={requiredPlan:x.requiredPlan,selectedFeature:x.name,planComparison:l.planComparisons};d.updateFeatureGridViewModel(T),c.trackEvent("display-plan-comparison"),S();var E=new e.Deferred,P=function(e){var t=_(e),n=t.expressCheckoutPaymentInfo;y(t);{var i=t.currency;t.priceType}d.pricing.transactionCurrency(i),t.hasExpressCheckoutEnabled&&(d.pricing.lastFour(n.masked.slice(-4)),d.pricing.paymentType(n.type)),E.resolve(t)};o.get().then(P).fail(a);var D=new e.Deferred,I=function(e){var t=_(e);D.resolve(t)};s.getUpgrade(t.clientTrackingValue).then(I).fail(a),e.when(E,D).then(function(t,n){function i(e,t){e=_(e),t=_(t),"EUR"===t.code&&(t.decimalSeparator=",",t.thousandsSeparator="."),"ZAR"===t.code&&(t.currencySymbolHtml+=" "),l.currentPlan={pfid:P,treeId:h.treeId,cost:e.currentPlan.price,duration:e.currentPlan.duration},l.requiredPlan={pfid:D.pfid,treeId:D.treeId,cost:e.requiredPlan.price,duration:e.requiredPlan.duration},d.pricing.currencySymbol(t.currencySymbolHtml),d.pricing.currencySymbolIsPrefixed("Prefix"===t.currencySymbolPosition),d.pricing.decimalPrecision(parseInt(t.decimalPrecision)),d.pricing.decimalSeparator(t.decimalSeparator),d.pricing.thousandsSeparator(t.thousandsSeparator),d.requiredPlan.update(l.requiredPlan),d.hasContentLoaded(!0),d.pricing.allowExpressCheckout()?d.pricing.showExpressCheckout(!0):d.pricing.showStandardCheckout(!0),d.pricing.showLoading(!1),d.pricing.showContent(!0),c.trackEvent("display-pricing"),c.trackEvent("enable-place-order"),c.trackEvent("open-success"),f.send("UpgradeView",null,m,!0),b()}function o(){return p.get({tid:D.treeId,pfid:D.pfid,currentPlanName:y,requiredPlanName:w,cid:k},(I.getTime()-E.getTime())/(O/2),C)}function s(){return u.get({currency:k,marketId:T,currentPfid:P,priceType:S,requiredPfid:D.pfid},C)}var l=n.content,h=n.currentPlan,v=(l.requiredPlan,n.options),y=n.currentPlan.type,w=x.requiredPlan,S=t.priceType,k=t.currency,T=t.marketId,E=new Date,P=h.pfid,D=v.filter(function(e){return e.type===w})[0],I=new Date(h.expires),A=t.hasExpressCheckoutEnabled,M=t.expressCheckoutPaymentInfo,O=1728e5,L=I-E>O,N=A?!/ach/i.test(M.type)&&L:!1;if(d.pricing.allowExpressCheckout(N),m.feature={name:x.name,requiredPlan:w},m.currentPlan={type:y,isPastDue:h.isPastDue,expires:I},m.checkoutType=N?"Express":"Standard",d.eventData=m,h.isPastDue||E>I)return d.isPastDue(!0),d.setLoading(!1),f.send("UpgradeView",null,m,!1),!0;c.setGAInfo(y,d.pricing.allowExpressCheckout()?"Express":"Standard"),c.trackEvent((A?"has":"does-not-have")+"-express-checkout-enabled"),g.post({detail:(A?"Has":"Does not have")+" Express Checkout enabled",action:"inAppDialog"+(A?"Has":"DoesNotHave")+"ExpressEnabled"},g.level.Information),L||(c.trackEvent("express-redirect-to-standard-two-days"),g.post({detail:"Less than two days on account",action:"inAppDialogRedirectExpressToStandard"},g.level.Information));var B;B=N?o():s();var F=r.get(k,C);e.when(B,F).then(i).fail(function(){t.hasExpressCheckoutEnabled?(d.pricing.allowExpressCheckout(!1),c.trackEvent("express-redirect-to-standard"),g.post({detail:"Failed to retrieve estimated prices for express checkout; redirecting to standard checkout",action:"inAppDialogEstimatePricesFailedExpress"},g.level.Warning),e.when(s(),F).then(i).fail(a)):(g.post({detail:"Failed to retrieve list prices for standard checkout",action:"inAppDialogListPricesFailedStandard"},g.level.Error),a())
})}).fail(a)}function y(e){var t=n.getCookie("currency"),i=n.getCookie("market");e.currency=t||e.currency,e.marketId=i}function _(e){return e&&e.length?e[0]:e}function w(){return x?x.resetViewModel():(x=new d,x.tryAgain=S,x.feature.learnMore=k),x}function S(){var e=w();e.hasError(!1),c.trackEvent("yikes-try-again"),v({clientTrackingValue:x.feature.ID()},!0)}function k(){var e={action:"upgrade-plan-click"};c.changeTab(1,e)}var x,C={headers:{"X-Client-Source":"in-app"}};if(a.isDisabled("inAppPurchaseIntl")){if(a.isDisabled("newInAppPurchase"))return b;if(!m.isInAppPurchaseLocale)return b}return{ShowUpgradeDialog:v}}),define("designer/app/builder/managers/themeManager",["knockout","jquery","designer/app/builder/data/data"],function(e,t,n){var i,a,r,o,s=n.getDataModel(),l=s.theme.isThemeEditMode;i=e.computed({read:function(){var e=s.address.urlArgs();return e.themeLocale?e.themeLocale:""},write:function(e){var t=s.address.urlArgs();e?t.themeLocale=e:delete t.themeLocale,s.address.urlArgs(t)}}),a=e.observable(""),r=e.computed(function(){return l&&!i()}),o=e.computed(function(){return l&&!!i()});var d=function(e){t.isFunction(e)&&e(null,"themeManager")};return{load:d,themeLocaleName:a,themeLocale:i,isMasterTheme:r,isLocalizedTheme:o,isThemeEditMode:l}}),define("designer/app/builder/managers/pageManager",["jquery","knockout","lodash","designer/app/builder/data/data","common/i18n/localizableProperty","designer/app/builder/managers/elementManager","designer/app/builder/managers/themeManager","common/persistence/request","common/stats/googleanalytics","common/api/api.guid"],function(e,t,n,i,a,r,o,s,l,d){function c(e){for(key in e)this[key]=e[key];var n=t.toJS(e.Settings),i={};try{n&&n.LocalizedProperties&&(i=t.toJS(n.LocalizedProperties)),"object"!=typeof i&&(i={})}catch(r){i={}}this.localizedName=a({propertyName:"PageName",masterProperties:this,localizedProperties:i,locale:o.themeLocale})}function u(t,n,i,a){l.trackModal("wsb-designer-add-page");var r=w(),o={Id:r,IsCopy:d.isValidAndNotEmpty(i),Name:t,PageName:t,PageTitle:t,IsHomePage:!1,PageDescription:"",PageKeywords:"",PageFilename:"",Settings:{Background:n.Background(),Height:n.Height(),Style:n.Style(),Width:n.Width()}};o.IsCopy&&(o.CopyPageId=i),I.disable(),x.website.pages.push(o),I.enable(),D.save(function(t,n){var i;!t&&n.AddPageResponse&&(i=n.AddPageResponse,S(i,r,!0)),E.sort(k),e.isFunction(a)&&a(t,i)})}function p(t,n){I.disable(),t.isDeleted(!0),I.enable(),D.save(function(i,a){a.DeletePageResponse?E.remove(function(e){return e.Id()==t.Id()}):t.isDeleted(!1),e.isFunction(n)&&n(i,a)})}function g(){var e=x.address.currentPage();return n.filter(E.peek(),function(t){return t.Id()==e})[0]}function h(e,t,n){I.disable(),e.Name(t.name),e.PageName(t.name),e.PageTitle(t.title),e.PageDescription(t.description),I.enable(),D.save(function(e,t){E.sort(k),n(e,t)})}function m(){s.websitePage.list().then(function(e){var i=n.transform(e.WebsitePages,function(e,t){e[t.Id]=t},{});n.each(E,function(e){var n=i[e.Id()];e.Title(n.Title),e.Description(n.Description);for(var a in n.Settings)e.Settings[a]?e.Settings[a](n.Settings[a]):e.Settings[a]=t.observable(n.Settings[a])})})}function b(e,t){var n=!1,i=!1,a=E(),r=a.length,o=0;for(I.disable();r>o;){var s=a[o];if(s.IsHomePage()&&s.Id()!=e&&(s.IsHomePage(!1),n=!0),s.Id()==e&&(s.IsHomePage(!0),i=!0),n&&i)break;o++}I.enable(),D.save(function(e,n){E.sort(k),t(e,n)})}function f(t,n){var i=x.address.currentPage();t!==i&&(x.address.currentPage(t),I.reset()),e.isFunction(n)&&n()}function v(t){for(var n=E(),i=0,a=n.length;a>i;){var r=n[i];if(r.IsHomePage()){f(r.Id());break}i++}e.isFunction(t)&&t()}function y(e){n.find(E(),function(t){return t.Id()==e})?s.websitePage.get({pageId:e}).then(function(t){S(t,e),T&&T(t)}):v()}function _(t){x=i.getDataModel(),C=x.website.fullLoadedPageIds,x.website.pages().forEach(function(e){E.push(new c(e))}),E.sort(k);var a=x.address.currentPage();n.contains(C,a)||y(a),x.address.currentPage.subscribe(function(e){n.contains(C,e)||y(e)}),e.isFunction(t)&&t(null,"pageManager")}function w(){return P--}function S(e,a,o){var s=e.Id;n.contains(C,s)||C.push(s),I.disable(),e.isDeleted=!1;var l=e.Elements;delete e.Elements;var d=x.website.pages();if(o)for(var u=d.length-1;u>=0&&t.unwrap(d[u].Id)==a;){d[u]=i.observablizeAndSubscribe(e,"websiteData||pages");var p=new c(d[u]);p.enlistedForNavigation=t.observable(!1),E.push(p),u--}var g={};n.each(l,function(e){var t=e.ExtendedProperties.GroupID,n="footer"===e.ExtendedProperties.Anchor?"footer":"content";!e.ExtendedProperties.Shared&&t&&parseInt(t)&&!g[t]&&(g[t]={group:r.createNewGroup([s],n,"form",t),parent:r.getGroupById(n)})});var h=r.addNewElementsToCanvas(l,s);for(var m in g){var b=g[m];r.createNewShuffleContainer(b.parent,n.transform(h,function(e,t){return t.properties.GroupID()==m?e.push(r.getElementViewModel(t.id())):void 0}),!1,!1)}I.enable()}function k(n,i){if(t.toJS(n.IsHomePage))return-1;if(t.toJS(i.IsHomePage))return 1;var a=e.trim(t.toJS(n.Name)).toLowerCase(),r=e.trim(t.toJS(i.Name)).toLowerCase();return r>a?-1:a>r?1:0}var x,C,T,E=t.observableArray(),P=-1,D=i.saver,I=i.undoer;return{load:_,addPage:u,updatePage:h,deletePage:p,setHomePage:b,switchPage:f,switchToHomePage:v,pages:E,generateNewPageId:w,getCurrentPage:g,importSevData:m,setOnPageLoadedHandler:function(e){T=e}}}),define("text!designer/app/builder/ui/controls/overlay/overlay.html",[],function(){return'<div data-bind="visible: visible">\r\n    <table>\r\n        <tr>\r\n            <td>\r\n                <img data-bind="attr: { src: loadingImagePath }"/>\r\n                <span data-bind="text: message"></span>\r\n            </td>\r\n        </tr>\r\n    </table>\r\n</div>\r\n'}),define("designer/app/builder/ui/controls/overlay/overlay",["jquery","lodash","knockout","designer/app/app","designer/app/builder/data/data","text!designer/app/builder/ui/controls/overlay/overlay.html"],function(e,t,n,i,a,r){function o(){var e=this;e.visible=n.observable(!1),e.message=n.observable(),e.loadingImagePath=a.getDataModel().config.amdPathRoot+"/images/progress.gif"}var s,l,d=function(t,a){a=e("body"),i.addControl(r,"builder","overlay-control"),l={controls:a.find("#overlay-control")},s=new o,n.applyBindings(s,l.controls[0]),t&&t(s,"overlay")},c=function(e){s.visible(!0),s.message(e)},u=function(){s.visible(!1)};return{load:d,show:c,hide:u}}),define("text!designer/app/builder/ui/header/pageswitcher/pageswitcher.html",[],function(){return'<div class="wsb-page-select" data-bind="visible: visible">\r\n    <span data-bind="text: Strings.Page"></span>&nbsp;\r\n    <div class="wsb-actionbar-page-flyout-container clearfix">\r\n      <div class="wsb-actionbar-page-flyout-pagename" data-bind="event:{click: onDropdownButtonClick }, text: currentPage().Name">\r\n      </div>\r\n        <div class="wsb-actionbar-page-flyout-openbutton-container" data-aid="pageflyout-openclosebutton"\r\n             data-bind="event: {click: onDropdownButtonClick}">\r\n            <a class="wsb-actionbar-page-flyout-openbutton"></a>\r\n        </div>\r\n        <div class="wsb-actionbar-page-flyout-list-container" data-bind="visible: flyoutVisible">\r\n            <div class="wsb-actionbar-page-flyout-bubble-arrow"></div>\r\n            <div class="wsb-actionbar-page-flyout-list-inner-container">\r\n                <div class="wsb-action-flyout-btn-wrap clearfix">\r\n                    <div class="wsb-plan-summary-container">\r\n                        <span class="wsb-page-count">\r\n                            <span class="js-UsedPageCount not-over" data-bind="text: pages().length"></span>\r\n                            <span class="limit js-allowedpagecountdenom" data-bind="visible: showUpgrade">\r\n                                /\r\n                                <span class="limit js-allowedpagecount" data-bind="text:allowedPages"></span>\r\n                            </span>\r\n                            <span data-bind="text: pageText"></span>\r\n                        </span>\r\n                    </div>\r\n                    <a class="wsb-action-add btn btn-success" data-aid="pageflyout-addpagebutton"\r\n                       data-bind="event: {click: onAddPage } ">\r\n                        <i class="icon-plus-sign icon-white"></i>\r\n                        <span data-bind="text: Strings.Add_page_titlecase"></span>\r\n                    </a>\r\n                </div>\r\n                <ul class="wsb-actionbar-page-flyout-page-list" data-bind="template: { name: \'pageswitcher-menu-item\', foreach: pages }"></ul>\r\n                <div class="clear-fix"></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n\r\n<script type="text/html" id="pageswitcher-menu-item">\r\n    <li class="clearfix" data-bind="visible: !isDeleted(), attr: { pageid: Id}">\r\n        <!--page name-->\r\n        <a class="wsb-actionbar-page-flyout-page-link"\r\n           data-bind="text: Name, attr: {pageid: Id, title: Name}, event: {click: $parent.onPageNameClick}"></a>\r\n        <!-- set home page-->\r\n        <a class="wsb-actionbar-page-flyout-page-home-button wsb-actionbar-page-flyout-icn"\r\n           data-bind="css: { \'wsb-actionbar-page-flyout-home-page\': IsHomePage }, event: { click: $parent.onHomePageButtonClick },\r\n    attr: { title: IsHomePage() ? $parent.Strings.Home_Page : $parent.Strings.Set_Home_Page }"></a>\r\n        <!-- edit button -->\r\n        <a class="wsb-tool-Edit2 wsb-actionbar-page-flyout-icn"\r\n           data-aid="pageflyout-pagelistitem-renamepagebutton"\r\n           data-bind="event: { click: $parent.onEditClick },\r\n    attr: { title: $parent.Strings.Client__Designer__PageFlyout_Edit.format(Name()) }"></a>\r\n        <!-- copy button-->\r\n        <a class="wsb-tool-copy wsb-actionbar-page-flyout-icn"\r\n           data-aid="pageflyout-pagelistitem-copypagebutton"\r\n           data-bind="event: { click: $parent.onCopyClick },\r\n    attr: { title: $parent.Strings.Client__Designer__PageFlyout_Copy.format(Name()) }"></a>\r\n        <!--delete button-->\r\n        <a class="wsb-tool-Delete2 wsb-actionbar-page-flyout-icn" data-aid="pageflyout-pagelistitem-deletepagebutton"\r\n           data-bind="visible: !IsHomePage(), event: { click: $parent.onDeleteClick },\r\n    attr: { title: $parent.Strings.Client__Designer__PageFlyout_Remove.format(Name()) }"></a>\r\n    </li>\r\n</script>\r\n'}),define("text!designer/app/builder/ui/header/pageswitcher/pageEditorDialog.html",[],function(){return'<div class="wsb-actionbar-flyout-content " data-bind="attr: {\'data-title\': i18N.designerPageflyoutDialogEditpage }, event: {keyup: onKeyup }, keyupBubble: false" style="display:none;">\r\n    <div class="wsb-required wsb-modal-required-label" data-bind="text: i18N.requiredFields"></div>\r\n    <ul class="wsb-page-info">\r\n        <li>\r\n            <div><span data-bind="text: i18N.designerPageFlyoutDialogPageName + \':\'"></span><span class="wsb-required">*</span></div>\r\n            <div class="setup-help-text" data-bind="text: i18N.keepItShortForNavigation"></div>\r\n            <div class="wsb-actionbar-page-flyout-page-name-text">\r\n                <input id="js-editpage-name" data-aid="editpage-name" maxlength="512" type="text" class="wsb-actionbar-flyout-text-input wsb-text-box"\r\n                       data-bind="value: page.Name, valueUpdate: \'afterkeydown\', css: {\'wsb-text-box-error\': !isPageNameValid() }" />\r\n            </div>\r\n            <div id="js-editpage-name-error" class="wsb-text-box-error-text" \r\n                 data-bind="visible: !isPageNameValid(), text: i18N.thisIsARequiredField"> </div>\r\n        </li>\r\n\r\n\r\n        <li>\r\n            <div><span data-bind="text: i18N.title + \':\'"></span><span class="wsb-required">*</span></div>\r\n            <div class="setup-help-text" data-bind="text: i18N.thisShowsInSearchEngines"></div>\r\n            <div class="wsb-actionbar-page-flyout-page-name-text">\r\n                <input id="js-editpage-title" data-aid="editpage-title" maxlength="512" type="text" class="wsb-actionbar-flyout-text-input wsb-text-box"\r\n                       data-bind="value: page.PageTitle, valueUpdate: \'afterkeydown\', css: {\'wsb-text-box-error\': !isPageTitleValid() }" />\r\n            </div>\r\n            <div id="js-editpage-title-error" class="wsb-text-box-error-text" \r\n                 data-bind="visible: !isPageTitleValid(), text: i18N.thisIsARequiredField"> </div>\r\n        </li>\r\n\r\n\r\n        <li class="wsb-page-info-textarea">\r\n            <div data-bind="text: i18N.description + \':\'"></div>\r\n            <div class="setup-help-text" data-bind="text: i18N.aSummaryOfYourSite"> </div>\r\n            <div class="wsb-actionbar-page-flyout-page-name-text">\r\n                <textarea id="js-editpage-description" data-aid="editpage-description" class="wsb-actionbar-flyout-textarea-input wsb-textarea"\r\n                          data-bind="value: page.PageDescription, valueUpdate: \'afterkeydown\'"></textarea>\r\n            </div>\r\n        </li>\r\n\r\n    </ul>\r\n</div>'}),define("text!designer/app/builder/ui/header/pageswitcher/addCopyPageDialog.html",[],function(){return'<div class="wsb-actionbar-flyout-content wsb-actionbar-flyout-addpage" \r\n     data-bind="attr: {\'data-title\': i18N.dialogTitle}, event:{keyup: onKeyup}" >\r\n    <div class="wsb-dialog-single-text" data-bind="text: i18N.pageNameLabel + \':\'"></div>\r\n    <div class="wsb-actionbar-page-flyout-page-name-text">\r\n        <input maxlength="512" type="text" class="wsb-actionbar-flyout-text-input wsb-text-box" \r\n               data-bind="value: pageName, css: {\'wsb-text-box-error\': !isPageNameValid() }, valueUpdate: \'afterkeydown\' " />\r\n    </div>\r\n    <div class="wsb-text-box-error-text" data-bind="text: i18N.requiredMessage, visible: !isPageNameValid()"></div>\r\n</div>'}),define("designer/app/builder/ui/header/pageswitcher/pageswitcher",["jquery","designer/app/event","designer/app/builder/data/data","lodash","knockout","common/inAppPurchase/inAppPurchase","/i18n/resources/client","common/stats/googleanalytics","designer/app/builder/managers/pageManager","designer/app/builder/managers/addressManager","common/logger/serverLogger","designer/app/builder/ui/controls/overlay/overlay","text!designer/app/builder/ui/header/pageswitcher/pageswitcher.html","text!designer/app/builder/ui/header/pageswitcher/pageEditorDialog.html","text!designer/app/builder/ui/header/pageswitcher/addCopyPageDialog.html","common/ui/dialog"],function(e,t,n,i,a,r,o,s,l,d,c,u,p,g,h){function m(){var t=this,n=v.address,d=["Page_colon","Add_page_titlecase","Home_Page","Set_Home_Page","Client__Designer__PageFlyout_Edit","Client__Designer__PageFlyout_Copy","Client__Designer__PageFlyout_Remove"];t.Strings={},d.forEach(function(e){t.Strings[e]=o.resources[e]}),t.visible=n.isEditAction,t.pages=a.computed(function(){return i.filter(l.pages(),function(e){return!e.isDeleted()})}),t.currentPageId=n.currentPage,t.currentPage=a.computed(function(){var e=l.pages(),t=i.find(e,function(e){return e.Id()==n.currentPage()});return t||(t=e[0]),t}),t.flyoutVisible=a.observable(!1),t.hide=function(){t.flyoutVisible(!1)},t.showUpgrade=v.info.Account.ShowUpgrade,t.upgradeClick=function(n,i){return t.hide(),r.ShowUpgradeDialog({clientTrackingId:"wsb-designer-page-dropdown-upgrade-link"}),s.linkAnchor(e(i.target))},t.allowedPages=v.info.ko.numberOfAllowedPages,t.usedPageCountText=a.computed(function(){return o.resources.Client__Designer__PageFlyout_PageCount.format(t.pages().length)}),t.pageText=o.resources.Client__Designer__PageFlyout_PageCount.replace("{0}",""),t.usedPageCountCssClass=a.computed(function(){var e=t.allowedPages;return t.pages().length>e?"over":"not-over"}),t.onDropdownButtonClick=function(){s.trackEvent("designer_header","manage_pages","dropdown"),t.flyoutVisible(!t.flyoutVisible())},t.onAddPage=function(){t.flyoutVisible(!1),s.trackEvent("designer_header_page","add_page","button"),t.openAddCopyDialog()},t.onPageNameClick=function(e){var n=c.beacons.changePage;c.startPerformanceTimers(n.name),c.triggerTrace(n.steps.changePageStart,n.name),c.logFirstClick("switchpage"),t.flyoutVisible(!1);var i=e.Id();i&&!w.test(i)&&l.switchPage(i,function(){setTimeout(function(){c.triggerTrace(n.steps.changePageEnd,n.name),c.postPerformance(n.name)},0)})},t.onHomePageButtonClick=function(n){t.flyoutVisible(!1);var i=n.Id();!i||w.test(i)||n.IsHomePage()||(s.trackEvent("designer_header_page","set_homepage","button"),l.setHomePage(i,function(){e("<div></div>").sfGrowl({title:o.resources.Client__Designer__PageFlyout_HomeGrowl.format(n.PageTitle()),icon:"success",fadetime:3e3})}))},t.onEditClick=function(n){t.flyoutVisible(!1),s.trackEvent("designer_header_page","edit_page","button");var i=n.Id();if(i&&!w.test(i)){var r=e(g),d=function(e){r.wsbDialog(e?"enableButton":"disableButton",0)},c={Name:a.observable(n.Name()),PageTitle:a.observable(n.PageTitle()),PageDescription:a.observable(n.PageDescription())},p={page:c,i18N:{designerPageflyoutDialogEditpage:o.resources.Client__Designer__PageFlyout_Dialog_EditPage,requiredFields:"* "+o.resources.Required_fields,designerPageFlyoutDialogPageName:o.resources.Client__Designer__PageFlyout_Dialog_PageName,keepItShortForNavigation:o.resources.Keep_it_short_for_navigation,title:o.resources.Title,thisShowsInSearchEngines:o.resources.This_shows_in_search_engines,thisIsARequiredField:o.resources.This_is_a_required_field,description:o.resources.Description,aSummaryOfYourSite:o.resources.A_summary_of_your_site}};p.isPageNameValid=a.observable(!0),p.isPageTitleValid=a.observable(!0),p.page.Name.subscribe(function(e){var t=e&&e.length>0&&e.trim().length>0;p.isPageNameValid(t)}),p.page.PageTitle.subscribe(function(e){var t=e&&e.length>0&&e.trim().length>0;p.isPageTitleValid(t)}),p.isPageNameValid.subscribe(function(e){var t=e&&p.isPageTitleValid();d(t)}),p.isPageTitleValid.subscribe(function(e){var t=e&&p.isPageNameValid();d(t)}),p.onKeyup=function(e,t){13===t.keyCode&&p.handleSaveClick()},p.handleSaveClick=function(){if(p.isPageNameValid()&&p.isPageTitleValid()){s.trackEvent("wsb-designer-edit-page","save_editpage","button"),u.show(o.resources.Saving_ellipsis);try{l.updatePage(n,{name:c.Name(),title:c.PageTitle(),description:c.PageDescription()},function(e){e||l.switchPage(n.Id()),u.hide()})}catch(e){u.hide()}r.wsbDialog("close")}},a.applyBindings(p,r[0]),r.wsbDialog({buttons:[{text:o.resources.Save,attributes:{"data-aid":"editpage-save"},onClick:function(){p.handleSaveClick()}},{text:o.resources.Cancel,attributes:{"data-aid":"editpage-cancel"},style:"link",cancel:!0,onClick:function(){s.trackEvent("wsb-designer-edit-page","cancel_editpage_modal","link")}}],onClose:function(e,t){t&&s.trackEvent("wsb-designer-edit-page","xclose_editpage_modal","icon")}})}},t.onCopyClick=function(e){t.flyoutVisible(!1),s.trackEvent("designer_header_page","copy_page","button"),t.openAddCopyDialog(e)},t.onDeleteClick=function(n){t.flyoutVisible(!1);var i=n.Name(),a=e('<div class="wsb-actionbar-flyout-content" data-title="'+o.resources.Client__Designer__PageFlyout_Dialog_DeletePage+'">'+o.resources.Client__Designer__PageFlyout_Dialog_AreYouSure.format('<strong class="wsb-highlight-text">'+i+"</strong>")+"</div>");s.trackEvent("designer_header_page","delete_page","button"),a.wsbDialog({buttons:[{text:o.resources.Delete,onClick:function(){s.trackEvent("wsb-designer-delete-page","delete_page","button"),u.show(o.resources.Saving_ellipsis);try{l.deletePage(n,function(e,i){n.Id()==t.currentPageId()&&!e&&i.DeletePageResponse&&l.switchToHomePage(),u.hide()})}catch(e){u.hide()}a.wsbDialog("close")}},{text:o.resources.Cancel,style:"link",cancel:!0,onClick:function(){s.trackEvent("wsb-designer-delete-page","cancel_deletepage_modal","link")}}],onOpen:function(e){e.addClass("wsb-actionbar-page-flyout-delete-confirmation-dialog-container")},onClose:function(e,t){t&&s.trackEvent("wsb-designer-delete-page","xclose_deletepage_modal","icon")}})},t.openAddCopyDialog=function(n,i){var r,d=void 0!==n,c=d?o.resources.Client__Designer__PageFlyout_Dialog_CopyPage:o.resources.Add_page_titlecase,p=e(h);r={pageName:a.observable(""),i18N:{dialogTitle:c,pageNameLabel:o.resources.Client__Designer__PageFlyout_Dialog_PageName,requiredMessage:o.resources.Client__Designer__PageFlyout_Dialog_PageRequired}},r.isPageNameValid=a.observable(!0),r.pageName.subscribe(function(e){r.validate(e)}),r.validate=function(e){var t=e&&e.length&&e.trim().length>0;r.isPageNameValid(t),p.wsbDialog(t?"enableButton":"disableButton",0)},r.handleSaveClick=function(){u.show(o.resources.Saving_ellipsis);try{if(r.validate(r.pageName()),!r.isPageNameValid())return void u.hide();d?l.addPage(r.pageName(),n.Settings,n.Id(),function(e,t){!e&&t&&l.switchPage(t.Id()),u.hide()}):l.addPage(r.pageName(),t.currentPage().Settings,-1,function(e,t){!e&&t&&l.switchPage(t.Id()),u.hide()})}catch(e){u.hide()}p.wsbDialog("close")},r.onKeyup=function(e,t){13===t.keyCode&&r.handleSaveClick()},e.isFunction(i)&&i(r),a.applyBindings(r,p[0]),p.wsbDialog({buttons:[{text:d?o.resources.Copy:o.resources.Add,onClick:function(){d?s.trackEvent("wsb-designer-copy-page","copy_page","button"):s.trackEvent("wsb-designer-add-page","add_page","button"),r.handleSaveClick()}},{text:o.resources.Cancel,style:"link",cancel:!0,onClick:function(){d?s.trackEvent("wsb-designer-copy-page","cancel_copypage_modal","link"):s.trackEvent("wsb-designer-add-page","cancel_addpage_modal","link")}}],onClose:function(e,t){t&&(d?s.trackEvent("wsb-designer-copy-page","xclose_copypage_modal","icon"):s.trackEvent("wsb-designer-add-page","xclose_addpage_modal","icon"))}})},t.i18N={updatePlan:o.resources.Client__Designer__PageFlyout_UpgradePlan}}function b(e,i){_.header=e.append(p),v=n.getDataModel(),y=new m,a.applyBindings(y,_.header[0]),t.on(t.events.flyoutClose,function(e){f(e)}),t.on(t.events.addNewPage,function(){y.onAddPage()});var o=v.address;o.currentAction()===d.actions.addPage?(y.onAddPage(),o.currentAction(d.actions.edit)):o.currentAction()===d.actions.seoWizard&&(r.ShowUpgradeDialog({clientTrackingId:"wsb-dashboard-seo-wizard",clientTrackingValue:"seo"}),o.currentAction(d.actions.edit)),i&&i(null,y)}function f(t){t&&t.target&&e(t.target).closest(".wsb-page-select").length||y&&y.hide()}var v,y,_={},w=/^-\d+$/;return{load:b,closeFlyout:f}}),define("designer/app/builder/data/designerData",["jquery","napsoc","common/persistence/persistence"],function(e,t,n){function i(e){return I("Post","/api/websites/{websiteId}/websiteSettings",e)}function a(e){return I("Post","/api/websites/{websiteId}/websiteSettings",e)}function r(){return I("Get","/api/websites/{websiteId}/lastPublishedDate")}function o(){return I("Get",A.pages)}function s(e){return I("Get",A.pages+"/"+e)}function l(e,t){return I("Post","/api/websites/{websiteId}/websitepages/"+t,e)}function d(e){return I("Put",A.pages+"/"+e.Id,e)}function c(e){return I("Put",A.pages,e)}function u(e){return I("Post","/api/WebsitePages/SetHomePage/{websiteId}/"+e,{})}function p(e,t,n){return I("Post",[A.pages,e,"websitepagesettings"].join("/"),t,n)}function g(e){return I("Delete",A.pages+"/"+e)}function h(e){return I("Put","/api/websites/{websiteId}/background",e)}function m(e,t){return I("Post","/api/websites/{websiteId}/websitebulkupdate?editingMode={editingMode}",e,t)}function b(e,t,n){return I("Post",[A.pages,e,"websitepageelements",t,"websitepageelementproperties"].join("/"),n)}function f(i){function a(i,a,r,o){var s="/api/websites/{websiteId}/napsocsettings/",l={SiteName:"Name",StreetAddress:"Address",PhoneNumber:"Phone",EmailAddress:"Email",Twitter:"TwitterUsername"},d=function(){var n=t.observables();for(var r in i){var o=void 0!==l[r]?l[r]:r;e.isFunction(n[o])&&n[o](i[r])}e.isFunction(a)&&a.apply(this,arguments)};n.Post(s,i,d,r,o)}var r=e.Deferred();return a(i,function(){r.resolve()},function(){r.reject()}),r.promise()}function v(){return I("Get","/api/websites/{websiteId}/websiteCss")}function y(e){return I("Post","/api/websites/{websiteId}/html/cleanhtml",e||"")}function _(){return I("Get","/api/businessCategories",null,!0,!0)}function w(){return I("Get","/api/websites/{websiteId}/publishstatus",null,!0,!1)}function S(){return I("Post","/api/websites/{websiteId}/publishstatus",{})}function k(e){return I("Put","/api/websites/{websiteId}/publishstatus",e)}function x(e){return I("Post","/api/websites/{websiteId}/publishes/",e)}function C(e){return I("Get","/api/websites/{websiteId}/RaaVerification?domain="+e)}function T(){return I("Post","/api/websites/{websiteId}/RaaVerification",{})}function E(){return I("Get","/api/themes/ByWorkingWebsiteId/{websiteId}")}function P(e){return I("Post","/api/themes/{websiteId}/devDateByLocale",e)}function D(e,t,n){var i="/Designer/Preview/"+e+"?pageId="+t+"&websiteId={websiteId}";return n&&(i=i+"&themeLocale="+n),I("Get",i)}function I(t,i,a,r,o){var s=e.Deferred(),l=n[t],d=[i];return a&&d.push(a),d.push(function(e){s.resolve(e)},function(e){s.reject(e)},r,o),l.apply(n,d),s.promise()}var A={pages:"/api/websites/{websiteId}/websitepages"};return{getPages:o,getLastPublishedDate:r,getPage:s,addPage:l,updatePage:d,updatePages:c,updatePageSettings:p,deletePage:g,updatePageElements:m,updatePageElement:b,setHomePage:u,updateBackgroundSettings:h,getCss:v,cleanHtml:y,getAllBusinessCategories:_,updateNapsocSettings:f,updateSiteFeaturesSettings:i,updateWebsiteSettings:a,checkPublishStatus:w,updatePublishNotification:S,setPublishExpiredAndUpdateNotification:k,createPublish:x,getRaaVerificationInfo:C,postRaaVerification:T,getPreviewHtml:D,loadTemplateInfo:E,updateDevDateByLocale:P}}),define("designer/app/builder/managers/siteSettingsManager",["jquery","libs/async-util/async","designer/app/builder/data/data","designer/app/builder/data/designerData","common/logger/serverLogger"],function(e,t,n,i,a){function r(e){return u&&u.napsoc?void i.updateNapsocSettings(u.napsoc).then(function(){return e(null)}).fail(function(t){e(t)}):e(null,u)}function o(t){if(t&&t.length){var n=e.parseHTML(t),i=e("<div>").append(n),r=i.find('link[rel~="icon"], link[rel~="apple-touch-icon"]');r.length&&a.post({detail:r.toArray().map(function(e){return e.outerHTML}),action:"faviconUserInjectedOnEdit"},a.level.Information)}}function s(e){return u&&u.siteFeatures?void t.series([function(e){i.updateSiteFeaturesSettings(u.siteFeatures).then(function(){e(null)}).fail(function(t){e(t)})}],function(t){e(t)}):e(null,"doSaveSiteFeaturesSettings")}function l(e){return u&&u.website?(o(u.website.HeaderTags),void t.series([function(e){p.enableCleanHtml?t.parallel([function(e){i.cleanHtml(u.website.HeaderTags).then(function(e){u.website.HeaderTags=e}).always(function(){e(null)})},function(e){i.cleanHtml(u.website.BodyTags).then(function(e){u.website.BodyTags=e}).always(function(){e(null)})}],function(e){callback(e)}):e()},function(e){i.updateWebsiteSettings(u.website).then(function(){e(null)}).fail(function(t){e(t)})}],function(t){e(t)})):e(null,"doSaveWebisteSettings")}function d(e){n.saver.save(function(t){e(t)})}function c(e,i){u=e,t.parallel([r,s,l,d],function(e){n.saver.setDirtyFlag("preview",!0),i(e,u)})}var u,p;return{save:c,load:function(e){p=n.getDataModel().config,e()}}}),define("common/social/oauth/social.oauth",["knockout","common/persistence/persistence","common/browser/browser","websiteSettings","common/logger/serverLogger","jquery"],function(e,t,n,i,a,r){var o,s,l,d,c,u,p={};return s=function(e,t){this.network=e,this.settings=e.settings||{},this.eventHandler=t,this.authWindow=!1,this.init()},s.prototype={init:function(){var e=this,t=function(t){"origin"in t&&t.origin.toLowerCase().indexOf("locu.")>-1||e.closeWindow(t)};n.msie?window[this.settings.name+"OAuthListener"]=t:window.addEventListener?window.addEventListener("message",t,!1):window.attachEvent&&window.attachEvent("onmessage",t),this.network.openAuthWindow=function(){e.openWindow()},this.network.closeAuthWindow=function(){e.closeWindow()},this.network.enableAuth=function(){e.network.isAuth=!0,e.eventHandler.trigger("auth")},this.network.removeAuth=function(){e.network.isAuth=!1,e.eventHandler.trigger("unauth")},this.network.isAuthorized=function(){return e.network.isAuth}},openWindow:function(){var e=this;this.authWindow&&this.authWindow.close(),this.authWindow=window.open("about:blank",this.settings.name+"Auth",this.settings.popupProperties),t.Get("/api/websites/{websiteId}/StockSocialMedia?socialMediaTypes="+this.settings.name,function(t){t&&t[e.settings.name]&&t[e.settings.name].authLink?(e.authWindow=window.open(t[e.settings.name].authLink,e.settings.name+"Auth",e.settings.popupProperties),e.authWindow&&r.isFunction(e.authWindow.focus)&&e.authWindow.focus()):e.authWindow&&e.authWindow.close()})},closeWindow:function(e){if(e){if(!e.origin||-1===e.origin.search(window.location.host))return;if(e.data){var t=null;if(e.data.command)t=e.data;else try{t=JSON.parse(e.data)}catch(n){a.post({text:"Error parsing OAuth result. Value: '"+e.data+"', Message: '"+n.message+"'",file:"common/social/oauth/social.oauth.js",stack:n.stack},2)}t&&t.command==this.settings.name+"AuthComplete"&&(t.content&&t.content.success?this.network.enableAuth():this.network.removeAuth(),this.authWindow&&this.authWindow.close())}}else this.authWindow&&this.authWindow.close()}},l=function(e){this.network=e,this.eventHandler=r({}),this.init()},l.prototype={init:function(){var e=this,t=this.network;t.one=function(){return r.fn.one.apply(e.eventHandler,arguments)},t.bind=function(){return r.fn.bind.apply(e.eventHandler,arguments)},t.unbind=function(){return r.fn.unbind.apply(e.eventHandler,arguments)},t.trigger=function(){return r.fn.trigger.apply(e.eventHandler,arguments)}}},d=function(){this.isAuth=Boolean(i.InstagramAccessToken),this.settings={name:"instagram",popupProperties:"status=0,toolbar=0,location=0,menubar=0,directories=0,resizable=1,scrollbars=1,width=800,height=600"};{var e=new l(this).eventHandler;new s(this,e)}},c=function(){this.isAuth=Boolean(i.FacebookAccessToken),this.settings={name:"facebook",popupProperties:"status=0,toolbar=0,location=0,menubar=0,directories=0,resizable=1,scrollbars=1,width=800,height=600",apiUrls:{pages:"/api/websites/{websiteId}/StockSocialMedia?action=facebookgetpages"},ajaxUrls:{}};var e=new l(this).eventHandler,n=(new s(this,e),this),a={};this.getPages=function(e,i){r.isFunction(e)&&(!i&&a.pages?e(a.pages):t.Get(n.settings.apiUrls.pages,function(t){t&&!t.FacebookAuthorized?(n.removeAuth(),e(a.pages=!1)):e(a.pages=t&&t.FacebookPages&&t.FacebookPages.length?t.FacebookPages:!1)}))}},u=function(){this.isAuth=Boolean(i.TwitterOAuthToken&&i.TwitterOAuthTokenSecret),this.settings={name:"twitter",popupProperties:"status=0,toolbar=0,location=0,menubar=0,directories=0,resizable=1,scrollbars=1,width=800,height=600",apiUrls:{user:"/SocialMediaAuth/TwitterScreenName/?websiteId={websiteId}"},ajaxUrls:{timeline:"/SocialMediaAuth/TwitterApiUserTimeline/",search:"/SocialMediaAuth/TwitterApiSearch/"}};var e=new l(this).eventHandler,n=(new s(this,e),this),a={};this.getUsername=function(e,i){r.isFunction(e)&&(!i&&a.username?e(a.username):t.Get(n.settings.apiUrls.user,function(t){e(a.username=t&&t.screenName?t.screenName:!1)}))}},o=function(e){if(p[e])return p[e];switch(e){case"facebook":return p[e]=new c;case"twitter":return p[e]=new u;case"instagram":return p[e]=new d;default:return{}}}}),define("common/regexhelper/regexhelper",[],function(){var e={};return e.validateEmailAddress=function(e){var t=/^[\w-\.]+@([\w-]+\.)+[\w-]{2,63}$/i;return t.test(e)},e.validateUrl=function(e){var t=/^(page|file):([0-9a-f:\-]+)$/i,n=/^mailto:[\w-\.]+@([\w-]+\.)+[\w-]{2,63}$/i,i=/^\b(https?|ftp|file):\/\/[\-A-Za-z0-9+&@#\/%?=~_|!:,.;]*[\-A-Za-z0-9+&@#\/%=~_|‌​]$/i;return t.test(e)?!0:n.test(e)?!0:i.test(e)},e.validateTime=function(e){var t=/^(\d|[0]\d|[1][0-2]):([0-5]\d)\s?(?:AM|PM)$/i,n=/^(\d|[0]\d|[1]\d|[2][0-3]):([0-5]\d)\s?$/i;return t.test(e)||n.test(e)},e.validateDate=function(e){if(isNaN(Date.parse(e)))return!1;
var t=/^\d{1,2}[./-]\d{1,2}[./-]\d{4}$/,n=/^\d{4}[./-]\d{1,2}[./-]\d{1,2}$/;return t.test(e)||n.test(e)},e}),define("common/geo/getClosestGeoLocation",[],function(){function e(){s||(s=new l.Geocoder)}function t(e,t){t(e?a(e):"")}function n(e,t){if(e){var n=e.geometry;t(n&&n.location||{})}else t({})}function i(i,a,r){e();var o="getCoordinates"===i?n:t,d="getCoordinates"===i?{}:"";a?s.geocode({address:a},function(e,t){var n=t===l.GeocoderStatus.OK?e[0]:a;o(n,r)}):r(d)}function a(e){var t=e;return e.formatted_address?t=e.formatted_address:e.address_components&&(t=r(e)),t}function r(e){return[e.address_components[0]&&e.address_components[0].short_name||"",e.address_components[1]&&e.address_components[1].short_name||"",e.address_components[2]&&e.address_components[2].short_name||""].join(" ")}function o(e){l?e():require(["common/geo/googleMaps"],function(t){var n=t();n.done(function(t){l=t,e()})})}var s,l=window.google&&window.google.maps;return{getClosestStreetAddress:function(e,t){o(function(){i("getAddress",e,t)})},getCoordinates:function(e,t){o(function(){i("getCoordinates",e,t)})},initMapsApi:function(e){l=e}}}),define("common/geo/placesAutocomplete",["knockout","jquery","wsbcore/helper"],function(e,t){e.bindingHandlers.placesAutocomplete={init:function(n,i,a){function r(){C=P&&new P.places.AutocompleteService(null,{types:["geocode"]}),C&&o()}function o(){w.on("input",function(){D&&clearTimeout(D),D=setTimeout(s,A),a().value(w.val())})}function s(){S=w.val(),S?(y.input=S,C.getPlacePredictions(y,l)):k.hide()}function l(e,t){t===P.GeocoderStatus.OK&&e.length>0&&(c(e),k.show())}function d(t){S&&E&&e.isObservable(E)&&a().needsFormatted(t)}function c(e){for(var t=f(),n=0;5>n;n++)e[n]&&t.append(u(e[n]));0===k.width()&&k.width(w.outerWidth()),k.html(t.children())}function u(e){return t("<li></li>",{"place-value":e.description,"place-id":e.place_id,text:e.description,"class":"google-place"})}function p(){setTimeout(function(){d(M),k.hide()},150)}function g(e){if((40===e.keyCode||38===e.keyCode||13===e.keyCode)&&k){if(k.find("li."+_).removeClass(_),40===e.keyCode)I=I?I.next():k.find("li:first");else if(38===e.keyCode)I=I?I.prev():k.find("li:last");else{if(k.hide(),!I)return void(M=!0);M=!1,w.val(I.attr("place-value")),b()}if(0===I.length)return w.val(S),void(I=I.length);I.addClass(_),w.val(I.attr("place-value"))}}function h(){M=!1,w.val(t(this).attr("place-value")),b()}function m(){t("."+_).removeClass(_),t(this).addClass(_)}function b(){a().value(w.val()||""),T&&v.place(w.val())}function f(){return t("<ul></ul>",{"class":"google-autocomplete-suggestions"})}var v=i(),y={},_="google-active-place",w=t(n);w.after(t("<div></div>").append(f()));var S,k=w.next().find("ul"),x=v.bounds;x&&(y.bounds=e.utils.unwrapObservable(x),e.isObservable(x)&&x.subscribe(function(e){y.bounds=e}));var C,T=e.isObservable(v.place),E=a().needsFormatted,P=window.google&&window.google.maps;r(),w.on("focus",function(){P||require(["common/geo/googleMaps"],function(e){var t=e();t.done(function(e){P=e,r()})})});var D,I,A=v.throttleTime||500,M=!0;w.on("blur",p).on("keydown",g),k.on("click","li",h).on("mouseover","li",m)}}}),define("businessCategories",["async!initDataModel"],function(e){return e.BusinessCategories}),define("common/ui/autocomplete",["knockout","jquery","libs/knockout/ko.addins_v2"],function(e,t){e.bindingHandlers.autocomplete={init:function(n,i){function a(){if(y.length){var e=y[y.length-1];e.list[e.idx].isHighlighted(!1)}}function r(){function t(e,t){return e=e||[],e.map(function(e){return i(e,t)}).filter(function(e){return!!e})}function i(e,n){var i=m(e);if(n){if(g(e)==n)return new o(g(e),u(e),i&&!!i.length,t(i));var a=t(i,n);return a.length?new o(g(e),u(e),!0,a):null}return new o(g(e),u(e),i&&!!i.length)}var a=e.utils.unwrapObservable(d.value),r=t(_,a);if(a&&!r.length)return void d.value(null);if(y=[],a){r.unshift(new o(null,e.utils.unwrapObservable(d.allCategoriesLabel),!0));var s={list:r,idx:1};y.push(s);for(var l=s.list[s.idx];l.value!=a;)s={list:l.children,idx:0},y.push(s),l=l.children[0];s.list[s.idx].isHighlighted(!0),n.value=l.text}else n.value="";S(r)}function o(t,n,i,a){this.text=n,this.value=t,this.hasChildren=i,this.children=a,this.isHighlighted=e.observable(!1),this.select=function(){l(t,n,!!i)}}function s(n,i){var a=u(n),r=g(n),o=0,s=t("<span/>");i.forEach(function(e){t("<span/>").text(a.substring(o,e.index)).appendTo(s),t('<span class="wsb-autocomplete-match-segment"/>').text(e.text).appendTo(s),o=e.index+e.text.length}),t("<span/>").text(a.substr(o)).appendTo(s),this.value=r,this.isHighlighted=e.observable(!1),this.matchHtml=s.html(),this.select=function(){l(r,a,!1)}}function l(e,i,a){d.value(e),b("browse"),e&&t(n).val(i),x.focus(),I(a)}var d=i(),c=e.utils.unwrapObservable(d.textProperty),u=function(e){return c?e[c]:e},p=e.utils.unwrapObservable(d.valueProperty),g=function(e){return p?e[p]:u(e)},h=e.utils.unwrapObservable(d.childrenProperty),m=function(e){return h?e[h]:null},b=e.observable("browse"),f=e.computed(function(){return"browse"===b()}),v=e.computed(function(){return"search"===b()}),y=[],_=e.utils.unwrapObservable(d.items),w=e.observableArray(),S=e.observableArray(),k=t(window),x=t(n),C=t('<div data-bind="template: \'autocomplete-flyout-template\'" class="autocomplete-flyout-wrap"/>').appendTo("body"),T=e.observable(),E=e.observable(),P=e.observable(),D=e.observable(),I=e.observable(!1);I.subscribe(function(e){if(e){var n=x.offset(),i=k[0].innerHeight||document.documentElement.clientHeight,a=k.scrollTop(),r=n.top+x.outerHeight();T(n.left+"px"),E(r+"px"),P(i-r+a+"px");var o=0;x.parents().each(function(){var e=parseFloat(t(this).css("z-index"));e&&(o=Math.max(o,e))}),o&&D(o+1)}});var A=!1;x.on("click.autocomplete",function(){I(!0)}),x.on("focus.autocomplete",function(){I(!0)}),x.on("blur.autocomplete",function(){A?(x.focus(),A=!1):(v()&&(x.val(""),d.value(null),b("browse")),I(!1))}),t(window).on("mousedown.autocomplete",function(e){A=!1,e.target!==n&&(e.target===C[0]||t.contains(C[0],e.target)?(e.preventDefault(),x.focus(),A=!0):I(!1))}),x.on("input.autocomplete",function(){function e(t){var n=[];return t.forEach(function(t){for(var i,a=[];i=r.exec(u(t));)a.push({index:i.index,text:i[1]});a.length&&n.push(new s(t,a));var o=m(t);o&&(n=n.concat(e(o)))}),n}a(),y=[];var t=(x.val()||"").replace(/^\s+|\s+$/g,"");if(!t)return void l(null,null,!0);var n=t.split(/[\s,;]/).map(function(e){return e.replace(/^\s+|\s+$/g,"")}).filter(function(e){return!!e.length}),i=n.map(function(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}).join("|"),r=new RegExp("\\b("+i+")","gi");w(e(_)),b("search"),I(!0)}),x.on("keydown.autocomplete",function(e){switch(e.which){case 38:if(y.length){a();var t=y.pop();if(t.idx)return t.idx--,t.list[t.idx].isHighlighted(!0),y.push(t),!1;if(t=y.pop())return t.list[t.idx].isHighlighted(!0),y.push(t),!1}y=[];var n=f()?S():w();if(n.length){y.push({list:n,idx:n.length-1});for(var i=n[n.length-1];i.children&&i.children.length;)y.push({list:i.children,idx:i.children.length-1}),i=i.children[i.children.length-1];i.isHighlighted(!0)}return!1;case 40:if(y.length){a();var t=y[y.length-1],r=t.list[t.idx];if(r.children&&r.children.length){var o=r.children;return y.push({list:o,idx:0}),o[0].isHighlighted(!0),!1}for(;t=y.pop();)if(t.idx+1<t.list.length)return t.idx++,y.push(t),t.list[t.idx].isHighlighted(!0),!1}var s=f()?S():w();return s.length&&(s[0].isHighlighted(!0),y=[{list:s,idx:0}]),!1;case 13:if(y.length){var l=y[y.length-1];l.list[l.idx].select()}else I(!1);return!1}return!0}),d.value.subscribe(r),r();var M={isOpen:I,isBrowseMode:f,isSearchMode:v,searchMatches:w,browseItems:S,top:E,left:T,maxHeight:P,zIndex:D};e.applyBindings(M,C[0]),e.utils.domNodeDisposal.addDisposeCallback(n,function(){k.off("click.autocomplete"),C.remove()})}},e.bindingHandlers.scrollIntoView={update:function(e,n){var i=n();if(i){var a=t(e),r=a.position(),o=a.outerHeight(),s=a.parents(i.container),l=s.scrollTop(),d=s.height();r.top<0?s.scrollTop(r.top+l):d<r.top+o&&s.scrollTop(r.top+l+o-d)}}}}),define("common/napsoc/industryPicker",["knockout","/i18n/resources/client","businessCategories","common/ui/autocomplete"],function(e,t,n){e.bindingHandlers.industryPicker={init:function(i,a){var r=a(),o={value:r.value,items:n,allCategoriesLabel:t.resources.Client__All_Categories,valueProperty:"Id",textProperty:"Name",childrenProperty:"Children"};e.bindingHandlers.autocomplete.init(i,function(){return o})}}}),define("common/ui/flyout",["knockout","jquery","wsbcore","wsbcore/context","wsbcore/flyout"],function(e,t,n){function i(i,a){var r=t(i),o=t('<div style="display: none"/>').attr("data-bind",'template: "'+e.utils.unwrapObservable(a.template)+'"'),s=e.isObservable(a.isOpen),l=e.utils.unwrapObservable(a.inDialog),d=e.utils.unwrapObservable(a.clickBubble),c=!!e.utils.unwrapObservable(a.closeOnScroll);if(c)var u=function(){o&&o.sfContext&&o.sfContext("close")};var p=null;return o.sfContext({anchor:r,positionIdeal:e.utils.unwrapObservable(a.position),centerAgainstAnchor:a.centerAgainstAnchor?e.utils.unwrapObservable(a.centerAgainstAnchor):!0,singleInstanceOnly:e.utils.unwrapObservable(a.dismissOtherFlyouts),autoOpen:e.utils.unwrapObservable(a.autoOpen),closeOnBlur:e.utils.unwrapObservable(a.closeOnBlur),blurTrigger:"mousedown",ignoreWindowChanges:e.utils.unwrapObservable(a.ignoreWindowChanges),width:e.utils.unwrapObservable(a.width),onOpen:function(){var d=o.parents(".sf-flyout");if(l){t(".sflayer-dialog").append(d);var g=n.util.zIndex.getLayerForElement(d),h=n.util.zIndex.maxForLayer(g)+1;d.css("z-index",h);var m=r.parents(".sf-dialog,.sf-flyout"),b=function(){p=setTimeout(function(){t.contains(document.documentElement,i)?m.filter(":visible").length?b():o.sfContext("close"):o.sfContext("destroy")},100)};b()}c&&t(window).bind("scroll",u).bind("resize",u),a.cssClass&&d.addClass(e.utils.unwrapObservable(a.cssClass)),a.open&&a.open(o),s&&a.isOpen(!0),t("input",o).length&&setTimeout(function(){t("input",o).unbind("focus.sfd")},0)},onClose:function(){c&&t(window).unbind("scroll",u).unbind("resize",u),s&&a.isOpen(!1),p&&(clearTimeout(p),p=null);var e=a.onClose;t.isFunction(e)&&e()}}),s&&a.isOpen.subscribe(function(e){o.sfContext(e?"open":"close")}),e.applyBindings(e.dataFor(i),o[0]),d===!1&&r.bind("click",function(e){e.stopImmediatePropagation()}),e.utils.domNodeDisposal.addDisposeCallback(i,function(){try{o&&o.sfContext("destroy"),c&&t(window).unbind("scroll",u).unbind("resize",u)}catch(e){}}),o}e.bindingHandlers.flyout={init:function(n,i){var a=i(),r=t(n),o=t("<div/>").addClass(e.utils.unwrapObservable(a.cssClass)).attr("data-bind","template: '"+e.utils.unwrapObservable(a.template)+"'"),s=!1,l={mode:"tab",anchor:r,autoOpen:!1,dialogWidthIdeal:a.width?e.utils.unwrapObservable(a.width):r.width(),destroyOnClose:!1,tipPosition:"ul",sticky:!1,positionPath:"axis",fallbackOnFailPosition:"auto",boxShadowAdjustment:5,dialogBoxShadowAdjustment:5,closeOnBlur:!0,blurTrigger:"click",client:"sf-dropmenu",className:"sf-dropmenu",singleClientInstance:!0,ignoreWindowChanges:!1,closeTimeoutInterval:void 0,centerAgainstAnchor:!1,onOpen:function(){s||(e.applyBindings(e.utils.unwrapObservable(a.viewModel),o[0]),s=!0),a.onOpen&&a.onOpen(o)}};setTimeout(function(){o.sfFlyout(l)},1),e.utils.domNodeDisposal.addDisposeCallback(n,function(){try{o.sfFlyout({destroy:!0})}catch(e){}})}},e.bindingHandlers.contextFlyout={init:function(n,a){var r=a(),o=e.utils.unwrapObservable(r.anchor);if(o){var s=null;r.autoOpen=!0,t(n).on("click",o,function(e){s&&s.sfContext("destroy"),s=i(e.target,r),s.sfContext("reposition")})}else i(n,r)}}}),define("common/geo/googleMapBinding",["knockout"],function(e){var t=!1;e.bindingHandlers.googleMap={update:function(n,i){var a=e.unwrap(i()),r=e.unwrap(a.address)||"",o=e.toJS(a.mapOptions)||{};require(["common/geo/mapGenerator"],function(e){t||(t=!0,e.runEditorMode()),e.drawMap(n,r,o)})}}}),define("designer/app/builder/ui/controls/siteSettings/napsocSettings",["jquery","knockout","appconfig","napsoc","userData","common/social/oauth/social.oauth","common/regexhelper/regexhelper","common/stats/googleanalytics","/i18n/resources/client","common/ui/dialog","common/abTesting/abTesting","common/util/stringHelper","common/geo/getClosestGeoLocation","common/util/localeHelper","libs/knockout/ko.addins_v2","common/geo/placesAutocomplete","common/napsoc/industryPicker","common/ui/flyout","common/geo/googleMapBinding"],function(e,t,n,i,a,r,o,s,l,d,c,u,p,g){function h(d){function h(e){e!==!0&&O()||V.openAuthWindow()}function m(e){V.getPages(function(e){if(N.removeAll(),e&&e.length){for(var t in e)N.push({Name:e[t].Name,Link:e[t].Link});B(!0),f(i.observables().FacebookUrl())}else B(!1)},e===!0)}function f(e){var t=!1,n=N();if(n&&n.length)for(var i in n)if(n[i].Link==e){A(n[i]),t=!0;break}L(t)}function v(e){e!==!0&&z()||j.openAuthWindow()}function y(){j.getUsername(function(e){e?M(e):(M(""),j.removeAuth())},!0)}function _(){G(!1)}function w(){s.trackEvent("wsb-setup-napsoc","open-map","icon")}function S(){var e=i.observables();T(e.Name()),E(e.Address()),P(e.FormattedStreetAddress()),D(e.Phone()),b(e.BusinessCategoryId()),I(e.Email()),M(e.TwitterUsername()),f(e.FacebookUrl())}function k(){s.trackEvent("wsb-setup-napsoc","open-mightycall","link");var t=encodeURIComponent(I()),i=n.mightyCallUrl+"?email="+t,a=u.htmlEncode(i);e('<iframe src="'+a+'" style="width: 670px;" class="wsb-setup-napsoc-mightycall-iframe" />').wsbDialog({title:l.resources.MightyCall_Modal_Title,autoResize:!0,buttons:[{text:l.resources.Close,cancel:!0}],onClose:function(e,t){s.trackEvent("wsb-setup-napsoc","close-mightycall",t?"icon":"link")}})}function x(e){var t={SiteName:T(),EmailAddress:I(),StreetAddress:E(),PhoneNumber:D(),FacebookUrl:L()?A().Link:"",Twitter:M(),BusinessCategoryId:b()};P()?(t.FormattedStreetAddress=P(),e(t)):p.getClosestStreetAddress(E(),function(n){t.FormattedStreetAddress=n,e(t)})}d=d||{};var C={address:"Scottsdale, AZ",zoom:14},T=t.observable(""),E=t.observable(""),P=t.observable(""),D=t.observable(""),I=t.observable(""),A=t.observable(""),M=t.observable(""),O=t.observable(""),L=t.observable(!1),N=t.observableArray(),B=t.observable(""),F=t.observable(!0);F.extend({notify:"always"}),F.subscribe(function(e){var t=E();t&&(e?p.getClosestStreetAddress(t,function(e){P(e)}):P(t))});var R=t.computed(function(){return P()||E()||C.address}),H=t.computed(function(){return d.isInDialog?!1:g.isMightyCallLocale&&"enabled"===c.getOption("mightyCall")?!a.isReseller:!1}),V=r("facebook");V.bind("auth",function(){O(!0),m(!0)}).bind("unauth",function(){O(!1),L(!1)}),O(V.isAuth),O()&&m();var z=t.observable(""),j=r("twitter");j.bind("auth",function(){y(),z(!0)}).bind("unauth",function(){z(!1)}),z(j.isAuth),S();var U=t.computed(function(){var e=I();return Boolean(e&&o.validateEmailAddress(e))}).extend({throttle:{type:"debounce",delay:500}}),W=t.computed(function(){return U()?"":l.resources.Client__Napsoc_EmailFormatValidationMessage}),q=t.computed(function(){return T()?"":l.resources.Client__Napsoc_SiteNameRequiredValidationMessage}),$=t.observable(),G=t.observable(!1),K=t.computed(function(){return T()&&T().length>0&&T().trim().length>0&&U()}),Y={Server__Required_fields:l.resources.Server__Required_fields,Server__Site_name:l.resources.Server__Site_name,Server__Napsoc_SiteNameRationale:l.resources.Server__Napsoc_SiteNameRationale,Server__Napsoc_EmailRationale:l.resources.Server__Napsoc_EmailRationale,Server__Email_address:l.resources.Server__Email_address,Server__Napsoc_BusinessCategoryLabel:l.resources.Server__Napsoc_BusinessCategoryLabel,Server__Napsoc_BusinessCategoryRationale:l.resources.Server__Napsoc_BusinessCategoryRationale,Server__Address:l.resources.Server__Address,Server__Napsoc_AddressRationale:l.resources.Server__Napsoc_AddressRationale,Server__Phone_number:l.resources.Server__Phone_number,Server__Napsoc_PhoneNumberRationale:l.resources.Server__Napsoc_PhoneNumberRationale,Server__Napsoc_AddressPrivacyCheckboxLabel:l.resources.Server__Napsoc_AddressPrivacyCheckboxLabel,Server__Napsoc_PhoneNumberPrivacyCheckboxLabel:l.resources.Server__Napsoc_PhoneNumberPrivacyCheckboxLabel,Server__Social:l.resources.Server__Social,Server__People_can_like_your_page_wth_one_click:l.resources.Server__People_can_like_your_page_wth_one_click,Server__Connected_to_Twitter:l.resources.Server__Connected_to_Twitter,Server__Connect_to_Twitter:l.resources.Server__Connect_to_Twitter,Server__Connected_to_Facebook:l.resources.Server__Connected_to_Facebook,Server__Connect_to_Facebook:l.resources.Server__Connect_to_Facebook,Server__You_dont_have_any_pages_for_people_to_like:l.resources.Server__You_dont_have_any_pages_for_people_to_like,Server__Note_colon:l.resources.Server__Note_colon,Server__ExternalHelpLinkText:l.resources.Server__ExternalHelpLinkText,Server__Use_with_like_box:l.resources.Server__Use_with_like_box,Close:l.resources.Close};return{siteName:T,streetAddress:E,phoneNumber:D,businessCategoryId:b,emailAddress:I,emailAddressValid:U,emailAddressErrorMessage:W,siteNameErrorMessage:q,facebookPage:A,facebookPages:N,facebookIsAuth:O,hasFacebookPages:B,useFacebookPage:L,gaCategory:d.gaCategory,isInDialog:d.isInDialog,needsFormatted:F,mapAddress:R,searchBounds:$,onGeolocationFlyoutOpen:w,isMapOpen:G,closeMap:_,twitterUsername:M,twitterIsAuth:z,authTwitter:v,authFacebook:h,isValid:K,reset:S,launchMightyCall:k,showMightyCallLink:H,Strings:Y,getSettings:x}}function m(){var e=i.observables();b(e.BusinessCategoryId())}var b=t.observable();return{createViewModel:h,resetCategory:m}}),define("text!designer/app/builder/ui/controls/media/chooser/media.chooser.html",[],function(){return'\r\n\r\n<!--  Media Chooser -->\r\n<div id="wsb-media-chooser" style="width: 760px;">\r\n    \r\n    <!-- ko if: isViewingLocalizedTheme -->\r\n        <div data-bind="html: localizedThemeNotice, alertMessage: { style: \'info\', isClosable: false }"></div>\r\n    <!-- /ko -->\r\n    \r\n    <div class="wsb-media-chooser-content-area">\r\n        <!--  Tabs -->\r\n        <div class="wsb-media-chooser-tabs">\r\n            <ul data-bind="foreach: tabs">\r\n                <li data-bind="css: cssClasses, click: select">\r\n                    <span></span>\r\n                    <!-- ko text: name --><!-- /ko -->\r\n                </li>\r\n            </ul>\r\n        </div>\r\n\r\n        <!--  Content -->\r\n        <div class="wsb-media-chooser-content">\r\n            <div class="wsb-media-chooser-uploader" data-bind="visible: currentTab() == \'uploaded\'"></div>\r\n            <div class="wsb-media-chooser-messages" data-bind="visible: currentTab() == \'uploaded\'"></div>\r\n            <div class="wsb-media-chooser-archived" data-bind="visible: currentTab() == \'archived\', html: i18Dict.YouCanRestoreArchived"></div>\r\n            <div class="wsb-media-chooser-filters">\r\n                <!-- ko if: currentTab() == \'uploaded\' && filters().length > 1 -->\r\n                    <div class="wsb-media-chooser-filter-uploaded" data-bind="foreach: filters">\r\n                        <span data-bind="\r\n                            text: name,\r\n                            css: {\r\n                                selected: $parent.filterSelected(filter),\r\n                                up: $parent.filterSelected(filter) && $parent.filterReversed(),\r\n                                down: $parent.filterSelected(filter) && !$parent.filterReversed(),\r\n                            },\r\n                            click: $parent.setFilter">\r\n                        </span>\r\n                        <!-- ko if: $index() < $parent.filters().length - 1 --> | <!-- /ko -->\r\n                    </div>\r\n                <!-- /ko -->\r\n                <!-- ko if: currentTab() == \'stock\' -->\r\n                    <!-- ko with: stockFilter.filter -->\r\n                        <!-- ko if: categories().length -->\r\n                            <div class="wsb-media-chooser-filter-stock">\r\n                                <form data-bind="submit: search">\r\n                                    <input type="text" class="wsb-text-box" data-bind="value: term" />\r\n                                    <button type="submit" class="btn btn-inverse-grey" data-bind="html: i18Dict.Search"></button>\r\n                                    <select class="wsb-select-box" data-bind="\r\n                                    options: categories,\r\n                                    optionsText: \'Name\',\r\n                                    optionsValue: \'Id\',\r\n                                    value: categoryId"></select>\r\n                                </form>\r\n                            </div>\r\n                        <!-- /ko -->\r\n                    <!-- /ko -->\r\n                <!-- /ko -->\r\n                <!-- ko if: currentTab() == \'facebook\' && !showAuth() -->\r\n                    <!-- ko with: facebookFilter.filter -->\r\n                        <!-- ko if: pages().length -->\r\n                            <div class="wsb-media-chooser-filter-facebook clearfix">\r\n                                <select class="wsb-select-box wsb-fb-page-select" data-bind="\r\n                                options: pages,\r\n                                optionsText: \'Name\',\r\n                                optionsValue: \'Id\',\r\n                                value: pageId"></select>\r\n                                <!-- ko if: albums().length -->\r\n                                    <div class="wsb-facebook-album-select">\r\n                                        <label data-bind="text: $root.i18Dict.SelectAlbum"></label>\r\n                                        <select class="wsb-select-box" data-bind="\r\n                                        options: albums,\r\n                                        optionsText: \'Name\',\r\n                                        optionsValue: \'Id\',\r\n                                        value: albumId"></select>\r\n                                    </div>\r\n                                <!-- /ko -->\r\n                                <!-- ko if: !albums().length -->\r\n                                <span data-bind="text: $root.i18Dict.NoAlbums"></span>\r\n                                <!-- /ko -->\r\n                            </div>\r\n                        <!-- /ko -->\r\n                    <!-- /ko -->\r\n                <!-- /ko -->\r\n            </div>\r\n            <div class="wsb-media-chooser-list">\r\n                <!-- ko if: list().length -->\r\n                <ul data-bind="\r\n                        template: {\r\n                            name: getTemplate,\r\n                            foreach: throttledList,\r\n                            afterRender: loadAsset\r\n                        },\r\n                        event: { scroll: scrolled }">\r\n                </ul>\r\n                <!-- /ko -->\r\n                <!-- ko if: showAuth() -->\r\n                    <div class="wsb-media-chooser-list-overlay" data-bind="template: { name: \'wsb-media-chooser-social-\' + currentTab() }">\r\n                    </div>\r\n                <!-- /ko -->\r\n                <!-- ko if: !list().length && !showAuth() -->\r\n                    <div class="wsb-media-chooser-list-overlay">\r\n                        <div class="wsb-media-chooser-list-overlay-message" data-bind="text: i18Dict.NoItemsToDisplay"></div>\r\n                    </div>\r\n                <!-- /ko -->\r\n            </div>\r\n            <!-- ko if: showCarousel() -->\r\n                <div class="wsb-media-chooser-carousel" data-bind="visible: showCarousel()">\r\n                    <span data-bind="css: { enabled: carouselLeftEnabled() }, click: carouselLeft"></span>\r\n                    <p data-bind="visible: !selected().length, text: i18Dict.ZeroSelectedImages"></p>\r\n                    <div data-bind="visible: selected().length">\r\n                        <ul data-bind="foreach: { data: selected, afterRender: loadAsset }">\r\n                            <li data-bind="attr: { title: (($data.extension) ? (name() + \' (\' + extension.toUpperCase() + \')\') : false )}">\r\n                                <div class="loading"></div>\r\n                                <span class="toggle" data-bind="click: $parent.select, attr: { title: $parent.i18DictCopy[\'Server__Unselect\'] }"></span>\r\n                            </li>\r\n                        </ul>\r\n                    </div>\r\n                    <span data-bind="css: { enabled: carouselRightEnabled() }, click: carouselRight"></span>\r\n                </div>\r\n            <!-- /ko -->\r\n        </div>\r\n    </div>\r\n\r\n    <!--  File Info -->\r\n    <!-- ko if: isEditingMode -->  \r\n        <div class="wsb-media-chooser-info" style="display:none;">\r\n            <div class="wsb-media-chooser-info-path" data-bind="text: selectedPath"></div>\r\n        </div>\r\n    <!-- /ko -->\r\n</div>\r\n\r\n<!--  Progress Bar for Drag/Dropped files --> \r\n<div id="wsb-media-chooser-progress">\r\n    <div>\r\n        <span data-bind="style: { width: uploadPercentWidth() }"></span>\r\n    </div>\r\n    <span data-bind="text: uploadPercent"></span>\r\n</div>\r\n\r\n<!--  Templates --> \r\n<script type="text/html" id="wsb-media-chooser-template-default">\r\n    <li class="default" data-bind="css: { selected: $parent.selected.indexOf($data) >= 0 }, click: $parent.select">\r\n        <div class="loading"></div>\r\n        <span class="toggle" data-bind="attr: { title: $parent.i18DictCopy[\'Server__Unselect\'] }"></span>\r\n    </li>\r\n</script>\r\n<script type="text/html" id="wsb-media-chooser-template-image">\r\n    <li class="image" data-bind="css: { selected: $parent.selected.indexOf($data) >= 0 }, click: $parent.select">\r\n        <div class="loading"></div>\r\n        <span class="toggle" data-bind="attr: { title: $parent.i18DictCopy[\'Server__Unselect\'] }"></span>\r\n        <!-- ko if: $parent.showDeleteButton() -->\r\n        <span class="trash" data-bind="click: $parent.delete, clickBubble: false, attr: { title: $parent.i18DictCopy[\'Delete\'] }"></span>\r\n        <!-- /ko -->\r\n    </li>\r\n</script>\r\n<script type="text/html" id="wsb-media-chooser-template-document">\r\n    <li class="document" data-bind="css: { selected: $parent.selected.indexOf($data) >= 0 }, click: $parent.select, attr: { title: name() + ((extension) ? \' (\' + extension.toUpperCase() + \')\' : \'\') }">\r\n        <div class="loading"></div>\r\n        <p data-bind="text: name"></p>\r\n        <span class="toggle"data-bind="attr: { title: $parent.i18DictCopy[\'Server__Unselect\'] }"></span>\r\n        <!-- ko if: $parent.showDeleteButton -->\r\n            <span class="trash" data-bind="click: $parent.delete, clickBubble: false, attr: { title: $parent.i18DictCopy[\'Delete\'] }"></span>\r\n        <!-- /ko -->\r\n        <!-- ko if: $parent.showRenameButton -->\r\n            <span class="rename" data-bind="contextFlyout: {\r\n                template: \'wsb-media-chooser-template-rename\',\r\n                cssClass: \'wsb-media-chooser-flyout-rename\',\r\n                open: renamer.onOpen,\r\n                isOpen: renamer.isOpen,\r\n                width: 350,\r\n                position: \'uc\',\r\n                dismissOtherFlyouts: true,\r\n                clickBubble: false,\r\n                inDialog: true\r\n            }, attr: { title: $parent.i18DictCopy[\'Server__Rename\'] }"></span>\r\n        <!-- /ko -->\r\n    </li>\r\n</script>\r\n<script type="text/html" id="wsb-media-chooser-template-rename">\r\n    <form data-bind="submit: renamer.save, css: type">\r\n        <p data-bind="text: renamer.error, visible: renamer.error() != \'\'"></p>\r\n        <!-- ko if: type === "document" -->\r\n        <span class="caption" data-bind="attr: { title: i18DictCopy[\'Server__File_label\'] }"></span>\r\n        <input type="text" class="wsb-text-box" data-bind="value: newName, valueUpdate: \'input\', attr: { placeholder: i18DictCopy[\'Server__File_label\'] }" />\r\n        <!-- /ko -->\r\n        <!-- ko if: type === "audio" -->\r\n        <span class="wsb-media-track-name" data-bind="attr: { title: i18DictCopy[\'Server__Track_name\'] }"></span>\r\n        <input type="text" class="wsb-text-box" data-bind="value: newName, valueUpdate: \'input\', attr: { placeholder: i18DictCopy[\'Server__Track_name\'] }" />\r\n        <span class="wsb-media-track-author" data-bind="attr: { title: i18DictCopy[\'Server__Author_slash_artist_name\'] }"></span>\r\n        <input type="text" class="wsb-text-box" data-bind="value: newAuthor, valueUpdate: \'input\', attr: { placeholder: i18DictCopy[\'Server__Author_slash_artist_name\'] }" />\r\n        <!-- /ko -->\r\n        <div>\r\n            <button type="submit" class="btn btn-success" data-bind="css: { disabled: !isValid() }, text: i18Dict.Ok"></button>\r\n            <span class="sf-dialog-link" data-bind="event: { click: renamer.close }, text: i18Dict.Cancel"></span>\r\n        </div>\r\n    </form>\r\n</script>\r\n<script type="text/html" id="wsb-media-chooser-social-facebook">\r\n    <span class="social-btn-facebook social-btn-connect" data-bind="click: openAuth">\r\n        <i class="icon-wsb-white icon-fb"></i><span data-bind="text: i18Dict.ConnectToFacebook"></span>\r\n    </span>\r\n    <div class="wsb-media-chooser-list-overlay-message" data-bind="html: i18Dict.YouMustAuthorizeForFacebook">\r\n\r\n    </div>\r\n</script>\r\n<script type="text/html" id="wsb-media-chooser-social-instagram">\r\n    <span class="social-btn-instagram social-btn-connect" data-bind="click: openAuth">\r\n        <i class="icon-wsb-white icon-instagram"></i><span data-bind="text: i18Dict.ConnectToInstagram"></span>\r\n    </span>\r\n    <div class="wsb-media-chooser-list-overlay-message" data-bind="html: i18Dict.YouMustAuthorizeForInstagram">\r\n    </div>\r\n</script>'}),define("common/util/throttledArray",["knockout"],function(e){function t(t,n){var i=e.computed(function(){function i(){a(o.slice(0,r+=n)),r<o.length&&window.requestAnimationFrame(i)}var a=e.observableArray([]);n=n||20;var r=0,o=t();return i(),a});return e.computed(function(){var e=i();return e()})}return t}),function(){!function(e){var t=this||(0,eval)("this"),n=t.document,i=t.navigator,a=t.jQuery,r=t.JSON;!function(e){if("function"==typeof require&&"object"==typeof exports&&"object"==typeof module){var n=module.exports||exports;e(n)}else"function"==typeof define&&define.amd&&define("libs/knockout/knockout",["exports"],e);e(t.ko={})}(function(o){function s(e){var t=this;return e&&u.utils.objectForEach(e,function(e,n){var i=u.extenders[e];"function"==typeof i&&(t=i(t,n)||t)}),t}function l(e){u.bindingHandlers[e]={init:function(t,n,i,a){var r=function(){var t={};return t[e]=n(),t};return u.bindingHandlers.event.init.call(this,t,r,i,a)}}}function d(e,t,n,i){u.bindingHandlers[e]={init:function(e){return u.utils.domData.set(e,_,{}),{controlsDescendantBindings:!0}},update:function(e,a,r,o,s){var l=u.utils.domData.get(e,_),d=u.utils.unwrapObservable(a()),c=!n!=!d,p=!l.savedNodes,g=p||t||c!==l.didDisplayOnLastUpdate;g&&(p&&(l.savedNodes=u.utils.cloneNodes(u.virtualElements.childNodes(e),!0)),c?(p||u.virtualElements.setDomNodeChildren(e,u.utils.cloneNodes(l.savedNodes)),u.applyBindingsToDescendants(i?i(s,d):s,e)):u.virtualElements.emptyNode(e),l.didDisplayOnLastUpdate=c)}},u.expressionRewriting.bindingRewriteValidators[e]=!1,u.virtualElements.allowedBindings[e]=!0}function c(e,t,n){n&&t!==u.selectExtensions.readValue(e)&&u.selectExtensions.writeValue(e,t),t!==u.selectExtensions.readValue(e)&&u.dependencyDetection.ignore(u.utils.triggerEvent,null,[e,"change"])}var u="undefined"!=typeof o?o:{};u.exportSymbol=function(e,t){for(var n=e.split("."),i=u,a=0;a<n.length-1;a++)i=i[n[a]];i[n[n.length-1]]=t},u.exportProperty=function(e,t,n){e[t]=n},u.version="2.3.0",u.exportSymbol("version",u.version),u.utils=function(){function o(e,t){if("input"!==u.utils.tagNameLower(e)||!e.type)return!1;
if("click"!=t.toLowerCase())return!1;var n=e.type;return"checkbox"==n||"radio"==n}var s=function(e,t){for(var n in e)e.hasOwnProperty(n)&&t(n,e[n])},l={},d={},c=i&&/Firefox\/2/i.test(i.userAgent)?"KeyboardEvent":"UIEvents";l[c]=["keyup","keydown","keypress"],l.MouseEvents=["click","dblclick","mousedown","mouseup","mousemove","mouseover","mouseout","mouseenter","mouseleave"],s(l,function(e,t){if(t.length)for(var n=0,i=t.length;i>n;n++)d[t[n]]=e});var p={propertychange:!0},g=n&&function(){for(var t=3,i=n.createElement("div"),a=i.getElementsByTagName("i");i.innerHTML="<!--[if gt IE "+ ++t+"]><i></i><![endif]-->",a[0];);return t>4?t:e}(),h=6===g,m=7===g;return{fieldsIncludedWithJsonPost:["authenticity_token",/^__RequestVerificationToken(_.*)?$/],arrayForEach:function(e,t){for(var n=0,i=e.length;i>n;n++)t(e[n])},arrayIndexOf:function(e,t){if("function"==typeof Array.prototype.indexOf)return Array.prototype.indexOf.call(e,t);for(var n=0,i=e.length;i>n;n++)if(e[n]===t)return n;return-1},arrayFirst:function(e,t,n){for(var i=0,a=e.length;a>i;i++)if(t.call(n,e[i]))return e[i];return null},arrayRemoveItem:function(e,t){var n=u.utils.arrayIndexOf(e,t);n>=0&&e.splice(n,1)},arrayGetDistinctValues:function(e){e=e||[];for(var t=[],n=0,i=e.length;i>n;n++)u.utils.arrayIndexOf(t,e[n])<0&&t.push(e[n]);return t},arrayMap:function(e,t){e=e||[];for(var n=[],i=0,a=e.length;a>i;i++)n.push(t(e[i]));return n},arrayFilter:function(e,t){e=e||[];for(var n=[],i=0,a=e.length;a>i;i++)t(e[i])&&n.push(e[i]);return n},arrayPushAll:function(e,t){if(t instanceof Array)e.push.apply(e,t);else for(var n=0,i=t.length;i>n;n++)e.push(t[n]);return e},addOrRemoveItem:function(e,t,n){var i=e.indexOf?e.indexOf(t):u.utils.arrayIndexOf(e,t);0>i?n&&e.push(t):n||e.splice(i,1)},extend:function(e,t){if(t)for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},objectForEach:s,emptyDomNode:function(e){for(;e.firstChild;)u.removeNode(e.firstChild)},moveCleanedNodesToContainerElement:function(e){for(var t=u.utils.makeArray(e),i=n.createElement("div"),a=0,r=t.length;r>a;a++)i.appendChild(u.cleanNode(t[a]));return i},cloneNodes:function(e,t){for(var n=0,i=e.length,a=[];i>n;n++){var r=e[n].cloneNode(!0);a.push(t?u.cleanNode(r):r)}return a},setDomNodeChildren:function(e,t){if(u.utils.emptyDomNode(e),t)for(var n=0,i=t.length;i>n;n++)e.appendChild(t[n])},replaceDomNodes:function(e,t){var n=e.nodeType?[e]:e;if(n.length>0){for(var i=n[0],a=i.parentNode,r=0,o=t.length;o>r;r++)a.insertBefore(t[r],i);for(var r=0,o=n.length;o>r;r++)u.removeNode(n[r])}},setOptionNodeSelectionState:function(e,t){7>g?e.setAttribute("selected",t):e.selected=t},stringTrim:function(t){return null===t||t===e?"":t.trim?t.trim():t.toString().replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},stringTokenize:function(e,t){for(var n=[],i=(e||"").split(t),a=0,r=i.length;r>a;a++){var o=u.utils.stringTrim(i[a]);""!==o&&n.push(o)}return n},stringStartsWith:function(e,t){return e=e||"",t.length>e.length?!1:e.substring(0,t.length)===t},domNodeIsContainedBy:function(e,t){if(t.compareDocumentPosition)return 16==(16&t.compareDocumentPosition(e));for(;null!=e;){if(e==t)return!0;e=e.parentNode}return!1},domNodeIsAttachedToDocument:function(e){return u.utils.domNodeIsContainedBy(e,e.ownerDocument)},anyDomNodeIsAttachedToDocument:function(e){return!!u.utils.arrayFirst(e,u.utils.domNodeIsAttachedToDocument)},tagNameLower:function(e){return e&&e.tagName&&e.tagName.toLowerCase()},registerEventHandler:function(e,t,n){var i=g&&p[t];if(i||"undefined"==typeof a)if(i||"function"!=typeof e.addEventListener){if("undefined"==typeof e.attachEvent)throw new Error("Browser doesn't support addEventListener or attachEvent");var r=function(t){n.call(e,t)},s="on"+t;e.attachEvent(s,r),u.utils.domNodeDisposal.addDisposeCallback(e,function(){e.detachEvent(s,r)})}else e.addEventListener(t,n,!1);else{if(o(e,t)){var l=n;n=function(e,t){var n=this.checked;t&&(this.checked=t.checkedStateBeforeEvent!==!0),l.call(this,e),this.checked=n}}a(e).bind(t,n)}},triggerEvent:function(e,i){if(!e||!e.nodeType)throw new Error("element must be a DOM node when calling triggerEvent");if("undefined"!=typeof a){var r=[];o(e,i)&&r.push({checkedStateBeforeEvent:e.checked}),a(e).trigger(i,r)}else if("function"==typeof n.createEvent){if("function"!=typeof e.dispatchEvent)throw new Error("The supplied element doesn't support dispatchEvent");var s=d[i]||"HTMLEvents",l=n.createEvent(s);l.initEvent(i,!0,!0,t,0,0,0,0,0,!1,!1,!1,!1,0,e),e.dispatchEvent(l)}else{if("undefined"==typeof e.fireEvent)throw new Error("Browser doesn't support triggering events");o(e,i)&&(e.checked=e.checked!==!0),e.fireEvent("on"+i)}},unwrapObservable:function(e){return u.isObservable(e)?e():e},peekObservable:function(e){return u.isObservable(e)?e.peek():e},toggleDomNodeCssClass:function(e,t,n){if(t){var i=/\S+/g,a=e.className.match(i)||[];u.utils.arrayForEach(t.match(i),function(e){u.utils.addOrRemoveItem(a,e,n)}),e.className=a.join(" ")}},setTextContent:function(t,i){var a=u.utils.unwrapObservable(i);(null===a||a===e)&&(a="");var r=u.virtualElements.firstChild(t);!r||3!=r.nodeType||u.virtualElements.nextSibling(r)?u.virtualElements.setDomNodeChildren(t,[n.createTextNode(a)]):r.data=a,u.utils.forceRefresh(t)},setElementName:function(e,t){if(e.name=t,7>=g)try{e.mergeAttributes(n.createElement("<input name='"+e.name+"'/>"),!1)}catch(i){}},forceRefresh:function(e){if(g>=9){var t=1==e.nodeType?e:e.parentNode;t.style&&(t.style.zoom=t.style.zoom)}},ensureSelectElementIsRenderedCorrectly:function(e){if(g){var t=e.style.width;e.style.width=0,e.style.width=t}},range:function(e,t){e=u.utils.unwrapObservable(e),t=u.utils.unwrapObservable(t);for(var n=[],i=e;t>=i;i++)n.push(i);return n},makeArray:function(e){for(var t=[],n=0,i=e.length;i>n;n++)t.push(e[n]);return t},isIe6:h,isIe7:m,ieVersion:g,getFormFields:function(e,t){for(var n=u.utils.makeArray(e.getElementsByTagName("input")).concat(u.utils.makeArray(e.getElementsByTagName("textarea"))),i="string"==typeof t?function(e){return e.name===t}:function(e){return t.test(e.name)},a=[],r=n.length-1;r>=0;r--)i(n[r])&&a.push(n[r]);return a},parseJson:function(e){return"string"==typeof e&&(e=u.utils.stringTrim(e))?r&&r.parse?r.parse(e):new Function("return "+e)():null},stringifyJson:function(e,t,n){if(!r||!r.stringify)throw new Error("Cannot find JSON.stringify(). Some browsers (e.g., IE < 8) don't support it natively, but you can overcome this by adding a script reference to json2.js, downloadable from http://www.json.org/json2.js");return r.stringify(u.utils.unwrapObservable(e),t,n)},postJson:function(e,t,i){i=i||{};var a=i.params||{},r=i.includeFields||this.fieldsIncludedWithJsonPost,o=e;if("object"==typeof e&&"form"===u.utils.tagNameLower(e)){var l=e;o=l.action;for(var d=r.length-1;d>=0;d--)for(var c=u.utils.getFormFields(l,r[d]),p=c.length-1;p>=0;p--)a[c[p].name]=c[p].value}t=u.utils.unwrapObservable(t);var g=n.createElement("form");g.style.display="none",g.action=o,g.method="post";for(var h in t){var m=n.createElement("input");m.name=h,m.value=u.utils.stringifyJson(u.utils.unwrapObservable(t[h])),g.appendChild(m)}s(a,function(e,t){var i=n.createElement("input");i.name=e,i.value=t,g.appendChild(i)}),n.body.appendChild(g),i.submitter?i.submitter(g):g.submit(),setTimeout(function(){g.parentNode.removeChild(g)},0)}}}(),u.exportSymbol("utils",u.utils),u.exportSymbol("utils.arrayForEach",u.utils.arrayForEach),u.exportSymbol("utils.arrayFirst",u.utils.arrayFirst),u.exportSymbol("utils.arrayFilter",u.utils.arrayFilter),u.exportSymbol("utils.arrayGetDistinctValues",u.utils.arrayGetDistinctValues),u.exportSymbol("utils.arrayIndexOf",u.utils.arrayIndexOf),u.exportSymbol("utils.arrayMap",u.utils.arrayMap),u.exportSymbol("utils.arrayPushAll",u.utils.arrayPushAll),u.exportSymbol("utils.arrayRemoveItem",u.utils.arrayRemoveItem),u.exportSymbol("utils.extend",u.utils.extend),u.exportSymbol("utils.fieldsIncludedWithJsonPost",u.utils.fieldsIncludedWithJsonPost),u.exportSymbol("utils.getFormFields",u.utils.getFormFields),u.exportSymbol("utils.peekObservable",u.utils.peekObservable),u.exportSymbol("utils.postJson",u.utils.postJson),u.exportSymbol("utils.parseJson",u.utils.parseJson),u.exportSymbol("utils.registerEventHandler",u.utils.registerEventHandler),u.exportSymbol("utils.stringifyJson",u.utils.stringifyJson),u.exportSymbol("utils.range",u.utils.range),u.exportSymbol("utils.toggleDomNodeCssClass",u.utils.toggleDomNodeCssClass),u.exportSymbol("utils.triggerEvent",u.utils.triggerEvent),u.exportSymbol("utils.unwrapObservable",u.utils.unwrapObservable),u.exportSymbol("utils.objectForEach",u.utils.objectForEach),u.exportSymbol("utils.addOrRemoveItem",u.utils.addOrRemoveItem),u.exportSymbol("unwrap",u.utils.unwrapObservable),Function.prototype.bind||(Function.prototype.bind=function(e){var t=this,n=Array.prototype.slice.call(arguments),e=n.shift();return function(){return t.apply(e,n.concat(Array.prototype.slice.call(arguments)))}}),u.utils.domData=new function(){var t=0,n="__ko__"+(new Date).getTime(),i={};return{get:function(t,n){var i=u.utils.domData.getAll(t,!1);return i===e?e:i[n]},set:function(t,n,i){if(i!==e||u.utils.domData.getAll(t,!1)!==e){var a=u.utils.domData.getAll(t,!0);a[n]=i}},getAll:function(a,r){var o=a[n],s=o&&"null"!==o&&i[o];if(!s){if(!r)return e;o=a[n]="ko"+t++,i[o]={}}return i[o]},clear:function(e){var t=e[n];return t?(delete i[t],e[n]=null,!0):!1}}},u.exportSymbol("utils.domData",u.utils.domData),u.exportSymbol("utils.domData.clear",u.utils.domData.clear),u.utils.domNodeDisposal=new function(){function t(t,n){var i=u.utils.domData.get(t,o);return i===e&&n&&(i=[],u.utils.domData.set(t,o,i)),i}function n(t){u.utils.domData.set(t,o,e)}function i(e){var n=t(e,!1);if(n){n=n.slice(0);for(var i=0;i<n.length;i++)n[i](e)}u.utils.domData.clear(e),"function"==typeof a&&"function"==typeof a.cleanData&&a.cleanData([e]),l[e.nodeType]&&r(e)}function r(e){for(var t,n=e.firstChild;t=n;)n=t.nextSibling,8===t.nodeType&&i(t)}var o="__ko_domNodeDisposal__"+(new Date).getTime(),s={1:!0,8:!0,9:!0},l={1:!0,9:!0};return{addDisposeCallback:function(e,n){if("function"!=typeof n)throw new Error("Callback must be a function");t(e,!0).push(n)},removeDisposeCallback:function(e,i){var a=t(e,!1);a&&(u.utils.arrayRemoveItem(a,i),0==a.length&&n(e))},cleanNode:function(e){if(s[e.nodeType]&&(i(e),l[e.nodeType])){var t=[];u.utils.arrayPushAll(t,e.getElementsByTagName("*"));for(var n=0,a=t.length;a>n;n++)i(t[n])}return e},removeNode:function(e){u.cleanNode(e),e.parentNode&&e.parentNode.removeChild(e)}}},u.cleanNode=u.utils.domNodeDisposal.cleanNode,u.removeNode=u.utils.domNodeDisposal.removeNode,u.exportSymbol("cleanNode",u.cleanNode),u.exportSymbol("removeNode",u.removeNode),u.exportSymbol("utils.domNodeDisposal",u.utils.domNodeDisposal),u.exportSymbol("utils.domNodeDisposal.addDisposeCallback",u.utils.domNodeDisposal.addDisposeCallback),u.exportSymbol("utils.domNodeDisposal.removeDisposeCallback",u.utils.domNodeDisposal.removeDisposeCallback),function(){function i(e){var i=u.utils.stringTrim(e).toLowerCase(),a=n.createElement("div"),r=i.match(/^<(thead|tbody|tfoot)/)&&[1,"<table>","</table>"]||!i.indexOf("<tr")&&[2,"<table><tbody>","</tbody></table>"]||(!i.indexOf("<td")||!i.indexOf("<th"))&&[3,"<table><tbody><tr>","</tr></tbody></table>"]||[0,"",""],o="ignored<div>"+r[1]+e+r[2]+"</div>";for("function"==typeof t.innerShiv?a.appendChild(t.innerShiv(o)):a.innerHTML=o;r[0]--;)a=a.lastChild;return u.utils.makeArray(a.lastChild.childNodes)}function r(e){if(a.parseHTML)return a.parseHTML(e)||[];var t=a.clean([e]);if(t&&t[0]){for(var n=t[0];n.parentNode&&11!==n.parentNode.nodeType;)n=n.parentNode;n.parentNode&&n.parentNode.removeChild(n)}return t}u.utils.parseHtmlFragment=function(e){return"undefined"!=typeof a?r(e):i(e)},u.utils.setHtml=function(t,n){if(u.utils.emptyDomNode(t),n=u.utils.unwrapObservable(n),null!==n&&n!==e)if("string"!=typeof n&&(n=n.toString()),"undefined"!=typeof a)a(t).html(n);else for(var i=u.utils.parseHtmlFragment(n),r=0;r<i.length;r++)t.appendChild(i[r])}}(),u.exportSymbol("utils.parseHtmlFragment",u.utils.parseHtmlFragment),u.exportSymbol("utils.setHtml",u.utils.setHtml),u.memoization=function(){function t(){return(4294967296*(1+Math.random())|0).toString(16).substring(1)}function n(){return t()+t()}function i(e,t){if(e)if(8==e.nodeType){var n=u.memoization.parseMemoText(e.nodeValue);null!=n&&t.push({domNode:e,memoId:n})}else if(1==e.nodeType)for(var a=0,r=e.childNodes,o=r.length;o>a;a++)i(r[a],t)}var a={};return{memoize:function(e){if("function"!=typeof e)throw new Error("You can only pass a function to ko.memoization.memoize()");var t=n();return a[t]=e,"<!--[ko_memo:"+t+"]-->"},unmemoize:function(t,n){var i=a[t];if(i===e)throw new Error("Couldn't find any memo with ID "+t+". Perhaps it's already been unmemoized.");try{return i.apply(null,n||[]),!0}finally{delete a[t]}},unmemoizeDomNodeAndDescendants:function(e,t){var n=[];i(e,n);for(var a=0,r=n.length;r>a;a++){var o=n[a].domNode,s=[o];t&&u.utils.arrayPushAll(s,t),u.memoization.unmemoize(n[a].memoId,s),o.nodeValue="",o.parentNode&&o.parentNode.removeChild(o)}},parseMemoText:function(e){var t=e.match(/^\[ko_memo\:(.*?)\]$/);return t?t[1]:null}}}(),u.exportSymbol("memoization",u.memoization),u.exportSymbol("memoization.memoize",u.memoization.memoize),u.exportSymbol("memoization.unmemoize",u.memoization.unmemoize),u.exportSymbol("memoization.parseMemoText",u.memoization.parseMemoText),u.exportSymbol("memoization.unmemoizeDomNodeAndDescendants",u.memoization.unmemoizeDomNodeAndDescendants),u.extenders={throttle:function(e,t){var n,i="debounce",a=0,r=!1,o=null;return"number"==typeof t?a=t:(i=t.type,a=t.delay,r=t.noTrailing===!0),(n=a>=0&&("debounce"===i||"throttle"===i))?(e.throttleType=i,e.throttleEvaluation=a,e.throttleNoTrailing=r,u.isWriteableObservable(e)?u.dependentObservable({read:e,write:function(t){clearTimeout(o),o=setTimeout(function(){e(t)},a)}}):e):e},notify:function(e,t){return e.equalityComparer="always"==t?function(){return!1}:u.observable.fn.equalityComparer,e}},u.exportSymbol("extenders",u.extenders),u.subscription=function(e,t,n){this.target=e,this.callback=t,this.disposeCallback=n,u.exportProperty(this,"dispose",this.dispose)},u.subscription.prototype.dispose=function(){this.isDisposed=!0,this.disposeCallback()},u.subscribable=function(){this._subscriptions={},u.utils.extend(this,u.subscribable.fn),u.exportProperty(this,"subscribe",this.subscribe),u.exportProperty(this,"extend",this.extend),u.exportProperty(this,"getSubscriptionsCount",this.getSubscriptionsCount)};var p="change";u.subscribable.fn={subscribe:function(e,t,n){n=n||p;var i=t?e.bind(t):e,a=new u.subscription(this,i,function(){u.utils.arrayRemoveItem(this._subscriptions[n],a)}.bind(this));return this._subscriptions[n]||(this._subscriptions[n]=[]),this._subscriptions[n].push(a),a},notifySubscribers:function(e,t){t=t||p,this._subscriptions[t]&&u.dependencyDetection.ignore(function(){u.utils.arrayForEach(this._subscriptions[t].slice(0),function(t){t&&t.isDisposed!==!0&&t.callback(e)})},this)},getSubscriptionsCount:function(){var e=0;return u.utils.objectForEach(this._subscriptions,function(t,n){e+=n.length}),e},extend:s},u.isSubscribable=function(e){return null!=e&&"function"==typeof e.subscribe&&"function"==typeof e.notifySubscribers},u.exportSymbol("subscribable",u.subscribable),u.exportSymbol("isSubscribable",u.isSubscribable),u.dependencyDetection=function(){var e=[];return{begin:function(t){e.push({callback:t,distinctDependencies:[]})},end:function(){e.pop()},registerDependency:function(t){if(!u.isSubscribable(t))throw new Error("Only subscribable things can act as dependencies");if(e.length>0){var n=e[e.length-1];if(!n||u.utils.arrayIndexOf(n.distinctDependencies,t)>=0)return;n.distinctDependencies.push(t),n.callback(t)}},ignore:function(t,n,i){try{return e.push(null),t.apply(n,i||[])}finally{e.pop()}}}}();var g={undefined:!0,"boolean":!0,number:!0,string:!0};u.observable=function(e){function t(){return arguments.length>0?(t.equalityComparer&&t.equalityComparer(n,arguments[0])||(t.valueWillMutate(),n=arguments[0],t.valueHasMutated()),this):(u.dependencyDetection.registerDependency(t),n)}var n=e;return u.subscribable.call(t),t.peek=function(){return n},t.valueHasMutated=function(){t.notifySubscribers(n)},t.valueWillMutate=function(){t.notifySubscribers(n,"beforeChange")},u.utils.extend(t,u.observable.fn),u.exportProperty(t,"peek",t.peek),u.exportProperty(t,"valueHasMutated",t.valueHasMutated),u.exportProperty(t,"valueWillMutate",t.valueWillMutate),t},u.observable.fn={equalityComparer:function(e,t){var n=null===e||typeof e in g;return n?e===t:!1}};var h=u.observable.protoProperty="__ko_proto__";u.observable.fn[h]=u.observable,u.hasPrototype=function(t,n){return null===t||t===e||t[h]===e?!1:t[h]===n?!0:u.hasPrototype(t[h],n)},u.isObservable=function(e){return u.hasPrototype(e,u.observable)},u.isWriteableObservable=function(e){return"function"==typeof e&&e[h]===u.observable?!0:"function"==typeof e&&e[h]===u.dependentObservable&&e.hasWriteFunction?!0:!1},u.exportSymbol("observable",u.observable),u.exportSymbol("isObservable",u.isObservable),u.exportSymbol("isWriteableObservable",u.isWriteableObservable),u.observableArray=function(e){if(e=e||[],"object"!=typeof e||!("length"in e))throw new Error("The argument passed when initializing an observable array must be an array, or null, or undefined.");var t=u.observable(e);return u.utils.extend(t,u.observableArray.fn),t},u.observableArray.fn={remove:function(e){for(var t=this.peek(),n=[],i="function"==typeof e?e:function(t){return t===e},a=0;a<t.length;a++){var r=t[a];i(r)&&(0===n.length&&this.valueWillMutate(),n.push(r),t.splice(a,1),a--)}return n.length&&this.valueHasMutated(),n},removeAll:function(t){if(t===e){var n=this.peek(),i=n.slice(0);return this.valueWillMutate(),n.splice(0,n.length),this.valueHasMutated(),i}return t?this.remove(function(e){return u.utils.arrayIndexOf(t,e)>=0}):[]},destroy:function(e){var t=this.peek(),n="function"==typeof e?e:function(t){return t===e};this.valueWillMutate();for(var i=t.length-1;i>=0;i--){var a=t[i];n(a)&&(t[i]._destroy=!0)}this.valueHasMutated()},destroyAll:function(t){return t===e?this.destroy(function(){return!0}):t?this.destroy(function(e){return u.utils.arrayIndexOf(t,e)>=0}):[]},indexOf:function(e){var t=this();return u.utils.arrayIndexOf(t,e)},replace:function(e,t){var n=this.indexOf(e);n>=0&&(this.valueWillMutate(),this.peek()[n]=t,this.valueHasMutated())}},u.utils.arrayForEach(["pop","push","reverse","shift","sort","splice","unshift"],function(e){u.observableArray.fn[e]=function(){var t=this.peek();this.valueWillMutate();var n=t[e].apply(t,arguments);return this.valueHasMutated(),n}}),u.utils.arrayForEach(["slice"],function(e){u.observableArray.fn[e]=function(){var t=this();return t[e].apply(t,arguments)}}),u.exportSymbol("observableArray",u.observableArray),u.dependentObservable=function(t,n,i){function a(e){S.push(e.subscribe(o))}function r(){u.utils.arrayForEach(S,function(e){e.dispose()}),S=[]}function o(){var e=d.throttleEvaluation,t=d.throttleType,n=d.throttleNoTrailing,i="number"==typeof e&&e>=0&&"string"==typeof t&&"boolean"==typeof n;if(i)if(k&&clearTimeout(k),"throttle"===t){var a=s(),r=a-b;r>e?(b=a,l()):n||(k=setTimeout(function(){b=a,l()},e-r))}else k=setTimeout(l,e);else b=s(),l()}function s(){return+new Date}function l(){if(!m){if(h&&_())return void w();m=!0;try{var t=u.utils.arrayMap(S,function(e){return e.target});u.dependencyDetection.begin(function(n){var i;(i=u.utils.arrayIndexOf(t,n))>=0?t[i]=e:a(n)});for(var i=n?f.call(n):f(),r=t.length-1;r>=0;r--)t[r]&&S.splice(r,1)[0].dispose();h=!0,d.notifySubscribers(g,"beforeChange"),g=i,d.notifySubscribers(g)}finally{u.dependencyDetection.end(),m=!1}S.length||w()}}function d(){if(arguments.length>0){if("function"!=typeof v)throw new Error("Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.");return b=s(),v.apply(n,arguments),this}return h||(b=s(),l()),u.dependencyDetection.registerDependency(d),g}function c(){return h||(b=s(),l()),g}function p(){return!h||S.length>0}var g,h=!1,m=!1,b=0,f=t;if(f&&"object"==typeof f?(i=f,f=i.read):(i=i||{},f||(f=i.read)),"function"!=typeof f)throw new Error("Pass a function that returns the value of the ko.computed");var v=i.write,y=i.disposeWhenNodeIsRemoved||i.disposeWhenNodeIsRemoved||null,_=i.disposeWhen||i.disposeWhen||function(){return!1},w=r,S=[],k=null;if(n||(n=i.owner),d.peek=c,d.getDependenciesCount=function(){return S.length},d.hasWriteFunction="function"==typeof i.write,d.dispose=function(){w()},d.isActive=p,u.subscribable.call(d),u.utils.extend(d,u.dependentObservable.fn),u.exportProperty(d,"peek",d.peek),u.exportProperty(d,"dispose",d.dispose),u.exportProperty(d,"isActive",d.isActive),u.exportProperty(d,"getDependenciesCount",d.getDependenciesCount),i.deferEvaluation!==!0&&l(),y&&p()){w=function(){u.utils.domNodeDisposal.removeDisposeCallback(y,w),r()},u.utils.domNodeDisposal.addDisposeCallback(y,w);var x=_;_=function(){return!u.utils.domNodeIsAttachedToDocument(y)||x()}}return d},u.isComputed=function(e){return u.hasPrototype(e,u.dependentObservable)};var m=u.observable.protoProperty;u.dependentObservable[m]=u.observable,u.dependentObservable.fn={},u.dependentObservable.fn[m]=u.dependentObservable,u.exportSymbol("dependentObservable",u.dependentObservable),u.exportSymbol("computed",u.dependentObservable),u.exportSymbol("isComputed",u.isComputed),function(){function t(a,r,o){o=o||new i,a=r(a);var s=!("object"!=typeof a||null===a||a===e||a instanceof Date||a instanceof String||a instanceof Number||a instanceof Boolean);if(!s)return a;var l=a instanceof Array?[]:{};return o.save(a,l),n(a,function(n){var i=r(a[n]);switch(typeof i){case"boolean":case"number":case"string":case"function":l[n]=i;break;case"object":case"undefined":var s=o.get(i);l[n]=s!==e?s:t(i,r,o)}}),l}function n(e,t){if(e instanceof Array){for(var n=0;n<e.length;n++)t(n);"function"==typeof e.toJSON&&t("toJSON")}else for(var i in e)t(i)}function i(){this.keys=[],this.values=[]}var a=10;u.toJS=function(e){if(0==arguments.length)throw new Error("When calling ko.toJS, pass the object you want to convert.");return t(e,function(e){for(var t=0;u.isObservable(e)&&a>t;t++)e=e();return e})},u.toJSON=function(e,t,n){var i=u.toJS(e);return u.utils.stringifyJson(i,t,n)},i.prototype={constructor:i,save:function(e,t){var n=u.utils.arrayIndexOf(this.keys,e);n>=0?this.values[n]=t:(this.keys.push(e),this.values.push(t))},get:function(t){var n=u.utils.arrayIndexOf(this.keys,t);return n>=0?this.values[n]:e}}}(),u.exportSymbol("toJS",u.toJS),u.exportSymbol("toJSON",u.toJSON),function(){var t="__ko__hasDomDataOptionValue__";u.selectExtensions={readValue:function(n){switch(u.utils.tagNameLower(n)){case"option":return n[t]===!0?u.utils.domData.get(n,u.bindingHandlers.options.optionValueDomDataKey):u.utils.ieVersion<=7?n.getAttributeNode("value")&&n.getAttributeNode("value").specified?n.value:n.text:n.value;case"select":return n.selectedIndex>=0?u.selectExtensions.readValue(n.options[n.selectedIndex]):e;default:return n.value}},writeValue:function(n,i){switch(u.utils.tagNameLower(n)){case"option":switch(typeof i){case"string":u.utils.domData.set(n,u.bindingHandlers.options.optionValueDomDataKey,e),t in n&&delete n[t],n.value=i;break;default:u.utils.domData.set(n,u.bindingHandlers.options.optionValueDomDataKey,i),n[t]=!0,n.value="number"==typeof i?i:""}break;case"select":""===i&&(i=e),(null===i||i===e)&&(n.selectedIndex=-1);for(var a=n.options.length-1;a>=0;a--)if(u.selectExtensions.readValue(n.options[a])==i){n.selectedIndex=a;break}n.size>1||-1!==n.selectedIndex||(n.selectedIndex=0);break;default:(null===i||i===e)&&(i=""),n.value=i}}}}(),u.exportSymbol("selectExtensions",u.selectExtensions),u.exportSymbol("selectExtensions.readValue",u.selectExtensions.readValue),u.exportSymbol("selectExtensions.writeValue",u.selectExtensions.writeValue),u.expressionRewriting=function(){function e(e,t){for(var n=null;e!=n;)n=e,e=e.replace(i,function(e,n){return t[n]});return e}function t(e){if(u.utils.arrayIndexOf(a,u.utils.stringTrim(e).toLowerCase())>=0)return!1;var t=e.match(r);return null===t?!1:t[1]?"Object("+t[1]+")"+t[2]:e}function n(e){var t=u.utils.stringTrim(e);switch(t.length&&t.charAt(0)){case"'":case'"':return e;default:return"'"+t+"'"}}var i=/\@ko_token_(\d+)\@/g,a=["true","false","null","undefined"],r=/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i;return{bindingRewriteValidators:[],parseObjectLiteral:function(t){var n=u.utils.stringTrim(t);if(n.length<3)return[];"{"===n.charAt(0)&&(n=n.substring(1,n.length-1));for(var i,a=[],r=null,o=0;o<n.length;o++){var s=n.charAt(o);if(null===r)switch(s){case'"':case"'":case"/":r=o,i=s}else if(s==i&&"\\"!==n.charAt(o-1)){var l=n.substring(r,o+1);a.push(l);var d="@ko_token_"+(a.length-1)+"@";n=n.substring(0,r)+d+n.substring(o+1),o-=l.length-d.length,r=null}}r=null,i=null;for(var c=0,p=null,o=0;o<n.length;o++){var s=n.charAt(o);if(null===r)switch(s){case"{":r=o,p=s,i="}";break;case"(":r=o,p=s,i=")";break;case"[":r=o,p=s,i="]"}if(s===p)c++;else if(s===i&&(c--,0===c)){var l=n.substring(r,o+1);a.push(l);var d="@ko_token_"+(a.length-1)+"@";n=n.substring(0,r)+d+n.substring(o+1),o-=l.length-d.length,r=null}}for(var g=[],h=n.split(","),m=0,b=h.length;b>m;m++){var f=h[m],v=f.indexOf(":");if(v>0&&v<f.length-1){var y=f.substring(0,v),_=f.substring(v+1);g.push({key:e(y,a),value:e(_,a)})}else g.push({unknown:e(f,a)})}return g},preProcessBindings:function(e){for(var i,a="string"==typeof e?u.expressionRewriting.parseObjectLiteral(e):e,r=[],o=[],s=0;i=a[s];s++)if(r.length>0&&r.push(","),i.key){var l=n(i.key),d=i.value;r.push(l),r.push(":"),r.push(d),(d=t(u.utils.stringTrim(d)))&&(o.length>0&&o.push(", "),o.push(l+" : function(__ko_value) { "+d+" = __ko_value; }"))}else i.unknown&&r.push(i.unknown);var c=r.join("");if(o.length>0){var p=o.join("");c=c+", '_ko_property_writers' : { "+p+" } "}return c},keyValueArrayContainsKey:function(e,t){for(var n=0;n<e.length;n++)if(u.utils.stringTrim(e[n].key)==t)return!0;return!1},writeValueToProperty:function(e,t,n,i,a){if(e&&u.isObservable(e))!u.isWriteableObservable(e)||a&&e.peek()===i||e(i);else{var r=t()._ko_property_writers;r&&r[n]&&r[n](i)}}}}(),u.exportSymbol("expressionRewriting",u.expressionRewriting),u.exportSymbol("expressionRewriting.bindingRewriteValidators",u.expressionRewriting.bindingRewriteValidators),u.exportSymbol("expressionRewriting.parseObjectLiteral",u.expressionRewriting.parseObjectLiteral),u.exportSymbol("expressionRewriting.preProcessBindings",u.expressionRewriting.preProcessBindings),u.exportSymbol("jsonExpressionRewriting",u.expressionRewriting),u.exportSymbol("jsonExpressionRewriting.insertPropertyAccessorsIntoJson",u.expressionRewriting.preProcessBindings),function(){function e(e){return 8==e.nodeType&&(o?e.text:e.nodeValue).match(s)}function t(e){return 8==e.nodeType&&(o?e.text:e.nodeValue).match(l)}function i(n,i){for(var a=n,r=1,o=[];a=a.nextSibling;){if(t(a)&&(r--,0===r))return o;o.push(a),e(a)&&r++}if(!i)throw new Error("Cannot find closing comment tag to match: "+n.nodeValue);return null}function a(e,t){var n=i(e,t);return n?n.length>0?n[n.length-1].nextSibling:e.nextSibling:null}function r(n){var i=n.firstChild,r=null;if(i)do if(r)r.push(i);else if(e(i)){var o=a(i,!0);o?i=o:r=[i]}else t(i)&&(r=[i]);while(i=i.nextSibling);return r}var o=n&&"<!--test-->"===n.createComment("test").text,s=o?/^<!--\s*ko(?:\s+(.+\s*\:[\s\S]*))?\s*-->$/:/^\s*ko(?:\s+(.+\s*\:[\s\S]*))?\s*$/,l=o?/^<!--\s*\/ko\s*-->$/:/^\s*\/ko\s*$/,d={ul:!0,ol:!0};u.virtualElements={allowedBindings:{},childNodes:function(t){return e(t)?i(t):t.childNodes},emptyNode:function(t){if(e(t))for(var n=u.virtualElements.childNodes(t),i=0,a=n.length;a>i;i++)u.removeNode(n[i]);else u.utils.emptyDomNode(t)},setDomNodeChildren:function(t,n){if(e(t)){u.virtualElements.emptyNode(t);for(var i=t.nextSibling,a=0,r=n.length;r>a;a++)i.parentNode.insertBefore(n[a],i)}else u.utils.setDomNodeChildren(t,n)},prepend:function(t,n){e(t)?t.parentNode.insertBefore(n,t.nextSibling):t.firstChild?t.insertBefore(n,t.firstChild):t.appendChild(n)},insertAfter:function(t,n,i){i?e(t)?t.parentNode.insertBefore(n,i.nextSibling):i.nextSibling?t.insertBefore(n,i.nextSibling):t.appendChild(n):u.virtualElements.prepend(t,n)},firstChild:function(n){return e(n)?!n.nextSibling||t(n.nextSibling)?null:n.nextSibling:n.firstChild},nextSibling:function(n){return e(n)&&(n=a(n)),n.nextSibling&&t(n.nextSibling)?null:n.nextSibling},virtualNodeBindingValue:function(t){var n=e(t);return n?n[1]:null},normaliseVirtualElementDomStructure:function(e){if(d[u.utils.tagNameLower(e)]){var t=e.firstChild;if(t)do if(1===t.nodeType){var n=r(t);if(n)for(var i=t.nextSibling,a=0;a<n.length;a++)i?e.insertBefore(n[a],i):e.appendChild(n[a])}while(t=t.nextSibling)}}}}(),u.exportSymbol("virtualElements",u.virtualElements),u.exportSymbol("virtualElements.allowedBindings",u.virtualElements.allowedBindings),u.exportSymbol("virtualElements.emptyNode",u.virtualElements.emptyNode),u.exportSymbol("virtualElements.insertAfter",u.virtualElements.insertAfter),u.exportSymbol("virtualElements.prepend",u.virtualElements.prepend),u.exportSymbol("virtualElements.setDomNodeChildren",u.virtualElements.setDomNodeChildren),function(){function e(e,n){var i=e;return n[i]||(n[i]=t(e))}function t(e){var t=u.expressionRewriting.preProcessBindings(e),n="with($context){with($data||{}){return{"+t+"}}}";return new Function("$context","$element",n)}var n="data-bind";u.bindingProvider=function(){this.bindingCache={}},u.utils.extend(u.bindingProvider.prototype,{nodeHasBindings:function(e){switch(e.nodeType){case 1:return null!=e.getAttribute(n);case 8:return null!=u.virtualElements.virtualNodeBindingValue(e);default:return!1}},getBindings:function(e,t){var n=this.getBindingsString(e,t);return n?this.parseBindingsString(n,t,e):null},getBindingsString:function(e){switch(e.nodeType){case 1:return e.getAttribute(n);case 8:return u.virtualElements.virtualNodeBindingValue(e);default:return null}},parseBindingsString:function(t,n,i){try{var a=e(t,this.bindingCache);return a(n,i)}catch(r){throw r.message="Unable to parse bindings.\nBindings value: "+t+"\nMessage: "+r.message,r}}}),u.bindingProvider.instance=new u.bindingProvider}(),u.exportSymbol("bindingProvider",u.bindingProvider),function(){function n(e){var t=u.virtualElements.allowedBindings[e];if(!t)throw new Error("The binding '"+e+"' cannot be used with virtual elements")}function i(e,t,n){for(var i,r=u.virtualElements.firstChild(t);i=r;)r=u.virtualElements.nextSibling(i),a(e,i,n)}function a(e,t,n){var a=!0,o=1===t.nodeType;o&&u.virtualElements.normaliseVirtualElementDomStructure(t);var s=o&&n||u.bindingProvider.instance.nodeHasBindings(t);s&&(a=r(t,null,e,n).shouldBindDescendants),a&&i(e,t,!o)}function r(t,i,a,r){function s(e){return function(){return d[e]}}function l(){return d}var d,c,p=0,g=u.utils.domData.get(t,o);if(!i){if(g)throw Error("You cannot apply bindings multiple times to the same element.");u.utils.domData.set(t,o,!0)}return u.dependentObservable(function(){var o=a&&a instanceof u.bindingContext?a:new u.bindingContext(u.utils.unwrapObservable(a)),h=o.$data;!g&&r&&u.storedBindingContextForNode(t,o);var m="function"==typeof i?i(o,t):i;d=m||u.bindingProvider.instance.getBindings(t,o),d&&(0===p&&(p=1,u.utils.objectForEach(d,function(i){var a=u.bindingHandlers[i];if(a&&8===t.nodeType&&n(i),a&&"function"==typeof a.init){var r=a.init,d=r(t,s(i),l,h,o);if(d&&d.controlsDescendantBindings){if(c!==e)throw new Error("Multiple bindings ("+c+" and "+i+") are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.");c=i}}}),p=2),2===p&&u.utils.objectForEach(d,function(e){var n=u.bindingHandlers[e];if(n&&"function"==typeof n.update){var i=n.update;i(t,s(e),l,h,o)}}))},null,{disposeWhenNodeIsRemoved:t}),{shouldBindDescendants:c===e}}u.bindingHandlers={},u.bindingContext=function(e,t,n){t?(u.utils.extend(this,t),this.$parentContext=t,this.$parent=t.$data,this.$parents=(t.$parents||[]).slice(0),this.$parents.unshift(this.$parent)):(this.$parents=[],this.$root=e,this.ko=u),this.$data=e,n&&(this[n]=e)
},u.bindingContext.prototype.createChildContext=function(e,t){return new u.bindingContext(e,this,t)},u.bindingContext.prototype.extend=function(e){var t=u.utils.extend(new u.bindingContext,this);return u.utils.extend(t,e)};var o="__ko_boundElement",s="__ko_bindingContext__";u.storedBindingContextForNode=function(e,t){return 2!=arguments.length?u.utils.domData.get(e,s):void u.utils.domData.set(e,s,t)},u.applyBindingsToNode=function(e,t,n){return 1===e.nodeType&&u.virtualElements.normaliseVirtualElementDomStructure(e),r(e,t,n,!0)},u.applyBindingsToDescendants=function(e,t){(1===t.nodeType||8===t.nodeType)&&i(e,t,!0)},u.applyBindings=function(e,n){if(n&&1!==n.nodeType&&8!==n.nodeType)throw new Error("ko.applyBindings: first parameter should be your view model; second parameter should be a DOM node");n=n||t.document.body,a(e,n,!0)},u.contextFor=function(t){switch(t.nodeType){case 1:case 8:var n=u.storedBindingContextForNode(t);if(n)return n;if(t.parentNode)return u.contextFor(t.parentNode)}return e},u.dataFor=function(t){var n=u.contextFor(t);return n?n.$data:e},u.exportSymbol("bindingHandlers",u.bindingHandlers),u.exportSymbol("applyBindings",u.applyBindings),u.exportSymbol("applyBindingsToDescendants",u.applyBindingsToDescendants),u.exportSymbol("applyBindingsToNode",u.applyBindingsToNode),u.exportSymbol("contextFor",u.contextFor),u.exportSymbol("dataFor",u.dataFor)}();var b={"class":"className","for":"htmlFor"};u.bindingHandlers.attr={update:function(t,n){var i=u.utils.unwrapObservable(n())||{};u.utils.objectForEach(i,function(n,i){i=u.utils.unwrapObservable(i);var a=i===!1||null===i||i===e;a&&t.removeAttribute(n),u.utils.ieVersion<=8&&n in b?(n=b[n],a?t.removeAttribute(n):t[n]=i):a||t.setAttribute(n,i.toString()),"name"===n&&u.utils.setElementName(t,a?"":i.toString())})}},u.bindingHandlers.checked={init:function(e,t,n){var i=function(){var i;if("checkbox"==e.type)i=e.checked;else{if("radio"!=e.type||!e.checked)return;i=e.value}var a=t(),r=u.utils.unwrapObservable(a);"checkbox"==e.type&&r instanceof Array?u.utils.addOrRemoveItem(a,e.value,e.checked):u.expressionRewriting.writeValueToProperty(a,n,"checked",i,!0)};u.utils.registerEventHandler(e,"click",i),"radio"!=e.type||e.name||u.bindingHandlers.uniqueName.init(e,function(){return!0})},update:function(e,t){var n=u.utils.unwrapObservable(t());"checkbox"==e.type?e.checked=n instanceof Array?u.utils.arrayIndexOf(n,e.value)>=0:n:"radio"==e.type&&(e.checked=e.value==n)}};var f="__ko__cssValue";u.bindingHandlers.css={update:function(e,t){var n=u.utils.unwrapObservable(t());"object"==typeof n?u.utils.objectForEach(n,function(t,n){n=u.utils.unwrapObservable(n),u.utils.toggleDomNodeCssClass(e,t,n)}):(n=String(n||""),u.utils.toggleDomNodeCssClass(e,e[f],!1),e[f]=n,u.utils.toggleDomNodeCssClass(e,n,!0))}},u.bindingHandlers.enable={update:function(e,t){var n=u.utils.unwrapObservable(t());n&&e.disabled?e.removeAttribute("disabled"):n||e.disabled||(e.disabled=!0)}},u.bindingHandlers.disable={update:function(e,t){u.bindingHandlers.enable.update(e,function(){return!u.utils.unwrapObservable(t())})}},u.bindingHandlers.event={init:function(e,t,n,i){var a=t()||{};u.utils.objectForEach(a,function(a){"string"==typeof a&&u.utils.registerEventHandler(e,a,function(e){var r,o=t()[a];if(o){var s=n();try{var l=u.utils.makeArray(arguments);l.unshift(i),r=o.apply(i,l)}finally{r!==!0&&(e.preventDefault?e.preventDefault():e.returnValue=!1)}var d=s[a+"Bubble"]!==!1;d||(e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation())}})})}},u.bindingHandlers.foreach={makeTemplateValueAccessor:function(e){return function(){var t=e(),n=u.utils.peekObservable(t);return n&&"number"!=typeof n.length?(u.utils.unwrapObservable(t),{foreach:n.data,as:n.as,includeDestroyed:n.includeDestroyed,afterAdd:n.afterAdd,beforeRemove:n.beforeRemove,afterRender:n.afterRender,beforeMove:n.beforeMove,afterMove:n.afterMove,templateEngine:u.nativeTemplateEngine.instance}):{foreach:t,templateEngine:u.nativeTemplateEngine.instance}}},init:function(e,t){return u.bindingHandlers.template.init(e,u.bindingHandlers.foreach.makeTemplateValueAccessor(t))},update:function(e,t,n,i,a){return u.bindingHandlers.template.update(e,u.bindingHandlers.foreach.makeTemplateValueAccessor(t),n,i,a)}},u.expressionRewriting.bindingRewriteValidators.foreach=!1,u.virtualElements.allowedBindings.foreach=!0;var v="__ko_hasfocusUpdating",y="__ko_hasfocusLastValue";u.bindingHandlers.hasfocus={init:function(e,t,n){var i=function(i){e[v]=!0;var a=e.ownerDocument;if("activeElement"in a){var r;try{r=a.activeElement}catch(o){r=a.body}i=r===e}var s=t();u.expressionRewriting.writeValueToProperty(s,n,"hasfocus",i,!0),e[y]=i,e[v]=!1},a=i.bind(null,!0),r=i.bind(null,!1);u.utils.registerEventHandler(e,"focus",a),u.utils.registerEventHandler(e,"focusin",a),u.utils.registerEventHandler(e,"blur",r),u.utils.registerEventHandler(e,"focusout",r)},update:function(e,t){var n=!!u.utils.unwrapObservable(t());e[v]||e[y]===n||(n?e.focus():e.blur(),u.dependencyDetection.ignore(u.utils.triggerEvent,null,[e,n?"focusin":"focusout"]))}},u.bindingHandlers.hasFocus=u.bindingHandlers.hasfocus,u.bindingHandlers.html={init:function(){return{controlsDescendantBindings:!0}},update:function(e,t){u.utils.setHtml(e,t())}};var _="__ko_withIfBindingData";d("if"),d("ifnot",!1,!0),d("with",!0,!1,function(e,t){return e.createChildContext(t)}),u.bindingHandlers.options={init:function(e){if("select"!==u.utils.tagNameLower(e))throw new Error("options binding applies only to SELECT elements");for(;e.length>0;)e.remove(0);return{controlsDescendantBindings:!0}},update:function(t,i,a){function r(e,t,n){var i=typeof t;return"function"==i?t(e):"string"==i?e[t]:n}function o(t,i,a){a.length&&(d=a[0].selected&&[u.selectExtensions.readValue(a[0])]);var o=n.createElement("option");if(t===f)u.utils.setHtml(o,l),u.selectExtensions.writeValue(o,e);else{var s=r(t,m.optionsValue,t);u.selectExtensions.writeValue(o,u.utils.unwrapObservable(s));var c=r(t,m.optionsText,s);u.utils.setTextContent(o,c)}return[o]}function s(e,t){if(d){var n=u.utils.arrayIndexOf(d,u.selectExtensions.readValue(t[0]))>=0;u.utils.setOptionNodeSelectionState(t[0],n)}}var l,d,p=0==t.length,g=!p&&t.multiple?t.scrollTop:null,h=u.utils.unwrapObservable(i()),m=a(),b=m.optionsIncludeDestroyed,f={};if(t.multiple?d=u.utils.arrayMap(t.selectedOptions||u.utils.arrayFilter(t.childNodes,function(e){return e.tagName&&"option"===u.utils.tagNameLower(e)&&e.selected}),function(e){return u.selectExtensions.readValue(e)}):t.selectedIndex>=0&&(d=[u.selectExtensions.readValue(t.options[t.selectedIndex])]),h){"undefined"==typeof h.length&&(h=[h]);var v=u.utils.arrayFilter(h,function(t){return b||t===e||null===t||!u.utils.unwrapObservable(t._destroy)});"optionsCaption"in m&&(l=u.utils.unwrapObservable(m.optionsCaption),null!==l&&l!==e&&v.unshift(f))}else h=[];var y=s;m.optionsAfterRender&&(y=function(t,n){s(t,n),u.dependencyDetection.ignore(m.optionsAfterRender,null,[n[0],t!==f?t:e])}),u.utils.setDomNodeChildrenFromArrayMapping(t,v,o,null,y),d=null,p&&"value"in m&&c(t,u.utils.peekObservable(m.value),!0),u.utils.ensureSelectElementIsRenderedCorrectly(t),g&&Math.abs(g-t.scrollTop)>20&&(t.scrollTop=g)}},u.bindingHandlers.options.optionValueDomDataKey="__ko.optionValueDomData__",u.bindingHandlers.selectedOptions={init:function(e,t,n){u.utils.registerEventHandler(e,"change",function(){var i=t(),a=[];u.utils.arrayForEach(e.getElementsByTagName("option"),function(e){e.selected&&a.push(u.selectExtensions.readValue(e))}),u.expressionRewriting.writeValueToProperty(i,n,"selectedOptions",a)})},update:function(e,t){if("select"!=u.utils.tagNameLower(e))throw new Error("values binding applies only to SELECT elements");var n=u.utils.unwrapObservable(t());n&&"number"==typeof n.length&&u.utils.arrayForEach(e.getElementsByTagName("option"),function(e){var t=u.utils.arrayIndexOf(n,u.selectExtensions.readValue(e))>=0;u.utils.setOptionNodeSelectionState(e,t)})}},u.bindingHandlers.style={update:function(e,t){var n=u.utils.unwrapObservable(t()||{});u.utils.objectForEach(n,function(t,n){n=u.utils.unwrapObservable(n),e.style[t]=n||""})}},u.bindingHandlers.submit={init:function(e,t,n,i){if("function"!=typeof t())throw new Error("The value for a submit binding must be a function");u.utils.registerEventHandler(e,"submit",function(n){var a,r=t();try{a=r.call(i,e)}finally{a!==!0&&(n.preventDefault?n.preventDefault():n.returnValue=!1)}})}},u.bindingHandlers.text={update:function(e,t){u.utils.setTextContent(e,t())}},u.virtualElements.allowedBindings.text=!0,u.bindingHandlers.uniqueName={init:function(e,t){if(t()){var n="ko_unique_"+ ++u.bindingHandlers.uniqueName.currentIndex;u.utils.setElementName(e,n)}}},u.bindingHandlers.uniqueName.currentIndex=0,u.bindingHandlers.value={init:function(e,t,n){var i=["change"],a=n().valueUpdate,r=!1;a&&("string"==typeof a&&(a=[a]),u.utils.arrayPushAll(i,a),i=u.utils.arrayGetDistinctValues(i));var o=function(){r=!1;var i=t(),a=u.selectExtensions.readValue(e);u.expressionRewriting.writeValueToProperty(i,n,"value",a)},s=u.utils.ieVersion&&"input"==e.tagName.toLowerCase()&&"text"==e.type&&"off"!=e.autocomplete&&(!e.form||"off"!=e.form.autocomplete);s&&-1==u.utils.arrayIndexOf(i,"propertychange")&&(u.utils.registerEventHandler(e,"propertychange",function(){r=!0}),u.utils.registerEventHandler(e,"blur",function(){r&&o()})),u.utils.arrayForEach(i,function(t){var n=o;u.utils.stringStartsWith(t,"after")&&(n=function(){setTimeout(o,0)},t=t.substring("after".length)),u.utils.registerEventHandler(e,t,n)})},update:function(e,t){var n="select"===u.utils.tagNameLower(e),i=u.utils.unwrapObservable(t()),a=u.selectExtensions.readValue(e),r=i!==a;if(r){var o=function(){u.selectExtensions.writeValue(e,i)};o();var s=n;s&&setTimeout(o,0)}n&&e.length>0&&c(e,i,!1)}},u.bindingHandlers.visible={update:function(e,t){var n=u.utils.unwrapObservable(t()),i=!("none"==e.style.display);n&&!i?e.style.display="":!n&&i&&(e.style.display="none")}},l("click"),u.templateEngine=function(){},u.templateEngine.prototype.renderTemplateSource=function(){throw new Error("Override renderTemplateSource")},u.templateEngine.prototype.createJavaScriptEvaluatorBlock=function(){throw new Error("Override createJavaScriptEvaluatorBlock")},u.templateEngine.prototype.makeTemplateSource=function(e,t){if("string"==typeof e){t=t||n;var i=t.getElementById(e);if(!i)throw new Error("Cannot find template with ID "+e);return new u.templateSources.domElement(i)}if(1==e.nodeType||8==e.nodeType)return new u.templateSources.anonymousTemplate(e);throw new Error("Unknown template type: "+e)},u.templateEngine.prototype.renderTemplate=function(e,t,n,i){var a=this.makeTemplateSource(e,i);return this.renderTemplateSource(a,t,n)},u.templateEngine.prototype.isTemplateRewritten=function(e,t){return this.allowTemplateRewriting===!1?!0:this.makeTemplateSource(e,t).data("isRewritten")},u.templateEngine.prototype.rewriteTemplate=function(e,t,n){var i=this.makeTemplateSource(e,n),a=t(i.text());i.text(a),i.data("isRewritten",!0)},u.exportSymbol("templateEngine",u.templateEngine),u.templateRewriting=function(){function e(e){for(var t=u.expressionRewriting.bindingRewriteValidators,n=0;n<e.length;n++){var i=e[n].key;if(t.hasOwnProperty(i)){var a=t[i];if("function"==typeof a){var r=a(e[n].value);if(r)throw new Error(r)}else if(!a)throw new Error("This template engine does not support the '"+i+"' binding within its templates")}}}function t(t,n,i,a){var r=u.expressionRewriting.parseObjectLiteral(t);e(r);var o=u.expressionRewriting.preProcessBindings(r),s="ko.__tr_ambtns(function($context,$element){return(function(){return{ "+o+" } })()},'"+i.toLowerCase()+"')";return a.createJavaScriptEvaluatorBlock(s)+n}var n=/(<([a-z]+\d*)(?:\s+(?!data-bind\s*=\s*)[a-z0-9\-]+(?:=(?:\"[^\"]*\"|\'[^\']*\'))?)*\s+)data-bind\s*=\s*(["'])([\s\S]*?)\3/gi,i=/<!--\s*ko\b\s*([\s\S]*?)\s*-->/g;return{ensureTemplateIsRewritten:function(e,t,n){t.isTemplateRewritten(e,n)||t.rewriteTemplate(e,function(e){return u.templateRewriting.memoizeBindingAttributeSyntax(e,t)},n)},memoizeBindingAttributeSyntax:function(e,a){return e.replace(n,function(){return t(arguments[4],arguments[1],arguments[2],a)}).replace(i,function(){return t(arguments[1],"<!-- ko -->","#comment",a)})},applyMemoizedBindingsToNextSibling:function(e,t){return u.memoization.memoize(function(n,i){var a=n.nextSibling;a&&a.nodeName.toLowerCase()===t&&u.applyBindingsToNode(a,e,i)})}}}(),u.exportSymbol("__tr_ambtns",u.templateRewriting.applyMemoizedBindingsToNextSibling),function(){u.templateSources={},u.templateSources.domElement=function(e){this.domElement=e},u.templateSources.domElement.prototype.text=function(){var e=u.utils.tagNameLower(this.domElement),t="script"===e?"text":"textarea"===e?"value":"innerHTML";if(0==arguments.length)return this.domElement[t];var n=arguments[0];"innerHTML"===t?u.utils.setHtml(this.domElement,n):this.domElement[t]=n},u.templateSources.domElement.prototype.data=function(e){return 1===arguments.length?u.utils.domData.get(this.domElement,"templateSourceData_"+e):void u.utils.domData.set(this.domElement,"templateSourceData_"+e,arguments[1])};var t="__ko_anon_template__";u.templateSources.anonymousTemplate=function(e){this.domElement=e},u.templateSources.anonymousTemplate.prototype=new u.templateSources.domElement,u.templateSources.anonymousTemplate.prototype.constructor=u.templateSources.anonymousTemplate,u.templateSources.anonymousTemplate.prototype.text=function(){if(0==arguments.length){var n=u.utils.domData.get(this.domElement,t)||{};return n.textData===e&&n.containerData&&(n.textData=n.containerData.innerHTML),n.textData}var i=arguments[0];u.utils.domData.set(this.domElement,t,{textData:i})},u.templateSources.domElement.prototype.nodes=function(){if(0==arguments.length){var e=u.utils.domData.get(this.domElement,t)||{};return e.containerData}var n=arguments[0];u.utils.domData.set(this.domElement,t,{containerData:n})},u.exportSymbol("templateSources",u.templateSources),u.exportSymbol("templateSources.domElement",u.templateSources.domElement),u.exportSymbol("templateSources.anonymousTemplate",u.templateSources.anonymousTemplate)}(),function(){function t(e,t,n){for(var i,a=e,r=u.virtualElements.nextSibling(t);a&&(i=a)!==r;)a=u.virtualElements.nextSibling(i),(1===i.nodeType||8===i.nodeType)&&n(i)}function n(e,n){if(e.length){var i=e[0],a=e[e.length-1];t(i,a,function(e){u.applyBindings(n,e)}),t(i,a,function(e){u.memoization.unmemoizeDomNodeAndDescendants(e,[n])})}}function i(e){return e.nodeType?e:e.length>0?e[0]:null}function a(e,t,a,r,s){s=s||{};var l=e&&i(e),d=l&&l.ownerDocument,c=s.templateEngine||o;u.templateRewriting.ensureTemplateIsRewritten(a,c,d);var p=c.renderTemplate(a,r,s,d);if("number"!=typeof p.length||p.length>0&&"number"!=typeof p[0].nodeType)throw new Error("Template engine must return an array of DOM nodes");var g=!1;switch(t){case"replaceChildren":u.virtualElements.setDomNodeChildren(e,p),g=!0;break;case"replaceNode":u.utils.replaceDomNodes(e,p),g=!0;break;case"ignoreTargetNode":break;default:throw new Error("Unknown renderMode: "+t)}return g&&(n(p,r),s.afterRender&&u.dependencyDetection.ignore(s.afterRender,null,[p,r.$data])),p}function r(t,n){var i=u.utils.domData.get(t,s);i&&"function"==typeof i.dispose&&i.dispose(),u.utils.domData.set(t,s,n&&n.isActive()?n:e)}var o;u.setTemplateEngine=function(t){if(t!=e&&!(t instanceof u.templateEngine))throw new Error("templateEngine must inherit from ko.templateEngine");o=t},u.renderTemplate=function(t,n,r,s,l){if(r=r||{},(r.templateEngine||o)==e)throw new Error("Set a template engine before calling renderTemplate");if(l=l||"replaceChildren",s){var d=i(s),c=function(){return!d||!u.utils.domNodeIsAttachedToDocument(d)},p=d&&"replaceNode"==l?d.parentNode:d;return u.dependentObservable(function(){var e=n&&n instanceof u.bindingContext?n:new u.bindingContext(u.utils.unwrapObservable(n)),o="function"==typeof t?t(e.$data,e):t,c=a(s,l,o,e,r);"replaceNode"==l&&(s=c,d=i(s))},null,{disposeWhen:c,disposeWhenNodeIsRemoved:p})}return u.memoization.memoize(function(e){u.renderTemplate(t,n,r,e,"replaceNode")})},u.renderTemplateForEach=function(t,i,r,o,s){var l,d=function(e,n){l=s.createChildContext(u.utils.unwrapObservable(e),r.as),l.$index=n;var i="function"==typeof t?t(e,l):t;return a(null,"ignoreTargetNode",i,l,r)},c=function(e,t){n(t,l),r.afterRender&&r.afterRender(t,e)};return u.dependentObservable(function(){var t=u.utils.unwrapObservable(i)||[];"undefined"==typeof t.length&&(t=[t]);var n=u.utils.arrayFilter(t,function(t){return r.includeDestroyed||t===e||null===t||!u.utils.unwrapObservable(t._destroy)});u.dependencyDetection.ignore(u.utils.setDomNodeChildrenFromArrayMapping,null,[o,n,d,r,c])},null,{disposeWhenNodeIsRemoved:o})};var s="__ko__templateComputedDomDataKey__";u.bindingHandlers.template={init:function(e,t){var n=u.utils.unwrapObservable(t());if("string"!=typeof n&&!n.name&&(1==e.nodeType||8==e.nodeType)){var i=1==e.nodeType?e.childNodes:u.virtualElements.childNodes(e),a=u.utils.moveCleanedNodesToContainerElement(i);new u.templateSources.anonymousTemplate(e).nodes(a)}return{controlsDescendantBindings:!0}},update:function(e,t,n,i,a){var o,s=u.utils.unwrapObservable(t()),l={},d=!0,c=null;if("string"!=typeof s&&(l=s,s=u.utils.unwrapObservable(l.name),"if"in l&&(d=u.utils.unwrapObservable(l["if"])),d&&"ifnot"in l&&(d=!u.utils.unwrapObservable(l.ifnot)),o=u.utils.unwrapObservable(l.data)),"foreach"in l){var p=d&&l.foreach||[];c=u.renderTemplateForEach(s||e,p,l,e,a)}else if(d){var g="data"in l?a.createChildContext(o,l.as):a;c=u.renderTemplate(s||e,g,l,e)}else u.virtualElements.emptyNode(e);r(e,c)}},u.expressionRewriting.bindingRewriteValidators.template=function(e){var t=u.expressionRewriting.parseObjectLiteral(e);return 1==t.length&&t[0].unknown?null:u.expressionRewriting.keyValueArrayContainsKey(t,"name")?null:"This template engine does not support anonymous templates nested within its templates"},u.virtualElements.allowedBindings.template=!0}(),u.exportSymbol("setTemplateEngine",u.setTemplateEngine),u.exportSymbol("renderTemplate",u.renderTemplate),u.utils.compareArrays=function(){function e(e,a,r){return e=e||[],a=a||[],e.length<=a.length?t(e,a,n,i,r):t(a,e,i,n,r)}function t(e,t,n,i,a){var r,o,s,l,d,c,u=Math.min,p=Math.max,g=[],h=e.length,m=t.length,b=m-h||1,f=h+m+1;for(r=0;h>=r;r++)for(l=s,g.push(s=[]),d=u(m,r+b),c=p(0,r-1),o=c;d>=o;o++)if(o)if(r)if(e[r-1]===t[o-1])s[o]=l[o-1];else{var v=l[o]||f,y=s[o-1]||f;s[o]=u(v,y)+1}else s[o]=o+1;else s[o]=r+1;var _,w=[],S=[],k=[];for(r=h,o=m;r||o;)_=g[r][o]-1,o&&_===g[r][o-1]?S.push(w[w.length]={status:n,value:t[--o],index:o}):r&&_===g[r-1][o]?k.push(w[w.length]={status:i,value:e[--r],index:r}):(w.push({status:"retained",value:t[--o]}),--r);if(S.length&&k.length){var x,C,T,E,P,D=10*h;for(x=C=0;(a||D>x)&&(E=S[C]);C++){for(T=0;P=k[T];T++)if(E.value===P.value){E.moved=P.index,P.moved=E.index,k.splice(T,1),x=T=0;break}x+=T}}return w.reverse()}var n="added",i="deleted";return e}(),u.exportSymbol("utils.compareArrays",u.utils.compareArrays),function(){function t(e){for(;e.length&&!u.utils.domNodeIsAttachedToDocument(e[0]);)e.splice(0,1);if(e.length>1){for(var t=e[0],n=e[e.length-1],i=[t];t!==n;){if(t=t.nextSibling,!t)return;i.push(t)}Array.prototype.splice.apply(e,[0,e.length].concat(i))}return e}function n(n,i,a,r,o){var s=[],l=u.dependentObservable(function(){var e=i(a,o,t(s))||[];s.length>0&&(u.utils.replaceDomNodes(s,e),r&&u.dependencyDetection.ignore(r,null,[a,e,o])),s.splice(0,s.length),u.utils.arrayPushAll(s,e)},null,{disposeWhenNodeIsRemoved:n,disposeWhen:function(){return!u.utils.anyDomNodeIsAttachedToDocument(s)}});return{mappedNodes:s,dependentObservable:l.isActive()?l:e}}var i="setDomNodeChildrenFromArrayMapping_lastMappingResult";u.utils.setDomNodeChildrenFromArrayMapping=function(a,r,o,s,l){function d(e,n){p=b[n],w!==n&&(C[e]=p),p.indexObservable(w++),t(p.mappedNodes),y.push(p),k.push(p)}function c(e,t){if(e)for(var n=0,i=t.length;i>n;n++)t[n]&&u.utils.arrayForEach(t[n].mappedNodes,function(i){e(i,n,t[n].arrayEntry)})}r=r||[],s=s||{};for(var p,g,h,m=u.utils.domData.get(a,i)===e,b=u.utils.domData.get(a,i)||[],f=u.utils.arrayMap(b,function(e){return e.arrayEntry}),v=u.utils.compareArrays(f,r,s.dontLimitMoves),y=[],_=0,w=0,S=[],k=[],x=[],C=[],T=[],E=0;g=v[E];E++)switch(h=g.moved,g.status){case"deleted":h===e&&(p=b[_],p.dependentObservable&&p.dependentObservable.dispose(),S.push.apply(S,t(p.mappedNodes)),s.beforeRemove&&(x[E]=p,k.push(p))),_++;break;case"retained":d(E,_++);break;case"added":h!==e?d(E,h):(p={arrayEntry:g.value,indexObservable:u.observable(w++)},y.push(p),k.push(p),m||(T[E]=p))}c(s.beforeMove,C),u.utils.arrayForEach(S,s.beforeRemove?u.cleanNode:u.removeNode);for(var P,D,E=0,I=u.virtualElements.firstChild(a);p=k[E];E++){p.mappedNodes||u.utils.extend(p,n(a,o,p.arrayEntry,l,p.indexObservable));for(var A=0;D=p.mappedNodes[A];I=D.nextSibling,P=D,A++)D!==I&&u.virtualElements.insertAfter(a,D,P);!p.initialized&&l&&(l(p.arrayEntry,p.mappedNodes,p.indexObservable),p.initialized=!0)}c(s.beforeRemove,x),c(s.afterMove,C),c(s.afterAdd,T),u.utils.domData.set(a,i,y)}}(),u.exportSymbol("utils.setDomNodeChildrenFromArrayMapping",u.utils.setDomNodeChildrenFromArrayMapping),u.nativeTemplateEngine=function(){this.allowTemplateRewriting=!1},u.nativeTemplateEngine.prototype=new u.templateEngine,u.nativeTemplateEngine.prototype.constructor=u.nativeTemplateEngine,u.nativeTemplateEngine.prototype.renderTemplateSource=function(e){var t=!(u.utils.ieVersion<9),n=t?e.nodes:null,i=n?e.nodes():null;if(i)return u.utils.makeArray(i.cloneNode(!0).childNodes);var a=e.text();return u.utils.parseHtmlFragment(a)},u.nativeTemplateEngine.instance=new u.nativeTemplateEngine,u.setTemplateEngine(u.nativeTemplateEngine.instance),u.exportSymbol("nativeTemplateEngine",u.nativeTemplateEngine),function(){u.jqueryTmplTemplateEngine=function(){function e(){if(2>i)throw new Error("Your version of jQuery.tmpl is too old. Please upgrade to jQuery.tmpl 1.0.0pre or later.")}function t(e,t,n){return a.tmpl(e,t,n)}var i=this.jQueryTmplVersion=function(){if("undefined"==typeof a||!a.tmpl)return 0;try{if(a.tmpl.tag.tmpl.open.toString().indexOf("__")>=0)return 2}catch(e){}return 1}();this.renderTemplateSource=function(i,r,o){o=o||{},e();var s=i.data("precompiled");if(!s){var l=i.text()||"";l="{{ko_with $item.koBindingContext}}"+l+"{{/ko_with}}",s=a.template(null,l),i.data("precompiled",s)}var d=[r.$data],c=a.extend({koBindingContext:r},o.templateOptions),u=t(s,d,c);return u.appendTo(n.createElement("div")),a.fragments={},u},this.createJavaScriptEvaluatorBlock=function(e){return"{{ko_code ((function() { return "+e+" })()) }}"},this.addTemplate=function(e,t){n.write("<script type='text/html' id='"+e+"'>"+t+"</script>")},i>0&&(a.tmpl.tag.ko_code={open:"__.push($1 || '');"},a.tmpl.tag.ko_with={open:"with($1) {",close:"} "})},u.jqueryTmplTemplateEngine.prototype=new u.templateEngine,u.jqueryTmplTemplateEngine.prototype.constructor=u.jqueryTmplTemplateEngine;var e=new u.jqueryTmplTemplateEngine;e.jQueryTmplVersion>0&&u.setTemplateEngine(e),u.exportSymbol("jqueryTmplTemplateEngine",u.jqueryTmplTemplateEngine)}()})}()}(),define("common/ui/alertMessage",["libs/knockout/knockout","jquery","wsbcore/alerts"],function(e,t){e.bindingHandlers.alertMessage={init:function(n,i){function a(e){e?r():o()}function r(){l.sfAlert({style:e.utils.unwrapObservable(s.style),hideClose:e.utils.unwrapObservable(s.isClosable)===!1})}function o(){l.sfAlert("destroy")}var s=i(),l=t(n).hide(),d=e.utils.unwrapObservable(s.isOpen);a(void 0===d?!0:d);var c=null;e.isObservable(s.isOpen)&&(c=s.isOpen.subscribe(a)),e.utils.domNodeDisposal.addDisposeCallback(n,function(){o(),c&&c.dispose()})}}}),define("designer/app/builder/ui/controls/media/chooser/media.chooser",["jquery","knockout","text!designer/app/builder/ui/controls/media/chooser/media.chooser.html","common/social/oauth/social.oauth","common/api/apiHelper","common/persistence/persistence","designer/app/builder/data/data","designer/app/builder/managers/elementManager","designer/app/builder/managers/pageManager","designer/app/builder/managers/themeManager","data/dataProvider","common/stats/googleanalytics","/i18n/resources/client","common/abTesting/abTesting","common/util/throttledArray","wsbcore/overlay","wsbcore/upload","wsbcore/alerts","wsbcore/tipper","common/ui/flyout","common/ui/alertMessage"],function(e,t,n,i,a,r,o,s,l,d,c,u,p,g,h){function m(n){function i(e,t){if(!e||!e().length)return!1;for(var n=t.referenceId||t.ReferenceId,i=e(),a=0;a<i.length;a++)if(i[a].referenceId===n||i[a].ReferenceId===n)return!0;return!1}function o(n){return $()?0:r.Get(gt+"?documentId="+n.referenceId).then(function(i){if(i=e.isNumeric(i)?parseInt(i,10):0,c.isMultiSelect()&&at){var a=t.utils.arrayFirst(at,function(e){return e.id===n.referenceId||e.id===n.id});a&&i++}return i})}function s(t){var n,i=e.Deferred();return n=nt==St?t>1?p.resources.Client__Designer__Youre_using_image_spots.sfFormat("<b>","</b>",t):p.resources.Client__Designer__Youre_using_image_spot.sfFormat("<b>","</b>"):t>1?p.resources.Client__Designer__Youre_using_file_spots.sfFormat("<b>","</b>",t):p.resources.Client__Designer__Youre_using_file_spot.sfFormat("<b>","</b>"),e('<div style="width:360px;padding:10px 15px;"></div>').html(n).wsbDialog({title:p.resources.Client__Designer__Wait_a_sec,buttons:[{text:p.resources.Close,onClick:function(e){e.wsbDialog("close")}}],onClose:function(){i.resolve()}}),i.promise()}function l(e){if($()){var t={type:"delete",url:"/websites/{websiteId}/documents/"+e.id,headers:q()};return a.ajax(t).then(function(){lt.spaceUsed(lt.spaceUsed()-(e.dataUsageInMB||0))})}var n=e.referenceId||e.id,i=gt+"?id="+n+"&editingMode="+Y.editingMode;return r.Delete(i).then(function(e){e&&e.SiteDataUsageMB&&lt.spaceUsed(e.SiteDataUsageMB)})}var c=this,u=[],g=[],m=[];c.i18Dict={ZeroSelectedImages:p.resources.Server__0_selected_images,NoAlbums:p.resources.Server__No_albums,Cancel:p.resources.Cancel,Search:p.resources.Server__Search,Ok:p.resources.OK,SelectAlbum:p.resources.Server__Select_album,ConnectToInstagram:p.resources.Server__Connect_to_instagram,ConnectToFacebook:p.resources.Server__Connect_to_Facebook,NoItemsToDisplay:p.resources.Server__No_items_to_display,YouMustAuthorizeForFacebook:p.resources.Server__You_must_authorize_for_Facebook.format("<br />"),YouMustAuthorizeForInstagram:p.resources.Server__You_must_authorize_for_Instagram.format("<br />")},this.i18DictCopy=p.resources;var b=[{name:p.resources.Client__Designer__By_Date,filter:"date"}],y=[{name:p.resources.Client__Designer__By_Date,filter:"date"},{name:p.resources.Client__Designer__By_Type,filter:"extension"},{name:p.resources.Client__Designer__By_Name,filter:"name"}],_=[{name:p.resources.Client__Designer__By_Date,filter:"date"},{name:p.resources.Client__Designer__By_Name,filter:"name"}],k=[{text:p.resources.Client__Designer__Restore,onClick:function(){jt.sfMsgOverlay({message:p.resources.Client__Designer__Restoring}),lt.currentTab("archived");var t=lt.selected().slice()||[];c.restoreDocuments(t).then(function(){j("restore_archived","button")}).fail(function(){e("<div/>").sfGrowl({title:p.resources.Client__Designer__Yikes_hit_a_snag,content:p.resources.Client__Designer__TryAgainCustomerSupport,icon:"error"}),j("error-restore","archived")}).always(function(){jt.sfMsgOverlay({message:null})})}},{text:p.resources.Cancel,cancel:!0,style:"link",onClick:function(){j("close","cancel")}}];this.type=t.observable(),this.isMultiSelect=t.observable(!1),this.showCarousel=t.computed(function(){return this.isMultiSelect()&&this.type()!==Tt&&"archived"!==this.currentTab()},this),this.requesting=t.observable(!1),this.showDeleteButton=t.observable(!1),this.requesting.subscribe(function(e){Rt&&Rt.length&&Rt.is(":visible")&&Rt.sfMsgOverlay({message:e?p.resources.Loading:null})}),this.facebookAuth=t.observable(ut.isAuthorized()),this.instagramAuth=t.observable(pt.isAuthorized()),this.tabs=t.observableArray([]),this.currentTab=t.observable("uploaded"),this.showRenameButton=t.computed(function(){return"archived"!==this.currentTab()},this),this.showAuth=t.computed(function(){var e=c.currentTab(),n=t.utils.arrayFirst(c.tabs(),function(t){return t.type===e})||{};return n&&n.social&&!n.hasAuth()}),this.openAuth=function(){var e=this.currentTab();"facebook"===e?(j("connect_facebook_photos","button"),ut.openAuthWindow()):"instagram"===e&&(j("connect_instagram_photos","button"),pt.openAuthWindow())},this.currentTab.subscribe(function(){e("ul",zt).scrollTop(0),Ht&&Ht.length&&Ht.children(":visible").sfAlert("destroy")},this),ut.bind("auth unauth",function(e){c.facebookAuth("auth"==e.type)}),pt.bind("auth unauth",function(e){c.instagramAuth("auth"==e.type)}),this.type.subscribe(function(e){var t=[],n=[];switch(e===St?(t=u,n=b):e===Ct?(t=g,n=y):e===Tt&&(t=m,n=_),c.tabs(t),c.filters(n),c.filter(n.length?n[0].filter:""),e){case St:c.i18Dict.YouCanRestoreArchived=p.resources.Client__Designer__You_can_restore_these_archived_photos;break;case Ct:c.i18Dict.YouCanRestoreArchived=p.resources.Client__Designer__You_can_restore_these_archived_files;break;case Tt:c.i18Dict.YouCanRestoreArchived=p.resources.Client__Designer__You_can_restore_these_archived_audio_files}}),this.hasLatest=t.observable(!1),this.assets=t.observableArray([]),this.images=t.observableArray([]),this.files=t.observableArray([]),this.audio=t.observableArray([]),this.archivedAssets=t.observableArray([]),this.archivedImages=t.observableArray([]),this.archivedFiles=t.observableArray([]),this.archivedAudio=t.observableArray([]),this.pushAsset=function(e){var t=e.IsDeleted?c.archivedAssets:c.assets,a=e.IsDeleted?c.archivedImages:c.images,r=e.IsDeleted?c.archivedFiles:c.files,o=e.IsDeleted?c.archivedAudio:c.audio;t.push(e);var s=e.DocumentType===St||e.DocumentType===xt,l=/\.ico$/i.test(e.Name);if(!s||l&&!n){var d=new v(e);r.push(d),e.DocumentType!==Tt||i(o,d)||o.push(d)}else a.push(d=new f(e));return d},this.removeAsset=function(e){if(lt.selected.remove(e),e.type===St)c.images.remove(e),c.archivedImages.push(e);else{c.files.remove(e),c.archivedFiles.push(e),e.type===Tt&&(c.audio.remove(e),c.archivedAudio.push(e));var n=t.utils.arrayFirst(c.assets(),function(t){return parseInt(t.id||t.Id)===parseInt(e.id)});n&&(c.assets.remove(n),c.archivedAssets.push(n))}c.currentTab.valueHasMutated()},this.restoreAsset=function(e){if(lt.selected.remove(e),e.type===St)c.images.push(e),c.archivedImages.remove(e);else{c.files.push(e),c.archivedFiles.remove(e),e.type===Tt&&(c.audio.push(e),c.archivedAudio.remove(e));var n=t.utils.arrayFirst(c.assets(),function(t){return parseInt(t.id||t.Id)===parseInt(e.id)});n&&(c.assets.push(n),c.archivedAssets.remove(n))}c.currentTab.valueHasMutated()},this.setAssets=function(e){var t={};this.assets().forEach(function(e){t[e.ReferenceId]=!0}),e.filter(function(e){return!(e.ReferenceId in t)}).forEach(this.pushAsset.bind(this))},this.themeImages=[],this.setThemeAssets=function(e){for(var t=[],n=0;n<e.length;n++)e[n].DocumentType===St&&t.push(new f(e[n]));c.themeImages=t};var x=40;this.filter=t.observable(""),this.filters=t.observableArray([]),this.setFilter=function(e){if(e&&e.filter){var t=c.filter()===e.filter?e.filter+"-reverse":e.filter;c.filter(t),j("sorted_by"+t,"toggle")}},this.filterSelected=function(e){return 0===c.filter().indexOf(e)},this.filterReversed=function(){return"-reverse"==c.filter().substr(-8)},this.uploadedFilter=new S(new Object({cache:t.observableArray([]),hasCache:function(){return this.cache().length},hasMore:function(){return!1},getCache:function(){return this.cache().slice(0)},getAssets:function(){return!1}})),this.uploadedFilter.filter.list=t.computed(function(){var t,n=[],i=c.currentTab(),a=c.type();if("uploaded"==i)c.uploadedFilter.requesting(!0),c.showDeleteButton(!0),t=c.filter(),a===St?n=c.images():a===Ct?n=c.files():a===Tt&&(n=c.audio()),t&&(c.uploadedFilter.filter.cache(tt(n,t)),c.uploadedFilter.assets(c.uploadedFilter.filter.cache().slice(0,x)),e("ul",zt).scrollTop(0)),c.uploadedFilter.requesting(!1);
else if("archived"==i)!c.insertCancelButtons&&Bt&&(c.insertCancelButtons=Bt.wsbDialog("getButtons")),c.uploadedFilter.requesting(!0),c.showDeleteButton(!1),t=c.filter(),a===St?n=c.archivedImages():a===Ct?n=c.archivedFiles():a===Tt&&(n=c.archivedAudio()),t&&(c.uploadedFilter.filter.cache(tt(n,t)),c.uploadedFilter.assets(c.uploadedFilter.filter.cache().slice(0,x)),e("ul",zt).scrollTop(0)),c.uploadedFilter.requesting(!1);else if("theme"===i)c.uploadedFilter.requesting(!0),c.showDeleteButton(!1),t=c.filter(),a===St&&(n=c.themeImages),t&&(c.uploadedFilter.filter.cache(tt(n,t)),c.uploadedFilter.assets(c.uploadedFilter.filter.cache().slice(0,x)),e("ul",zt).scrollTop(0)),c.uploadedFilter.requesting(!1);else{var r=c.uploadedFilter.filter.cache();r.length&&c.uploadedFilter.assets(r.slice(0,x))}if(c.selected&&("archived"===i||"archived"===c.previousTab)&&i!==c.previousTab){var o=c.selected()||[];c.selected(c.previousSelected||[]),c.previousSelected=o,c.previousTab=i}Bt&&(c.buttons="archived"===i?k:c.insertCancelButtons,c.buttons&&Bt.wsbDialog("getButtons")!==c.buttons&&(Bt.wsbDialog("setButtons",c.buttons),Bt.wsbDialog(c.selected().length>0?"enableButton":"disableButton",0)))}),this.stockFilter=new S(new Object({cache:{},term:t.observable(""),searchTerm:t.observable(""),categoryId:t.observable(!1),categories:t.observableArray([]),hasCache:function(){var t=this.categoryId(),n=this.searchTerm();return e.isNumeric(t)&&this.cache[t]&&this.cache[t].Terms[n]},hasMore:function(){return this.hasCache()?this.cache[this.categoryId()].Terms[this.searchTerm()].NextPage!==!1:!1},getCache:function(){return this.hasCache()?this.cache[this.categoryId()].Terms[this.searchTerm()].Photos.slice(0):[]},getAssets:function(t,n){var i=this.categoryId(),a=this.searchTerm(),o=this;e.isNumeric(i)?r.Post(bt,{action:"StockGetImages",source:"stock",viewModel:{CategoryId:i,ItemPerPage:x,PageNumber:t?1:this.cache[i].Terms[a].NextPage,SearchTerm:a}},function(r){var s=[];if(r){r.ImageData&&(s=r.ImageData);var l=r.PageNumber>=r.TotalPages?!1:r.PageNumber+1;if(t)o.cache[i]||(o.cache[i]={Terms:{}}),o.cache[i].Terms[a]={Photos:s.slice(0),NextPage:l};else{for(var d=0;d<s.length;d++)o.cache[i].Terms[a].Photos.push(s[d]);o.cache[i].Terms[a].NextPage=l}}e.isFunction(n)&&n(s.slice(0))},function(){e.isFunction(n)&&n()}):e.isFunction(n)&&n()}})),this.stockFilter.skipTrackEvent=!0,this.stockFilter.reset=function(){c.stockFilter.filter.term(""),c.stockFilter.filter.searchTerm(""),c.stockFilter.skipTrackEvent=!0,c.stockFilter.filter.categories().length&&c.stockFilter.filter.categoryId(c.stockFilter.filter.categories()[0].Id)},this.stockFilter.filter.i18Dict={Search:p.resources.Server__Search},this.stockFilter.filter.search=function(){var t=c.stockFilter.filter.categoryId(),n=e.trim(c.stockFilter.filter.term());j("search_free_images","button"),e("ul",zt).scrollTop(0),c.stockFilter.filter.searchTerm(n),c.stockFilter.filter.term(n),c.stockFilter.filter.cache[t]&&c.stockFilter.filter.cache[t].Terms[n]?c.stockFilter.assets(c.stockFilter.filter.cache[t].Terms[n].Photos.slice(0,x)):c.stockFilter.getAssets()},this.stockFilter.filter.categoryId.subscribe(function(n){if(e.isNumeric(n)){if(c.stockFilter.skipTrackEvent)c.stockFilter.skipTrackEvent=!1;else{var i=t.utils.arrayFirst(c.stockFilter.filter.categories(),function(e){return e.Id===n})||{};j("freeimages_category","dropdown."+i.Name||"unknown")}var a=c.stockFilter.filter.searchTerm();c.stockFilter.filter.term(a),c.stockFilter.filter.cache[n]&&c.stockFilter.filter.cache[n].Terms[a]?c.stockFilter.assets(c.stockFilter.filter.cache[n].Terms[a].Photos.slice(0,x)):c.stockFilter.getAssets()}}),this.stockFilter.filter.list=t.computed(function(){var e=c.currentTab();if("stock"==e){var t=c.stockFilter.filter.categories();t.length||(c.stockFilter.requesting(!0),r.Post(bt,{action:"StockCategory",source:"stock"},function(e){c.stockFilter.requesting(!1),e&&e.length&&(c.stockFilter.filter.categories(e),c.stockFilter.filter.categoryId(e[0].Id))},function(){c.stockFilter.requesting(!1)}))}else{var n=c.stockFilter.assets();c.stockFilter.filter.term(c.stockFilter.filter.searchTerm()),n.length&&c.stockFilter.assets(n.slice(0,x))}}),this.facebookFilter=new S(new Object({cache:{},pageId:t.observable(),albumId:t.observable(),pages:t.observableArray([]),albums:t.observableArray([]),hasCache:function(){var t=this.albumId();return e.isNumeric(t)&&this.cache[t]&&this.cache[t].Photos},hasMore:function(){return this.hasCache()?this.cache[this.albumId()].NextPage!==!1:!1},getCache:function(){return this.hasCache()?this.cache[this.albumId()].Photos.slice(0):[]},getAssets:function(t,n){var i=this,a=this.albumId();e.isNumeric(a)?r.Post(bt,{action:"FacebookGetPhotos",source:"facebook",viewModel:{AlbumId:a,NextPageUrl:t?"":this.cache[a].NextPage,PhotoLoaded:!t}},function(r){var o=[];if(r)if(r.FacebookAuthroized===!1)ut.removeAuth();else{var s=r.NextPageUrl||!1;if(r.Photos&&(o=r.Photos),t)i.cache[a]={Photos:o.slice(0),NextPage:s};else{for(var l=0;l<o.length;l++)i.cache[a].Photos.push(o[l]);i.cache[a].NextPage=s}}e.isFunction(n)&&n(o.slice(0))},function(){e.isFunction(n)&&n()}):e.isFunction(n)&&n()}})),this.facebookFilter.skipTrackEvent=!0,this.facebookFilter.reset=function(){c.facebookFilter.skipTrackEvent=!0,c.facebookFilter.filter.pages().length&&c.facebookFilter.filter.pageId(c.facebookFilter.filter.pages()[0].Id)},this.facebookFilter.filter.reset=function(){c.facebookFilter.filter.cache={},c.facebookFilter.filter.pages([]),c.facebookFilter.filter.albums([]),c.facebookFilter.assets([]),c.facebookFilter.filter.pageId(!1),c.facebookFilter.filter.albumId(!1)},this.facebookFilter.filter.pageId.subscribe(function(e){if(e){var n=t.utils.arrayFirst(c.facebookFilter.filter.pages(),function(t){return t.Id===e});n&&(c.facebookFilter.skipTrackEvent||j("facebook_change_page","select"),c.facebookFilter.filter.albums(n.Albums),n.Albums.length?c.facebookFilter.filter.albumId(n.Albums[0].Id):(c.facebookFilter.filter.albumId(!1),c.facebookFilter.assets([])))}}),this.facebookFilter.filter.albumId.subscribe(function(t){t&&(c.facebookFilter.requesting()||(c.facebookFilter.skipTrackEvent||j("facebook_change_album","select"),e("ul",zt).scrollTop(0),c.facebookFilter.filter.cache[t]?c.facebookFilter.assets(c.facebookFilter.filter.cache[t].Photos.slice(0,x)):c.facebookFilter.getAssets())),c.facebookFilter.skipTrackEvent=!1}),this.facebookFilter.filter.list=t.computed(function(){var e=c.currentTab(),t=c.facebookAuth();if("facebook"==e&&t){var n=c.facebookFilter.filter.pages();n.length||(c.facebookFilter.requesting(!0),r.Post(bt,{action:"FacebookGetPages",source:"facebook",albums:!0},function(e){c.facebookFilter.requesting(!1),e&&(e.FacebookAuthroized===!1&&ut.removeAuth(),e.Pages&&e.Pages.length&&(c.facebookFilter.filter.pages(e.Pages),c.facebookFilter.filter.pageId(e.Pages[0].Id)))},function(){c.facebookFilter.requesting(!1)}))}else{var i=c.facebookFilter.assets();i.length&&c.facebookFilter.assets(i.slice(0,40))}}),this.facebookAuth.subscribe(function(e){e||c.facebookFilter.filter.reset()}),this.instagramFilter=new S(new Object({cache:{},hasCache:function(){return this.cache&&this.cache.Photos},hasMore:function(){return this.hasCache()?this.cache.NextPage!==!1:!1},getCache:function(){return this.hasCache()?this.cache.Photos.slice(0):[]},getAssets:function(t,n){var i=this;r.Post(bt,{action:"InstagramGetImages",source:"instagram",viewModel:{NextPageUrl:t?"":this.cache.NextPage}},function(a){var r=[];if(a)if(a.InstagramAuthorized===!1)pt.removeAuth();else{var o=a.NextPageUrl||!1;if(a.Photos&&(r=a.Photos),t)i.cache={Photos:r.slice(0),NextPage:o};else{for(var s=0;s<r.length;s++)i.cache.Photos.push(r[s]);i.cache.NextPage=o}}e.isFunction(n)&&n(r.slice(0))},function(){e.isFunction(n)&&n()})}})),this.instagramFilter.filter.reset=function(){c.instagramFilter.filter.cache={},c.instagramFilter.assets([])},this.instagramFilter.filter.list=t.computed(function(){var e=c.currentTab(),t=c.instagramAuth();if("instagram"===e&&t)c.instagramFilter.filter.cache.Photos||c.instagramFilter.getAssets();else{var n=c.instagramFilter.assets();n.length&&c.instagramFilter.assets(n.slice(0,40))}}),this.instagramAuth.subscribe(function(e){e||c.instagramFilter.filter.reset()}),this.list=t.computed(function(){var e=c.currentTab(),t=[];switch(e){case"uploaded":case"archived":case"theme":t=c.uploadedFilter.assets();break;case"stock":t=c.stockFilter.assets();break;case"facebook":t=c.facebookFilter.assets();break;case"instagram":t=c.instagramFilter.assets()}return setTimeout(function(){z()},0),t}),this.throttledList=new h(this.list),this.scrolled=function(e,t){var n=t.target;if(n.scrollTop>n.scrollHeight-n.offsetHeight-100)switch(c.currentTab()){case"uploaded":case"archived":case"theme":c.uploadedFilter.getAssets();break;case"stock":c.stockFilter.getAssets();break;case"facebook":c.facebookFilter.getAssets();break;case"instagram":c.instagramFilter.getAssets()}$t&&$t.length&&$t.sfContext("close")},this.selected=t.observableArray([]),this.selectedPath=t.computed(function(){var t=this.selected(),n=e(".wsb-media-chooser-info");if(this.isMultiSelect())return"";if(0==n.length)return"";if(t.length&&"uploaded"==this.currentTab()){var i=t[0];n.fadeIn(250);var a="";return i.url?a=i.url:i.large?a=i.large:i.LargeSizeUrl&&(a=i.LargeSizeUrl),a}return n.fadeOut(250),""},this,{deferEvaluation:!0}),this.selected.subscribe(function(e){jt&&jt.length&&Bt.wsbDialog(e.length?"enableButton":"disableButton",0)}),this.select=function(e){c.selected.indexOf(e)>=0?c.selected.remove(e):c.isMultiSelect()||"archived"===c.currentTab()?c.selected.push(e):c.selected([e])},this["delete"]=function(t){j("delete","icon"),et.save().then(function(){return jt.sfMsgOverlay({message:p.resources.Client__Designer__Deleting}),o(t)}).then(function(e){return e>0?s(e):l(t).then(function(){lt.removeAsset(t)})}).fail(function(){e("<div/>").sfGrowl({title:p.resources.Client__Designer__Yikes_hit_a_snag,content:p.resources.Client__Designer__TryAgainCustomerSupport,icon:"error"})}).always(function(){jt.sfMsgOverlay({message:null})})},this.restoreDocuments=function(e){for(var t=[],n=0,i=0;i<e.length;i++)t.push({documentId:e[i].id,isDeleted:!1}),n+=e[i].dataUsageInMB||0;var r={type:"patch",url:"/websites/{websiteId}/documents",contentType:"application/json",headers:q(),data:JSON.stringify(t)};return a.ajax(r).then(function(){for(var t=0;t<e.length;t++)lt.restoreAsset(e[t]);lt.spaceUsed(lt.spaceUsed()-n)})},this.autoFitCss=function(e,t){var n=e.width(),i=e.height(),a=i/n,r=t.width(),o=t.height(),s=o/r,l=0,d=0,c=void 0,u=void 0;return 1>a?1>s&&a>s?d=r:l=o:a>1?s>1&&s>a?l=o:d=r:1>s?d=r:l=o,l?c=-(n*(l/i)-r)/2:u=-(i*(d/n)-o)/2,{width:d||"auto",height:l||"auto",left:c,top:u}},this.loadAsset=function(t){var n=e(t).children("div.loading");if(n.length){var i=arguments[arguments.length-1];if(i)if(i.thumbnail||i.ThumbnailUrl){var a=e("<img/>").bind("load",function(){a.appendTo(n.removeClass("loading")).css(c.autoFitCss(a,n)).unbind("load")});a[0].src=i.thumbnail||i.ThumbnailUrl}else i.mime&&n.removeClass("loading").addClass("wsb-mime wsb-mime-"+(i.mime?i.mime:"unknown")+" large")}},this.carouselMarginLeft=t.observable(0),this.carouselMarginLeft.subscribe(function(t){e("."+_t+"-carousel ul",Rt).stop(!0,!0).animate({marginLeft:t},"fast")}),this.carouselLeftEnabled=t.computed(function(){var e=c.carouselMarginLeft();return 0>e}),this.carouselRightEnabled=t.computed(function(){var e=c.selected(),t=c.carouselMarginLeft();return e.length>10&&t>parseInt(-54*(e.length-10))}),this.carouselLeft=function(){c.carouselLeftEnabled()&&(c.carouselMarginLeft(c.carouselMarginLeft()+54),j("paginate-carousel","left"))},this.carouselRight=function(){c.carouselRightEnabled()&&(c.carouselMarginLeft(c.carouselMarginLeft()-54),j("paginate-carousel","right"))},this.getTemplate=function(e){var t="default";return e.type&&(t="document",e.type===St&&(t="image")),_t+"-template-"+t},this.spaceUsed=t.observable(0),this.showUpgrade=t.computed(function(){var e=c.spaceUsed();return Math.floor(e/yt*100)>=90}),this.spaceLeft=t.computed(function(){var t=c.spaceUsed(),n=t>0?Math.floor(t/yt*100)||"<1":0,i=c.showUpgrade();if(jt&&jt.length){var a=p.resources.Percent_of_GB_pattern,r='{2} <span class="wsb-media-chooser-space{3}">'+a+"</span>",o=r.sfFormat(n,Math.ceil(yt/1e3),Mt[nt],i?" upgrade":"");e("h3.sf-dialog-title",jt).html(o)}}),this.uploaded=t.observable(0),this.uploading=t.observable(0),this.uploadPercent=t.computed(function(){var e=parseInt(c.uploaded()),t=parseInt(c.uploading());return e>=t?"100%":Math.floor(e/t*100)+"%"}),this.uploadPercentWidth=t.computed(function(){var e=parseInt(c.uploaded()),t=parseInt(c.uploading());return e>=t?"400px":Math.round(e/t*400)+"px"}),u=[new w(this,{name:p.resources.Client__Designer__My_Photos,type:"uploaded",gaAction:"uploaded_photos"}),new w(this,{name:p.resources.Client__Designer__Free_Images,type:"stock",gaAction:"free_photos"}),new w(this,{name:p.resources.Facebook,type:"facebook",social:!0,gaAction:"facebook_photos"}),new w(this,{name:p.resources.Instagram,type:"instagram",social:!0,gaAction:"instagram_photos"})],this.isEditingMode=d.isThemeEditMode,this.isEditingMode||u.splice(1,0,new w(this,{name:p.resources.Client__Designer__Theme_Photos,type:"theme",gaAction:"theme_photos"})),g=[new w(this,{name:p.resources.Client__Designer__My_Files,type:"uploaded",gaAction:"uploaded_files"})],m=[new w(this,{name:p.resources.Client__Designer__My_Audio,type:"uploaded",gaAction:"uploaded_audiofiles"})],$()&&(u.push(new w(this,{name:p.resources.Client__Designer__Archived_Photos,type:"archived",gaAction:"archived_photos"})),g.push(new w(this,{name:p.resources.Client__Designer__Archived_Files,type:"archived",gaAction:"archived_files"})),m.push(new w(this,{name:p.resources.Client__Designer__Archived_Audio,type:"archived",gaAction:"archived_audiofiles"}))),this.isViewingLocalizedTheme=t.computed(function(){return d.isLocalizedTheme()}),this.localizedThemeNotice=t.computed(function(){return p.resources.Client__MediaChooser_LocalizedThemeModeNoticeFormat.replace("{locale}",d.themeLocaleName())})}function b(e){var n="enabled"===g.getOption("documentReferenceId")?"ReferenceId":"Id";this.id=e.Id||0,this.referenceId=e[n]||"",this.createDate=e.CreateDate,this.name=t.observable(e.Name||""),this.extension=e.Extension.toLowerCase()||""}function f(e){b.call(this,e),this.type=e.DocumentType||St,this.large=e.LargeSizeUrl||"",this.thumbnail=e.ThumbnailUrl||"",this.dataUsageInMB=e.SiteDataUsageMB,this.excludeFromEdit=e.ExcludeFromEdit||!1,this.type===xt&&(this.type=St)}function v(e){b.call(this,e),this.url=e.DocumentUrl||"",this.type=e.DocumentType||"document",this.name=t.observable(e.Name||""),this.newName=t.observable(e.Name||""),this.extension=e.Extension||"",this.dataUsageInMB=e.SiteDataUsageMB,this.mime=this.extension?this.getMime(this.extension):"",this.type===Tt&&(this.author=t.observable(e.Author||""),this.newAuthor=t.observable(e.Author||""),this.length=e.Length||"0:00",this.createDate=e.CreateDate||""),this.isValid=t.computed(this.checkValid,this),this.renamer=new y(this),this.isDeleted=e.IsDeleted}function y(e){this.file=e,this.error=t.observable(""),this.isOpen=t.observable(!1),this.isOpen.subscribe(this.onToggle,this)}function w(n,i){e.extend(this,i),this.$parent=n,this.social&&(this.hasAuth=t.computed(this.computed_hasAuth,this)),this.cssClasses=t.computed(this.computed_cssClasses,this)}function S(e){this.filter=e,this.assets=t.observableArray([]),this.requesting=t.observable(!1),this.requesting.subscribe(function(e){lt&&lt.requesting&&lt.requesting(e)})}function k(e,t){O(wt,null,null,t,e)}function x(t,n,i,a){e.isFunction(i)&&(a=i,i=!1),O(i?kt:St,t,n,a)}function C(e,t,n){O(Ct,e,t,n)}function T(e,t,n){O(Tt,e,t,n)}function E(t,n){L(function(){e.isFunction(t)&&t(n?lt.images:lt.images().slice(0))})}function P(t,n){L(function(){e.isFunction(t)&&t(n?lt.files:lt.files().slice(0))})}function D(t,n){L(function(){e.isFunction(t)&&t(n?lt.archivedFiles:lt.archivedFiles().slice(0))})}function I(e,t){return t?(L(function(){t(e?lt.files:lt.files().slice(0))}),!0):(lt||(lt=new m),e?lt.audio:lt.audio().slice(0))}function A(e,t){return t?(L(function(){t(e?lt.archivedAudio:lt.archivedAudio().slice(0))}),!0):(lt||(lt=new m),e?lt.archivedAudio:lt.archivedAudio().slice(0))}function M(e){if(e&&e.length){lt||(lt=new m);for(var n=lt.audio().slice(0),i=0;i<e.length;i++){var a=e[i].ReferenceId||e[i].referenceId,r=n.length&&t.utils.arrayFirst(n,function(e){return e.referenceId===a});r||(e[i]instanceof v?lt.audio.push(e[i]):lt.pushAsset(e[i]))}}}function O(i,o,s,l,d){function c(t){var n=!1;dt=!1;var i=e.Deferred(),a=t.filter(function(e){return!e.type}).map(function(e){return u(e).then(function(t){n||i.notify({asset:e,result:t})}).fail(function(){n||(lt.removeAsset(e),V(Et,!0),j("error-transfer","general"))})});e.when.apply(e,a).done(function(){i.resolve()}).fail(function(){i.reject()});var r=i.promise();return r.cancel=function o(){o=!0},r}function u(e){return $()?a.ajax({type:"post",url:"/websites/{websiteId}/documents",dataType:"json",contentType:"application/json",data:JSON.stringify({url:e.LargeSizeUrl})}).then(F).then(function(e){return e.FileList[0]}):r.Post(mt,{websiteId:Y.websiteId,image:e,editMode:Y.editingMode})}var g=i===kt;if(i=i.replace("-ico",""),Bt&&Bt.length){if(Bt.wsbDialog("isopen")){if(i!==wt){var h=this,b=it;it=function(){e.isFunction(b)&&b.apply(h,arguments),setTimeout(function(){O(i,o,s,l,d)},1e3)},Bt.wsbDialog("close")}return}}else e(n).appendTo("body"),Bt=e("#"+_t),Ut=e("#"+_t+"-progress"),Ft=e("."+_t+"-tabs",Bt),Rt=e("."+_t+"-content",Bt),qt=e("."+_t+"-uploader",Rt),Ht=e("."+_t+"-messages",Rt),Vt=e("."+_t+"-filters",Rt),zt=e("."+_t+"-list",Rt);nt=i;var f=!!o;it=l||!1,rt=i===Ct?"file_manager":i===St?"choose_photos_modal":"audio_chooser",ot=!1,at=e.isArray(s)&&s.length?s:!1;var v=function(){if(!f&&at){var e=[];i===St?e=lt.images():i===Ct?e=lt.files():i===Tt&&(e=lt.audio());for(var n=0;n<at.length;n++){var a=t.utils.arrayFirst(e,function(e){return at[n].id===e.referenceId||at[n].id===e.id});a&&lt.selected.push(a)}}};if(lt||(lt=new m(g)),lt.hasLatest()?(lt.selected([]),v()):(lt.requesting(!0),L(function(){v(),lt.requesting(!1)})),lt.type(nt),lt.isMultiSelect(f),lt.type()!==nt)lt.type(nt);else{var y=lt.filters();lt.filter(y.length?y[0].filter:"")}lt.currentTab("uploaded"),lt.stockFilter.reset(),lt.facebookFilter.reset(),nt===wt?d&&d.length&&(lt.uploading()?qt.sfUpload("addFiles",d):Ut.wsbDialog({title:p.resources.Uploading,buttons:[],draggable:!1,cancelDisabled:!0,destroyOnClose:!1,onOpen:function(e){R(),qt.sfUpload("addFiles",d),Wt&&Wt.length||t.applyBindings(lt,(Wt=e)[0]),j("open","drag")},onClose:function(){H(),j("close","done"),e.isFunction(it)&&it()}})):Bt.wsbDialog({title:Mt[nt],buttons:[{text:p.resources.Client__Designer__Insert,onClick:function(){j("insert","button"),Bt.wsbDialog("disableButton",0),lt.currentTab("uploaded");var t=lt.selected()||[],n=t.length,i=0,a=jt.sfMsgOverlay({message:'<div><span class="bar wsb-media-chooser-bar"></span><span class="percent">0%</span><span class="cancel wsb-media-chooser-link">'+p.resources.Cancel+"</span></div>"}).find(".sf-msg-overlay").addClass(_t+"-chooser-progress"),r=c(t).progress(function(t){i++;var r=Math.floor(i/n*100);if(e("span.bar",a).width(4*r),e("span.percent",a).text(r+"%"),t.result){var o=t.result,s=t.asset,l=lt.pushAsset(o);lt.selected.replace(s,l),o.SiteDataUsageMB&&lt.spaceUsed(o.SiteDataUsageMB),j("transfer",s.Id.split("_")[0])}else V(Et,!0),j("error-transfer","null-object")}).done(function(){if(jt.sfMsgOverlay({message:null}),j("close","save"),e.isFunction(it)){var t=lt.selected().map(function(e){return _.merge(_.omit(e,"referenceId"),{id:e.referenceId})});it(t)}Bt.wsbDialog("close")}).fail(function(){Bt.wsbDialog("enableButton",0)}),o=e(".cancel",a[0]);e(document).on("click",o,function(){r.cancel()})}},{text:p.resources.Cancel,cancel:!0,style:"link",onClick:function(){j("cancel","link")}}],destroyOnClose:!1,onOpen:function(n){R(),jt&&jt.length||t.applyBindings(lt,(jt=n).closest(".sf-dialog")[0]),lt.spaceUsed.valueHasMutated(),Bt.wsbDialog(lt.selected().length?"enableButton":"disableButton",0),lt.carouselMarginLeft(0),e("ul",zt).scrollTop(0),lt.requesting.valueHasMutated(),z();try{jt.wsbDialog("resize")}catch(i){}},onClose:function(){H(),Ht&&Ht.length&&Ht.children(":visible").sfAlert("destroy"),$t&&$t.length&&$t.sfContext("close"),lt.selected([]),arguments[1]&&j("xclose","icon"),e.isFunction(it)&&it()}})}function L(e,t){if(lt||(lt=new m),!Gt||t){var n=G();Gt=n.read?B(n.failover):N(),Gt.then(function(e){e&&(e.FileList&&e.FileList.length&&lt.setAssets(e.FileList),e.SiteDataUsageMB&&lt.spaceUsed(e.SiteDataUsageMB),e.ThemeFiles&&e.ThemeFiles.length&&lt.setThemeAssets(e.ThemeFiles)),lt.hasLatest(!!e)}).fail(function(){lt.hasLatest(!1),Gt=null})}Gt.always(e)}function N(){return r.Get(ht)}function B(e){return a.ajax({url:"/websites/{websiteId}/documents?deleted=true",headers:q(),xhrFields:{withCredentials:!0}}).then(F).fail(function(t){if(e)return N();throw t})}function F(e){var t={};e.forEach(function(e){t[e.documentId]=e});var n={FileList:[],ThemeFiles:[]},i=0;return e.forEach(function(e){if("customer"===e.owner&&(i+=e.fileSize),!/^generated/.test(e.type)){var a=e.metadata||{},r=a.title||e.originalFilename||"",o={Id:e.documentId,ReferenceId:e.referenceId,Name:r,CreateDate:e.createDate,DocumentUrl:e.downloadURL,Extension:r.replace(/^.*\./,""),DocumentType:e.type,SiteDataUsageMB:e.fileSize/Nt,IsDeleted:e.isDeleted};switch(e.type){case"image":o.ThumbnailUrl=o.LargeSizeUrl=e.downloadURL,e.relatedDocuments&&e.relatedDocuments.generatedSmall&&t[e.relatedDocuments.generatedSmall]&&(o.ThumbnailUrl=t[e.relatedDocuments.generatedSmall].downloadURL||o.ThumbnailUrl),o.ExcludeFromEdit=!!a.isAnimated;break;case"audio":o.Extension="mp3",o.Author=a.artist,o.Length=a.length}"designer"===e.owner&&"customer"===Y.editMode()?n.ThemeFiles.push(o):n.FileList.push(o)}}),n.SiteDataUsageMB=i/Nt,n}function R(){var n=p.resources.Client__Designer__You_can_also_drop_files_here.sfFormat(ft);nt===Tt&&(n=p.resources.Client__Designer__You_can_also_drop_files_here_mp3.sfFormat(ft)),qt.sfUpload({accept:Lt[nt],uploadPath:W(),condensed:!0,expectData:!0,maxFileSize:vt,withCredentials:!0,txt:{select:'<i class="'+Ot[nt]+' icon-wsb-white"></i>'+p.resources.Client__Designer__Browse,upload:"",intro:n,introWithDrop:n,introMaxItems:"",statusPending:"",statusUploading:p.resources.Uploading,statusFinished:n,pending:"",finished:"",uploading:"",dd_info:p.resources.Client__Designer__Drop_files_here_to_upload,dd_dest:"<br/>"+p.resources.Client__Designer__My_Photos_or_Files,dd_limits:"<strong>"+p.resources.Client__Designer__Restrictions+"</strong><br/>"+p.resources.Client__Designer__Non_executable_files_only.sfFormat(ft,1920,1080),dd_cancel:p.resources.Cancel,cancel:p.resources.Client__Designer__Are_you_sure_cancel_uploads,yes:p.resources.Yes,no:p.resources.No,error:p.resources.Error,retry:p.resources.Try_Again},onStart:function(t,n){if(nt!==wt&&lt.currentTab("uploaded"),Ht&&Ht.length&&Ht.children(":visible").sfAlert("destroy"),j("upload-count",""+((t||[]).length||0)+((n||[]).length||0)),dt=!1,ct=!1,lt.uploading(t.length),nt!==wt&&(Ht.children(":visible").sfAlert("destroy"),t&&t.length?(qt.addClass("uploading"),e(".sf-upload-scroller",qt).after(e("<span></span>").addClass("sf-upload-cancel").text(p.resources.Cancel).click(function(){qt.sfUpload("cancel")})).show()):setTimeout(function(){e(".sf-upload-scroller").hide()},0)),n&&n.length){V(Pt);for(var i=0;i<n.length;i++)j("error-upload","too-big")}},onSuccess:function(t,n,i){if(lt.uploaded(lt.uploaded()+1),"object"!=typeof i)try{i=JSON.parse(i)}catch(a){return V(Et),void j("error-upload","bad-object")}if(i)if(e.isArray(i)){var r=F(i),o=r.FileList.concat(r.ThemeFiles);o.forEach(U)}else U(i);else V(Et),j("error-upload","null-object")},onError:function(){lt.uploaded(lt.uploaded()+1),V(Et),j("error-upload","general")},onFinish:function(){if(nt===wt){if(ct&&ct.length){Q.collectChanges();var n=s.addNewElementToCanvas({Type:"audioplayer",Top:!1,Left:!1});if(n){var i=s.getElementViewModel(t.toJS(n.id));i.setAssets(ct,!0),setTimeout(function(){Q.persistChanges()},0)}else Q.cancelChanges()}Ut.wsbDialog("close")}else qt.removeClass("uploading"),e(".sf-upload-cancel",qt).remove(),e(".sf-upload-scroller").hide();lt.uploaded(0),lt.uploading(0)},onGetUploader:a.onGetUploader,headers:q()}),e('input[id^="file"]',qt).attr("title",p.resources.Client__Designer__Browse);var i=e(".sf-upload-btns",qt),r=e(".sf-upload-status",qt),o=e("object",i);o.length?o.bind("mousedown",function(){j("browse","button")}):e("label",i).bind("click",function(){j("browse","button")}),window.setTimeout(function(){var e=i.outerWidth(),t=e+20,n=qt.width(),a=n-t-10;r.css("left",t+"px").css("text-align","left").css("margin-left","0").css("width",a+"px").css("padding-right","0")},1)}function H(){lt.uploading(0),qt.sfUpload("destroy")}function V(t,n){if(n||nt===wt)dt||t===At||(e("<div/>").sfGrowl({title:p.resources.Yikes,content:p.resources.Client__Designer__Somethings_gone_wrong_not_uploaded,icon:"error"}),dt=!0);else{var i,a="error",r="error",o=!1;switch(t){case At:a="wrongType",r="info",i=p.resources.Client__Designer__Success_here,o={title:p.resources.Client__Designer__Where_are_my_files,content:p.resources.Client__Designer__Files_are_sorted},nt===Ct?i=p.resources.Client__Designer__Success_File_Manager:nt===St?i=p.resources.Client__Designer__Success_Photo_Chooser:nt===Tt&&(i=p.resources.Client__Designer__Success_Audio_Chooser),j("error-upload","wrong-type");break;case Pt:a="skipped",i=p.resources.Client__Designer__Uh_oh_files_exceeds.sfFormat(ft);break;case Dt:a="invalid",i=p.resources.Client__Designer__One_or_more_files_not_supported,j("error-upload","invalid-type");break;case It:a="limit",i=p.resources.Client__Designer__Uh_oh_site_limit.sfFormat(Math.ceil(yt/1e3)),j("error-upload","upload-limit");break;case Et:default:i=p.resources.Client__Designer__Yikes_upload_not_successful}var s=Ht.find("div."+a);s.length?s.is(":visible")&&e("> div:first-child",Ht).hasClass(a)?s=!1:s.prependTo(Ht):s=e("<div/>").addClass(a).prependTo(Ht),s&&s.length&&s.sfAlert({style:r,message:i,onClosed:function(){z()},onShown:function(){o&&e("<span/>").appendTo(e(".sf-alert-msg",s)).sfTipper(o),z()}})}}function z(){if(Rt&&Rt.length&&zt&&zt.length){var t=0;Rt.children(":visible").not(zt).not(e(".sf-msg-overlay-wrap")).each(function(){t+=e(this).outerHeight(!0)}),zt.height(Rt.height()-t)}}function j(e,t,n){if("close"===e){if(ot)return;ot=!0}u.trackEvent(rt,e,t,n)}function U(e){if(e.ExceptionType)V(e.ExceptionType);else if(e.DocumentType){var n=lt.pushAsset(e),i=nt===n.type&&"ico"!==n.extension||nt===Ct&&n.type===Tt;if(e.SiteDataUsageMB&&lt.spaceUsed(e.SiteDataUsageMB),i||nt===wt){if(j("upload",n.extension||"unknown"),i&&lt.select(n),nt===wt){Q.collect("upload asset");var a=!1;if(n.type===St){if(a=s.addNewElementToCanvas({Type:"image",Top:!1,Left:!1})){var r=s.getElementViewModel(t.toJS(a.id));r&&r.setContent(n.referenceId,n.large,n.excludeFromEdit,!0)}}else if(n.type===Ct){if(a=s.addNewElementToCanvas({Type:"button",Top:!1,Left:!1})){var o=s.getElementViewModel(t.toJS(a.id));o.updateFromFileUpload(n)}}else n.type===Tt&&(ct&&ct.length?ct.push(n):ct=[n]);a?setTimeout(function(){Q.enable("upload asset")},0):Q.cancelChanges("upload asset")}}else V(At)}else V(Et),j("error-upload","bad-object")}function W(){var e=$()?J.apiBaseUrl+"/websites/"+Y.websiteId+"/documents":ht;return e}function q(){var e={"x-edit-mode":Y.editMode(),"x-shopper-id":Y.shopperId};return d.isThemeEditMode&&(Y.isDdtManager?e["x-role"]="ddtManager":Y.isDdtDesigner&&(e["x-role"]="ddtDesigner")),e}function $(){return c.shouldWriteToApi("documentProvider")}function G(){return c.shouldReadFromApi("documentProvider")}var K,Y,J,Z,X,Q,et,tt,nt,it,at,rt,ot,st,lt,dt,ct,ut,pt,gt,ht,mt,bt,ft,vt,yt,_t="wsb-media-chooser",wt="upload",St="image",kt="image-ico",xt="animated image",Ct="document",Tt="audio",Et=null,Pt=0,Dt="InvalidFileTypeException",It="UploadLimitExceededException",At=3,Mt={},Ot={},Lt={},Nt=1048576;Mt[St]=p.resources.Client__Designer__Choose_Photos,Mt[Ct]=p.resources.Client__Designer__File_Manager,Mt[Tt]=p.resources.Client__Designer__Choose_Audio,Ot[St]="icon-img",Ot[Ct]="icon-document",Ot[Tt]="icon-audio",Ot[wt]="",Lt[St]="image/*",Lt[Ct]="*",Lt[Tt]="audio/mpeg",Lt[wt]="*";var Bt,Ft,Rt,Ht,Vt,zt,jt,Ut,Wt,qt,$t;f.prototype={toModel:function(){return{id:this.id,type:this.type,name:this.name,thumbnail:this.thumbnail,large:this.large,excludeFromEdit:this.excludeFromEdit}},toJS:function(){return t.toJS(this.toModel())}},v.prototype={i18Dict:{Cancel:p.resources.Cancel,Ok:p.resources.OK},i18DictCopy:p.resources,getMime:function(t){var n=t.toLowerCase();return e.inArray(n,["doc","docx"])>=0?"doc":e.inArray(n,["xlr","xls","xlsx"])>=0?"excel":e.inArray(n,["pps","ppt","pptx"])>=0?"ppt":e.inArray(n,["log","msg","odt","rtf","tex","txt","wpd","wps"])>=0?"text":e.inArray(n,["7z","cbr","deb","gz","pkg","rar","rpm","sitx","tar.gz","zip","zipx"])>=0?"zip":e.inArray(n,["wmv","3g2","3gp","asf","asx","avi","bik","bin","bsf","cpi","dat","divx","dmsm","dream","flv","f4v","fbr","hdmov","bdm","mov","mp4","mpg","m4v","mkv","mod","mpeg","mts","rm","srt","swf","trp","vob","webm"])>=0?"video":e.inArray(n,["mp3","mpa","wav","wma","wave","wax","mp2","mp1","aa3","acd","aif","acm","als","amr","at3","caf","cda","cpr","dcf","dmsa","dss","emp","emx","flac","gpx","iff","logic","m3u","m4a","m4b","m4r","m4p","mid","midi","mod","mpga","nki","nra","ogg","pcast","ptf","ra","sesx"])>=0?"audio":e.inArray(n,["jpg","tif","png","gif","tga","jpe","jps","jfif","jpx","bmp","abm","afx","arw","cpg","cr2","dcm","dib","dng","dpx","hdp","ipx","itc2","jp2","mng","mxi","pictclipping","ppm","pspimage","pvr","rw2","sdr","sid","srf","yuv"])>=0?"image":e.inArray(n,["pdf","css","html","java","link","locked","php","project"])>=0?n:"unknown"},getParams:function(){if(!this.isValid())return!1;var e={label:this.newName()};return this.type===Tt&&(e.author=this.newAuthor(),e.length=this.length),e},checkValid:function(){var t=this.name(),n=this.newName();if(!e.trim(n))return!1;if(n!==t)return!0;if(this.type===Tt){var i=this.author(),a=this.newAuthor();if(a!==i)return!0}return!1},reset:function(){this.newName(this.name()),this.type===Tt&&this.newAuthor(this.author())},save:function(){this.name(this.newName()),this.type===Tt&&this.author(this.newAuthor())},toModel:function(){var e={id:this.id,type:this.type,name:this.name,extension:this.extension,mime:this.mime};return this.type===Tt&&(e.author=this.author,e.length=this.length,e.createDate=this.createDate),e},toJS:function(){return t.toJS(this.toModel())}},y.prototype={onToggle:function(e){e?(this.file.reset(),this.error("")):$t&&$t.length&&$t.sfContext("anchor").css("display","")},onOpen:function(t){$t=t,st=!1,j("rename_file","icon"),setTimeout(function(){$t.sfContext("anchor").css("display","block"),e("input",$t).first().focus()},0)},save:function(t){if(t&&t.tagName&&"form"===t.tagName.toLowerCase()){var n=e(t),i=this.renamer,o=this.getParams();if(o){i.error(""),jt.sfMsgOverlay({message:p.resources.Saving_ellipsis}),n.sfMsgOverlay({message:""}),Bt.sfDialog({closeOnEscape:!1});var s;$()?s=a.ajax({type:"PATCH",url:"/websites/{websiteId}/documents/"+this.id,dataType:"json",contentType:"application/json",data:JSON.stringify({metadata:{title:o.label,artist:o.author}})}):(o.id=this.referenceId,s=r.Put(gt+"?"+e.param(o),{}).then(function(e){if(!e||!e.success)throw new Error("Got back unexpected response.")})),s.always(function(){n.sfMsgOverlay({message:null}),jt.sfMsgOverlay({message:null}),Bt.sfDialog({closeOnEscape:!0})}).then(function(){i.file.save(),$t&&$t.length&&(j("ok_renaming","button"),$t.sfContext("close"))}).fail(function(){i.error(p.resources.Client__Designer__Error_please_try_again),j("error_renaming","general")})}}},close:function(){$t&&$t.length&&(j("cancel_renaming","link"),$t.sfContext("close"))}},w.prototype={computed_cssClasses:function(){var e=this.type,t=e,n=this.$parent.currentTab();
return this.social&&this.hasAuth()&&(t+=" social-authed"),n==e&&(t+=" selected"),t},computed_hasAuth:function(){return"facebook"==this.type?this.$parent.facebookAuth():"instagram"==this.type?this.$parent.instagramAuth():!1},select:function(){this.type!==this.$parent.currentTab()&&(this.$parent.currentTab(this.type),j(this.gaAction,"tab")),this.$parent.isMultiSelect()||"archived"===this.type||this.$parent.selected.removeAll()}},S.prototype={perPage:40,getAssets:function(){if(!this.requesting()){var e,n,i=this;if(this.filter.hasCache()){var a=this.filter.getCache(),r=this.assets().length;a.length>r?(this.requesting(!0),r>0&&"uploaded"===lt.currentTab()&&j("paginate","uploaded"),t.utils.arrayForEach(a.slice(r,r+this.perPage),function(e){i.assets.push(e)}),this.requesting(!1)):n=this.filter.hasMore()}else e=!0;(e||n)&&(this.requesting(!0),this.filter.getAssets(e,function(n){n&&n.length&&(e?i.assets(n):(j("paginate",lt.currentTab()),t.utils.arrayForEach(n,function(e){i.assets.push(e)}))),i.requesting(!1)}))}}},tt=function(){function e(e,t){return e.createDate&&t.createDate?e.createDate<t.createDate?a:e.createDate>t.createDate?i:0:parseInt(t.id,0)-parseInt(e.id,0)}function t(t,r,o){return t.name().toLowerCase()==r.name().toLowerCase()?o?e(t,r):n(t,r,!0):t.name().toLowerCase()>r.name().toLowerCase()?a:i}function n(n,r,o){return n.extension.toLowerCase()==r.extension.toLowerCase()?o?e(n,r):t(n,r,!0):n.extension.toLowerCase()>r.extension.toLowerCase()?a:i}var i,a;return function(r,o){switch(i=o!==(o=o.replace(/-reverse$/i,""))?1:-1,a=-1*i,lt&&lt.requesting&&lt.requesting(!0),o){case"date":r=r.sort(e);break;case"extension":r=r.sort(n);break;case"name":r=r.sort(t)}return lt&&lt.requesting&&lt.requesting(!1),r.slice(0)}}();var Gt=null;return{load:function(e){K=o.getDataModel(),Y=K.user,J=K.config,Z=K.info,X=K.website,Q=o.undoer,et=o.saver,gt="/api/websites/"+Y.websiteId+"/websitedocuments",ht=gt+"?editingMode="+Y.editingMode,mt=gt+"/UploadImageFromModel",bt="/api/websites/{websiteId}/StockSocialMedia",ft=J.uploadImageSizeMaxMB,vt=1024*ft*1024,yt=Z.Account.DataSpaceLimitMB,ut=i("facebook"),pt=i("instagram");var n=function(e){return{Id:e.Id,ReferenceId:e.ReferenceId,CreateDate:e.CreateDate,DocumentType:"audio",Name:e.Title,Author:e.Author,Length:e.Length,IsDeleted:e.IsDeleted,Extension:"mp3"}};M(_.map(t.toJS(X.assets.audioFileInfo),n)),e(null,"media.chooser")},upload:k,openImages:x,openFiles:C,openAudio:T,getImages:E,getFiles:P,getAudio:I,getArchivedFiles:D,getArchivedAudio:A,pushAudio:M,applyFilter:tt}}),define("text!designer/app/builder/ui/controls/siteSettings/favicon.html",[],function(){return'<script type="text/html" id="favicon">\r\n    <!-- ko if: allowFavicon -->\r\n    <!-- ko ifnot: faviconMediumUrl -->\r\n    <div class="favicon-add-image-button-container">\r\n        <a class="btn btn-inverse-grey" data-bind="click: faviconAddClick" data-aid="add-favicon-image-button">\r\n            <i class="icon-picture icon-white"></i>\r\n            <span data-bind="text: Strings.Client__Add_Image"></span>\r\n        </a>\r\n    </div>\r\n    <!-- /ko -->\r\n    <!-- ko if: faviconMediumUrl -->\r\n    <div class="favicon-preview-container">\r\n        <div class="favicon-preview-icon" data-bind="style: { backgroundImage: \'url(\\\'\' + faviconMediumUrl() + \'\\\')\' }"></div>\r\n        <a href="#" data-bind="click: faviconRemoveClick, text: Strings.Remove" data-aid="remove-favicon-image-button"></a>\r\n    </div>\r\n    <!-- /ko -->\r\n    <!-- /ko -->\r\n</script>\r\n'}),define("designer/app/builder/ui/controls/siteSettings/favicon",["jquery","knockout","lodash","/i18n/resources/client","common/abTesting/abTesting","designer/app/builder/ui/controls/media/chooser/media.chooser","common/stats/googleanalytics","common/api/websites/websitesAPI","text!designer/app/builder/ui/controls/siteSettings/favicon.html","common/logger/serverLogger","data/dataProvider"],function(e,t,n,i,a,r,o,s,l,d,c){function u(i){function l(e){n.isPlainObject(e)?(u.faviconSmallUrl(e[16]),u.faviconMediumUrl(e[32])):(u.faviconSmallUrl(e),u.faviconMediumUrl(e)),o.trackEvent("wsb-website-settings","image-selected","favicon"),d.post({action:"favicon-added",message:"Favicon added",detail:e})}var u=this;u.Strings={Remove:p.Remove,Client__Add_Image:p.Client__Add_Image};var g="enabled"===a.getOption("favicon");u.allowFavicon=t.observable(g),u.faviconSmallUrl=i.faviconSmallUrl,u.faviconMediumUrl=i.faviconMediumUrl;var h={headers:{"X-Client-Source":"site-settings"}},m=[16,32],b=n.partialRight(s.postDocumentModify,h),f=(n.partialRight(n.map,n.partialRight(n.pick,["documentId","downloadURL"])),n.partialRight(n.map,function(e){return{downloadURL:e.downloadURL,documentId:e.documentId||e.NebulaObjectKey}})),v=n.partialRight(n.map,function(e,t){return n.merge(e,n.mapValues({width:null,height:null},function(){return m[t]}))}),y=n.compose(v,f);u.faviconAddClick=function(){o.trackEvent("sitesettings","sitefeat_add_favicon","button"),r.openImages(!1,!1,!0,function(t){var i;if(t&&t.length){var a=t[0];if("ico"!==a.extension){var r=a.thumbnail.split("?")[0].split("/").pop().split(":")[0],o=function(){return c.shouldWriteToApi("documentProvider")?[b({id:r,refId:a.id,scaleWidth:16,scaleHeight:16}),b({id:r,refId:a.id,scaleWidth:32,scaleHeight:32})]:[b({id:r,refId:a.id})]}();e.when.apply(e,o).done(function(e){"success"!==arguments[1]&&(e=n.flatten(n.map(arguments,n.first))),i=y(e),l({16:n.find(i,{height:16}).downloadURL,32:n.find(i,{height:32}).downloadURL})}).fail(function(e){d.post({action:"favicon-modify-failed",message:"Favicon document modify failed (v2)",detail:e})})}else d.post({action:"favicon-is-icon",message:"Favicon is icon mime type"}),l(a.thumbnail)}})},u.faviconRemoveClick=function(){o.trackEvent("wsb-website-settings","remove-image","favicon"),d.post({action:"favicon-removed",message:"Favicon removed"}),l("")}}e(l).appendTo("body"),t.bindingHandlers.favicon={init:function(n,i){var a=new u(i()),r=e("<div data-bind=\"template: 'favicon'\"></div>").appendTo(n);return t.applyBindings(a,r.get(0)),{controlsDescendantBindings:!0}}};var p=i.resources;return u}),define("text!designer/app/builder/ui/controls/toggle/toggle.html",[],function(){return'<script type="text/html" id="toggle">\r\n    <div class="toggle-left-text-container" data-bind="\r\n    click: onToggleOff,\r\n    attr: { \'data-aid\': dataAidName + \'-off\' }">\r\n        <span class="toggle-off-text" data-bind="text: Strings.OFF"></span>\r\n    </div>\r\n    <div class="toggle-button-container" data-bind="\r\n    css: isCheckedClass,\r\n    click: onToggle,\r\n    attr: { \'data-aid\': dataAidName }">\r\n    </div>\r\n    <div class="toggle-right-text-container" data-bind="\r\n    click: onToggleOn,\r\n    attr: { \'data-aid\': dataAidName + \'-on\' }">\r\n        <span class="toggle-on-text" data-bind="css: isCheckedClass, text: Strings.ON"></span>\r\n    </div>\r\n</script>\r\n'}),define("designer/app/builder/ui/controls/toggle/toggle",["knockout","jquery","/i18n/resources/client","common/stats/googleanalytics","text!designer/app/builder/ui/controls/toggle/toggle.html"],function(e,t,n,i,a){function r(t){var n=this;n.Strings={ON:o.ON,OFF:o.OFF},n.isChecked=t.isChecked,n.isCheckedClass=e.computed(function(){return"toggle-"+(n.isChecked&&n.isChecked()?"on":"off")}),n.onToggle=function(){n.isChecked(!n.isChecked()),a()},n.onToggleOn=function(){n.isChecked(!0),a()},n.onToggleOff=function(){n.isChecked(!1),a()},n.ga=t.ga||{category:null,check:"enable",uncheck:"disable"},n.ga.click=e.computed(function(){var e=n.ga;return n.isChecked&&n.isChecked()?e.check:e.uncheck}),n.dataAidName=t.toggleName+"-toggle-click";var a=function(){var e=n.ga;i.trackEvent(e.category,e.click(),e.label)}}t(a).appendTo("body"),e.bindingHandlers.toggle={init:function(n,i){var a=new r(i()),o=t("<div data-bind=\"template: 'toggle'\"></div>").appendTo(n);return e.applyBindings(a,o.get(0)),{controlsDescendantBindings:!0}}};var o=n.resources;return r}),define("common/popper/popper",["jquery"],function(e){var t={url:"",title:"",height:"600px",width:"800px"},n={show:function(n){n=n||{};var i=e.extend(!0,t,n),a=["height="+i.height,"width="+i.width,"scrollbars=yes","resizable=yes","toolbars=no","status=no","menubar=no","location=no"].join(",");window.open(i.url,"_blank",a)}};return n}),define("designer/app/builder/ui/controls/siteSettings/siteFeature",["knockout","websiteInfo","/i18n/resources/client","designer/app/builder/data/data","designer/app/builder/ui/controls/siteSettings/favicon","designer/app/builder/ui/controls/toggle/toggle","common/popper/popper","common/stats/googleanalytics"],function(e,t,n,i,a,r,o,s){function l(n){var a=this,r=i.getDataModel(),o=r.settings;a.Strings={Client__Learn_More:d.Client__Learn_More},a.imageClass=n.imageClass,a.name=n.name,a.learnMoreAid=n.name+"-learn-more",a.title=n.title,a.description=n.description,a.requiredPlan=n.requiredPlan||10,a.hasFeatureFlag=n.hasFeatureFlag,a.isFeatureFlagEnabled=n.isFeatureFlagEnabled,a.showFeature=!a.hasFeatureFlag||a.hasFeatureFlag&&a.isFeatureFlagEnabled,a.meetsAlternativeRequirements=n.meetsAlternativeRequirements,a.meetsRequirements=e.computed(function(){var e=a.meetsAlternativeRequirements?a.meetsAlternativeRequirements():!1;return t&&t.Account&&t.Account.AccountType>=a.requiredPlan||e}),a.onLearnMoreClick=n.onLearnMoreClick,a.useCheckbox=n.useCheckbox||!1,a.useCheckbox&&(a.toggleModel={isChecked:n.isChecked,ga:n.ga,toggleName:n.name}),a.subtext=n.subtext,a.supportLink=n.supportLink,a.handleSupportLinkClick=function(){s.popLink({url:a.supportURL,category:"sitesettings",action:"sitefeat_favicon_browsersinfo",label:"link"})},a.supportURL=n.supportURL,a.useFavicon=n.useFavicon||!1,a.useFavicon&&(a.faviconModel={faviconSmallUrl:o.FaviconSmallUrl,faviconMediumUrl:o.FaviconMediumUrl})}var d=n.resources;return l}),define("designer/app/builder/ui/controls/siteSettings/siteFeatures",["knockout","/i18n/resources/client","common/abTesting/abTesting","designer/app/builder/ui/controls/siteSettings/siteFeature","designer/app/builder/data/data","common/inAppPurchase/inAppPurchase"],function(e,t,n,i,a,r){function o(){var o=this,s=a.getDataModel(),l=s.settings,d=s.config,c=t.resources;o.mobileSiteLearnMore=function(){r.ShowUpgradeDialog({clientTrackingId:"wsb-settings-enable-mobile-publish-click",clientTrackingValue:"mobile",presentingModalId:"siteSettingsFlyoutModal"})},o.mobileSiteFeatureIsChecked=e.computed({read:function(){var e=d.canPublishMobile(),t=l.MobileEnabled();return e&&"False"!==t},write:function(e){l.MobileEnabled(e?"True":"False")}}),o.faviconLearnMore=function(){r.ShowUpgradeDialog({clientTrackingId:"wsb-settings-add-fav-icon-click",clientTrackingValue:"favicon",presentingModalId:"siteSettingsFlyoutModal"})},o.socialShareFeatureIsChecked=e.computed({read:function(){return l.EnableAddThisSmartLayer?"True"===l.EnableAddThisSmartLayer():d.addThisSmartLayerEnabledByDefault},write:function(e){l.EnableAddThisSmartLayer(e?"True":"False")}}),o.socialShareFeature=new i({name:"social",imageClass:"social-share-feature",title:c.Social_Share,description:c.Social_Share_Description,useCheckbox:!0,isChecked:o.socialShareFeatureIsChecked,ga:{category:"sitesettings",check:"sitefeat_socialshare_on",uncheck:"sitefeat_socialshare_off",label:"toggle"}}),o.mobileSiteFeature=new i({name:"mobile",imageClass:"mobile-site-feature",title:c.Mobile_Site,description:c.Mobile_Site_Description,requiredPlan:20,meetsAlternativeRequirements:e.computed(function(){return d.canPublishMobile()}),onLearnMoreClick:o.mobileSiteLearnMore,useCheckbox:!0,isChecked:o.mobileSiteFeatureIsChecked,ga:{category:"sitesettings",check:"sitefeat_mobile_on",uncheck:"sitefeat_mobile_off",label:"toggle"}}),o.faviconFeature=new i({name:"favicon",imageClass:"favicon-feature",title:c.Favicon,description:c.Favicon_Description,subtext:c.Displays_on_supported_browsers_only,supportLink:c.Which_ones,supportURL:"/help/article/12114",requiredPlan:20,hasFeatureFlag:!0,isFeatureFlagEnabled:"enabled"===n.getOption("favicon"),onLearnMoreClick:o.faviconLearnMore,useFavicon:!0});var u=[],p=s.user.isApiReseller&&s.info.Account.AccountType===s.info.accountTypes.personal;u.push(o.socialShareFeature),p||(u.push(o.mobileSiteFeature),u.push(o.faviconFeature)),o.siteFeatures=u,o.getSettings=function(){return{EnableAddThisSmartLayer:l.EnableAddThisSmartLayer(),MobileEnabled:l.MobileEnabled(),FaviconSmallUrl:o.faviconFeature.faviconModel.faviconSmallUrl(),FaviconMediumUrl:o.faviconFeature.faviconModel.faviconMediumUrl()}}}return{createViewModel:function(){return new o}}}),define("designer/util/markup",["jquery"],function(e){function t(t){if(!t)return"";t=t.replace(/<script\b/gi,"<code").replace(/<\/script\b/gi,"</code");var n=e("<head/>").append(t);n.find("link,meta").empty(),n.find("style *,code *").remove();var i=[];return n.find("style,link,meta,code").each(function(e,t){return i.push(t.outerHTML)}),i.join("\r\n").replace(/<code\b/g,"<script").replace(/<\/code\b/g,"</script")}function n(e){if(!e)return"";var t=document.createElement("div");return t.innerHTML=e,t.innerHTML}return{cleanupForHead:t,fix:n}}),define("designer/app/builder/ui/controls/siteSettings/websiteSettings",["jquery","knockout","/i18n/resources/client","common/stats/googleanalytics","designer/app/builder/data/data","designer/util/markup"],function(e,t,n,i,a,r){function o(){var e=this,t=n.resources,i=a.getDataModel(),o=i.settings;this.Strings={Server__General_settings:t.Server__General_settings,Server__Site_wide_code:t.Server__Site_wide_code,Server__Enable_auto_mobile_publish:t.Server__Enable_auto_mobile_publish,Server__Show_sharing_left_sidebar:t.Server__Show_sharing_left_sidebar,Server__Code_to_put_in_head_colon:t.Server__Code_to_put_in_head_colon,Server__Code_to_put_in_body_colon:t.Server__Code_to_put_in_body_colon,Server__We_were_unable_to_save_your_site_settings:t.Server__We_were_unable_to_save_your_site_settings,Client__Add_Image:t.Client__Add_Image},this.headHtml=o.HeaderTags,this.bodyHtml=o.BodyTags,this.getSettings=function(){var t=r.cleanupForHead(e.headHtml()),n=r.fix(e.bodyHtml());return e.headHtml(t),e.bodyHtml(n),{HeaderTags:t,BodyTags:n}}}return{createViewModel:function(){return new o}}}),define("libs/jquery/plugins/jquery.timeago",["jquery"],function(e){!function(){function t(e){return null===e||void 0===e||void 0===e.length||0===e.length?e:e=e.charAt(0).toUpperCase()+e.slice(1)}function n(){var t=i(this);return isNaN(t.datetime)||e(this).text(a(t.datetime)),this}function i(t){if(t=e(t),!t.data("timeago")){t.data("timeago",{datetime:o.datetime(t)});var n=e.trim(t.text());!(n.length>0)||o.isTime(t)&&t.attr("title")||t.attr("title",n)}return t.data("timeago")}function a(e){return o.inWords(r(e))}function r(e){return(new Date).getTime()-e.getTime()}e.timeago=function(t){return a(t instanceof Date?t:"string"==typeof t?e.timeago.parse(t):"number"==typeof t?new Date(t):e.timeago.datetime(t))};var o=e.timeago;e.extend(e.timeago,{settings:{refreshMillis:6e4,allowFuture:!1,capitalizeFirst:!1,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",wordSeparator:" ",numbers:[]}},inWords:function(n){function i(t,i){var r=e.isFunction(t)?t(i,n):t,o=a.numbers&&a.numbers[i]||i;return r.replace(/%d/i,o)}var a=this.settings.strings,r=a.prefixAgo,o=a.suffixAgo;this.settings.allowFuture&&0>n&&(r=a.prefixFromNow,o=a.suffixFromNow);var s=Math.abs(n)/1e3,l=s/60,d=l/60,c=d/24,u=c/365,p=45>s&&i(a.seconds,Math.round(s))||90>s&&i(a.minute,1)||45>l&&i(a.minutes,Math.round(l))||90>l&&i(a.hour,1)||24>d&&i(a.hours,Math.round(d))||42>d&&i(a.day,1)||30>c&&i(a.days,Math.round(c))||45>c&&i(a.month,1)||365>c&&i(a.months,Math.round(c/30))||1.5>u&&i(a.year,1)||i(a.years,Math.round(u)),g=a.wordSeparator||"";void 0===a.wordSeparator&&(g=" ");var h=e.trim([r,p,o].join(g));return this.settings.capitalizeFirst===!0&&(h=t(h)),h},parse:function(t){var n=e.trim(t);return n=n.replace(/\.\d+/,""),n=n.replace(/-/,"/").replace(/-/,"/"),n=n.replace(/T/," ").replace(/Z/," UTC"),n=n.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2"),new Date(n)},datetime:function(t){var n=e(t).attr(o.isTime(t)?"datetime":"title");return o.parse(n)},isTime:function(t){return"time"===e(t).get(0).tagName.toLowerCase()}}),e.fn.timeago=function(t){var i=this,a=o.settings;return t&&e.extend(a,t),i.each(n),a.refreshMillis>0&&setInterval(function(){i.each(n)},a.refreshMillis),i},document.createElement("abbr"),document.createElement("time")}(e)}),define("common/dateTimeHelper/dateTimeHelper",["jquery","libs/jquery/plugins/jquery.timeago","libs/jquery/plugins/jquery-timeago/locales/jquery.timeago.{lang}"],function(e){var t=function(){function t(){var e=new Date;n(e);var t="";return t+=e.getMonth()+1+"/",t+=e.getDate()+"/",t+=e.getFullYear()+" ",t+=e.getHours()+":",t+=e.getMinutes()+":",t+=e.getSeconds()}function n(){var e=new Date(0),t=e.getTime();t>0&&date.setTime(date.getTime()-t)}function i(e){var t=new Date(e);return t.toLocaleString()}function a(t,n){var i=e.timeago.parse(t),a="am",r=i.getHours(),o=i.getMinutes();r>=12&&(r>12&&(r-=12),a="pm"),0===r&&(r=12),10>r&&(r="0"+r),10>o&&(o="0"+o);var s;if(n){var l=i.getSeconds();10>l&&(l="0"+l),s=r+":"+o+":"+l+" "+a}else s=r+":"+o+" "+a;return s}function r(e,t,n){var i=new Date(e);return i.toLocaleDateString(t,n)}function o(e,t,n){var i=new Date(e);return i.toLocaleTimeString(t,n)}function s(t){var n=e.timeago(t);return n}function l(t){var n=e.timeago.parse(t);return n.getFullYear()+"-"+(n.getMonth()+1)+"-"+n.getDate()+" "+a(t,!0)}return{getClientDateTime:t,fixDate:n,getLocaleDateTimeString:i,getLocaleTimeString:a,getUtcToLocaleDateTimeString:l,getLocaleDateString:r,getLocalTimeString:o,getTimeAgo:s}}();return t}),define("common/backupsDialog/backupsDialog",["knockout","common/persistence/persistence","common/dateTimeHelper/dateTimeHelper","common/cookiemanager/cookiemanager","common/stats/googleanalytics","appconfig","jquery","/i18n/resources/client","wsbcore/dialog","wsbcore/growl","wsbcore/overlay","wsbcore/tipper"],function(e,t,n,i,a,r,o,s){var l,d,c,u,p,g,h,m,b,f,v,y,_,w,S,k,x,C,T,E,P,D,I,A,M,O,L,N,B,F,R=function(e){e()};l=function(e,t,n){T=e,P=!!n,D=!1,I=!1,E=!1,A=!1,R=t,C||(C=new p)},d=function(e,t,n){C||(P=!!n,D=!1,I=!1,T=e,E=!0,A=!1,S=t,C=new p),b()},_=function(){(!D||I)&&(O||(O=o("#wsb-actionbar-backups-container")),O.sfMsgOverlay({message:s.resources.Loading}),h(y))},u=function(){var e=i.getCookie("siteRestored");e&&(o("<div />").sfGrowl({icon:"success",title:s.resources.Success,content:s.resources.BackupAndRestore_RestoreSuccess}),i.eraseCookie("siteRestored"))},setRefreshData=function(){I=!0},c=function(){return C||{}},p=function(){var n=this;this.backup=e.observableArray([]),this.errorMessage=e.observable(""),this.add=function(){w(),x()?m(s.resources.BackupAndRestore_NoMoreBackups.sfFormat(T)):(O.sfMsgOverlay({message:s.resources.Processing}),R(function(){t.Post("/api/websites/{websiteId}/backups",{},function(e){A=!0,e.Name||(-1===e.CreateDate.indexOf("Z")&&(e.CreateDate=e.CreateDate+"Z"),e.Name=H(e.CreateDate)),n.backup.unshift(new g(e)),O.sfMsgOverlay({message:null}),E?o(".backups-manager-success",O).stop(!0,!0).show().delay(2e3).toggle("fade"):o(".wsb-actionbar-backups-success",O).stop(!0,!0).show().delay(2e3).toggle("fade")},function(){m(s.resources.BackupAndRestore_BackupFailure)})}))},this.reset=function(){w(),o.each(n.backup(),function(e,t){t.isEditing(!1)})},this.addTips=function(e){if(A){if(!P){var t=o(E?".backups-manager-row":".wsb-settings-backups-row");t.first().animate({color:"white",backgroundColor:"#7FB133 "},2e3,function(){o(this).animate({color:"black",backgroundColor:"white"})})}A=!1}var n=o(e).find(".sf-tip");n.length&&n.sfTipper({wireup:!0}),o(".timeago",O).timeago()},this.setRefreshData=setRefreshData},g=function(t){var i=this;o.extend(i,t),-1===i.CreateDate.indexOf("Z")&&(i.CreateDate=i.CreateDate+"Z"),i.highlighted=e.observable(!1),i.userBackup=e.observable(1==t.Type),i.isEditing=e.observable(!1),i.newName=e.observable(t.Name),i.Name=e.observable(t.Name),i.txtTimeElapsed=H(i.CreateDate),i.timeElapsed=n.getUtcToLocaleDateTimeString(i.CreateDate)},g.prototype={toggle:function(){this.highlighted(!this.highlighted())},changeName:function(){a.trackEvent("dashboard_settings_backup","rename_backup","button");var e=this;e.newName()?e.Name()!==e.newName()&&t.Put("/api/websites/{websiteId}/backups/"+e.Id,e.newName(),function(){e.Name(e.newName())},m):e.newName(e.Name()),e.isEditing(!1)},edit:function(){w(),C.reset(),this.newName(this.Name()),this.isEditing(!0)},remove:function(){var e=this;w(),E?L.sfDialog({veil:O,buttons:[{id:"ok",text:s.resources.OK,onClick:function(){f(e,L)}},{id:"cancel",text:s.resources.Cancel,cancel:!0}]}):(B||(B=o("div.wsb-settings-backups-delete-dialog")),B.wsbDialog({title:s.resources.Confirm,buttons:[{id:"ok",text:s.resources.OK,onClick:function(){f(e,B)}},{id:"cancel",text:s.resources.Close,cancel:!0}]}))},restore:function(){var e=this;w(),E?N.sfDialog({veil:O,buttons:[{id:"ok",text:s.resources.BackupAndRestore_YesRestore,onClick:function(){v(e,N)}},{id:"cancel",text:s.resources.Cancel,cancel:!0}]}):(F||(F=o("div.wsb-actionbar-backups-restore-dialog")),F.wsbDialog({title:s.resources.Restore_backup,buttons:[{id:"ok",text:s.resources.BackupAndRestore_YesRestore,onClick:function(){v(e,F)}},{id:"cancel",text:s.resources.Cancel,cancel:!0}]}))},onMouseEnter:function(){this.highlighted(!0)},onMouseLeave:function(){this.highlighted(!1)}},v=function(e,n){return n.wsbDialog("close"),O.sfMsgOverlay({message:s.resources.Processing}),t.Post("/api/websites/{websiteId}/backupsrestore/"+e.Id,null,function(){i.setCookie("siteRestored","1"),require(["common/socialPageManager/socialPageManager"],function(e){e.socialBrandingStartOver().always(function(){window.location.hash="",window.location.href="//"+r.appDomain+"/builder"})})},function(){m(s.resources.BackupAndRestore_RestoreFailure)}),!1},f=function(e,n){return n.wsbDialog("close"),O.sfMsgOverlay({message:s.resources.Processing}),t.Delete("/api/websites/{websiteId}/backups/"+e.Id,function(){C.backup.remove(e),O.sfMsgOverlay({message:null})},function(){m(s.resources.BackupAndRestore_DeleteFailure)}),!1},x=function(){var e=0;return o.each(C.backup(),function(t,n){return 1===n.Type&&(e++,e>=T)?!1:!0}),e>=T};var H=function(e){var t=new Date(e);return t.toLocaleDateString()};return h=function(e){require(["libs/i18n/intl/locale-data/json/"+s.locale],function(n){var i=n.date.formats[n.date.formats.length-1];t.Get("/api/websites/{websiteId}/backups/",function(t){var n=[];o.each(t.Backups,function(e,t){if(!t.Name){-1===t.CreateDate.indexOf("Z")&&(t.CreateDate=t.CreateDate+"Z");var n=new Date(t.CreateDate);t.Name=n.toLocaleDateString()+", "+n.toLocaleTimeString(s.locale,i)}}),o.each(t.Backups,function(e,t){n.push(new g(t))}),C.backup(n),k(),D=!0,I=!1,o.isFunction(e)&&e()},m)})},k=function(){M=o.extend({},o.timeago.settings.strings),"en"===s.lang?require(["libs/jquery/plugins/jquery-timeago/locales/jquery.timeago.wsb-en-short"],function(e){o.extend(o.timeago.settings.strings,e),o("span.timeago",O).timeago()}):o("span.timeago",O).timeago()},b=function(){var t="/controlpanel/BackupsDialog";P&&(t="/controlpanel/Backups"),o('<div style="width:820px"/>').wsbDialog({load:t,title:s.resources.Backup_and_Restore,destroyOnClose:!0,buttons:[{text:s.resources.Close,onClick:function(e){w(),e.wsbDialog("close")}}],onLoad:function(t){O=t,L=o("#backup-delete-veil",O),N=o("#backup-restore-veil",O),window&&window.location&&(window.location.hash="backup-manager"),O.sfMsgOverlay({message:s.resources.Loading}),h(function(){e.applyBindings(C,O[0]),o(".sf-tip",O).sfTipper({wireup:!0}),O.sfMsgOverlay({message:null}),O.sfDialog("resize"),O.parent().css({overflow:"auto","overflow-x":"hidden"})})},onOpen:function(){O&&O.parent().css({overflow:"auto","overflow-x":"hidden"})},onClose:function(){var e=arguments[1]?"xcancel_modal":"close_backupmodal",t=arguments[1]?"icon":"button";a.trackEvent("dashboard_settings_backup",e,t),o.timeago.settings.strings=M,o.isFunction(S)&&C.backup().length&&S(C.backup()[0].CreateDate),C.reset(),window&&window.location&&(window.location.hash="")}})},m=function(e){O.sfMsgOverlay({message:null}),C.errorMessage(e)},w=function(){C.errorMessage("")},y=function(){O.sfMsgOverlay({message:null})},{open:d,init:l,getViewModel:c,displayBackupData:_,setRefreshData:setRefreshData,showRestoredMsg:u}}),define("designer/app/builder/ui/controls/siteSettings/backupRestoreSettings",["jquery","/i18n/resources/client","designer/app/builder/data/data","common/backupsDialog/backupsDialog"],function(e,t,n,i){function a(){var a=n.getDataModel(),r=a.config;this.Strings={Server__Manual_backup:t.Server__Manual_backup,Server__Restoring_a_backup_replaces_your_current_site:t.Server__Restoring_a_backup_replaces_your_current_site,Server__Backup_created_successfully:t.Server__Backup_created_successfully,Server__Create_Backup:t.Server__Create_Backup,OK:t.OK,Server__Edit_backup:t.Server__Edit_backup,Server__Delete_backup:t.Server__Delete_backup,Restore_backup:t.Restore_backup,Server__Automatic_backup:t.Server__Automatic_backup,Server__Delete_backup_confirmation:t.Server__Delete_backup_confirmation,Server__Are_you_sure_you_want_to_delete_this_backup:t.Server__Are_you_sure_you_want_to_delete_this_backup,Are_you_sure:t.Are_you_sure,Server__Restoring_your_website_to_this_saved_version_will_replace:t.Server__Restoring_your_website_to_this_saved_version_will_replace,Server__Any_images_or_files_youve_uploaded:t.Server__Any_images_or_files_youve_uploaded,Server__Learn_more:t.Learn_more_lower},this.backupLearnMoreUrl=r.backupLearnMoreUrl,this.displayBackupData=i.displayBackupData,i.init(r.MaxUserBackupsCount,n.saver.save),i.showRestoredMsg(),e.extend(this,i.getViewModel())}return t=t.resources,{createViewModel:function(){return new a}}}),define("designer/app/builder/ui/controls/siteSettings/sevSettings",["jquery","knockout","/i18n/resources/client","common/stats/googleanalytics","designer/app/builder/managers/pageManager"],function(e,t,n,i,a){function r(){var e=this;this.Strings={Server__Provide_info_for_search_engine_visibility:n.resources.Server__Provide_info_for_search_engine_visibility,Server__Title_colon:n.resources.Server__Title_colon,Description_colon:n.resources.Description_colon},this.pages=a.pages,this.currentPage=t.observable(this.pages()[0]),this.onPageClick=function(t){i.trackEvent("wsb-designer-site-settings-search-engine-page","click","button"),e.currentPage(t)}}function o(){return new r}return{createViewModel:o}}),define("text!designer/app/builder/ui/controls/siteSettings/siteSettings.html",[],function(){return'<div id="wsb-site-settings-dialog" class="wsb-actionbar-site-settings" style="display: none; width: 900px;" data-bind="dialog: {\r\n    id: \'siteSettingsFlyoutModal\',\r\n    title: Strings.Site_Settings,\r\n    autoResize: true,\r\n    zIndex: 100000,\r\n    destroyOnClose: true,\r\n    cancel: cancel,\r\n    buttons: [\r\n        {\r\n            text: Strings.OK,\r\n            onClick: save,\r\n            isEnabled: canEdit\r\n        },\r\n        {\r\n            text: Strings.Cancel,\r\n            cancel: true\r\n        }\r\n    ],\r\n    isOpen: isOpen,\r\n    open:open\r\n}">\r\n    <!-- personal info tab -->\r\n    <div class="sf-tabs-content wsb-sitesettings-personalinfo" data-class="sitesettings-personalinfo-tab-marker">\r\n        <div class="wsb-canvas-mutator-inner" data-bind="template:{name: \'napsoc-settings-template\', data: napsocViewModel}"></div>\r\n    </div>\r\n\r\n    <!-- site features tab -->\r\n    <div class="sf-tabs-content wsb-sitesettings-sitefeatures" data-class="sitesettings-sitefeatures-tab-marker">\r\n        <div data-bind="template:{name: \'site-features-template\', data: siteFeaturesViewModel}"></div>\r\n    </div>\r\n    \r\n    <div class="sf-tabs-content" data-class="sitesettings-searchengines-tab-marker">\r\n        <div class="wsb-canvas-mutator-inner" data-bind="template:{name: \'sev-settings-template\', data: sevSettingsViewModel}"></div>\r\n    </div>\r\n\r\n    <div class="sf-tabs-content" data-class="sitesettings-backups-tab-marker">\r\n        <div data-bind="template: {name: \'backup-restore-settings-template\', data: backupRestoreSettingsViewModel}"></div>\r\n    </div>\r\n\r\n    <!-- site wide settings tab -->\r\n    <div class="sf-tabs-content" data-class="sitesettings-sitewidesettings-tab-marker">\r\n        <div class="wsb-canvas-mutator-inner" data-bind="template:{name: \'website-settings-template\', data: websiteSettingsViewModel}"></div>\r\n    </div>\r\n\r\n    <!-- ko if: isSaving -->\r\n    <div class="wsb-actionbar-site-settings-saving-indicator" data-bind="text: Strings.Saving_ellipsis"></div>\r\n    <!-- /ko -->\r\n    <!-- ko if: hadSaveError -->\r\n    <div class="wsb-actionbar-site-settings-save-error" data-bind="text: Strings.Server__We_were_unable_to_save_your_site_settings">\r\n    </div>\r\n    <!-- /ko -->\r\n</div>\r\n\r\n'}),define("text!designer/app/builder/ui/controls/siteSettings/napsocSettings.html",[],function(){return'<script type="text/html" id="napsoc-settings-template">\r\n    <div class="wsb-napsoc">\r\n        <div class="wsb-required wsb-napsoc-required-label" data-bind="text:\'* \' + Strings.Server__Required_fields"></div>\r\n        <div class="wsb-napsoc-fields clearfix">\r\n            <div class="wsb-napsoc-field">\r\n                <label for="txtSiteSettingsPersonalInfoSiteName">\r\n                    <span data-bind="text: Strings.Server__Site_name"></span>                    \r\n                    <span class="field-validation-error">*</span>\r\n                </label>\r\n                <div class="wsb-napsoc-help-text" data-bind="text:Strings.Server__Napsoc_SiteNameRationale"></div>\r\n                <input class="wsb-text-box"\r\n                       type="text"\r\n                       id="txtSiteSettingsPersonalInfoSiteName"\r\n                       data-aid="sitesettings-personalinfo-name"\r\n                       maxlength="200"\r\n                       data-bind="\r\n                    value: siteName,\r\n                    valueUpdate: \'input\',\r\n                    css: { \'wsb-napsoc-text-input-validationerror\': !siteName() }" />\r\n                <div class="wsb-text-box-error-text" data-bind="text: siteNameErrorMessage()"></div>\r\n            </div>\r\n            <div class="wsb-napsoc-field">\r\n                <label for="txtSiteSettingsPersonalInfoEmail">\r\n                    <span data-bind="text: Strings.Server__Email_address"></span>\r\n                    <span class="field-validation-error">*</span>\r\n                </label>\r\n                <div class="wsb-napsoc-help-text" data-bind="text: Strings.Server__Napsoc_EmailRationale"></div>\r\n                <input class="wsb-text-box"\r\n                       type="text"\r\n                       id="txtSiteSettingsPersonalInfoEmail"\r\n                       data-aid="sitesettings-personalinfo-email"\r\n                       maxlength="256"\r\n                       data-bind="\r\n                    value: emailAddress,\r\n                    valueUpdate: \'input\',\r\n                    css: { \'wsb-napsoc-text-input-validationerror\': !emailAddressValid() }" />\r\n                <div class="wsb-text-box-error-text" data-bind="text: emailAddressErrorMessage()"></div>\r\n            </div>\r\n            <div class="wsb-napsoc-field wsb-napsoc-business">\r\n                <label for="wsb-site-settings-industry" data-bind="text:Strings.Server__Napsoc_BusinessCategoryLabel"></label>\r\n                <div class="wsb-napsoc-help-text" data-bind="text: Strings.Server__Napsoc_BusinessCategoryRationale"></div>\r\n                <input id="wsb-site-settings-industry"\r\n                       class="wsb-text-box"\r\n                       type="text"\r\n                       data-bind="industryPicker: { value: businessCategoryId }" />\r\n            </div>\r\n            <div class="wsb-napsoc-field">\r\n                <label for="wsb-napsoc-address-input" data-bind="text:Strings.Server__Address"></label>\r\n                <div class="wsb-napsoc-help-text" data-bind="text:Strings.Server__Napsoc_AddressRationale"></div>\r\n                <div id="wsb-napsoc-address-wrapper">\r\n                    <input id="wsb-napsoc-address-input"\r\n                           class="wsb-text-box"\r\n                           type="text"\r\n                           data-aid="sitesettings-personalinfo-address"\r\n                           maxlength="2000"\r\n                           data-bind="value: streetAddress, placesAutocomplete: true, needsFormatted: needsFormatted" />\r\n                    <div id="wsb-napsoc-geolocate-icon" data-bind="contextFlyout: {\r\n                    template: \'geolocate-flyout-template\',\r\n                    position: \'lr\',\r\n                    width: 480,\r\n                    inDialog: isInDialog,\r\n                    closeOnBlur: true,\r\n                    closeOnScroll: true,\r\n                    centerAgainstAnchor: true,\r\n                    isOpen: isMapOpen\r\n                }"></div>\r\n                </div>\r\n                <label class="wsb-napsoc-info">\r\n                    <span data-bind="text: Strings.Server__Napsoc_AddressPrivacyCheckboxLabel"></span>\r\n                </label>\r\n            </div>\r\n            <div class="wsb-napsoc-field wsb-napsoc-phone">\r\n                <label for="wsb-napsoc-phone-input" data-bind="text:Strings.Server__Phone_number"></label>\r\n                <div class="wsb-napsoc-help-text" data-bind="text:Strings.Server__Napsoc_PhoneNumberRationale"></div>\r\n                <input id="wsb-napsoc-phone-input"\r\n                       class="wsb-text-box"\r\n                       type="text"\r\n                       data-aid="sitesettings-personalinfo-phone"\r\n                       maxlength="100"\r\n                       data-bind="value: phoneNumber" />\r\n                <label class="wsb-napsoc-info">\r\n                    <span data-bind="text: Strings.Server__Napsoc_PhoneNumberPrivacyCheckboxLabel"></span>\r\n                </label>\r\n                <!-- ko if: showMightyCallLink -->\r\n                <div class="wsb-napsoc-mightycall-text">\r\n                    @Html.Raw(String.Format(Server.HtmlEncode(Strings.MightyCall_link), @"<a href="" #"" data-aid="" mightcall-link"" data-bind="" click launchmightycall"">", @"</a>"))\r\n                </div>\r\n                <!-- /ko -->\r\n            </div>\r\n            <div class="wsb-napsoc-field wsb-napsoc-social" id="wsb-napsoc-social-field">\r\n                <label data-bind="text: Strings.Server__Social"></label>\r\n                <div class="wsb-napsoc-help-text" data-bind="text:Strings.Server__People_can_like_your_page_wth_one_click"></div>\r\n                <div class="wsb-napsoc-social-config"\r\n                     id="wsb-napsoc-twitter-config"\r\n                     data-bind="css: { \'wsb-napsoc-social-connected\': twitterIsAuth }">\r\n                    <div class="wsb-napsoc-social-connection-status">\r\n                        <span class="wsb-napsoc-social-btn" data-aid="sitesettings-personalinfo-twitter" data-bind="\r\n                          click: authTwitter,\r\n                          ga: { click: { category: gaCategory, action: \'site_info_connect-to-twitter\', label: \'button\' } }\r\n                        "></span>\r\n                        <!-- ko if: twitterIsAuth -->\r\n                        <span data-bind="text: Strings.Server__Connected_to_Twitter"></span>\r\n                        <!-- /ko -->\r\n                        <!-- ko ifnot: twitterIsAuth -->\r\n                        <span data-bind="text:Strings.Server__Connect_to_Twitter"></span>\r\n                        <!-- /ko -->\r\n                    </div>\r\n                </div>\r\n                <div class="wsb-napsoc-social-config"\r\n                     id="wsb-napsoc-facebook-config"\r\n                     data-bind="css: { \'wsb-napsoc-social-connected\': facebookIsAuth }">\r\n                    <div class="wsb-napsoc-social-connection-status">\r\n                        <span class="wsb-napsoc-social-btn" data-aid="sitesettings-personalinfo-facebook" data-bind="\r\n                        click: authFacebook,\r\n                        ga: { click: { category: gaCategory, action: \'site_info_connect-to-facebook\', label: \'button\' } }\r\n                    "></span>\r\n                        <!-- ko if: facebookIsAuth -->\r\n                        <span data-bind="text: Strings.Server__Connected_to_Facebook"></span>\r\n                        <!-- /ko -->\r\n                        <!-- ko ifnot: facebookIsAuth -->\r\n                        <span data-bind="text: Strings.Server__Connect_to_Facebook"></span>\r\n                        <!-- /ko -->\r\n                    </div>\r\n                    <!-- ko if: facebookIsAuth -->\r\n                    <div id="wsb-napsoc-facebook-likebox-config">\r\n                        <!-- ko ifnot: hasFacebookPages -->\r\n                        <div id="wsb-napsoc-no-facebook-pages">\r\n                            <strong data-bind="text: Strings.Server__Note_colon"></strong>\r\n                            <span data-bind="text:Strings.Server__You_dont_have_any_pages_for_people_to_like"></span>\r\n                            <a href="https://www.facebook.com/business/build"\r\n                               data-bind="ga: { click: { category: gaCategory, action: \'learn-more\', label: \'link\' } }, text: Strings.Server__ExternalHelpLinkText, title: Strings.Server__Create_a_Facebook_page"\r\n                               target="_blank"></a>\r\n                        </div>\r\n                        <!-- /ko -->\r\n                        <!-- ko if: hasFacebookPages -->\r\n                        <label class="checkbox">\r\n                            <input type="checkbox"\r\n                                   data-aid="sitesettings-personalinfo-facebook-usepage"\r\n                                   data-bind="\r\n                                        checked: useFacebookPage,\r\n                                        ga: {\r\n                                            category: gaCategory,\r\n                                            check: \'use-facebook-page-checked\',\r\n                                            uncheck: \'use-facebook-page-unchecked\'\r\n                                        }" />\r\n                            <span data-bind="text:Strings.Server__Use_with_like_box"></span>\r\n                        </label>\r\n                        <select class="wsb-select-box"\r\n                                data-aid="sitesettings-personalinfo-facebook-page"\r\n                                data-bind="\r\n                                    options: facebookPages,\r\n                                    optionsText: \'Name\',\r\n                                    value: \'Link\',\r\n                                    value: facebookPage"></select>\r\n                        <!-- /ko -->\r\n                    </div>\r\n                    <!-- /ko -->\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n   </script>\r\n\r\n<script id="geolocate-flyout-template" type="text/html">\r\n    <div id="wsb-napsoc-map-flyout">\r\n        <div class="sf-dialog-close sf-icn-close1 wsb-x"\r\n             data-aid="navmenudlg-closebutton"\r\n             data-bind="click: closeMap, ga: { click: { category: gaCategory, action: \'close-map\', label: \'icon\' } }"></div>\r\n        <!-- ko if: isMapOpen -->\r\n        <div class="wsb-napsoc-map">\r\n          <div data-bind="googleMap: { address: mapAddress }" style="width: 100%; height: 100%" height="100%" scrolling="no"></div>\r\n        </div>\r\n        <!-- /ko -->\r\n        <!-- ko ifnot: isMapOpen -->\r\n        <div class="wsb-napsoc-map"></div>\r\n        <!-- /ko -->\r\n        <input type="button"\r\n               id="wsb-napsoc-flyout-close-btn"\r\n               class="btn btn-success"\r\n               data-bind="click: closeMap, attr: {value: Strings.Close }, ga: { click: { category: gaCategory, action: \'close-map\', label: \'button\' } }" />\r\n    </div>\r\n</script>\r\n'
}),define("text!designer/app/builder/ui/controls/siteSettings/siteFeatures.html",[],function(){return'<script type="text/html" id="site-features-template">\r\n    <div class="site-features-container" data-bind="foreach: siteFeatures">\r\n        <!-- ko if: showFeature -->\r\n        <div class="site-feature-container">\r\n            <div class="site-feature-image-container">\r\n                <div class="site-feature-image" data-bind="css: imageClass"></div>\r\n            </div>\r\n            <div class="site-feature-content">\r\n                <div class="site-feature-title" data-bind="text: title"></div>\r\n                <div class="site-feature-middle-content">\r\n                    <div class="site-feature-description" data-bind="text: description, css: { \'site-feature-description-checkbox\': useCheckbox }"></div>\r\n                    <div class="site-feature-action-container">\r\n                        <!-- ko ifnot: meetsRequirements -->\r\n                        <div class="site-feature-learn-more-button-container">\r\n                            <a class="btn btn-success" data-bind="\r\n                                click: onLearnMoreClick,\r\n                                attr: { \'data-aid\': learnMoreAid }">\r\n                                <span data-bind="text: Strings.Client__Learn_More"></span>\r\n                            </a>\r\n                        </div>\r\n                        <!-- /ko -->\r\n                        <!-- ko if: meetsRequirements -->\r\n                            <!-- ko if: useCheckbox -->\r\n                                <div data-bind="toggle: toggleModel"></div>\r\n                            <!-- /ko -->\r\n                            <!-- ko if: useFavicon -->\r\n                                <div data-bind="favicon: faviconModel"></div>\r\n                            <!-- /ko -->\r\n                        <!-- /ko -->\r\n                    </div>\r\n                </div>\r\n                <div class="site-feature-bottom-content">\r\n                    <span class="site-feature-subtext" data-bind="html: subtext" data-aid="sitefeature-subtext"></span>\r\n                    <a href="#" class="site-feature-support-link" data-bind="html: supportLink, click: handleSupportLinkClick" data-aid="sitefeature-support-link"></a>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <!-- /ko -->\r\n    </div>\r\n</script>\r\n'}),define("text!designer/app/builder/ui/controls/siteSettings/websiteSettings.html",[],function(){return'<script type="text/html" id="website-settings-template">\r\n    <h3 class="wsb-settings-general-section-header" style="clear: both;" data-bind="text:Strings.Server__Site_wide_code"></h3>\r\n    <p class="wsb-settings-text" data-bind="text: Strings.Server__Code_to_put_in_head_colon">\r\n    </p>\r\n    <div class="wsb-site-settings-html-editor"\r\n            data-bind="aceEditor: { value: headHtml, mode: \'html\', useWrapMode: true, dataAid: \'sitesettings-sitewidesettings-head\' }">\r\n    </div>\r\n\r\n    <p class="wsb-settings-text" data-bind="text: Strings.Server__Code_to_put_in_body_colon">\r\n    </p>\r\n    <div class="wsb-site-settings-html-editor" data-bind="aceEditor: { value: bodyHtml, mode: \'html\', useWrapMode: true, dataAid: \'sitesettings-sitewidesettings-body\' }"></div>\r\n\r\n</script>'}),define("text!designer/app/builder/ui/controls/siteSettings/backupRestoreSettings.html",[],function(){return'<script type="text/html" id="backup-restore-settings-template">\r\n    <div id="wsb-actionbar-backups-container" class="wsb-canvas-mutator-inner clearfix">\r\n        <p class="wsb-settings-text">\r\n            <span data-bind="text: Strings.Server__Restoring_a_backup_replaces_your_current_site"></span><br />\r\n                <a class="wsb-link" id="backupsLearnMore" target="_blank" data-aid="sitesettings_backups_learnMore" \r\n                   data-bind="text: Strings.Server__Learn_more + \' &raquo;\', attr: {href: backupLearnMoreUrl}"></a> <br /><br />\r\n            <input type="button" class="btn btn-success wsb-settings-backups-create-btn"\r\n                   data-bind="click: add, attr: {value: Strings.Server__Create_Backup }" data-aid="sitesettings_backups_add" />\r\n            <span class="wsb-actionbar-backups-success" data-bind="text: Strings.Server__Backup_created_successfully"></span>\r\n        </p>\r\n\r\n        <div class="wsb-required" data-bind="visible: (errorMessage), text: errorMessage"></div>\r\n        <ul class="wsb-settings-backups-list" data-bind="foreach: { data: backup, afterRender: addTips }">\r\n            <li class="wsb-settings-backups-row clearfix">\r\n\r\n                <!-- ko if: userBackup() -->\r\n                <div class="wsb-settings-backups-user clearfix" data-bind="event: { mouseleave: toggle, mouseenter: toggle}, css: { \'highlighterOn\': highlighted() }, attr: {title: $parent.Strings.Server__Manual_backup }">\r\n                    <span class="wsb-settings-backups-elapsed timeago" data-bind="attr: {title: timeElapsed}" data-aid="sitesettings_backups_elapsedTime"></span>\r\n                    <div class="wsb-settings-backups-user-icon"></div>\r\n                    <div data-bind="text: Name, visible: !isEditing()" data-aid="sitesettings_backups_userBackupName" class="wsb-settings-backups-name"></div>\r\n\r\n                    <div data-bind="visible: isEditing()" class="backup-manager-edit">\r\n                        <form data-bind="submit: changeName">\r\n                            <input type="text" class="backup-edit" data-bind="value: newName" data-aid="sitesettings_backups_newName" />\r\n                            <button type="submit" class="btn btn-success" data-aid="sitesettings_backups_ok"><span data-bind="text:$parent.Strings.OK"></span></button>\r\n                        </form>\r\n                    </div>\r\n                    <ul class="backups-manager-edit-list">\r\n                        <li class="wsb-settings-backups-edit sf-tip" data-bind="click: edit, visible: highlighted() && !isEditing(), attr: {\'data-content\': $parent.Strings.Server__Edit_backup }" data-location="top" data-aid="sitesettings_backups_userEdit" data-style="qt"></li>\r\n                        <li class="wsb-settings-backups-delete sf-tip" data-bind="click: remove, visible: highlighted() && !isEditing(), attr: {\'data-content\': $parent.Strings.Server__Delete_backup }" data-location="top" data-aid="sitesettings_backups_userDelete" data-style="qt"></li>\r\n                        <li class="wsb-settings-backups-restore sf-tip" data-bind="click: restore, visible: highlighted() && !isEditing(), attr: {\'data-content\': $parent.Strings.Restore_backup }" data-location="top" data-aid="sitesettings_backups_userRestore" data-style="qt"></li>\r\n                    </ul>\r\n                </div>\r\n                <!-- /ko -->\r\n                <!-- ko ifnot: userBackup() -->\r\n                <div class="wsb-settings-backups-auto clearfix" data-bind="event: { mouseleave: toggle, mouseenter: toggle }, css: { \'highlighterOn\': highlighted() }, attr: {title: $parent.Strings.Server__Automatic_backup}">\r\n                    <span class="wsb-settings-backups-elapsed timeago" data-bind="attr: {title: timeElapsed}" data-aid="sitesettings_backups_elapsedTime"></span>\r\n                    <div class="wsb-settings-backups-auto-icon"></div>\r\n                    <div class="wsb-settings-backups-name" data-bind="text: Name" data-aid="sitesettings_backups_autoBackupName"></div><span class="wsb-settings-backups-description" data-bind="text: \'(\' + Description + \')\'" data-aid="sitesettings_backups_autoBackupDescription"></span>\r\n                    <ul class="backups-manager-edit-list">\r\n                        <li class="wsb-settings-backups-restore  sf-tip" data-bind="click: restore, visible: highlighted(), attr: {\'data-content\': $parent.Strings.Restore_backup}" data-location="top" data-style="qt" data-aid="sitesettings_backups_autoRestore"></li>\r\n                    </ul>\r\n                </div>\r\n                <!-- /ko -->\r\n            </li>\r\n        </ul>\r\n    </div>\r\n    <div class="wsb-settings-backups-delete-dialog backup-delete-msg ">\r\n        <span data-bind="text: Strings.Server__Delete_backup_confirmation "></span>\r\n        <br />\r\n        <span data-bind="text: Strings.Server__Are_you_sure_you_want_to_delete_this_backup"></span>\r\n    </div>\r\n    <div class="wsb-actionbar-backups-restore-dialog backup-delete-msg ">\r\n        <span data-bind="text: Strings.Are_you_sure"></span>\r\n        <br />\r\n        <span data-bind="text: Strings.Server__Restoring_your_website_to_this_saved_version_will_replace"></span><br /><br />\r\n        <span class="wsb-required" data-bind="text: Strings.Server__Any_images_or_files_youve_uploaded"></span>\r\n    </div>\r\n</script>'}),define("text!designer/app/builder/ui/controls/siteSettings/sevSettings.html",[],function(){return'<script type="text/html" id="sev-settings-template">\r\n\r\n        <p class="wsb-settings-text" data-bind="text:Strings.Server__Provide_info_for_search_engine_visibility">\r\n        </p>\r\n        <div class="clearfix" style="padding-bottom: 15px;">\r\n            <ul data-bind="foreach: pages" class="wsb-sev-tabs">\r\n                <li data-bind="attr: { \'class\': $parent.currentPage().Id() == Id() ? \'selected\' : \'\' }, click: $parent.onPageClick"><a data-bind="text: Name"></a></li>\r\n            </ul>\r\n\r\n            <div class="wsb-page-sev-info">\r\n                <label class="wsb-block-label" data-bind="text:Strings.Server__Title_colon"></label>\r\n                <input class="wsb-text-box" type="text" data-aid="sitesettings-searchengine-title" maxlength="512" data-bind="value: currentPage().PageTitle" />\r\n                <label class="wsb-block-label" data-bind="text:Strings.Description_colon"></label>\r\n                <textarea data-aid="sitesettings-searchengine-description" class="wsb-sev-site-desc" data-bind="value: currentPage().PageDescription"></textarea>\r\n            </div>\r\n        </div>\r\n\r\n</script>\r\n'}),define("designer/app/builder/ui/controls/siteSettings/siteSettings",["jquery","knockout","strings","common/stats/googleanalytics","designer/app/app","designer/app/builder/data/undoer","designer/app/builder/managers/siteSettingsManager","designer/app/builder/ui/controls/siteSettings/napsocSettings","designer/app/builder/ui/controls/siteSettings/siteFeatures","designer/app/builder/ui/controls/siteSettings/websiteSettings","designer/app/builder/ui/controls/siteSettings/backupRestoreSettings","designer/app/builder/ui/controls/siteSettings/sevSettings","text!designer/app/builder/ui/controls/siteSettings/siteSettings.html","text!designer/app/builder/ui/controls/siteSettings/napsocSettings.html","text!designer/app/builder/ui/controls/siteSettings/siteFeatures.html","text!designer/app/builder/ui/controls/siteSettings/websiteSettings.html","text!designer/app/builder/ui/controls/siteSettings/backupRestoreSettings.html","text!designer/app/builder/ui/controls/siteSettings/sevSettings.html","text!designer/app/builder/ui/controls/siteSettings/favicon.html"],function(e,t,n,i,a,r,o,s,l,d,c,u,p,g,h,m,b,f){function v(){var a=this;a.Strings={OK:n.OK,Cancel:n.Cancel,Site_Settings:n.Site_Settings,Server__Personal_info:n.Server__Personal_info,Site_features:n.Site_features,Server__General_settings:n.Server__General_settings,Server__Backup_slash_restore:n.Server__Backup_slash_restore,Saving_ellipsis:n.Saving_ellipsis,Server__We_were_unable_to_save_your_site_settings:n.Server__We_were_unable_to_save_your_site_settings,Server__Search_engines:n.Server__Search_engines},a.isOpen=t.observable(!1),a.isSaving=t.observable(!1),a.hadSaveError=t.observable(!1),a.canSave=t.observable(!0),a.open=function(){a.isSaving(!1),a.hadSaveError(!1),i.trackEvent("sitesettings","site_info","tab"),e(".sitesettings-personalinfo-tab-marker a").text(n.Server__Personal_info).attr("data-aid","sitesettings-personalinfo-tab").click(function(){i.trackEvent("sitesettings","site_info","tab")}),e(".sitesettings-sitefeatures-tab-marker a").text(n.Site_features).attr("data-aid","sitesettings-sitefeatures-tab").click(function(){i.trackEvent("sitesettings","site_feat","tab")}),e(".sitesettings-sitewidesettings-tab-marker a").text(n.Server__Site_wide_code).attr("data-aid","sitesettings-sitewidesettings-tab").click(function(){i.trackEvent("sitesettings","sitewide_features","tab")}),e(".sitesettings-backups-tab-marker a").attr("data-aid","sitesettings-backups-tab").text(n.Server__Backup_slash_restore).click(function(){a.backupRestoreSettingsViewModel.setRefreshData(),a.backupRestoreSettingsViewModel.displayBackupData(),i.trackEvent("sitesettings","backups","tab")}),e(".sitesettings-searchengines-tab-marker a").text(n.Server__Search_engines).attr("data-aid","sitesettings-searchengines-tab").click(function(){i.trackEvent("sitesettings","searchengines","tab")}),e(".sitesettings-backups-tab-marker").hasClass("sf-tabs-actv-tab")&&(a.backupRestoreSettingsViewModel.setRefreshData(),a.backupRestoreSettingsViewModel.displayBackupData())},a.save=function(t){return i.trackEvent("sitesettings","save","button"),a.canSave(!1),a.isSaving(!0),a.napsocViewModel().getSettings(function(n){var i={napsoc:n,siteFeatures:a.siteFeaturesViewModel.getSettings(),website:a.websiteSettingsViewModel.getSettings()};o.save(i,function(n){a.canSave(!0),a.isSaving(!1),n?a.hadSaveError(!0):a.isOpen(!1),e.isFunction(t)&&t()}),r.enable("site settings")}),!1},this.cancel=function(){i.trackEvent("sitesettings","cancel","link"),a.napsocViewModel().reset(),r.enable("site settings")},a.napsocViewModel=t.observable(s.createViewModel({isInDialog:!0,gaCategory:"sitesettings"})),a.siteFeaturesViewModel=l.createViewModel(),a.websiteSettingsViewModel=d.createViewModel(),a.backupRestoreSettingsViewModel=c.createViewModel(),a.sevSettingsViewModel=u.createViewModel(),a.canEdit=t.computed(function(){return a.napsocViewModel().isValid()&&a.canSave()})}function y(n){var i=a.currentApp()+"-siteSettings";a.addControl(p,a.currentApp(),i);var r=e("#"+i);a.addControl(g,a.currentApp(),"builder-napsocSiteSettings"),a.addControl(h,a.currentApp(),"builder-siteFeatures"),a.addControl(m,a.currentApp(),"builder-websiteSettings"),a.addControl(b,a.currentApp(),"builder-backupRestoreSettings"),a.addControl(f,a.currentApp(),"builder-sevSettings"),w=new v,t.applyBindings(w,r[0]),e.isFunction(n)&&n(null,w)}function _(){w.isOpen(!0),r.disable("site settings")}var w;return{load:y,show:_}}),define("text!designer/app/builder/ui/controls/gridGuides/gridGuidesFlyout.html",[],function(){return'<div class="wsb-actionbar-flyout-centerer">\r\n    <div class="wsb-actionbar-flyout" style="display: none;" data-bind="slideDown: { visible:visible, duration: 1000 }">\r\n        <div style="display: block;" id="" class="sf-dialog-title" data-bind="text: i18Dict.Server__Show_grid_slash_guides"></div>\r\n        <div class="wsb-buides-grids-wrap">\r\n            <ul id="grid-guide-elements" class="wsb-grid-buttons clearfix">\r\n                <li class="wsb-grid wsb-grid-first">\r\n                    <div data-bind="click: noGrid, css: gridNoneCssClass"></div>\r\n                    <label data-bind="text:i18Dict.None"></label>\r\n                </li>\r\n                <li class="wsb-grid">\r\n                    <div data-bind="click: smallGrid, css: gridSmallCssClass"></div>\r\n                    <label data-bind="text:i18Dict.Server__Small_grid"></label>\r\n                </li>\r\n                <li class="wsb-grid">\r\n                    <div data-bind="click: largeGrid, css: gridLargeCssClass"></div>\r\n                    <label data-bind="text:i18Dict.Server__Large_grid"></label>\r\n                </li>\r\n                <li class="wsb-element-adjust">\r\n                    <label class="checkbox wsb-snap-checkbox">\r\n                        <input type="checkbox" data-bind="checked: snapToElement, click: snapToElementClick" /><span data-bind="text:i18Dict.Server__Snap_to_other_elements"></span>\r\n                    </label>\r\n                </li>\r\n            </ul>\r\n\r\n            <!-- ko if: hadSaveError -->\r\n                <div class="wsb-actionbar-site-settings-save-error" data-bind="text:i18Dict.Server__We_were_unable_to_save_your_settings">\r\n                    \r\n                </div>\r\n            <!-- /ko -->\r\n        </div>\r\n\r\n        <div class="sf-dialog-buttons">\r\n            <a class="btn btn-success" data-bind="click: save, text:i18Dict.Save"></a>\r\n            <a class="sf-dialog-link" data-bind="click: cancel, text: i18Dict.Cancel" style="cursor: pointer;"></a>\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),define("designer/app/builder/ui/controls/gridGuides/gridGuidesFlyout",["knockout","designer/app/builder/data/designerData","common/logger/logger","designer/app/builder/data/data","common/stats/googleanalytics","jquery","designer/app/app","text!designer/app/builder/ui/controls/gridGuides/gridGuidesFlyout.html","/i18n/resources/client"],function(e,t,n,i,a,r,o,s,l){function d(i){function o(e){return parseInt(e.replace(/px/,""))}function s(){var e=r("#wsb-group-content");e.find(".wsb-canvas-grid-ten").remove(),e.find(".wsb-canvas-grid-twentyfive").remove()}var d=this;d.i18Dict=l.resources,d.hadSaveError=i.hadSaveError,d.gridType=i.gridType,d.snapToElement=i.snapToElement,d.snapToGrid=i.snapToGrid,d.visible=e.observable(!1),d.gridNoneCssClass=e.computed(function(){var e="wsb-grid-none";return"0"==d.gridType()&&(e+=" wsb-grid-active"),e}),d.gridSmallCssClass=e.computed(function(){var e="wsb-grid-small";return"10"==d.gridType()&&(e+=" wsb-grid-active"),e}),d.gridLargeCssClass=e.computed(function(){var e="wsb-grid-large";return"25"==d.gridType()&&(e+=" wsb-grid-active"),e}),d.gridType.subscribe(function(e){void 0!==e&&("0"==e&&s(),d.drawGrid())}),d.snapToElement.subscribe(function(){}),d.snapToGrid.subscribe(function(){}),d.drawGrid=function(e,t,n,i,a,l,c){if("0"!=d.gridType()){var u=r(".wsb-canvas-page-container");if(0!=u.length){var p=u.width(),g=u.height(),h=r("#wsb-group-content");if(0!=h.length){var m,b,f,v=h.width(),y=(p-v)/2,_=0;if(10==d.gridType()?(f="ten",_=10):(f="twentyfive",_=25),i&&a&&"0"!=i&&"0"!=a){var w=o(i),S=o(a);if(y+w+S>=p)p=y+w+S;else if(p==r(".wsb-canvas-grid-"+f).width())return}var k=h.height(),x=o(h.css("border-top-width"));if(0==v)return void window.setTimeout(function(){d.drawGrid(e,t,n,i,a,l,c)},1e3);var C=Math.abs(u.offset().top-h.offset().top-x);n&&"0"!=n&&(C=o(n)+x),e&&"0"!=e&&(v=o(e)),t&&"0"!=t&&(k=o(t));var T=g+C;if(l&&c&&"0"!=l&&"0"!=c){var E=o(l),P=o(c);if(E+P+C>T)T=E+P+C;else if(g==r(".wsb-canvas-grid-"+f).height())return}s(),b=-1*(C+(_-C%_)),T+=Math.abs(_-C%_),m=0-y-(_-y%_),p+=_-y%_;var D=r('<div class="wsb-canvas-grid-'+f+'"></div>');D.css("left",m),D.css("width",p),D.css("top",b),D.css("height",T),h.append(D)}}}},d.noGrid=function(){a.trackEvent("gridguide_settings","nogrid","button"),d.gridType("0"),d.snapToGrid(!1)},d.smallGrid=function(){a.trackEvent("gridguide_settings","smallgrid","button"),d.gridType("10"),d.snapToGrid(!0)},d.largeGrid=function(){a.trackEvent("gridguide_settings","largegrid","button"),d.gridType("25"),d.snapToGrid(!0)},d.snapToElementClick=function(){return a.trackEvent("gridguide_settings","snaptoelement","checkbox"),!0},d.snapToGridClick=function(){return a.trackEvent("gridguide_settings","snaptogrid","checkbox"),!0},d.nineSixtyGrid=function(){s(),alert("Not Yet Implemented")},d.save=function(){d.hadSaveError(!1),a.trackEvent("gridguide_settings","save","button"),t.updateWebsiteSettings({gridType:d.gridType(),snapToElement:1==d.snapToElement()?"1":"0",snapToGrid:1==d.snapToGrid()?"1":"0"}).then(function(){d.visible(!1),g.gridType=d.gridType(),g.snapToGrid=1==d.snapToGrid()?"1":"0",g.snapToElement=1==d.snapToElement()?"1":"0"}).fail(function(){d.hadSaveError(!0),n.log("Error Saving Grid and Guide Settings")})},d.cancel=function(){return a.trackEvent("gridguide_settings","cancel","link"),p(i),d.visible(!1),!1}}function c(){var t={};return t.gridType=e.observable("0"),t.snapToElement=e.observable(!1),t.snapToGrid=e.observable(!1),t.hadSaveError=e.observable(!1),t}function u(t,n){g=i.getDataModel().settings,m.body=r("body"),o.addControl(s,"builder","grid-guide-flyout"),m.container=m.body.find("#grid-guide-flyout")||n;var a=c();return h=new d(a),e.applyBindings(h,m.container[0]),window.setTimeout(function(){p(h)},1e3),t&&t(null,h),h}function p(e){e.gridType(g.gridType?g.gridType:"0"),e.snapToElement(g.snapToElement?1==g.snapToElement?!0:!1:!1),e.snapToGrid(g.snapToGrid?1==g.snapToGrid?!0:!1:!1)}var g,h,m={};return{load:u,visible:function(e){return void 0===e?h.visible():void h.visible(e)},drawGrid:function(){h.drawGrid()}}}),define("text!designer/app/builder/ui/controls/hamburgerFlyout/hamburgerFlyoutItem/hamburgerFlyoutItem.html",[],function(){return'<script type="text/html" id="hamburgerFlyoutItem">\r\n    <li data-bind="\r\n        visible: visible,\r\n        attr: { \'data-aid\': dataAidName }">\r\n        <a class="wsb-action-link" data-bind="attr: { title: title }, click: onClick">\r\n            <div class="hamburger-flyout-item-icon-container">\r\n                <div class="hamburger-flyout-item-icon" data-bind="css: className"></div>\r\n            </div>\r\n            <div class="hamburger-flyout-item-text" data-bind="text: text"></div>\r\n        </a>\r\n    </li>\r\n</script>\r\n\r\n'}),define("designer/app/builder/ui/controls/hamburgerFlyOut/hamburgerFlyoutItem/hamburgerFlyoutItem",["knockout","jquery","common/stats/googleanalytics","text!designer/app/builder/ui/controls/hamburgerFlyout/hamburgerFlyoutItem/hamburgerFlyoutItem.html"],function(e,t,n,i){function a(e){var t=this;t.className="wsb-action-"+e.className,t.dataAidName="exitflyout-"+e.dataAidName,t.title=e.title,t.text=e.text,t.onClickAction=e.onClickAction,t.visible=void 0!==e.visible?e.visible:!0,t.ga=e.ga}t(i).appendTo("body"),e.bindingHandlers.hamburgerFlyoutItem={init:function(n,i){var r=new a(i()),o=t("<div data-bind=\"template: 'hamburgerFlyoutItem'\"></div>").appendTo(n);return e.applyBindings(r,o.get(0)),{controlsDescendantBindings:!0}}};var r=function(e){var t=e.args;n[e.event].apply(this,t)};return a.prototype.onClick=function(){r(this.ga),this.onClickAction()},a}),define("common/util/documentHelper",["appconfig"],function(e){function t(e){if(e&&"0"!==e){var t=n.exec(e);return t?i+"/"+t[1]+"?AccessKeyId="+t[2]+"&disposition=0&alloworigin=1":a+e}return""}var n=/^([0-9a-f]{32}):([0-9a-f]{20})$/i,i=e.documentDownloadBaseUrl.replace(/^https?:|\/+$/gi,""),a="/document/";return{getDocumentUrl:t}}),define("designer/aceEditor/aceEditor",["jquery","knockout","common/util/documentHelper","js!/assets/libs/ace/ace.js!exports=ace"],function(e,t,n,i){function a(t,n){var a=i.edit(t);if(a.setTheme(n.theme),a.getSession().setMode(n.mode),a.getSession().setUseWrapMode(n.useWrapMode),a.setFontSize(n.fontSize),a.setReadOnly(n.readOnly),a.setShowPrintMargin(n.showPrintMargin),a.setDisplayIndentGuides(n.setDisplayIndentGuides),""!==n.initialValue&&a.getSession().setValue(n.initialValue),n.setFocus===!0&&(a.focus(),a.navigateFileEnd()),null!==n.dataAid){var r=a.textInput.getElement();e(r).attr("data-aid",n.dataAid)}return a}var r={theme:"ace/theme/monokai",mode:"ace/mode/css",readOnly:!1,setDisplayIndentGuides:!0,initialValue:"",showPrintMargin:!1,useWrapMode:!1,fontSize:"12px",setFocus:!1,dataAid:null},o={init:function(t,n){n=n||{};var i=e.extend(!0,r,n);return a(t,i)},insertAsset:function(t,i,a,r){var o=t.name(),s=o.split(".").pop().toLowerCase(),l=o.substring(-1*s.length-1),d=["jpg","jpeg","png","bmp","gif"],c=/[a-fA-F0-9]{8}(?:-[a-fA-F0-9]{4}){3}-[a-fA-F0-9]{12}/,u=n.getDocumentUrl(t.id),p="/*"+o+"*/\n";r?-1==e.inArray(s,d)||c.test(l)?"image"===a?i.insert("background-image: url("+u+");\n"):"font"===a?(i.insert(p),i.insert("@font-face{\n"),i.insert('	 font-family:"'+l+'";\n'),i.insert("	 src:url('"+u+"');\n"),i.insert("}\n")):i.insert(p+u+"\n"):i.insert(p+"	 background-image: url("+u+");\n"):i.insert(u)}};return t.bindingHandlers.aceEditor={init:function(n,i){var o=i(),s={mode:"ace/mode/"+t.utils.unwrapObservable(o.mode),dataAid:t.utils.unwrapObservable(o.dataAid),useWrapMode:t.utils.unwrapObservable(o.useWrapMode)},l=e.extend(!0,r,s),d=a(n,l);t.isObservable(o.value)&&d.on("change",function(){var e=d.getValue();e!==o.value()&&o.value(e)})},update:function(e,n){var a=n(),r=i.edit(e),o=t.utils.unwrapObservable(a.value);o!=r.getValue()&&(r.setValue(o),r.clearSelection())}},o}),define("designer/app/builder/managers/css/css",["jquery","lodash","knockout","designer/app/app","designer/app/builder/data/designerData","designer/app/builder/data/data","designer/app/event"],function(e,t,n,i,a,r,o){function s(t){e("#wsb-style-base").text(t.modifiedCss[0]),e("#wsb-style-custom").text(t.modifiedCss[1]),e("#wsb-style-site").text(t.modifiedCss[2]),p(t.pageStyles),e("link[data-wsb-theme]").remove(),e.each(t.cssImports,function(t,n){e('<link data-wsb-theme="true" rel="stylesheet" type="text/css" />').attr("href",n).appendTo("head")}),m(t.cssImports)}var l,d=n.observable(""),c=n.observable(""),u=n.observable(""),p=n.observableArray(),g=r.saver,h=!1,m=n.observableArray(),b=function(e){i.addToHeadTag("<style />",i.currentApp(),"wsb-style-base"),i.addToHeadTag("<style />",i.currentApp(),"wsb-style-custom"),i.addToHeadTag("<style />",i.currentApp(),"wsb-style-site"),a.getCss().then(function(e){f(e,function(){o.emit(o.events.cssLoaded)})}),e(null,"css")},f=function(t,n){void 0!==t.BaseCss&&d(t.BaseCss),void 0!==t.ThemeCss&&c(t.ThemeCss),void 0!==t.SiteCss&&u(t.SiteCss),h||(g.subscribe(d,"baseCss"),g.subscribe(c,"customCss"),g.subscribe(u,"siteCss"),h=!0),e("#wsb-style-base").text(d()),e("#wsb-style-custom").text(e.browser.msie?c().replace(/@import\s*(url\()?\s*('|")?(.*?)('|")?\s*\)?\s*;/gi,""):c()),e("#wsb-style-site").text(e.browser.msie?u().replace(/@import\s*(url\()?\s*('|")?(.*?)('|")?\s*\)?\s*;/gi,""):u()),l([d(),c(),u()]),n&&n()};if(window.Worker){var v=new Worker("/assets/designer/app/builder/managers/css/worker.js");v.addEventListener("message",function(e){s(e.data)}),l=function(e){v.postMessage(e)}}else l=function(e){require(["designer/app/builder/managers/css/cssProcessor"],function(t){var n=t.processCss(e);s(n)})};return{load:b,baseCss:d,siteCss:u,customCss:c,pageStyles:p,updateCss:f,cssImports:m}}),define("text!designer/app/builder/ui/controls/csseditor/csseditor.html",[],function(){return'<div class="wsb-shell-csseditor" data-bind="visible: editorOpen" style="display:none">\r\n\r\n    <div id="cssEditorsContainer" data-bind="event: { mouseleave: hideEditor }">\r\n        <div id="cssEditorShowHandle" data-bind="event: { mouseenter: showEditor }"></div>\r\n        <div id="cssEditors" data-bind="visible: editorOpen">\r\n            <!-- ko if: isUploadActive() -->\r\n            <div id="cssEditorUpload" data-bind="\r\n    visible:editorOpen,\r\n    click: temporarilyPinTheEditor,\r\n    tooltip: i18Dict.InsertCss,\r\n    contextFlyout: {\r\n        template: \'cssEditor-ctrl-flyout\',\r\n        position: \'uc\',\r\n        dismissOtherFlyouts: false,\r\n        isOpen: true,\r\n        onClose: onFlyOutClose,\r\n        cssClass: \'wsb-cssEditor-ctrl-flyout\'\r\n    }">\r\n\r\n            </div>\r\n            <!-- /ko -->\r\n\r\n            <div id="cssEditorTabs" class="sf-tabs-content-wrap">\r\n                <div id="siteCssAceEditorWrapper" class="sf-tabs-content" data-class="editor-sitecss-tab" data-bind="attr: {\'data-title\':i18Dict.SiteCss}" data-aid="csseditor-site-tab">\r\n                    <div id="siteCssAceEditor" class="cssAceEditor"></div>\r\n                </div>\r\n                <div id="themeCssAceEditorWrapper" class="sf-tabs-content" data-class="editor-themecss-tab" data-bind="attr: { \'data-title\': i18Dict.Theme }" data-aid="csseditor-theme-tab">\r\n\r\n                    <div id="themeCssAceEditor" class="cssAceEditor"></div>\r\n                </div>\r\n                <div id="baseCssAceEditorWrapper" class="sf-tabs-content" data-class="editor-basecss-tab" data-bind="attr: { \'data-title\': i18Dict.BaseCss }" data-aid="csseditor-base-tab">\r\n                    <div id="baseCssAceEditor" class="cssAceEditor"></div>\r\n                </div>\r\n            </div>\r\n            <div id="cssEditorControls">\r\n                <div class="wsb-csseditor-pin" data-bind="click: handlePinClick">\r\n                    <div class="wsb-toolbox-pin-icn" data-bind="css: editorPinnedStatus"></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n<script type="text/html" id="cssEditor-ctrl-flyout">    \r\n    <div class="wsb-cssEditor-ctrl-flyout">        \r\n        <ul>\r\n            <li data-bind="click: insertImage"><span data-linkto="image"></span><a data-bind="text: i18Dict.InsertImage"></a></li>      \r\n             <!-- @if (ViewBag.FontEnabled) {      -->\r\n            <li data-bind="click: insertFont"><span data-linkto="font"></span><a data-bind="text: i18Dict.InsertFont"></a></li>\r\n        </ul>\r\n    </div>\r\n</script>'}),define("designer/app/builder/ui/controls/csseditor/csseditor",["jquery","libs/jquery/jqui","designer/aceEditor/aceEditor","designer/app/builder/ui/controls/media/chooser/media.chooser","common/abTesting/abTesting","common/logger/logger","common/stats/googleanalytics","knockout","common/cookiemanager/cookiemanager","designer/app/builder/managers/css/css","designer/app/builder/managers/themeManager","designer/app/builder/data/data","designer/app/app","/i18n/resources/client","text!designer/app/builder/ui/controls/csseditor/csseditor.html"],function(e,t,n,i,a,r,o,s,l,d,c,u,p,g,h){function m(){function t(){a.mediaChooserIsOpen(!1),a.temporarilyPinned(!1)}var a=this;a.i18Dict={SiteCss:g.resources.Server__Site_css,Theme:g.resources.Server__Theme,BaseCss:g.resources.Server__Base_css,InsertImage:g.resources.Server__Insert_image,InsertFont:g.resources.Server__Insert_font,InsertCss:g.resources.Client__Insert_to_css},a.isAvailable=s.computed(function(){var t=!c.themeLocale();return e(".wsb-shell-csseditor").css("visibility",t?"visible":"hidden"),t});var r=!1,d=300;a.editorPinned=s.observable(!0),a.temporarilyPinned=s.observable(!1),a.mediaChooserIsOpen=s.observable(!1),a.activeEditor=s.observable(""),a.editorOpen=a.editorPinned(),a.editorOpen,a.canBeShown=!1,a.alreadyShownOnce=!1,a.insertImage=function(){a.mediaChooserIsOpen(!0),i.openImages(!1,[],function(e){e&&e.length&&k&&n.insertAsset(e[0],k,"image",F.formatInsertion),a.temporarilyPinned()&&a.editorPinned(!1),t()})},a.insertFont=function(){a.mediaChooserIsOpen(!0),i.openFiles(!1,[],function(e){e&&e.length&&k&&n.insertAsset(e[0],k,"font",F.formatInsertion),a.temporarilyPinned()&&a.editorPinned(!1),t()})},a.handlePinClick=function(){a.editorPinned(!a.editorPinned()),a.temporarilyPinned(!1),l.setCookie("cssEditorPinned",a.editorPinned()?"1":"0"),o.trackEvent("wsb-designer-csseditor","pin",a.editorPinned().toString()),a.editorPinned()||a.hideEditor()},a.onFlyOutClose=function(){a.temporarilyPinned()&&!a.mediaChooserIsOpen()&&(t(),a.hideEditor())},a.temporarilyPinTheEditor=function(){a.editorPinned()||(a.temporarilyPinned(!0),a.editorPinned(!0))},a.hideEditor=function(t,n){if(a.canBeShown&&!r&&!a.editorPinned()){if(n){if(e(window).width()-n.clientX-30<0)return;if(n.clientY<e(".wsb-shell-csseditor").offset().top)return;if(e(window).height()-n.clientY<0)return}r=!0,a.editorOpen=!1,e(".wsb-shell-csseditor").hide("slide",{direction:"right"},d,function(){e("#cssEditors").hide(),e(".wsb-shell-csseditor").show(),e("#cssEditorShowHandle").show(),r=!1})}},a.showEditor=function(){a.canBeShown&&(r||(r=!0,e("#cssEditorShowHandle").hide(),e(".wsb-shell-csseditor").hide(),e("#cssEditors").show(),e(".wsb-shell-csseditor").show("slide",{direction:"right"},d,function(){a.editorOpen=!0,r=!1
})))},a.editorPinnedStatus=s.computed(function(){return a.editorPinned()?"wsb-toolbox-pinned":"wsb-csseditor-pin"}),a.isUploadActive=s.computed(function(){return"UserMode"===T.editingMode?"siteCssAceEditor"===a.activeEditor():!0})}function b(t){I(),L(x),x.alreadyShownOnce=!0,x.canBeShown=!0,"ThemeEditMode"==T.editingMode?(A(!1),x.activeEditor("themeCssAceEditor"),e("#cssEditorTabs").sfTabs("hide",0),e("#cssEditorTabs").sfTabs("select",1)):(A(!0),M(),x.activeEditor("siteCssAceEditor"),e("#cssEditorTabs").sfTabs("select",0)),O(),s.dataFor(e("#builder-csseditor")[0])||s.applyBindings(x,e("#builder-csseditor")[0]||t[0]),e(".editor-sitecss-tab a").text(g.resources.Server__Site_css),e(".editor-themecss-tab a").text(g.resources.Server__Theme),e(".editor-basecss-tab a").text(g.resources.Server__Base_css)}function f(){e(".wsb-shell-csseditor").hide()}function v(){x.canBeShown=!0,e(".wsb-shell-csseditor").show()}function y(){return x.alreadyShownOnce}function _(e){C=u.getDataModel(),T=C.user,p.addControl(h,"builder","builder-csseditor"),x=new m,e(null,"csseditor"),C.address.isDesktopEditAction.subscribe(function(e){e&&x.canBeShown?y()?v():b():e||f()})}var w,S,k,x,C,T,E,P,D,I,A,M,O,L,N,B=[],F={formatInsertion:"enabled"===a.getOption("formatInsertedMedia")};return E=function(){d.updateCss("ThemeEditMode"===T.editingMode?{ThemeCss:B.themeCssAceEditor.getSession().getValue()}:{SiteCss:B.siteCssAceEditor.getSession().getValue()})},P=function(){void 0!==S&&clearTimeout(S),S=setTimeout(function(){E()},1e3)},D=function(){},I=function(){var e={readOnly:!0,initialValue:d.baseCss(),setDisplayIndentGuides:!1,useWrapMode:!1,mode:"ace/mode/css"},t="baseCssAceEditor";B[t]=n.init(t,e),d.baseCss.subscribe(function(e){B[t].getSession().getValue()!=e&&B[t].getSession().setValue(e)})},A=function(t){var i={initialValue:d.customCss(),setDisplayIndentGuides:!1,useWrapMode:!1,readOnly:t,fontSize:"14px",mode:"ace/mode/css"},a="themeCssAceEditor";B[a]=n.init(a,i),d.customCss.subscribe(function(e){B[a].getSession().getValue()!=e&&B[a].getSession().setValue(e)}),t||(B[a].on("change",function(){P()}),B[a].on("focus",function(){D(w,!1)}),e("#"+a).on("mouseout",function(){D(w,!0)}))},M=function(){var t={initialValue:d.siteCss(),setDisplayIndentGuides:!1,useWrapMode:!1,readOnly:!1,fontSize:"14px",mode:"ace/mode/css"},i="siteCssAceEditor";B[i]=n.init(i,t),d.siteCss.subscribe(function(e){B[i].getSession().getValue()!=e&&B[i].getSession().setValue(e)}),B[i].on("change",function(){P()}),B[i].on("focus",function(){D(w,!1)}),e("#"+i).on("mouseout",function(){D(w,!0)})},O=function(){e(".wsb-shell-csseditor").resizable({handles:"w",resize:function(){e(".wsb-shell-csseditor").css("left","")}})},L=function(t){e("#cssEditorTabs").sfTabs({onTabSelected:function(n,i,a){var r=a.children().attr("id");for(var s in B)s===r&&(k=B[s],t.activeEditor(s));o.trackEvent("wsb-designer-csseditor",e(a).attr("data-aid"),"tab")}}),N()},N=function(){var t=e("#app").height()-(e("#cssEditors ul").height()>0?e("#cssEditors ul").height():e("#cssEditorControls").height())-e("#cssEditorControls").height();e("#themeCssAceEditorWrapper").css("height",t+"px"),e("#baseCssAceEditorWrapper").css("height",t+"px"),e("#siteCssAceEditorWrapper").css("height",t+"px"),e("#cssEditorShowHandle").css("height",e("#app").height()+"px")},e(window).resize(function(){N()}),{load:_,blur:function(){for(var e in B)B[e].blur()},toggleShortcutKeysStatus:D,ignoreUpdateInEditMode:P,updateThemeCss:E,show:b,hide:f,showAgain:v,alreadyShownOnce:y,getViewModel:function(){return m}}}),define("designer/app/builder/ui/controls/hotkeys/hotkeys",["designer/app/builder/data/data","designer/app/builder/ui/controls/csseditor/csseditor","designer/app/builder/managers/elementManager","designer/app/builder/managers/pageManager","designer/app/builder/managers/addressManager","designer/app/builder/ui/controls/media/chooser/media.chooser","/i18n/resources/client","knockout","jquery"],function(e,t,n,i,a,r,o,s,l){function d(e){e===D[P++]?P===D.length&&(t.show(),setTimeout(function(){alert(o.resources.Client__CssEditor_Enable.sfFormat("\n"))},1e3)):P=0}function c(e,t,n){var i=e.getAttribute("id"),a=e.getAttribute("contenteditable");return n&&(n=n.toUpperCase()),t&&(t=t.toUpperCase()),"INPUT"===n&&("TEXT"===t||"PASSWORD"===t||"URL"===t)||"TEXT"===n||"TEXTAREA"===n||a||"themeCssAceEditor"===i||"siteCssAceEditor"===i}function u(e,t){function n(e,t,n){switch(t){case 37:case 39:var i=37===t?-n:n;e.pixelLeft(e.pixelLeft()+i);break;case 38:case 40:var i=38===t?-n:n;e.pixelTop(e.pixelTop()+i)}}I.collect("nudge"),l.each(x(),function(i,a){n(a,e,t)}),I.enable("nudge")}function p(e){var t=0,n=1/0;if(0!==x().length){switch(I.collect(),e){case 38:l.each(x(),function(e,t){n=Math.min(n,t.pixelTop())}),l.each(x(),function(e,t){t.pixelTop(n)});break;case 37:l.each(x(),function(e,t){n=Math.min(n,t.pixelLeft())}),l.each(x(),function(e,t){t.pixelLeft(n)});break;case 39:l.each(x(),function(e,n){t=Math.max(t,n.pixelLeft()+n.pixelWidth())}),l.each(x(),function(e,n){var i=n.pixelWidth();n.pixelLeft(t-i)});break;case 40:l.each(x(),function(e,n){t=Math.max(t,n.pixelTop()+n.pixelHeight())}),l.each(x(),function(e,n){var i=n.pixelHeight();n.pixelTop(t-i)})}I.enable()}}function g(){var e=S().Settings.Width(),t=_.sortBy(x(),function(e){return e.pixelLeft()}),n=parseInt(e)/(t.length+1);I.collect(),l.each(t,function(e,t){t.hideActionMenu(),t.pixelLeft((e+1)*n-t.pixelWidth()/2)}),I.enable()}function h(e){var t=e.srcElement||e.target,i=t.tagName.toUpperCase(),a=t.type&&t.type.toUpperCase(),r=e.which,o=!1;switch(r){case 83:case 115:if(e.ctrlKey||e.metaKey)return!1;break;case 90:case 122:if(e.ctrlKey||e.metaKey)return I.undo(),!1;break;case 89:case 121:if(e.ctrlKey||e.metaKey)return I.redo(),!1;break;case 19:return!1;case 27:return!1}if(!c(t,i,a))switch(d(r),r){case 9:return e.preventDefault(),!1;case 8:case 46:return x().length>0&&(I.collect("deleting elements"),x().forEach(function(e){n.deleteElement(e)}),I.enable("deleting elements")),!1;case 107:case 187:if(e.ctrlKey)return x().length>0&&(I.collect(),x().forEach(function(e){e.zoom(1)}),I.enable()),!1;case 33:case 221:return x().forEach(function(e){n.moveElementUp(e)}),!1;case 109:case 189:if(e.ctrlKey)return x().length>0&&(I.collect(),x().forEach(function(e){e.zoom(-1)}),I.enable()),!1;case 34:case 219:return x().forEach(function(e){n.moveElementDown(e)}),!1;case 37:case 39:case 38:case 40:return e.ctrlKey?(p(e.which),!1):(u(e.which,e.shiftKey?O:M),!1);case 67:if(e.ctrlKey||e.metaKey)return A=_.reduce(n.selectedElementIds(),function(e,t,i){return C=l("#builder-canvas").scrollTop(),T=l("#builder-canvas").scrollLeft(),e.push(n.getElementViewModel(i)),e},[]),!1;if(e.altKey)return g(),!1;break;case 88:if(e.ctrlKey||e.metaKey)return A=_.reduce(n.selectedElementIds(),function(e,t,i){return C=l("#builder-canvas").scrollTop(),T=l("#builder-canvas").scrollLeft(),e.push(n.getElementViewModel(i)),e},[]),o||x().length>0&&(I.collect(),x().forEach(function(e){n.deleteElement(e)}),I.enable()),!1;break;case 86:if((e.ctrlKey||e.metaKey)&&!o)return I.collect(),A.forEach(function(e){var t=l("#builder-canvas").scrollTop(),i=l("#builder-canvas").scrollLeft(),a=e.pixelTop()-C+t,r=e.pixelLeft()-T+i,o=n.copyElement(e,!1,w.address.currentPage(),!1,{top:a,left:r});o&&o.Locked()&&o.unlock()}),I.enable(),!1}}function m(e){e.stopPropagation(),e.preventDefault()}function b(e){e.stopPropagation(),e.preventDefault()}function f(e){if(e.stopPropagation(),e.preventDefault(),w.address.currentAction()===a.actions.edit){var t=e.originalEvent.dataTransfer.files;t&&t.length&&r.upload(t)}}function v(e){E.document.unbind("keydown"),e&&E.document.bind("keydown",h),k.canvasDragDropUpload&&E.document.off({dragenter:m,dragleave:b,dragover:!1,drop:f}).on({dragenter:m,dragleave:b,dragover:!1,drop:f})}function y(){E.document.unbind("keydown")}var w,S,k,x,C,T,E={document:l(document)},P=0,D=[38,38,40,40,37,39,37,39,66,65],I=e.undoer,A=[],M=1,O=25,L=function(){S=s.computed(function(){return i.getCurrentPage()}),w=e.getDataModel(),k=w.config,v(w.address.isEditAction()),w.address.isEditAction.subscribe(v),x=s.computed({read:function(){var e=Object.keys(n.selectedElementIds());return 0==e.length||null==n.getElement(e[0])?[]:_.transform(e,function(e,t){var i=n.getElementViewModel(t);return i&&!i.Locked()?e.push(i):void 0})},deferEvaluation:!0})};return{load:L,unbindHotkeysAndShortcuts:y,bindHotkeysAndShortcuts:v}}),define("text!designer/app/builder/ui/controls/mutator/mutator.html",[],function(){return'<script type="text/html" id="mutator-template" data-aid="mutator-template">\r\n  <!-- ko if: $data.mutatorViewModel && ($data.mutatorViewModel.showAdvancedTab() || $data.mutatorViewModel.showBasicTabOnly()) -->\r\n  <div class="sf-tabs-content" data-title="Element Settings"\r\n       data-bind="css: {\r\n    \'sf-tabs-content\': $data.mutatorViewModel.showAdvancedTab,\r\n    \'sf-notab-content\': !$data.mutatorViewModel.showAdvancedTab()\r\n}, visible: !$data.mutatorViewModel.showAdvancedTab(),\r\n    attr: { \'data-title\': $data.SettingsTitle },\r\n    template: { name: \'mutator-template-element-\' + $data.Type() }"\r\n       style="display: none; width: 550px;">\r\n  </div>\r\n  <!-- /ko -->\r\n  <!-- ko template: \'mutator-template-box\' -->\r\n  <!-- /ko -->\r\n  <!-- ko template: \'mutator-template-site\' -->\r\n  <!-- /ko -->\r\n  <!-- ko template: \'mutator-template-page\' -->\r\n  <!-- /ko -->\r\n\r\n</script>\r\n\r\n<script type="text/html" id="mutator-template-textbox">\r\n  <div class="wsb-canvas-mutator-ctrl-outer wsb-canvas-mutator-textbox clearfix">\r\n    <div class="wsb-canvas-mutator-ctrl-label wsb-repeat-label" data-bind="text: title"></div>\r\n    <div class="wsb-canvas-mutator-ctrl-input wsb-text-input-property clearfix">\r\n      <input type="text" data-bind="value: data" class="wsb-text-box wsb-redo-select" />\r\n      <!-- ko ifnot: data.isValid -->\r\n      <div class="wsb-text-box-error-text" data-bind="text: data.validationMessage"></div>\r\n      <!-- /ko -->\r\n    </div>\r\n  </div>\r\n</script>\r\n\r\n<script type="text/html" id="shadow-effect-template">\r\n  <div data-bind="attr: { \'class\': \'wsb-shadow wsb-shadow-preview \' + cssClass }"></div>\r\n</script>\r\n\r\n<!--  CSS Size Editor -->\r\n<script type="text/html" id="mutator-template-cssSizeEditor">\r\n  <div class="wsb-mutator-css-size-editor" class="wsb-canvas-mutator-ctrl">\r\n    <div class="wsb-size-editor-wrap">\r\n      <ul class="mutator-border-control" data-bind="foreach: unitTypes, dropList: { value: unit, zIndex: 2000000001, width: 50, inDialog: true }" style="float: right;">\r\n        <li data-bind="attr: { \'data-value\': $data, \'data-selected\': ($parent.unit() && $data.value === $parent.unit().value) ? \'true\' : undefined }">\r\n          <div data-main="true">\r\n            <div data-bind="text: $data.text"></div>\r\n          </div>\r\n        </li>\r\n      </ul>\r\n    </div>\r\n    <div class="wsb-canvas-mutator-numeric-box-container">\r\n      <input class="input" data-bind="value: value" />\r\n    </div>\r\n  </div>\r\n</script>\r\n\r\n<!--  Dialog Slider -->\r\n<script type="text/html" id="mutator-template-slider">\r\n\r\n  <div class="wsb-canvas-mutator-ctrl-outer wsb-canvas-mutator-slider clearfix">\r\n    <!--  label -->\r\n    <div class="wsb-canvas-mutator-ctrl-label wsb-thumb-spd-label" data-bind="html: title"></div>\r\n\r\n    <!--  slider wrap -->\r\n    <div class="wsb-canvas-mutator-ctrl-input wsb-slider-wrap clearfix">\r\n      <div data-bind="mutatorSlider: true"></div>\r\n      <!--  Input area -->\r\n      <div class="wsb-canvas-mutator-numeric-box-container clearfix wsb-redo-select">\r\n        <input data-bind="value: data" />\r\n        <!-- ko if: unit -->\r\n        <span data-bind="text: unit"></span>\r\n        <!-- /ko -->\r\n      </div>\r\n    </div>\r\n\r\n\r\n  </div>\r\n</script>\r\n\r\n<script type="text/html" id="mutator-template-koslider">\r\n  <div class="wsb-canvas-mutator-ctrl-outer wsb-canvas-mutator-slider clearfix">\r\n    <div class="wsb-canvas-mutator-ctrl-label wsb-thumb-spd-label" data-bind="text: title"></div>\r\n\r\n    <div class="wsb-canvas-mutator-ctrl-input wsb-slider-wrap clearfix">\r\n      <input type="text" data-bind="value: data, slider: { min: min, max: max, inc: inc }" />\r\n    </div>\r\n\r\n    <div class="wsb-canvas-mutator-numeric-box-container clearfix wsb-redo-select">\r\n      <input data-bind="value: data" />\r\n      <!-- ko if: $data.unit -->\r\n      <span data-bind="text: unit"></span>\r\n      <!-- /ko -->\r\n    </div>\r\n  </div>\r\n</script>\r\n\r\n<script type="text/html" id="mutator-template-select">\r\n  <div class="wsb-canvas-mutator-ctrl-outer wsb-canvas-mutator-select clearfix">\r\n\r\n    <div class="wsb-canvas-mutator-ctrl-label wsb-repeat-label" data-bind="text: title"></div>\r\n\r\n    <div class="wsb-repeat-property clearfix">\r\n      <!-- ko if: options[0].hasOwnProperty("name") -->\r\n      <select class="wsb-select-box" data-bind="\r\n    options: options,\r\n    optionsText: \'name\',\r\n    optionsValue: \'id\',\r\n    value: data"></select>\r\n      <!-- /ko -->\r\n      <!-- ko ifnot: options[0].hasOwnProperty("name") -->\r\n      <select class="wsb-select-box" data-bind="\r\n    options: options,\r\n    optionsText: $data.optionsText,\r\n    optionsValue: $data.optionsValue,\r\n    value: data"></select>\r\n      <!-- /ko -->\r\n    </div>\r\n\r\n  </div>\r\n</script>\r\n\r\n<script type="text/html" id="mutator-template-checkbox">\r\n  <div class="wsb-canvas-mutator-ctrl-outer wsb-canvas-mutator-checkbox clearfix">\r\n    <div class="wsb-canvas-mutator-ctrl-label" data-bind="text: title"></div>\r\n    <div class="wsb-canvas-mutator-ctrl-input clearfix">\r\n      <label class="checkbox">\r\n        <input type="checkbox" data-bind="checked: data" />\r\n        <span data-bind="text: label"></span>\r\n      </label>\r\n    </div>\r\n  </div>\r\n</script>\r\n\r\n<!--  Options Checkboxes -->\r\n<script type="text/html" id="mutator-template-checkboxlist">\r\n\r\n  <div class="wsb-canvas-mutator-ctrl-outer wsb-canvas-mutator-checkboxlist clearfix">\r\n\r\n    <div class="wsb-canvas-mutator-ctrl-label wsb-options-label" data-bind="text: title"></div>\r\n\r\n    <!--  Options Checkbox -->\r\n    <div class="wsb-canvas-mutator-ctrl-input clearfix" data-bind="foreach: data">\r\n      <label class="checkbox">\r\n        <!-- ko if: $data.hasOwnProperty("enabled") -->\r\n        <input type="checkbox" data-bind="checked: value, attr: { value: $index }, enable: enabled" />\r\n        <span data-bind="html: name, css: { \'disabled\': !enabled }"></span>\r\n        <!-- /ko -->\r\n        <!-- ko ifnot: $data.hasOwnProperty("enabled") -->\r\n        <input type="checkbox" data-bind="checked: value, attr: { value: $index }" />\r\n        <span data-bind="html: name"></span>\r\n        <!-- /ko -->\r\n      </label>\r\n    </div>\r\n  </div>\r\n</script>\r\n\r\n<script type="text/html" id="mutator-template-radio">\r\n  <div class="wsb-canvas-mutator-ctrl-outer wsb-canvas-mutator-radio clearfix">\r\n    <div class="wsb-canvas-mutator-ctrl-label" data-bind="text: title"></div>\r\n    <div class="wsb-canvas-mutator-ctrl-input clearfix" data-bind="foreach: options">\r\n      <label class="radio">\r\n        <input type="radio" data-bind="attr: { name: $parent.group, value: $index }, checked: $parent.data" />\r\n        <span data-bind="text: $data"></span>\r\n      </label>\r\n    </div>\r\n  </div>\r\n</script>\r\n\r\n<script type="text/html" id="mutator-template-carousel">\r\n  <div class="wsb-canvas-mutator-ctrl-outer wsb-canvas-mutator-carousel clearfix">\r\n    <div class="wsb-canvas-mutator-ctrl-label wsb-effects-label" data-bind="text: title"></div>\r\n    <div class="wsb-canvas-mutator-ctrl-input clearfix">\r\n      <!-- ko if: $data.hasOwnProperty("noneTemplate") -->\r\n      <div data-bind="mutatorCarousel: {\r\n    value: data,\r\n    items: options,\r\n    itemValueProperty: optionValueProperty,\r\n    itemTemplate: optionTemplate,\r\n    noneValue: noneValue,\r\n    noneTemplate: noneTemplate\r\n}">\r\n      </div>\r\n      <!-- /ko -->\r\n      <!-- ko ifnot: $data.hasOwnProperty("noneTemplate") -->\r\n      <div data-bind="mutatorCarousel: {\r\n    value: data,\r\n    items: options,\r\n    itemValueProperty: optionValueProperty,\r\n    itemTemplate: optionTemplate,\r\n    noneValue: null,\r\n    noneTemplate: null\r\n}">\r\n      </div>\r\n      <!-- /ko -->\r\n    </div>\r\n  </div>\r\n</script>\r\n\r\n<script type="text/html" id="mutator-template-carousel-none-template">\r\n  <div class="wsb-effect-none"></div>\r\n</script>\r\n\r\n<script type="text/html" id="mutator-template-carousel-with-none">\r\n  <div class="wsb-canvas-mutator-ctrl-outer wsb-canvas-mutator-carousel clearfix">\r\n    <div class="wsb-canvas-mutator-ctrl-label wsb-effects-label" data-bind="text: title"></div>\r\n    <div class="wsb-canvas-mutator-ctrl-input clearfix">\r\n      <div data-bind="mutatorCarousel: {\r\n    value: data,\r\n    items: options,\r\n    itemValueProperty: optionValueProperty,\r\n    itemTemplate: optionTemplate,\r\n    noneValue: noneValue,\r\n    noneTemplate: noneTemplate\r\n}">\r\n      </div>\r\n    </div>\r\n  </div>\r\n</script>\r\n\r\n<script type="text/html" id="mutator-template-carousel-v2">\r\n  <div class="wsb-canvas-mutator-ctrl-outer wsb-canvas-mutator-carousel clearfix">\r\n    <div class="wsb-canvas-mutator-ctrl-label wsb-effects-label" data-bind="text: title"></div>\r\n    <div class="wsb-canvas-mutator-ctrl-input clearfix">\r\n      <div data-bind="mutatorCarousel: carouselBinding"></div>\r\n    </div>\r\n  </div>\r\n</script>\r\n\r\n<script type="text/html" id="mutator-template-carousel-image">\r\n  <img class="wsb-canvas-mutator-carousel-image" data-bind="attr: { title: title, src: src }" alt="" />\r\n</script>\r\n\r\n<script type="text/html" id="mutator-template-carousel-style">\r\n  <div data-bind="attr: { \'class\': \'wsb-canvas-mutator-carousel-style \' + cssClass }"></div>\r\n</script>\r\n\r\n<!--  Single color picker -->\r\n<script type="text/html" id="mutator-template-colorpicker">\r\n  <div class="wsb-canvas-mutator-ctrl-outer wsb-canvas-mutator-colorpicker clearfix">\r\n\r\n    <div class="wsb-canvas-mutator-ctrl-label wsb-color-label" data-bind="text: title"></div>\r\n    <div class="wsb-canvas-mutator-ctrl-input clearfix">\r\n      <div data-bind="colorPicker: { color: data, zIndex: 2000020050, inDialog: true }"></div>\r\n    </div>\r\n  </div>\r\n</script>\r\n\r\n<!--  Gradient picker -->\r\n<script type="text/html" id="mutator-template-gradientpicker">\r\n  <div class="wsb-canvas-mutator-ctrl-outer wsb-canvas-mutator-gradientpicker clearfix">\r\n    <div class="wsb-canvas-mutator-ctrl-label wsb-color-label" data-bind="text: title"></div>\r\n    <div class="wsb-canvas-mutator-ctrl-input mutator-background-control-wrapper clearfix">\r\n      <div class="mutator-background-control" data-bind="colorPicker: { color: data.color1, zIndex: 2000020050, inDialog: true }" style="float: left;"></div>\r\n      <div class="mutator-background-control mutator-gradient-controls" data-bind="visible: data.useGradient">\r\n        <div class="mutator-background-control mutator-gradient-preview"\r\n             data-bind="background: {\r\n    gradientType: data.gradientType() === 0 ? \'none\' : \'linear\',\r\n    color: data.color1,\r\n    color2: data.color2,\r\n    direction: data.gradientType() === 2 ? \'vertical\' : \'horizontal\'\r\n}">\r\n        </div>\r\n        <div class="mutator-background-control" style="float: left;" data-bind="colorPicker: { color: data.color2, inDialog: true }"></div>\r\n        <div class="mutator-background-control mutator-gradient-direction mutator-gradient-horizontal"\r\n             data-bind="visible: data.gradientType() === 2, click: function () { data.gradientType(1); }">\r\n        </div>\r\n        <div class="mutator-background-control mutator-gradient-direction mutator-gradient-vertical"\r\n             data-bind="visible: data.gradientType() === 1, click: function () { data.gradientType(2); }">\r\n        </div>\r\n      </div>\r\n      <label class="mutator-background-control mutator-gradient-checkbox">\r\n        <input type="checkbox" data-bind="checked: data.useGradient" /><a data-bind="html:\'&nbsp;\' +  $data.i18Dict.Gradient" />\r\n      </label>\r\n    </div>\r\n  </div>\r\n</script>\r\n\r\n<!--  Picker -->\r\n<script type="text/html" id="mutator-template-picker">\r\n  <div class="wsb-canvas-mutator-ctrl-outer wsb-canvas-mutator-urlpicker clearfix">\r\n    <div class="wsb-canvas-mutator-ctrl-label wsb-url-label" data-bind="text: title"></div>\r\n    <div class="wsb-canvas-mutator-ctrl-input wsb-url-property clearfix">\r\n      <input class="wsb-text-box wsb-redo-select"\r\n             type="text"\r\n             data-bind="picker: {\r\n    value: $data.data,\r\n    watermark: $data.watermark,\r\n    normalize: $data.normalize,\r\n    editorTemplate: $data.editorTemplate,\r\n    editorModel: $data.editorModel,\r\n    isPlaceholder: $data.isPlaceholder,\r\n    placeholderCssClass: $data.placeholderCssClass,\r\n    placeholderText: $data.placeholderText,\r\n    placeholderTooltip: $data.placeholderTooltip,\r\n    flyoutTemplate: $data.flyoutTemplate,\r\n    flyoutWidth: $data.flyoutWidth,\r\n    flyoutModel: $data.flyoutModel\r\n}" />\r\n      <!-- ko if: data.isValid && !data.isValid() -->\r\n      <div class="wsb-text-box-error-text" data-bind="text: data.validationMessage"></div>\r\n      <!-- /ko -->\r\n    </div>\r\n  </div>\r\n</script>\r\n\r\n<!--  URL Picker -->\r\n<script type="text/html" id="mutator-template-urlpicker">\r\n  <div class="wsb-canvas-mutator-ctrl-outer wsb-canvas-mutator-urlpicker clearfix">\r\n    <div class="wsb-canvas-mutator-ctrl-label wsb-url-label" data-bind="text: title"></div>\r\n    <div class="wsb-canvas-mutator-ctrl-input wsb-url-property clearfix">\r\n      <input class="wsb-text-box wsb-redo-select" type="url" data-bind="urlPicker: { url: data, pages: $root.pages }" />\r\n      <!-- ko if: data.isValid && !data.isValid() -->\r\n      <div class="wsb-text-box-error-text" data-bind="text: data.validationMessage"></div>\r\n      <!-- /ko -->\r\n      <!-- ko if: $data.newWindow !== undefined -->\r\n      <label class="checkbox">\r\n        <input type="checkbox" data-bind="checked: newWindow" /><a data-bind="    text: $data.i18Dict.OpenLinkInNewWindow"></a>\r\n\r\n      </label>\r\n      <!-- /ko -->\r\n    </div>\r\n  </div>\r\n</script>\r\n\r\n<!--  Input -->\r\n<script type="text/html" id="mutator-template-input">\r\n  <div class="wsb-canvas-mutator-ctrl-outer clearfix">\r\n    <div class="wsb-canvas-mutator-ctrl-label" data-bind="text: title"></div>\r\n    <div class="wsb-canvas-mutator-ctrl-input clearfix">\r\n      <input class="wsb-text-box wsb-redo-select" type="text" data-bind="value: data, valueUpdate: \'afterkeydown\'" />\r\n    </div>\r\n  </div>\r\n</script>\r\n\r\n<!--  Toggle Buttons -->\r\n<script type="text/html" id="mutator-template-toggle">\r\n  <div class="wsb-canvas-mutator-ctrl-outer clearfix">\r\n    <div class="wsb-canvas-mutator-ctrl-label" data-bind="text: title"></div>\r\n    <div class="wsb-canvas-mutator-ctrl-input clearfix" data-bind="foreach: options">\r\n      <a class="btn" data-bind="css: { \'btn-success\': $data == $parent.data(), \'btn-upgrade\': $data != $parent.data() }, click: $parent.click, clickBubble: false">\r\n        <i data-bind="attr: { \'class\': \'cf_label_\' + $data }"></i>\r\n        <span data-bind="text: $data"></span>\r\n      </a>\r\n    </div>\r\n  </div>\r\n</script>\r\n\r\n\r\n<!--  Border Picker -->\r\n<script type="text/html" id="mutator-template-borderpicker">\r\n  <div class="wsb-canvas-mutator-ctrl-outer wsb-canvas-mutator-borderpicker clearfix">\r\n    <div class="wsb-canvas-mutator-ctrl-label wsb-line-label" data-bind="text: $data.i18Dict.BorderColon">\r\n    </div>\r\n    <div class="wsb-canvas-mutator-ctrl-input clearfix">\r\n      <div class="wsb-line-drop-down">\r\n        <div class="mutator-border-control" data-bind="colorPicker: { color: data.color, inDialog: true }" style="margin-right: 4px;"></div>\r\n        <div class="wsb-mutator-droplist wsb-mutator-border-droplist">\r\n          <ul class="mutator-border-control" data-bind="\r\n    foreach: data.hasOwnProperty(\'borderStyles\') ? data.borderStyles : $root.borderStyles,\r\n    dropList: { value: data.style, zIndex: 2000000001, width: 159 }"\r\n              style="float: left;">\r\n            <li data-bind="attr: {\r\n    \'data-value\': value,\r\n    \'data-selected\': (value === $parent.data.style()) ? \'true\' : undefined\r\n}">\r\n              <div data-main="true" class="mutator-border-style">\r\n                <div class="mutator-border-style-name" data-bind="visible: value == \'none\', text: name"></div>\r\n                <div class="mutator-border-style-value" data-bind="visible: value != \'none\',\r\n    style: {\r\n        borderBottomStyle: value,\r\n        borderRightStyle: \'none\',\r\n        borderTopStyle: \'none\',\r\n        borderLeftStyle: \'none\',\r\n        borderColor: \'#000000\',\r\n        borderWidth: Math.min(10, Math.max(1, $parent.data.width())) + \'px\',\r\n        height: ((32 - Math.min(10, Math.max(1, $parent.data.width()))) / 2) + \'px\'\r\n    }">\r\n                </div>\r\n              </div>\r\n            </li>\r\n          </ul>\r\n        </div>\r\n      </div>\r\n      <div class="wsb-canvas-mutator-numeric-box-container wsb-line-size">\r\n        <input class="input mutator-border-width sf-form-input mutator-border-control wsb-redo-select"\r\n               type="text"\r\n               data-bind="value: data.width, valueUpdate: \'afterkeydown\', disable: data.style() == \'none\', css: { disabled: data.style() == \'none\' }" />\r\n        <span data-bind="text: $data.i18Dict.Px"></span>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</script>\r\n\r\n<script type="text/html" id="mutator-template-imagepicker">\r\n  <div class="wsb-canvas-mutator-ctrl-outer wsb-canvas-mutator-imagepicker clearfix">\r\n    <div class="wsb-canvas-mutator-ctrl-label" data-bind="text: title"></div>\r\n    <div data-bind="\r\n    imagePicker: {\r\n        docId: data.docId\r\n    }">\r\n    </div>\r\n  </div>\r\n</script>\r\n\r\n<!--  Address Picker -->\r\n<script type="text/html" id="address-picker-template">\r\n  <div class="wsb-address-picker">\r\n    <h3 data-bind="text: $data.i18Dict.SelectAddressColon"></h3>\r\n    <a class="wsb-address-picker-item" href="#" data-bind="text: addressPlaceholderText, attr: { title: napsocAddress }, click: useAddressPlaceholder, clickBubble: false"></a>\r\n  </div>\r\n</script>\r\n<script type="text/html" id="address-picker-autocomplete-template">\r\n  <input class="wsb-text-box wsb-picker-textbox" data-bind="\r\n    value: address,\r\n    needsFormatted: needsFormatted,\r\n    placesAutocomplete: true,\r\n    css: { \'wsb-text-box-error\': (!showError || showError()) && address && address.isValid && !address.isValid() }" />\r\n</script>\r\n\r\n<!--  Email Picker -->\r\n<script type="text/html" id="email-picker-template">\r\n  <div class="wsb-address-picker">\r\n    <h3 data-bind="text: $data.i18Dict.SelectEmailAddressColon"></h3>\r\n    <a class="wsb-address-picker-item" href="#" data-bind="text: emailPlaceholderText, attr: { title: napsocEmailAddress }, click: useEmailPlaceholder, clickBubble: false"></a>\r\n  </div>\r\n</script>\r\n\r\n<!--  Image Picker -->\r\n<script type="text/html" id="image-picker-template">\r\n  <!-- ko if: showImage() -->\r\n  <div>\r\n    <!-- Image Is Placed Here -->\r\n  </div>\r\n  <span class="remove" data-bind="click: removeImage"></span>\r\n  <!-- /ko -->\r\n  <!-- ko ifnot: showImage() -->\r\n  <span class="noimage" data-bind="text: $data.i18Dict ? $data.i18Dict.None : \'\'"></span>\r\n  <!-- /ko -->\r\n</script>\r\n'}),define("text!designer/app/builder/ui/controls/mutator/box.html",[],function(){return'<script type="text/html" id="mutator-template-box">\r\n\r\n    <!-- ko if: $data.mutatorViewModel -->\r\n    <!-- ko with: mutatorViewModel -->\r\n    <!-- ko if: backgroundColorEnabled() || borderEnabled() || shadowEnabled() || roundedCornerEnabled()\r\n        || transparencyEnabled() || paddingEnabled() || sizeEnabled() || colorEnabled() -->\r\n    <div class="wsb-canvas-mutator-advanced"\r\n         style="display:none;height: 309px; width:550px"\r\n         data-bind="css: {\r\n            \'sf-tabs-content\': showAdvancedTab,\r\n            \'sf-notab-content\': !showAdvancedTab()\r\n        }, visible: !showAdvancedTab(),\r\n        attr: {\'data-title\':i18Dict.AdvancedTabHtmlString }\r\n    ">\r\n        <div class="wsb-canvas-mutator-inner">\r\n            <!-- ko if: backgroundColorEnabled -->\r\n            <div class="wsb-canvas-mutator-ctrl-outer clearfix">\r\n                <div class="wsb-canvas-mutator-ctrl-label" data-bind="text: i18Dict.BackgroundColorColon">\r\n                </div>\r\n                <div class="wsb-canvas-mutator-ctrl-input clearfix">\r\n                    <div class="mutator-background-control" data-bind="colorPicker: { color: backgroundColor, inDialog: true }" style="float: left;"></div>\r\n                    <div class="mutator-background-control mutator-gradient-controls" data-bind="visible: useBackgroundGradient">\r\n                        <div class="mutator-background-control mutator-gradient-preview"\r\n                             data-bind="background: {\r\n                            gradientType: gradientType() === 0 ? \'none\' : \'linear\',\r\n                            color: backgroundColor,\r\n                            color2: backgroundColor2,\r\n                            direction: gradientType() === 2 ? \'vertical\' : \'horizontal\'\r\n                        }">\r\n                        </div>\r\n                        <div class="mutator-background-control" style="float:left;" data-bind="colorPicker: { color: backgroundColor2, inDialog: true }"></div>\r\n                        <div class="mutator-background-control mutator-gradient-direction mutator-gradient-horizontal"\r\n                             data-bind="visible: isHorizontalGradient, click: selectVerticalGradient"></div>\r\n                        <div class="mutator-background-control mutator-gradient-direction mutator-gradient-vertical"\r\n                             data-bind="visible: isVerticalGradient, click: selectHorizontalGradient"></div>\r\n                    </div>\r\n                    <label class="mutator-background-control mutator-gradient-checkbox">\r\n                        <input type="checkbox" data-bind="checked: useBackgroundGradient" /> <span data-bind="text: i18Dict.Gradient"></span>\r\n                    </label>\r\n                </div>\r\n            </div>\r\n            <!-- /ko -->\r\n            <!-- ko if: colorEnabled -->\r\n            <div class="wsb-canvas-mutator-ctrl-outer clearfix">\r\n                <div class="wsb-canvas-mutator-ctrl-label" data-bind="text: i18Dict.FontColorColon">\r\n                </div>\r\n                <div class="wsb-canvas-mutator-ctrl-input clearfix">\r\n                    <div class="mutator-color-control" data-bind="colorPicker: { color: color, inDialog: true }" style="float: left;"></div>\r\n                </div>\r\n            </div>\r\n            <!-- /ko -->\r\n            <!-- ko if: borderEnabled -->\r\n            <div class="wsb-canvas-mutator-ctrl-outer clearfix">\r\n                <div class="wsb-canvas-mutator-ctrl-label wsb-line-label" data-bind="text: i18Dict.BorderColon">\r\n                </div>\r\n                <div class="wsb-canvas-mutator-ctrl-input wsb-canvas-advanced-border clearfix">\r\n                    <div class="wsb-adv-border-ctrl">\r\n                        <div class="mutator-border-control" data-bind="colorPicker: { color: borderColor, inDialog: true }" style="margin-right:4px;"></div>\r\n                        <div class="wsb-mutator-droplist wsb-mutator-border-droplist">\r\n                            <ul class="mutator-border-control" data-bind="\r\n                            foreach: borderStyles,\r\n                            dropList: { value: borderStyle, zIndex: 2000000001, width: 159 }">\r\n                                <li data-bind="attr: {\r\n                                    \'data-value\': value,\r\n                                    \'data-selected\': (value === $parent.borderStyle()) ? \'true\' : undefined\r\n                                }">\r\n                                    <div data-main="true" class="mutator-border-style">\r\n                                        <div class="mutator-border-style-name" data-bind="visible: value == \'none\', text: name"></div>\r\n                                        <div class="mutator-border-style-value" data-bind="visible: value != \'none\',\r\n                                        style: {\r\n                                            borderBottomStyle: value,\r\n                                            borderRightStyle: \'none\',\r\n                                            borderTopStyle: \'none\',\r\n                                            borderLeftStyle: \'none\',\r\n                                            borderColor: \'#000000\',\r\n                                            borderWidth: Math.max(1, $parent.borderWidth()) + \'px\',\r\n                                            height: ((32 - Math.max(1, $parent.borderWidth())) / 2) + \'px\'\r\n                                        }">\r\n                                        </div>\r\n                                    </div>\r\n                                </li>\r\n                            </ul>\r\n                        </div>\r\n                    </div>\r\n                    <div class="wsb-canvas-mutator-numeric-box-container">\r\n                        <input class="input mutator-border-width sf-form-input mutator-border-control wsb-redo-select"\r\n                               type="text"\r\n                               data-bind="value: borderWidth, valueUpdate: \'afterkeydown\', disable: borderStyle() == \'none\', css: { disabled: borderStyle() == \'none\' }" />\r\n                        <span data-bind="text: i18Dict.Px"></span>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <!-- /ko -->\r\n            <!-- ko if: shadowEnabled -->\r\n            <div class="wsb-shadow-effect-carousel" data-bind="mutatorElement: {\r\n			name: \'carousel-with-none\',\r\n			data: ShadowCssClass,\r\n			context: {\r\n				title:i18Dict.ShadowColon,\r\n				optionTemplate: \'shadow-effect-template\',\r\n				optionValueProperty: \'cssClass\',\r\n				options: shadowCssClasses,\r\n				noneTemplate: \'mutator-template-carousel-none-template\',\r\n				noneValue: \'\'\r\n				}\r\n			}"></div>\r\n            <!-- /ko -->\r\n            <!-- ko if: roundedCornerEnabled -->\r\n            <div class="wsb-canvas-mutator-ctrl-outer clearfix">\r\n                <div class="wsb-canvas-mutator-ctrl-label wsb-thumb-spd-label" data-bind="text: i18Dict.RoundedCornersColon">\r\n                </div>\r\n                <div class="wsb-canvas-mutator-ctrl-input clearfix">\r\n                    <div class="wsb-canvas-mutator-ctrl-input wsb-slider-wrap">\r\n                        <input type="number" data-bind="value: roundedCornerSize, slider: { min: roundedCornerMin, max: roundedCornerMax, inc: 1 }" />\r\n                    </div>\r\n                    <div class="wsb-canvas-mutator-numeric-box-container wsb-advanced-slider-input clearfix wsb-redo-select">\r\n                        <input type="text" class="input mutator-border-width sf-form-input wsb-redo-select" style="width:50px;"\r\n                               data-bind=" value: roundedCornerSize" />\r\n                        <span data-bind="text: i18Dict.Px"></span>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <!-- /ko -->\r\n            <!-- ko if: transparencyEnabled -->\r\n            <div class="wsb-canvas-mutator-ctrl-outer clearfix">\r\n                <div class="wsb-canvas-mutator-ctrl-label wsb-thumb-spd-label" data-bind="text: i18Dict.TransparencyColon">\r\n                </div>\r\n                <div class="wsb-canvas-mutator-ctrl-input clearfix">\r\n                    <div class="wsb-canvas-mutator-ctrl-input wsb-slider-wrap">\r\n                        <input type="number" data-bind="value: transparency, slider: { min: 0, max: 99, inc: 1 }" />\r\n                    </div>\r\n                    <div class="wsb-canvas-mutator-numeric-box-container wsb-advanced-slider-input clearfix wsb-redo-select">\r\n                        <input type="text" class="input mutator-border-width sf-form-input wsb-redo-select"\r\n                               data-bind="value: transparency, event: { keyup: transparencyEntered }" />\r\n                        <span>%</span>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <!-- /ko -->\r\n            <!-- ko if: paddingEnabled -->\r\n            <div class="wsb-canvas-mutator-ctrl-outer clearfix">\r\n                <div class="wsb-canvas-mutator-ctrl-label wsb-thumb-spd-label" data-bind="text: i18Dict.MarginColon">\r\n                </div>\r\n                <div class="wsb-canvas-mutator-ctrl-input clearfix">\r\n                    <div class="wsb-canvas-mutator-ctrl-input wsb-slider-wrap">\r\n                        <input type="number" data-bind="value: padding, slider: { min: 0, max: paddingMax, inc: 1 }" />\r\n                    </div>\r\n                    <div class="wsb-canvas-mutator-numeric-box-container wsb-advanced-slider-input clearfix wsb-redo-select">\r\n                        <input class="input mutator-border-width sf-form-input wsb-redo-select" type="text" data-bind="value: padding, valueUpdate: \'afterkeydown\'" /> <span data-bind="text: i18Dict.Px"></span>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <!-- /ko -->\r\n            <!-- ko if: sizeEnabled -->\r\n            <div class="wsb-canvas-mutator-ctrl-outer clearfix">\r\n                <div class="wsb-canvas-mutator-ctrl-label wsb-thumb-spd-label" data-bind="text: i18Dict.SizeColon">\r\n                </div>\r\n                <div class="wsb-canvas-mutator-ctrl-input clearfix">\r\n                    <div class="wsb-canvas-advanced-width" data-bind="text: i18Dict.Width">\r\n                    </div>\r\n                    <div class="pull-left wsb-pixel-text-width" data-bind="cssSizeEditor: { value: width, units: [{ value: \'px\', text:i18Dict.Px }] }"></div>\r\n                    <div class="wsb-advanced-height-label" data-bind="text: i18Dict.Height"></div>\r\n                    <div class="pull-left" data-bind="cssSizeEditor: { value: height, units: [{ value: \'px\', text:i18Dict.Px }] }"></div>\r\n                </div>\r\n            </div>\r\n            <!-- /ko -->\r\n        </div>\r\n    </div>\r\n    <!-- /ko -->\r\n    <!-- /ko -->\r\n    <!-- /ko -->\r\n</script>'
}),define("text!designer/app/builder/ui/controls/mutator/site.html",[],function(){return'<script type="text/html" id="mutator-template-site">\r\n    <!-- ko if: elementViewModel.Type() === \'site\' -->\r\n    <div class="wsb-canvas-mutator-inner wsb-site-bkg-height" data-bind="with: elementViewModel">\r\n\r\n        <!-- ko ifnot: isEditingLocalizedTheme -->\r\n        <!-- Color Property -->\r\n        <div class="wsb-canvas-mutator-ctrl-outer clearfix">\r\n            <div class="wsb-canvas-mutator-ctrl-label wsb-color-label" data-bind="text: i18N.colorColon"></div>\r\n            <div class="wsb-canvas-mutator-ctrl-input clearfix">\r\n                <!-- First color picker -->\r\n                <div class="background-color-picker" data-aid="background-color-picker1" data-bind="colorPicker: {\r\n                    color: backgroundColor,\r\n                    allowTransparent: false,\r\n                    zIndex: 2000000001,\r\n                    inDialog: true\r\n                }">\r\n                </div>\r\n\r\n                <div class="mutator-gradient-controls" data-bind="visible: useBackgroundGradient">\r\n                    <!-- Gradient preview -->\r\n                    <div class="mutator-gradient-preview"\r\n                        data-bind="background: {\r\n                                    gradientType: gradientType() === 0 ? \'none\' : \'linear\',\r\n                                    color: backgroundColor,\r\n                                    color2: backgroundColor2,\r\n                                    direction: gradientType() === 1 ? \'horizontal\' : \'vertical\'\r\n                                }">\r\n                    </div>\r\n\r\n                    <!-- Second color picker -->\r\n                    <div class="background-color-picker" data-aid="background-color-picker2" data-bind="colorPicker: {\r\n                                                                    color: backgroundColor2,\r\n                                                                    allowTransparent: false,\r\n                                                                    zIndex: 2000000001,\r\n                                                                    inDialog: true\r\n                                                                }">\r\n                    </div>\r\n\r\n                    <!-- Gradient rotation buttons -->\r\n                    <a href="javascript:void(0)" class="mutator-gradient-direction" data-aid="background-grad-vertical" data-bind="visible: isHorizontalGradient, click: selectVerticalGradient"></a>\r\n                    <a href="javascript:void(0)" class="mutator-gradient-direction" data-aid="background-grad-horizontal" data-bind="visible: isVerticalGradient, click: selectHorizontalGradient"></a>\r\n                </div>\r\n\r\n                <!-- Gradient checkbox -->\r\n                <div class="mutator-gradient-checkbox">\r\n                    <label class="checkbox">\r\n                        <input type="checkbox" data-aid="background-grad-select" data-bind="checked: useBackgroundGradient" />\r\n                        <span data-bind="text: i18N.gradient"></span>\r\n                    </label>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <!-- /ko -->\r\n\r\n        <!-- Image Property -->\r\n        <div class="wsb-canvas-mutator-ctrl-outer clearfix">\r\n            <div class="wsb-canvas-mutator-ctrl-label wsb-iamge-label" data-bind="text: i18N.imageColon"></div>\r\n            <div class="wsb-img-property clearfix">\r\n                <label class="checkbox">\r\n                    <input type="checkbox" data-bind="checked: setPath, enable: setPath" />\r\n                    <span class="wsb-canvas-mutator-thumbnail">\r\n                        <!-- ko if: setPath -->\r\n                        <img data-bind="attr: { src: setPath }" />\r\n                        <!-- /ko -->\r\n                        <!-- ko ifnot: setPath -->\r\n                        <span data-bind="text: i18N.noImageSelected"></span>\r\n                        <!-- /ko -->\r\n                    </span>\r\n                </label>\r\n            </div>\r\n            <a href="javascript:void(0);" class="wsb-change-btn btn btn-inverse-grey" data-bind="click: chooseImage"><i class="icon-img icon-wsb-white"></i><span data-bind="text: i18N.change"></span></a>\r\n        </div>\r\n\r\n        <!-- ko ifnot: isEditingLocalizedTheme -->\r\n        <!-- Alignment Property -->\r\n        <div class="wsb-canvas-mutator-ctrl-outer clearfix">\r\n            <div class="wsb-canvas-mutator-ctrl-label wsb-alignment-label" data-bind="text: i18N.alignmentColor"></div>\r\n            <div class="wsb-alignment-property clearfix">\r\n                <ul class="wsb-canvas-mutator-alignment">\r\n                    <li class="wsb-align-left-top" data-bind="css: { \'wsb-canvas-mutator-alignment-selected\': isLeftTop }, click: clickLeftTop"></li>\r\n                    <li class="wsb-align-center-top" data-bind="css: { \'wsb-canvas-mutator-alignment-selected\': isCenterTop }, click: clickCenterTop"></li>\r\n                    <li class="wsb-align-right-top" data-bind="css: { \'wsb-canvas-mutator-alignment-selected\': isRightTop }, click: clickRightTop"></li>\r\n                    <li class="wsb-align-left-center" data-bind="css: { \'wsb-canvas-mutator-alignment-selected\': isLeftMiddle }, click: clickLeftMiddle"></li>\r\n                    <li class="wsb-align-center" data-bind="css: { \'wsb-canvas-mutator-alignment-selected\': isCenterMiddle }, click: clickCenterMiddle"></li>\r\n                    <li class="wsb-align-right-center" data-bind="css: { \'wsb-canvas-mutator-alignment-selected\': isRightMiddle }, click: clickRightMiddle"></li>\r\n                    <li class="wsb-align-left-bottom" data-bind="css: { \'wsb-canvas-mutator-alignment-selected\': isLeftBottom }, click: clickLeftBottom"></li>\r\n                    <li class="wsb-align-center-bottom" data-bind="css: { \'wsb-canvas-mutator-alignment-selected\': isCenterBottom }, click: clickCenterBottom"></li>\r\n                    <li class="wsb-align-right-bottom" data-bind="css: { \'wsb-canvas-mutator-alignment-selected\': isRightBottom }, click: clickRightBottom"></li>\r\n                </ul>\r\n            </div>\r\n        </div>\r\n\r\n        <!-- Repeat Property -->\r\n        <div class="wsb-canvas-mutator-ctrl-outer clearfix">\r\n            <div class="wsb-canvas-mutator-ctrl-label wsb-repeat-label" data-bind="text: i18N.repeatColor"></div>\r\n            <div class="wsb-repeat-property clearfix">\r\n                <select class="wsb-select-box" data-bind="options: repeatOptions, optionsText: \'name\', optionsValue: \'value\', value: selectedOption"></select>\r\n            </div>\r\n        </div>\r\n\r\n        <!--Scrolling Property -->\r\n        <div class="wsb-canvas-mutator-ctrl-outer clearfix">\r\n            <div class="wsb-canvas-mutator-ctrl-label wsb-scroll-label" data-bind="text: i18N.scrollingColon"></div>\r\n            <div class="wsb-scroll-property">\r\n                <label class="checkbox">\r\n                    <input type="checkbox" data-bind="checked: scrollable" />\r\n                    <span data-bind="text: i18N.scrollBackgroundWithPage"></span>\r\n                </label>\r\n            </div>\r\n        </div>\r\n        <!-- /ko -->\r\n\r\n    </div>\r\n    <!-- /ko -->\r\n</script>\r\n'}),define("text!designer/app/builder/ui/controls/mutator/page.html",[],function(){return"<script type=\"text/html\" id=\"mutator-template-page\">\r\n    <!-- ko if: elementViewModel.Type() === 'page' -->\r\n    <div class=\"wsb-canvas-mutator-inner\" data-bind=\"with: elementViewModel\">\r\n        <!-- Width -->\r\n        <div data-bind=\"attr: { 'data-aid': 'pageSettings-Width' }, mutatorElement: { name: 'slider', data: width, context: { title: i18n.widthColon, min: 200, max: 2000, unit: i18n.pixel } }\"></div>\r\n        <!-- Height -->\r\n        <div data-bind=\"attr: { 'data-aid': 'pageSettings-Height' }, mutatorElement: { name: 'slider', data: height, context: { title: i18n.heightColon, min: minHeight, max: 9999, unit: i18n.pixel } }\"></div>\r\n        <!-- Postion -->\r\n        <div data-bind=\"attr: { 'data-aid': 'pageSettings-Top' }, mutatorElement: { name: 'slider', data: marginTop, context: { title: i18n.topPositionColon, min: 0, max: 1000, unit: i18n.pixel } }\"></div>\r\n        <!-- Color -->\r\n        <div data-bind=\"attr: { 'data-aid': 'pageSettings-Color' }, mutatorElement: { name: 'colorpicker', data: pageColor, context: { title: i18n.colorColon } }\"></div>\r\n        <!-- Effect: TO CREATE -->\r\n    </div>\r\n    <!-- /ko -->\r\n</script>"}),define("designer/app/builder/ui/controls/mutator/mutator",["jquery","knockout","designer/app/event","designer/app/builder/data/data","common/stats/googleanalytics","/i18n/resources/client","designer/app/app","designer/app/builder/managers/pageManager","designer/app/builder/ui/controls/hotkeys/hotkeys","text!designer/app/builder/ui/controls/mutator/mutator.html","text!designer/app/builder/ui/controls/mutator/box.html","text!designer/app/builder/ui/controls/mutator/site.html","text!designer/app/builder/ui/controls/mutator/page.html","common/ui/dialog","libs/knockout/ko.addins_v2","common/geo/placesAutocomplete","wsbcore/tipper","libs/jquery/jqui"],function(e,t,n,i,a,r,o,s,l,d,c,u,p){function g(n){var i=this,a=t.computed(function(){return e.map(s.pages(),function(e){return{id:e.Id,name:e.Name,type:"page"}})});i.Title=n.Title,i.test="test",i.SettingsTitle=n.SettingsTitle,i.Type=n.MutatorType||n.Type,i.pages=a,i.mutatorViewModel=n.createBaseMutatorViewModel&&n.createBaseMutatorViewModel()||h(n),i.mutatorViewModel.i18Dict=e.extend(i.mutatorViewModel.i18Dict||i.mutatorViewModel.i18N,M),i.elementViewModel=n,i.isValid=i.mutatorViewModel&&i.mutatorViewModel.isValid||function(){return!0}}function h(e){return _.assign({showAdvancedTab:_.noop,showBasicTabOnly:_.noop,backgroundColorEnabled:_.noop,borderEnabled:_.noop,shadowEnabled:_.noop,roundedCornerEnabled:_.noop,transparencyEnabled:_.noop,paddingEnabled:_.noop,sizeEnabled:_.noop,colorEnabled:_.noop},e)}function m(n){var i=n.elementViewModel,o=n.anchor||!1;T=n.onsave||!1,P=n.showInMiddle||!1,E=n.oncancel||!1,D=n.openAdvancedTab||!1,v(),I.collect(A),l.unbindHotkeysAndShortcuts();var s=new g(i),d=i.SettingsTitle;i.Styling&&(d=i.Styling.ShowAdvancedTab()&&!i.Styling.ShowBasicTabOnly()||!i.Title?r.resources.Settings:i.SettingsTitle),n={title:d,modal:!1,buttons:[{text:r.resources.Save,onClick:function(){a.trackEvent(b(i)+"_settings","save","button");var e=function(){return s.isValid()?s.mutatorViewModel&&s.mutatorViewModel.onSave&&!s.mutatorViewModel.onSave(s.mutatorViewModel)?!1:void v(!0,T):!1};return s.mutatorViewModel&&"function"==typeof s.mutatorViewModel.beforeSaveEvent?(s.mutatorViewModel.beforeSaveEvent(e),!1):void e()}},{text:r.resources.Cancel,style:"link",cancel:!0,onClick:function(){a.trackEvent(b(i)+"_settings","cancel","link"),v(!1,E)}}],onOpen:function(e){C=e,C.find(".sf-tip").sfTipper({wireup:!0})},onCancel:function(){E&&E(),I.cancelChanges(A)},onClose:function(t,n){n&&a.trackEvent(b(i)+"_settings","xclose","icon"),f(),e.isFunction(s.elementViewModel.state)&&s.elementViewModel.state(s.elementViewModel.stateMap.view)},onTabSelected:function(e,t){1===t&&a.trackEvent("advanced_settings",b(i),"tab"),0===t&&a.trackEvent("general_settings",b(i),"tab")},onButtonClick:function(){v(!1)}},P||(n.anchor=o||e("#"+i.ID()),n.anchorAttachment="tl",n.dialogOffset={width:10}),x=e('<div data-bind="template: \'mutator-template\'" style="display: none" />'),t.applyBindings(s,x[0]),i.Styling&&i.Styling.AdvancedApplyToMobile&&t.utils.unwrapObservable(i.Styling.AdvancedApplyToMobile)!==!0||x.find(".wsb-canvas-mutator-advanced").attr("data-title",r.resources.Advanced),x.wsbDialog(n),x.wsbDialog("resize"),D&&x.wsbDialog("selectTab",1),x.parents(".sf-dialog:first").addClass("wsb-undo-select").find(".sf-dialog-title").mousedown(function(){f()})}function b(e){var t=e.Title;return t&&t.toLowerCase().replace(/\s/g,"_")}function f(){e(".sf-flyout-client-sf-colorpicker:visible").length>0&&e(".sf-flyout-client-sf-colorpicker:visible .Cancel.sf-dialog-link").trigger("click"),e(".url-picker-flyout:visible").parents(".sf-flyout:first").length>0&&e(".wsb-picker-container .wsb-picker-icon").trigger("click"),e(".sf-droplist-drop:visible").length>0&&e(".sf-droplist-drop:visible").hide()}function v(t,n){x&&(x.wsbDialog("destroy"),x=null,t===!1?(e.isFunction(E)&&E(),I.cancelChanges(A)):I.enable(A),e.isFunction(n)&&n(),l.bindHotkeysAndShortcuts(!0))}function y(){x&&x.wsbDialog("resize")}function w(e){x&&x.wsbDialog("disableButton",e)}function S(){return x?x.wsbDialog("isOpen"):!1}function k(e){x&&x.wsbDialog("enableButton",e)}var x,C,T,E,P,D,I=i.undoer,A=I.keys().mutator,M={Gradient:r.resources.Server__Gradient,OpenLinkInNewWindow:r.resources.Server__Open_link_in_new_window,BorderColon:r.resources.Server__Border_colon,Px:r.resources.Server__px,SelectAddressColon:r.resources.Server__Select_address_colon,SelectEmailAddressColon:r.resources.Server__Select_email_address_colon,None:r.resources.None,MarginColon:r.resources.Server__Margin_colon,SizeColon:r.resources.Server__Size_colon,Width:r.resources.Server__Width,ShadowColon:r.resources.Server__Shadow_colon,TransparencyColon:r.resources.Server__Transparency_colon,FontColorColon:r.resources.Server__Font_color_colon,RoundedCornersColon:r.resources.Server__Rounded_corners_colon,Height:r.resources.Server__Height,BackgroundColorColon:r.resources.Server__Background_color_colon,Advanced:r.resources.Advanced,Server__Properties_do_not_apply_to_the_mobile_optimized_view:r.resources.Server__Properties_do_not_apply_to_the_mobile_optimized_view,AdvancedTabHtmlString:"<span>"+r.resources.Advanced+'</span> <span class="sf-tip" data-title="'+r.resources.Server__Advanced_Properties+'" data-content="'+r.resources.Server__Properties_do_not_apply_to_the_mobile_optimized_view+'"></span>'};return function(t){function n(e){return 0!==e[1]().name.indexOf(i)&&(e[1]().name=i+"-"+e[1]().name),e}var i="mutator-template";t.bindingHandlers.mutatorElement={init:function(i,a){var r=t.utils.unwrapObservable(a()),o=t.bindingHandlers.template.init.apply(this,n(arguments));if(r.context&&e.isFunction(r.context.afterRender)){var s=r.context.afterRender;setTimeout(function(){s(i,o)},0)}return o},update:function(i,a){var r=t.utils.unwrapObservable(a());r.context&&(r.context.data=r.data,r.data=r.context,e.extend(r.data,{i18Dict:M}),delete r.context),t.bindingHandlers.template.update.apply(this,n(arguments))}}}(t),t.bindingHandlers.mutatorSlider={init:function(t,n,i,a){var r=a;e(t).slider({range:"max",min:r.min,max:r.max,step:1,value:r.data(),slide:function(e,t){r.data(t.value)}}),r.data.subscribe(function(n){e(t).slider({value:n})})}},t.bindingHandlers.mutatorCarousel={init:function(n,i,r,o,s){function l(e){if("object"==typeof e){var n=p.itemValueProperty?t.utils.unwrapObservable(p.itemValueProperty):"value";return t.utils.unwrapObservable(e[n])}return e}function d(){c.find(".wsb-carousel-scroll-panel > ul > li").length&&c.find(".wsb-carousel-scroll-panel").width()?u(!0):setTimeout(d,1)}var c=e("<div data-bind=\"template: 'carousel'\"/>").appendTo(e(n)),u=t.observable(!1),p=i(),g=t.observable(0),h=t.computed({deferEvaluation:!0,read:function(){if(u()){var n={pageForItem:{},pageScrollOffsets:[0],pageCount:1},i=c.find(".wsb-carousel-scroll-panel"),a=i.width(),r=0,o=t.utils.unwrapObservable(p.items);if(o){for(var s=i.find("> ul > li"),d=0;d<s.length;d++){var g=e(s[d]),h=g.position();h&&(h.left+g.width()>n.pageScrollOffsets[r]+a&&(n.pageScrollOffsets.push(h.left),r++,n.pageCount++),n.pageForItem[l(o[d])]=r)}return n}}}}),m={scrollPosition:t.computed(function(){return u()?h()?h().pageScrollOffsets[g()]:0:0}),items:p.items,itemTemplate:p.itemTemplate,noneTemplate:p.noneTemplate,noneValue:p.noneValue,isItemSelected:function(e){return t.computed(function(){var n=t.utils.unwrapObservable(p.value),i=l(e);if(void 0!==n)return i==n||n&&"string"==typeof i&&null!==n.match(new RegExp("(?:^"+i+"$)|(?:\\w+\\s+"+i+")"))})},canScrollLeft:t.computed(function(){return u()&&g()>0}),canScrollRight:t.computed(function(){return h()?u()&&g()<h().pageCount-1:!1}),selectItem:function(e){if(t.isObservable(p.value)){var n,i=p.itemValueProperty;n="value"===i?"slideshow":"name"===i?"share":"photo_gallery",a.trackEvent(n+"_settings","style",e.name),p.value(l(e))}},hasNoneTemplate:t.computed(function(){return null!==p.noneTemplate}),selectNoneItem:function(){t.isObservable(p.value)&&p.value(t.utils.unwrapObservable(p.noneValue))},scrollLeft:function(){return g(Math.max(0,g()-1)),!1},scrollRight:function(){return g(Math.min(h().pageCount-1,g()+1)),!1}};return t.applyBindingsToDescendants(s.createChildContext(m),n),d(),{controlsDescendantBindings:!0}}},{show:m,hide:v,resize:y,enableButton:k,disableButton:w,isOpen:S,load:function(t){n.on(n.events.flyoutClose,function(){v(!0)});var i=e(d).add(c).add(c).add(u).add(p);o.addControl(i,o.currentApp,"builder-mutator"),t(null,"mutator")}}}),define("designer/app/builder/ui/controls/hamburgerFlyOut/page",["jquery","/i18n/resources/client","knockout","designer/app/builder/ui/controls/mutator/mutator","designer/app/builder/data/data","designer/app/builder/managers/pageManager","designer/app/builder/managers/elementManager"],function(e,t,n,i,a,r,o){function s(i,a){function r(t,i,a){return n.computed({read:function(){return parseFloat(t())},write:function(n){var r=parseFloat(t());n=parseFloat(e.trim(n)),isNaN(n)&&(n=r),isNaN(n)&&(n=i),n=Math.round(n),n=Math.max(Math.min(n,a),i),n!==r?t(n+"px"):t.notifySubscribers(n+"px")}})}var o=this,s=t.resources;o.Type=n.observable("page"),o.tool=o.Type,o.Title=t.resources.Client__Page_Background,o.SettingsTitle=t.resources.Page_Background_Settings,o.pageColor=i.Settings.Background,o.width=r(i.Settings.Width,200,2e3),o.height=r(i.Settings.Height,400,9999),o.marginTop=r(i.Settings.Style,0,1e3),o.i18n={widthColon:s.Server__Width_colon,heightColon:s.Server__Height_colon,topPositionColon:s.Server__Top_position_colon,colorColon:s.Server__Color_colon,pixel:s.Server__px},o.minHeight=400,a.minHeight&&a.minHeight()>400&&(o.minHeight=a.minHeight())}function l(t){var n=r.getCurrentPage(),a=o.getGroupById("content"),l=new s(n,a);i.show({elementViewModel:l,showInMiddle:!0}),e.isFunction(t)&&t(l)}return{mutate:l}}),define("designer/app/builder/ui/controls/hamburgerFlyOut/site",["jquery","knockout","designer/app/builder/ui/controls/media/chooser/media.chooser","common/persistence/persistence","common/stats/googleanalytics","/i18n/resources/client","common/i18n/localizableProperty","designer/app/builder/ui/controls/mutator/mutator","designer/app/builder/managers/themeManager","designer/app/builder/data/data","common/util/documentHelper"],function(e,t,n,i,a,r,o,s,l,d,c){function u(i,o){function l(){var t=i.BackgroundGradient();return t&&JSON.parse(t)||e.extend({},u)}var d=this;d.Type=t.observable("site"),d.tool=d.Type,d.Title=r.resources.Client__Site_Background,d.SettingsTitle=r.resources.Site_Background_Settings,d.i18N={colorColon:r.resources.Server__Color_colon,gradient:r.resources.Server__Gradient,imageColon:r.resources.Server__Image_colon,noImageSelected:r.resources.Server__No_image_selected,change:r.resources.Change,alignmentColor:r.resources.Server__Alignment_colon,repeatColor:r.resources.Server__Repeat_colon,scrollingColon:r.resources.Server__Scrolling_colon,scrollBackgroundWithPage:r.resources.Server__Scroll_background_with_page};var u={type:0,color2:"#ffffff"};d.backgroundColor=i.BackgroundColor,d.backgroundColor2=t.computed({read:function(){return l().color2},write:function(e){var t=l();t.color2=e,i.BackgroundGradient(JSON.stringify(t))}}),d.gradientType=t.computed({read:function(){return l().type},write:function(e){var t=l();t.type=e,i.BackgroundGradient(JSON.stringify(t))}}),d.useBackgroundGradient=t.computed({read:function(){return!!l().type},write:function(e){a.trackEvent("site_background_settings","gradient_"+(e?"on":"off"),"checkbox");var t=l();t.type=+e,i.BackgroundGradient(JSON.stringify(t))}}),d.isHorizontalGradient=t.computed(function(){return 1*d.gradientType()===2}),d.isVerticalGradient=t.computed(function(){return 1*d.gradientType()===1}),d.selectHorizontalGradient=function(){d.gradientType(2)},d.selectVerticalGradient=function(){d.gradientType(1)},d.repeatOptions=t.observableArray([{name:r.resources.Client__Repeat_Horizontally_x,value:"repeat-x"},{name:r.resources.Client__Repeat_Horizontally_y,value:"repeat-y"},{name:r.resources.Client__Repeat_Both,value:"repeat"},{name:r.resources.Client__No_Repeat,value:"no-repeat"}]),d.selectedOption=i.BackgroundRepeat,d.scrollable=i.BackgroundScrolling,d.isLeftTop=t.computed(function(){return"left top"==i.BackgroundAlign()}),d.isLeftMiddle=t.computed(function(){return"left center"==i.BackgroundAlign()}),d.isLeftBottom=t.computed(function(){return"left bottom"==i.BackgroundAlign()}),d.isCenterTop=t.computed(function(){return"center top"==i.BackgroundAlign()}),d.isCenterMiddle=t.computed(function(){return"center center"==i.BackgroundAlign()}),d.isCenterBottom=t.computed(function(){return"center bottom"==i.BackgroundAlign()}),d.isRightTop=t.computed(function(){return"right top"==i.BackgroundAlign()}),d.isRightMiddle=t.computed(function(){return"right center"==i.BackgroundAlign()}),d.isRightBottom=t.computed(function(){return"right bottom"==i.BackgroundAlign()}),d.clickLeftTop=function(){i.BackgroundAlign("left top")},d.clickLeftMiddle=function(){i.BackgroundAlign("left center")},d.clickLeftBottom=function(){i.BackgroundAlign("left bottom")},d.clickCenterTop=function(){i.BackgroundAlign("center top")},d.clickCenterMiddle=function(){i.BackgroundAlign("center center")},d.clickCenterBottom=function(){i.BackgroundAlign("center bottom")},d.clickRightTop=function(){i.BackgroundAlign("right top")},d.clickRightMiddle=function(){i.BackgroundAlign("right center")},d.clickRightBottom=function(){i.BackgroundAlign("right bottom")},d.setPath=i.BackgroundImage,d.chooseImage=function(){var e=[],t=i.BackgroundDocumentId().toString();"0"!==t&&e.push({id:t}),a.trackEvent("site_background_settings","browseto_changeimage","button"),n.openImages(!1,e,function(e){e&&e.length&&(i.BackgroundDocumentId(e[0].id),d.setPath(c.getDocumentUrl(e[0].id)))})},d.scrollable.subscribe(function(e){a.trackEvent("site_background_settings","scroll_withpage_"+(e?"on":"off"),"checkbox")}),d.isEditingLocalizedTheme=t.computed(function(){return!!o()}),d.isEditingLocalizedTheme.subscribe(function(){setTimeout(function(){s.resize()},1)})}var p;return p=function(){var e=d.getDataModel(),t=l.themeLocale,n=e.website.backgroundsettings,i=new u(n,t);return s.show({elementViewModel:i,showInMiddle:!0}),i},{mutate:p}}),define("modules/domainSelector/domainSelector",["jquery","common/stats/googleanalytics","wsbcore/tipper","wsbcore/alerts"],function(e,t){function n(n){var i=e("#availableContainer"),a=e("#externalContainer"),r=e("#subDomainContainer"),o=e(n.target).val();m(),i.hide(),a.hide(),r.hide(),"available"===o?(t.trackEvent("dashboard_settings_domain","mydomain","radio"),i.show(),d()):"external"===o?(t.trackEvent("dashboard_settings_domain","domain_registered_elsewhere","radio"),a.show(),u()):"subdomain"===o&&(t.trackEvent("dashboard_settings_domain","subdomain","radio"),r.show(),p()),b&&!b.autoResize&&setTimeout(function(){e("#dlgDomainSettings").sfDialog("resize")},500)}function i(e){_=!0,e.stopImmediatePropagation()}function a(){d()}function r(){u()}function o(){c()}function s(){p()}function l(){var t=e("#lstAllDomainsList");return g(t,!1)}function d(t){return g(e("#lstDomain"),t)}function c(){var t=e("#txtDomain");if(t.val().length>0){var n=e.trim(t.val());return-1!==w.indexOf(n.toLowerCase())?(h(e("#template-domainselector-domain-in-use").html()),t.addClass("input-validation-error"),!1):(t.removeClass("input-validation-error"),m(),!0)}return!0}function u(t){var n=e("#txtDomain");if(n.val().length>0||v){v=!0;var i=/[!@#$%^&*(){}<>\s]/,a=e.trim(n.val());return i.test(a)?(t||(h(e("#template-domainselector-validdomain").html()),n.addClass("input-validation-error")),!1):(n.removeClass("input-validation-error"),m(),!0)}return!0}function p(t){var n=e("#txtSubdomain");if(n.val().length>0||y){y=!0;var i=/[!@#$%^&*(){}<>]/,a=e.trim(n.val());return a?i.test(a)?(t||(h(e("#template-domainselector-validsubdomain").html()),n.addClass("input-validation-error")),!1):(n.removeClass("input-validation-error"),m(),!0):(t||(h(e("#template-domainselector-validsubdomain").html()),n.addClass("input-validation-error")),!1)}return!0}function g(t,n){return _?t.val()?(t.removeClass("input-validation-error"),m(),!0):(n||(h(e("#template-domainselector-required").html()),t.addClass("input-validation-error")),!1):(m(),!0)}function h(t){e("#dsErrorMessage").sfAlert({style:"error",message:t}),b&&!b.autoResize&&e("#dlgDomainSettings").sfDialog("resize")}function m(){e(".input-validation-error").removeClass("input-validation-error"),e("#dsErrorMessage").sfAlert("close"),b&&!b.autoResize&&setTimeout(function(){e("#dlgDomainSettings").sfDialog("resize")},500)}var b,f=!1,v=!1,y=!1,_=!1,w=[];return b={init:function(){if(!f){var t=e("#domainTip"),d=e("#lstDomain"),c=e("#txtDomain"),u=e("#txtSubdomain"),p=e("#lstAllDomainsList"),g=[];t.sfTipper({content:t.data("content")}),e("input[name='domainChoice']").on("click",n),d.off().on("click",i),d.on("change",a),c.on("input",r),c.on("change",o),u.on("input",s),p.on("change",l),e("#lstDomain option").each(function(e,t){t.value&&g.push(t.value.toLowerCase())}),w=[],e("#lstAllDomainsList option").each(function(e,t){t.value&&-1===g.indexOf(t.value.toLowerCase())&&w.push(t.value.toLowerCase())}),f=!0}},value:function(){var t=e("input:radio[name='domainChoice']:checked").val(),n=e("#lstDomain"),i=e("#txtDomain"),a=e("#txtSubdomain"),r=e("#lstAllDomainsList");if("available"===t)return d(!1)?n.val():"";if("external"===t){if(u(!1)){var o=e.trim(i.val().replace(/^www\./,""));return i.val(o),o}return""}return"subdomain"===t?p(!1)?e.trim(a.val())+"."+r.val():"":void 0},validate:function(){var t=e("input:radio[name='domainChoice']:checked").val();if("available"===t)return d();if("external"===t)return u();if("subdomain"===t){var n=p();if(!n)return n;var i=e("#lstAllDomainsList");return g(i,!1)}},hideError:m,showError:function(e){h(e)},currentState:function(){var t=e("input[name='domainChoice']:checked"),n=e("#lstDomain"),i=e("#txtDomain"),a=e("#txtSubdomain"),r=e("#lstAllDomainsList");return{domainChoice:t.val(),lstDomainVal:n.val(),txtDomainVal:i.val(),txtSubdomainVal:a.val(),lstAllDomainsListVal:r.val()}},setKeyPressed:function(){v=!0,y=!0,_=!0},resetState:function(t){var n=e("#lstDomain"),i=e("#txtDomain"),a=e("#txtSubdomain"),r=e("#lstAllDomainsList"),o=e("#availableContainer"),s=e("#externalContainer"),l=e("#subDomainContainer"),d=t.domainChoice;n.val(t.lstDomainVal),i.val(t.txtDomainVal),a.val(t.txtSubdomainVal),r.val(t.lstAllDomainsListVal),o.hide(),s.hide(),l.hide(),v=!1,y=!1,"available"===d?(e("input[name='domainChoice'][value=available]").attr("checked",!0),o.show()):"external"===d?(e("input[name='domainChoice'][value=external]").attr("checked",!0),s.show()):"subdomain"===d&&(e("input[name='domainChoice'][value=subdomain]").attr("checked",!0),l.show()),b&&!b.autoResize&&setTimeout(function(){e("#dlgDomainSettings").sfDialog("resize")},500)},autoResize:!0}}),define("modules/welcome/welcomeViewModel",["knockout","strings"],function(e,t){var n=function(){var n=this;return n.visible=e.observable(!1),n.Strings={Welcome_Modal_Header1:t.Welcome_Modal_Header1,Welcome_Modal_Header2:t.Welcome_Modal_Header2,Select_from_themes:t.Select_from_themes,Customize_it:t.Customize_it,Click_Publish:t.Click_Publish,Need_help:t.Need_help},n.formattedHelpText=function(){var e='<a href="/help/support" target="_blank data-aid="welcome-modal-support-link">'+t.Customer_Support+"</a>",n=t.Do_not_hesitate.replace("{0}","").replace("{1}",e);return n}(),n};return n}),define("text!modules/welcome/welcome.html",[],function(){return'<div id="welcome-modal-container" class="welcome-modal-container" style="display: none" data-bind="visible: visible">\r\n    <div class="welcome-modal-header-container">\r\n        <div class="welcome-modal-header-one" data-bind="text: Strings.Welcome_Modal_Header1"></div>\r\n        <div class="welcome-modal-header-two" data-bind="text: Strings.Welcome_Modal_Header2"></div>\r\n    </div>\r\n    <div class="welcome-modal-steps-container">\r\n        <div class="welcome-modal-images-container">\r\n            <div class="welcome-modal-step-one-image"></div>\r\n            <div class="welcome-modal-step-two-image"></div>\r\n            <div class="welcome-modal-step-three-image"></div>\r\n        </div>\r\n        <div class="welcome-modal-image-descriptions-container">\r\n            <div class="welcome-modal-image-description-one" data-bind="text: Strings.Select_from_themes"></div>\r\n            <div class="welcome-modal-image-description-two" data-bind="text: Strings.Customize_it"></div>\r\n            <div class="welcome-modal-image-description-three" data-bind="text: Strings.Click_Publish"></div>\r\n        </div>\r\n    </div>\r\n    <div class="welcome-modal-help-container">\r\n        <div class="welcome-modal-help-image-container">\r\n            <div class="welcome-modal-help-image"></div>\r\n        </div>\r\n        <div class="welcome-modal-help-text-container">\r\n            <div class="welcome-modal-need-help">\r\n                <span data-bind="text: Strings.Need_help"></span>\r\n            </div>\r\n            <div>\r\n                <span data-bind="html: formattedHelpText"></span>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class="welcome-modal-help-container-clear"></div>\r\n</div>'}),define("modules/welcome/welcomeDialog",["knockout","jquery","strings","websiteInfo","websiteSettings","common/abTesting/abTesting","common/browser/browser","modules/welcome/welcomeViewModel","common/ui/dialog","common/persistence/persistence","common/logger/serverLogger","common/metrics/productMetrics","common/stats/googleanalytics","text!modules/welcome/welcome.html","appconfig"],function(e,t,n,i,a,r,o,s,l,d,c,u,p,g,h){function m(){var i,l=this,m=t(g),b=t("<div></div>");b.append(m),t("body").append(b);var f=s(),v=function(){p.trackEvent("wsb-free-trial-welcome-modal","select-theme"),c.post({action:"freeTrialWelcomeModalSelectTheme"},c.level.Information),u.send("WelcomeModalSelectTheme",null,{action:"Select Theme"},!0),_()},y=function(){p.trackEvent("wsb-free-trial-welcome-modal","come-back-later"),c.post({action:"freeTrialWelcomeModalComeBackLater"},c.level.Information),u.send("WelcomeModalComeBackLater",null,{action:"Come Back Later"},!0),_(),o.window.location.href=h.MyaUrl+"group=15"},_=function(){var e=(new Date).toISOString();d.Post("/api/websites/{websiteId}/websitesettings",{WelcomeModalDismissDate:e}),a.WelcomeModalDismissDate=e,b&&b.wsbDialog("close")};return i=t("#welcome-modal-container")[0],e.applyBindings(f,i),l.shouldShowDialog=function(){var e=r.isEnabled("welcomeDialog");return e&&!a.templateId&&!a.WelcomeModalDismissDate},l.showDialog=function(){if(!l.shouldShowDialog()){var e=!!a.templateId;return void(e||(u.send("WelcomeModalBypassed",null,null,!0),p.trackImpression("setup","hide_welcome_modal","impression")))}p.trackEvent("wsb-free-trial-welcome-modal","show-dialog"),c.post({action:"freeTrialWelcomeModalShown"},c.level.Information),u.send("WelcomeModalShow"),p.trackImpression("setup","show_welcome_modal","impression"),b.wsbDialog({id:"welcome-modal-dialog",title:n.Welcome_To_Website_Builder,autoResize:!0,zIndex:1e5,destroyOnClose:!0,onOpen:function(){f.visible(!0)},onClose:function(){f.visible(!1)},buttons:[{text:n.Select_Theme,onClick:v},{text:n.Come_back_later,cancel:!0,onClick:y}]})
},l}var b;return{getInstance:function(){return b||(b=new m),b}}}),define("modules/controlPanel/domainSettingsDialog",["jquery","common/logger/logger","userData","websiteInfo","/i18n/resources/client","common/api/websites/websitesAPI","modules/domainSelector/domainSelector","modules/welcome/welcomeDialog","common/stats/googleanalytics","common/persistence/persistence","common/alertbox/alertbox","wsbcore/alerts","wsbcore/overlay"],function(e,t,n,i,a,r,o,s,l,d,c){function u(e,t){d.Get("/controlpanel/domainsettingsdialog",e,t),_.isFetching=!0}function p(t){_.websiteId=n.websiteId,_.orionAccountUid=n.orionUid,_.domain=i.Account.Domain,_.domainSelectorState=null,w.title=a.resources.Server__Domain_settings_titlecase,w.buttons=[],w.buttons.push({id:"ok",text:a.resources.OK,onClick:function(){l.trackEvent("dashboard_settings_domain","ok","button"),v()}}),_.settings=e.extend(!0,w,t),_.settings.showCancelButton===!0&&_.settings.buttons.push({text:a.resources.Cancel,cancel:!0}),o.autoResize=_.settings.autoResize,_.isInitialized=!0,h()}function g(e){p(e),_.errorCount=0}function h(){return y?y.sfDialog("open"):(y||(y=e('<div id="dlgDomainSettings" class="domain-selector"></div>').appendTo("body")),y.wsbDialog({title:_.settings.title,cancelDisabled:_.settings.cancelDisabled,closeOnEscape:_.settings.closeOnEscape,autoResize:_.settings.autoResize,buttons:_.settings.buttons,destroyOnClose:!1,load:_.settings.load,onLoad:function(t){e(".sf-dialog-content").sfMsgOverlay({message:null}),_.settings.subtitle&&e("#domain-subtitle").html(_.settings.subtitle),_.settings.showLinks===!0&&e(".domain-settings-links").show(),_.settings.autoResize||y.sfDialog("resize"),e(".sf-dialog-content",t).sfMsgOverlay({message:a.resources.Loading})},onOpen:function(){_.domainSelectorState=o.currentState(),window.location.hash="domainsetup",_.settings.autoResize||y.sfDialog("resize")},onCancel:function(){var e=arguments[0]?"cancel_modal":"closeout_modal",t=arguments[0]?"link":"icon";l.trackEvent("dashboard_settings_domain",e,t)},onClose:function(){e("#status").sfAlert("close"),o.hideError(),window.location.hash="",_.settings&&"noDomain"===_.settings.from?setTimeout(function(){e("#headerPublishButton").click()},110):setTimeout(function(){s.getInstance().showDialog()},100)}}),void(_.isFetching=!1))}function m(){var t=e("#dlgDomainSettings");b(),t.wsbDialog("close")}function b(){e("#status").sfAlert("close"),_.settings.autoResize||e("#dlgDomainSettings").sfDialog("resize")}function f(t,n){n?o.showError(t):(_.errorCount++,_.errorCount<3?(e("#status").sfAlert({style:"error",message:e("#template-domainselectordialog-error").html()}),e("#domainsettingsdialog-errorlink").click(function(){return l.linkAnchor(e(this))})):(e("#status").sfAlert({style:"error",message:e("#template-domainselectordialog-finalerror").html()}),e("#domainsettingsdialog-finalerrorlink").click(function(){return l.linkAnchor(e(this))}))),_.settings.autoResize||e("#dlgDomainSettings").sfDialog("resize")}function v(){o.setKeyPressed();var t=o.value().length>0&&o.validate();if(t){var n=_.settings.onDomainChanged,a=o.value(),s=o.currentState()||{},l={OrionAccountUid:_.orionAccountUid,DomainName:a,DomainType:s.domainChoice};if(a.toLowerCase()===_.domain.toLowerCase())return void m();e(".sf-dialog-content").sfMsgOverlay({message:e("#template-domainselectordialog-processing").html()}),d.Post("/api/websites/"+_.websiteId+"/websitedomain",l,function(){_.domain=a,i.Account.Domain=_.domain,"function"==typeof i.ko.domain&&i.ko.domain(_.domain),n&&n(a),e(".sf-dialog-content").sfMsgOverlay({message:null}),m(),r.seoProjectReplay(a,"wsb-domain-settings-dialog")},function(t,n){var i,a;e(".sf-dialog-content").sfMsgOverlay({message:null}),"timeout"===n?(i=e("#template-domainselectordialog-timeout").html(),a=!0):(i=JSON.parse(t.responseText).Message,a=JSON.parse(t.responseText).Display),f(i,a)},!0,{},_.settings.timeout)}}var y,_={},w={load:"/controlpanel/domainsettingsdialog",onDomainChanged:null,title:"",subtitle:"",cancelDisabled:!1,closeOnEscape:!1,autoResize:!0,showLinks:!0,showCancelButton:!0,timeout:2e4};_.isInitialized=!1,_.errorCount=0;var S={init:g,updateDomain:v,loadView:function(){_.isViewLoaded||_.isFetching||u(onViewLoadSuccess)}};return S}),define("designer/wsb/introVideo/introVideo",["jquery","knockout","userData","common/persistence/persistence","/i18n/resources/client","common/logger/serverLogger","websiteSettings","common/abTesting/abTesting","common/stats/googleanalytics","common/metrics/productMetrics"],function(e,t,n,i,a,r,o,s,l,d){function c(){p?(p.isVisible(!0),e(document).off("keyup",p.documentOnKeyUp).on("keyup",p.documentOnKeyUp)):require(["text!/Designer/IntroVideo","css!designer/wsb/introVideo/introVideo.css"],function(n){var i=e(n).appendTo("body");p=new u,t.applyBindings(p,i[0]),e(document).off("keyup",p.documentOnKeyUp).on("keyup",p.documentOnKeyUp)})}function u(){var n=this;this.isVisible=t.observable(!0),this.closevideo=function(){l.trackEvent("designer","close_video_button","click"),this.close()},this.closexicon=function(){l.trackEvent("designer","close_video_xicon","click"),this.close()},this.close=function(){n.isVisible(!1),e(document).off("keyup",n.documentOnKeyUp),i.Post("/api/websites/{websiteId}/websitesettings",{ChalkOverlayDismissDate:(new Date).toISOString()}),r.logFirstClick("introVideo",{action:"close"})},this.documentOnKeyUp=function(e){27===e.keyCode&&n.close()}}var p=null,g=/^en-/i.test(a.locale);return o.ChalkOverlayDismissDate||!g||n.isReseller||(s.isEnabled("introVideo")?(l.trackImpression("designer","show_welcome_video","impression"),d.send("ShowIntroVideo",null,null,!0),c()):(l.trackImpression("designer","hide_welcome_video","impression"),d.send("HideIntroVideo",null,null,!0))),{isSupported:g,show:c}}),define("common/seoEnabled/seoLocales",[],function(){function e(e,t){var n=!1,i=t.LangAllowed;if(null!=i&&i.length>0)for(var a=0;a<i.length;a++)(e==i[a]||"ALL"==i[a])&&(n=!0);return n}function t(e,t){var n=!1,i=t.LocaleAllowed;if(null!=i&&i.length>0)for(var a=0;a<i.length;a++)(e==i[a]||"ALL"==i[a])&&(n=!0);return n}function n(e,t){var n=!1,i=t.LocaleExcluded;if(null!=i&&i.length>0)for(var a=0;a<i.length;a++)e==i[a]&&(n=!0);return n}function i(e,t,n){var i=this.isLanguageInAcceptedList(e,n),a=this.isLocaleInAcceptedList(t,n),r=!a||this.isLocaleInExcludedList(t,n);return i&&!r}return{isLanguageInAcceptedList:e,isLocaleInAcceptedList:t,isLocaleInExcludedList:n,isCustomerInAllowedLocale:i}}),define("common/seoEnabled/seoEnabled",["common/abTesting/abTesting","/i18n/resources/client","appconfig","websiteInfo","userData","common/seoEnabled/seoLocales"],function(e,t,n,i,a,r){function o(e){return e===!0||"true"===e||"True"===e}function s(e,t){return c?!1:(t=t||n,a.isFreeTrialAccount?!1:this.isCustomerInAllowedLocale()?!e||"unknown"===e.toLowerCase()||t.disableSeoForDpsSubdomains&&new RegExp(t.dpsSubdomain+"$","i").test(e)?!1:!0:!1)}var l="enabled"===e.getOption("seoEditor"),d=e.getOptionAllData("seoEditor"),c=a.isApiReseller&&i.Account.AccountType<30,u=function(){if(c)return!1;var e=o(n.seoModeConfig.SeoDateCheckIsEnabled);return this.isShopperInOverride()?l&&this.isCustomerInAllowedLocale():d.ThreeLetterOptionSelected&&a.shopperId.length<4?l&&this.isCustomerInAllowedLocale():e?this.isNewCustomerToWSB()?l&&this.isSeoIncludedInAccountPlan()&&this.isCustomerInAllowedLocale():!1:l&&this.isSeoIncludedInAccountPlan()&&this.isCustomerInAllowedLocale()},p=function(){var e=!1;if(null!=d.ShopperOverrides&&d.ShopperOverrides.length>0)for(var t=0;t<d.ShopperOverrides.length;t++)d.ShopperOverrides[t]==a.shopperId&&(e=!0);return e},g=function(){var e=new Date(i.CreateDate),t=new Date(n.seoModeConfig.SeoDateCheckDateValue);return e>t},h=function(){return r.isCustomerInAllowedLocale(t.lang,t.locale,n.seoModeConfig)},m=function(){var e=n.seoModeConfig.AccountTypesAllowed,t=i.Account,a=i.accountTypes,r=!1;if(null!=e&&e.length>0)for(var o=0;o<e.length;o++)t.AccountType==a[e[o]]&&(r=!0);return r};return{isEnabled:u,isValid:s,isShopperInOverride:p,isNewCustomerToWSB:g,isSeoIncludedInAccountPlan:m,isCustomerInAllowedLocale:h}}),define("text!designer/app/builder/ui/controls/hamburgerFlyOut/hamburgerFlyOut.html",[],function(){return'<div class="wsb-actionbar-actions-flyout-list-container clearfix" data-bind="visible: visible, style: { top: topPosition }">\r\n    <div class="wsb-actionbar-actions-flyout-bubble-arrow"></div>\r\n    <div class="wsb-actionbar-actions-flyout-list-inner-container clearfix">\r\n        <div class="wsb-actionbar-designer-actions-container" data-bind="foreach: { data: sections, as: \'section\' }">\r\n            <ul class="wsb-actionbar-designer-actions" data-bind="foreach: { data: section, as: \'actionModel\' }">\r\n                <li data-bind="hamburgerFlyoutItem: actionModel"></li>\r\n            </ul>\r\n            <hr class="hamburger-flyout-item-separator" />\r\n        </div>\r\n    </div>\r\n</div>'}),define("designer/app/builder/ui/controls/hamburgerFlyOut/hamburgerFlyOut",["designer/app/event","jquery","designer/app/app","userData","designer/app/builder/data/data","designer/app/builder/managers/addressManager","designer/app/builder/managers/themeManager","designer/app/builder/ui/uiHelper","designer/app/builder/ui/controls/siteSettings/siteSettings","designer/app/builder/ui/controls/gridGuides/gridGuidesFlyout","designer/app/builder/ui/controls/hamburgerFlyOut/hamburgerFlyoutItem/hamburgerFlyoutItem","designer/app/builder/ui/controls/hamburgerFlyOut/page","designer/app/builder/ui/controls/hamburgerFlyOut/site","modules/controlPanel/domainSettingsDialog","lodash","knockout","wsbcore/tipper","strings","designer/wsb/introVideo/introVideo","common/abTesting/abTesting","common/seoEnabled/seoEnabled","common/inAppPurchase/inAppPurchase","text!designer/app/builder/ui/controls/hamburgerFlyOut/hamburgerFlyOut.html"],function(e,t,n,i,a,r,o,s,l,d,c,u,p,g,h,m,b,f,v,y,_,w,S){function k(e){var t=this;t.visible=m.observable(!1),t.topPosition=m.observable("0"),t.allLocked=m.observable(!1),t.Strings={DomainSettingsTitle:f.Server__Domain_settings,DomainSettings:f.Server__Domain_settings,UnlockLayersTitle:f.Client__Designer__DesignerActionsFlyout_UnlockLayersTitle,UnlockLayers:f.Client__Designer__DesignerActionsFlyout_UnlockLayers,LockLayersTitle:f.Client__Designer__DesignerActionsFlyout_LockLayersTitle,LockLayers:f.Client__Designer__DesignerActionsFlyout_LockLayers,GridGuidesTitle:f.Client__Designer__DesignerActionsFlyout_GridGuidesTitle,GridGuides:f.Client__Designer__DesignerActionsFlyout_GridGuides,SiteSettingsTitle:f.Client__Designer__DesignerActionsFlyout_SiteSettingsTitle,Settings:f.Site_Settings,SocialBranding:f.Client_SocialBranding_MenuButtonLabel,SEOWizard:f.SEOWizard,ShowTipsTitle:f.Client__Designer__DesignerActionsFlyout_ShowTipsTitle,ShowTips:f.Client__Designer__DesignerActionsFlyout_ShowTips,Help:f.Help,ExitTitle:f.Exit_Designer,Exit:f.Exit_Designer,Background:f.Background,PageSettings:f.Client__Designer__Canvas_PageSettings},t.introVideoSupported=v.isSupported,t.seoSupported=_.isEnabled(),t.isReseller=i.isReseller,t.isSiteSettingVisible=!o.isThemeEditMode,t.onDomainSettingsClick=function(){return t.visible(!1),A?domainSelector.open():g.init({onDomainChanged:function(){return!0},showLinks:!1}),!0},t.onSettingsClick=function(){return t.visible(!1),l.show(),!0},t.onPageSettingsClick=function(){return t.visible(!1),u.mutate(),!0},t.onSeoWizardClick=function(){t.visible(!1),I.save(),t.seoSupported?E.address.currentAction(r.actions.seo):w.ShowUpgradeDialog({clientTrackingId:M,clientTrackingValue:"seo"})},t.toggleLockingOfLayers=function(){var e=!t.allLocked();t.visible(!1),s.setLockStateForAllElementsOnPage(e),t.allLocked(e)},t.onGridGuidesClick=function(){return t.visible(!1),d.visible(!0),!0},t.onBackgroundClick=function(){return t.visible(!1),p.mutate(),!0},t.onShowTipsClick=function(){t.visible(!1),v.show()},t.onShowHelpClick=function(){t.visible(!1),I.save(),C.open(D.helpPath)},t.onExitClick=function(){t.visible(!1),I.save(),P.body.fadeOut("slow",function(){C.location=D.exitPath})},t.sections=[[{className:"settings",dataAidName:"sitesettingsbutton",title:t.Strings.SiteSettingsTitle,text:t.Strings.Settings,onClickAction:t.onSettingsClick,visible:t.isSiteSettingVisible,ga:{event:"trackEvent",args:["designer_managesite","site_settings","button"]}},{className:"page",dataAidName:"pagesettingsbutton",title:t.Strings.PageSettings,text:t.Strings.PageSettings,onClickAction:t.onPageSettingsClick,ga:{event:"trackEvent",args:["designer_managesite","page_settings","button"]}}],[{className:"lock",dataAidName:"lockbutton",title:t.Strings.LockLayersTitle,text:t.Strings.LockLayers,onClickAction:t.toggleLockingOfLayers,visible:m.computed(function(){return!t.allLocked()}),ga:{event:"trackEvent",args:["designer_managesite","lock_layers","button"]}},{className:"unlock",dataAidName:"unlockbutton",title:t.Strings.UnlockLayersTitle,text:t.Strings.UnlockLayers,onClickAction:t.toggleLockingOfLayers,visible:m.computed(function(){return t.allLocked()}),ga:{event:"trackEvent",args:["designer_managesite","unlock_layers","button"]}},{className:"grid",dataAidName:"gridguidesbutton",title:t.Strings.GridGuidesTitle,text:t.Strings.GridGuides,onClickAction:t.onGridGuidesClick,ga:{event:"trackEvent",args:["designer_managesite","grid_guide","button"]}}],[{className:"background",dataAidName:"backgroundbutton",title:t.Strings.Background,text:t.Strings.Background,onClickAction:t.onBackgroundClick,ga:{event:"trackEvent",args:["designer_managesite","background","button"]}},{className:"tips",dataAidName:"helpbutton",title:t.Strings.ShowTipsTitle,text:t.Strings.ShowTips,onClickAction:t.onShowTipsClick,visible:t.introVideoSupported&&!t.isReseller,ga:{event:"trackEvent",args:["designer_managesite","show_tips","button"]}},{className:"support",dataAidName:"supportbutton",title:t.Strings.Help,text:t.Strings.Help,onClickAction:t.onShowHelpClick,ga:{event:"trackEvent",args:["designer_managesite","show_help","button"]}},{className:"exit",dataAidName:"exitbutton",title:t.Strings.ExitTitle,text:t.Strings.Exit,onClickAction:t.onExitClick,ga:{event:"trackEvent",args:["designer_managesite","exit","button"]}}]],_.isValid(e.info.Account.Domain,e.config)&&t.sections[0].push({className:"seo",dataAidName:"siteseowizardbutton",title:t.Strings.SEOWizard,text:t.Strings.SEOWizard,onClickAction:t.onSeoWizardClick,ga:{event:"trackEvent",args:["designer_managesite","seo_wiz","button"]}})}function x(e){if(e&&e.target){var n=t(e.target);n.closest("#hamburger-container,#hamburger-flyout").length||T.visible(!1)}}var C,T,E,P={},D={exitPath:"/designer/exit",helpPath:"/help/support",seoPath:"/seo",socialPath:"/social"},I=a.saver,A="enabled"===y.getOption("newDomainSelector"),M="wsb-designer-menu-flyout",O=function(i,r,o,s){n.addControl(S,"builder","hamburger-flyout"),P.container=r.find("#hamburger-flyout"),E=a.getDataModel(),T=new k(E),m.applyBindings(T,P.container[0]),P.container.sfTipper({wireup:!0}),P.body=o||t("body"),C=s||window,e.on(e.events.flyoutClose,function(e){x(e)}),i&&i(null,"hamburgerFlyOut",T)};return{load:O,getConfiguration:function(){return D},visible:function(e,t){return t&&T.topPosition(t),void 0===e?T.visible():void T.visible(e)}}}),define("text!designer/app/builder/ui/header/hamburger/hamburger.html",[],function(){return'<div id="hamburger-container" data-bind="visible: visible">\r\n  <a class="header-icon hamburger sf-tip sf-tipper-target" data-style="qt" data-aid="exitflyout-openclosebutton" data-bind="attr: { \'data-content\': i18n.ManageSite }, click: showOptions, ga: { click: { category: \'designer_header\' , action:\'manage_site\', label: \'button\' } }"></a>\r\n</div>\r\n'}),define("designer/app/builder/ui/header/hamburger/hamburger",["jquery","lodash","knockout","wsbcore/tipper","/i18n/resources/client","common/stats/googleanalytics","common/logger/serverLogger","designer/app/builder/ui/controls/hamburgerFlyOut/hamburgerFlyOut","designer/app/builder/data/data","text!designer/app/builder/ui/header/hamburger/hamburger.html"],function(e,t,n,i,a,r,o,s,l,d){function c(e){var t=this,n=a.resources;t.visible=e.address.isEditAction,t.toggleFlyout=function(){s.visible(!s.visible(),u.appHeader.offset().top+u.appHeader.height()+10+"px")},t.showOptions=function(){t.toggleFlyout(),o.logFirstClick("hamburger")},t.i18n={ManageSite:n.Client__Designer__DesignerActionsFlyout_ManageSite}}var u={},p="#hamburger-container",g=function(e,t){u.header=e.append(d),u.appHeader=u.header.closest("#app-header"),u.container=e.children(p);var i=l.getDataModel(),a=new c(i);return n.applyBindings(a,u.container[0]),u.container.sfTipper({wireup:!0}),t&&t(null,"hamburger"),a};return{load:g}}),define("text!designer/app/builder/ui/header/preview/preview.html",[],function(){return'<div class="header-preview-button">\r\n    <a class="btn btn-inverse-grey wsb-action-preview"\r\n       data-aid="ab-exitpreview"\r\n       data-bind="click: onClick">\r\n        <i data-bind="css: { \'icon-wsb-white icon-x\': isPreviewAction, \'icon-white icon-search\': isEditAction }"></i>\r\n        <span data-bind="text: buttonText"></span>\r\n    </a>\r\n</div>\r\n'}),define("designer/app/builder/ui/header/preview/preview",["jquery","designer/app/builder/data/data","designer/app/builder/managers/addressManager","common/logger/serverLogger","/i18n/resources/client","lodash","knockout","text!designer/app/builder/ui/header/preview/preview.html","common/stats/googleanalytics"],function(e,t,n,i,a,r,o,s,l){function d(){var t=this,r=c.address;t.isPreviewAction=r.isPreviewAction,t.isEditAction=r.isEditAction,t.buttonText=o.computed(function(){return t.isPreviewAction()||r.currentAction()==n.actions.social?a.resources.Server__Exit_preview:r.isSeoAction()?a.resources.Exit:a.resources.Server__Preview}),t.onClick=function(){var a,o;i.logFirstClick("preview");var s=t.isPreviewAction()||r.currentAction()===n.actions.social||r.isSeoAction();if(s){a="exit",o="preview";var d=e('[data-datetime-type="date"]');d&&d.length?(e.each(e(d),function(t,n){e(n).sfDatePicker("hide")}),setTimeout(function(){r.currentAction(n.actions.edit)},50)):r.currentAction(n.actions.edit)}else a="preview",o="designer_header",r.currentAction(n.actions.preview);return l.trackEvent(o,a,"button"),!1}}var c,u=function(e,n){var i=e.append(s);c=t.getDataModel();var a=new d;return o.applyBindings(a,i[0]),n&&n(null,"preview"),a};return{load:u}}),define("designer/netpromoter/surveyViewModel",["knockout","common/stats/googleanalytics"],function(e,t){var n=function(n){function i(e){var t,n=[];for(t=0;e>=t;t++)n[t]={value:t,text:t.toString()};return n}var a,r,o=this;n=n||{},o.SurveyId=e.observable(n.SurveyId||0),o.SelectedRating=e.observable(null),o.Feedback=e.observable(null),o.CanSave=e.computed(function(){var e=o.SelectedRating();return void 0!==e&&null!==e}),o.Ratings=e.observableArray(i(10)),a=n.onSave,r=n.onCancel,o.reset=function(){o.SelectedRating(null),o.Feedback(null)},o.save=function(){o.CanSave()!==!1&&(t.trackEvent("wsb-designer-survey-netpromoter","submit"),"function"==typeof a&&a())},o.cancel=function(){t.trackEvent("wsb-designer-survey-netpromoter","cancel"),"function"==typeof r&&r()},o.getSubmissionData=function(){var e=o.SelectedRating(),t=o.Feedback(),n=o.SurveyId();return"string"==typeof e&&(e=parseInt(e,10)),{Rating:e,Feedback:t,SurveyId:n}}};return n}),define("designer/netpromoter/netpromoter",["jquery","knockout","/i18n/resources/client","appconfig","websiteSettings","userData","designer/netpromoter/surveyViewModel","common/abTesting/abTesting","common/logger/logger","common/stats/googleanalytics","designer/app/app","designer/app/builder/data/designerData","designer/app/builder/managers/addressManager","common/logger/serverLogger","common/browser/browser","wsbcore/tipper"],function(e,t,n,i,a,r,o,s,l,d,c,u,p,g,h){var m=function(){function m(){I&&"true"!==(a.NetPromoterFeedbackSubmitted||"").toString().toLowerCase()&&require(["text!/survey/netpromoter"],function(n){var i,a=e(S.surveySelector),r=!0,o=".sf-tip";if(0===a.length)e(S.surveyContainer).replaceWith(n),a=e(S.surveySelector),r=!1;else if("none"!==a.css("display"))return;w.reset(),r===!1&&t.applyBindings(w,a[0]),a.show(),window.setTimeout(function(){i=a.height(),e(o).sfTipper({close:!0}),a.find(o).each(function(){var t=e(this);t.sfTipper({wireup:!0,target:t.find(".sf-tip-target")})}),a.css("top","-"+i+"px"),e(S.surveySelector+","+S.elementsToSlideSelector).animate({top:"+="+i},T)},10)})}function b(){var t=e(S.surveySelector);e(S.surveySelector+","+S.elementsToSlideSelector).animate({top:"-="+t.height()},T,function(){t.hide()})}function f(t){var n=k.replace("{websiteId}",r.websiteId).replace("{surveyId}",w.SurveyId()),i=w.getSubmissionData();i.Feedback=i.Feedback||"",i.Feedback+="\n\npublished from: "+window.location.href,e.ajax({url:n,type:"POST",data:i,dataType:"json",accepts:{json:"application/json"},success:function(e){"function"==typeof t&&t({success:!0,response:e})},error:function(e,n,i){var a="Error submitting netPromoter survey, msg: "+i;l.log(a),"function"==typeof t&&t({errorMessage:a})}}),g.post({surveyData:i,url:window.location.href},g.level.Information,!0,!0)}function v(e){if(void 0!==e&&null!==e&&"en"===(n.locale||"").toLowerCase().substring(0,2)&&1==r.resellerId){var t=C+"?email="+e+"@godaddy.com";window.wsb.gotoAddress("","zuberance",{url:t,returnPath:p.getCurrentPath()})}}function y(i){require(["text!/survey/netpromoterfeedback"],function(a){var r=e(S.feedbackDialogSelector);0===r.length&&(e("body").append(a),r=e(S.feedbackDialogSelector)),t.applyBindings(w,r[0]),r.wsbDialog({title:n.resources.Survey__NetPromoter_FeedbackDialogTitle,autoResize:!0,buttons:[{id:"netpromoter-feedback-dlg-send",text:n.resources.Send,attributes:{"data-aid":"netpromoter-feedback-dlg-send"},onClick:function(){return r.wsbDialog("close"),d.trackEvent("wsb-designer-survey-netpromoter","feedback-submit"),"function"==typeof i&&i(),!1}},{id:"netpromoter-feedback-dlg-cancel",cancel:!0,text:n.resources.Cancel,attributes:{"data-aid":"netpromoter-feedback-dlg-cancel"},onClick:function(){return r.wsbDialog("close"),d.trackEvent("wsb-designer-survey-netpromoter","feedback-cancel"),"function"==typeof i&&i(),!1}}],onClose:function(e,t){t&&(d.trackEvent("wsb-designer-survey-netpromoter","feedback-close"),"function"==typeof i&&i())}})})}function _(){a.NetPromoterFeedbackSubmitted="True",u.updateWebsiteSettings({NetPromoterFeedbackSubmitted:"True"}).fail(function(){l.log("Error storing website setting 'NetPromoterFeedbackSubmitted'")})}var w,S,k="/api/websites/{websiteId}/netpromoter/{surveyId}",x=i.PQCSurveyId_NetPromoter||0,C=i.ZuberanceUrl,T=400,E=8,P=s.getOption("netPromoter.state"),D="enhanced"===P,I=D||"standard"===P,A=function(){S={surveyContainer:"#builder-survey",surveySelector:"#js-netpromoter-flyout",elementsToSlideSelector:"#app-header,#app-webapps,#builder-toolbox",feedbackDialogSelector:"#js-netpromoter-feedback-dlg"},S.zuberanceIframe=e(S.zuberanceIframeSelector),h.msie&&(S.elementsToSlideSelector=S.elementsToSlideSelector+",#wsb-notice")};w=new o({SurveyId:x,onSave:function(){var e=w.getSubmissionData();if(e.Rating>=E)f(function(e){_(),D===!0&&void 0!==e&&null!==e&&void 0!==e.response&&null!==e.response&&v(e.response.RedirectGuid)}),b();else{var t=function(){f(function(){_()})};D===!0?y(t):t(),b()}},onCancel:function(){_(),b()}});var M={survey:w,initModule:function(){c.addControl("<div />","builder","builder-survey"),A()},showSurvey:function(){try{m()}catch(e){l.log("Error showing netPromoter survey")}}};return M}();return m}),define("common/socialPageManager/socialPageManager",["lodash","eventemitter","jquery","knockout","strings","websiteInfo","/i18n/resources/client","common/inAppPurchase/inAppPurchase","common/stats/googleanalytics","common/persistence/persistence"],function(e,t,n,i,a,r,o,s,l,d){function c(){C=3===r.Account.ShopperId.length,x=p()}function u(){return e.once(function(t,i){i.on("connect",e.bind(b,null,"TwitterConnectPage",null,null)),i.on("connected",e.bind(b,null,"TwitterComparePage")),i.on("compare",e.bind(b,null,"TwitterComparePage")),i.on("disconnect",e.bind(i.showDisconnectModal,i)),i.on("disconnected",h),i.on("preview",e.bind(b,null,"TwitterEditPage",null,null)),i.on("exit",h),i.on("rendered",function(){n(".wsb-shell-loading").hide()}),i.on("retry",function(e){var t=n(e.target).addClass("disabled");i.RefreshConnectivityState().done(function(){t.removeClass("disabled")})}),t.on("ManageFacebookButtonClicked",e.bind(b,null,"ValidateFacebookConnectivityThenShowEditFacebookPage")),t.on("ConnectToFacebookButtonClicked",e.bind(b,null,"FacebookConnectivity")),t.on("EditFacebookButtonClicked",e.bind(b,null,"EditFacebookPage")),t.on("CloseFacebookEditor",h),t.on("FacebookConnected",function(e){b("EditFacebookPage",e.facebookPageId)}),t.on("FacebookConnectivityScreenOpen",function(){n(".wsb-shell-loading").hide()}),t.on("FacebookPreviewScreenOpen",function(){n(".wsb-shell-loading").hide()}),t.on("doneUpdate",h),t.on("showErrorGrowl",_)})}function p(){var e=r.Account;return 30===e.AccountType||C?!0:!1}function g(){k||(k=!0,S&&m())}function h(){T=n("#wsb-shell-socialbranding-content"),b("default",{},function(){n(".wsb-shell-loading").hide(),n("#wsb-shell-socialbranding-content").show(),S=!0,k=!1})}function m(){k||(n("#wsb-shell-socialbranding").hide(),n("#wsb-shell-socialbranding-content").empty(),n(".wsb-shell-loading").show(),S=!1)}function b(e,t,r){T.empty(),n(".wsb-shell-loading").show(),require(["designer/wsb/socialPage/facebook","designer/wsb/socialPage/twitter","text!/socialmediapages/socialpageview"],function(t,o,d){function c(){var e=t.renderPreview(g.find(".facebook_box_content"),x,x,!0);return l.trackEvent("social-branding","home-screen-facebook-preview-displayed"),e}function u(){var e=o.showPreviewScreen(g.find(".twitter_box_content"),x);return l.trackEvent("social-branding","home-screen-twitter-preview-displayed"),e}function p(){x?n("#social-upgrade-now").hide():(n("#social-upgrade-now").show().click(function(){l.trackEvent("social-branding","home-screen-upgrade-button-clicked"),s.ShowUpgradeDialog({clientTrackingId:"wsb-social-branding-upgrade-button",clientTrackingValue:"social_branding"})}),n("#socialPageView").addClass("upgrade-init-screen"),n(".wsb_social_branding_init_screen_intro").addClass("upgrade-now-wrapper"),n("#wsb-social-media-upgrade").addClass("wsb_social_media_sites2").removeClass(".wsb_social_media_sites"))}if(E(t,o),"TwitterConnectPage"===e)o.showSignupScreen(T),l.trackPageView("social-branding-twitter-signup");else if("TwitterComparePage"===e)o.showCompareScreen(T),l.trackEvent("preview_twittersocial","social-branding-twitter-compare","page");else if("ValidateFacebookConnectivityThenShowEditFacebookPage"===e)t.passThroughFacebookConnectivityStateValidationView(T);else if("FacebookConnectivity"===e)t.showViewToChangeFacebookPage(T);else if("EditFacebookPage"===e)t.showFacebookComparisonPage(T),l.trackEvent("preview_facebooksocial","social-branding-facebook-compare","page");else{l.trackEvent("preview","social","tab");var g=n(d).appendTo(T).hide();i.applyBindings({strings:a},g[0]),n.when(c(),u(),p()).done(function(){n(".wsb-shell-loading").hide(),g.show(),l.trackEvent("social-branding","home-screen-loaded"),x?(n("#social-upgrade-now").hide(),l.trackPageView("social-branding-enabled")):(n("#social-upgrade-now").show(),l.trackPageView("social-branding-disabled")),"function"==typeof r&&r()}).fail(function(){n(".wsb-shell-loading").hide(),g.show(),"function"==typeof r&&r()})}})}function f(){p&&require(["designer/wsb/socialPage/facebookPublish","designer/wsb/socialPage/twitterPublish"],function(e,t){e.off("showGrowl",y).on("showGrowl",y),t.publishTwitterPage(),e.publishFacebookPage()})}function v(){var e=n.Deferred(),t="/api/websites/{websiteId}/SocialBrandingStartOver",i=function(t){e.resolve(t)},a=function(t){e.reject(t)};return d.Post(t,null,i,a),e.promise()}function y(e){n("<div></div>").sfGrowl({icon:e.icon,title:e.title,content:e.msg,fadetime:0}),"function"==typeof e.onFixLink&&n("#facebookPagePublishFixLink").on("click",function(){l.trackEvent("social-branding","failed-fb-publish-fix-permissions-link-clicked"),e.onFixLink()})}function _(e){n("<div></div>").sfGrowl({icon:"error",title:"Error",content:e,fadetime:0})}var w,S=!1,k=!1,x=!1,C=!1,T=null,E=u();return w={init:c,opening:g,open:h,close:m,publish:f,socialBrandingStartOver:v,showView:b,showGrowl:y}}),define("designer/app/builder/data/userdata",["knockout","async!initDataModel"],function(e,t){var n=t.UserData;return n.editMode=function(){switch(this.editingMode){case"UserMode":return"customer";case"ThemeEditMode":return"designer";default:return this.editingMode}},n.isReseller=1!=n.resellerId,n.isPublishingWebsite=e.observable(!1),n}),define("text!designer/app/builder/ui/controls/publish/publish.html",[],function(){return'<div>\r\n    <div id="notready-confirmation"\r\n         style="display:none; width: 400px;"\r\n         data-bind="dialog: {\r\n        title: i18N.oops,\r\n        isOpen: showHostingNotReadyDialog,\r\n        autoResize: true,\r\n        zIndex: 100000,\r\n        destroyOnClose: true,\r\n        cancel: cancel,\r\n        buttons: [\r\n            {\r\n                text: i18N.close,\r\n                onClick: cancel,\r\n                isEnabled: true\r\n            }\r\n        ],\r\n        open: open\r\n    }">\r\n        <div class="wsb-actionbar-actions-flyout-publish-question">\r\n            <span data-bind="html: i18N.hostingNotReady"></span>\r\n        </div>\r\n    </div>\r\n\r\n    <div id="publish-processing" class="wsb-actionbar-publish-middle" data-bind="visible: showProcessingContainer">\r\n        <!--ko if: publishingProgressState() == states.saving || publishingProgressState() == states.publishing -->\r\n        <div class="wsb-publish-loader-wrapper">\r\n            <ul class="wsb-publishing-ul clearfix">\r\n                <li class="wsb-publishing-title" data-bind="text: publishingProgressTitle"></li>\r\n                <li class="wsb-upload-bar"><span class="wsb-upload-value wsb-upload-unknown-value"></span></li>\r\n                <li><a data-bindx="click: closePublish" data-aid="ab-publishdonttryagain" class="publish-cancel-lnk" data-bind="text: i18N.cancel"></a></li>\r\n            </ul>\r\n            <span class="wsb-publish-note" data-bind="text: \'(\' + i18N.takesAFewMinutes + \')\'"></span>\r\n        </div>\r\n        <!-- /ko -->\r\n        <!--ko if: publishingProgressState() == states.error -->\r\n        <div class="wsb-publish-error-wrapper">\r\n            <div style="float: left;">\r\n                <div class="sf-dialog-title2" data-bind="text: i18N.yikesWeHitASnag"></div>\r\n                <!--ko ifnot: isDesigner -->\r\n                <span data-bind="html: i18N.pleaseTryAgainOrVisitOurHelpCenter"></span>\r\n                <!-- /ko -->\r\n                <!--ko if: isDesigner -->\r\n                <span data-bind="text: i18N.pleaseTryAgainQuestion"></span>\r\n                <!-- /ko -->\r\n            </div>\r\n            <div style="float: left; margin: 15px;">\r\n                <a data-bind="click: retryClicked, text: i18N.tryAgain" data-aid="ab-publishtryagain" class="btn btn-inverse-grey"></a>\r\n                <a data-bind="click: cancel, text: i18N.cancel" data-aid="ab-publishdonttryagain" class="publish-cancel-lnk" style="margin-left: 10px;"></a>\r\n            </div>\r\n        </div>\r\n        <!-- /ko -->\r\n        <!--ko if: publishingProgressState() == states.advancedError -->\r\n        <div class="sf-dialog-title2" data-bind="text: i18N.callTheCavalry"></div>\r\n        <div style="color: #272727; padding: 15px 15px 24px;" data-bind="html: i18N.lookLikeTheProblemIsntGoingAway"></div>\r\n        <div class="sf-dialog-buttons">\r\n            <a data-bind="click: cancel, text: i18N.cancel" data-aid="ab-publishgiveup" class="publish-cancel-lnk"></a>\r\n        </div>\r\n        <!-- /ko -->\r\n    </div>\r\n\r\n    <div id="publish-confirmation-users"\r\n         style="display:none; width: 500px;"\r\n         class="wsb-actionbar-actions-flyout-publish-dialog-content"\r\n         data-bind="dialog: {\r\n                title: i18N.letsPublish,\r\n                isOpen: showConfirmationDialog,\r\n                autoResize: true,\r\n                zIndex: 100000,\r\n                destroyOnClose: false,\r\n                cancel: cancel,\r\n                buttons: [\r\n                    {\r\n                        text: i18N.publishText,\r\n                        onClick: publish,\r\n                        isEnabled: true\r\n                    },\r\n                    {\r\n                        text: i18N.cancel,\r\n                        cancel: true,\r\n                        style: \'link\',\r\n                        onClick: cancel\r\n                    }\r\n                ],\r\n                open: open\r\n            }">\r\n        <div class="wsb-actionbar-actions-flyout-publish-question">\r\n            <span data-bind="html: i18N.looksLikeYouAreReadyToPublish1"></span>\r\n            <!-- ko if: contentLossWarningForV6Users  -->\r\n            <div class="wsb_publish_dialog_content_loss_warning_for_v6_users">\r\n                <i class="v6-publish-info-icon"></i>\r\n                <span data-bind="html: i18N.looksLikeYouAreReadyToPublishv6"></span>\r\n            </div>\r\n            <!-- /ko -->\r\n            <span data-bind="html: i18N.looksLikeYouAreReadyToPublish2"></span>\r\n\r\n        </div>\r\n    </div>\r\n\r\n    <div>\r\n        \r\n        <!--ko if: isMicrosoftDomain() -->\r\n        <div id="publishSuccessforO365Account"\r\n             data-bind="dialog: {\r\n                title: i18N.office365DialogTitle,\r\n                isOpen: showOffice365RedirectDialog,\r\n                autoResize: true,\r\n                zIndex: 100000,\r\n                draggable: false,\r\n                cancelDisabled: true,\r\n                closeOnEscape: false,\r\n                destroyOnClose: true,\r\n                buttons: [],\r\n                open: open\r\n            }">\r\n            <div class="wsb-publish-dialog-office365">\r\n                <span data-bind="html: i18N.officeRedirect"></span>\r\n            </div>\r\n        </div>\r\n        <!-- /ko -->\r\n\r\n        <!--ko ifnot: isMicrosoftDomain() -->\r\n        <div id="publishSuccess"\r\n             data-bind="dialog: {\r\n                    title: successDialogTitle,\r\n                    isOpen: showSuccessDialog,\r\n                    autoResize: true,\r\n                    zIndex: 100000,\r\n                    destroyOnClose: true,\r\n                    cancel: cancelCloseSuccess,\r\n                    buttons: successDialogButtons,\r\n                    open: open\r\n                }">\r\n            <!--ko if: showLock -->\r\n            <div id="stagePublishContent" class="wsb-actionbar-flyout-content">\r\n                <p data-bind="html: i18N.stagePublishContent"></p>\r\n                <div class="wsb-actionbar-publish-ddt-stagingdomain-container clearfix">\r\n                    <div class="wsb-actionbar-publish-ddt-stagingdomain-label" data-bind="html: i18N.stageLink"></div>\r\n                    <div class="wsb-actionbar-publish-ddt-stagingdomain-url"><a data-bind="text: getHostingUrl(), attr: { href: getHostingUrl(), target: \'_blank\' }"></a></div>\r\n                </div>\r\n            </div>\r\n            <!-- /ko -->\r\n            <!--ko ifnot: showLock -->\r\n            <div id="publishContent">\r\n                <div data-bind="visible: showFreeTrialBillingOnPublishModal, html: freeTrialBillingMessage"></div>\r\n                <!--ko ifnot: showSeoOnPublishModal() -->\r\n                <div class="wsb-region-grey">\r\n                    <div><span data-bind="html: i18N.checkItOutColon"></span> <a id="domain" data-bind="text: getHostingUrl(), attr: { href: getHostingUrl(), target: \'_blank\' }, ga : { click: {category: \'wsb-designer-publish-success\', action: \'domain-link\', label: \'link\'} }"></a></div>\r\n                </div>\r\n                <!-- /ko -->\r\n\r\n                <!--ko ifnot: isReseller-->\r\n                <!--ko ifnot: showSeoOnPublishModal() -->\r\n                <div class="wsb-region-grey2">\r\n                    <div class="wsb-seo-live-url2" data-bind="text: i18N.shareItWithTheWorld"></div>\r\n                    <div class="wsb-seo-live-share">\r\n                        <span class="social-btn-facebook social-btn-connect" data-bind="click: onFacebookClick"><i class="icon-wsb-white icon-fb"></i> <span data-bind="    html: i18N.shareIt"></span></span>\r\n                        <span class="social-btn-twitter social-btn-connect" data-bind="click: onTwitterClick"><i class="icon-wsb-white icon-twitter"></i> <span data-bind="    html: i18N.tweetIt"></span></span>\r\n                    </div>\r\n                </div>\r\n                <!-- /ko -->\r\n                <!-- /ko -->\r\n\r\n                <!-- ko if: showSeoOnPublishModal() -->\r\n                <div class="wsb-region-grey">\r\n                    <div class="wsb-seo-live-url"><span data-bind="text: i18N.checkItOutColon"></span> <a id="A1" data-bind="    text: getHostingUrl(), attr: { href: getHostingUrl(), target: \'_blank\' }"></a></div>\r\n                    <!--ko ifnot: isReseller-->\r\n                    <div class="wsb-seo-live-share">\r\n                        <span data-bind="html: i18N.clientSeoControlPanelShareIt"></span>\r\n                        <span class="social-btn-facebook social-btn-connect2" data-bind="click: onFacebookClick"><i class="icon-wsb-white icon-fb"></i></span>\r\n                        <span class="social-btn-twitter social-btn-connect2" data-bind="click: onTwitterClick"><i class="icon-wsb-white icon-twitter"></i></span>\r\n                    </div>\r\n                    <!-- /ko -->\r\n                </div>\r\n                <div class="wsb-region-grey2">\r\n                    <div class="wsb-seo-start-optimize">\r\n                        <span data-bind="html: i18N.clientSeoInteruptMessageHeader"></span><br />\r\n                        <span data-bind="html: i18N.clientSeoInteruptMessageBody"></span>\r\n                    </div>\r\n                </div>\r\n                <!-- /ko -->\r\n            </div>\r\n            <!-- /ko -->\r\n        </div>\r\n        <!-- /ko -->\r\n    </div>\r\n    <div id="raaVerificationContent"\r\n         data-bind="dialog: {\r\n                title: i18N.raaDialogTitle,\r\n                isOpen: showRaaVerificationDialog,\r\n                autoResize: true,\r\n                zIndex: 100000,\r\n                destroyOnClose: true,\r\n                cancel: done,\r\n                buttons: [\r\n                    {\r\n                        text: i18N.close,\r\n                        isEnabled: true,\r\n                        onClick: done\r\n                    }\r\n                ],\r\n                open: open }">\r\n        <div class="wsb-publisher-raa-notice" data-bind="html: i18N.designerRaaNotice"></div>\r\n\r\n        <div class="wsb-publisher-raa-icon-container">\r\n            <div class="wsb-publisher-raa-email-icon"></div>\r\n            <!-- ko if: showResendEmailBtn() -->\r\n            <div class="wsb-publisher-raa-resend-btn">\r\n                <span data-bind="html: i18N.designerRaaResendEmailText"></span><br /><br />\r\n                <span class="btn btn-inverse-grey" data-bind="click: onRaaVerificationResendEmail, html: i18N.designerRaaEmailButton"></span>\r\n            </div>\r\n            <!-- /ko -->\r\n            <!-- ko ifnot: showResendEmailBtn() -->\r\n            <div class="wsb-publisher-raa-resend-msg"><div class="wsb-publisher-raa-check-icon"></div><span data-bind="text: i18N.designerRaaEmailSent"></span></div>\r\n            <!-- /ko -->\r\n\r\n        </div>\r\n        <div class="wsb-publisher-raa-phone">\r\n            <!-- ko if: isUS() -->\r\n            <span data-bind="text: i18N.designerRaaSupport"></span>\r\n            <span data-bind="text: supportPhoneNumber"></span>\r\n            <!-- /ko -->\r\n            <!-- ko ifnot: isUS() -->\r\n            <span data-bind="text: i18N.designerRaaSupportSite"></span>&nbsp;<a href="/help/article/8948" target="_blank"><span data-bind="text: i18N.designerRaaSupportPageText"></span></a>.\r\n            <!-- /ko -->\r\n        </div>\r\n    </div>\r\n\r\n</div>\r\n'
}),define("designer/util/util.fbSDKLoader",["wsbcore/helper","wsbcore/growl","common/util/util.window"],function(e){function t(e,t){i="js!//connect.facebook.net/"+e+"_"+t+"/sdk"}function n(e){e.forEach(function(e){e&&"function"==typeof e&&e()})}var i,a="en",r="US",o=!1,s=!1,l=[],d=[];return window.fbAsyncInit=function(){o=!0,n(l)},t(a,r),{setLocale:function(e,n){t(e,n)},processFBOperation:function(t,a){o?t():(l.push(t),d.push(a),s||(s=!0,e.require([i],function(){},function(){n(d)})))}}}),define("designer/util/facebookSDKHelper",["jquery","designer/util/util.fbSDKLoader","common/util/util.window"],function(e,t,n){function i(e){n.FB.init({appId:e||"Feed-No-App-ID",xfbml:!0,version:r}),o=!(s=e?!0:!1)}function a(e){var t=n.FB;e.propertyTraversalArr&&e.propertyTraversalArr.forEach(function(e){t=t[e]}),t[e.methodName].apply(null,e.params)}var r="v2.3",o=!1,s=!1,l={"class":"fb-page","data-href":"https://facebook.com/seeamazingplaces","data-width":180,"data-height":70,"data-hide-cover":!1,"data-show-facepile":!0,"data-show-posts":!0,"data-small-header":!1,"data-adapt-container-width":!0};return{setLocale:function(e,n){t.setLocale(e,n)},postFeeds:function(e,n,r,o,l){var d={methodName:"ui",params:[{method:"feed",name:e,display:"popup",link:n,picture:"",caption:n,description:r}]};t.processFBOperation(function(){s||i(o),a(d)},l)},likeBoxGenerator:function(n,r,s,d){var c,u={propertyTraversalArr:["XFBML"],methodName:"parse",params:[]};r?(r=e.isPlainObject(r)?r:JSON.parse(r),c=r):c=l;var p=e("<div>",r).append(e("<div>",{"class":"fb-xfbml-parse-ignore"}).append(e("<blockquote>",{cite:c["data-href"]})).append(e("<a>",{href:c["data-href"]})));p.appendTo(e(n)),t.processFBOperation(function(){o||i(),a(u),s&&"function"==typeof s&&s()},d)}}}),define("modules/freetrial/thankYouDialog",["lodash","jquery","/i18n/resources/client","common/stats/googleanalytics","wsbcore/overlay"],function(e,t,n,i){function a(e){this.settings=e}function r(e){var i=t.extend(!0,o,e);i.buttons=[{id:"ok",text:n.resources.Close,onClick:function(){r.closeDialog()}}];var r=new a(i);return r}var o={id:"dlgFreeTrialRenewalThankYou",title:n.resources.Thanks_exclamation,load:"/freetrial/thankyoudialog",cssClass:"free-trial-thank-you",closeOnEscape:!1,autoResize:!0,dialogWidthIdeal:720,dialogCloseGaEvent:"dashboard_freetrial_thankyou",timeout:2e4};a.prototype.showDialog=function(i){var a=this,r=t("<div id='"+a.settings.id+"' class='"+a.settings.cssClass+"'></div>").appendTo("body"),o=e.assign({},a.settings,{destroyOnClose:!0,onLoad:function(e){t(".sf-dialog-content").sfMsgOverlay({message:null}),t(".sf-dialog-content",e).sfMsgOverlay({message:n.resources.Loading})}},i);r.wsbDialog(o)},a.prototype.closeDialog=function(){this.getDialogElement().wsbDialog("close")},a.prototype.getDialogElement=function(){return t("#"+this.settings.id)},a.prototype.onCancelClick=function(){i.trackEvent(this.settings.dialogCloseGaEvent,"closeout_modal","icon")};var s={init:r};return s}),define("modules/freetrial/baseDialog",["lodash","jquery","common/browser/browser","common/persistence/persistence","common/api/websites/websitesAPI","userData","websiteSettings","modules/freetrial/thankYouDialog","/i18n/resources/client","common/stats/googleanalytics","wsbcore/overlay"],function(e,t,n,i,a,r,o,s,l,d){function c(){}function u(t){var n=new c;return n.settings=e.assign({},p,t),n.websiteId=r.websiteId,n.orionAccountUid=r.orionUid,n.isFreeTrialAccount=r.isFreeTrialAccount,n.settings.buttons=n.settings.buttons||[{text:n.settings.cancelButtonText,cancel:!0},{id:"ok",text:n.settings.renewButtonText,onClick:n.settings.onSubmitClick&&n.settings.onSubmitClick.bind(n)||function(){n.closeDialog()}}],n.isFetching=!0,g=g||s.init(),n}var p={id:"dlgFreeTrial",cssClass:"",eventSource:"unknown",cancelDisabled:!1,closeOnEscape:!1,showThankYouDialog:!0,autoResize:!0,dialogWidthIdeal:710,dialogRenewGaEvent:null,dialogCancelGaEvent:null,renewButtonText:l.resources.Buy,cancelButtonText:l.resources.No_Thanks,renewalFailureMessage:l.resources.FreeTrial_On_Error,timeout:2e4},g=null,h=n.window.setTimeout;c.prototype.showDialog=function(n,i){function a(){o=t("<div id='"+r.settings.id+"' class='"+r.settings.cssClass+"'></div>").appendTo("body");var a=e.assign({},r.settings,{destroyOnClose:!1,onLoad:function(e){t(".sf-dialog-content").sfMsgOverlay({message:null}),t(".sf-dialog-content",e).sfMsgOverlay({message:l.resources.Loading}),r.getDialogElement().find("button.close").attr("data-aid","wsb-free-trial-modal-close-button"),o.sfDialog("getButton",0).button.attr("data-aid","wsb-free-trial-modal-no-thanks-link"),o.sfDialog("getButton","ok").button.attr("data-aid","wsb-free-trial-modal-buy-button")},onOpen:function(){h(function(){r.onLoadComplete(i),h(r.settings.onOpen&&r.settings.onOpen.bind(r)||r.onOpen.bind(r),1)},1)},onCancel:r.settings.onCancelClick&&r.settings.onCancelClick.bind(r)||r.onCancelClick.bind(r),onClose:r.settings.onClose&&r.settings.onClose.bind(r)||r.onClose.bind(r)},n);o.wsbDialog(a),r.isFetching=!1}var r=this,o=r.getDialogElement();o.length?(ko.cleanNode(o[0]),h(function(){r.getDialogElement().sfDialog("destroy"),h(function(){r.getDialogElement().remove(),h(a,1)},1)},1)):a()},c.prototype.disableRenewButton=function(e){console.log("disabling auto renew"),e&&e.IsProcessingRenewal(!0),this.getDialogElement().wsbDialog("disableButton","ok")},c.prototype.enableRenewButton=function(e){console.log("enabling auto renew"),e&&e.IsProcessingRenewal(!1),this.getDialogElement().wsbDialog("enableButton","ok")},c.prototype.closeDialog=function(){this.getDialogElement().wsbDialog("close")},c.prototype.getDialogElement=function(){return t("#"+this.settings.id)},c.prototype.requiresRenewal=function(){return this.isFreeTrialAccount?"true"!==t.trim(o.DomainAttachFreeTrialRenewed).toLowerCase():!1},c.prototype.processRenewal=function(e){var t=this;return a.postFreeTrialRenewal({websiteId:t.websiteId,requestSource:t.settings.eventSource}).fail(function(t,n,i){e(new Error("Error occurred attempting plan renewal: "+i))}).done(function(){h(function(){t.refreshWebsiteSettings(function(n){return n?void e(n):(t.disableDesignerPreFetch(),void e())})},500)})},c.prototype.onLoadComplete=function(e){e&&e.bind()},c.prototype.onOpen=function(){this.isFetching=!0},c.prototype.onClose=function(){},c.prototype.onCancelClick=function(){var e=arguments[0]?"cancel_modal":"closeout_modal",t=arguments[0]?"link":"icon";d.trackEvent(this.settings.dialogCancelGaEvent,e,t)},c.prototype.onRenewClick=function(e){var t=this;e.HasUserInteraction(!0),e.RenewalError(null),e.RenewalSuccess(!1),e.ErrorMessage()||(d.trackEvent(t.settings.dialogRenewGaEvent,"ok","button"),t.disableRenewButton(e),t.processRenewal(function(n){t.enableRenewButton(e),n?e.RenewalError(t.settings.renewalFailureMessage):(e.RenewalSuccess(!0),t.closeDialog(),t.settings.showThankYouDialog&&h(g.showDialog.bind(g),500))}))},c.prototype.refreshWebsiteSettings=function(e){i.Get("/api/websites/{websiteId}/websiteSettings/?skipCache=true",function(t){o.DomainAttachFreeTrialRenewed=t.DomainAttachFreeTrialRenewed,o.PfId=t.PfId,o.PlanExpireDate=t.PlanExpireDate,e()},function(){e(new Error("Error occurred updating website settings after plan renewal"))})},c.prototype.disableDesignerPreFetch=function(){t("a").each(function(){var e=t(this),n=e.attr("href");n&&-1!==n.indexOf("/builder")&&(n+=-1===n.indexOf("?")?"?ts="+(new Date).getTime():"&ts="+(new Date).getTime(),e.attr("href",n))})};var m={init:u};return m}),define("modules/freetrial/baseViewModel",["jquery","knockout","/i18n/resources/client"],function(e,t,n){function i(e){e=e||{};var i=this;i.shouldRenewInit=e.shouldRenew||!1,i.contentId=e.contentId,i.ShouldRenew=t.observable(i.shouldRenewInit),i.HasUserInteraction=t.observable(!1),i.RenewalError=t.observable(),i.RenewalSuccess=t.observable(!1),i.IsProcessingRenewal=t.observable(!1),i.ErrorMessage=t.computed(function(){var e=i.ShouldRenew(),t=i.HasUserInteraction(),a=i.RenewalError();return a?a:!e&&t?n.resources.FreeTrial_You_must_check_this_to_order:null}),i.ShouldRenew.subscribe(function(){i.HasUserInteraction(!0)})}return i.prototype.bind=function(){this.ShouldRenew(this.shouldRenewInit),this.HasUserInteraction(!1),this.RenewalError(null),this.RenewalSuccess(!1);var n=e("#"+this.contentId)[0];t.dataFor(n)||t.applyBindings(this,n)},{init:function(e){var t=new i(e);return t.bind(),t}}}),define("modules/freetrial/publishingDialogViewModel",["modules/freetrial/baseViewModel"],function(e){var t;return{init:function(n){return t?t:(n=n||{},n.contentId="wsb-freetrial-publishing-dialog-body",void(t=e.init(n)))},getViewModel:function(){return t}}}),define("modules/freetrial/keepSiteLiveDialogViewModel",["modules/freetrial/baseViewModel"],function(e){var t;return{init:function(n){return t?t:(n=n||{},n.contentId="wsb-freetrial-keepsitelive-dialog-body",void(t=e.init(n)))},getViewModel:function(){return t}}}),define("modules/freetrial/keepSiteLiveDialog",["modules/freetrial/baseDialog","modules/freetrial/keepSiteLiveDialogViewModel","common/browser/browser","/i18n/resources/client"],function(e,t,n,i){function a(){var e=n.window.location.href.toLowerCase();return-1!==e.indexOf("/builder")?"designer":-1!==e.indexOf("/themes")?"themes":"dashboard"}var r,o,s={id:"dlgFreeTrialKeepSiteLive",cssClass:"free-trial-keepsitelive",eventSource:a(),load:"/freetrial/keepSiteLiveDialog",title:i.resources.FreeTrial_Keep_your_site_live_for_a_full_year,dialogCancelGaEvent:"designer_freetrial_keepsitelive",dialogRenewGaEvent:"designer_freetrial_keepsitelive",renewButtonText:i.resources.FreeTrial_Order_Now,cancelButtonText:i.resources.FreeTrial_Remind_me_later,onSubmitClick:function(){var e=t.getViewModel();r.onRenewClick(e)}};return{init:function(t){r=e.init(s),o=t&&t.onRenewSuccess||function(){}},show:function(){r.showDialog({onClose:function(){r.onClose.apply(r,arguments);var e=t.getViewModel();e.RenewalSuccess()&&o()}},t.getViewModel())},requiresRenewal:function(){return r.requiresRenewal()}}}),define("modules/notice/notice",["jquery","modules/freetrial/keepSiteLiveDialog","common/stats/googleanalytics","common/browser/browser"],function(e,t,n,i){function a(t){if(h=e("#wsb-notice"),m=t||{},!h.length)return null;if(!y){var a=e("#wsb-notice-close");a.length&&a.click(d),a=null;var r=e(".wsb-notice-button button");if(r.length&&(t.action=r.attr("data-noticeaction").trim().toLowerCase(),r.click(g)),r=null,m.isDesigner&&i.msie){var s=e("#app-controls");s&&(h.detach(),s.append(h),s=null)}}m.animateOnLoad!==!1&&o(),y=!0,e(".wsb-notice-change-theme a").click(function(e){return n.trackEvent("wsb_free_trial_notice_banner","change_theme","link"),_(function(){i.window.location="/themes"},10),e.preventDefault(),e.stopPropagation(),!1})}function r(e){require(["css!modules/notice/notice.css"],e)}function o(){f?l():r(function(){f=!0,l()})}function s(e){h.trigger("resize",[e])}function l(){c()||(h.slideDown(b,s.bind(null,!0)),"function"==typeof m.animateIn&&m.animateIn(b))}function d(){c()&&(h.slideUp(b,s.bind(null,!1)),"function"==typeof m.animateOut&&m.animateOut(b))}function c(){return h.is(":visible")&&h.height()>1}function u(){return h.find("table").height()}function p(){return m.action}function g(e){switch(e.preventDefault(),m.action){case"freetrial":v||(t.init({onRenewSuccess:d}),v=!0),n.trackEvent("wsb_free_trial_notice_banner","keep_my_site","button"),t.show()}}var h,m,b=500,f=!1,v=!1,y=!1,_=i.window.setTimeout;return{init:a,animateIn:o,animateOut:d,getHeight:u,getNoticeAction:p}}),define("modules/freetrial/publishingDialog",["knockout","modules/freetrial/baseDialog","modules/freetrial/publishingDialogViewModel","modules/notice/notice","/i18n/resources/client"],function(e,t,n,i,a){var r,o=e.observable(!1),s={id:"dlgFreeTrialPublishing",cssClass:"free-trial-publishing",eventSource:"post-publish",load:"/freetrial/publishingdialog",showThankYouDialog:!1,title:a.resources.FreeTrial_Congratulations_Your_site_is_publishing,dialogCancelGaEvent:"designer_freetrial_publishing",dialogRenewGaEvent:"designer_freetrial_publishing",renewButtonText:a.resources.FreeTrial_Order_Now,cancelButtonText:a.resources.FreeTrial_Remind_me_later,onSubmitClick:function(){var e=n.getViewModel();r.onRenewClick(e)}};return{init:function(){r=t.init(s)},show:function(e){return r.requiresRenewal()?(o(!1),void r.showDialog({onClose:function(){r.onClose.apply(r,arguments);var t=n.getViewModel();o(t.RenewalSuccess()),o()&&i.animateOut(),e()}},n.getViewModel())):void e()},requiresRenewal:function(){return r.requiresRenewal()},wasRenewedOnShow:function(){return o()}}}),define("designer/app/builder/ui/controls/publish/publish",["jquery","lodash","knockout","libs/async-util/async","designer/app/builder/data/data","common/persistence/persistence","designer/app/builder/data/designerData","designer/app/builder/managers/addressManager","designer/app/app","common/logger/logger","common/logger/serverLogger","common/stats/googleanalytics","common/popper/popper","common/abTesting/abTesting","designer/netpromoter/netpromoter","common/socialPageManager/socialPageManager","common/seoEnabled/seoEnabled","common/api/websites/websitesAPI","designer/app/builder/data/userdata","/i18n/resources/client","designer/util/util.i18n","text!designer/app/builder/ui/controls/publish/publish.html","designer/util/facebookSDKHelper","modules/freetrial/publishingDialog","wsbcore/growl"],function(e,t,n,i,a,r,o,s,l,d,c,u,p,g,h,m,b,f,v,y,_,w,S,k){function x(t){l.addControl(w,"builder","publish-controls");var i=e("body").find("#publish-controls")[0];return Y=new G,n.applyBindings(Y,i),st.currentAction()===s.actions.publish&&(T({bypassConfirmation:!1}),st.currentAction(s.actions.edit)),h.initModule(),C(),t&&t(Y,"publish"),Y}function C(){k.init(),v.isFreeTrialAccount&&r.Get("/freetrial/publishConfirmationDialog",function(e){Y&&Y.freeTrialBillingMessage(e)})}function T(e){return K=e,Y.fromNoDomain(e.fromNoDomain),v.isPublishingWebsite()?!1:Y.publishingProgressState()!==Z.idle?!1:(v.isPublishingWebsite(!0),i.parallel([D,I],function(e,t){return e?(v.isPublishingWebsite(!1),j(e),void P("fail")):void(t[1]===X.createPublish?A():(v.isPublishingWebsite(!1),P("processing")))}),!0)}function E(e,t){T({callback:function(t){f.checkDpsDns(),e&&e(t)},bypassConfirmation:!1,fromNoDomain:t})}function P(t){K&&e.isFunction(K.callback)&&K.callback(t)}function D(e){Y.publishingProgressState(Z.saving),nt.forceEnable(),tt.save(function(t,n){Y.showHostingNotReadyDialog()||Y.publishingProgressState(Z.idle),e(t,n)})}function I(e){i.waterfall([M,z],e)}function A(){c.startPerformanceTimers(dt.name),c.triggerTrace(dt.steps.publishStart,dt.name),m.publish(),i.waterfall([L,B,F,R,H],function(e,t){v.isPublishingWebsite(!1),e||t!==X.done||(ct()?(Y.showSuccessDialog(!1),Y.showOffice365RedirectDialog(!Y.fromNoDomain())):(Y.showSuccessDialog(!Y.fromNoDomain()),Y.showOffice365RedirectDialog(!1)),o.updatePublishNotification(),c.triggerTrace(dt.steps.publishEnd,dt.name),c.postPerformance(dt.name)),P("success"),d.log("publish complete",e,t)})}function M(e){var t,n=function(e){return e?(rt.Account=e,rt.Account.IsSetup||lt.isThemeEditMode||ot.DesignLock&&"true"===ot.DesignLock.toLowerCase()?K.bypassConfirmation?X.createPublish:(u.trackModal("wsb-designer-lets-publish"),X.confirmationPopup):(u.trackModal("wsb-designer-hosting-not-setup"),X.showHostingNotSetupPopup)):X.accountCouldNotBeRefreshed};return rt.Account.IsSetup?(t=K.bypassConfirmation?X.createPublish:X.confirmationPopup,void e(null,t)):void rt.refresh(function(i){t=n(i),e(null,t)})}function O(e){return"enabled"!==g.getOption("office365Publish")?void e(null,"skip"):ot.isMicrosoftDomain!==!0&&"true"!==ot.isMicrosoftDomain&&void 0!==ot.isMicrosoftDomain&&null!==ot.isMicrosoftDomain?void e(null,"no-check"):void f.getDomainInfo().done(function(t){ct(t.isMicrosoftDomain);var n={IsMicrosoftDomain:t.isMicrosoftDomain};ct()&&(ot.isOffice365Account||(ot.isOffice365Account=!0,n.IsOffice365Account=!0),c.post({detail:"Office 365 redirect",action:"o365redirect"},c.level.Information)),r.Post("/api/websites/{websiteId}/websitesettings",n),e(null,"done")}).fail(function(t){c.post({detail:t,action:"getDomainInfoFailure"},c.level.Error),e(null,"error")})}function L(e){Y.publishingProgressState(Z.publishing),i.auto({getDomainInfo:O,showFreeTrialUpgrade:N,doCreatePublish:["getDomainInfo",function(e){o.createPublish(rt.Account.OrionAccountUid).done(function(){e(null,"done")}).fail(function(){e("error")})}]},function(t){e(null,t?X.updateNotification:X.checkPublishStatus)})}function N(e){k.show(function(){e()})}function B(e,t){if(e!==X.checkPublishStatus)return t(null,e);var n=Q.None,a=Number.MAX_VALUE;i.whilst(function(){return n===Q.None?!0:n===Q.Started?!0:!1},function(e){o.checkPublishStatus().then(function(e){n=e.PublishStatusId,a=e.TimeDiffInMinutes}).fail(function(){t(null,X.updateNotification)}),setTimeout(e,at.PublishTimeout)},function(e){switch(Y.publishingProgressState(Z.idle),n){case Q.Successful:Y.showLock?t(e,X.done):t(e,X.verifyRaa);break;case Q.Pending:t(e,X.setExpiredStatus);break;default:t(e,X.updateNotification)}})}function F(e,t){return e!=X.updateNotification?t(null,e):void o.updatePublishNotification().always(function(){Y.publishingProgressState(Z.error),t&&t(null,X.cancel)})}function R(e,t){return e!=X.setExpiredStatus?t(null,e):void o.setPublishExpiredAndUpdateNotification(et.notified).always(function(){Y.publishingProgressState(Z.error),t(null,X.cancel)})}function H(e,t){return e!=X.verifyRaa?t(null,e):void("enabled"===g.getOption("raaVerification")?o.getRaaVerificationInfo(rt.ko.domain()).then(function(e){e&&e.Verified?t(null,X.done):(Y.showRaaVerificationDialog(!0),Y.showResendEmailBtn(!0),Y.nextAction=function(){t(null,X.done)})}).fail(function(){t(null,X.done)}):t(null,X.done))}function V(){o.postRaaVerification().then(function(){Y.showResendEmailBtn(!1)})}function z(e,t){switch(e){case X.createPublish:t(null,e);break;case X.confirmationPopup:Y.fromNoDomain()?t(null,X.createPublish):(Y.showConfirmationDialog(!0),Y.nextAction=function(){t(null,X.createPublish)});break;case X.showHostingNotSetupPopup:Y.fromNoDomain()?t(null,e):(Y.publishingProgressState(Z.hostingNotReady),t(null,X.cancel));break;case X.accountCouldNotBeRefreshed:j("Account could not be refreshed"),t(null,X.cancel)}}function j(t){"toobusy"!==t&&(e("<div></div>").sfGrowl({title:J.Client__Designer__Yikes_hit_a_snag,content:J.Client__Designer__TryAgainCustomerSupport.format('<a class="wsb-support-link" href="/help/support" target="_blank">',"</a>"),icon:"error"}),c.post({action:"publish",isGrowl:!0,errorMessage:t},c.level.error))}function U(){if(!ot.DesignLock)return!1;var e=ot.DesignLock.toString().toLowerCase();return"true"===e||"1"===e}function W(e){var t=e||rt.DomainName;return U()?at.publishDdtStagingToDps?at.ddtDpsDomainFormat.replace("{0}",v.websiteId):at.ddtStageDomain+"/"+t:t}function q(){return U()?at.publishDdtStagingToDps?"http://":"":rt.Account.IsSslCertificateInstalled?"https://":"http://"}function $(e){var t=q(),n=W(e);return t+n}function G(){var i=this;this.retries=0,this.nextAction=t.noop,this.mode="user",this.officeRedirectDestination=at.office365RedirectUrl+rt.ko.domain(),this.i18N={letsPublish:J.Lets_publish,publishText:J.Publish,oops:J.Server__Oops,ok:J.OK,cancel:J.Cancel,close:J.Close,looksLikeYouAreReadyToPublish1:J.Server__Looks_like_youre_ready_to_publish_paragraph1,looksLikeYouAreReadyToPublish2:J.Server__Looks_like_youre_ready_to_publish_paragraph2,looksLikeYouAreReadyToPublishv6:J.Server__Looks_like_youre_ready_to_publish_content_loss_warning_for_v6_users,publishingEllipsis:J.Server__Publishing_ellipsis,savingEllipsis:J.Saving_ellipsis,takesAFewMinutes:J.Server__This_may_take_a_few_minutes,hostingNotReady:J.Server__Were_not_quite_done_setting_up_your_account,youAreAboutToPublishThisThemeForCustomer:J.Server__You_are_about_to_publish_this_theme_for_customers,niceJobYourSiteIsLive:J.Server__Nice_job_your_site_is_live,successWithExclamation:J.Server__Success_with_exclamation,shareItWithTheWorld:J.Server__Share_it_with_the_world,shareIt:J.Server__Share_it,tweetIt:J.Server__Tweet_it,checkItOutColon:J.Server__Check_it_out_colon,clientSeoControlPanelShareIt:J.Client_SEO_ControlPanel_ShareIt,clientSeoInteruptMessageHeader:J.Client__SEO__InteruptMessage_Header,clientSeoInteruptMessageBody:J.Client__SEO__InteruptMessage_Body,stagePublishContent:J.Server__Stage_publish_content,stageLink:J.Server_Stage_link,yikesWeHitASnag:J.Yikes_we_hit_a_snag,pleaseTryAgainOrVisitOurHelpCenter:J.Server__Please_try_again_or_visit_our_help_center.format('<a href="/help/support" target="_blank">',"</a>"),pleaseTryAgainQuestion:J.Server__Please_try_again_question,tryAgain:J.Try_Again,callTheCavalry:J.Call_the_cavalry,lookLikeTheProblemIsntGoingAway:J.Server__Looks_like_the_problem_isnt_going_away.format('<a href="/help/support" target="_blank" class="publish-cancel-lnk">',"</a>"),raaDialogTitle:J.Client__Raa_Dialog_Title,designerRaaNotice:J.Server__Designer_Raa_Notice,designerRaaResendEmailText:J.Server__Designer_Raa_Resend_Email_Text,designerRaaEmailButton:J.Server__Designer_Raa_Email_Button,designerRaaEmailSent:J.Server__Designer_Raa_Email_Sent,designerRaaSupport:J.Server__Designer_Raa_support,customerSupportPhoneNew:J.Server__Customer_Support_Phone_New,resellerSupportPhoneNumber:_.resellerSupportPhoneNumber+".",designerRaaSupportSite:J.Server__Designer_Raa_support_site,designerRaaSupportPageText:J.Server__Designer_Raa_support_page_non_us_text,officeRedirect:J.Server__Success_office_365_redirect.format(this.officeRedirectDestination),office365DialogTitle:J.Server__Success_office_365_dialog_title},this.contentLossWarningForV6Users=ot.V6Upgrade?ot.SeenPublishWarningForV6Users===!1:!1,this.states=Z,this.isUS=n.observable("en-US"===y.locale),this.showConfirmationDialog=n.observable(!1),this.showConfirmationDialogUser=n.observable(!1),this.showHostingNotReadyDialog=n.observable(!1),this.showRaaVerificationDialog=n.observable(!1),this.showResendEmailBtn=n.observable(!0),this.showSuccessDialog=n.observable(!1),this.isMicrosoftDomain=ct,this.showOffice365RedirectDialog=n.observable(!1),this.showLock=function(){return U()}(),lt.isThemeEditMode?this.mode="theme":this.showLock&&(this.mode="staging",this.i18N.publishText=J.Client__Publish_stage_confirm_button),this.publishingProgressState=n.observable(Z.idle),this.showSeoOnPublishModal=function(){return b.isEnabled()&&b.isValid(rt.DomainName)&&(null===ot.SearchMetricsPublishReady||!ot.SearchMetricsPublishReady)},this.showFreeTrialBillingOnPublishModal=n.computed(function(){return k.wasRenewedOnShow()}),this.freeTrialBillingMessage=n.observable(""),this.isReseller=v.isReseller,this.supportPhoneNumber=this.isReseller?this.i18N.resellerSupportPhoneNumber:this.i18N.customerSupportPhoneNew,this.isDesigner=lt.isThemeEditMode,this.publishingProgressState.subscribe(function(e){i.showHostingNotReadyDialog(e===Z.hostingNotReady)}),this.showProcessingContainer=n.computed(function(){var e=i.publishingProgressState();return e===Z.saving||e===Z.publishing||e===Z.error||e===Z.advancedError}),this.publishingProgressTitle=n.computed(function(){switch(i.publishingProgressState()){case Z.publishing:return i.i18N.publishingEllipsis;case Z.saving:return i.i18N.savingEllipsis;default:return""}}),this.fromNoDomain=n.observable(!1),this.showFreeTrialUpgrade=n.observable(!1),this.freeTrialUpgradeVisible=n.observable(!1),this.successDialogTitle=this.showLock?this.i18N.successWithExclamation:this.i18N.niceJobYourSiteIsLive,this.getHostingUrl=function(){return $()},this.cancel=function(e){i._trackCancelClick(e),i.performClose("cancel")},this._trackCancelClick=function(e){var t,n=e?"button":"icon",a="close";i.showHostingNotReadyDialog()?t="wsb-wait-for-publishing":i.showConfirmationDialog()?(t="wsb-designer-lets-publish",a=e?"cancel_publish_modal":"xclose_publish_modal",n=e?"link":"icon"):i.showSuccessDialog()?t="wsb-designer-publish-success":i.showRaaVerificationDialog()&&(t="wsb-designer-raa-close"),t&&u.trackEvent(t,a,n)},this.performClose=function(e){v.isPublishingWebsite(!1),i.showConfirmationDialog(!1),i.publishingProgressState(Z.idle),i.showRaaVerificationDialog(!1),i.showSuccessDialog(!1),P(e)},this.done=function(){e.isFunction(i.nextAction)&&i.nextAction(),i.showConfirmationDialog(!1),i.publishingProgressState(Z.idle),i.showRaaVerificationDialog(!1),i.isMicrosoftDomain()?(i.showSuccessDialog(!1),i.showOffice365RedirectDialog(!i.fromNoDomain())):(i.showSuccessDialog(!i.fromNoDomain()),i.showOffice365RedirectDialog(!1))},this.success=function(e){e&&u.trackEvent("wsb-designer-publish-success","close_successpublish_modal","button"),i.showSuccessDialog(!1),lt.isThemeEditMode||h.showSurvey()},this.cancelCloseSuccess=function(){u.trackEvent("wsb-designer-publish-success","xclose_successpublish_modal","icon"),lt.isThemeEditMode||h.showSurvey()},this.publish=function(){var t=window.location.pathname.match(/preview/)?"preview":"designer_header";u.trackEvent(t,"publish","button"),u.trackEvent("wsb-designer-lets-publish","publish","button"),i.showConfirmationDialog(!1),i.publishingProgressState(Z.publishing),e.isFunction(i.nextAction)&&i.nextAction()},this.open=function(){i.showOffice365RedirectDialog()&&setTimeout(function(){window.location=i.officeRedirectDestination},5e3)},this.viewSite=function(){return u.trackEvent("wsb-designer-publish-success","domain-link","link"),!0},this.retryClicked=function(){i.publishingProgressState(Z.publishing),2===++i.retries?(i.retries=0,F(X.updateNotification,function(){i.publishingProgressState(Z.advancedError)})):A()},this.onRaaVerificationResendEmail=function(){V(),u.trackEvent("wsb-designer-raa-resend-email","resend","button")},this.getSocialText=function(e){return J.Client__Designer__ActionBar_SocialShareOnPublishText.replace("{URL}",e)},this.onFacebookClick=function(){u.trackEvent("wsb-designer-publish-success","share_facebook","button");var t=i.getHostingUrl(),n=i.getSocialText(t),a=J.Client__Designer__ActionBar_SocialShareOnPublishCaption.replace("{URL}",t),r=at.ShareOnPublish.FacebookAppId;S.setLocale(y.lang,y.region),S.postFeeds(a,t,n,r,function(){e("<div></div>").sfGrowl({title:y.resources.Client__Designer__Yikes_hit_a_snag,content:y.resources.Server__There_has_been_an_unexpected_error,icon:"error"})})},this.onTwitterClick=function(){u.trackEvent("wsb-designer-publish-success","share_twitter","button");var e=i.getSocialText(i.getHostingUrl());p.show({url:"https://twitter.com/intent/tweet?lang="+y.lang+"&source=tweetbutton&text="+encodeURIComponent(e)+"&url=none"})},this.successDialogButtons=this.showSeoOnPublishModal()?[{text:J.Client__SEO__StartOptimizing,isEnabled:!0,onClick:function(){i.success(),u.trackEvent("wsb-designer-publish-success","optimize_now","button"),st.currentAction(s.actions.seo)}},{text:J.Client__SEO__DoItLater,cancel:!0,style:"link",onClick:function(){i.cancelCloseSuccess(),u.trackEvent("wsb-designer-publish-success","optimize_later","link")}}]:[{text:i.i18N.close,isEnabled:!0,onClick:i.success}]}var K,Y,J=y.resources,Z={idle:0,saving:1,publishing:2,hostingNotReady:3,error:4,advancedError:5,dnsError:6},X={createPublish:0,showHostingNotSetupPopup:1,confirmationPopup:2,cancel:3,accountCouldNotBeRefreshed:4,checkPublishStatus:5,updateNotificaton:6,setExpiredStatus:7,verifyRaa:8,sendRaaEmail:9,done:10},Q={None:0,Pending:1,Started:2,Successful:3,Errored:4,Expired:5},et={notified:1,unnotified:0},tt=a.saver,nt=a.undoer,it=a.getDataModel(),at=it.config,rt=it.info,ot=it.settings,st=it.address,lt=it.theme,dt=c.beacons.publish,ct=n.observable(!1);return{getHostingDomain:W,getHostingUrl:$,load:x,publish:T,publishAndCheckDpsDns:E,getDomainInfo:O,getHostingUrlPrefix:q}}),define("modules/domainselector2/domainselector",["jquery","libs/knockout/knockout","eventemitter","lodash","common/api/websites/websitesAPI","common/persistence/persistence","/i18n/resources/client","appconfig","websiteInfo","common/stats/googleanalytics","common/util/stringHelper","text!/assets/modules/domainselector2/domainselector.html","wsbcore/dialog","wsbcore/tipper","wsbcore/overlay","css!/assets/modules/domainselector2/domainselector.css"],function(e,t,n,i,a,r,o,s,l,d,c,u){function p(e){return o.resources[e]}function g(t){return t=t,t=e.trim(t),t&&"unknown"!==t.toLowerCase()?t:""}function h(){n.call(this);var i=this;this.emitter=new n,this.$modal=null,this.isLoaded=!1,this.serverErrorCount=0,this.domainsLoadedAtLeastOnce=!1,this.partialResultDetected=!1,this.events={domainChanged:"domain-changed",open:"open",close:"close"},this.strings={domainCannotBeChanged:p("Server__Your_domain_cannot_be_changed"),selectADomainOfMine:p("Server__Select_a_domain_of_mine_colon"),domainsAlreadyHosted:p("Server__Domains_that_are_already_hosted"),learnMore:p("Server__Learn_more"),typeYourDomain:p("Server__Type_your_domain_name_colon"),typeYourDomainRegisteredElsewhere:p("Server__Type_a_domain_registered_elsewhere_colon"),createASubDomain:p("Server__Create_a_subdomain_colon"),whatIsASubDomain:p("Server__What_is_a_subdomain"),mustEnterValidDomain:p("Server__You_must_enter_a_valid_domain"),mustEnterValidSubDomain:p("Server__You_must_enter_a_valid_subdomain"),mustSelectDomain:p("Server__You_must_select_a_domain_from_the_domains_list"),dialogTitle:p("Server__Domain_settings_titlecase"),dialogTimeout:p("Timeout_trying_to_assign_domain"),dialogSubtitle:t.observable(""),dialogProcessing:p("Server__Updating_domain_settings"),dialogPleaseTryAgain:p("Server__Please_try_again_or_visit_our_help_center"),dialogFinalError:p("Server__Looks_like_the_problem_isnt_going_away"),dnsManagementTitle:p("Server__DNS_management"),dnsManagementLabel:p("Server__DNS_management_titlecase"),domainAliasTitle:p("Server__Domain_alias"),domainAliasLabel:p("Server__Domain_alias_titlecase"),yikes:p("Yikes_we_hit_a_snag"),pleaseTryAgainPart1:p("Server__Please_try_again_or_visit_our_help_center").split("{0}")[0],pleaseTryAgainPart2:p("Server__Please_try_again_or_visit_our_help_center").split("{0}")[1].replace("{1}",""),callTheCavalry:p("Call_the_cavalry"),problemNotGoingAwayPart1:p("Server__Looks_like_the_problem_isnt_going_away").split("{0}")[0],problemNotGoingAwayPart2:p("Server__Looks_like_the_problem_isnt_going_away").split("{0}")[1].replace("{1}",""),loading:p("Loading"),ok:p("OK"),cancel:p("Cancel"),selectAvailableDomain:p("Server__Select_available_domain"),errorLoadingDomains:p("DomainSettingsDialog_Error")},this.urls={dnsManager:"{0}/DNSManagerRedirect.aspx?accountUID={1}".sfFormat(s.hostingCenterUrl,l.Account.OrionAccountUid),domainAlias:"{0}/AliasList.aspx?accountUID={1}".sfFormat(s.hostingCenterUrl,l.Account.OrionAccountUid),support:t.observable("/help/support")},this.areBottomLinksVisible=t.observable(!0),this.isLoadingDomains=t.observable(!1),this.areDomainsLoaded=t.observable(!1),this.isDomainEditable=t.observable(!1),this.attemptedSubmit=t.observable(!1),this.lastDomainSaved=t.observable(l.Account.Domain),this.domainMethod=t.observable(),this.isAvailableSelected=t.computed(function(){return"available"===i.domainMethod()}),this.isExternalSelected=t.computed(function(){return"external"===i.domainMethod()}),this.isSubSelected=t.computed(function(){return"sub"===i.domainMethod()}),this.externalDomain=t.observable(),this.externalDomainCleaned=t.computed(function(){var t=i.externalDomain();return t?e.trim(t.replace(m,"")):t}),this.isExternalDomainValid=t.computed(function(){return c.validateExternalDomain(i.externalDomain(),i.attemptedSubmit())}),this.zoneFileDomains=t.observableArray([]),this.subDomain=t.observable(),this.isSubEnabled=t.computed(function(){return i.zoneFileDomains()&&i.zoneFileDomains().length}),this.isSubDomainValid=t.computed(function(){return c.validateSubDomain(i.subDomain(),i.attemptedSubmit())}),this.selectedZoneFileDomain=t.observable(),this.isSelectedZoneFileDomainValid=t.computed(function(){return i.attemptedSubmit()?i.selectedZoneFileDomain():!0}),this.fullSubDomain=t.computed(function(){var e=i.subDomain();if(!e)return"";e.endsWith(".")&&(e=e.slice(0,-1));var t=i.selectedZoneFileDomain();
return e+"."+t}),this.availableDomains=t.observableArray([]),this.isAvailableEnabled=t.computed(function(){return i.availableDomains()&&i.availableDomains().length}),this.selectedAvailableDomain=t.observable(),this.isSelectedAvailableDomainValid=t.computed(function(){return i.attemptedSubmit()?i.selectedAvailableDomain():!0}),this.currentDomain=t.computed(function(){return"available"===i.domainMethod()?i.selectedAvailableDomain():"external"===i.domainMethod()?i.externalDomainCleaned():"sub"===i.domainMethod()?i.fullSubDomain():g(i.lastDomainSaved())||""}),this.errorMessage=t.computed(function(){return!i.isSubDomainValid()&&i.isSubSelected()?i.strings.mustEnterValidSubDomain:!i.isExternalDomainValid()&&i.isExternalSelected()?i.strings.mustEnterValidDomain:!i.isSelectedZoneFileDomainValid()&&i.isSubSelected()?i.strings.mustSelectDomain:!i.isSelectedAvailableDomainValid()&&i.isAvailableSelected()?i.strings.mustSelectDomain:""}),this.serverErrorMessage=t.observable(),this.isReadyForSubmit=t.computed(function(){return""===i.errorMessage()}),this.isLoadingDomains.subscribe(this.toggleLoadingMessage.bind(this))}var m=/^www\./,b=s.domainSelectorTimeout||1e4;h.prototype=new n,h.prototype.loadDomains=function(e){this.isLoadingDomains()||this.domainsLoadedAtLeastOnce&&e||this.partialResultDetected||(this.isLoadingDomains(!0),a.getDomainOptions({timeout:b}).done(this.onDomainsLoaded.bind(this)).fail(this.onDomainsLoadFailed.bind(this)))},h.prototype.onDomainsLoaded=function(e){var t=e.availableDomains,n=e.zoneFileDomains;e.isDomainEditable?t.pagination.partial===!0||n.pagination.partial===!0?(this.isDomainEditable(!0),this.partialResultDetected=!0,this.areDomainsLoaded(!1)):(this.isDomainEditable(!0),this.availableDomains(t.domains),this.zoneFileDomains(n.domains),this.areDomainsLoaded(!0)):(this.isDomainEditable(!1),this.areDomainsLoaded(!1)),this.isLoadingDomains(!1),this.domainsLoadedAtLeastOnce=!0,e.isDomainEditable&&this.selectInitialChoice()},h.prototype.onDomainsLoadFailed=function(){this.areDomainsLoaded(!1),this.isLoadingDomains(!1),this.domainsLoadedAtLeastOnce=!0,this.selectInitialChoice()},h.prototype.load=function(){this.isLoaded||(e("body").append(u),this.$modal=e("#wsbDomainSelectorDialog"),this.loadSupportUrl(),this.isLoaded=!0)},h.prototype.onOpen=function(){this.areDomainsLoaded()||this.partialResultDetected?this.toggleLoadingMessage(!1):this.loadDomains(),this.emit("open"),window.location.hash="domainsetup"},h.prototype.onClose=function(){this.attemptedSubmit(!1),this.emit("close"),this.serverErrorMessage(""),e("#wsbDomainSelectorAlert").sfAlert("close"),this.serverErrorCount=0,window.location.hash=""},h.prototype.open=function(n){this.isLoaded||this.load(),t.cleanNode(this.$modal[0]),n=n||{},this.strings.dialogSubtitle(n.subtitle?n.subtitle:p("Server__Which_domain_do_you_want_to_use_for_this_site")),this.areBottomLinksVisible(!n.hideLinksOnBottom),delete n.onOpen,delete n.onClose,n=i.extend({autoResize:!0,onOpen:this.onOpen.bind(this),onClose:this.onClose.bind(this),onCancel:this.onClose.bind(this),title:this.strings.dialogTitle,buttons:[{text:this.strings.ok,onClick:this.submit.bind(this)}],message:this.strings.loading},n),n.buttons=n.buttons||[],n.showCancelButton!==!1&&n.buttons.push({text:this.strings.cancel,cancel:!0}),this.$modal.wsbDialog(n),t.applyBindings(this,this.$modal[0]),e("#wsbDomainSelectorDomainOfMineTooltip").sfTipper({wireup:!1,content:e("#wsbDomainSelectorDomainOfMineTooltipContent").html()})},h.prototype.close=function(){this.onClose(),this.$modal.wsbDialog("close")},h.prototype.loadSupportUrl=function(){var e=this;1!==l.Account.ResellerId&&r.Get("/controlpanel/supporturl",function(t){e.urls.support(t)},function(){e.urls.support("#")},!0,!0,b)},h.prototype.selectInitialChoice=function(){var e=g(this.lastDomainSaved());""===e?this.selectInitialChoiceForNoInitialDomain():this.areDomainsLoaded()?this.selectInitialChoiceForDomainsLoaded(e):this.selectInitialChoiceForNoDomainsLoaded(e)},h.prototype.selectInitialChoiceForNoInitialDomain=function(){this.domainMethod(this.areDomainsLoaded()?this.isAvailableEnabled()?"available":this.isSubEnabled()?"sub":"external":"external")},h.prototype.selectInitialChoiceForDomainsLoaded=function(e){var t=c.getDomainParts(e),n=t.domainAndTld.toLowerCase(),a=i.indexOf(this.zoneFileDomains(),n)>=0,r=i.indexOf(this.availableDomains(),n)>=0;if(t.sub&&this.subDomain(t.sub),a){if(this.selectedZoneFileDomain(n),!r){var o=this.availableDomains();o.push(n),o.sort(),this.availableDomains(o)}this.selectedAvailableDomain(n)}this.externalDomain(e.toLowerCase()),this.domainMethod(t.sub?"sub":a?"available":"external")},h.prototype.selectInitialChoiceForNoDomainsLoaded=function(e){this.externalDomain(e.toLowerCase()),this.domainMethod("external")},h.prototype.hasDomainNotChanged=function(){return this.currentDomain().toLowerCase()===this.lastDomainSaved().toLowerCase()},h.prototype.toggleProcessingMessage=function(e){this.toggleMessage(e?this.strings.dialogProcessing:null)},h.prototype.toggleLoadingMessage=function(e){this.toggleMessage(e?this.strings.loading:null)},h.prototype.toggleMessage=function(e){this.$modal&&this.$modal.wsbDialog({message:e||null})},h.prototype.submit=function(){if(this.attemptedSubmit(!0),this.isReadyForSubmit()){if(this.hasDomainNotChanged())return void this.close();this.toggleProcessingMessage(!0),this.serverErrorMessage(""),e("#wsbDomainSelectorAlert").sfAlert("close"),r.Post("/api/websites/{websiteId}/websitedomain",{OrionAccountUid:l.Account.OrionAccountUid,DomainName:this.currentDomain()},this.onSubmitSuccess.bind(this),this.onSubmitFailure.bind(this),null,null,b)}},h.prototype.onSubmitSuccess=function(){var e=this.currentDomain();this.lastDomainSaved(e),this.emit(this.events.domainChanged,e),a.seoProjectReplay(e,"wsb-domain-selector"),r.Post("/api/websites/{websiteId}/SeoProjectReplay?domain="+e,null,function(){d.trackEvent("wsb-seo-editor","SeoProjectReplay","success")},function(){d.trackEvent("wsb-seo-editor","SeoProjectReplay","failed")}),this.toggleProcessingMessage(!1),this.close()},h.prototype.onSubmitFailure=function(e,t){var n,i;"timeout"===t?(n=this.strings.dialogTimeout,i=!0):(n=JSON.parse(e.responseText).Message,i="true"===JSON.parse(e.responseText).Display),this.toggleProcessingMessage(!1),i?this.serverErrorMessage(n):this.showServerError()},h.prototype.showServerError=function(){this.serverErrorCount++,e("#wsbDomainSelectorAlert").sfAlert(this.serverErrorCount<3?{style:"error",message:e("#wsbDomainSelectorError").html()}:{style:"error",message:e("#wsbDomainSelectorFinalError").html()})},h.prototype.errorLinkClick=function(){return d.linkAnchor(e(this))};var f=new h;return f}),define("common/session/sessionCheck",["jquery","common/alertbox/alertbox","common/cookiemanager/cookiemanager","common/persistence/persistence"],function(e,t,n,i){var a=function(){function a(e,t,n){u||(u=!0,r(e,t,n))}function r(e,t,i){c||window.setTimeout(function(){if(!c){var a=(window.location.toString(),n.getCookie(e));return a!==t?void o():void s(i).then(function(n){n?r(e,t,i):o()},function(){++g>2?o():r(e,t,i)})}},5e3)}function o(){c||t.show({cancelDisabled:!0,closeOnEscape:!1,message:e("#template-session-check").html(),onOkKeepOpen:!0,onOpen:function(e){e.siblings(".sf-dialog").hide()},okCallback:function(){for(var e=0;e<p.length;e++)try{p[e]()}catch(t){}window.location.reload()}})}function s(t){var n=e.Deferred();return i.Get("/Session/IsValid?issuedSessionId="+encodeURIComponent(t),function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise()}function l(e){"function"==typeof e&&p.push(e)}function d(){c=!0}var c=!1,u=!1,p=[],g=0;return{init:a,subscribe:l,disable:d}}();return a}),define("common/session/sso",["jquery"],function(e){var t=function(){var t="idpKeepAlive",n=3e5,i=function(r){window.setTimeout(function(){i(r)},n),e("#"+t).remove();var o=-1===r.indexOf("?")?"?":"&",s=r+o+Math.random();a(s)},a=function(n){var i=e("<img />").attr({id:t,src:n,alt:"Keep Alive",height:"1px",width:"1px",style:"display:none"});e("body").append(i)};return{keepAlive:function(e){i(e)}}}();return t}),define("modules/setup/setup",["jquery","modules/controlPanel/domainSettingsDialog","modules/domainselector2/domainselector","modules/welcome/welcomeDialog","common/abTesting/abTesting","common/session/sessionCheck","common/session/sessionTimeout","common/session/sso"],function(e,t,n,i,a){function r(i){s?n.open({title:e("#template-setupdomain-title").html(),subtitle:e("#template-setupdomain-subtitle").html(),cancelDisabled:!0,closeOnEscape:!1,hideLinksOnBottom:!0,showCancelButton:!1}):t.init({cancelDisabled:!0,closeOnEscape:!1,title:e("#template-setupdomain-title").html(),subtitle:e("#template-setupdomain-subtitle").html(),autoResize:!0,showLinks:!1,showCancelButton:!1,from:i&&i.from||null})}function o(){i.getInstance().showDialog()}var s="enabled"===a.getOption("newDomainSelector");return{showDomainSelector:r,showWelcomeModal:o}}),define("modules/domainSelector3/domainSelector3Warning/domainSelector3Warning",["knockout","jquery","text!/assets/modules/domainSelector3/domainSelector3Warning/domainSelector3Warning.html","css!/assets/modules/domainSelector3/domainSelector3Warning/domainSelector3Warning.css"],function(e,t,n){function i(e){var t=this;t.message=e.message,t.containerClassName="wsbDomainWarningContainer"+e.type}return t(n).appendTo("body"),e.bindingHandlers.domainWarning={init:function(n,a){var r=new i(a()),o=t("<div data-bind=\"template: 'domainWarning'\"></div>").appendTo(n);return e.applyBindings(r,o.get(0)),{controlsDescendantBindings:!0}}},i}),define("modules/domainSelector3/domainSelector3Options/domainSelector3Options",["knockout","jquery","strings","websiteSettings","websiteInfo","modules/domainSelector3/domainSelector3Warning/domainSelector3Warning","text!/assets/modules/domainSelector3/domainSelector3Options/domainSelector3Options.html","css!/assets/modules/domainSelector3/domainSelector3Options/domainSelector3Options.css"],function(e,t,n,i,a,r,o){function s(){var t=this;t.Strings={domainOptionsTitle:n.Your_domain_is_the_website,domainOptionsTitleLink:n.Purchase_a_custom_domain,period:n.Period,defaultDomainLabel:n.Use_default_domain,externalDomainLabel:n.Use_domain_registered_elsewhere,externalDomainPlaceholder:n.Enter_Domain,externalDomainWarning:n.External_Domain_Warning},t.defaultDomainValue=i.DpsSubdomain,t.externalDomain=e.observable(""),t.currentDomain=e.observable(i.DpsSubdomain()),t.currentDomain.subscribe(function(e){a.ko.domainToPublish(e)}),t.externalDomain.subscribe(function(e){t.currentDomain(e)}),t.externalDomainWarningFormatted=e.computed(function(){var e="<a href='/help/article/12318' target='_blank'>"+n.Update_Your_DNS+"</a>";return n.External_Domain_Warning.replace("{0}",e)}),t.domainWarningModel={message:t.externalDomainWarningFormatted,type:"Warning"},t.optionValues={"default":"default",external:"external"},t.selectedOptionValue=e.observable(t.optionValues.default),a.ko.publishDomainOption(t.optionValues.default),t.selectedOptionValue.subscribe(function(){a.ko.publishDomainOption(t.selectedOptionValue())}),t.isExternalSelected=e.computed(function(){return t.selectedOptionValue()===t.optionValues.external}),t.externalTextEnabledState=e.computed(function(){return t.isExternalSelected()?void 0:"disabled"}),t.isExternalSelected.subscribe(function(e){t.currentDomain(e?t.externalDomain():t.defaultDomainValue())})}return t(o).appendTo("body"),e.bindingHandlers.domainSelectorOptions={init:function(n,i){var a=new s(i()),r=t("<div data-bind=\"template: 'domainSelectorOptions'\"></div>").appendTo(n);return e.applyBindings(a,r.get(0)),{controlsDescendantBindings:!0}}},s}),define("modules/domainSelector3/domainSelector3Result/domainSelector3Result",["knockout","jquery","strings","userData","appconfig","text!/assets/modules/domainSelector3/domainSelector3Result/domainSelector3Result.html","css!/assets/modules/domainSelector3/domainSelector3Result/domainSelector3Result.css"],function(e,t,n,i,a,r){function o(t){var n=this;n.isReseller=i.isReseller,n.iconClass=e.computed(function(){var e=t.resultType();return"domain-selector-result-icon-"+e}),n.title=t.title,n.domain=t.domain,n.message=t.message}return t(r).appendTo("body"),e.bindingHandlers.domainSelectorResult={init:function(n,i){var a=new o(i()),r=t("<div data-bind=\"template: 'domainSelectorResult'\"></div>").appendTo(n);return e.applyBindings(a,r.get(0)),{controlsDescendantBindings:!0}}},o}),define("modules/domainSelector3/domainSelector3",["jquery","knockout","strings","websiteInfo","websiteSettings","userData","common/logger/serverLogger","common/persistence/persistence","common/stats/googleanalytics","common/api/websites/websitesAPI","designer/app/builder/ui/controls/publish/publish","designer/netpromoter/netpromoter","modules/setup/setup","modules/domainSelector3/domainSelector3Options/domainSelector3Options","modules/domainSelector3/domainSelector3Result/domainSelector3Result","text!/assets/modules/domainSelector3/domainSelector3.html","css!/assets/modules/domainSelector3/domainSelector3.css","wsbcore/dialog","wsbcore/tipper","wsbcore/overlay"],function(e,t,n,i,a,r,o,s,l,d,c,u,p,g,h,m){function b(){var e=this;e.domainPublishFailures=t.observable(0),e.resultStates={NONE:"NONE",SUCCESS:"SUCCESS",SUCCESS_WAIT:"SUCCESS_WAIT",WARNING:"WARNING",YIKES:"YIKES"},e.dnsStates={NONE:"NONE",CHECKING:"CHECKING",SETUP:"SETUP",NOT_SETUP:"NOT_SETUP",ERROR:"ERROR"},e.publishStates={NONE:"NONE",SUCCESS:"SUCCESS",FAIL:"FAIL",PROCESSING:"PROCESSING",ERROR:"ERROR"},e.resultsModel={resultType:t.observable(),title:t.observable(),domain:t.observable(),message:t.observable()},e.dnsState=t.observable(e.dnsStates.NONE),e.publishState=t.observable(e.publishStates.NONE),e.resultState=t.computed(function(){var t=e.dnsState(),n=e.publishState();if(t===e.dnsStates.CHECKING)return e.resultStates.NONE;if(n===e.publishStates.ERROR)return e.resultStates.YIKES;if((t===e.dnsStates.ERROR||t===e.dnsStates.NOT_SETUP)&&n!==e.publishStates.NONE)return e.resultStates.WARNING;if(n===e.publishStates.SUCCESS){if(t===e.dnsStates.SETUP||t===e.dnsStates.NONE)return e.resultStates.SUCCESS}else{if(n===e.publishStates.PROCESSING)return e.resultStates.SUCCESS_WAIT;if(n===e.publishStates.FAIL)return e.resultStates.YIKES}return e.resultStates.NONE}),e.resultState.subscribe(function(t){var n=t;if(n===e.resultStates.NONE)e.resultsModel.resultType(null),e.resultsModel.title(null),e.resultsModel.message(null),e.resultsModel.domain(null);else if(n===e.resultStates.SUCCESS){e.resultsModel.resultType("checkmark"),e.resultsModel.title(e.Strings.congratulations),e.resultsModel.domain(c.getHostingDomain(i.ko.domainToPublish()));var a=e.Strings.congratulations_1,r=e.resultsModel.domain(),o=c.getHostingUrlPrefix(),s=o+r,l='<a href="'+s+'" target="_blank" data-aid="domain-selector-success-link">'+r+"</a>",d=a.replace("{0}",l).replace("{0}",r);e.resultsModel.message(d)}else if(n===e.resultStates.SUCCESS_WAIT){e.resultsModel.resultType("checkmark"),e.resultsModel.title(e.Strings.congratulations),e.resultsModel.domain(i.ko.domainToPublish());var a=e.Strings.congratulations_2,r=e.resultsModel.domain(),o=c.getHostingUrlPrefix(),s=o+r,l='<a href="'+s+'" target="_blank" data-aid="domain-selector-success-link">'+r+"</a>",d=a.replace("{0}",l).replace("{0}",r);e.resultsModel.message(d)}else if(n===e.resultStates.WARNING){e.resultsModel.resultType("warning"),e.resultsModel.title(e.Strings.domainErrorTitle);var u=e.Strings.domainErrorMessage1,p=u.replace("{0}",'<span class="bold">'+i.ko.domainToPublish()+"</span>"),g=e.Strings.domainErrorMessage2,h='<a href="/help/support" target="_blank data-aid="domain-selector-support-link">{0}</a>',m=g.replace("{0}",h).replace("{0}",e.Strings.support),a=p+"<br><br>"+m;e.resultsModel.domain(null),e.resultsModel.message(a)}else if(n===e.resultStates.YIKES){e.resultsModel.resultType("warning"),e.resultsModel.title(e.Strings.yikes),e.resultsModel.domain(null);var a=e.Strings.setupError,h='<a href="/help/support" target="_blank data-aid="domain-selector-support-link">{0}</a>',b=a.replace("{0}",h).replace("{0}",e.Strings.contactSupport);e.resultsModel.message(b)}}),e.showOptions=t.computed(function(){return e.resultState()===e.resultStates.NONE}),e.showResult=t.computed(function(){return e.resultState()!==e.resultStates.NONE}),e.showSuccess=t.computed(function(){return e.resultState()===e.resultStates.SUCCESS}),e.showSuccessWait=t.computed(function(){return e.resultState()===e.resultStates.SUCCESS_WAIT}),e.showWarning=t.computed(function(){return e.resultState()===e.resultStates.WARNING}),e.showYikes=t.computed(function(){return e.resultState()===e.resultStates.YIKES}),e.Strings={dialogTitle:n.Website_Publishing,loading:n.Loading,publish:n.Publish,cancel:n.Cancel,processing:n.Server__Updating_domain_settings,okGotIt:n.Client__SEO__WelcomeModalButton,ok:n.OK,defaultDomainTooltip:n.You_can_use_this,yikes:n.Client__Designer__Yikes_hit_a_snag,congratulations:n.Congratulations,congratulations_1:n.Congratulations_your_website_is_now_live_at,congratulations_2:n.Congratulations_your_website_is_set_up,contactSupport:n.Contact_Support_Lower,support:n.Support,domainErrorTitle:n.It_looks_like_your_domain,domainErrorMessage1:n.For_your_site_to_display,domainErrorMessage2:n.If_youre_not_too_comfortable,setupError:n.Domain_chooser_set_up_error},e.isLoadingDomains=t.observable(!1),e.isLoadingDomains.subscribe(e.toggleLoadingMessage.bind(e)),e.buttons=t.computed(function(){var t,i=e.resultState();return i===e.resultStates.NONE?t=[{text:e.Strings.publish,onClick:e.handleSubmit.bind(e)},{text:e.Strings.cancel,cancel:!0,style:"link"}]:i===e.resultStates.SUCCESS?t=[{text:e.Strings.ok,onClick:e.close.bind(e)}]:i===e.resultStates.SUCCESS_WAIT?t=[{text:e.Strings.okGotIt,onClick:e.close.bind(e)}]:i===e.resultStates.YIKES?t=[{text:e.Strings.ok,onClick:e.close.bind(e)}]:i===e.resultStates.WARNING&&(t=[{text:n.Help_me_fix_this,onClick:e.handleHelpMe.bind(e)},{text:n.Check_Again,cancel:!1,onClick:e.handleCheckAgain.bind(e)}]),t||[]})}var f;return b.prototype._mountComponent=function(n){var i=e("<div></div>"),a=e(m);i.append(a),e("body").append(i);var r=e("#"+n)[0];return t.applyBindings(this,r),i},b.prototype._mountTooltips=function(t){var n=this;n.$container.on("click","#"+t+" span.sf-tip",function(){var t=e(this);t.hasClass("sf-tipper-target")?l.trackEvent("wsb-domain-selector","default-domain-info","click"):e(this).sfTipper({content:n.Strings.defaultDomainTooltip,style:"howl"}).trigger("click")})},b.prototype._trackOpen=function(){l.trackEvent("wsb-domain-selector-modal","show-dialog"),o.post({action:"domainSelectorModalShown"},o.level.Information)},b.prototype._showDialog=function(){var e=this;e.$container.wsbDialog({autoResize:!1,title:e.Strings.dialogTitle,destroyOnClose:!1,onClose:e.onClose.bind(e),onCancel:e.onClose.bind(e),buttons:e.buttons()})},b.prototype._loadDomains=function(){var e=this;e.isLoadingDomains(!0),d.getDomainOptions({timeout:1e4}).done(e._onDomainsLoaded.bind(e)).fail(e._onDomainsLoadFailed.bind(e))},b.prototype._onDomainsLoaded=function(e){var t=this;if(t.isLoadingDomains(!1),e&&e.availableDomains&&e.availableDomains.domains&&e.availableDomains.domains.length||r.isReseller){t.close();var n={from:"noDomain"};p.showDomainSelector(n)}},b.prototype._onDomainsLoadFailed=function(){},b.prototype.toggleProcessingMessage=function(e){this.toggleMessage(e?this.Strings.processing:null)},b.prototype.toggleLoadingMessage=function(e){this.toggleMessage(e?this.Strings.loading:null)},b.prototype.toggleMessage=function(e){this.$container&&this.$container.wsbDialog({message:e||null})},b.prototype._checkDNS=function(){var e=this,t=i.ko.domainToPublish();e.dnsState(e.dnsStates.CHECKING),s.Get("/api/websites/{websiteId}/websitedomain/DoesHostResolveToDps?host="+t,e._onCheckDNSSuccess.bind(e),e._onCheckDNSFailure.bind(e),null,null,1e4)},b.prototype._onCheckDNSSuccess=function(e){var t=this;t.dnsState(e&&e.resolvesToDps?t.dnsStates.SETUP:t.dnsStates.NOT_SETUP)},b.prototype._onCheckDNSFailure=function(){var e=this;e.dnsState(e.dnsStates.ERROR)},b.prototype.handleSubmit=function(){var e=this;"default"===i.ko.publishDomainOption()&&i.ko.domainToPublish(a.DpsSubdomain());var t=i.ko.domainToPublish();if(t){e.toggleProcessingMessage(!0),"external"===i.ko.publishDomainOption()&&e._checkDNS();var n=85e3;s.Post("/api/websites/{websiteId}/websitedomain",{OrionAccountUid:i.Account.OrionAccountUid,DomainName:t},e.publish.bind(e),e.onSubmitFailure.bind(e),null,null,n)}},b.prototype.handleCheckAgain=function(){"external"===i.ko.publishDomainOption()&&this._checkDNS(),this.publish()},b.prototype.publish=function(){var e=this;e.toggleProcessingMessage(!1);var t=i.ko.domainToPublish();i.ko.domain(t),i.Account.Domain=t,d.seoProjectReplay(i.ko.domainToPublish(),"wsb-new-domain-selector"),e.close(),c.publishAndCheckDpsDns(function(t){"fail"===t?e.publishState(e.publishStates.FAIL):"success"===t?e.publishState(e.publishStates.SUCCESS):"processing"===t?e.publishState(e.publishStates.PROCESSING):"dnserror"===t&&e.publishState(e.publishStates.ERROR),setTimeout(function(){e._showDialog()},1e3)},!0)},b.prototype.onSubmitFailure=function(){var e=this;e.domainPublishFailures(e.domainPublishFailures()+1),e.domainPublishFailures()%2===1?e.handleSubmit():(e.toggleProcessingMessage(!1),e.publishState(e.publishStates.ERROR),e._showDialog())},b.prototype.handleHelpMe=function(){window.open("/help/article/12318")},b.prototype.onClose=function(){var e=this;e.domainPublishFailures(0),e.publishState()===e.publishStates.SUCCESS&&(u.initModule(),u.showSurvey())},b.prototype.open=function(e){var t=this;t.$container||(t.$container=t._mountComponent("wsbDomainSelectorDialog"),t._mountTooltips("wsbDomainSelectorDialog")),t.dnsState(t.dnsStates[e]||t.dnsStates.NONE),t.publishState(t.publishStates.NONE),t._trackOpen(),t._showDialog(),e||t._loadDomains()},b.prototype.close=function(){var e=this;e.onClose(),e.$container.wsbDialog("close")},f=new b}),define("text!designer/app/builder/ui/header/publish/publish.html",[],function(){return'<div class="header-publish-button" data-bind="visible: visible">\r\n  <a id="headerPublishButton" class="btn btn-success wsb-action-publish" data-aid="actionbar-publishbutton" data-bind="css: {\'disabled\': isPublishing}, click: publish">\r\n    <i class="icon-ok icon-white"></i>\r\n    <span data-bind="text: buttonText"></span>\r\n  </a>\r\n</div>\r\n'}),define("designer/app/builder/ui/header/publish/publish",["jquery","designer/app/builder/data/data","designer/app/app","lodash","knockout","websiteInfo","userData","/i18n/resources/client","common/abTesting/abTesting","common/logger/serverLogger","designer/app/builder/ui/controls/publish/publish","modules/domainSelector3/domainSelector3","text!designer/app/builder/ui/header/publish/publish.html"],function(e,t,n,i,a,r,o,s,l,d,c,u,p){function g(){var e=this;e.i18N={Publish:s.resources.Publish,Staging:s.resources.Server__Stage_publish},e.showStaging=a.computed(function(){var e;if(m.DesignLock){var t=m.DesignLock||"false";e=t.toLowerCase()}return"true"===e||"1"===e}),e.buttonText=a.computed(function(){return e.showStaging()?e.i18N.Staging:e.i18N.Publish}),e.visible=a.computed(function(){return!b.address.isSeoAction()&&!b.theme.isThemeEditMode}),e.isPublishing=o.isPublishingWebsite,e.loadedDomainSelector=a.observable(!1)}function h(e){e.showStaging()&&(f.logo.attr("class","wsb-lock"),f.headerBar.css("border-bottom","4px solid #BE2121"))}var m,b,f={},v={notLoaded:0,loading:1,loaded:2},y=v.notLoaded;g.prototype.publish=function(){d.logFirstClick("publish");var e=this;return l.isEnabled("useNoDomainSelector")&&"Unknown"===r.ko.domain()?(u.open(),void e.loadedDomainSelector(!0)):(e.loadedDomainSelector(!1),void(e.isPublishing()||c.publishAndCheckDpsDns(function(t){l.isEnabled("ignorePubDpsError")||("dnsError"===t?u.open("NOT_SETUP"):"notSetupUseNoDomain"===t&&u.open(),e.loadedDomainSelector(!0))})))};var _=function(i,r){if(b=t.getDataModel(),m=b.settings,y=v.loading,y==v.loading){var o=n.getMap();f.header=i,f.logo=o.logo,f.headerBar=o.headerBar,f.button=e(p).appendTo(i);var s=new g;return a.applyBindings(s,f.header[0]),h(s),y=v.loaded,r&&r(null,"publish"),s}};return{load:_,state:function(){return y}}}),define("text!designer/app/builder/ui/header/saver/saver.html",[],function(){return'<span class="wsb-changes-text" data-bind="text: message(), visible: visible"></span>\r\n<span class="header-icon save sf-tip" data-style="qt" data-bind="visible: visible, click: save, css: { enabled: canSave, disabled: !canSave() }, attr: { \'data-content\': Strings.Save }, ga: { click: { category: \'designer_header\', action: \'save\', label: \'button\' } }" data-aid="ab-savedesigner"></span>\r\n'}),define("designer/app/builder/ui/header/saver/saver",["jquery","designer/app/builder/data/data","knockout","/i18n/resources/client","text!designer/app/builder/ui/header/saver/saver.html"],function(e,t,n,i,a){function r(){var e=this,t=["Save"];e.visible=s.address.isEditAction,e.save=function(){return d.save()},e.message=n.computed(function(){var e=d.getCurrentState();return e.isSaving?i.resources.Saving_ellipsis:e.isDirty?"":i.resources.All_Changes_Saved}),e.canSave=n.computed(function(){return 0===d.getCurrentState().state()}),e.Strings={},t.forEach(function(t){e.Strings[t]=i.resources[t]})}function o(e,i){l.saver=e.append(a),s=t.getDataModel();var o=new r;return n.applyBindings(o,l.saver[0]),l.saver.find(".sf-tip").sfTipper({wireup:!0}),i&&i(null,"saver"),o}var s,l={},d=t.saver;return{load:o}}),define("text!designer/app/builder/ui/header/undoer/undoer.html",[],function(){return"<span class=\"header-icon undo sf-tip\" data-style=\"qt\" data-aid=\"ab-undo\" data-bind=\"visible: visible, click: undo, attr: { 'data-content': Strings.Server__Undo}, css: {disabled: !canUndo() }, ga: { click: { category: 'designer_header', action: 'undo', label: 'button' } }\"></span>\r\n<span class=\"header-icon redo sf-tip\" data-style=\"qt\" data-aid=\"ab-redo\" data-bind=\"visible: visible, click: redo, attr: { 'data-content': Strings.Server__Redo}, css: {disabled: !canRedo() }, ga: { click: { category: 'designer_header', action: 'redo', label: 'button' } }\"></span>"}),define("designer/app/builder/ui/header/undoer/undoer",["designer/app/event","jquery","designer/app/builder/data/data","lodash","knockout","/i18n/resources/client","text!designer/app/builder/ui/header/undoer/undoer.html"],function(e,t,n,i,a,r,o){function s(e){var t=this,n=["Server__Undo","Server__Redo"];t.visible=e.address.isEditAction,t.undo=d.undo,t.redo=d.redo,t.Strings={},n.forEach(function(e){t.Strings[e]=r.resources[e]}),t.canUndo=d.getCurrentState().canUndo,t.canRedo=d.getCurrentState().canRedo}var l={},d=n.undoer,c=function(e,t){l.undoer=e.append(o);var i=n.getDataModel(),r=new s(i);a.applyBindings(r,l.undoer[0]),l.undoer.find(".sf-tip").sfTipper({wireup:!0}),t&&t(null,"undoer")};return{load:c}}),define("text!designer/app/builder/ui/header/links/links.html",[],function(){return'<nav id="builder-header-links" data-bind="if: visible">\r\n    <ul class="prev-pnl-menu clearfix">\r\n        <li>\r\n            <a data-bind="click: previewDesktop, css: { \'prev-pnl-menu-a-active\': isPreviewDesktop }, text: i18Dict[\'Server__Preview_desktop\']" data-aid="ab-previewdesktop">              \r\n            </a>\r\n        </li>\r\n        <li data-bind="visible: mobileEnabled">\r\n            <a data-bind="click: previewMobile, css: { \'prev-pnl-menu-a-active\': isPreviewMobile }, text: i18Dict[\'Server__Preview_mobile\']" data-aid="ab-previewmobile">\r\n            </a>\r\n        </li>\r\n        <!--ko if: showSocialLink()-->\r\n        <li>\r\n            <a id="actionBarSocialPreview" data-bind="click: onSocialTabClick, css: { \'prev-pnl-menu-a-active\': isSocial }, text: i18Dict[\'Client_SocialBranding_Preview_TabLabel\']" data-aid=" ab-previewsocial">Social</a>\r\n        </li>\r\n        <!--/ko-->\r\n    </ul>\r\n</nav>\r\n'}),define("designer/app/builder/ui/header/links/links",["jquery","designer/app/builder/data/data","designer/app/builder/managers/addressManager","lodash","knockout","/i18n/resources/client","text!designer/app/builder/ui/header/links/links.html","common/stats/googleanalytics"],function(e,t,n,i,a,r,o,s){function l(){function e(){return o.isApiReseller&&i.LastKnownAccountType<20?!1:"False"!==i.MobileEnabled}{var t=this,i=d.settings,o=d.user,l=d.address;d.config}t.i18Dict=r.resources,t.visible=a.computed(function(){return l.isPreviewAction()||l.currentAction()===n.actions.social}),t.isPreviewMobile=a.computed(function(){return l.isMobile()&&l.currentAction()!=n.actions.social}),t.isPreviewDesktop=a.computed(function(){return l.isDesktop()&&l.currentAction()!=n.actions.social}),t.previewDesktop=function(){l.currentAction(n.actions.preview),l.currentPlatform(n.platforms.desktop),s.trackEvent("preview","desktop","tab")},t.previewMobile=function(){l.currentAction(n.actions.preview),l.currentPlatform(n.platforms.mobile),s.trackEvent("preview","mobile","tab")},t.onSocialTabClick=function(){l.currentAction(n.actions.social)},t.isSocial=a.computed(function(){return l.currentAction()==n.actions.social}),t.mobileEnabled=a.observable(e()),t.showSocialLink=function(){return"ThemeEditMode"===o.editingMode?!1:o.isDdtDesigner?!1:o.isFreeTrialAccount?!1:"1"===i.IsDdtAccount&&o.isDdtImpersonator?!1:o.isApiReseller&&i.LastKnownAccountType<30?!1:!0},t.visible.subscribe(function(){t.mobileEnabled(e())})}var d,c={},u=function(e,n){c.header=e.append(o),d=t.getDataModel();var i=new l;return a.applyBindings(i,c.header[0]),n&&n(null,"links"),i};return{load:u}}),define("text!designer/app/builder/ui/header/title/title.html",[],function(){return'<div class="app-header-title" >    \r\n    <!--ko ifnot: isThemeEditMode-->\r\n    <span class="wsb-actionbar-pl" data-bind="text: i18N.Server__Website"></span><span class="wsb-actionbar-product" data-bind="text:i18N.Builder"></span>\r\n    <span class="wsb-actionbar-product" data-bind="text:version"></span>\r\n    <!--/ko-->\r\n    <!--ko if: isThemeEditMode-->\r\n    <span class="wsb-editing-label" data-bind="text: i18N.Server__Editing_colon"> </span>\r\n    <span data-bind="text: templateName" class="wsb-edit-theme-name"></span>\r\n    <!--/ko-->\r\n</div>\r\n\r\n<span data-bind="visible: previewTitleVisible, text: i18N.PreviewMode"></span>\r\n'}),define("designer/app/builder/ui/header/title/title",["designer/app/event","jquery","designer/app/builder/data/data","lodash","knockout","/i18n/resources/client","designer/app/builder/managers/addressManager","text!designer/app/builder/ui/header/title/title.html"],function(e,t,n,i,a,r,o,s){function l(){var e=d.address;if(this.previewTitleVisible=a.computed(function(){return e.isPreviewAction()||e.currentAction()==o.actions.social}),this.i18N={Server__Website:r.resources.Server__Website,PreviewMode:r.resources.Server__Preview_Mode,Builder:r.resources.Builder,Server__Editing_colon:r.resources.Server__Editing_colon},this.isThemeEditMode=d.theme.isThemeEditMode,this.version=d.config.version,this.templateName=a.observable(""),this.isThemeEditMode){var t=d.theme.getThemeData();this.templateName(t.Name)}}var d,c={},u=function(e,t){c.header=e.append(s),d=n.getDataModel();var i=new l;a.applyBindings(i,c.header[0]),t&&t(null,"title")};return{load:u}}),define("text!designer/app/builder/ui/header/themeLocale/themeLocale.html",[],function(){return'<!-- ko if: hasChildLocales -->\r\n<div id="wsb-theme-locale-selector">\r\n    <label data-bind="text: Strings.Server__ActionBar_ThemeEditMode_LocaleDropdownLabel"></label>\r\n    <ul data-bind="dropList: { value: themeLocale, selectedText: themeLocaleName, cssClass: \'wsb-theme-locale-drop-list\', listMaxHeight: 400 }">\r\n        <li data-value="" class="wsb-theme-locale-drop-list-item">\r\n            <div data-main="true">Master</div>\r\n        </li>\r\n        <!-- ko foreach: childLocales -->\r\n        <li data-bind="attr: { \'data-value\': Wsb_Locale }" class="wsb-theme-locale-drop-list-item">\r\n            <div data-main="true" data-bind="text: LocaleDescription"></div>\r\n        </li>\r\n        <!-- /ko -->\r\n    </ul>\r\n</div>\r\n<!-- /ko -->\r\n\r\n'
}),define("designer/app/builder/ui/header/themeLocale/themeLocale",["jquery","knockout","designer/app/builder/data/data","designer/app/builder/data/designerData","designer/app/builder/managers/themeManager","/i18n/resources/client","text!designer/app/builder/ui/header/themeLocale/themeLocale.html"],function(e,t,n,i,a,r,o){function s(){var e=this;if(this.isThemeEditMode=c.theme.isThemeEditMode,this.childLocales=t.observableArray([]),this.hasChildLocales=t.computed({read:function(){var t=e.childLocales();return!(!t||!t.length)},deferEvaluation:!0}),this.Strings={Server__Editing_colon:r.resources.Server__Editing_colon,Server__ActionBar_ThemeEditMode_LocaleDropdownLabel:r.resources.Server__ActionBar_ThemeEditMode_LocaleDropdownLabel},this.themeLocale=a.themeLocale,this.themeLocaleName=a.themeLocaleName,u.isThemeEditMode){var n=u.getThemeData();n&&this.childLocales(n.ChildLocales)}}function l(e,i){c=n.getDataModel(),u=c.theme,d=e.append(o);var a=new s;t.applyBindings(a,d[0]),i(null,"locale")}var d,c,u;return{load:l}}),define("designer/app/builder/ui/header/header",["jquery","designer/app/app","designer/app/event","text!designer/app/builder/ui/header/header.html","libs/async-util/async","designer/app/builder/ui/uiHelper","designer/app/builder/data/data","designer/app/builder/ui/header/pageswitcher/pageswitcher","designer/app/builder/ui/header/hamburger/hamburger","designer/app/builder/ui/header/preview/preview","designer/app/builder/ui/header/publish/publish","designer/app/builder/ui/header/saver/saver","designer/app/builder/ui/header/undoer/undoer","designer/app/builder/ui/header/links/links","designer/app/builder/ui/header/title/title","designer/app/builder/ui/header/themeLocale/themeLocale"],function(e,t,n,i,a,r,o,s,l,d,c,u,p,g,h,m){var b={pageswitcher:s,hamburger:l,preview:d,publish:c,saver:u,undoer:p,links:g,title:h,themeLocale:m},f={},v=[],y=function(n,o){t.addHeader(i,"builder","builder-header"),f.header=o.find("#builder-header"),0===f.header.length&&(f.header=e("#builder-header")),f.header.mousedown(function(e){r.closeFlyouts(e)}),a.map(Object.keys(b),function(t,n){v.push(b[t]),b[t].load(e("#header-"+t),n)},function(e,t){n(e,t)})};return window.UnloadingPage=!1,{load:y,getConfiguration:function(){return{modules:b}}}}),define("designer/app/builder/ui/controls/toolbox/hint",["jquery","knockout","designer/app/event","common/stats/googleanalytics","designer/app/builder/data/data","websiteSettings","wsbcore/context","common/persistence/persistence","common/logger/serverLogger","/i18n/resources/client"],function(e,t,n,i,a,r,o,s,l,d){function c(){var e=this,n=17;e.i18Dict={DontShowAgain:d.resources.Server__Dont_show_again,Ok:d.resources.OK,DragTheseElementsOntoThePage:d.resources.Server__Drag_these_elements_onto_the_page},e.dontShowAgainChecked=t.observable(!1),e.anchorY=t.observable(0),e.top=t.computed(function(){var t=e.anchorY();return 0===t?"0":t+"px"}).extend({throttle:{type:"throttle",delay:n}}),e.close=function(e){var t=e.dontShowAgainChecked();i.trackEvent("wsb-designer-toolbox-flyout","ok",t?"dont-show-again":void 0),h(),t&&s.Post("/api/websites/{websiteId}/websitesettings",{ToolboxDraggingHintDismissDate:(new Date).toISOString()}),l.logFirstClick("hint")}}var u,p,g=function(n){var i=a.getDataModel();i.address.isDesktopEditAction()&&(!r.ChalkOverlayDismissDate||r.ToolboxDraggingHintDismissDate||i.theme.isThemeEditMode||(p=i.address.isDesktopEditAction.subscribe(function(e){e||(h(),p.dispose())}),u=e("<div data-bind=\"template: 'toolbox-drag-hint-template'\"/>").sfContext({anchor:n,positionIdeal:"tl",autoOpen:!0,closeOnBlur:!1,zIndex:999999,onOpen:function(e){e.closest(".sf-flyout").addClass("wsb-toolbox-flyout");var n=new c;t.cleanNode(e[0]),t.applyBindings(n,e[0])}})))},h=function(){u&&u.sfContext("destroy")};return n.on(n.events.flyoutClose,function(){h()}),{init:g,hide:h}}),define("text!designer/app/builder/ui/controls/actionmenu/actionmenu.html",[],function(){return"<ul data-aid=\"builder-actionmenu\"     \r\n    data-bind=\"visible: visible,\r\n            attr: { 'class': 'wsb-actionmenu ' + menuStyle },\r\n            style: { top: top, left: left },\r\n            event: { contextmenu: function (vm, e) { e.preventDefault(); return false; } },\r\n            template: { name: 'action-menu-item-' + menuStyle, foreach: menuItems }\"></ul>\r\n\r\n<script type=\"text/html\" id=\"action-menu-item-horizontal\">\r\n    <!-- ko if: $data.visible === undefined || visible() -->\r\n    <li data-bind=\"\r\n            attr: {\r\n                'class': (ko.utils.unwrapObservable($data.cssClass) || '') + ' sf-tip wsb-actionmenu-item ',\r\n                'data-style': 'qt',\r\n                'data-content': $data.tip,\r\n                'data-aid': 'am-item'\r\n            },\r\n            visible: $data.sub || cssClass,\r\n            css: {\r\n                enabled: $data.enabled === undefined || enabled(),\r\n                disabled: $data.enabled !== undefined && !enabled()\r\n            },\r\n            event: {\r\n                click: ($data.enabled && !$data.enabled()) ? function() { } : click,\r\n                mousedown: function() { return false;}\r\n            },\r\n            clickBubble: false, mousedownBubble: false\">\r\n        <!-- ko if: $data.sub -->\r\n        <ul data-aid=\"action-submenu\"\r\n            class=\"wsb-action-submenu\"\r\n            data-bind=\"\r\n                visible: $root.showSubmenu,\r\n                style: { 'margin-left': $root.submenuLeftMargin, 'margin-top':$root.submenuTopMargin },\r\n                template: { name: 'action-menu-subitem', foreach: $data.sub }\">\r\n        </ul>\r\n        <!-- /ko -->\r\n       \r\n    </li>\r\n    <!-- /ko -->\r\n</script>\r\n\r\n<script type=\"text/html\" id=\"action-menu-subitem\">\r\n    <li class=\"submenu-item\" \r\n        data-bind=\"click: $data.click, attr: { id: $data.name }\">\r\n        <span data-bind=\"text: $data.tip\"></span>\r\n    </li>\r\n</script>\r\n\r\n<script type=\"text/html\" id=\"action-menu-item-vertical\">\r\n        <!-- ko if: $data.visible === undefined || visible() -->\r\n        <li data-bind=\"\r\n    attr: {\r\n        'class': (ko.utils.unwrapObservable($data.cssClass) || '') + ' sf-tip ',\r\n        'data-style': $data.sub ? ' ' : 'qt',\r\n        'data-content': $data.tip,\r\n        'data-aid': 'am-item'\r\n    },\r\n    visible: $data.sub || cssClass,\r\n    css: {\r\n        enabled: $data.enabled === undefined || enabled(),\r\n        disabled: $data.enabled !== undefined && !enabled(),\r\n        'wsb-actionmenu-item': !$data.sub\r\n    },\r\n    event: {\r\n        click: $data.sub || ($data.enabled && !$data.enabled()) ? function () { } : click,\r\n        mousedown: function () { return false; }\r\n    },\r\n    clickBubble: false, mousedownBubble: false\">\r\n            <!-- ko if: $data.sub -->\r\n            <ul class=\"wsb-actionmenu clearfix\"\r\n                data-bind=\"template: { name: 'action-menu-item-vertical', foreach: sub }\"></ul>\r\n            <!-- /ko -->\r\n            <!-- ko if: !$data.sub -->\r\n            <span data-bind=\"text: text\"></span>\r\n            <!-- /ko -->\r\n        </li>\r\n        <!-- /ko -->\r\n    </script>\r\n\r\n\r\n\r\n"}),define("designer/app/builder/ui/controls/actionmenu/actionmenu",["jquery","knockout","common/abTesting/abTesting","designer/app/app","designer/app/builder/data/data","common/stats/googleanalytics","wsbcore/tipper","designer/app/event","text!designer/app/builder/ui/controls/actionmenu/actionmenu.html"],function(e,t,n,i,a,r,o,s,l){function d(n,i){var a=u.height(),r=e(window),o=r.height(),s=r.width(),l=n.offset(),d=t.utils.unwrapObservable(i.boundingBoxPadding),c=s-208,p=l.left,g=Math.max(60,l.top-d),h=n.width()+2*d+10;p=Math.min(p+h,c);var m=o-g;return a>m&&(g=Math.max(o-a,60)),{top:g,left:p}}function c(n,i){var a=u.height(),r=u.width(),o=u.find(".wsb-action-submenu").height(),s=e(window),l=s.height(),d=s.width(),c=n.offset(),p=t.utils.unwrapObservable(i.boundingBoxPadding),g=d-r-25,h=c.left,m=Math.max(60,c.top-a-15),b=n.width()+2*p+10,f=0,v=20;h=Math.min(h+b-r+24,g);var y=l-m;return a>y&&(m=Math.max(l-a,60)),h+r+180>d&&(f=d-(h+r+180)),m+o+50>l&&(v=v-o-50),{top:m,left:h,submenuLeftMargin:f,submenuTopMargin:v}}var u,p={menuItems:t.observableArray([]),visible:t.observable(!1),showSubmenu:t.observable(!1),top:t.observable(0),left:t.observable(0),submenuTopMargin:t.observable(20),submenuLeftMargin:t.observable(0),menuStyle:n.getOption("actionMenuStyle")||"horizontal"},g=function(){p.menuItems([]),p.visible(!1),p.showSubmenu(!1),p.top(0),p.left(0)},h=function(){return"horizontal"==p.menuStyle?u.children():u.find("ul").last()},m=function(n){s.on(s.events.flyoutClose,function(){v()&&f()});var r=i.currentApp()+"-actionmenu";i.addControl(l,i.currentApp(),r),u=e("#"+r),a.getDataModel().address.isEditAction.subscribe(function(e){e||g()}),t.applyBindings(p,u[0]),n(null,p)},b=function(e){p.menuItems(e.menuItems);var t;p.visible(!0),t=e.position?e.position:"horizontal"==p.menuStyle?c(e.$element,e.elementViewModel):d(e.$element,e.elementViewModel),p.left(t.left+"px"),p.top(t.top+"px"),p.submenuLeftMargin(t.submenuLeftMargin+"px"),p.submenuTopMargin(t.submenuTopMargin+"px"),h().sfTipper({wireup:!0})},f=function(){if(p&&p.visible()){var e=h();e.length>0&&e.mouseleave(),g()}},v=function(){return p?p.visible():!1},y=function(e){p.showSubmenu(e)},_=function(){return p.showSubmenu()};return{load:m,show:b,hide:f,isVisible:v,showSubmenu:y,isSubmenuVisible:_}}),define("common/impression/impression",["websiteInfo","common/persistence/persistence"],function(e,t){var n={add:function(n,i,a){a||(a={}),t.Post("/api/websites/{websiteId}/Impression",{typeId:i.id,productMetricType:i.productMetricType,orionAccountUid:e.Account.OrionAccountUid,shopperId:e.Account.ShopperId,templateId:e.TemplateId,appId:n,domainName:e.Account.Domain,value:JSON.stringify(a)})},types:{LocuDeleteLocuFromPage:{id:1,productMetricType:"LocuDeleteLocuFromPage"},LocuEditedOnPage:{id:2,productMetricType:"LocuEditedOnPage"},LocuStrongMatchContinue:{id:3,productMetricType:"LocuStrongMatchContinue"},LocuStrongMatchCancel:{id:4,productMetricType:"LocuStrongMatchCancel"},LocuWeakMatchContinue:{id:5,productMetricType:"LocuWeakMatchContinue"},LocuWeakMatchCancel:{id:6,productMetricType:"LocuWeakMatchCancel"},LocuOpenedThirdPartyEditor:{id:7,productMetricType:"LocuOpenedThirdPartyEditor"},LocuPresentedUpgradeMessage:{id:8,productMetricType:"LocuPresentedUpgradeMessage"},LocuClickedUpgradeLink:{id:9,productMetricType:"LocuClickedUpgradeLink"},LocuAbandonedSignUp:{id:10,productMetricType:"LocuAbandonedSignUp"},LocuGetError:{id:11,productMetricType:"LocuGetError"},LocuClickedControlPanelUpgradeCancelLink:{id:12,productMetricType:"LocuClickedControlPanelUpgradeCancelLink"},LocuClickedControlPanelUpgradeLink:{id:13,productMetricType:"LocuClickedControlPanelUpgradeLink"},LocuSignedIn:{id:15,productMetricType:"LocuSignedIn"},LocuAbandonedSignIn:{id:16,productMetricType:"LocuAbandonedSignIn"},LocuSearchContinue:{id:17,productMetricType:"LocuSearchContinue"},LocuCreateNewBusiness:{id:18,productMetricType:"LocuCreateNewBusiness"},LocuCreateNewBusinessContinue:{id:19,productMetricType:"LocuCreateNewBusinessContinue"},LocuCreateNewBusinessCancel:{id:20,productMetricType:"LocuCreateNewBusinessCancel"},LocuWeakMatchSelectVenue:{id:21,productMetricType:"LocuWeakMatchSelectVenue"},LocuAddWidgetFromAppDrawer:{id:22,productMetricType:""},LocuUpgradeAccountFromAppDrawer:{id:23,productMetricType:""}},apps:{Locu:1},captureImpressionOnExit:function(){var e=this,t=e.apps.Locu,n=e.types,i=$("[data-locu]");i.each(function(){var i=$(this).attr("data-locu");switch(i){case"claimIt":e.add(t,n.LocuStrongMatchCancel);break;case"login":e.add(t,n.LocuAbandonedSignIn);break;case"none":case"loading":case"error":break;case"findMenu":case"noMatch":e.add(t,n.LocuWeakMatchCancel);break;case"createListing":e.add(t,n.LocuCreateNewBusinessCancel);break;case"createAccount":e.add(t,n.LocuAbandonedSignUp)}}),i.remove()}};return n}),define("text!designer/app/builder/ui/controls/toolbox/toolbox.html",[],function(){return'<div class="wsb-shell-toolbox wsb-undo-select" data-bind="visible: showToolbox() && isAvailable()">\r\n    <!-- THE TOOLBOX -->\r\n    <div class="wsb-toolbox-container"\r\n         data-bind="attr: { style: containerStyle }, visible: isVisible, event: { mousewheel: scrollWheel, DOMMouseScroll: scrollWheel }">\r\n\r\n        <!-- THE TOOLBOX CONTROLS-->\r\n        <div class="wsb-toolbox-controls clearfix">\r\n            <div class="wsb-toolbox-widener" data-bind="css: { wide: isWide }, click: toggleView">\r\n                <div class="wsb-toolbox-widener-icn"></div>\r\n            </div>\r\n            <div class="wsb-toolbox-pin" data-bind="css: { wide: isWide }, click: toggleHide">\r\n                <div class="wsb-toolbox-pin-icn"></div>\r\n            </div>\r\n        </div>\r\n\r\n        <!-- SCROLL UP-->\r\n        <div class="wsb-toolbox-scroll-button-up"\r\n             data-bind="\r\n        css: { wide: isWide(), \'ui-state-disabled\': !canScrollUp() },\r\n        event: { mousedown: startScrollingUp, mouseup: stopScrolling },\r\n        mousedownBubble: false,\r\n        mouseupBubble: false"\r\n             data-aid="toolbox-scrollup"><a class="ui-icon"></a></div>\r\n\r\n        <!-- TOOLS-->\r\n        <div class="wsb-toolbox-list-container"\r\n             data-bind="attr: { style: listStyle },\r\n        css: { wide: isWide() }"\r\n             data-aid="toolbox-listcontainer">\r\n            <ul class="wsb-toolbox-menu clearfix"\r\n                data-bind="foreach: Tools">\r\n                <li data-bind="attr: {\r\n        \'data-tool\': Id,\r\n        \'data-content\': Name,\r\n        \'data-aid\': \'toolbox-tool-\' + Id,\r\n        \'class\': \'wsb-tool-\' + Id + \' sf-tip wsb-toolbox-tooltip\'\r\n    },\r\n        css: { wide: $parent.isWide() },\r\n        event: { mousedown: toolMouseDown, mousemove: toolMouseMove, mouseup: toolMouseUp, mouseleave: toolMouseOut },\r\n        mousedownBubble: false"\r\n                    data-style="qt">\r\n                    <span data-bind="text: Name">name</span>\r\n                </li>\r\n            </ul>\r\n        </div>\r\n\r\n        <!-- SCROLL DOWN-->\r\n        <div class="wsb-toolbox-scroll-button-down"\r\n             data-bind="\r\n        css: { wide: isWide(), \'ui-state-disabled\': !canScrollDown() },\r\n        event: { mousedown: startScrollingDown, mouseup: stopScrolling },\r\n        mousedownBubble: false,\r\n        mouseupBubble: false"\r\n             data-aid="toolbox-scrolldown"><a class="ui-icon"></a></div>\r\n\r\n      <!-- ko if: isAppsAvailable -->\r\n      <!-- SEPARATOR-->\r\n      <div class="wsb-toolbox-seperator"></div>\r\n\r\n        <!-- APPS -->\r\n      <ul id="wsb-toolbox-appbox" class="wsb-toolbox-menu clearfix">\r\n        <li class="wsb-tool-app sf-tip wsb-toolbox-tooltip"\r\n          data-tool="Apps"\r\n          data-bind="css: { wide: isWide()}, attr: { \'data-content\': $root.i18N.apps }"\r\n          data-style="qt"\r\n          data-aid="toolbox-app-id">\r\n          <span data-bind="text: $root.i18N.apps"></span>\r\n        </li>\r\n      </ul>\r\n      <!-- /ko -->\r\n    </div>\r\n\r\n    <!-- THE APP DRAWER -->\r\n    <div id="wsb-toolbox-appdrawer" class="clearfix" style="width: 590px; display: none;">\r\n        <div>\r\n            <h3 class="sf-dialog-title" data-bind="text: $root.i18N.customApps"></h3>\r\n            <span class="sf-dialog-close sf-icn-close1 wsb-x" data-bind="click: closeAppDrawer"></span>\r\n        </div>\r\n        <div class="wsb-appdrawer-repeater" data-bind="foreach: Apps">\r\n            <ul class="clearfix wsb-appdrawer-ul">\r\n                <li class="wsb-appdrawer-li-1">\r\n                    <span data-bind="attr: { class: GraphicPath }"></span>\r\n                </li>\r\n                <li class="wsb-appdrawer-li-2">\r\n                    <div data-bind="text: Title" class="wsb-appdrawer-title"></div>\r\n                    <div class="app-drawer-txt-description" data-bind="text: Description"></div>\r\n                </li>\r\n                <li class="wsb-logo-upgrade-add">\r\n                    <div data-bind="attr: { class: LogoPath }">\r\n                        <div class="appDrawerText" data-bind="text: $root.i18N.poweredBy"></div>\r\n                        <div class="app-drawer-logo-wrap"></div>\r\n                        <div class="app-drawer-btn">\r\n                            <!-- ko if: RequiresUpgrade -->\r\n                            <a class="btn btn-success" data-bind="click: showUpgradeDialog, text: $root.i18N.learnMore"></a>\r\n                            <!-- /ko -->\r\n                            <!-- ko ifnot: RequiresUpgrade -->\r\n                            <a class="btn btn-success" data-bind="click: addApp, text: $root.i18N.Add"></a>\r\n                            <!-- /ko -->\r\n                        </div>\r\n                    </div>\r\n                </li>\r\n            </ul>\r\n        </div>\r\n    </div>\r\n\r\n    <!-- THE CLOSET -->\r\n    <!-- ko ifnot: isVisible -->\r\n    <div class="wsb-toolbox-closet" data-bind="attr: { style: closetStyle }, click: toggleHide"></div>\r\n    <!-- /ko -->\r\n</div>'}),define("designer/app/builder/ui/controls/toolbox/toolbox",["designer/app/app","designer/app/event","jquery","libs/jquery/jqui","knockout","designer/app/builder/ui/controls/toolbox/hint","designer/app/builder/ui/controls/actionmenu/actionmenu","designer/app/builder/ui/uiHelper","wsbcore/tipper","common/cookiemanager/cookiemanager","common/persistence/persistence","common/logger/serverLogger","common/stats/googleanalytics","common/inAppPurchase/inAppPurchase","websiteInfo","common/impression/impression","/i18n/resources/client","designer/app/builder/data/data","designer/app/builder/managers/elementManager","designer/app/builder/managers/pageManager","designer/app/builder/managers/themeManager","text!designer/app/builder/ui/controls/toolbox/toolbox.html"],function(e,t,n,i,a,r,o,s,l,d,c,u,p,g,h,m,b,f,v,y,_,w){function S(e){var t,i,r,o=this,l=300,d=function(e,t){if("page"===o.Id)p.trackEvent("wsb-designer-toolbox","click","page"),s.addNewPage(t);else if(B.collect(F),e.isClick){var i=n(".wsb-tool-"+o.Id),a=getClone(i,!0);$(a,o.Id,function(){B.enable(F)})}else v.addNewElementToCanvas({Type:o.Id,Top:e.y+"px",Left:e.x+"px"},function(e){e.isNewlyDragged(!0),e.drag(t,function(){e.isNewlyDragged(!1),B.enable(F),e.afterNewElementAdded()})})},c=function(e){if(1!==e.which)return!1;if(I)return!1;var t=(new Date).getTime(),n=t-A;return A=t,n>=l};for(r in e)o[r]=e[r];if(o.Features)for(i=0;i<o.Features.length;i++)o.Features[i].RequiresUpgrade=a.observable(o.Features[i].RequiresUpgrade);o.state=a.observable("none"),o.toolMouseDown=function(e,n){s.closeFlyouts(n),t=!0,o.state("down")},o.toolMouseMove=function(){var e=o.state();o.state("drag"),"down"!==e},o.toolMouseUp=function(e,i){if(t){if(t=!1,!c(i))return;{o.state()}o.state("click"),p.trackEvent("toolbar_"+o.Id,"add","button"),T.page||(T.page=n("#wsb-group-content"));var a=T.page.offset(),r={x:i.pageX-a.left,y:i.pageY-a.top-T.body.scrollTop(),isClick:!0};d(r,i),u.logFirstClick("toolbox",{action:"click",element:o.Id})}},o.toolMouseOut=function(e,i){if(o.state("out"),t&&c(i)){T.page||(T.page=n("#wsb-group-content"));var a=T.page.offset(),r={x:i.pageX-a.left,y:i.pageY-a.top-T.body.scrollTop(),isClick:!1};d(r,i),u.logFirstClick("toolbox",{action:"drag",element:o.Id}),p.trackEvent("toolbar_"+o.Id,"drag","button")}t=!1}}function k(e){var t,i=this;for(t in e)i[t]=e[t];i.RequiresUpgrade=a.observable(i.RequiresUpgrade),i.addApp=function(){if("locu"===i.Id&&m.add(m.apps.Locu,m.types.LocuAddWidgetFromAppDrawer),B.collect(F),"subscribe"===i.Id){var e=n(".appdrawer-subscribe-icon").closest("ul").find(".btn-success"),t=getClone(e,!1);$(t,i.Id,function(){B.enable(F)})}else v.addNewElementToCanvas({Type:i.Id},function(e){e.selectElement();var t=q(e);e.Top(t.top),e.Left(t.left),B.enable(F)});p.trackEvent("toolbar_apps","add_"+i.Id,"button"),T.appDrawer.sfContext("close"),u.logFirstClick("toolbox",{action:"app",element:i.Id})},i.showUpgradeDialog=function(){"locu"===i.Id&&m.add(m.apps.Locu,m.types.LocuUpgradeAccountFromAppDrawer),W(i.Id)}}function x(){var e,t=this;for(e in P)t[e]=a.observable(P[e])}function C(){function e(e){var t="up"===e?0:s.listHeight()-s.listContentHeight();i(t)}function t(e){var t=Math.min(0,Math.max(s.listPosition()+e,s.listHeight()-s.listContentHeight()));i(t)}function i(e){var t=Math.abs(e-s.listPosition()),n=1e3*t/g;1>t||0>=n||(f=T.toolboxlist.animate({"margin-top":e},{duration:n,easing:"linear",progress:o,always:function(){f=null}}))}function o(){s.listPosition(parseFloat(T.toolboxlist.css("marginTop")))}var s=this,l=b.resources,d=D.toolbox;s.showToolbox=D.address.isEditAction,s.showToolbox.subscribe(function(e){e&&K()}),s.Tools=a.observableArray(n.map(d.Tools,function(e){var t=new S(e);return R[e.Id]=t,t})),s.Apps=a.observableArray(n.map(d.Apps,function(e){return new k(e)})),s.Settings=new x,s.isAvailable=a.computed(function(){return!_.themeLocale()}),s.isAvailable.subscribe(function(e){e&&K()}),s.isWide=a.observable("wide"===P.mode),s.isVisible=a.observable(!0);var c=D.user.isApiReseller&&h.Account.AccountType===h.accountTypes.personal;s.isAppsAvailable=a.observable(!c),s.boxWidth=a.observable(70),s.listHeight=a.observable(700),s.listContentHeight=a.observable(),s.listPosition=a.observable(0),s.closetTopPosition=a.observable(100),s.state=a.observable("none"),s.isWide.subscribe(function(e){P.mode=e===!0?"wide":"narrow",s.resetListPosition(),s.handleTipper(),U()}),s.i18N={apps:l.Server__Apps,customApps:l.Server__Customize_with_apps,poweredBy:l.Server__Powered_by,Add:l.Add,learnMore:l.Learn_more},s.hideSize={width:T.hideHandle.width(),height:T.hideHandle.height()},s.closetStyle=a.computed(function(){return"top:"+s.closetTopPosition()+"px;"}),s.containerStyle=a.computed(function(){return"width:"+s.boxWidth()+"px;"}),s.hideStyle=a.computed(function(){return"left:"+(s.boxWidth()-s.hideSize.width)+"px; top:"+s.hideSize.height+"px;"}),s.listStyle=a.computed(function(){return"height:"+s.listHeight()+"px"}),s.canScrollDown=a.computed(function(){var e=-s.listPosition();return s.listContentHeight()-s.listHeight()-e>1}),s.canScrollUp=a.computed(function(){return s.listPosition()<0}),s.toggleView=function(){var e=!s.isWide();p.trackEvent("toolbar",e?"expand":"collapse","button"),s.isWide(e),s.updateWidth(),s.updateHeight(),r.hide(),u.logFirstClick("toolbox",{action:"toggleView"})},s.toggleHide=function(){var e=!s.isVisible();p.trackEvent("toolbar",e?"show":"hide","button"),s.isVisible(e),e||r.hide(),u.logFirstClick("toolbox",{action:"toggleHide"})},s.updateWidth=function(){var e=T.listContainer.find("li[data-tool]").first(),t=e.outerWidth(!0),n=t-e.outerWidth(!1),i=parseInt(T.listContainer.css("padding-left"),10)+parseInt(T.listContainer.css("padding-right"),10);s.boxWidth(t+n+i)},s.updateHeight=function(){setTimeout(function(){var e=.9*T.canvas.outerHeight(!0),t=T.buttonUp.outerHeight(!0)+T.buttonDown.outerHeight(!0)+T.controls.outerHeight(!0)+T.separator.outerHeight(!0)+T.appContainer.outerHeight(!0),n=e-t,i=T.toolboxlist.outerHeight(!0);s.closetTopPosition((e-T.closet.height())/2),s.listContentHeight(i),s.listHeight(Math.min(n,i))},1)};var g=250,m=50,f=null;s.resetListPosition=function(){T.toolboxlist.css("marginTop","0px"),o()},s.startScrollingUp=function(){return s.stopScrolling(),e("up"),p.trackEvent("toolbar","scroll_up","button"),!1},s.startScrollingDown=function(){return s.stopScrolling(),e("down"),p.trackEvent("toolbar","scroll_down","button"),!1},s.stopScrolling=function(){return f&&f.stop(),!1},s.scrollWheel=function(e,n){if(!f){var i=0,a=n.originalEvent||n;a.wheelDelta?i=a.wheelDelta:a.detail&&(i=-1*a.detail),0!==i&&t(i>0?m:-m)}},s.setUpAppDrawer=function(){T.appDrawer.sfContext({anchor:T.appAnchor,width:620,centerAgainstAnchor:!0,onOpen:function(e){p.trackEvent("toolbar_apps","apps_click","button"),e.closest(".sf-flyout").addClass("wsb-appflyout")}})},s.closeAppDrawer=function(){T.appDrawer.sfContext("close")},s.handleTipper=function(){T.toolbox.find("li[data-tool]").each(function(){var e="wide"===P.mode?{suppress:!0}:{resume:!0};n(this).sfTipper(e)})},s.init=function(e){T.toolbox.sfTipper({wireup:!0}),s.updateWidth(),s.updateHeight(),s.setUpAppDrawer(),s.handleTipper(),n.isFunction(e)&&e()}}var T,E,P,D,I,A=(new Date).getTime(),M="toolbox",O="builder-"+M,L={notLoaded:0,loading:1,loaded:2},N=L.notLoaded,B=f.undoer,F=B.keys().addElement,R={},H=0,V=function(){T={},T.toolbox=n("#"+O),T.shellContainer=n(".wsb-shell-toolbox").css("position","fixed"),T.controls=T.toolbox.find(".wsb-toolbox-controls"),T.buttonUp=T.toolbox.find(".wsb-toolbox-scroll-button-up"),T.listContainer=T.toolbox.find(".wsb-toolbox-list-container"),T.buttonDown=T.toolbox.find(".wsb-toolbox-scroll-button-down"),T.separator=T.toolbox.find(".wsb-toolbox-seperator"),T.appContainer=T.toolbox.find(".wsb-toolbox-appbox"),T.toolboxlist=T.listContainer.children("ul").first(),T.toolboxContainer=T.toolbox.find(".wsb-toolbox-container"),T.canvas=n("#app-webapps"),T.header=n("#app-header"),T.body=n("body"),T.appDrawer=n("#wsb-toolbox-appdrawer"),T.appAnchor=n("#wsb-toolbox-appbox>li").first(),T.hideHandle=T.toolbox.find(".wsb-toolbox-hide"),T.closet=T.toolbox.find(".wsb-toolbox-closet")},z=function(){var e=T.canvas.offset();P=n.parseJSON(d.getCookie("toolbox"))||{},P.top=Math.max(e.top,parseInt(P.top,10)||parseInt(T.toolbox.css("top"),10)),P.left=Math.max(e.left,parseInt(P.left,10)||parseInt(T.toolbox.css("left"),10)),P.mode="narrow"===P.mode?"narrow":"wide"},j=function(){T.toolbox.css({top:P.top,left:P.left}).draggable({start:function(){r.hide()},handle:".wsb-toolbox-controls",containment:T.canvas,stop:function(e,t){p.trackEvent("toolbar","toolbar-drag","toolbar");var n=T.canvas.position().top-T.header.outerHeight(!0);P.top=t.position.top-n,P.left=t.position.left,U()}})},U=function(){var e=JSON.stringify(P);d.setCookie("toolbox",e,365)},W=function(e,t){g.ShowUpgradeDialog({clientTrackingId:"wsb-designer-toolbox",clientTrackingValue:e,onCloseCallback:function(e){var i=e.AccountType===h.accountTypes.personal;n.each(E.Apps(),function(e,t){t.RequiresUpgrade(i)}),n.each(E.Tools(),function(e,t){t.Features&&n.each(t.Features,function(e,t){t.RequiresUpgrade(i)})}),"function"==typeof t&&t(e)}}),p.trackEvent("toolbar","upgrade","button"),T.appDrawer.sfContext("close")},q=function(e){var t=parseInt(y.getCurrentPage().Settings.Width()),i=n("#builder-canvas"),a={x:i.scrollLeft()+Math.floor(t/2),y:i.scrollTop()+Math.floor(window.innerHeight/2)},r=10*H++ +"",o={x:1*r.slice(-2),y:10*r.slice(0,-2)%100},s=parseInt(n(".wsb-canvas-page-container").css("padding-top")),l=a.x-parseInt(e.Width())/2+o.x,d=a.y-parseInt(e.Height())/2+o.y-s;return{left:l,top:d}},$=function(e,t,i){I=!0;var a=10;"subscribe"===t&&(a=5),v.addNewElementToCanvas({Type:t,Top:"0px",Left:"0px",hidden:!0},function(t){var r=q(t);e.animate({left:(n("#builder-canvas").width()-e.width())/2,top:(n("#builder-canvas").height()+a*e.height())/2},{duration:800,easing:"swing",complete:function(){e.remove(),I=!1,t.Top(r.top+"px"),t.Left(r.left+"px"),t.afterNewElementAdded(),B.enable(F),setTimeout(function(){t.hidden(!1),t.selectElement(!1)},100),i()}})})};getClone=function(e,t){var i=e.clone(),a=e[0],r=window.getComputedStyle(a);i.attr("style",r.cssText);var o=window.getComputedStyle(a,":before"),s=window.getComputedStyle(document.querySelector(".wsb-toolbox-menu li"),":before")["background-image"];i.attr(":before",o.cssText);var l=e.offset(),d=l.top-n(window).scrollTop()-parseInt(e.css("margin-top")),c=l.left-n(window).scrollLeft()-parseInt(e.css("margin-left")),u={position:"absolute",top:d,left:c,"z-index":99999999};if(i.css(u),t){i.prepend('<div id="img-cont"></div>');var p=i.find("span"),g=e.find("span"),h=window.getComputedStyle(g[0]).cssText;p.attr("style",h),p.css("display","inline");var m=i.find("#img-cont");m.css({width:o.width,height:o.height,top:o.top,left:o.left,display:o.display,position:o.position,overflow:o.overflow,"background-position":o["background-position"],"background-image":s})}return n("body").append(i),i};var G=function(i){if(D=f.getDataModel(),N=L.loading,e.addControl(w,"builder",O),n("#"+O).click(function(e){s.closeFlyouts(e),o.hide()}),N==L.loading){V(),z(),j();var l=D.toolbox;if(!(l&&"Tools"in l&&0!==l.Tools.length))return!1;E=new C,a.applyBindings(E,T.toolbox[0]),E.init(),N=L.loaded,t.once("builder-rendered",function(){K(),r.init(T.toolboxContainer)}),t.on("window-resize",K),i(null,"toolbox",E)}},K=function(){N==L.loaded&&(E.updateHeight(),E.resetListPosition())},Y=function(){return T.toolbox},J=function(){r.hide(),T.toolbox.hide()},Z=function(e){return R[e]};return{onResize:K,container:Y,hide:J,load:G,getToolItem:Z,showUpgradeDialog:W}}),define("libs/jquery/plugins/jquery.watermark/jquery.watermark",["jquery"],function(e){!function(e,t,n){var i="watermark",a="watermarkClass",r="watermarkFocus",o="watermarkSubmit",s="watermarkMaxLength",l="watermarkPassword",d="watermarkText",c=/\r/g,u=/^(button|checkbox|hidden|image|radio|range|reset|submit)$/i,p="input:data("+i+"),textarea:data("+i+")",g=":watermarkable",h=["Page_ClientValidate"],m=!1,b="placeholder"in document.createElement("input");e.watermark=e.watermark||{version:"3.1.4",runOnce:!0,options:{className:"watermark",useNative:!0,hideBeforeUnload:!0},hide:function(t){e(t).filter(p).each(function(){e.watermark._hide(e(this))})},_hide:function(e,n){var i=e[0],r=(i.value||"").replace(c,""),o=e.data(d)||"",u=e.data(s)||0,p=e.data(a);if(o.length&&r==o){if(i.value="",e.data(l)&&"text"===(e.attr("type")||"")){var g=e.data(l)||[],h=e.parent()||[];g.length&&h.length&&(h[0].removeChild(e[0]),h[0].appendChild(g[0]),e=g)}u&&(e.attr("maxLength",u),e.removeData(s)),n&&(e.attr("autocomplete","off"),t.setTimeout(function(){e.select()},1))}p&&e.removeClass(p)},show:function(t){e(t).filter(p).each(function(){e.watermark._show(e(this))})},_show:function(t){var n=t[0],i=(n.value||"").replace(c,""),o=t.data(d)||"",u=t.attr("type")||"",p=t.data(a);if(0!=i.length&&i!=o||t.data(r))e.watermark._hide(t);else{if(m=!0,t.data(l)&&"password"===u){var g=t.data(l)||[],h=t.parent()||[];g.length&&h.length&&(h[0].removeChild(t[0]),h[0].appendChild(g[0]),t=g,t.attr("maxLength",o.length),n=t[0])}if("text"===u||"search"===u){var b=t.attr("maxLength")||0;b>0&&o.length>b&&(t.data(s,b),t.attr("maxLength",o.length))}p&&t.addClass(p),n.value=o}},hideAll:function(){m&&(e.watermark.hide(g),m=!1)},showAll:function(){e.watermark.show(g)}},e.fn.watermark=e.fn.watermark||function(n,s){if(!this.length)return this;var u=!1,p="string"==typeof n;return p&&(n=n.replace(c,"")),"object"==typeof s?(u="string"==typeof s.className,s=e.extend({},e.watermark.options,s)):"string"==typeof s?(u=!0,s=e.extend({},e.watermark.options,{className:s})):s=e.watermark.options,"function"!=typeof s.useNative&&(s.useNative=s.useNative?function(){return!0}:function(){return!1}),this.each(function(){var h=e(this);if(h.is(g)){if(h.data(i))(p||u)&&(e.watermark._hide(h),p&&h.data(d,n),u&&h.data(a,s.className));else{if(b&&s.useNative.call(this,h)&&"TEXTAREA"!==(h.attr("tagName")||""))return void(p&&h.attr("placeholder",n));if(h.data(d,p?n:""),h.data(a,s.className),h.data(i,1),"password"===(h.attr("type")||"")){var m=h.wrap("<span>").parent(),f=e(m.html().replace(/type=["']?password["']?/i,'type="text"'));f.data(d,h.data(d)),f.data(a,h.data(a)),f.data(i,1),f.attr("maxLength",n.length),f.focus(function(){e.watermark._hide(f,!0)}).bind("dragenter",function(){e.watermark._hide(f)}).bind("dragend",function(){t.setTimeout(function(){f.blur()},1)}),h.blur(function(){e.watermark._show(h)}).bind("dragleave",function(){e.watermark._show(h)}),f.data(l,h),h.data(l,f)}else h.focus(function(){h.data(r,1),e.watermark._hide(h,!0)}).blur(function(){h.data(r,0),e.watermark._show(h)
}).bind("dragenter",function(){e.watermark._hide(h)}).bind("dragleave",function(){e.watermark._show(h)}).bind("dragend",function(){t.setTimeout(function(){e.watermark._show(h)},1)}).bind("drop",function(e){var t=h[0],n=e.originalEvent.dataTransfer.getData("Text");(t.value||"").replace(c,"").replace(n,"")===h.data(d)&&(t.value=n),h.focus()});if(this.form){var v=this.form,y=e(v);y.data(o)||(y.submit(e.watermark.hideAll),v.submit?(y.data(o,v.submit),v.submit=function(t,n){return function(){var i=n.data(o);e.watermark.hideAll(),i.apply?i.apply(t,Array.prototype.slice.call(arguments)):i()}}(v,y)):(y.data(o,1),v.submit=function(t){return function(){e.watermark.hideAll(),delete t.submit,t.submit()}}(v)))}}e.watermark._show(h)}})},e.watermark.runOnce&&(e.watermark.runOnce=!1,e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(n){return!!e.data(n,t)}}):function(t,n,i){return!!e.data(t,i[3])},watermarkable:function(e){var t,n=e.nodeName;return"TEXTAREA"===n?!0:"INPUT"!==n?!1:(t=e.getAttribute("type"),!t||!u.test(t))}}),function(t){e.fn.val=function(){var a=Array.prototype.slice.call(arguments);if(!this.length)return a.length?this:n;if(a.length)return t.apply(this,a),e.watermark.show(this),this;if(this.data(i)){var r=(this[0].value||"").replace(c,"");return r===(this.data(d)||"")?"":r}return t.apply(this)}}(e.fn.val),h.length&&e(function(){var n,i,a;for(n=h.length-1;n>=0;n--)i=h[n],a=t[i],"function"==typeof a&&(t[i]=function(t){return function(){return e.watermark.hideAll(),t.apply(null,Array.prototype.slice.call(arguments))}}(a))}),e(t).bind("beforeunload",function(){e.watermark.options.hideBeforeUnload&&e.watermark.hideAll()}))}(e,window)}),define("libs/jquery/plugins/jquery.mjs.nestedSortable",["jquery","libs/jquery/jqui"],function(e){function t(e,t,n){return e>t&&t+n>e}!function(e){e.widget("mjs.nestedSortable",e.extend({},e.ui.sortable.prototype,{options:{doNotClear:!1,expandOnHover:700,isAllowed:function(){return!0},isTree:!1,listType:"ol",maxLevels:0,protectRoot:!1,rootID:null,rtl:!1,startCollapsed:!1,tabSize:20,branchClass:"mjs-nestedSortable-branch",collapsedClass:"mjs-nestedSortable-collapsed",disableNestingClass:"mjs-nestedSortable-no-nesting",errorClass:"mjs-nestedSortable-error",expandedClass:"mjs-nestedSortable-expanded",hoveringClass:"mjs-nestedSortable-hovering",leafClass:"mjs-nestedSortable-leaf"},_create:function(){if(this.element.data("ui-sortable",this.element.data("mjs-nestedSortable")),!this.element.is(this.options.listType))throw new Error("nestedSortable: Please check that the listType option is set to your actual list type");if(this.options.isTree&&this.options.expandOnHover&&(this.options.tolerance="intersect"),e.ui.sortable.prototype._create.apply(this,arguments),this.options.isTree){var t=this;e(this.items).each(function(){var e=this.item;e.children(t.options.listType).length?(e.addClass(t.options.branchClass),e.addClass(t.options.startCollapsed?t.options.collapsedClass:t.options.expandedClass)):e.addClass(t.options.leafClass)})}},_destroy:function(){return this.element.removeData("mjs-nestedSortable").removeData("ui-sortable"),e.ui.sortable.prototype._destroy.apply(this,arguments)},_mouseDrag:function(t){var n,i,a,r,o=this.options,s=!1;this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!=document&&"HTML"!=this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<o.scrollSensitivity?this.scrollParent[0].scrollTop=s=this.scrollParent[0].scrollTop+o.scrollSpeed:t.pageY-this.overflowOffset.top<o.scrollSensitivity&&(this.scrollParent[0].scrollTop=s=this.scrollParent[0].scrollTop-o.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<o.scrollSensitivity?this.scrollParent[0].scrollLeft=s=this.scrollParent[0].scrollLeft+o.scrollSpeed:t.pageX-this.overflowOffset.left<o.scrollSensitivity&&(this.scrollParent[0].scrollLeft=s=this.scrollParent[0].scrollLeft-o.scrollSpeed)):(t.pageY-e(document).scrollTop()<o.scrollSensitivity?s=e(document).scrollTop(e(document).scrollTop()-o.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<o.scrollSensitivity&&(s=e(document).scrollTop(e(document).scrollTop()+o.scrollSpeed)),t.pageX-e(document).scrollLeft()<o.scrollSensitivity?s=e(document).scrollLeft(e(document).scrollLeft()-o.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<o.scrollSensitivity&&(s=e(document).scrollLeft(e(document).scrollLeft()+o.scrollSpeed))),s!==!1&&e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)),this.positionAbs=this._convertPositionTo("absolute");var l=this.placeholder.offset().top;this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),this.hovering=this.hovering?this.hovering:null,this.mouseentered=this.mouseentered?this.mouseentered:!1;var d=this.placeholder[0].parentNode.parentNode&&e(this.placeholder[0].parentNode.parentNode).closest(".ui-sortable").length?e(this.placeholder[0].parentNode.parentNode):null,c=this._getLevel(this.placeholder),u=this._getChildLevels(this.helper),p=document.createElement(o.listType);for(n=this.items.length-1;n>=0;n--)if(i=this.items[n],a=i.item[0],r=this._intersectsWithPointer(i),r&&i.instance===this.currentContainer&&a!==this.currentItem[0]&&this.placeholder[1===r?"next":"prev"]()[0]!==a&&!e.contains(this.placeholder[0],a)&&("semi-dynamic"===this.options.type?!e.contains(this.element[0],a):!0)){if(this.mouseentered||(e(a).mouseenter(),this.mouseentered=!0),o.isTree&&e(a).hasClass(o.collapsedClass)&&o.expandOnHover&&!this.hovering){e(a).addClass(o.hoveringClass);var g=this;this.hovering=window.setTimeout(function(){e(a).removeClass(o.collapsedClass).addClass(o.expandedClass),g.refreshPositions(),g._trigger("expand",t,g._uiHash())},o.expandOnHover)}if(this.direction=1==r?"down":"up","pointer"!=this.options.tolerance&&!this._intersectsWithSides(i))break;if(e(a).mouseleave(),this.mouseentered=!1,e(a).removeClass(o.hoveringClass),this.hovering&&window.clearTimeout(this.hovering),this.hovering=null,!o.protectRoot||this.currentItem[0].parentNode==this.element[0]&&a.parentNode!=this.element[0])o.protectRoot||this._rearrange(t,i);else if(this.currentItem[0].parentNode!=this.element[0]&&a.parentNode==this.element[0]){e(a).children(o.listType).length||(a.appendChild(p),o.isTree&&e(a).removeClass(o.leafClass).addClass(o.branchClass+" "+o.expandedClass));var h="down"===this.direction?e(a).prev().children(o.listType):e(a).children(o.listType);void 0!==h[0]&&this._rearrange(t,null,h)}else this._rearrange(t,i);this._clearEmpty(a),this._trigger("change",t,this._uiHash());break}var m=this.placeholder[0].previousSibling?e(this.placeholder[0].previousSibling):null;if(null!=m)for(;"li"!=m[0].nodeName.toLowerCase()||m[0]==this.currentItem[0]||m[0]==this.helper[0];){if(!m[0].previousSibling){m=null;break}m=e(m[0].previousSibling)}var b=this.placeholder[0].nextSibling?e(this.placeholder[0].nextSibling):null;if(null!=b)for(;"li"!=b[0].nodeName.toLowerCase()||b[0]==this.currentItem[0]||b[0]==this.helper[0];){if(!b[0].nextSibling){b=null;break}b=e(b[0].nextSibling)}return this.beyondMaxLevels=0,null==d||null!=b||o.protectRoot&&d[0].parentNode==this.element[0]||!(o.rtl&&this.positionAbs.left+this.helper.outerWidth()>d.offset().left+d.outerWidth()||!o.rtl&&this.positionAbs.left<d.offset().left)?null==m||m.hasClass(o.disableNestingClass)||!(m.children(o.listType).length&&m.children(o.listType).is(":visible")||!m.children(o.listType).length)||o.protectRoot&&this.currentItem[0].parentNode==this.element[0]||!(o.rtl&&this.positionAbs.left+this.helper.outerWidth()<m.offset().left+m.outerWidth()-o.tabSize||!o.rtl&&this.positionAbs.left>m.offset().left+o.tabSize)?this._isAllowed(d,c,c+u):(this._isAllowed(m,c,c+u+1),m.children(o.listType).length||(m[0].appendChild(p),o.isTree&&m.removeClass(o.leafClass).addClass(o.branchClass+" "+o.expandedClass)),l&&l<=m.offset().top?m.children(o.listType).prepend(this.placeholder):m.children(o.listType)[0].appendChild(this.placeholder[0]),this._trigger("change",t,this._uiHash())):(d.after(this.placeholder[0]),o.isTree&&d.children(o.listItem).children("li:visible:not(.ui-sortable-helper)").length<1&&d.removeClass(this.options.branchClass+" "+this.options.expandedClass).addClass(this.options.leafClass),this._clearEmpty(d[0]),this._trigger("change",t,this._uiHash())),this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this.refreshPositions(),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t){this.beyondMaxLevels&&(this.placeholder.removeClass(this.options.errorClass),this.domPosition.prev?e(this.domPosition.prev).after(this.placeholder):e(this.domPosition.parent).prepend(this.placeholder),this._trigger("revert",t,this._uiHash())),e("."+this.options.hoveringClass).mouseleave().removeClass(this.options.hoveringClass),this.mouseentered=!1,this.hovering&&window.clearTimeout(this.hovering),this.hovering=null,e.ui.sortable.prototype._mouseStop.apply(this,arguments)},_intersectsWithSides:function(e){var n=this.options.isTree?.8:.5,i=t(this.positionAbs.top+this.offset.click.top,e.top+e.height*n,e.height),a=t(this.positionAbs.top+this.offset.click.top,e.top-e.height*n,e.height),r=t(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),o=this._getDragVerticalDirection(),s=this._getDragHorizontalDirection();return this.floating&&s?"right"==s&&r||"left"==s&&!r:o&&("down"==o&&i||"up"==o&&a)},_contactContainers:function(){this.options.protectRoot&&this.currentItem[0].parentNode==this.element[0]||e.ui.sortable.prototype._contactContainers.apply(this,arguments)},_clear:function(){e.ui.sortable.prototype._clear.apply(this,arguments);for(var t=this.items.length-1;t>=0;t--){var n=this.items[t].item[0];this._clearEmpty(n)}},serialize:function(t){var n=e.extend({},this.options,t),i=this._getItemsAsjQuery(n&&n.connected),a=[];return e(i).each(function(){var t=(e(n.item||this).attr(n.attribute||"id")||"").match(n.expression||/(.+)[-=_](.+)/),i=(e(n.item||this).parent(n.listType).parent(n.items).attr(n.attribute||"id")||"").match(n.expression||/(.+)[-=_](.+)/);t&&a.push((n.key||t[1])+"["+(n.key&&n.expression?t[1]:t[2])+"]="+(i?n.key&&n.expression?i[1]:i[2]:n.rootID))}),!a.length&&n.key&&a.push(n.key+"="),a.join("&")},toHierarchy:function(t){function n(t){var a=(e(t).attr(i.attribute||"id")||"").match(i.expression||/(.+)[-=_](.+)/);if(a){var r={id:a[2]};return e(t).children(i.listType).children(i.items).length>0&&(r.children=[],e(t).children(i.listType).children(i.items).each(function(){var e=n(this);r.children.push(e)})),r}}var i=e.extend({},this.options,t),a=(i.startDepthCount||0,[]);return e(this.element).children(i.items).each(function(){var e=n(this);a.push(e)}),a},toArray:function(t){function n(t,o,s){var l,d,c=s+1;if(e(t).children(i.listType).children(i.items).length>0&&(o++,e(t).children(i.listType).children(i.items).each(function(){c=n(e(this),o,c)}),o--),l=e(t).attr(i.attribute||"id").match(i.expression||/(.+)[-=_](.+)/),o===a+1)d=i.rootID;else{var u=e(t).parent(i.listType).parent(i.items).attr(i.attribute||"id").match(i.expression||/(.+)[-=_](.+)/);d=u[2]}return l&&r.push({item_id:l[2],parent_id:d,depth:o,left:s,right:c}),s=c+1}var i=e.extend({},this.options,t),a=i.startDepthCount||0,r=[],o=2;return r.push({item_id:i.rootID,parent_id:"none",depth:a,left:"1",right:2*(e(i.items,this.element).length+1)}),e(this.element).children(i.items).each(function(){o=n(this,a+1,o)}),r=r.sort(function(e,t){return e.left-t.left})},_clearEmpty:function(t){var n=this.options,i=e(t).children(n.listType);!i.length||i.children().length||n.doNotClear?n.isTree&&i.length&&i.children().length&&i.is(":visible")?e(t).removeClass(n.leafClass).addClass(n.branchClass+" "+n.expandedClass):n.isTree&&i.length&&i.children().length&&!i.is(":visible")&&e(t).removeClass(n.leafClass).addClass(n.branchClass+" "+n.collapsedClass):(n.isTree&&e(t).removeClass(n.branchClass+" "+n.expandedClass).addClass(n.leafClass),i.remove())},_getLevel:function(e){var t=1;if(this.options.listType)for(var n=e.closest(this.options.listType);n&&n.length>0&&!n.is(".ui-sortable");)t++,n=n.parent().closest(this.options.listType);return t},_getChildLevels:function(t,n){var i=this,a=this.options,r=0;return n=n||0,e(t).children(a.listType).children(a.items).each(function(e,t){r=Math.max(i._getChildLevels(t,n+1),r)}),n?r+1:r},_isAllowed:function(e,t,n){var i=this.options,a=this.placeholder.closest(".ui-sortable").nestedSortable("option","maxLevels");i.isAllowed(this.placeholder,e,this.currentItem)?n>a&&0!=a?(this.placeholder.addClass(i.errorClass),this.placeholder.text("Only "+a+" Levels Allowed."),this.beyondMaxLevels=n-a):(this.placeholder.removeClass(i.errorClass),this.placeholder.text(""),this.beyondMaxLevels=0):(this.placeholder.addClass(i.errorClass),this.placeholder.text("Only "+a+" Levels Allowed."),this.beyondMaxLevels=n>a&&0!=a?n-a:1)}})),e.mjs.nestedSortable.prototype.options=e.extend({},e.ui.sortable.prototype.options,e.mjs.nestedSortable.prototype.options)}(e)}),define("designer/app/builder/ui/controls/navigationDialog/navigation.dialog.helper",["knockout","jquery"],function(e,t){function n(t){this.MenuFontFamily=e.observable(),this.MenuFontSize=e.observable(),this.MenuBackgroundColor=e.observable(),this.MenuColor=e.observable(),this.MenuActiveBackgroundColor=e.observable(),this.MenuActiveColor=e.observable(),this.MenuHoverColor=e.observable(),this.MenuHoverBackgroundColor=e.observable(),this.Orientation=e.observable(s.horizontal),this.ButtonAlignment=e.observable(l.stretch),this.TextAlignment=e.observable(d.center),this.UseEqualWidths=e.observable(!1),this.NavigateEnabled=e.observable(!0),this.NavItems=e.observableArray(t.slice(0,o).map(function(e){return new a(e.Id(),null,null)})),this.initModel=i}function i(){this.Type()!==r&&this.Type(r),this.Styling.CalculateClassStyles(!1),this.Styling.BackgroundColor(!1),this.Styling.Border(!1),this.Styling.Shadow(!1),this.Styling.RoundedCorner(!1),this.Styling.Transparency(!1),this.Styling.Padding(!1),this.Styling.Size(!1),this.Styling.ShowAdvancedTab(!1),this.Styling.ShowBasicTabOnly(!0),this.Styling.AdvancedApplyToMobile(!1),this.Width("600px"),this.Height("40px"),this.CssClass("nav"),this.Shared(!0)}function a(t,n,i,a,r){var o=null;a&&a.length&&(o=e.observableArray(a)),this.pageId=e.observable(t),this.title=e.observable(n),this.url=e.observable(i),this.subItems=o,this.isActive=e.observable(r!==!1)}var r="navigation",o=5,s={horizontal:0,vertical:1},l={left:0,center:1,right:2,stretch:3},d={left:0,center:1,right:2};return{orientations:s,buttonAlignments:l,textAlignments:d,createElementModel:function(e,i){return t.extend(e,new n(i))},createNavItemModel:function(e,t,n,i,r){return new a(e,t,n,i,r)}}}),define("text!designer/app/builder/ui/controls/navigationDialog/el.navigation.dialog.html",[],function(){return'<div>\r\n    <div id="navigation-edit" \r\n         style="display:block; width: 500px;" \r\n    \r\n         data-bind="dialog: {\r\n                    title: i18Dict.editNavigation,\r\n                    isOpen: isOpen,\r\n                    autoResize: true,\r\n                    destroyOnClose: true,\r\n                    cancel: onCancel,\r\n                    open: onOpen,\r\n                    buttons: buttons,\r\n                    onClose: onClose\r\n        }">\r\n        <div class="wsb-editnavdlg-content">\r\n            <div class="wsb-editnavdlg-text" data-bind="text: i18Dict.dragAndDropYourPages + i18Dict.youCanAddSubMenus">\r\n           \r\n            </div>\r\n\r\n            <!-- Pages -->\r\n            <div class="wsb-nav-arrange-wrap clearfix">\r\n                <ul class="wsb-editnavdlg-navlist clearfix" data-bind="template: { name: \'navigation-menu-editor-item-template\', foreach: navItems }"></ul>\r\n            </div>\r\n\r\n            <div><a class="wsb-editnavdlg-addlink" data-aid="navmenudlg-addlink" data-bind="click: onAddCustomLink, clickBubble: false, text: i18Dict.AddLink"></a></div>\r\n        </div>\r\n  \r\n    </div>\r\n</div>\r\n\r\n<script type="text/html" id="navigation-menu-editor-item-template">\r\n    <li class="wsb-editnavdlg-navlist-item" data-bind="css: { \'wsb-editnavdlg-navitemcontent-disabled\': isInactive }, attr: { pageid: pageId }">\r\n        <!-- ko ifnot: isEditing -->\r\n        <div class="wsb-editnavdlg-navitemcontent clearfix">\r\n            <div class="wsb-editnavdlg-navitemcontent-inner clearfix">\r\n                <!-- @* Sorting-drag handle *@-->\r\n                <div class="wsb-editnavdlg-draghandle" data-aid="navmenudlg-draghandle"></div>\r\n\r\n                <!--@* Display name for nav-item *@-->\r\n                <div class="wsb-editnavdlg-title" data-bind="text: title"></div>\r\n            </div>\r\n                \r\n            <div id="wsb-edit-nav-btn-container" class="clearfix">\r\n                <!-- ko if: isIndentAllowed -->\r\n              <a class="wsb-editnavdlg-button-indent" data-aid="navmenudlg-indent" href="#" data-bind="click: indent, attr: {title: $parent.i18Dict.indent}"></a>\r\n                <!-- /ko -->\r\n\r\n                <!-- ko if: isUnindentAllowed -->\r\n              <a class="wsb-editnavdlg-button-unindent" data-aid="navmenudlg-unindent" href="#" data-bind="click: unindent, attr: {title: $parent.i18Dict.unindent}"></a>\r\n                <!-- /ko -->\r\n                \r\n                <!--@* The "eye" icon *@-->\r\n              <div class="wsb-editnavdlg-button-state" data-aid="navmenudlg-eye" data-bind="css: { \'wsb-editnavdlg-button-state-disabled\': isInactive }, click: onEyeClick, attr: {title: $parent.i18Dict.showHide}"></div>\r\n\r\n                <!-- @* The "delete" icon (custom-link nav-items) *@-->\r\n                <!-- ko if: isCustomLink -->\r\n              <div class="wsb-editnavdlg-button-delete" data-aid="navmenudlg-delete" data-bind="click: onDelete, attr: {title: $parent.i18Dict.delete}"></div>\r\n                <!-- /ko -->\r\n\r\n                <!--@* Edit-button, available for custom-links only *@-->\r\n                <!-- ko if: isCustomLink -->\r\n              <div class="wsb-editnavdlg-button-edit" data-aid="navmenudlg-urledit" data-bind="click: onStartEdit, attr: {title: $parent.i18Dict.edit}"></div>\r\n                <!-- /ko -->                 \r\n            </div>\r\n        </div>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko if: isEditing -->\r\n        <div class="wsb-editnavdlg-newlinkcontent clearfix">\r\n            <div class="clearfix">\r\n                <!--@* Sorting-drag handle *@-->\r\n                <div class="wsb-editnavdlg-draghandle draghandle2" data-aid="navmenudlg-draghandle"></div>\r\n\r\n                <div class="wsb-editnavdlg-inputwrap">\r\n                    <!--@* Name of link *@-->\r\n                    <input type="text"\r\n                           class="wsb-editnavdlg-input-title wsb-text-box"\r\n                           data-aid="navmenudlg-titlebox"\r\n                           maxlength="65"\r\n                           data-bind="value: title, valueUpdate: \'input\', attr: {placeholder: $parent.i18Dict.title }" />\r\n                    \r\n                    <!--@* Url picker *@-->\r\n                    <div data-bind="urlPicker: {\r\n                        cssClass: \'wsb-editnavdlg-urlpicker\',\r\n                        url: url,\r\n                        pages: $root.pages,\r\n                        dismissOtherFlyouts: true\r\n                    }"></div>\r\n                </div>\r\n            </div>\r\n\r\n            <!--@* Errors *@-->\r\n            <div class="wsb-editgnavdlg-errors" data-bind="visible: showValidation">\r\n                <div class="wsb-editnavdlg-validate-label wsb-editnavdlg-validate-title" data-bind="style: { visibility: showTitleValidation() ? \'visible\' : \'hidden\' }, text: $parent.i18Dict.EnterTitle"></div>\r\n                <div class="wsb-editnavdlg-validate-label wsb-editnavdlg-validate-url" data-bind="style: { visibility: showUrlValidation() ? \'visible\' : \'hidden\' }, text: $parent.i18Dict.EnterAValidUrlOrSelectPageSlashFile"></div>\r\n            </div>\r\n        </div>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko if: subItems -->\r\n        <ul data-bind="template: { name: \'navigation-menu-editor-item-template\', foreach: subItems }"></ul>\r\n        <!-- /ko -->\r\n    </li>\r\n</script>\r\n'}),define("designer/app/builder/ui/controls/navigationDialog/el.navigation.dialog",["jquery","libs/jquery/jqui","designer/app/app","libs/jquery/plugins/jquery.watermark/jquery.watermark","libs/jquery/plugins/jquery.mjs.nestedSortable","knockout","common/stats/googleanalytics","designer/app/builder/data/data","designer/app/builder/managers/pageManager","common/alertbox/alertbox","common/abTesting/abTesting","/i18n/resources/client","designer/app/builder/ui/controls/navigationDialog/navigation.dialog.helper","text!designer/app/builder/ui/controls/navigationDialog/el.navigation.dialog.html","libs/knockout/ko.observables"],function(e,t,n,i,a,r,o,s,l,d,c,u,p,g){function h(t,i){return P=s.getDataModel(),i=i||e("body"),n.addControl(g,"builder","navigation-control"),I={controls:i.find("#navigation-edit"),view:i.find("#navigation-control")},D=new m,r.applyBindings(D,I.view[0]),t&&t(null,"navigation-dialog"),D}function m(){var t=this;t.i18Dict={editNavigation:u.resources.Navigation_MenuEditor_Title,youCanAddSubMenus:u.resources.Server__You_can_add_submenus,dragAndDropYourPages:u.resources.Server__Drag_and_drop_your_pages,title:u.resources.Title,EnterTitle:u.resources.Server__Enter_title,EnterAValidUrlOrSelectPageSlashFile:u.resources.Enter_a_valid_url_or_select_page_slash_file,AddLink:u.resources.Server__Add_link,indent:u.resources.Indent,unindent:"Unindent",showHide:u.resources.Show_slash_Hide,"delete":u.resources.Delete,edit:u.resources.Edit},t.pages=r.computed(function(){return e.map(l.pages(),function(e){return{id:e.Id,name:e.Name,type:"page"}})}),t.navItems=r.observableArray(),t.text=u.resources.Save,t.onOpen=function(){e(document).on("click.naveditdialog",function(e){D.onDocumentClick(D,e)});var t=I.controls.find(".wsb-editnavdlg-navlist");t.nestedSortable({handle:".wsb-editnavdlg-draghandle",stop:function(){o.trackEvent(M,"sort","icon");var e=S(!1);D.setNavItems(e)},opacity:.8,isTree:!0,forcePlaceholderSize:!0,expandOnHover:700,revert:250,tolerance:"pointer",maxLevels:3,items:".wsb-editnavdlg-navlist-item",listType:"ul",toleranceElement:"> div",placeholder:"placeholder"}),L=new Date,O.collect(L),I.controls.addClass("wsb-editnavdlg-container"),I.controls.find(".sf-dialog-buttons .sf-btn-primary").attr("data-aid","navmenudlg-savebutton"),E=e("#navigation-edit").parent().parent().find(".sf-dialog-link"),I.controls.find(".sf-dialog-close").attr("data-aid","navmenudlg-closebutton"),I.controls.find(".sf-dialog-title").attr("data-aid","navmenudlg-dlgtitle")},t.onCancel=function(e){e?o.trackEvent("nav_edit_settings","cancel","link"):o.trackEvent("nav_edit_settings","xclose","icon"),S(!0),O.cancelChanges(L),A&&D.isOpen(!1)},t.isOpen=r.observable(!1),t.isOpen.subscribe(function(t){t&&e.isFunction(C)?C():!t&&e.isFunction(T)&&T()}),t.onClose=function(){e(document).off("click.naveditdialog"),_()},t.buttons=[{text:u.resources.Save,onClick:function(){if(o.trackEvent("nav_edit_settings","save","button"),t.validateAllCustomLinkInputs(!0)){var e=S(!1),n=e.length&&e.some(function(e){return!e.isActive||e.isActive()});if(!n)return A=!0,void d.show({title:u.resources.Error,message:'<div class="wsb-editnavdlg-content">'+u.resources.Client__Designer__Sorry_you_must_have_at_least_one+"</div>",veil:I.controls,onClose:function(){A=!1}});var i=v(e);o.trackEvent("nav_edit_settings","saved_with_levels",i.toString()),o.trackEvent("nav_edit_settings","save","button"),t.isOpen(!1),O.enable(L)}}},{text:u.resources.Cancel,style:"link",cancel:!0}]}function b(e,t,n){var i=this;i.i18Dict={title:u.resources.Title},this._parentItem=r.observable(t),this._dialogViewModel=n,this.model=e,this.pageId=e.pageId,this.title=e.title,this.url=e.url.trimmed(),this.isActive=e.isActive,this.subItems=r.observableArray(),this.subItems((e.subItems&&e.subItems()||[]).map(function(e){return new b(e,i,n)})),this.isInactive=r.computed(function(){return!this.isActive()},this),this.isCustomLink=r.computed(function(){return!this.pageId()},this),this.isEditing=r.observable(!1),this._hasEditedTitle=r.observable(!1);var a=r.computed(function(){var e=this.title();return!this.isCustomLink()||e&&e.length},this);this.showTitleValidation=r.computed(function(){return this._hasEditedTitle()&&!a()},this),this.title.subscribe(function(){i._hasEditedTitle(!0),S(!1)}),this._hasEditedUrl=r.observable(!1);var o=r.computed(function(){var e=(this.url()||"").replace(/^\s+|\s+$/g,"");return!this.isCustomLink()||e&&"http://"!==e},this);this.showUrlValidation=r.computed(function(){return this._hasEditedUrl()&&!o()},this),this.url.subscribe(function(){i._hasEditedUrl(!0)}),this.showValidation=r.computed({read:function(){return this.showTitleValidation()||this.showUrlValidation()},write:function(e){this._hasEditedTitle(e),this._hasEditedUrl(e)}},this),this.isValid=r.computed(function(){return this.pageId()||a()&&o()},this),this.isIncomplete=r.computed(function(){return this.isCustomLink()&&!(a()^o())},this),this.isUnindentAllowed=r.computed(this.isUnindentAllowed,this),this.isIndentAllowed=r.computed(this.isIndentAllowed,this)}function f(t,n){e.isFunction(n.updateCallback)&&(x=n.updateCallback),e.isFunction(n.openCallback)&&(C=n.openCallback),e.isFunction(n.closeCallback)&&(T=n.closeCallback),A=!1,D.setNavItems(t),D.isOpen(!0),y()}function v(t){if(!t||!t.length)return 0;var n=e.map(t,function(e){return e.subItems?v(e.subItems()):0});return 1+Math.max.apply(this,n)}function y(){I.controls.parents(".sf-dialog:first").find(".sf-dialog-title").mousedown(function(){_()})}function _(){e(".url-picker-flyout:visible").length>0&&e(".wsb-picker-container .wsb-picker-icon").trigger("click")}function w(t,n){for(var i=n?n.find("> li"):I.controls.find(".wsb-editnavdlg-navlist > li"),a=[],o=0;o<i.length;o++){var s=i[o],l=r.dataFor(s);if(l){var d=l.model,c=w(t,e(s).find("> ul"));c.length||(c=null);var u=d.pageId(),g=u?null:d.title(),h=u?null:d.url();a.push(p.createNavItemModel(u,g,h,c,d.isActive()))}}return a}function S(e){var t=w(e);return x(t),t}function k(){D.isOpen(!1)}var x,C,T,E,P,D,I,A,M="wsb-designer-edit-menu",O=s.undoer,L=new Date;m.prototype.setNavItems=function(t){var n=this,i=[],a=this.populatePageInfoForNav(t,i);r.toJS(P.website.pages()).filter(function(t){return!t.isDeleted&&e.inArray((t.Id||"").toString(),i)<0}).forEach(function(e){var t=new b(p.createNavItemModel(e.Id,e.Name,null,null,!1),null,n);a.push(t)}),this.navItems(a)},m.prototype.populatePageInfoForNav=function(t,n){function i(t){return t.map(function(t){var a,o,s,l,d=(r.utils.unwrapObservable(t.pageId)||"").toString();if(d){n.push(d);var c=e.grep(r.toJS(P.website.pages()),function(e){return(e.Id||"").toString()===d})[0];if(!c)return;a=c.Name,o=null}else d=null,a=t.title(),o=t.url();return s=null!=t.subItems&&null!=t.subItems()?i(t.subItems()):null,l=null!=t.isActive&&null!=t.isActive()?t.isActive():!0,p.createNavItemModel(d,a,o,s,l)}).filter(function(e){return!!e})}var a=this;return i(t).map(function(e){return new b(e,null,a)})},m.prototype.validateAllCustomLinkInputs=function(e){function t(n){var i=!0,a=n().slice(0);return a.forEach(function(a){var r=a.isValid();r?a.isEditing(!1):a.isIncomplete()&&e?(n.remove(a),r=!0):a.showValidation(!0);var o=!a.subItems||t(a.subItems);i=i&&r&&o}),i}return t(this.navItems)},m.prototype.onAddCustomLink=function(){var t=new b(p.createNavItemModel(null,"",""),null,this);t.isEditing(!0),this.navItems.push(t);var n=e(".wsb-nav-arrange-wrap");return n.scrollTop(n[0].scrollHeight-n.height()),o.trackEvent("nav_edit_settings","add_navigation_link","link"),!1},m.prototype.onDocumentClick=function(t,n){return e(n.target).is("input")?void 0:!this.validateAllCustomLinkInputs(!1)},b.prototype.onEyeClick=function(){return o.trackEvent("nav_edit_settings",this.isActive()?"hide_page":"show_page","icon"),this.isActive(!this.isActive()),S(!1),!1},b.prototype.onStartEdit=function(e,t){return this._hasEditedTitle(!1),this._hasEditedUrl(!1),this.isEditing(!0),o.trackEvent(M,"edit-link","icon"),S(!1),t.stopPropagation(),!1},b.prototype.onDelete=function(){var e=r.utils.unwrapObservable(this.subItems)||[],t=this._parentItem();e.forEach(function(e){e.isActive(!1),e._parentItem(t)});var n=t?t.subItems:this._dialogViewModel.navItems,i=n.indexOf(this),a=[i,1].concat(e);return n.splice.apply(n,a),o.trackEvent(M,"delete-link","icon"),S(!1),!1},b.prototype.isIndentAllowed=function(){var e=this._parentItem(),t=e?e.subItems():this._dialogViewModel.navItems();if(t.indexOf(this)<=0)return!1;for(var n=0;e;)n++,e=e._parentItem();return n+this.getDescendentDepth()<2},b.prototype.getDescendentDepth=function(){var e=0;return this.subItems().forEach(function(t){e=Math.max(e,t.getDescendentDepth()+1)}),e},b.prototype.isUnindentAllowed=function(){return!!this._parentItem()},b.prototype.indent=function(){o.trackEvent("nav_edit_settings","indent","icon");var e=this._parentItem(),t=e?e.subItems:this._dialogViewModel.navItems,n=t.indexOf(this),i=t()[n-1];return t.remove(this),this._parentItem(i),i.subItems.push(this),S(!1),!1},b.prototype.unindent=function(){o.trackEvent("nav_edit_settings","unindent","icon");var e=this,t=this._parentItem(),n=t._parentItem(),i=n?n.subItems:this._dialogViewModel.navItems,a=i.indexOf(t),r=t.subItems,s=r.indexOf(this),l=r.splice(s,r().length-s).slice(1);return this._parentItem(n),i.splice(a+1,0,this),this.subItems.push.apply(this.subItems,l),l.forEach(function(t){t._parentItem(e)}),S(!1),!1};var N={open:f,load:h,close:k};return N}),define("designer/app/builder/ui/canvas/elements/customform/formUtils",[],function(){var e=function(t){for(var n in t){var i=t[n];"string"==typeof i&&i.length&&(i.match(/[0-9]/g)||[]).length===i.length?t[n]=parseInt(i):"object"==typeof i&&(i=e(i))}return t};return{getSortedArrayFromDictVals:function(e){var t=[];for(var n in e)t.push(n);return t.sort()},getKeyFromDict:function(e,t){for(var n in e)if(e[n]==t)return n;return null},getLocalizedMapping:function(e,t){var n=[];for(var i in t)n.push({id:t[i],name:e[i]});return n},convertObjectToArray:function(e){var t=[];for(var n in e)t.push({key:n,value:e[n]});return t},makeNumbersNotStrings:e}}),define("designer/app/builder/ui/canvas/elements/customform/customFormModel",["knockout","common/stats/googleanalytics","jquery","lodash","designer/app/builder/data/data","common/api/api.guid","designer/app/builder/ui/canvas/elements/customform/formUtils","designer/app/builder/managers/elementManager","/i18n/resources/client","common/abTesting/abTesting","async!initDataModel"],function(e,t,n,i,a,r,o,s,l,d,c){function u(){var e=c.CustomFormFeatures;i.isString(e)&&(e=JSON.parse(e)),e.forEach(function(e){e.elements.forEach(function(e){e&&e.ID&&!r.isValid(e.ID)&&(e.ID=r.toUuid(e.ID))})}),y=e}function p(e,a){var r,o=1/0,l=o,d=o,c=0,u=0,p=e[0],g=(p.Locked(),p.IncludeInMobileSite(),p.Shared()),h=p.pageIds(),b=m,f=p.GroupID();t.trackEvent("form_settings","type",a.name),n.each(e,function(e,t){l=Math.min(t.pixelTop(),l),d=Math.min(t.pixelLeft(),d),u=Math.max(t.Layer(),u),c=Math.max(t.pixelWidth(),c),t.FormType()===C.button&&(r=t.FormConfigData()),s.deleteElement(t)});var v={Type:b,Width:c+"px",Shared:g},y=1/0,_=i.map(a.elements,function(e){return y=Math.min(parseInt(e.Top),y),{Type:v.Type,Top:e.Top,Left:d,Width:v.Width,Height:e.Height,FormType:e.FormType,FormLabel:e.FormLabel,FormConfigData:e.FormType===C.button?r:e.FormConfigData,FormHelpTip:e.FormHelpTip,GroupID:f,pageIds:h,Shared:v.Shared}
});_.sort(function(e,t){return parseInt(e.Top)-parseInt(t.Top)});var w=l;i.each(_,function(e){var t=w,n=parseInt(e.Height);e.Top=t+"px",w=t+n}),s.addNewElementsToCanvas(_,void 0,!0)}function g(){return 0==y.length?{id:0}:n.grep(y,function(e){return e.isDefault===!0})[0]}function h(e){return n.grep(y,function(t){return t.id===e})[0]}var m,b,f=(a.saver,a.undoer,l.resources.Client__Designer__Element_File_must_be_10_MB_or_less),v=l.resources.Client__Designer__Element_Form_Submit_Message,y=[],_={showMessage:0,redirect:1},w={above:0,left:1},S={singleColumn:0,freeForm:100},k={vertical:0,horizontal:1},x={15:l.resources.Client__15min,30:l.resources.Client__30min,60:l.resources.Client__1hour},C={input:0,paragraph:1,radio:2,checkbox:3,dropdown:4,file:5,date:6,address:7,phone:8,email:9,button:100},T={datetime:0,date:1,time:2},E="[EMAIL_ADDRESS]",P={input:l.resources.Name,paragraph:l.resources.Comments,radio:l.resources.Choose,checkbox:l.resources.Choose,dropdown:l.resources.Choose,file:l.resources.Upload_File,date:l.resources.Client__Date_and_Time,address:l.resources.Address,phone:l.resources.Phone,email:l.resources.Email,button:l.resources.Submit},D=[l.resources.Client__Option_one,l.resources.Client__Option_two,l.resources.Client__Option_three],I={input:{items:[],orientation:k.vertical,placeHolderText:l.resources.Client__Designer__Element_Enter_text_here,isRequired:!1,fileButtonText:l.resources.Client__Designer__Element_Choose_File,fileDisplayText:f,toolTipText:""},paragraph:{items:[],orientation:k.vertical,placeHolderText:l.resources.Client__Designer__Element_Enter_text_here,isRequired:!1,fileButtonText:l.resources.Client__Designer__Element_Choose_File,fileDisplayText:f,toolTipText:""},radio:{items:D,orientation:k.vertical,isRequired:!1,placeHolderText:"",fileButtonText:l.resources.Client__Designer__Element_Choose_File,fileDisplayText:f,toolTipText:""},checkbox:{items:D,orientation:k.vertical,isRequired:!1,placeHolderText:"",fileButtonText:l.resources.Client__Designer__Element_Choose_File,fileDisplayText:f,toolTipText:""},dropdown:{items:D,orientation:k.vertical,isRequired:!1,placeHolderText:"",fileButtonText:l.resources.Client__Designer__Element_Choose_File,fileDisplayText:f,toolTipText:""},file:{items:[],orientation:k.vertical,isRequired:!1,placeHolderText:"",fileButtonText:l.resources.Client__Designer__Element_Choose_File,fileDisplayText:f,toolTipText:""},date:{isRequired:!1,toolTipText:"",dateDisplayMode:0,dateAllowDateRange:!1,dateAllowOnlyFutureDate:!1,dateAllowOnlyInterval:!0,dateTimeIntervalMins:30},address:{items:[],orientation:k.vertical,placeHolderText:l.resources.Client__Designer__Element_Enter_address,isRequired:!1,fileButtonText:l.resources.Client__Designer__Element_Choose_File,fileDisplayText:f,toolTipText:""},phone:{items:[],orientation:k.vertical,placeHolderText:l.resources.Client__Designer__Element_Enter_phone_number,isRequired:!1,fileButtonText:l.resources.Client__Designer__Element_Choose_File,fileDisplayText:f,toolTipText:""},email:{items:[],gemSubmit:!0,orientation:k.vertical,placeHolderText:l.resources.Client__Designer__Element_Enter_email_address,isRequired:!1,fileButtonText:l.resources.Client__Designer__Element_Choose_File,fileDisplayText:f,toolTipText:""},button:{items:D,orientation:k.vertical,isRequired:!1,placeHolderText:"",fileButtonText:l.resources.Client__Designer__Element_Choose_File,fileDisplayText:f,toolTipText:"",emailAddress:E,gemSubmit:!0,redirectUrl:"",postSubmitOption:_.showMessage,postSubmitMessage:v,labelOrientation:w.above,mode:S.singleColumn,subject:"",spacing:25,dateDisplayMode:0,dateAllowDateRange:!1,dateAllowOnlyFutureDate:!1,dateAllowOnlyInterval:!0,dateTimeIntervalMins:30}};return"disabled"===d.getOption("datetimeFormElement")&&delete C.date,{initModule:function(e){m=e,u()},getGroupElements:function(e){var t=void 0===e?g():h(e);return t.elements},replace:p,setModelProps:function(e){b=e},getAvailableForms:function(){return y},getDefaultFormLabel:function(e){return P[o.getKeyFromDict(C,e)]},getDefaultForm:g,getFormById:h,availablePostSubmitOptions:_,availableOrientations:w,availableLayoutOptions:S,availableOptionOrientations:k,availableTimeIntervals:x,availableFormTypes:C,defaultConfigData:I,emailPlaceholder:E,availableDateDisplayMode:T}}),define("text!designer/app/builder/ui/controls/formFlyOut/formFlyOut.html",[],function(){return'<div>\r\n    <div id="customform_leftFlyOut">\r\n        <!-- ko if: isEditField -->\r\n        <div data-bind="click: showChange, clickBubble: false" class="cf-ios-title-container clearfix">\r\n            <a class="cf-change-btn cf-ios-btn" data-bind="text: i18N.Change"></a>\r\n            <div data-bind="text: title" class="cf-flyout-title"></div>\r\n        </div>\r\n        <!-- /ko -->\r\n    \r\n        <!-- ko ifnot: isEditField -->\r\n            <div data-bind="text: title" class="cf-flyout-title2"></div>\r\n            <ul data-bind="foreach: fieldOptions" class="wsb-customform-type-choices">\r\n                <li>\r\n                    <a data-bind="click: selectOption.bind($data, $parent), clickBubble: false, attr: { \'class\': \'cf-add-field-options cf_add_\' + type }">\r\n                        <span data-bind="text: title"></span>\r\n                    </a>       \r\n                </li>\r\n            </ul>\r\n    \r\n        <!-- /ko -->\r\n        <div data-bind="visible: isEditField" class="cf-isEdit-field">\r\n            <div class="wsb-form-label-wrap">\r\n                <label class="wsb-block-label" data-bind="text: i18N.Label"></label>\r\n                <input type="text" data-bind="value: formLabel, valueUpdate: \'input\'" class="wsb-text-box wsb-customform-textbox" />\r\n            </div>\r\n            <!-- ko if: hasPlaceholderText -->\r\n            <div class="wsb-form-placeholder">\r\n                <label class="wsb-block-label" data-bind="text: i18N.Placeholder"></label>\r\n                <input type="text" class="wsb-text-box wsb-customform-textbox" data-bind="value: placeHolderText, valueUpdate: \'input\'"/>\r\n            </div>\r\n            <!-- /ko -->\r\n            <!-- ko if: hasOptions -->\r\n            <div class="wsb-form-hasoptions-wrap">\r\n                <div class="wsb-form-hasoptions-label">\r\n                    <label data-bind="text: optionsLabel"> </label>\r\n                    <span data-bind="text: i18N.OnePerLine"></span>\r\n                </div>\r\n                <textarea id="customform_options_textarea" class="wsb-sev-site-desc" data-bind="optionslist: items"></textarea>\r\n            </div>\r\n            <!-- ko if: isMultiSelect -->\r\n            <div class="wsb-form-multiselect">\r\n                <label class="wsb-block-label" data-bind="text: i18N.Layout"></label>\r\n                <label class="radio inline" data-bind="click: selectVertical, clickBubble: false"><input type="radio" value="0" name="multiSelectOrientationGroup"  data-bind="checked: multiSelectOrientation" /><span data-bind="text: i18N.Vertical"></span></label>\r\n                <label class="radio inline" data-bind="click: selectHorizontal, clickBubble: false"><input type="radio" value="1" name="multiSelectOrientationGroup" data-bind="checked: multiSelectOrientation" /><span data-bind="text: i18N.Horizontal"></span></label>\r\n            </div>\r\n            <!-- /ko -->\r\n            <!-- /ko -->\r\n\r\n            <!-- ko if: isFile -->\r\n            <div class="wsb-form-placeholder">\r\n                <label class="wsb-block-label" data-bind="text: i18N.ButtonText"></label>\r\n                <input type="text" class="wsb-text-box wsb-customform-textbox" data-bind="value: fileButtonText, valueUpdate: \'input\'"/>\r\n            </div>\r\n            <!-- /ko -->\r\n            <!-- ko if: isDate -->\r\n            <div class="wsb-form-label-wrap">\r\n                <label class="wsb-block-label"  data-bind="text: i18N.Display"></label>\r\n                <select class="wsb-select-box" data-bind="value: dateDisplayMode, click: adjustForm, clickBubble: false">\r\n                    <option value="0" data-bind="text: i18N.DateAndTime"></option>\r\n                    <option value="1" data-bind="text: i18N.DateOnly"></option>\r\n                    <option value="2" data-bind="text: i18N.TimeOnly"></option>\r\n                </select>\r\n            </div>\r\n            <div class="datetime-checkboxlist">\r\n                <!-- ko if: hasDate -->\r\n                <label class="checkbox"><input type="checkbox" data-bind="checked: dateAllowOnlyFutureDate"/><span  data-bind="text: i18N.AllowOnlyFutureDates"></span></label>\r\n                <label class="checkbox"><input type="checkbox" data-bind="checked: dateAllowDateRange, clickBubble: false" /><span data-bind="text: i18N.AllowDateRanges"></span></label>\r\n                <!-- /ko -->\r\n                <!-- ko if: hasTime -->\r\n                <label class="checkbox"><input type="checkbox" data-bind="checked: dateAllowOnlyInterval" /><span data-bind="text: i18N.Allow"></span>\r\n                    <select data-bind="options: timeIntervals, optionsText: \'value\', optionsValue: \'key\', value: dateTimeIntervalMins, event: { clickBubble: false, click: function () { return false; } }"></select> <span data-bind="text: i18N.Intervals"></span></label>\r\n                <!-- /ko -->\r\n            </div>\r\n            <!-- /ko -->\r\n            <label class="checkbox">\r\n                <input type="checkbox" data-bind="checked: isRequired, disable: isOnlyRequired, click: selectedRequiredOption" />\r\n                <span data-bind="text: i18N.MakeRequired"></span>\r\n            </label>\r\n            <div class="wsb-advanced-link-wrap">\r\n                <a data-bind="text: advancedTitle, click: toggleAdvanced" class="wsb-link" style="cursor:pointer;"></a>\r\n            </div>\r\n\r\n            <div id="customform_flyout_advanced" style="display:none;">\r\n                <label class="wsb-block-label" data-bind="text: i18N.TooltipText"></label>\r\n                <textarea id="customform_tooltip_textarea" class="wsb-sev-site-desc" data-bind="value: toolTipText"></textarea>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <span id="customform_leftFlyOut_anchor"></span>\r\n</div>\r\n\r\n'}),define("designer/app/builder/ui/controls/formFlyOut/formFlyOut",["knockout","common/stats/googleanalytics","designer/app/app","jquery","designer/app/builder/ui/canvas/elements/customform/customFormModel","/i18n/resources/client","designer/app/builder/data/data","designer/app/builder/ui/canvas/elements/customform/formUtils","text!designer/app/builder/ui/controls/formFlyOut/formFlyOut.html"],function(e,t,n,i,a,r,o,s,l){function d(){b&&b.updateFormConfigData()}function c(e,t){var n=t();n!==e&&t(e)}function u(e){i.each(e,function(t,n){(void 0===n||null===n)&&(e[t]="")})}function p(e,t){var n=this;n.title=e,n.type=t,n.i18N=k,n.selectOption=function(e){if(_[n.type]!==b.formType())for(var t in k)if(k[t]===n.title)return b.replaceFormType(_[t]),e.state(_[t]),v.flyout.sfContext("reposition"),v.optionsTA.val(""),void v.tooltipTA.val("")}}function g(){var e=[];for(var t in _){var n=_[t];0>n||n>99||e.push(new p(k[t],t))}return e}function h(){var n=this,o=[],l=0,p=["formLabel","items","isRequired","placeHolderText","toolTipText","multiSelectOrientation","fileButtonText","dateDisplayMode","dateAllowDateRange","dateAllowOnlyFutureDate","dateAllowOnlyInterval","dateTimeIntervalMins"];n.currentModel=null,n.fieldOptions=g(),n.i18N=k,n.timeIntervals=s.convertObjectToArray(S).sort(function(e,t){return parseInt(e.key)>=parseInt(t.key)}),n.availableDateDisplayMode=a.availableDateDisplayMode,n.state=e.observable(_.add),n.items=e.observableArray(),n.isRequired=e.observable(!1),n.formLabel=e.observable(),n.placeHolderText=e.observable(),n.toolTipText=e.observable(),n.isAdvanced=e.observable(!1),n.multiSelectOrientation=e.observable(w.vertical),n.isOnlyRequired=e.observable(!1),n.fileButtonText=e.observable(r.resources.Client__Designer__Element_Choose_file_lcase),n.dateDisplayMode=e.observable(a.availableDateDisplayMode.datetime),n.dateAllowDateRange=e.observable(!1),n.dateAllowOnlyFutureDate=e.observable(!1),n.dateAllowOnlyInterval=e.observable(!0),n.dateTimeIntervalMins=e.observable(30),n.isEditField=e.computed(function(){return n.state()>=0}),n.isAdd=e.computed(function(){return n.state()===_.add}),n.hasPlaceholderText=e.computed(function(){var e=_;return-1!=i.inArray(n.state(),[e.input,e.paragraph,e.address,e.phone,e.email])}),n.hasOptions=e.computed(function(){var e=_;return-1!=i.inArray(n.state(),[e.radio,e.checkbox,e.dropdown])}),n.isMultiSelect=e.computed(function(){var e=_;return-1!=i.inArray(n.state(),[e.radio,e.checkbox])}),n.optionsLabel=e.computed(function(){return n.hasOptions()?n.state()===_.checkbox?r.resources.Client__Designer__Element_Checkboxes:r.resources.Client__Designer__Element_Choices:""}),n.isDate=e.computed(function(){return n.state()===_.date}),n.isFile=e.computed(function(){return n.state()===_.file}),n.title=e.computed(function(){var e=n.state();for(var t in _)if(_[t]===e)return k[t];return""}),n.hasDate=e.computed(function(){return 2!=n.dateDisplayMode()}),n.hasTime=e.computed(function(){return 1!=n.dateDisplayMode()}),n.advancedTitle=e.computed(function(){return C[n.isAdvanced()?0:1]}),n.itemsLength=e.computed(function(){u(n.items());var e=n.items(),t=e?e.length:0;return t!=l&&(l=t),t}),n.showChange=function(){t.trackEvent("form_settings","change_element","button"),n.state(_.change),v.flyout.sfContext("reposition")},n.toggleAdvanced=function(){var e=!n.isAdvanced();t.trackEvent("form_settings",(e?"show":"hide")+"advanced","toggle"),i("#customform_flyout_advanced").slideToggle({duration:250,step:function(){v.flyout.sfContext("reposition")},complete:function(){n.isAdvanced(e)}})},n.selectVertical=function(){return t.trackEvent("form_settings","orientation","vertical"),!0},n.selectHorizontal=function(){return t.trackEvent("form_settings","orientation","horizontal"),!0},n.selectedRequiredOption=function(e,n){if(n.currentTarget){var i=n.currentTarget.checked;t.trackEvent("form_settings","required_"+(i?"on":"off"),"checkbox")}return!0},n.adjustForm=function(){},n.update=function(e,t){function a(){i.each(o,function(e,t){t.dispose()}),o=[]}d(),b=e,a(),i.each(p,function(e,t){switch(t){case"formLabel":viewModelObservable=b.formLabel;break;case"multiSelectOrientation":viewModelObservable=b.configData().orientation;break;default:viewModelObservable=b.configData()[t]}if(viewModelObservable){var i=viewModelObservable();n[t](i),o.push(viewModelObservable.subscribe(function(e){c(e,n[t])}))}}),n.state(t?_.change:b.formType())},i.each(p,function(e,t){n[t].subscribe(function(e){var n;if(b){switch(t){case"formLabel":n=b.formLabel;break;case"multiSelectOrientation":n=b.configData().orientation;break;default:n=b.configData()[t]}n&&(c(e,n),d())}})}),n.state.subscribe(function(e){setTimeout(function(){v.flyOutContainer||(v.flyOutContainer=v.flyout.closest(".sf-flyout").addClass("wsb-flyout-container")),0>e?v.flyOutContainer.addClass("wsb-form-flyout-change").removeClass("wsb-form-flyout-edit"):v.flyOutContainer.removeClass("wsb-form-flyout-change").addClass("wsb-form-flyout-edit")},0)})}function m(e){return e&&e.length>0&&e.trim().length>0?!0:!1}var b,f,v={},y=o.undoer,_=i.extend({},a.availableFormTypes,{add:-2,change:-1}),w=a.availableOptionOrientations,S=a.availableTimeIntervals,k={add:r.resources.Client__Designer__Element_Choose_Type,change:r.resources.Client__Designer__Element_Choose_Type,input:r.resources.Text,paragraph:r.resources.Client__Designer__Element_Multiline_Text,radio:r.resources.Client__Designer__Element_Multiple_Choice,checkbox:r.resources.Client__Designer__Element_Checkbox,dropdown:r.resources.Client__Designer__Element_Drop_Down,file:r.resources.Client__Designer__Element_Submit_File,date:r.resources.Client__Designer__Element_Date_fslash_Time,address:r.resources.Address,phone:r.resources.Phone,email:r.resources.Email_Address,Change:r.resources.Change,Label:r.resources.Label,Placeholder:r.resources.Server__Placeholder_text,OnePerLine:" - "+r.resources.Server__One_per_line,Layout:r.resources.Server__Layout,Vertical:r.resources.Server__Vertical,Horizontal:r.resources.Server__Horizontal,ButtonText:r.resources.Server__Button_text,Display:r.resources.Server__Display,DateAndTime:r.resources.Server__Date_and_time,DateOnly:r.resources.Server__Date_only,TimeOnly:r.resources.Server__Time_only,AllowOnlyFutureDates:r.resources.Server__Allow_only_dates_in_the_future,AllowDateRanges:r.resources.Server__Allow_date_ranges,Allow:r.resources.Server__Allow_only,Intervals:r.resources.Server__Intervals,MakeRequired:r.resources.Server__Make_this_a_required_field,TooltipText:r.resources.Server__Text_to_display_as_tooltip},x=0,C=[r.resources.Client__Designer__Element_Hide_advanced,r.resources.Client__Designer__Element_Advanced];return{update:function(e,t){y.enable(),y.collect(),f.update(e,t)},show:function(e,t,n){y.enable(),y.collect(),clearTimeout(x),n=n||i("body");var a=n.find("#"+e.ID());0!==a.length&&(x=setTimeout(function(){var n=a.offset(),r=Math.round(n.top-v.container.offset().top-20+e.pixelHeight()/2),o=n.left+a.width(),s=window.innerHeight,l=r-s;l>0&&(r-=l),0>r&&(r=i("#app-header").outerHeight()),v.flyoutAnchor.css({top:r,left:o}),f.update(e,t),f.formLabel.originalValue=f.formLabel(),v.flyout.sfContext(v.flyout.sfContext("isOpen")?"reposition":"open")},0))},hide:function(e){m(f.formLabel())||f.formLabel(f.formLabel.originalValue),y.enable(),v.flyout.sfContext("isOpen")&&(clearTimeout(x),x=setTimeout(function(){d(),v.flyout.sfContext(e?"closenow":"close")},0))},load:function(t,i){return n.addControl(l,"builder","form-flyoutz"),v.flyout=i.find("#customform_leftFlyOut"),v.flyoutAnchor=i.find("#customform_leftFlyOut_anchor"),v.optionsTA=i.find("#customform_options_textarea"),v.tooltipTA=i.find("#customform_tooltip_textarea"),v.flyout.sfContext({anchor:v.flyoutAnchor,positionIdeal:"ml",centerAgainstAnchor:!0,width:290,onClose:function(){b.clearOutStates()}}),v.container=i.find("#form-flyoutz"),f=new h,e.applyBindings(f,v.flyout[0]),t&&t(null,"form-flyout"),f}}}),define("text!designer/app/builder/ui/controls/controls.html",[],function(){return'<script type="text/html" id="picker-template">\r\n    <div class="wsb-picker-container" data-bind="event: { click: function() { return false; } }, clickBubble: false">\r\n\r\n        <!-- ko if: $data.editorTemplate && !isPlaceholder() -->\r\n        <!-- ko template: { name: editorTemplate, data: editorModel } -->\r\n        <!-- /ko -->\r\n        <!-- /ko -->\r\n        <!-- ko ifnot: $data.editorTemplate -->\r\n        <input type="text" maxlength="2000" class="wsb-text-box wsb-picker-textbox" data-bind="\r\n            css: \'wsb-text-box wsb-redo-select\' + ( ((!showError || showError()) && (value && value.isValid && !value.isValid())) ? \' wsb-text-box-error\': \'\' ),\r\n            value: value,\r\n            visible: !isPlaceholder(),\r\n            attr: { placeholder: watermark },\r\n            valueUpdate: \'input\',\r\n            event: { change: normalize }" />\r\n        <!-- ko if: showError -->\r\n        <div class="wsb-text-box-error-text" data-bind="text: value.validationMessage(), visible: value && value.isValid && !value.isValid()"></div>\r\n        <!-- /ko -->\r\n        <!-- /ko -->\r\n\r\n        <div class="wsb-picker-placeholder-container" data-bind="visible: isPlaceholder">\r\n            <!-- ko if: loading() -->\r\n            <div class="loading"><span data-bind= "text: i18Dict.Loading"></span></div>            \r\n            <!-- /ko -->\r\n            <!-- ko ifnot: loading() -->\r\n            <div data-bind="attr: { \'class\': \'wsb-picker-placeholder \' + placeholderCssClass() }">\r\n                <span data-bind="text: placeholderText, attr: { title: placeholderTooltip }"></span>\r\n                <a class="wsb-picker-clear-selection"\r\n                   href="#"\r\n                   data-bind="click: clear, attr: {title: i18Dict.Clear_selection}"></a>\r\n            </div>\r\n            <!-- /ko -->\r\n        </div>       \r\n        <!-- ko ifnot: loading() -->\r\n        <!-- ko with: flyoutModel -->\r\n        <div class="wsb-picker-icon" style="position: absolute;" data-bind="contextFlyout: {\r\n            template: $parent.flyoutTemplate,\r\n            cssClass: $parent.flyoutCssClass,\r\n            position: \'ur\',\r\n            inDialog: true,\r\n            dismissOtherFlyouts: $parent.dismissOtherFlyouts,\r\n            isOpen: $parent.isFlyoutOpen,\r\n            width: $parent.flyoutWidth,\r\n            open: $parent.flyoutOpen\r\n        }">\r\n        </div>\r\n        <!-- /ko -->\r\n        <!-- /ko -->\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="url-picker">\r\n    <div data-bind="picker: {\r\n        value: url,\r\n        isPlaceholder: isSelected,\r\n        watermark: watermark,\r\n        placeholderText: selectedName,\r\n        placeholderCssClass: selectedCssClass,\r\n        flyoutTemplate: \'url-picker-flyout-template\',\r\n        flyoutWidth: 300,\r\n        dismissOtherFlyouts: dismissOtherFlyouts,\r\n        flyoutOpen: onFlyoutOpen,\r\n        normalize: normalizeUrl,\r\n        showError: showError,\r\n        loading: loading\r\n    }"></div>\r\n</script>\r\n\r\n<script type="text/html" id="url-picker-flyout-template">\r\n    <div data-bind="event: { click: function() { return false; } }, clickBubble: false">\r\n        <span class="wsb-flyout-uploader" data-bind="visible: $root.showUploader, event: { click: $root.openUploader }, text: i18Dict.Upload"></span>\r\n        <h2 class="wsb-flyout-hdr" data-bind= "text: i18Dict.LinkToColon"></h2>\r\n        <ul class="url-picker-list" data-bind="\r\n            template: {\r\n                name: \'wsb-page-list-item\',\r\n                foreach: selectable\r\n            }"></ul>\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="wsb-page-list-item">\r\n    <li class="url-picker-list-item" data-bind="css: { selected: $root.selected() === $data }, event: { click: $root.select }, clickBubble: false">\r\n        <div data-bind="text: name, attr: { \'class\': \'url-picker-item-icon \' + (($data.mime) ? \'wsb-mime wsb-mime-\' + mime : \'url-picker-icon-\' + ($data.type||\'page\')) }"></div>\r\n\r\n        <!-- ko if: $data.pages -->\r\n        <ul data-bind="template: { name: \'wsb-page-list-item\', foreach: items }"></ul>\r\n        <!-- /ko -->\r\n    </li>\r\n</script>\r\n\r\n<script type="text/html" id="slider">\r\n    <div class="slider" data-bind="event: { mousedown: jumpToPosition }, mousedownBubble: false">\r\n        <div class="slider-track">\r\n            <div class="slider-filled-area" data-bind="style: { width: (percent() * 100) + \'%\' }"></div>\r\n            <div class="slider-thumb" data-bind="\r\n                style: { left: (percent() * 100) + \'%\' },\r\n                event: { mousedown: startDrag },\r\n                mousedownBubble: false"></div>\r\n        </div>\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="carousel">\r\n    <div class="wsb-carousel clearfix">\r\n        <span class="wsb-carousel-scroll-btn-left"\r\n              data-bind="click: scrollLeft, css: { active: canScrollLeft }">\r\n        </span>\r\n        <div class="wsb-carousel-scroll-panel body">\r\n            <ul data-bind="\r\n                animated: { properties: { left: -scrollPosition() + \'px\' }, duration: 300 }\r\n            ">\r\n                <!-- ko if: hasNoneTemplate -->\r\n                <li data-bind="\r\n                    css: { selected: isItemSelected(noneValue) },\r\n                    click: selectNoneItem,\r\n                    template: noneTemplate">\r\n                </li>\r\n                <!-- /ko -->\r\n                <!-- ko foreach: items -->\r\n                <li data-bind="\r\n                    css: { selected: $parent.isItemSelected($data) },\r\n                    click: $parent.selectItem,\r\n                    template: $parent.itemTemplate">\r\n                </li>\r\n                <!-- /ko -->\r\n            </ul>\r\n        </div>\r\n        <span class="wsb-carousel-scroll-btn-right"\r\n              data-bind="click: scrollRight, css: { active: canScrollRight }">\r\n        </span>\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="toolbox-drag-hint-template">\r\n    <div class="wsb-drag-hint-flyout" data-bind="style: { top: top }">\r\n        <p data-bind= "text: i18Dict.DragTheseElementsOntoThePage"></p>\r\n        <a href="#" data-bind="click: close, text: i18Dict.Ok" class="btn btn-success"></a>\r\n        <label class="checkbox">\r\n            <input type="checkbox" data-bind="checked: dontShowAgainChecked" /><span data-bind= "text: i18Dict.DontShowAgain"></span>\r\n        </label>\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="autocomplete-flyout-template">\r\n    <!-- ko if: isOpen -->\r\n    <ul class="wsb-autocomplete" data-bind="style: { top: top, left: left, zIndex: zIndex, maxHeight: maxHeight }">\r\n        <!-- ko if: isSearchMode -->\r\n        <!-- ko foreach: searchMatches -->\r\n        <li data-bind="click: select, css: { \'selected\': isHighlighted }, scrollIntoView: isHighlighted() && { container: \'.wsb-autocomplete\' }">\r\n            <span class="wsb-autocomplete-item-text" data-bind="html: matchHtml"></span>\r\n        </li>\r\n        <!-- /ko -->\r\n        <!-- /ko -->\r\n        <!-- ko if: isBrowseMode -->\r\n        <!-- ko template: {  name: \'autocomplete-flyout-browse-item-template\', foreach: browseItems } -->\r\n        <!-- /ko -->\r\n        <!-- /ko -->\r\n    </ul>\r\n    <!-- /ko -->\r\n</script>\r\n<script type="text/html" id="autocomplete-flyout-browse-item-template">\r\n    <li data-bind="\r\n        css: { \'selected\': isHighlighted, \'has-children\': hasChildren },\r\n        scrollIntoView: isHighlighted() && { container: \'.wsb-autocomplete\' },\r\n        click: select,\r\n        clickBubble: false\r\n    ">\r\n        <span class="wsb-autocomplete-item-text" data-bind="text: text"></span>\r\n        <!-- ko if: children -->\r\n        <ul data-bind="template: { name: \'autocomplete-flyout-browse-item-template\', foreach: children }"></ul>\r\n        <!-- /ko -->\r\n    </li>\r\n</script>\r\n'}),define("text!designer/app/builder/ui/canvas/elements/image/imgeditor.html",[],function(){return'<script type="text/html" id="wsb-image-editor">\r\n    <div class="wsb-image-editor-overlay" data-bind="event: { mousedown: save, mousedownBubble: false }">\r\n        <div class="wsb-image-editor-border" data-bind="style: {\r\n            top: imageTop() + \'px\',\r\n            left: imageLeft()+ \'px\',\r\n            width: imageWidth()+ \'px\',\r\n            height: imageHeight()+ \'px\'\r\n        }">\r\n            <img class="wsb-image-editor-draggable" data-bind="\r\n                attr: { src: imagePath },\r\n                style: { left: imageLeft() + \'px\', top: imageTop() + \'px\', width: imageWidth() + \'px\', height: imageHeight() + \'px\' },\r\n                event: { mousedown: startMove },\r\n                mousedownBubble: false" />\r\n            <div class="wsb-image-editor-cropzone wsb-image-editor-draggable" data-bind="\r\n                style: {\r\n                    top: cropTop() + \'px\',\r\n                    left: cropLeft() + \'px\',\r\n                    width: cropWidth() + \'px\',\r\n                    height: cropHeight() + \'px\'\r\n                },\r\n                event: { mousedown: startMove },\r\n                mousedownBubble: false,\r\n                if: isCropWindowMovable\r\n            ">\r\n                <span class="wsb-image-editor-resize wsb-image-editor-resize-n" data-bind="event: {mousedown: startResize}, mousedownBubble: false"></span>\r\n                <span class="wsb-image-editor-resize wsb-image-editor-resize-s" data-bind="event: {mousedown: startResize}, mousedownBubble: false"></span>\r\n                <span class="wsb-image-editor-resize wsb-image-editor-resize-w" data-bind="event: {mousedown: startResize}, mousedownBubble: false"></span>\r\n                <span class="wsb-image-editor-resize wsb-image-editor-resize-e" data-bind="event: {mousedown: startResize}, mousedownBubble: false"></span>\r\n                <span class="wsb-image-editor-resize wsb-image-editor-resize-nw" data-bind="event: {mousedown: startResize}, mousedownBubble: false"></span>\r\n                <span class="wsb-image-editor-resize wsb-image-editor-resize-sw" data-bind="event: {mousedown: startResize}, mousedownBubble: false"></span>\r\n                <span class="wsb-image-editor-resize wsb-image-editor-resize-ne" data-bind="event: {mousedown: startResize}, mousedownBubble: false"></span>\r\n                <span class="wsb-image-editor-resize wsb-image-editor-resize-se" data-bind="event: {mousedown: startResize}, mousedownBubble: false"></span>\r\n            </div>\r\n            <div class="wsb-image-editor-margins" data-bind="event: { mousedown: startMove }, mousedownBubble: false">\r\n                <div class="wsb-image-editor-semitransparent wsb-image-editor-draggable"\r\n                     style="left: 0; top: 0;"\r\n                     data-bind="style: { width: marginLeft, height: marginTop }">\r\n                </div>\r\n                <div class="wsb-image-editor-semitransparent wsb-image-editor-draggable"\r\n                     style="top: 0"\r\n                     data-bind="style: { left: marginLeft, right: marginRight, height: marginTop }">\r\n                </div>\r\n                <div class="wsb-image-editor-semitransparent wsb-image-editor-draggable"\r\n                     style="top: 0; right: 0"\r\n                     data-bind="style: { width: marginRight, height: marginTop }">\r\n                </div>\r\n                <div class="wsb-image-editor-semitransparent wsb-image-editor-draggable"\r\n                     style="left: 0"\r\n                     data-bind="style: { top: marginTop, width: marginLeft, bottom: marginBottom }">\r\n                </div>\r\n                <div class="wsb-image-editor-semitransparent wsb-image-editor-draggable"\r\n                     style="right: 0"\r\n                     data-bind="style: { width: marginRight, top: marginTop, bottom: marginBottom }">\r\n                </div>\r\n                <div class="wsb-image-editor-semitransparent wsb-image-editor-draggable"\r\n                     style="left: 0; bottom: 0"\r\n                     data-bind="style: { height: marginBottom, width: marginLeft }">\r\n                </div>\r\n                <div class="wsb-image-editor-semitransparent wsb-image-editor-draggable"\r\n                     style="bottom: 0"\r\n                     data-bind="style: { left: marginLeft, height: marginBottom, right: marginRight }">\r\n                </div>\r\n                <div class="wsb-image-editor-semitransparent wsb-image-editor-draggable"\r\n                     style="right: 0; bottom: 0"\r\n                     data-bind="style: { width: marginRight, height: marginBottom }">\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <div class="wsb-image-editor-control-positioner" data-bind="style: { top: toolbarTop, left: toolbarLeft }">\r\n            <div class="wsb-image-editor-controls clearfix" data-bind="event: { mousedown: function() { return false; } }, mousedownBubble: false">\r\n\r\n                <div class="wsb-img-controls-label" data-bind="text: i18Dict.Server__Zoom_colon"></div>\r\n\r\n                <div class="wsb-img-size-slider">\r\n                    <input type="text" data-bind="value: zoom, slider: { min: minZoom, max: maxZoom, scale: \'log\' }" />\r\n                </div>\r\n\r\n                <div class="wsb-img-controls-btns">\r\n                    <a class="wsb-img-reset-100" href="#" data-bind="click: resetZoom, tooltip: i18Dict.Server__Reset_to_100_percent"></a>\r\n                    <span data-bind="visible: advancedEditorButtonVisible">\r\n                        <a href="#" data-bind="click: showAdvancedEditor, tooltip: i18Dict.Server__Image_editor" class="wsb-img-advedit"></a>\r\n                    </span>\r\n                    <a href="#" data-bind="click: save, text: i18Dict.OK" class="btn btn-success btn-success-sm-ok"></a> <a href="#" data-bind="click: cancel, text: i18Dict.Cancel" class="sf-dialog-link wsb-img-contols-link"></a>\r\n\r\n                    <!-- ko foreach: buttons -->\r\n                    <a href="javascript:void(0);" data-bind="attr: { title: $data.tooltip, \'class\': $data.cssClass }, text: $data.text, click: $data.click"></a>\r\n                    <!-- /ko -->\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</script>\r\n'
}),define("designer/app/builder/ui/controls/controls",["libs/async-util/async","designer/app/app","designer/app/builder/ui/controls/toolbox/toolbox","designer/app/builder/ui/controls/actionmenu/actionmenu","designer/app/builder/ui/controls/mutator/mutator","designer/app/builder/ui/controls/media/chooser/media.chooser","designer/app/builder/ui/controls/publish/publish","designer/app/builder/ui/controls/navigationDialog/el.navigation.dialog","designer/app/builder/ui/controls/siteSettings/siteSettings","designer/app/builder/ui/controls/csseditor/csseditor","designer/app/builder/ui/controls/formFlyOut/formFlyOut","designer/app/builder/ui/controls/hamburgerFlyOut/hamburgerFlyOut","designer/app/builder/ui/controls/gridGuides/gridGuidesFlyout","designer/app/builder/ui/controls/overlay/overlay","designer/app/builder/ui/controls/toggle/toggle","text!designer/app/builder/ui/controls/controls.html","text!designer/app/builder/ui/canvas/elements/image/imgeditor.html","common/ui/dialog"],function(e,t,n,i,a,r,o,s,l,d,c,u,p,g,h,m,b){var f={toolbox:n,actionmenu:i,mutator:a,mediachooser:r,publish:o,navigationDialog:s,siteSettings:l,csseditor:d,formFlyOut:c,hamburgerFlyOut:u,gridGuidesFlyout:p,overlay:g},v=function(n){t.addControl(m,t.currentApp,"builder-controls"),t.addControl(b,t.currentApp,"img-editor"),e.map(Object.keys(f),function(e,t){f[e].load(t,$("#app-controls"))},function(e,t){n(e,t)})};return{load:v,getConfiguration:function(){return{modules:f}}}}),define("common/inAppPurchase/inAppUpgradeComplete",["jquery","lodash","websiteInfo","websiteSettings","common/logger/serverLogger","common/inAppPurchase/inAppPurchaseApi","common/inAppPurchase/inAppPurchaseData","/i18n/resources/client"],function(e,t,n,i,a,r,o,s){function l(){var e,o,s,l,c,u=n.Account.AccountType,p=!1;if(i.InAppUpgradeStatus){var h=JSON.parse(i.InAppUpgradeStatus);if(null===h)return;o=h.featureName,p=h.isUpgrading,l=h.previousPlan,e=g[l],c=h.checkoutType}p&&(s=t.findKey(g,function(e){return e===u}),r.setInAppUpgradeStatus({isUpgrading:!1,featureName:o,previousPlan:s,checkoutType:""}),u>e&&(a.post({detail:c,action:"inAppUpradeShowGrowls"},a.level.Information),d({featureName:o,plan:s,previousAccountType:e,accountType:u})))}function d(e){var n=e.featureName,i=e.plan,a={orderBy:"featureRank",pluck:JSON.stringify(["name","friendlyName","featureRank","requiredPlan"])};r.getFeatures(a).then(function(a){var r=[];r.push({title:h.upgradeComplete,msg:h.yourUpgradeTo.replace("{0}",i)});var s=a.length;if(s){a=p({features:a,previousAccountType:e.previousAccountType,accountType:e.accountType});var l=t.remove(a,function(e){return e.name===n});l.length&&a.splice(0,0,l[0]),s=a.length;for(var d=0;s>d;d++){var u=a[d].name,g=o.getFeatureFriendlyName(u);g&&r.push({title:h.featureUnlocked.replace("{0}",g)})}c(0,r.length,r)}})}function c(e,t,n){setTimeout(function(){var i=n[e];u({title:i.title,msg:i.msg}),++e<t&&c(e,t,n)},1e3)}function u(t){var n={icon:"success",title:t.title||"",fadetime:5e3};t.msg&&(n.content=t.msg),e("<div></div>").sfGrowl(n)}function p(e){for(var n=["bandwidth","diskSpace","ssl","audio_player","email","premium_themes"],i=t.reject(e.features,function(e){return n.indexOf(e.name)>-1}),a=i.length,r=e.previousAccountType,o=e.accountType,s=[],l=0;a>l;l++){var d=i[l],c=g[d.requiredPlan];c>r&&o>=c&&s.push(d)}return s}var g={Personal:10,Business:20,"Business Plus":30},h={upgradeComplete:s.resources.Upgrade_complete,yourUpgradeTo:s.resources.Your_upgrade_to_plan_is_complete,featureUnlocked:s.resources.feature_unlocked};return{showGrowls:l}}),define("text!designer/app/builder/ui/canvas/multiselect/multiselect.html",[],function(){return'<div id="wsb-canvas-template-selector" data-bind="attr: {style: style}">\r\n    <div></div>\r\n</div>\r\n'}),define("designer/app/builder/ui/canvas/multiselect/multiselect",["jquery","knockout","lodash","designer/app/builder/ui/uiHelper","designer/app/builder/managers/elementManager","text!designer/app/builder/ui/canvas/multiselect/multiselect.html"],function(e,t,n,i,a,r){function o(){var e=this;this.style=t.observable("display:none"),this.hide=function(){e.style("display:none")},this.paint=function(t){e.style("top: "+t.top+"px;left: "+t.left+"px;width: "+t.width+"px;height: "+t.height+"px;display: block;")},this.selectIntersectedElements=function(e,t,i){u(i),n.map(t,function(e){e.locked||i.bottom<e.top||i.top>e.bottom||i.right<e.left||i.left>e.right?e.selected&&(e.elViewModel.deselectElement(),e.selected=!1):e.selected||(e.elViewModel.selectElement(!0),e.selected=!0)})}}var s,l,d,c={},u=t.observable(),p=t.observable(!1),g=function(n){c.canvas=n,c.multiSelector=e(r).insertAfter(n),s=new o,t.applyBindings(s,c.multiSelector[0])},h=function(t,r){d=c.canvas.offset()||o;var o={top:0,left:0},u=c.canvas.scrollLeft(),g=(1*t.marginTop().replace("px",""),r.pageX+u),h=r.pageY-d.top;l={content:e("#wsb-group-content").offset(),footer:e("#wsb-canvas-template-footer").offset()};var m=n.map(a.getAllElementViewModelsOnCurrentPage(!0),function(e){var t={id:e.ID(),groupId:e.GroupID(),locked:e.Locked(),left:1*e.Left().replace("px",""),top:1*e.Top().replace("px",""),width:1*e.Width().replace("px",""),height:1*e.Height().replace("px",""),selected:!1,elViewModel:e},n=l[t.groupId]||o;return t.left=t.left+n.left,t.top=t.top+n.top-d.top,t.bottom=t.top+t.height,t.right=t.left+t.width,t});p(!0),i.captureDrag({initEvent:r,dragCallback:function(e){var n={left:e.x<0?g+e.x:g,top:e.y<0?h+e.y:h,width:Math.abs(e.x),height:Math.abs(e.y)};n.bottom=n.top+n.height,n.right=n.left+n.width,s.paint(n),s.selectIntersectedElements(t,m,n)},finishedCallback:function(){s.hide(),p(!1)}}),a.deselectAllElements()};return{load:g,initiate:h,initiated:p,selectionRect:u,groupOffsets:l,canvasOffset:d}}),define("designer/app/builder/ui/canvas/site/site",["jquery","lodash","knockout","designer/app/builder/data/data","designer/app/builder/managers/pageManager"],function(e,t,n,i,a){function r(){function t(e,t){return null==e?t:e}function i(){var t=r.BackgroundGradient();return t&&JSON.parse(t)||e.extend({},l)}var r=this;for(var s in o.website.backgroundsettings)r[s]=o.website.backgroundsettings[s];r.pageHeight=n.computed(function(){return a.getCurrentPage().Settings.Height()}),r.isIE9=!!(e.browser.msie&&parseInt(e.browser.version,10)<10),r.backgroundCssForIE9OrBelowWhenNotScrollable=n.observable(""),r.backgroundCssForIE9OrBelowWhenScrollable=n.observable("");var l={type:0,color2:"#ffffff"};r.style=n.computed(function(){var n=t(r.BackgroundColor(),"#f7f7f7"),a=i(),o=t(r.BackgroundImage(),""),s=t(r.BackgroundAlign(),"center top"),l=t(r.BackgroundRepeat(),"no-repeat"),d=[],c=o&&"False"!=o?"background-image: url("+o+")":"",u=o&&"False"!=o?"url("+o+"),":"";a.type?e.browser.webkit?(d.push("background: "+u+" -webkit-gradient(linear, "+(1===a.type?"left center":"center top")+", "+(1===a.type?"right center":"center bottom")+", from("+n+"), to("+a.color2+"))"),d.push("background-position: "+s),d.push("background-repeat: "+l)):(d.push("background: "+u+" linear-gradient(to "+(1===a.type?"right":"bottom")+", "+n+", "+a.color2+")"),d.push("background-position: "+s),d.push("background-repeat: "+l)):(d.push("background-color: "+n),""!==c&&(d.push(c),d.push("background-position: "+s),d.push("background-repeat: "+l)));var p=d.join(";");return p},this),r.scrollWithBackgroundStyle=n.computed(function(){var e=r.style(),n=t(r.BackgroundScrolling(),!1);return n?e+";height: 100%":""}),r.fixedBackgroundStyle=n.computed(function(){var e=r.style(),n=r.showCanvas(),i=t(r.BackgroundScrolling(),!1);return n?i?"":e:"display:none"}),r.BackgroundImage.subscribe(function(e){e===!1&&r.BackgroundDocumentId(0)})}var o,s=function(e,t){o=i.getDataModel(),t(null,r)};return{load:s}}),define("designer/app/builder/ui/canvas/groups/bindingHelper",["jquery","lodash","knockout","libs/async-util/async","designer/app/builder/data/data","designer/app/builder/managers/elementManager"],function(e,t,n,i,a,r){function o(t,n){e.isFunction(t.afterRender)?setTimeout(function(){t.afterRender(n)},0):e.isFunction(n)&&n(t)}function s(t,i){var o=!1;if(t.isCopy&&(o=!0,delete t.isCopy),!t.properties.Type&&t.ElementType){var s=n.unwrap(t.ElementType);s&&(t.properties.Type=n.observable(s.toLowerCase()))}var s=n.unwrap(t.properties.Type),l=m.initModel(t,i&&!o),d=b[s];d&&d.initModel&&d.initModel(t.properties,i&&!o,t),t=a.observablizeAndSubscribe(t,"websiteData||elements"),i&&(t.groupId.subscribe(u,t),t.properties.Shared.subscribe(p,t),t.isDeleted(!1)),a.saver.getElementsLookup()[t.id()]=t,t.groupId.subscribe(function(e){"footer"===e&&t.properties.Shared(!0)}),"footer"===t.groupId()&&t.properties.Shared(!0),s=t.properties.Type();var c=t.properties;c.pageIds=t.pageIds,c.ID=t.id,c.GroupID=t.groupId,c.isDeleted=t.isDeleted,d=b[s];var g;return"default"!=s&&d&&e.isFunction(d.createElementViewModel)?g=d.createElementViewModel(l,c,i&&!o):(c.Type("default"),g=new l(c)),r.elViewModelMap()[g.ID()]=g,g.ID.subscribe(function(e){var t=g.ID.originalValue;r.elViewModelMap()[e]=g,delete r.elViewModelMap()[t],t in r.selectedElementIds()&&(r.selectedElementIds()[e]=!0,delete r.selectedElementIds()[t]),r.elViewModelMap.valueHasMutated()}),g.InitComplete(!0),g}function l(){var t=g.website.elements;t().forEach(function(t){e.isFunction(t.groupId)&&(t.groupId.subscribe(u,t),t.properties.Shared.subscribe(p,t))}),t.subscribe(d)}function d(e){for(var i=e.length;--i>=0&&!t.isFunction(e[i].id);){var a=e[i],l=a.callback;l&&delete a.callback;{a.isClick}delete a.isClick;var d=y.test(n.unwrap(a.id))||"shufflecontainer"==a.properties.Type,c=n.unwrap(a.groupId),g=r.getGroupById(c),h=s(a,d);a.groupId.subscribe(u,a),a.properties.Shared.subscribe(p,a),h.Layer()>g.maxZIndex()&&g.maxZIndex(h.Layer()),a.properties.hidden&&h.hidden(!0),g.elements.push(h),o(h,l)}r.elViewModelMap.valueHasMutated(),v.enable()}function c(e){for(var i=e.length;--i>=0&&!t.isFunction(e[i].groupId);){var o=e[i],s=r.getGroupById(o.parentId);o.groupId=n.observable(o.groupId),o.pageIds=n.observableArray(o.pageIds),o.parentId=n.observable(o.parentId),o.type=n.observable(o.type),a.addSubscriptions(o,"websiteData||groups");var l=new f(o,!0);s.groups.push(l)}}function u(e){var n;if("footer"==e&&"footer"!=this.properties.Anchor()?(n="footer",this.properties.Anchor(n)):"content"==e&&"page"!=this.properties.Anchor()&&(n="page",this.properties.Anchor(n)),n){var i=r.getElementViewModel(this.id());i.ChildElements&&t.each(i.ChildElements(),function(e){e.Anchor(n)})}for(var a="footer"===e?"content":"footer",s=r.getGroupById(a),l=r.getGroupById(e),d=this.id(),c=0,u=s.elements(),p=u.length,g=void 0;p>c;){var h=u[c];if(h.ID()==d){g=h;break}c++}s.elements.remove(function(e){return e.ID()===d}),g&&(l.elements.push(g),o(g))}function p(e){var n=e?t.map(g.website.pages(),function(e){return e.Id()}):[g.address.currentPage()];this.pageIds(n)}var g,h,m,b,f,v=a.undoer,y=/^-\d+$/,_=function(t,n,i){g=a.getDataModel(),m=t.elDef,b=t.elementModules,f=t.GroupViewModel,g.website.groups.subscribe(c),h=n,e.isFunction(i)&&i()};return{load:_,callAfterRender:o,convertNewModelToViewModel:s,listenToChangesToElements:l}}),define("text!designer/app/builder/ui/canvas/groups/groups.html",[],function(){return'<script type="text/html" id="designer-groups">\r\n    \r\n    <span id="guide-left" class="guide-vr" style="height:100%; display:none;"></span>\r\n    <span id="guide-top" class="guide-hr" style="width:100%;display:none;"></span>\r\n\r\n    <!-- ko if: $root.BackgroundScrolling && groupId() === \'content\' -->\r\n    <div class="wsb-canvas-scrollable" data-bind="attr: { style: $root.scrollWithBackgroundStyle }">\r\n        <!-- ko if: $root.isIE9 -->\r\n        <div data-bind="attr: { style: $root.backgroundCssForIE9OrBelowWhenScrollable() }"></div>\r\n        <!-- /ko -->\r\n    </div>\r\n    <!-- /ko -->\r\n\r\n    <div class="wsb-canvas-page" data-bind="attr: { id: \'wsb-group-\' + groupId(), style: outerStyle(), \'class\': groupClassName, \'id\': groupDomId }">\r\n        <div data-bind="template: { name: \'wsb-canvas-template\', foreach: elements }, attr: { style: innerStyle(), \'class\': containerClassName, \'id\': containerId }"></div> \r\n    </div>\r\n\r\n</script>\r\n'}),define("designer/customStyle/styleHelper",["knockout","jquery","designer/app/builder/managers/css/css"],function(e,t,n){function i(e){return("0"+parseInt(e).toString(16)).slice(-2)}function a(e){return parseInt(e,16)}function r(e){if(!e||0===e.length)return null;var t,n=e[0];for(t=1;t<e.length;t++)n=Math.max(n,e[t]);return n}function o(e){if(!e||0===e.length)return null;var t,n=e[0];for(t=1;t<e.length;t++)n=Math.min(n,e[t]);return n}function s(e){if(void 0===e||null===e)return null;if("string"==typeof e){var t=e.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\s*\)\s*$/i);if(void 0!==t&&null!==t&&t.length>0){var n=1;e.length>4&&(n=parseFloat(t[4]),isNaN(n)&&(n=1)),e={R:t[1],G:t[2],B:t[3],A:n}}}if(e.hasOwnProperty("H")&&e.hasOwnProperty("S")&&e.hasOwnProperty("V")&&(e=d(e)),e&&e.hasOwnProperty("R")&&e.hasOwnProperty("G")&&e.hasOwnProperty("B")){if(e.hasOwnProperty("A")){if(0===e.A)return"transparent"}else e.A=1;return"#"+i(e.R)+i(e.G)+i(e.B)}return e}function l(e){var t,n,i,a,r,o=e.H/360,s=e.S/100,l=e.V/100,d=1,c=0,u=0,p=0;switch(e.hasOwnProperty("A")&&(d=e.A),t=Math.floor(6*o),n=6*o-t,i=l*(1-s),a=l*(1-n*s),r=l*(1-(1-n)*s),t%6){case 0:c=l,u=r,p=i;break;case 1:c=a,u=l,p=i;break;case 2:c=i,u=l,p=r;break;case 3:c=i,u=a,p=l;break;case 4:c=r,u=i,p=l;break;case 5:c=l,u=i,p=a}return{R:Math.floor(255*c),G:Math.floor(255*u),B:Math.floor(255*p),A:d}}function d(e){if(e.hasOwnProperty("H")&&e.hasOwnProperty("S")&&e.hasOwnProperty("V"))return l(e);if("string"!=typeof e)return e;if("transparent"===e)return{R:0,G:0,B:0,A:0};var t,n=1,i=0,r=0,o=0;return t=e.match(/^#([0-9a-f]{2})?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i),t&&5===t.length&&(void 0!==t[1]&&null!==t[1]&&(n=a(t[1])/255),i=a(t[2]),r=a(t[3]),o=a(t[4]),isNaN(i)&&(i=0),isNaN(r)&&(r=0),isNaN(o)&&(o=0)),{R:i,G:r,B:o,A:n}}function c(e){if("string"==typeof e)e=d(e);else if(!e.hasOwnProperty("R")||!e.hasOwnProperty("G")||!e.hasOwnProperty("B"))return e;var t,n,i,a,s,l,c,u,p=e.R/255,g=e.G/255,h=e.B/255,m=1;return e.hasOwnProperty("A")&&(m=e.A),i=r([p,g,h]),a=i-o([p,g,h]),s=function(e){return(i-e)/6/a+.5},0===a?t=n=0:(n=a/i,l=s(p),c=s(g),u=s(h),t=0,p===i?t=u-c:g===i?t=1/3+l-u:h===i&&(t=2/3+c-l),0>t?t+=1:t>1&&(t-=1)),{H:Math.round(360*t),S:Math.round(100*n),V:Math.round(100*i),A:m}}function u(e){if(void 0===e||null===e)return{value:null,unit:null};var t=e.match(/^(\d+(?:\.\d+)?)([^\d]+)$/),n="px";return t&&t.length>1?(e=parseFloat(t[1]),t.length>2&&void 0!==t[2]&&null!==t[2]&&(n=t[2])):e=parseFloat(e),isNaN(e)||(e=parseFloat(e.toFixed(2))),{value:e,unit:n}}function p(e,n){var i="."+e,a=null;void 0!==n&&null!==n&&(a="#"+n);var o=t(i,a),l={Color:s(o.css("color")),Padding:r([u(o.css("padding-top")).value,u(o.css("padding-left")).value,u(o.css("padding-right")).value,u(o.css("padding-bottom")).value]),BorderWidth:r([u(o.css("border-top-width")).value,u(o.css("border-left-width")).value,u(o.css("border-right-width")).value,u(o.css("border-bottom-width")).value]),BorderStyle:o.css("border-top-style"),BorderColor:s(o.css("border-top-color"))},d=g(e);return f(d,l),m(d,l),b(d,l),0===l.GradientType&&(l.BackgroundColor=s(o.css("background-color"))),l}function g(e){var i,a,r="."+e,o=n.baseCss();return i=o.indexOf(r),-1===i&&(o=n.customCss(),i=o.indexOf(r)),a=o.substring(i),i=a.indexOf("{"),-1!==i&&(a=a.substring(i+1),i=a.indexOf("}"),-1!==i&&(a=a.substring(0,i))),t.trim(a)}function h(e,n){var i,a,r,o=e+":",s=[],l=n;for(a=l.indexOf(o);-1!==a;)a+=o.length,i=l.substring(a),r=i.indexOf(";"),-1!==r?(i=i.substring(0,r),l=l.substring(a+r+1),a=l.indexOf(o)):a=-1,i=t.trim(i),s.push(i);return s}function m(e,t){t.RoundedCornerSize=0;var n,i=h("border-radius",e);i.length>0&&(n=u(i[i.length-1]),isNaN(n.value)||"px"!==n.unit.toLowerCase()||(t.RoundedCornerSize=n.value))}function b(e,t){t.Transparency=0;var n,i=h("opacity",e);i.length>0&&(n=parseFloat(i[i.length-1]),isNaN(n)||(t.Transparency=100-100*n))}function f(e,n){n.GradientType=0,n.BackgroundColor="transparent",n.BackgroundColor2="transparent";var i,a=h("background",e),r=t.grep(a,function(e){return null!==e.match(/^linear-gradient\(/i)});r&&r.length>0&&(r=r[0],r=r.substring(16),i=r.match(/([\w\-\s]*)?,?\s*(?:((?:rgb\s*\([\d\s,]*\))|(?:[#\w\d]+))\s*\d*\%?),\s*(?:((?:rgb\s*\([\d\s,]*\))|(?:[#\w\d]+))\s*\d*\%?)/i),i&&4===i.length&&(n.GradientType="to right"===i[1]?1:2,n.BackgroundColor=s(i[2]),n.BackgroundColor2=s(i[3])))}function v(e){y=e}var y=null;return{initModule:v,toHex:s,toRgb:d,toHsv:c,parseUnitValue:u,maxOf:r,minOf:o,getCssValues:p,findEffectCss:g,getCornerStyle:m,getTransparencyStyle:b,getGradientStyles:f}}),define("designer/app/builder/ui/canvas/elements/helper",["jquery","knockout","designer/customStyle/styleHelper"],function(e,t,n){function i(t){return e.isFunction(t)?t():t}function a(t){var n=e("#"+t.ID()),i=n.find("[data-widget-content]");return i.length||(i=n),i}function r(e,i,a,r){if(!t.isObservable(e.InitComplete)||t.unwrap(e.InitComplete)){var o=e.InitComplete&&t.unwrap(e.InitComplete);r=r||{};var s=t.isObservable(i),l=t.unwrap(r.asString||!1)===!0,d=t.unwrap(r.min),c=t.unwrap(r.max),u=t.unwrap(r.defaultValue),p="px";if((void 0===u||null===u)&&(u=d,void 0===u&&(u=null)),"string"==typeof a){var g=n.parseUnitValue(a);p=g.unit,a=g.value}return o&&void 0!==d&&null!==d&&d>a?(a=l?d.toString()+p:d,s&&i(a)):o&&void 0!==c&&null!==c&&a>c?(a=l?c.toString()+p:c,s&&i(a)):((void 0===a||null===a||isNaN(a))&&(a=u),null!==a&&(a=l?a+p:a),a!==t.unwrap(i)&&s&&i(a)),s?i:a}}return{setObservableDefault:function(e,n){return t.isObservable(e)?e:t.observable(void 0===e?i(n):e)},setObservableArrayDefault:function(e,n){return t.isObservable(e)?e:t.observableArray(e||i(n))},getContentElement:a,coerceNumericValue:r}}),define("designer/app/builder/ui/canvas/alignment/snap",["jquery"],function(e){function t(t,n,i,a,r,o,s){var l=e("#guide-left"),d=e("#guide-top");l.hide(),d.hide();var c,u,p,g,h,m,b=null,f=n.outerWidth(),v=n.outerHeight(),y=void 0,_=void 0,w=void 0,S=void 0,k=void 0,x=void 0,C=[],T=[];for(var E in t)if(b=t[E],b.ID()!=n.ID()){var P=Math.abs(b.pixelLeft()-n.pixelLeft()),D=Math.abs(b.pixelLeft()+b.pixelWidth()-n.pixelLeft());i>P&&D>P&&(void 0==y?(y={position:b.pixelLeft(),distance:P},c={item:b}):P<y.distance&&(y={position:b.pixelLeft(),distance:P},c={item:b})),i>D&&P>D&&(void 0==y?(y={position:b.pixelLeft()+b.pixelWidth(),distance:D},c={item:b}):P<y.distance&&(y={position:b.pixelLeft()+b.pixelWidth(),distance:D},c={item:b}));var I=Math.abs(n.pixelTop()-b.pixelTop()),A=Math.abs(b.pixelTop()+b.pixelHeight()-n.pixelTop());i>I&&A>I&&(void 0==w?(w={position:b.pixelTop(),distance:I},p={item:b}):I<w.distance&&(w={position:b.pixelTop(),distance:I},p={item:b})),i>A&&I>A&&(void 0==w?(w={position:b.pixelTop()+b.pixelHeight(),distance:A},p={item:b}):I<w.distance&&(w={position:b.pixelTop()+b.pixelHeight(),distance:A},p={item:b})),P=Math.abs(b.pixelLeft()-(n.pixelLeft()+f)),D=Math.abs(b.pixelLeft()+b.pixelWidth()-(n.pixelLeft()+f)),i>P&&D>P&&(void 0==_?(_={position:b.pixelLeft(),distance:P},u={item:b}):P<_.distance&&(_={position:b.pixelLeft(),distance:P},u={item:b})),i>D&&P>D&&(void 0==_?(_={position:b.pixelLeft()+b.pixelWidth(),distance:D},u={item:b}):P<_.distance&&(_={position:b.pixelLeft()+b.pixelWidth(),distance:D},u={item:b})),I=Math.abs(b.pixelTop()-(n.pixelTop()+v)),A=Math.abs(b.pixelTop()+b.pixelHeight()-(n.pixelTop()+v)),i>I&&A>I&&(void 0==S?(S={position:b.pixelTop(),distance:I},g={item:b}):I<S.distance&&(S={position:b.pixelTop(),distance:I},g={item:b})),i>A&&I>A&&(void 0==S?(S={position:b.pixelTop()+b.pixelHeight(),distance:A},g={item:b}):I<S.distance&&(S={position:b.pixelTop()+b.pixelHeight(),distance:A},g={item:b}));var M=Math.abs(b.pixelLeft()+b.pixelWidth()/2-(n.pixelLeft()+f/2));i>M&&void 0==x&&(x={position:b.pixelLeft()+b.pixelWidth()/2,distance:M},h={item:b});var O=Math.abs(b.pixelTop()+b.pixelHeight()/2-(n.pixelTop()+v/2));i>O&&void 0==k&&(k={position:b.pixelTop()+b.pixelHeight()/2,distance:O},m={item:b})}var L;void 0!=y&&Math.abs(c.item.pixelTop()-n.pixelTop()+c.item.pixelHeight())<s&&(L={},L.type="left",L.pageLeft=a,L.left=y.position,L.cssclass="guide-vr",L.match=c,L.distance=y.distance,T.push(L)),void 0!=w&&Math.abs(p.item.pixelLeft()-n.pixelLeft()+p.item.pixelWidth())<o&&(L={},L.type="top",L.pageTop=r,L.top=w.position,L.cssclass="guide-hr",L.match=p,L.distance=w.distance,C.push(L)),void 0!=_&&Math.abs(u.item.pixelTop()-n.pixelTop()+u.item.pixelHeight())<s&&(L={},L.type="right",L.pageLeft=a,L.left=_.position,L.cssclass="guide-vr",L.match=u,L.distance=_.distance,T.push(L)),void 0!=S&&Math.abs(g.item.pixelLeft()-n.pixelLeft()+g.item.pixelWidth())<o&&(L={},L.type="bottom",L.pageTop=r,L.top=S.position,L.cssclass="guide-hr",L.match=g,L.distance=S.distance,C.push(L)),void 0!=x&&Math.abs(h.item.pixelTop()-n.pixelTop()+h.item.pixelHeight())<s&&(L={},L.type="vertical",L.pageLeft=a,L.left=x.position,L.cssclass="guide-vr",L.match=h,L.distance=x.distance,T.push(L)),void 0!=k&&Math.abs(m.item.pixelLeft()-n.pixelLeft()+m.item.pixelWidth())<o&&(L={},L.type="horizontal",L.pageTop=r,L.top=k.position,L.cssclass="guide-hr",L.match=m,L.distance=k.distance,C.push(L));var N,B=null,F=null;C.length>0&&(B=C[0]);for(var R=0;R<C.length;R++)N=C[R],N.distance<B.distance&&(B=N);null!=B&&(d.css({top:B.top+B.pageTop}),d.attr("type",B.type),d.attr("pageTop",B.pageTop),d.show()),T.length>0&&(F=T[0]);for(var H=0;H<T.length;H++)N=T[H],N.distance<F.distance&&(F=N);null!=F&&(l.css({left:F.left+F.pageLeft}),l.attr("type",F.type),l.attr("pageLeft",F.pageLeft),l.show())}function n(t){var n=t,i=e("#guide-left"),a=e("#guide-top");if(a.is(":visible")){switch(a.attr("type")){case"top":t.Top(a.position().top-a.attr("pageTop")+"px");break;case"bottom":t.Top(a.position().top-a.attr("pageTop")-n.pixelHeight()+"px");break;case"horizontal":t.Top(a.position().top-a.attr("pageTop")-n.pixelHeight()/2+"px")}a.hide()}if(i.is(":visible")){switch(i.attr("type")){case"left":t.Left(i.position().left-i.attr("pageLeft")+"px");break;case"right":t.Left(i.position().left-i.attr("pageLeft")-n.pixelWidth()+"px");break;case"vertical":t.Left(i.position().left-i.attr("pageLeft")-n.pixelWidth()/2+"px")}i.hide()}}function i(t,n,i,a,r){var o=i+r.x;t.Left(e.trim(o-o%n+"px"));var s=a+r.y;t.Top(e.trim(s-s%n+"px"))}return{showSnapLines:function(e,n,i,a,r,o,s){t(e,n,i,a,r,o,s)},snapAlign:function(e){n(e)},alignToGrid:function(e,t,n,a,r){i(e,t,n,a,r)}}}),define("designer/app/builder/ui/canvas/elements/container",["jquery","lodash","knockout","designer/app/builder/ui/uiHelper","designer/app/builder/data/data","designer/app/builder/ui/canvas/alignment/snap","designer/app/builder/managers/elementManager"],function(e,t,n,i,a,r,o){function s(t,n){b.collect("element move");for(id in _()){var a=o.getElementViewModel(id);a.refPosition={left:a.pixelLeft(),top:a.pixelTop(),layer:a.Layer()}}return v(!0),i.captureDrag({initEvent:t,threshhold:10,dragCallback:function(e,t){for(id in _()){var n=o.getElementViewModel(id);n.state(n.stateMap.move);var i=parseInt(n.refPosition.left)+parseInt(e.x),a=parseInt(n.refPosition.top)+parseInt(e.y);if(n.pixelLeft(i),n.pixelTop(a),n.ignoreClick=!0,0!=u.snapToElement&&5>t){var s=f.offset().left,l=f.position().top;r.showSnapLines(y(),n,g,s,l,h,m)}}},finishedCallback:function(){for(id in _()){var t=o.getElementViewModel(id);if(t.Left(e.trim(t.Left())),t.Top(e.trim(t.Top())),0!=u.snapToElement&&t.ignoreClick){var i=f.offset().left,a=f.position().top;r.showSnapLines(y(),t,g,i,a,h,m),r.snapAlign(t)}else t.Left(e.trim(t.Left())),t.Top(e.trim(t.Top()));n&&n(t)}v(!1),b.enable("element move")},useDragCursor:!1,scrollContainer:".wsb-canvas"}),!0}function l(t,n,a){return e.isFunction(t.startResize)&&t.startResize(t,n),b.collect("element resize"),v(!0),i.captureDrag({initEvent:n,dragCallback:function(e){t.resizedByDrag(!0),t.resize(e),t.resizedByDrag(!1),t.ignoreClick=!0},finishedCallback:function(){t.sizeToFit(),e.isFunction(t.onResized)&&setTimeout(function(){t.onResized()},0),a&&a(t),b.enable("element resize"),v(!1)}}),!0}function d(t){var n,i,a=e(t.target?t.target:t.srcElement),r=a.attr("class"),o={L:!1,T:!1,B:!1,R:!1};return r&&(n=r.match(/wsb-canvas-resize-([nsew]|n[ew]|s[ew])(?:\s|$)/i),n&&n.length>1&&(i=n[1].toLowerCase(),o.L=i.indexOf("w")>=0,o.T=i.indexOf("n")>=0,o.B=i.indexOf("s")>=0,o.R=i.indexOf("e")>=0)),o}var c,u,p,g,h,m,b=a.undoer,f=e("body"),v=n.observable(!1),y=n.computed({read:function(){return o.getAllElementViewModelsOnCurrentPage(!0)},deferEvaluation:!0}),_=n.computed({read:function(){return t.pick(o.selectedElementIds(),function(e,t){return!o.getElementViewModel(t).Locked()})}});return{getPositionInElement:d,move:s,resize:l,isDragging:v,load:function(t){c=a.getDataModel(),u=c.settings,p=c.config,c.address.currentPage.subscribe(function(){window.setTimeout(function(){f=e("#wsb-group-content")},0)}),g=p.gridGuideTolerance,h=p.gridGuideHorizontalProximity,m=p.gridGuideVerticalProximity,e.isFunction(t)&&t()}}}),define("designer/customStyle/styleContainer",["jquery"],function(e){var t=function(){function t(t,a){if(null!==t)if(e.isArray(t)){var r;for(r=0;r<t.length;r++)o.set(t[r].key,t[r].value)}else{var s=i(t);s.length>0?s[0].value=a:n(t,a)}}function n(t,n){if(null!==t)if(e.isArray(t)){var i;for(i=0;i<t.length;i++)o.push(t[i].key,t[i].value)}else s.push({key:t,value:n})}function i(t){if(null===t)return[];var n=e.grep(s,function(e){return e.key?null!==e.key.match(new RegExp("^"+t+"$","i")):!1});return n}function a(e){var t,n=[];if("string"==typeof e)for(t=0;t<s.length;t++)null===s[t].key.match(new RegExp("^"+e+"$","i"))&&n.push(s[t]);else if("function"==typeof e)for(t=0;t<s.length;t++)e(s[t])||n.push(s[t]);else for(t=0;t<s.length;t++)JSON.stringify(s[t])!==JSON.stringify(e)&&n.push(s[t]);s=n}function r(){var e,t,n=[];for(e=0;e<s.length;e++)t=s[e],null!==t.key&&null!==t.value&&(n.push(t.key),n.push(":"),n.push(t.value+""),n.push(";"));return n.join("")}var o=this,s=[];o.set=t,o.push=n,o.find=i,o.remove=a,o.stringify=r};return t}),define("text!designer/app/builder/ui/canvas/elements/el.default.html",[],function(){return'<script type="text/html" id="wsb-canvas-template">\r\n    <div data-bind="visible: visible, event: { mouseleave: handleLeave }">\r\n\r\n        <div class="wsb-content-block wsb-undo-select" data-bind="\r\n    attr: { id: ID, \'data-aid\': \'el-\' + (Type() || \'default\') },\r\n    css: { movable: isMovable, moving: isMoving, resizing: isResizing, selected: isSelected },\r\n    style: { top: containerTop, left: containerLeft, zIndex: zIndex, padding: boundingBoxPadding() + \'px\', width: outlineWidth, height: outlineHeight },\r\n    visible: visible,\r\n    event: { mousedown: mouseDown, click: click, dblclick: dblClick, contextmenu: click, mouseover:handleHover, mouseout:handleLeave }, mousedownBubble: false, clickBubble: false, contextmenuBubble: false, dblclickBubble: false\r\n        ">\r\n            <!-- ko template: { name: \'wsb-canvas-template-\' + (Type() || \'default\') } -->\r\n            <!-- /ko -->\r\n\r\n            <div class="wsb-overlay-buttons" data-bind="visible: showOverlay, style: { top: ((outerHeight() / 2) - 16) + \'px\', left: ((outerWidth() / 2) - 16) + \'px\' }">\r\n                <!-- ko foreach: overlayButtons -->\r\n                <!-- ko if: isVisible -->\r\n                <a href="#" data-bind="\r\n    css: \'wsb-overlay-button wsb-edit-text\' + ($data.cssClass || \'\'),\r\n\r\n    tooltip: $data.tooltip,\r\n    event: { mousedown: click },\r\n    mousedownBubble: false"></a>\r\n                <!-- /ko -->\r\n                <!-- /ko -->\r\n            </div>\r\n        </div>\r\n\r\n        <!-- ko if: showBoundingBox() && visible() -->\r\n        <div class="wsb-selection-box wsb-selection-box-top" data-bind="\r\n    style: { left: boundingBoxLeft, top: boundingBoxTop, width: boundingBoxWidth, zIndex: boundingBoxZIndex },\r\n    css: { selected: isSelected, locked: Locked, hidden: isOverflowed }, event: { mousedown: mouseDown, click: click, contextmenu: click }, mousedownBubble: false, clickBubble: false, contextmenuBubble: false">\r\n        </div>\r\n        <div class="wsb-selection-box wsb-selection-box-bottom" data-bind="\r\n    style: { left: boundingBoxLeft, top: boundingBoxBottom, width: boundingBoxWidth, zIndex: boundingBoxZIndex },\r\n    css: { selected: isSelected, locked: Locked, hidden: isOverflowed }, event: { mousedown: mouseDown, click: click, contextmenu: click }, mousedownBubble: false, clickBubble: false, contextmenuBubble: false">\r\n        </div>\r\n        <div class="wsb-selection-box wsb-selection-box-left" data-bind="\r\n    style: { left: boundingBoxLeft, top: boundingBoxTop, height: boundingBoxHeight, zIndex: boundingBoxZIndex },\r\n    css: { selected: isSelected, locked: Locked,  hidden: isOverflowed }, event: { mousedown: mouseDown, click: click, contextmenu: click }, mousedownBubble: false, clickBubble: false, contextmenuBubble: false">\r\n        </div>\r\n        <div class="wsb-selection-box wsb-selection-box-right" data-bind="\r\n    style: { left: boundingBoxRight, top: boundingBoxTop, height: boundingBoxHeight, zIndex: boundingBoxZIndex },\r\n    css: { selected: isSelected, locked: Locked, hidden: isOverflowed }, event: { mousedown: mouseDown, click: click, contextmenu: click }, mousedownBubble: false, clickBubble: false, contextmenuBubble: false">\r\n        </div>\r\n\r\n\r\n        <!-- ko if: showResizeHandles -->\r\n        <!-- ko if: showVerticalResizeHandles -->\r\n        <div class="wsb-canvas-resize-n wsb-canvas-resize" data-bind="\r\n    style: { top: boundingBoxTop, left: boundingBoxCenter, zIndex: boundingBoxZIndex },\r\n    attr: { \'data-pid\': ID }, event: { mousedown: mouseDown }, mousedownBubble: false">\r\n        </div>\r\n        <div data-bind="visible: isOverflowed">\r\n            <div class="wsb-canvas-resize-s wsb-canvas-resize wsb-canvas-overflow wsb-canvas-overflow-resize" data-bind="\r\n    style: { top: boundingBoxBottom, left: boundingBoxCenter, zIndex: boundingBoxZIndex },\r\n    tooltip: i18Dict[\'Server__Text_is_hidden_Drag_down\'],\r\n    attr: { \'data-pid\': ID }, event: { mousedown: mouseDown }, mousedownBubble: false">\r\n            </div>  \r\n        </div>\r\n        <div data-bind="visible: !isOverflowed()">\r\n            <div class="wsb-canvas-resize-s wsb-canvas-resize" data-bind="\r\n    style: { top: boundingBoxBottom, left: boundingBoxCenter, zIndex: boundingBoxZIndex },\r\n    attr: { \'data-pid\': ID }, event: { mousedown: mouseDown }, mousedownBubble: false">\r\n            </div>\r\n        </div>\r\n        <!-- /ko -->\r\n        <!-- ko if: showHorizontalResizeHandles -->\r\n        <div class="wsb-canvas-resize-w wsb-canvas-resize" data-bind="\r\n    style: { top: boundingBoxMiddle, left: boundingBoxLeft, zIndex: boundingBoxZIndex },\r\n    attr: { \'data-pid\': ID }, event: { mousedown: mouseDown }, mousedownBubble: false">\r\n        </div>\r\n        <div class="wsb-canvas-resize-e wsb-canvas-resize" data-bind="\r\n    style: { top: boundingBoxMiddle, left: boundingBoxRight, zIndex: boundingBoxZIndex },\r\n    attr: { \'data-pid\': ID }, event: { mousedown: mouseDown }, mousedownBubble: false">\r\n        </div>\r\n        <!-- /ko -->\r\n        <!-- ko if: showVerticalResizeHandles() && showHorizontalResizeHandles() -->\r\n        <div class="wsb-canvas-resize-nw wsb-canvas-resize" data-bind="\r\n    style: { top: boundingBoxTop, left: boundingBoxLeft, zIndex: boundingBoxZIndex },\r\n    attr: { \'data-pid\': ID }, event: { mousedown: mouseDown }, mousedownBubble: false">\r\n        </div>\r\n        <div class="wsb-canvas-resize-sw wsb-canvas-resize" data-bind="\r\n    style: { top: boundingBoxBottom, left: boundingBoxLeft, zIndex: boundingBoxZIndex },\r\n    attr: { \'data-pid\': ID }, event: { mousedown: mouseDown }, mousedownBubble: false">\r\n        </div>\r\n        <div class="wsb-canvas-resize-ne wsb-canvas-resize" data-bind="\r\n    style: { top: boundingBoxTop, left: boundingBoxRight, zIndex: boundingBoxZIndex },\r\n    attr: { \'data-pid\': ID }, event: { mousedown: mouseDown }, mousedownBubble: false">\r\n        </div>\r\n        <div class="wsb-canvas-resize-se wsb-canvas-resize" data-bind="\r\n    style: { top: boundingBoxBottom, left: boundingBoxRight, zIndex: boundingBoxZIndex },\r\n    attr: { \'data-pid\': ID }, event: { mousedown: mouseDown }, mousedownBubble: false">\r\n        </div>\r\n        <!-- /ko -->\r\n        <!-- /ko -->\r\n        <!-- /ko -->\r\n    </div>\r\n\r\n</script>\r\n\r\n<script type="text/html" id="wsb-canvas-template-default">\r\n    <div data-widget-content="true">\r\n        <div data-bind="text: Type"></div>\r\n        <div data-bind="text: ID"></div>\r\n    </div>\r\n</script>\r\n\r\n'
}),define("designer/app/builder/ui/canvas/elements/el.default",["jquery","libs/jquery/jquery.throttle","lodash","knockout","libs/async-util/async","common/abTesting/abTesting","designer/app/builder/ui/canvas/elements/helper","common/stats/googleanalytics","common/logger/serverLogger","/i18n/resources/client","designer/app/builder/ui/uiHelper","designer/app/builder/data/data","designer/app/builder/ui/canvas/elements/container","common/i18n/localizableProperty","designer/customStyle/styleContainer","designer/customStyle/styleHelper","designer/app/builder/ui/controls/actionmenu/actionmenu","designer/app/builder/ui/controls/mutator/mutator","designer/app/builder/ui/controls/toolbox/toolbox","designer/app/builder/managers/css/css","designer/app/builder/managers/elementManager","designer/app/builder/managers/themeManager","designer/app/builder/ui/canvas/multiselect/multiselect","text!designer/app/builder/ui/canvas/elements/el.default.html"],function(e,t,n,i,a,r,o,s,l,d,c,u,p,g,h,m,b,f,v,y,_,w,S,k){function x(t){var n=this;this.initialize(t),this.$map={page:e("#wsb-group-content")},this.state=i.observable("view"),this.isOverflowed=i.observable(!1),this.hidden=i.observable(!1),this.stylePrefix=this.Type(),this.Title=this.getTitle(),this.SettingsTitle=this.Title,this.allowBoundingBox=i.observable(!0),this.visible=i.computed(this.getVisible,this),this.zIndex=i.computed(this.getZIndex,this),this.isMouseOver=i.observable(!1),this.isSelected=i.observable(!1),this.isResizing=i.computed(this.getIsResizing,this),this.isMoving=i.computed(this.getIsMoving,this),this.showBoundingBox=i.computed(this.getShowBoundingBox,this),this.showResizeHandles=i.computed(this.getShowResizeHandles,this),this.isMovable=i.computed(this.getIsMovable,this),this.showVerticalResizeHandles=i.observable(!0),this.showHorizontalResizeHandles=i.observable(!0),this.forcesLowerNeighborsToMove=i.observable(!1),this.boundingBoxPadding=i.observable(0),this.actionmenuPadding=i.observable(10),this.boundingBoxZIndex=9999,this.boundingBoxLeft=i.computed(function(){return this.getBoundingBoxLeft()-R+"px"},this).extend({throttle:O}),this.boundingBoxCenter=i.computed(function(){return this.getBoundingBoxCenter()+"px"},this).extend({throttle:O}),this.boundingBoxRight=i.computed(function(){return this.getBoundingBoxRight()+"px"},this).extend({throttle:O}),this.boundingBoxTop=i.computed(function(){return this.getBoundingBoxTop()-R+"px"},this).extend({throttle:O}),this.boundingBoxMiddle=i.computed(function(){return this.getBoundingBoxMiddle()+"px"},this).extend({throttle:O}),this.boundingBoxBottom=i.computed(function(){return this.getBoundingBoxBottom()+"px"},this).extend({throttle:O}),this.boundingBoxWidth=i.computed(function(){return this.getBoundingBoxWidth()+2*R+"px"},this).extend({throttle:O}),this.boundingBoxHeight=i.computed(function(){return this.getBoundingBoxHeight()+2*R+"px"},this).extend({throttle:O}),this.containerWidth=i.computed(function(){return this.outerWidth()+R+"px"},this).extend({throttle:O}),this.containerHeight=i.computed(function(){return this.outerHeight()+R+"px"},this).extend({throttle:O}),this.containerLeft=i.computed(function(){return this.getBoundingBoxLeft()+"px"},this).extend({throttle:O}),this.containerTop=i.computed(function(){return this.getBoundingBoxTop()+"px"},this).extend({throttle:O}),this.isLocked=i.computed(this.getIsLocked,this),this.isLocalizedThemeMode=i.computed(this.getIsLocalizedThemeMode,this),n.isActionMenuDisabled=i.computed(function(){return n.isLocalizedThemeMode()}),this.isSelected.subscribe(function(e){var t=_.selectedElementIds(),i=n.ID();_.keepPreviousSelection||_.deselectAllElements(),e?(t[i]=!0,n.state(n.stateMap.selected)):i in t&&(delete t[i],n.state(n.stateMap.view)),_.selectedElementIds(t)}),[t.CssClass].forEach(function(e){e.subscribe(function(){setTimeout(function(){n.ensureAccurateOuterSize()},100)})}),this.i18Dict=d.resources,n.overlayButtons=i.observableArray([{cssClass:"wsb-lock-indicator",text:d.resources.Client__Designer__Element_Unlock,tooltip:d.resources.Client__Designer__Element_UnlockPosition,isVisible:i.computed(function(){return n.state()===n.stateMap.locked}),click:function(){n.unlock()}}]),n.showOverlay=i.computed({deferEvaluation:!0,read:function(){if(n.pixelHeight()<N.y+B.y||n.isLocalizedThemeMode())return!1;for(var e=n.overlayButtons(),t=0,i=0;i<e.length;i++)e[i].isVisible()&&t++;var a=n.isSelected()&&t>0&&n.pixelWidth()>B.x+N.x*t;return a},owner:n}),C(this),y.pageStyles.subscribe(function(){n.initialized?n.ensureAccurateOuterSize():n.initialized=!0}),this.cssClasses=i.computed({deferEvaluation:!0,read:function(){return n.getViewStyles(n.stylePrefix,!0)},owner:this}),this.shadowCssClasses=i.computed({deferEvaluation:!0,read:function(){return n.getViewStyles("shadow",!1)},owner:this}),this.drag=function(e,t){this.mouseDown(null,e,t)},this.showUpgradeDialog=function(e,t){v.showUpgradeDialog(e,t)}}function C(t){function a(){return{borderStyle:t.BorderStyle(),borderWidth:t.BorderWidth(),borderColor:t.BorderColor(),padding:t.Padding(),transparency:t.Transparency(),gradientType:t.GradientType(),bgColor:t.BackgroundColor(),bgColor2:t.BackgroundColor2(),color:t.Color(),cornerRadius:t.RoundedCornerSize()}}t.InitComplete=i.observable(!1),n.forOwn(z,function(e,a){e=n.clone(e||{}),e.observablizeRange&&(e.hasOwnProperty("min")&&(e.min=t[a].Min=i.observable(e.min)),e.hasOwnProperty("max")&&(e.max=t[a].Max=i.observable(e.max))),t[a].subscribe(function(n){o.coerceNumericValue(t,t[a],n,e)})}),t.Styling={CalculateClassStyles:i.observable(!0),BackgroundColor:i.observable(!0),Border:i.observable(!0),Shadow:i.observable(!0),RoundedCorner:i.observable(!0),Transparency:i.observable(!0),Padding:i.observable(!0),Size:i.observable(!0),Color:i.observable(!1),ShowAdvancedTab:i.observable(!0),ShowBasicTabOnly:i.observable(!1),RemoveExistingCss:i.observable(!0),AdvancedApplyToMobile:i.observable(!0)},t.BackgroundColor=t.BackgroundColor||i.observable("transparent"),t.BackgroundColor2=t.BackgroundColor2||i.observable("transparent"),t.CssClasses=i.computed(function(){var n=e.trim(t.CssClass()||""),i=e.trim(t.ShadowCssClass()||"");return e.trim([n,i].join(" "))}),t.Defaults={},t.CssClass.subscribe(function(e){if(l!==!0&&t.Styling.CalculateClassStyles())if(r=!0,null!==e&&""!==e&&t.InitComplete()||"customStyle"!==e){var n=t.InitComplete()||H.test((t.ID()||"").toString()),i=function(){F.disable("css change"),n&&(t.Styling.RemoveExistingCss()||(e=e.replace(" customStyle","")),t.loadStyleItemsFromCssClass(e)),r=!1,F.enable("css change")};n?setTimeout(i,10):i()}else r=!1}),t.isIE9OrBelow=e.browser.msie&&parseInt(e.browser.version,10)<10,t.LastClassStyle=i.observable({}),t.loadStyleItemsFromCssClass=function(e){if(t.Styling.CalculateClassStyles()){var n=m.getCssValues(e,t.ID());t.LastClassStyle(n),null!==n.Color&&t.Color(n.Color),null!==n.Padding&&n.Padding>=t.Padding.Min()&&n.Padding<=t.Padding.Max()&&t.Padding(n.Padding),null!==n.BorderWidth&&n.BorderWidth>=t.BorderWidth.Min()&&n.BorderWidth<=t.BorderWidth.Max()&&t.BorderWidth(n.BorderWidth),null!==n.BorderStyle&&t.BorderStyle(n.BorderStyle),null!==n.BorderColor&&t.BorderColor(n.BorderColor),null!==n.GradientType&&t.GradientType(n.GradientType),null!==n.BackgroundColor&&t.BackgroundColor(n.BackgroundColor),null!==n.BackgroundColor2&&t.BackgroundColor2(n.BackgroundColor2),null!==n.Transparency&&t.Transparency(n.Transparency),t.RoundedCornerSize(0),null!==n.RoundedCornerSize&&n.RoundedCornerSize>=t.RoundedCornerSize.Min()&&n.RoundedCornerSize<=t.RoundedCornerSize.Max()&&t.RoundedCornerSize(n.RoundedCornerSize),t.ShadowCssClass("")}};var r=!1,s=!1,l=!1;t.DefaultStyleChanged=i.observable(!1),t.BackgroundColorChangedByShadow=!1,t.ShadowCssBackgroundModifier=i.observable(null);var d=!0;t.DefaultStyleChanged=i.computed({read:function(){if(!t.InitComplete())return s;var e=a(),n=t.Styling.RemoveExistingCss(),i=t.LastClassStyle.peek();return t.Styling.CalculateClassStyles()?r===!0||d?(d=!1,s):(s=!1,(void 0===i||null===i||e.color!==i.Color||e.padding!==i.Padding||e.borderWidth!==i.BorderWidth||e.borderStyle!==i.BorderStyle||e.borderColor!==i.BorderColor||e.gradientType!==i.GradientType||e.bgColor!==i.BackgroundColor||e.bgColor2!==i.BackgroundColor2||e.cornerRadius!==i.RoundedCornerSize||e.transparency!==i.Transparency)&&(s=!0,l=!0,n?t.CssClass("customStyle"):null===t.CssClass().match(/customStyle/i)&&t.CssClass(t.CssClass()+" customStyle"),l=!1),s):!1}}),t.ShadowCssBackgroundModifier=i.computed({read:function(){if(!t.InitComplete())return null;var e=t.ShadowCssClass(),n=t.BackgroundColor();return t.Styling.CalculateClassStyles()?(t.BackgroundColorChangedByShadow&&"#ffffff"!==n&&(t.BackgroundColorChangedByShadow=!1),null===e||""===e?t.BackgroundColorChangedByShadow&&"#ffffff"===n&&(t.BackgroundColor("transparent"),t.BackgroundColorChangedByShadow=!1):"transparent"===n&&(t.BackgroundColor("#ffffff"),t.BackgroundColorChangedByShadow=!0),null):null}});var c=function(){if(!t.Styling.CalculateClassStyles())return t.RoundedCornerSize.Max();var e=m.parseUnitValue(t.Width()).value,n=m.parseUnitValue(t.Height()).value,i=parseFloat(t.BorderWidth()),a=parseFloat(t.Padding()),r=null!==e&&null!==n?Math.floor(Math.max(Math.min(e,n),0)/2)+i+a:t.RoundedCornerSize.Max();return t.RoundedCornerSize.Max(r),t.RoundedCornerSize()>r&&t.RoundedCornerSize(r),r};return t.BorderWidth.subscribe(c),t.Padding.subscribe(c),t.Width.subscribe(c),t.Height.subscribe(c),t.CssClass.subscribe(c),t.LastClassStyle.subscribe(c),c(),t.EditorStyles={size:!1,transparency:!0},t.StyleCollection=i.computed({deferEvaluation:!0,read:function(){var n=a(),i=t.CssClass(),r=new h,o=t.LastClassStyle.peek();if(r.set([{key:"width",value:t.Width()},{key:"height",value:t.Height()},{key:"border",value:null},{key:"padding",value:null},{key:"color",value:null},{key:"filter",value:null},{key:"background",value:null},{key:"background-color",value:null},{key:"background-image",value:null},{key:"border-radius",value:null},{key:"opacity",value:null}]),!t.Styling.CalculateClassStyles())return r;if(null!==i&&""!==i&&null===i.match(/customStyle/i))return r;var s=[];if((t.Styling.RemoveExistingCss()||n.borderWidth!==o.BorderWidth||n.borderStyle!==o.BorderStyle||n.borderColor!==o.BorderColor)&&r.set("border",n.borderStyle+" "+n.borderWidth+"px "+n.borderColor),(t.Styling.RemoveExistingCss()||n.padding!==o.Padding)&&r.set("padding",n.padding+"px"),t.Styling.RemoveExistingCss()||0!==n.gradientType){var l=n.gradientType;if(r.set("background-color","transparent"),"transparent"!==n.bgColor||0!==l)if(t.isIE9OrBelow)if(l>0){var d=n.bgColor,c=n.bgColor2;"transparent"===d&&(d="#00000000"),"transparent"===c&&(c="#00000000"),s.push("progid:DXImageTransform.Microsoft.gradient(gradientType="+(1===l?1:0)+", startColorstr="+d+", endColorstr="+c+")")}else r.set("background-color",n.bgColor);else 0===l?r.set("background-color",n.bgColor):e.browser.webkit?r.set("background-image","-webkit-gradient(linear, left top, "+(1===l?"right top":"left bottom")+", color-stop(0, "+n.bgColor+"), color-stop(1, "+n.bgColor2+"))"):r.set("background-image","linear-gradient(to "+(1===l?"right":"bottom")+", "+n.bgColor+", "+n.bgColor2+")")}if(0!==n.gradientType||!t.Styling.RemoveExistingCss()&&n.bgColor===o.BackgroundColor||r.set("background-color",n.bgColor),"transparent"!==n.color&&r.set("color",n.color),r.set("border-radius",n.cornerRadius>0?n.cornerRadius+"px":null),t.Styling.RemoveExistingCss()||n.transparency!==o.Transparency){var u=n.transparency;if(100>=u){var p=100-u;r.set("opacity",p/100),t.isIE9OrBelow&&100>p&&s.push("alpha(opacity="+p+")")}}return s.length>0&&r.set("filter",s.join("")),r}}).extend({throttle:{type:"throttle",delay:L}}),t.Style=i.computed({deferEvaluation:!0,read:function(){var e=t.StyleCollection();return e.stringify()}}),t.ExcludedUndoerProperties=i.observableArray(["Styling","LastClassStyle","ShadowCssBackgroundModifier","DefaultStyleChanged","BackgroundColorChangedByShadow","InitComplete"]),t}function T(e){var t=e.Title;return t&&t.toLowerCase().replace(/\s/g,"_")}function E(e){function t(e,t){this.name=e,this.value=t}var n="enabled"===r.getOption("advancedProperties");return{transparencyEnabled:i.observable(n&&e.Styling.Transparency()),transparency:e.Transparency,colorEnabled:i.observable(n&&e.Styling.Color()),color:e.Color,borderEnabled:i.observable(n&&e.Styling.Border()),borderColor:e.BorderColor,borderStyle:e.BorderStyle,backgroundColorEnabled:i.observable(n&&e.Styling.BackgroundColor()),backgroundColor:e.BackgroundColor,backgroundColor2:e.BackgroundColor2,paddingEnabled:i.observable(n&&e.Styling.Padding()),padding:e.Padding,paddingMax:e.Padding.Max(),sizeEnabled:i.observable(n&&e.Styling.Size()),height:e.Height,width:e.Width,gradientType:e.GradientType,roundedCornerEnabled:i.observable(n&&e.Styling.RoundedCorner()),roundedCornerMin:e.RoundedCornerSize.Min,roundedCornerMax:e.RoundedCornerSize.Max,roundedCornerSize:e.RoundedCornerSize,shadowEnabled:i.observable(n&&e.Styling.Shadow()),ShadowCssClass:e.ShadowCssClass,shadowCssClasses:e.shadowCssClasses,showAdvancedTab:i.observable(n&&e.Styling.ShowAdvancedTab()),showBasicTabOnly:i.observable(!n||e.Styling.ShowBasicTabOnly()),borderWidth:i.computed({read:function(){return e.BorderWidth()},write:function(t){e.BorderWidth(parseInt(t)||0)}}),useBackgroundGradient:i.computed({read:function(){return!!e.GradientType()},write:function(t){var n=T(e)+"_settings",i="gradient_"+(t?"on":"off");s.trackEvent(n,i,"checkbox"),e.GradientType(t?1:0)}}),isHorizontalGradient:i.computed(function(){return 2===e.GradientType()}),isVerticalGradient:i.computed(function(){return 1===e.GradientType()}),cssClasses:e.cssClasses,borderStyles:[new t(d.resources.None,"none"),new t("Solid","solid"),new t("Dotted","dotted"),new t("Dashed","dashed")],transparencyEntered:function(t,n){var i=parseInt(n.target.value,10)||0;e.Transparency(Math.min(100,Math.max(0,i)))},heightEntered:function(t,n){var i=parseInt(n.target.value,10)||0;e.Height(i)},selectHorizontalGradient:function(){e.GradientType(2)},selectVerticalGradient:function(){e.GradientType(1)},onSave:!1}}function P(e,t){var n=parseInt(e);!isNaN(n)&&isFinite(n)&&n>=0&&1e5>n||(t=t||this.target)("300px")}function D(e,t){var n=parseInt(e);!isNaN(n)&&isFinite(n)&&n>-1e5&&1e5>n||(t=t||this.target)("300px")}var I,A,M,O=0,L=33,N={x:40,y:40},B={x:20,y:20},F=u.undoer,R=3,H=/^-\d+$/,V=[{name:"Layer",value:0},{name:"Left",value:"700px",validator:D},{name:"Top",value:"300px",validator:D},{name:"Width",value:"300px",validator:P},{name:"Height",value:"300px",validator:P},{name:"Anchor",value:"page"},{name:"Type",value:"default"},{name:"Transparency",value:0},{name:"BorderColor",value:"transparent"},{name:"BorderStyle",value:"none"},{name:"BorderWidth",value:0},{name:"BackgroundColor",value:"transparent"},{name:"BackgroundColor2",value:"transparent"},{name:"GradientType",value:0},{name:"CssClass",value:"default"},{name:"Locked",value:!1},{name:"MinWidth",value:16},{name:"MinHeight",value:20},{name:"Shared",value:!1},{name:"IncludeInMobileSite",value:!0},{name:"LocalizedProperties",value:null},{name:"RoundedCornerSize",value:0},{name:"Padding",value:0},{name:"Shadow",value:0},{name:"Color",value:"transparent"},{name:"ShadowCssClass",value:""}],z={Layer:{defaultValue:0},Left:{defaultValue:0,asString:!0},Top:{defaultValue:0,asString:!0},MinWidth:{min:0},Width:{asString:!0,min:16,observablizeRange:!0},MinHeight:{min:0},Height:{asString:!0,min:20,observablizeRange:!0},BorderWidth:{min:0,max:10,observablizeRange:!0},GradientType:{min:0},Padding:{min:0,max:50,observablizeRange:!0},Shadow:{defaultValue:0},Transparency:{min:0,max:100},RoundedCornerSize:{min:0,max:10,observablizeRange:!0}},j=1*new Date;return function(){i.utils.extend(x.prototype,{stateMap:{view:"view",selected:"selected",move:"move",resizeTop:"resizeTop",resizeBottom:"resizeBottom",resizeLeft:"resizeLeft",resizeRight:"resizeRight",resizeTopLeft:"resizeTopLeft",resizeBottomLeft:"resizeBottomLeft",resizeTopRight:"resizeTopRight",resizeBottomRight:"resizeBottomRight",edit:"edit",progress:"progress",locked:"locked"},getTitle:function(){var e=this.Type();return e&&e.length>0?e.charAt(0).toUpperCase()+e.slice(1):""},getVisible:function(){var e=this.pageIds().indexOf(this.currentPageId())>-1&&!this.isDeleted();return e&&!this.hidden()},getZIndex:function(){return this.Layer()+3},getDomElement:function(){return e("#"+this.ID()).find("[data-widget-content]")},getElementDiv:function(){return e("#"+this.ID())},initialize:function(e){for(key in e)this[key]=e[key];this.currentPageId=I.address.currentPage,this.outerSizeDiff={widthDiff:i.observable(0),heightDiff:i.observable(0)};var t=function(e){return i.computed({read:function(){return parseFloat(e())||0},write:function(t){parseInt(e())!=t&&e(Math.round(t)+"px")},owner:self}).extend({throttleDisabled:O})};this.isNewlyDragged=i.observable(!1),this.pixelLeft=t(this.Left),this.pixelTop=t(this.Top),this.pixelWidth=t(this.Width),this.pixelHeight=t(this.Height),this.outerWidth=i.computed(this.getOuterWidth,this).extend({throttle:O}),this.outerHeight=i.computed(this.getOuterHeight,this).extend({throttle:O}),this.outlineWidth=i.computed(function(){return this.outerWidth()+"px"},this).extend({throttle:O}),this.outlineHeight=i.computed(function(){return this.outerHeight()+"px"},this).extend({throttle:O}),this.refPosition={left:this.pixelLeft(),top:this.pixelTop(),layer:this.Layer()},this.refSize={width:this.pixelWidth(),height:this.pixelHeight()},this.minWidth=16,this.minHeight=20,this.resizedByDrag=i.observable(!1),V.forEach(function(e){if(void 0!==e.validator){var t=e.name,n=this[t];e.validator(n(),n),n.subscribe(e.validator)}},this)},getIsSelected:function(){return this.isSelected()},getIsResizing:function(){return 0===this.state().indexOf("resize")},getIsMoving:function(){return this.state()===this.stateMap.move},getIsLocked:function(){return this.state()==this.stateMap.locked},getShowBoundingBox:function(){return this.getIsSelected()&&!this.isMoving()&&!this.isResizing()&&!w.themeLocale()&&this.allowBoundingBox()},getShowResizeHandles:function(){var e=this.Locked(),t=this.getIsSelected(),n=this.getIsResizing(),i=this.getIsMoving();return!e&&!i&&(t||n)},getIsMovable:function(){return!this.Locked()},unlock:function(){return this.Locked(!1),this.state(this.stateMap.selected),!1},getBoundingBoxLeft:function(){return this.pixelLeft()-this.boundingBoxPadding()},getBoundingBoxCenter:function(){return this.getBoundingBoxLeft()+this.getBoundingBoxWidth()/2},getBoundingBoxRight:function(){return this.getBoundingBoxLeft()+this.getOuterWidth()+2*this.boundingBoxPadding()},getBoundingBoxTop:function(){return this.pixelTop()-this.boundingBoxPadding()},getBoundingBoxMiddle:function(){return this.getBoundingBoxTop()+this.getBoundingBoxHeight()/2},getBoundingBoxBottom:function(){return this.getBoundingBoxTop()+this.getOuterHeight()+2*this.boundingBoxPadding()},getBoundingBoxWidth:function(){return this.getOuterWidth()+2*this.boundingBoxPadding()},getBoundingBoxHeight:function(){return this.getOuterHeight()+2*this.boundingBoxPadding()},getOuterWidth:function(){return this.pixelWidth()+2*(this.Padding()||0)+2*(this.BorderWidth()||0)+this.outerSizeDiff.widthDiff()},getOuterHeight:function(){return this.pixelHeight()+2*(this.Padding()||0)+2*(this.BorderWidth()||0)+this.outerSizeDiff.heightDiff()},getLocalizedProperty:function(e){var t=this[e];return w.isThemeEditMode?g({propertyName:e,masterProperties:this,localizedProperties:this.LocalizedProperties,locale:w.themeLocale}):t},getLocalizedJsonProperty:function(e){var t=this[e];return w.isThemeEditMode?g({masterPropertyName:e,localizedPropertyName:e+"Json",masterProperties:this,localizedProperties:this.LocalizedProperties,locale:w.themeLocale}):t},getViewStyles:function(e,t){var n=[];t&&n.push({name:"Default",cssClass:e,title:d.resources.Client__Designer__Default,i18NStyleName:d.resources.Client__Designer__Default});var i=y.pageStyles()[e];if(i)for(var a in i)if(i.hasOwnProperty(a)){var r=i[a],o=a.replace(/\s/g,"_");n.push({name:a,cssClass:r.className,title:d.resources[o],i18NStyleName:d.resources[o]})}return n},getIsLocalizedThemeMode:function(){return w.isLocalizedTheme()},getCssClasses:function(){var t=e.trim(this.CssClass()||""),n=e.trim(this.ShadowCssClass()||"");return e.trim([t,n].join(" "))},openActionMenu:function(){if(!this.suppressActionMenuFromOpening&&!this.isActionMenuDisabled()&&!this.isMutatorOpen()){var t=this.getElementDiv();if(t&&0!=t.length){var n=this.getActionMenuItems();e.isFunction(n)&&(n=n()),b.show({menuItems:n,$element:t,elementViewModel:this})}}},hideActionMenu:function(){b.hide()},showMutator:function(e){e=e||{},e.elementViewModel=this,f.show(e)},showProperties:function(e){b.hide(),this.state(this.stateMap.edit),this.showMutator(e)},hideProperties:function(e,t){f.hide(e,t)},createBaseMutatorViewModel:function(){var t=new E(this),n=this.createMutatorViewModel?this.createMutatorViewModel():this.mutatorViewModel;return n&&e.extend(t,n),t},dblClick:function(){this.isLocalizedThemeMode()||this.showProperties()},click:function(e,t){if(this.mouseDowned){if(this.state()==this.stateMap.edit)return!1;if(this.Locked()&&this.state(this.stateMap.locked),!t.ctrlKey)return this.openActionMenu(),!1}},resize:function(e){var t,n,i,a,r,o=this,s=o.state();switch(s){case o.stateMap.resizeTop:t=Math.round(o.refPosition.top+e.y),n=Math.round(o.refSize.height-e.y),n>=o.minHeight&&(o.pixelTop(t),o.pixelHeight(n));break;case o.stateMap.resizeBottom:n=Math.round(o.refSize.height+e.y),r=o.pixelHeight(),n>=o.minHeight&&o.pixelHeight(n);break;case o.stateMap.resizeLeft:a=Math.round(o.refPosition.left+e.x),i=Math.round(o.refSize.width-e.x),i>=o.minWidth&&(o.pixelLeft(a),o.pixelWidth(i));break;case o.stateMap.resizeRight:i=Math.round(o.refSize.width+e.x),i>=o.minWidth&&o.pixelWidth(i);break;case o.stateMap.resizeTopLeft:t=Math.round(o.refPosition.top+e.y),n=Math.round(o.refSize.height-e.y),a=Math.round(o.refPosition.left+e.x),i=Math.round(o.refSize.width-e.x),n>=o.minHeight&&(o.pixelTop(t),o.pixelHeight(n)),i>=o.minWidth&&(o.pixelLeft(a),o.pixelWidth(i));break;case o.stateMap.resizeBottomLeft:a=Math.round(o.refPosition.left+e.x),i=Math.round(o.refSize.width-e.x),n=Math.round(o.refSize.height+e.y),r=o.pixelHeight(),n>=o.minHeight&&o.pixelHeight(n),i>=o.minWidth&&(o.pixelLeft(a),o.pixelWidth(i));break;case o.stateMap.resizeTopRight:t=Math.round(o.refPosition.top+e.y),n=Math.round(o.refSize.height-e.y),i=Math.round(o.refSize.width+e.x),n>=o.minHeight&&(o.pixelTop(t),o.pixelHeight(n)),i>=o.minWidth&&o.pixelWidth(i);break;case o.stateMap.resizeBottomRight:n=Math.round(o.refSize.height+e.y),i=Math.round(o.refSize.width+e.x),r=o.pixelHeight(),n>=o.minHeight&&o.pixelHeight(n),i>=o.minWidth&&o.pixelWidth(i)}this.handleResize&&this.handleResize(e)},zoom:function(e){var t=this;t.pixelHeight(t.pixelHeight()+2*e),t.pixelWidth(t.pixelWidth()+2*e),t.pixelLeft(t.pixelLeft()-e),t.pixelTop(t.pixelTop()-e)},selectElement:function(e){_.keepPreviousSelection=e,this.isSelected(!0)},deselectElement:function(){this.isSelected(!1)},mouseDown:function(t,n,i){if(l.logFirstClick("element",{element:this.Type()}),this.mouseDowned=!0,this.hideActionMenu(),this.getIsLocalizedThemeMode())return!0;var a=n.target.tagName.toLowerCase();if("select"===a||"button"===a||"input"===a||"textarea"===a)return!0;n.ctrlKey?this.isSelected()?this.deselectElement():this.selectElement(!0):this.selectElement(),c.closeFlyouts(),this.refPosition={left:this.pixelLeft(),top:this.pixelTop(),layer:this.Layer()},this.refSize={width:this.pixelWidth(),height:this.pixelHeight()};var r=p.getPositionInElement(n),o=r.L||r.T||r.B||r.R,s=e("#wsb-group-content").outerHeight();if(!o)return p.move(n,function(t){_.moveElementToAnotherGroupIfNeedBe(t,s),t.state(t.stateMap.view),t.afterMove?t.afterMove(i):e.isFunction(i)&&i()});this.selectElement();var d;return r.L&&r.T?d=this.stateMap.resizeTopLeft:r.R&&r.T?d=this.stateMap.resizeTopRight:r.L&&r.B?d=this.stateMap.resizeBottomLeft:r.R&&r.B?d=this.stateMap.resizeBottomRight:r.T?d=this.stateMap.resizeTop:r.L?d=this.stateMap.resizeLeft:r.R?d=this.stateMap.resizeRight:r.B&&(d=this.stateMap.resizeBottom),d?(this.state(d),e.isFunction(this.beforeResize)&&this.beforeResize(),p.resize(this,n,function(e){_.moveElementToAnotherGroupIfNeedBe(e,s),e.state(e.stateMap.view),e.afterResize&&e.afterResize()})):!0},handleHover:function(){this.firstHover||(this.ensureAccurateOuterSize(),this.firstHover=!0),this.isMouseOver(!0)},handleLeave:function(){this.isMouseOver(!1)},ensureAccurateOuterSize:function(e){F.disable();var t=e||this,n=t.getDomElement();if(n&&n.length){var i=n.outerWidth(),a=n.outerHeight(),r=t.pixelWidth()+2*(t.Padding()||0)+2*(t.BorderWidth()||0),o=t.pixelHeight()+2*(t.Padding()||0)+2*(t.BorderWidth()||0);t.outerSizeDiff.widthDiff(i-r),t.outerSizeDiff.heightDiff(a-o),F.enable()}},getCommands:function(){var t=this,a={settings:{text:d.resources.Settings,tip:d.resources.Settings,cssClass:"wsb-tool-Settings",click:function(){}},editProperties:{text:d.resources.Settings,tip:d.resources.Settings,cssClass:"wsb-tool-Settings",click:function(){return s.trackEvent("general_settings_modal","settings",T(t)),t.showProperties(n.isFunction(t.getMutatorOptions)?t.getMutatorOptions():void 0),!1}},clone:{text:d.resources.Client__Designer__Element_Copy,tip:d.resources.Client__Designer__Element_Copy,cssClass:"wsb-tool-Clone",click:function(){s.trackEvent("general_settings_modal","copy",T(t)),t.hideActionMenu(),F.collect("copy element"),M=_.copyElement(t,null,null,!1,null,function(){F.enable("copy element")}),M&&M.Locked()&&M.unlock()}},"delete":{text:d.resources.Delete,tip:d.resources.Delete,cssClass:"wsb-tool-Delete",enabled:i.computed(function(){return!t.Locked()}),click:function(){s.trackEvent("general_settings_modal","delete",T(t)),t.hideActionMenu(),t.Locked()||(F.collect("delete element"),_.deleteElement(t),F.enable("delete element"))}},layoutCommands:{text:"Action",cssClass:"layout-commands",tip:d.resources.More,click:function(){s.trackEvent("general_settings_modal","more_options",T(t)),b.showSubmenu(!b.isSubmenuVisible())},sub:[{name:"move_to_back",text:"",tip:d.resources.Client__Designer__Element_SendToBack,cssClass:"wsb-tool-SB",click:function(e,n){s.trackEvent("general_settings_modal","layer_backward",T(t)),F.collect("move_to_back element"),_.moveElementDown(t),F.enable("move_to_back element"),n.stopPropagation()}},{name:"move_to_front",text:"",tip:d.resources.Client__Designer__Element_BringForward,cssClass:"wsb-tool-BF",enabled:i.computed(function(){return!t.Locked()}),click:function(e,n){s.trackEvent("general_settings_modal","layer_forward",T(t)),F.collect("move_to_front element"),_.moveElementUp(t),F.enable("move_to_front element"),n.stopPropagation()}},{name:"lock",text:"",tip:i.computed({deferEvaluation:!0,read:function(){return t.Locked()?d.resources.Client__Designer__Element_UnlockPosition:d.resources.Client__Designer__Element_LockPosition}}),cssClass:i.computed({deferEvaluation:!0,read:function(){return t.Locked()?"wsb-tool-Unlock":"wsb-tool-Lock"}}),click:function(n,i){var a=(e(i.target),t.Locked());s.trackEvent("general_settings_modal",a?"unlock_position":"lock_position",T(t)),t.Locked(!a),t.state(a?t.stateMap.selected:t.stateMap.locked),i.stopPropagation()}},{name:"share",text:"",tip:i.computed({deferEvaluation:!0,read:function(){return t.Shared()?d.resources.Client__Designer__Element_ShowThisPage:d.resources.Client__Designer__Element_ShowAllPages}}),cssClass:i.computed({deferEvaluation:!0,read:function(){return t.Shared()?"wsb-tool-Unshare":"wsb-tool-Share"}}),click:function(n,i){F.collect();var a=(e(i.target),t.Shared());s.trackEvent("general_settings_modal",a?"show_only_thispage":"show_allpages",T(t)),t.Shared(!a),F.enable(),i.stopPropagation()}},{name:"IncludeInMobileSite",text:"",tip:i.computed({deferEvaluation:!0,read:function(){return t.IncludeInMobileSite()?d.resources.Client__Designer__Element_HideMobile:d.resources.Client__Designer__Element_ShowMobile}}),cssClass:i.computed({deferEvaluation:!0,read:function(){return t.IncludeInMobileSite()?"wsb-tool-ExcludeFromMobileSite":"wsb-tool-IncludeInMobileSite"}}),click:function(n,i){var a=(e(i.target),t.IncludeInMobileSite());s.trackEvent("general_settings_modal",a?"hide_onmobile":"show_onmobile",T(t)),t.IncludeInMobileSite(!a),i.stopPropagation()}}]}};return t.Styling.ShowAdvancedTab()&&"horizontal"==r.getOption("actionMenuStyle")&&a.layoutCommands.sub.push({name:"Advanced",text:"",tip:d.resources.Advanced,cssClass:"wsb-tool-BF",click:function(){s.trackEvent("general_settings_modal","advanced_settings",T(t));var e=n.isFunction(t.getMutatorOptions)?t.getMutatorOptions():{};e.openAdvancedTab=!0,t.showProperties(e)}}),a},getActionMenuItems:function(){var e=this.getCommands();return[e.editProperties,e.clone,e["delete"],e.layoutCommands]},isMutatorOpen:function(){return f.isOpen()},sizeToFit:function(e){F.disable();var t=e||this,n=1*new Date;if(!(this.state()!==this.stateMap.view&&50>n-j)){j=n;var i=t.getDomElement(),a=i.height(),r=i.width();a&&a>0&&t.pixelHeight(a),r&&r>0&&t.pixelWidth(r),t.ensureAccurateOuterSize(),F.enable()}},getFeatureFlags:function(e,t){var n,a=!0,r={IsEnabled:i.observable(!1),RequiresUpgrade:i.observable(!1)},o=v.getToolItem(this.Type());return o&&(n=i.utils.arrayFirst(o.Features,function(t){return t.Id===e}),n&&(void 0!==t&&null!==t&&(a=t),r.IsEnabled(i.utils.unwrapObservable(a)),r.RequiresUpgrade=n.RequiresUpgrade)),i.observable(r)},afterNewElementAdded:function(){}})}(),{load:function(e,t){I=u.getDataModel(),A=I.user,p.load(),e.append(k),t()},initModel:function(e){if(e.pageIds=e.pageIds||[I.address.currentPage()],e.elementtypedata=e.elementtypedata||null,e.isDeleted=e.isDeleted||!1,V.forEach(function(t){e.properties.hasOwnProperty(t.name)||(e.properties[t.name]=t.value)}),e.properties.GroupId=e.properties.GroupID,e.groupId=e.groupId||e.properties.GroupID,n.forOwn(z,function(t,n){e.properties[n]=o.coerceNumericValue(e,e.properties[n],i.unwrap(e.properties[n]),t)}),e.properties.hasOwnProperty("Layer")&&i.isObservable(e.properties.Layer)){var t=e.properties.Layer();0>t&&e.isDeleted(!0),0===t&&e.properties.Layer(1)}return x}}}),define("text!designer/app/builder/ui/canvas/elements/youtube/el.youtube.html",[],function(){return'<script type="text/html" id="wsb-canvas-template-youtube">\r\n    <div data-widget-content="true" data-bind="attr: { style: Style, \'class\': CssClasses }" style="background-color:black;">\r\n        <iframe \r\n            frameborder="0" \r\n            allowfullscreen="true" \r\n            style="width:100%; height:100%;" \r\n            data-bind="attr: { src: designerEmbedSrc }">\r\n        </iframe>\r\n        <div data-bind="style: { width: boundingBoxWidth, height: boundingBoxHeight }" class="wsb-youtube-element-overlay"></div>\r\n    </div>\r\n</script>\r\n'}),define("text!designer/app/builder/ui/canvas/elements/youtube/mutator.youtube.html",[],function(){return'<script type="text/html" id ="mutator-template-element-youtube">\r\n\r\n    <!-- ko if: $data.Type() === \'youtube\' -->\r\n    <!-- ko with: mutatorViewModel -->\r\n    <div id="youTubeContainer" class="wsb-canvas-mutator-inner">\r\n        <div class="wsb-canvas-mutator-ctrl-outer clearfix">\r\n            <div class="wsb-canvas-mutator-ctrl-label wsb-yt-url-label" data-bind= "text: i18Dict.UrlColon">\r\n            </div>\r\n            <div class="wsb-canvas-mutator-ctrl-input wsb-yt-url-property clearfix">\r\n                <input id="url" type="text" class="wsb-text-box wsb-facebook-input wsb-redo-select" data-bind="\r\n                value: Url,\r\n                valueUpdate: \'input\',\r\n                css: { \'input-validation-error\': !Url.isValid() }" />\r\n                <!-- ko if: Url.isValid -->\r\n                <label class="wsb-block-label" data-bind="html:i18Dict.Server__Enter_url_to_youtube_video">\r\n                </label>\r\n                <!-- /ko -->\r\n                <!-- ko ifnot: Url.isValid -->\r\n                <label \r\n                    id="urlErrorMessage" \r\n                    class="text-error wsb-block-label" \r\n                    data-bind="text: Url.validationMessage">\r\n                </label>\r\n                <!-- /ko -->\r\n            </div>\r\n        </div>\r\n    \r\n        <div class="wsb-canvas-mutator-ctrl-outer wsb-yt-style-property clearfix">\r\n            <div class="wsb-canvas-mutator-ctrl-label wsb-yt-style-label" data-bind= "text: i18Dict.StyleColon">\r\n            </div>\r\n            <div class="wsb-canvas-mutator-ctrl-input clearfix" style="width:350px;">\r\n                <select class="wsb-select-box" data-bind="value: Theme">\r\n                    <option value="dark" data-bind= "text: i18Dict.DarkTheme"></option>\r\n                    <option value="light" data-bind= "text: i18Dict.LightTheme"></option>\r\n                </select>\r\n                <label class="checkbox">\r\n                    <input type="checkbox" data-bind="checked: ShowTitleBar" /> \r\n                    <span data-bind="text: i18Dict.ShowTitleBar"></span>\r\n                </label>\r\n            </div>\r\n        </div>\r\n    \r\n        <div class="wsb-canvas-mutator-ctrl-outer wsb-last-mutator clearfix">\r\n            <div class="wsb-canvas-mutator-ctrl-label wsb-yt-url-label" data-bind= "text: i18Dict.OptionsColon">\r\n            </div>\r\n            <div class="wsb-canvas-mutator-ctrl-input clearfix">\r\n                <label class="checkbox">\r\n                    <input type="checkbox" data-bind="checked: AutoStart" />\r\n                    <span data-bind="text: i18Dict.StartAutomatically"></span>\r\n            </label>\r\n        </div>\r\n    </div>\r\n</div>\r\n<!-- /ko -->\r\n<!-- /ko -->\r\n    </script>\r\n'
}),define("designer/app/builder/ui/canvas/elements/youtube/el.youtube",["text!designer/app/builder/ui/canvas/elements/youtube/el.youtube.html","text!designer/app/builder/ui/canvas/elements/youtube/mutator.youtube.html","jquery","knockout","common/logger/logger","appconfig","common/util/stringHelper","common/persistence/persistence","/i18n/resources/client","common/stats/googleanalytics"],function(e,t,n,i,a,r,o,s,l,d){function c(){var e=this;e.Title=l.resources.YouTube,e.SettingsTitle=l.resources.YouTube_Settings,e.hasBeenRendered=!1,e.designerEmbedSrc=i.computed(function(){var t=e.YouTubeEmbedSrc()||f,n=o.getUrl(t);return"1"===n.query.autoplay&&(n.query.autoplay="0"),"1"===n.query.loop&&(n.query.loop="0",n.query.playlist=null),o.getUrlString(n,!0)}),e.elementViewModel=e,e.dblClick=function(){return e.isLocalizedThemeMode()||e.showProperties(),!1},e.mutatorViewModel=new u(e)}function u(e){function t(t){t=t||e.YouTubeEmbedSrc();var n=o.getUrl(t);n.query.wmode="opaque",n.query.theme=e.YouTubeTheme(),n.query.showinfo=e.YouTubeShowTitleBar()?1:0,n.query.autoplay=e.YouTubeAutoStart()?1:0,e.YouTubeEmbedSrc(o.getUrlString(n,!0))}function a(e,t){var n;n=1===t?"titlebar_":"autostart_",d.trackEvent("youtube_settings",n+(e?"on":"off"),"checkbox")}var r=i.observable(!0),c=i.observable(!0),u=i.observable(!0),h=i.computed({read:function(){return e.YouTubeUrl()},write:function(t){var i=(t.match(/^.*([\?&]v=|youtu.be\/)([a-z0-9\-_]{11})/i)||[]).pop(),a=i?"https://www.youtube.com/watch?v="+i:n.trim(t);e.YouTubeUrl(a)}}),f=h.extend({validation:{custom:[{message:l.resources.Client__Designer__Enter_a_valid_YouTube_URL,test:function(e){return!p(n.trim(e))}},{message:l.resources.Client__Designer__Enter_a_valid_YouTube_URL,test:function(){var e=h();return b.test(e)}},{message:l.resources.Client__Designer__Validating_URL,test:function(){return r()}},{message:l.resources.Client__Designer__Embedding_of_this_video_disabled,test:function(){return c()}},{message:l.resources.Client__Designer__Embedding_of_this_video_is_not,test:function(){return u()}}]}});h.subscribe(function(e){if(r(!1),c(!0),u(!0),b.test(e)){var i=e,a=o.getUrl(i);"player_embedded"===a.query.feature&&(a.query.feature=null),i=o.getUrlString(a),s.Get(m+encodeURIComponent(i)+"&format=json",function(e){if(e){var i=JSON.parse(e);if("undefined"!=typeof i.Message)switch(i.Message.toLowerCase()){case"unauthorized":c(!1);break;default:u(!1)}else t(g(n(i.html).attr("src")))}else u(!1);r(!0)},function(){u(!1),r(!0)})}});var v=[e.YouTubeTheme,e.YouTubeShowTitleBar,e.YouTubeAutoStart];return v.forEach(function(e,n){e.subscribe(function(e){t(),n&&a(e,n)})}),{Url:f,Theme:e.YouTubeTheme,ShowTitleBar:e.YouTubeShowTitleBar,AutoStart:e.YouTubeAutoStart,isValid:f.isValid,i18Dict:{UrlColon:l.resources.Server__Url_colon,StyleColon:l.resources.Server__Style_colon,DarkTheme:l.resources.Server__Dark_theme,LightTheme:l.resources.Server__Light_theme,ShowTitleBar:l.resources.Server__Show_title_bar,OptionsColon:l.resources.Server__Options_colon,StartAutomatically:l.resources.Server__Start_automatically,Server__Enter_url_to_youtube_video:l.resources.Server__Enter_url_to_youtube_video}}}function p(e){return!e||!e.replace(/\s/g,"").length}function g(e){var t=o.getUrl(e);return o.getUrlString(t,!0)}var h="youtube",m="/api/oembed?oembedurl=http://www.youtube.com/oembed?url=",b=/^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/,f="//www.youtube.com/embed/NotAValidYouTubeUrl?wmode=opaque;";return{name:h,initModel:function(e,t){e.YouTubeUrl=e.YouTubeUrl||r.defaultYouTubeVideoUrl,e.YouTubeTheme=e.YouTubeTheme||"dark",e.YouTubeShowTitleBar=void 0!==e.YouTubeShowTitleBar?e.YouTubeShowTitleBar:!0,e.YouTubeAutoStart=e.YouTubeAutoStart||!1,e.YouTubeEmbedSrc=e.YouTubeEmbedSrc||r.defaultYouTubeEmbedSrc,t&&(e.Width="250px",e.Height="200px")},createElementViewModel:function(e,t){return c.prototype=new e(t),c.prototype.constructor=c,new c},load:function(n,i){n.append(e).append(t),i(null,"youtube")}}}),define("text!designer/app/builder/ui/canvas/elements/share/el.share.html",[],function(){return'<script type="text/html" id="wsb-canvas-template-share">\r\n    <div data-widget-content="true" data-bind="attr: { style: Style, \'class\': CssClasses }">\r\n		<div data-bind="attr: { id: $data.mode + \'-\' + $data.ID(), \'class\': \'wsb-social-share\' }"></div>\r\n    </div></script>'}),define("text!designer/app/builder/ui/canvas/elements/share/mutator.share.html",[],function(){return'<script type="text/html" id ="mutator-template-element-share">\r\n\r\n    <!-- ko if: $data.Type() === \'share\' && $data.mutatorViewModel -->\r\n    <!-- ko with: mutatorViewModel -->\r\n    <div class="wsb-canvas-mutator-inner">    \r\n        <div data-bind="mutatorElement: { name: \'carousel\', data: ShareTheme, context: { \r\n        title: i18Dict.Server__Style_colon,\r\n        optionTemplate: \'mutator-template-carousel-style\',\r\n        optionValueProperty: \'name\',\r\n        options: cssClasses\r\n    } }"></div>\r\n        <div id="wsb-share-show" \r\n             data-bind="mutatorElement: { name: \'checkboxlist\', data: getOptions, context: { title: i18Dict.Server__Show_colon } }"></div>\r\n</div>\r\n<!-- /ko -->\r\n<!-- /ko -->\r\n    </script>'}),define("designer/util/util.instances",[],function(){function e(e,t){this.name=e,this.Module=t,this.instances={},this.instanceNum=0}return e.prototype={create:function(e,t){return e.length&&!this.get(e)?this.instances[(t=t||{}).instanceId=++this.instanceNum]=new this.Module(e.data(this.name+"-instance",this.instanceNum),t):!1},get:function(e){return e.length?this.instances[e.data(this.name+"-instance")]:!1},destroy:function(e){var t=this.get(e);return t?(delete this.instances[t.model&&t.model.get?t.model.get("instanceId"):t.options.instanceId],!0):!1}},e}),define("designer/util/util.model",[],function(){function e(e){this.model=e,(this.isKO=Boolean(e.ko))&&(this.ko=e.ko)}return e.prototype={get:function(e,t){return e?this.isKO&&!t&&this.ko.isObservable(this.model[e])?this.ko.toJS(this.model[e]()):this.model[e]:this.model},set:function(e,t){return e?this.isKO&&this.ko.isObservable(this.model[e])?this.model[e](t):this.model[e]=t:!1}},e}),define("designer/social/share/social.share",["designer/util/util.instances","designer/util/util.model","jquery","wsbcore/helper"],function(e,t,n,i){function a(e,n){this.$element=e,this.model=new t(n),this.mode=this.model.get("mode"),this.subscriptions=[],this.init()}var r="wsb-social-share";a.prototype={init:function(){var e=this;if("designer"===this.mode&&this.model.isKO){var t=this.model.get();if(t.mutatorViewModel){var n=function(){e.refresh()};for(var i in t.mutatorViewModel)t.ko.isObservable(t.mutatorViewModel[i])&&this.subscriptions.push(t.mutatorViewModel[i].subscribe(n))}}this.refresh(!0)},ready:function(e){var t=this,a=function(){"designer"===t.mode&&t.model.isKO&&require(["/i18n/resources/client","wsbcore/growl"],function(e){n("<div></div>").sfGrowl({title:e.resources.Client__Designer__Yikes_hit_a_snag,content:e.resources.Server__There_has_been_an_unexpected_error,icon:"error"})}),t.destroy()};i.require(["js!//s7.addthis.com/js/300/addthis_widget.js#async=1"],function(){function n(){1>--r&&(clearInterval(i),a())}var i,r=20;i=setInterval(function(){window&&window.addthis&&window.addthis.init?(window.addthis.init(),window.addthis.toolbox(t.$element[0]),"designer"===t.mode&&t.updateOverlay(e)):n()},100)},a)},refresh:function(e){var t=this;this.$element.attr("class",r).children().remove();var i="",a=r+"-button",o=this.model.get("ShareTheme");if("mobile"===this.mode)switch(o){case"Small Buttons":case"Small Buttons - Vertical":case"Buttons - Vertical":o="Buttons";break;case"Counter":case"Counter - Vertical":case"Horizontal Counter":case"Bubble Counter - Vertical":case"Vertical Counter":o="Bubble Counter"}switch(Boolean(o.match(/- Vertical$/i))&&(a+="-vert"),o){case"Buttons":case"Buttons - Vertical":this.$element.addClass("addthis_toolbox addthis_default_style addthis_32x32_style"),this.model.get("ShareFacebook")&&(i+='<a class="addthis_button_facebook '+a+'"></a>'),this.model.get("ShareTwitter")&&(i+='<a class="addthis_button_twitter '+a+'"></a>'),this.model.get("ShareGoogle")&&(i+='<a class="addthis_button_google_plusone_share '+a+'"></a>'),this.model.get("SharePinterest")&&(i+='<a class="addthis_button_pinterest_share '+a+'"></a>'),this.model.get("ShareEmail")&&(i+='<a class="addthis_button_email '+a+'"></a>'),this.model.get("ShareMore")&&(i+='<a class="addthis_button_expanded '+a+'"></a>');break;case"Small Buttons":case"Small Buttons - Vertical":this.$element.addClass("addthis_toolbox addthis_default_style"),this.model.get("ShareFacebook")&&(i+='<a class="addthis_button_facebook '+a+'"></a>'),this.model.get("ShareTwitter")&&(i+='<a class="addthis_button_twitter '+a+'"></a>'),this.model.get("ShareGoogle")&&(i+='<a class="addthis_button_google_plusone_share '+a+'"></a>'),this.model.get("SharePinterest")&&(i+='<a class="addthis_button_pinterest_share '+a+'"></a>'),this.model.get("ShareEmail")&&(i+='<a class="addthis_button_email '+a+'"></a>'),this.model.get("ShareMore")&&(i+='<a class="addthis_button_expanded '+a+'"></a>');break;case"Toolbar":i+='<a class="addthis_button" href="//www.addthis.com/bookmark.php?v=300&amp;pubid=xa-5107daf277cd4d0c"><img src="//s7.addthis.com/static/btn/v2/lg-share-en.gif" width="125" height="16" alt="Bookmark and Share" style="border:0"/></a>';break;default:case"Counter":case"Counter - Vertical":case"Horizontal Counter":this.$element.addClass("addthis_toolbox addthis_default_style"),this.model.get("ShareFacebook")&&(i+='<a class="addthis_button_facebook_like '+a+'" fb:like:layout="button_count"></a>'),this.model.get("ShareTwitter")&&(i+='<a class="addthis_button_tweet '+a+'"></a>'),this.model.get("ShareGoogle")&&(i+='<a class="addthis_button_google_plusone '+a+'" g:plusone:size="medium"></a>');break;case"Bubble Counter":case"Bubble Counter - Vertical":case"Vertical Counter":this.$element.addClass("addthis_toolbox addthis_default_style addthis_counter_style"),this.model.get("ShareFacebook")&&(i+='<a class="addthis_button_facebook_like '+a+'" fb:like:layout="box_count"></a>'),this.model.get("ShareTwitter")&&(i+='<a class="addthis_button_tweet '+a+'" tw:count="vertical"></a>'),this.model.get("ShareGoogle")&&(i+='<a class="addthis_button_google_plusone '+a+'" g:plusone:size="tall"></a>')}this.$element.html(i),"object"!=typeof window.addthis?n(document).ready(function(){t.ready(e)}):t.ready(e)},updateOverlay:function(e){if(!e&&this.model.isKO){var t=this;clearInterval(this.overlayTimer),this.overlayTimerCount=0,this.overlayTimer=setInterval(function(){if(t.overlayTimerCount>=20)clearInterval(t.overlayTimer),t.overlayTimerCount=0;else{t.overlayTimerCount++,t.$element.removeClass("resized");var e=t.model.get("getLast",!0);if(!(e instanceof Function))return;if(!t.model.model||!t.model.model.undoer)return;var n=t.model.model.undoer,i=!n.getCurrentState().isCollect;if(i){var a=t.model.get("getLast",!0)("Width"),r=t.model.get("getLast",!0)("Height");if(parseFloat((a&&a.NewValue||t.model.get("Width")).replace("px",""))<t.$element.outerWidth(!0)){n.disable();var o=t.$element.outerWidth(!0)+"px";a&&(a.NewValue=o),t.model.set("Width",o),n.enable()}if(parseFloat((r&&r.NewValue||t.model.get("Height")).replace("px",""))<t.$element.outerHeight(!0)){n.disable();var s=t.$element.outerHeight(!0)+"px";r&&(r.NewValue=s),t.model.set("Height",s),n.enable()}}else parseFloat(t.model.get("Width").replace("px",""))<t.$element.outerWidth(!0)&&t.model.set("Width",t.$element.outerWidth(!0)+"px"),parseFloat(t.model.get("Height").replace("px",""))<t.$element.outerHeight(!0)&&t.model.set("Height",t.$element.outerHeight(!0)+"px");t.$element.addClass("resized")}},100)}},destroy:function(){for(var e in this.subscriptions)this.subscriptions[e].dispose();o.destroy(this.$element),this.$element.remove()}};var o=new e(r,a);return{render:function(e,t){var n=o.get(e);return n?n.refresh():n=o.create(e,t),n},destroy:function(e){var t=o.get(e);return t?(o.destroy(e),!0):!1}}}),define("designer/app/builder/ui/canvas/elements/share/el.share",["text!designer/app/builder/ui/canvas/elements/share/el.share.html","text!designer/app/builder/ui/canvas/elements/share/mutator.share.html","knockout","/i18n/resources/client","jquery","designer/social/share/social.share","designer/app/builder/data/undoer","common/stats/googleanalytics"],function(e,t,n,i,a,r,o,s){function l(){var e=this;this.Title=i.resources.Share,this.SettingsTitle=i.resources.Share_Settings;var t,s;e.ko=n,e.wsb=u,e.mode="designer",e.undoer=o,e.dblClick=function(){e.isLocalizedThemeMode()||e.showProperties()},e.getActionMenuItems=n.computed(function(){var t=e.getCommands();return[t.editProperties,t["delete"],t.layoutCommands]}),e.afterRender=function(n){t=a("#designer-"+e.ID()+".wsb-social-share"),s=r.render(t,e),e.sizeToFit(n)},e.onRemove=function(){s&&s.destroy()},e.onResized=function(){e.sizeToFit()},e.sizeToFit=function(n){e.minWidth=g[e.ShareTheme()].minWidth,t=a("#designer-"+e.ID());var i=Math.max(a(t.children("a")[0]).width(),e.minWidth),r=t.height();i>e.pixelWidth()&&e.pixelWidth(i),r>e.pixelHeight()&&e.pixelHeight(r),a.isFunction(n)&&n(e)},e.ShareTheme.subscribe(function(){setTimeout(function(){e.sizeToFit()},500)}),e.ShareFacebook.subscribe(function(e){d("facebook",e)}),e.ShareTwitter.subscribe(function(e){d("twitter",e)}),e.ShareGoogle.subscribe(function(e){d("google",e)}),e.SharePinterest.subscribe(function(e){d("pinterest",e)}),e.ShareEmail.subscribe(function(e){d("email",e)}),e.ShareMore.subscribe(function(e){d("sharemore",e)}),e.mutatorViewModel=new c(e),e.Width.subscribe(e.sizeToFit),e.Height.subscribe(e.sizeToFit)}function d(e,t){s.trackEvent("share_settings",e+"_"+(t?"on":"off"),"checkbox")}function c(e){this.ShareFacebook=e.ShareFacebook,this.ShareTwitter=e.ShareTwitter,this.ShareGoogle=e.ShareGoogle,this.SharePinterest=e.SharePinterest,this.ShareEmail=e.ShareEmail,this.ShareMore=e.ShareMore,this.ShareTheme=e.ShareTheme,this.cssClasses=[{name:"Counter",cssClass:"wsb-social-share-counter",title:i.resources.Client__Designer__Counter},{name:"Bubble Counter",cssClass:"wsb-social-share-bubble",title:i.resources.Client__Designer__Bubble_Counter},{name:"Buttons",cssClass:"wsb-social-share-buttons",title:i.resources.Client__Designer__Buttons},{name:"Small Buttons",cssClass:"wsb-social-share-buttons-small",title:i.resources.Client__Designer__Small_Buttons},{name:"Counter - Vertical",cssClass:"wsb-social-share-counter-vert",title:i.resources.Client__Designer__Counter_Vertical},{name:"Bubble Counter - Vertical",cssClass:"wsb-social-share-bubble-vert",title:i.resources.Client__Designer__Bubble_Counter_Vertical},{name:"Buttons - Vertical",cssClass:"wsb-social-share-buttons-vert",title:i.resources.Client__Designer__Buttons_Vertical},{name:"Small Buttons - Vertical",cssClass:"wsb-social-share-buttons-small-vert",title:i.resources.Client__Designer__Small_Buttons_Vertical}],this.getOptions=n.computed(function(){switch(this.ShareTheme()){case"Counter":case"Counter - Vertical":case"Bubble Counter":case"Bubble Counter - Vertical":case"Horizontal Counter":case"Vertical Counter":return[{value:this.ShareFacebook,name:i.resources.Facebook},{value:this.ShareTwitter,name:i.resources.Twitter},{value:this.ShareGoogle,name:i.resources.Google_Plus},{value:this.SharePinterest,name:i.resources.Pinterest,enabled:!1},{value:this.ShareEmail,name:i.resources.Email,enabled:!1},{value:this.ShareMore,name:i.resources.Client__Designer__Share_more,enabled:!1}];case"Toolbar":return[{value:this.ShareFacebook,name:i.resources.Facebook,enabled:!1},{value:this.ShareTwitter,name:i.resources.Twitter,enabled:!1},{value:this.ShareGoogle,name:i.resources.Google_Plus,enabled:!1},{value:this.SharePinterest,name:i.resources.Pinterest,enabled:!1},{value:this.ShareEmail,name:i.resources.Email,enabled:!1},{value:this.ShareMore,name:i.resources.Client__Designer__Share_more,enabled:!1}];case"Buttons":case"Buttons - Vertical":case"Small Buttons":case"Small Buttons - Vertical":default:return[{value:this.ShareFacebook,name:i.resources.Facebook},{value:this.ShareTwitter,name:i.resources.Twitter},{value:this.ShareGoogle,name:i.resources.Google_Plus},{value:this.SharePinterest,name:i.resources.Pinterest},{value:this.ShareEmail,name:i.resources.Email},{value:this.ShareMore,name:i.resources.Client__Designer__Share_more}]}},this),this.i18Dict={Server__Style_colon:i.resources.Server__Style_colon,Server__Show_colon:i.resources.Server__Show_colon}}var u=!1,p="share",g={Counter:{minWidth:80},"Bubble Counter":{minWidth:60},Buttons:{minWidth:36},"Buttons - Vertical":{minWidth:36},"Small Buttons":{minWidth:18},"Small Buttons - Vertical":{minWidth:18},"Counter - Vertical":{minWidth:78},"Bubble Counter - Vertical":{minWidth:60}};return{name:p,initModel:function(e,t){e.ShareFacebook=void 0!==e.ShareFacebook?e.ShareFacebook:!0,e.ShareTwitter=void 0!=e.ShareTwitter?e.ShareTwitter:!0,e.ShareGoogle=void 0!==e.ShareGoogle?e.ShareGoogle:!0,e.SharePinterest=void 0!==e.SharePinterest?e.SharePinterest:!0,e.ShareEmail=void 0!==e.ShareEmail?e.ShareEmail:!0,e.ShareMore=void 0!==e.ShareMore?e.ShareMore:!0,e.ShareTheme=e.ShareTheme||"Counter",t&&(e.Width="400px",e.Height="50px")},load:function(n,i){n.append(e).append(t),i(null,"share")},createElementViewModel:function(e,t){return l.prototype=new e(t),l.prototype.constructor=l,new l}}}),define("text!designer/app/builder/ui/canvas/elements/text/el.text.html",[],function(){return'<script type="text/html" id="wsb-canvas-template-text">\r\n    <div class="wsb-text-element"\r\n         data-bind="\r\n    event: { dblclick: preventBubbling }\r\n    ">\r\n        <!--ko if: showSheild-->\r\n        <div class="wsb-text-element-shield" data-bind="\r\n    style: { top: selectionMargin, bottom: selectionMargin, left: selectionMargin, right: selectionMargin, \'z-index\': 1 }\r\n        "></div>\r\n        <!--/ko-->\r\n        <div data-widget-content="true" class="txt clearfix" data-bind="\r\n    attr: {\r\n        style: Style() + \';width:\' + Width() + \';height:\' + Height() + \';\',\r\n        \'class\': CssClasses() + \' txt\' + selectable(),\r\n        id: \'inner-text-\' + ID()\r\n    },\r\n    editor: {\r\n        content: htmlWithLocalizedTokens,\r\n        isEditable: isEditable,\r\n        autoFit: true,\r\n        styles: themeStyles,\r\n        css: themeCss,\r\n        cssImports: cssImports,\r\n        viewModeContent: tokenReplacedHtml,\r\n        editorCreate: handleEditorCreation,\r\n        startEditing: handleEditStart,\r\n        stopEditing: handleEditStop,\r\n        selectRange: selectRange,\r\n        getRange: getRange\r\n    },\r\n    event: { scroll: cancelMove, click: preventBubbling, mousedown: preventBubbling, dblclick: preventBubbling },\r\n    clickBubble: false,\r\n    mousedownBubble: false,\r\n    dblclickBubble: false\r\n        ">\r\n        </div>\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="insert-link-dialog">\r\n    <div class="wsb-insert-link-flyout">\r\n        <label class="sf-form-label" data-bind="text: i18Dict[\'Server__Link_url_colon\']"></label>\r\n        <div data-bind="urlPicker: { url: href, pageId: pageId, pages: pages, onOpen: onOpen, onClose: onClose, validate: validate, isValid: isValid, showError: showError }"></div>\r\n        <label class="checkbox">\r\n            <input type="checkbox" id="wsb-insert-link-newwindow" data-bind="checked: isNewWindow" />\r\n            <span data-bind="text: i18Dict.Server__Open_link_in_new_window"></span>\r\n        </label>\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="textbox-hint-template">\r\n    <div class="wsb-text-hint-flyout">\r\n        <p data-bind="text: i18Dict[\'Server__You_have_hidden_some_text\']"></p>\r\n        <a href="#" data-bind="click: close, text: i18Dict[\'OK\']" class="btn btn-success"></a>\r\n        <label class="checkbox" data-bind="text: i18Dict[\'Server__Dont_show_again\']">\r\n            <input type="checkbox" data-bind="checked: dontShowCheckboxChecked"/>\r\n        </label>\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="wsb-ckeditor-menu-keymap">\r\n    <span class="cke_menubutton_keymap">\r\n        <span class="cke_menubutton_key" data-bind="text: ctrlKey"></span>\r\n        +\r\n        <span class="cke_menubutton_key" data-bind="text: keyChar"></span>\r\n    </span>\r\n</script>\r\n\r\n<div id="wsb-ckeditor-copy-paste-modal" style="display: none" data-bind="dialog:{\r\n    title: title,\r\n    isOpen: isOpen,\r\n    autoResize: true,\r\n    buttons: buttons\r\n    }">\r\n    <p class="el-text-context-modal-subtitle" data-bind="text: subtitle"></p>\r\n    <ul class="el-text-context-modal-list">\r\n        <li class="el-text-context-modal-item">\r\n            <span class="el-text-context-modal-keys">\r\n                <span class="el-text-context-key" data-bind="text: ctrlKey"></span>\r\n                +\r\n                <span class="el-text-context-key" data-bind="text: cutKey"></span>\r\n            </span>\r\n            <span class="el-text-context-modal-desc" data-bind="text: cut"></span>\r\n        </li>\r\n        <li class="el-text-context-modal-item">\r\n            <span class="el-text-context-modal-keys">\r\n                <span class="el-text-context-key" data-bind="text: ctrlKey"></span>\r\n                +\r\n                <span class="el-text-context-key" data-bind="text: copyKey"></span>\r\n            </span>\r\n            <span class="el-text-context-modal-desc" data-bind="text: copy"></span>\r\n        </li>\r\n        <li class="el-text-context-modal-item">\r\n            <span class="el-text-context-modal-keys">\r\n                <span class="el-text-context-key" data-bind="text: ctrlKey"></span>\r\n                +\r\n                <span class="el-text-context-key" data-bind="text: pasteKey"></span>\r\n            </span>\r\n            <span class="el-text-context-modal-desc" data-bind="text: paste"></span>\r\n        </li>\r\n    </ul>\r\n</div>'}),define("designer/placeholder/placeholder",["designer/app/builder/data/data","knockout","common/util/stringHelper","/i18n/resources/client"],function(e,t,n,i){function a(e){return e?'<a href="https://twitter.com/'+encodeURIComponent(e)+'" target="_blank">@'+n.htmlEncode(e)+"</a>":""}function r(e){if(e){var t=c.exec(e)[1];return'<a href="'+n.htmlEncode(e)+'" target="_blank">'+n.htmlEncode(t)+"</a>"}return""}function o(e){if(e){var t=n.htmlEncode(e);return'<a href="mailto:'+t+'" target="_blank">'+t+"</a>"}return""}var s=e.getDataModel(),l=s.napsoc,d=s.theme.isThemeEditMode?l.themeNapsoc.observables():l.observables(),c=/^.*\/(.*?)$/;return[{name:i.resources.Client__Site_name,token:"[SITE_NAME]",localizedToken:i.resources.Client__Localized_Site_Name_Placeholder,value:d.Name},{name:i.resources.Client__Street_address,token:"[STREET_ADDRESS]",localizedToken:i.resources.Client__Localized_Street_Address_Placeholder,value:t.computed(function(){return d.Address()?d.Address():null})},{name:i.resources.Client__Phone_number,token:"[PHONE_NUMBER]",localizedToken:i.resources.Client__Localized_Phone_Number_Placeholder,value:t.computed(function(){return d.Phone()?d.Phone():null})},{name:i.resources.Client__Email_address,token:"[EMAIL_ADDRESS]",localizedToken:i.resources.Client__Localized_Email_Address_Placeholder,isHtml:!0,value:t.computed(function(){return o(d.Email())})},{name:i.resources.Client__Facebook_page_link,token:"[FACEBOOK_PAGE]",localizedToken:i.resources.Client__Localized_Facebook_Page_Placeholder,isHtml:!0,value:t.computed(function(){return r(d.FacebookUrl())})},{name:i.resources.Social__Twitter__link,token:"[TWITTER]",localizedToken:i.resources.Client__Localized_Twitter_Link_Placeholder,isHtml:!0,value:t.computed(function(){return a(d.TwitterUsername())})}]}),define("text!libs/ckeditor_v2/plugins/wsb/menu_styles.css",[],function(){return".cke_menuitem:hover .cke_menubutton{background-color:#7fb133;color:#fff;}.cke_menuitem .cke_menubutton_inner .cke_menubutton_icon{padding:8px 10px 8px 8px;background-color:transparent;}.cke_menuitem:hover .cke_menubutton_inner .cke_menubutton_label{color:#fff;}.cke_menuitem .cke_menubutton_keymap{position:absolute;right:6px;}.cke_menuitem:hover .cke_menubutton_keymap{color:#fff;}.cke_menuitem .cke_menubutton_key{background:#fcfcfc;background:-moz-linear-gradient(top,#fcfcfc 0%,#f0f0f0 100%);background:-webkit-gradient(linear,left top,left bottom,color-stop(0%,#fcfcfc),color-stop(100%,#f0f0f0));background:-webkit-linear-gradient(top,#fcfcfc 0%,#f0f0f0 100%);background:-o-linear-gradient(top,#fcfcfc 0%,#f0f0f0 100%);background:-ms-linear-gradient(top,#fcfcfc 0%,#f0f0f0 100%);background:linear-gradient(to bottom,#fcfcfc 0%,#f0f0f0 100%);filter:progid:DXImageTransform.Microsoft.gradient( startColorstr='#fcfcfc',endColorstr='#f0f0f0',GradientType=0 );padding:2px 4px;border:1px solid #fff;-ms-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 0 1px #000;-ms-box-shadow:0 0 1px #000;box-shadow:0 0 1px #000;margin:auto 4px;}.cke_menuitem:hover .cke_menubutton_key{color:#272727;}"}),define("libs/ckeditor_v2/plugins/wsb/plugin_v2",["libs/ckeditor_v2/ckeditor","/i18n/resources/client","common/api/api.guid"],function(e,t,n){function i(n){n.addCommand("addWsbLink",{exec:a}),n.addCommand("removeWsbLink",{exec:function(t){var n=new e.style({element:"a",type:e.STYLE_INLINE,alwaysRemoveElement:!0});t.removeStyle(n)},refresh:function(t,n){var i=n.lastElement&&n.lastElement.getAscendant("a",!0);this.setState(i&&"a"===i.getName()&&i.getAttribute("href")&&i.getChildCount()?e.TRISTATE_OFF:e.TRISTATE_DISABLED)},contextSensitive:!0,startDisabled:!0}),n.setKeystroke(e.CTRL+76,"addWsbLink"),n.ui.addButton("AddWsbLink",{label:t.resources.Client__Designer__CkEditor_AddLink,command:"addWsbLink",toolbar:"links,10"}),n.ui.addButton("RemoveWsbLink",{label:t.resources.Client__Designer__CkEditor_RemoveLink,command:"removeWsbLink",toolbar:"links,20"}),n.addMenuItem("link",{label:t.resources.Client__Designer__CkEditor_AddLink,command:"addWsbLink",group:"link",order:1}),n.addMenuItem("unlink",{label:t.resources.Client__Designer__CkEditor_RemoveLink,command:"removeWsbLink",group:"link",order:5}),n.ui.addRichCombo("InsertPlaceholder",{label:t.resources.Client__Designer__CkEditor_PlaceHolder,title:t.resources.Client__Designer__CkEditor_PlaceHolderTitle,voiceLabel:t.resources.Client__Designer__CkEditor_PlaceHolderTitle,toolbar:"placeholder,10",panel:{css:[e.skin.getPath("editor"),n.config.contentsCss],multiSelect:!1,attributes:{"aria-label":t.resources.Client__Designer__CkEditor_PlaceHolderTitle}},init:function(){var e=this;window.require(["designer/placeholder/placeholder"],function(t){for(var n=0;n<t.length;n++){var i=t[n];e.add(i.localizedToken,i.name,i.name)}})},onClick:function(e){n.focus(),n.fire("saveSnapshot"),n.insertText(e),n.fire("saveSnapshot")}})}function a(i){window.require(["jquery","knockout","designer/app/builder/ui/controls/media/chooser/media.chooser","common/ui/dialog","designer/app/builder/managers/pageManager"],function(a,s,l,d,c){function u(e){var t=!v.wsbDialog("isButtonDisabled","ok");t!=e&&v.wsbDialog(e?"enableButton":"disableButton","ok")}function p(t){var n=t.getSelection(),i=n.getSelectedElement();if(i&&i.is("a"))return i;var a=n.getRanges(!0)[0];return a?(a.shrink(e.SHRINK_TEXT),t.elementPath(a.getCommonAncestor()).contains("a",!0)):null}function g(i,a){var d=a.href(),c=a.isNewWindow(),u=i.getRanges()[0],p=function(t){if(t){var n=new e.dom.text(t,i.document);u.insertNode(n),u.selectNodeContents(n)}var a={href:d};c&&(a.target="_blank");var r=new e.style({element:"a",attributes:a,type:e.STYLE_INLINE});r.applyToRange(u),u.select()};if(u.collapsed){var g=d,h=d&&d.match(r);if(h){var m=h[1],b=h[2];if(o.test(b)&&(b=n.toUuid(b)),"page"===m){g=t.resources.Client__Designer__LinkDialog_MissingPage;var f=s.utils.unwrapObservable(a.pages);for(var v in f){var _=s.utils.unwrapObservable(f[v].id);if(_===b){g=s.utils.unwrapObservable(f[v].name);break}}p(g)}else{var w=function(){g=t.resources.Client__Designer__LinkDialog_MissingFile;var e=s.utils.arrayFirst(y(),function(e){return e.referenceId===b||e.id===b});e&&(g=e.name()),p(g)};y?w():l.getFiles(function(e){y=e,w()},!0)}}else p(!1)}else p(!1)}function h(e,t,n){t.setAttribute("href",n.href()),n.isNewWindow()?t.setAttribute("target","_blank"):t.removeAttribute("target"),t.removeAttribute("data-cke-saved-href"),e.selectElement(t)}var m=i.getSelection();m.lock();var b={href:s.observable(""),pageId:s.observable(null),isNewWindow:s.observable(!1),pages:s.computed(function(){return a.map(c.pages(),function(e){return{id:e.Id,name:e.Name,type:"page"}})}),onOpen:function(){v&&v.closest(".sf-dialog").hide()},onClose:function(){v&&v.closest(".sf-dialog").show()},validate:!0,validationMessage:s.observable(""),isValid:s.observable(!1),showError:s.observable(!0),i18Dict:{Server__Link_url_colon:t.resources.Server__Link_url_colon,Server__Open_link_in_new_window:t.resources.Server__Open_link_in_new_window}},f=p(i);f&&(m.selectElement(f),b.href(f.getAttribute("href")),b.isNewWindow("_blank"===f.getAttribute("target")),b.pageId(f.data("wsb-page-id")),b.isValid(!0));var v=a("<div data-bind=\"template: 'insert-link-dialog'\"/>").wsbDialog({title:t.resources.Link,buttons:[{id:"ok",text:f?t.resources.Client__Designer__Update:t.resources.Client__Designer__Insert,onClick:function(){return f?h(m,f,b):g(m,b),v.wsbDialog("close"),!1}},{id:"cancel",text:t.resources.Cancel,cancel:!0}],onOpen:function(){i.focusManager.lock(),b.isValid.subscribe(function(e){u(e)})},onClose:function(){m.unlock(),i.element&&i.element.focus(),i.focusManager.unlock()}});s.applyBindings(b,v[0]),v.wsbDialog("resize"),f||u(!1),u(b.href.isValid()&&b.href().length>0);var y})}e.plugins.add("wsb",{requires:["richcombo"],icons:"addwsblink,removewsblink",init:i});var r=/^(page|file):([0-9a-f:\-]+)$/i,o=/^\d+$/}),define("designer/app/builder/ui/canvas/elements/text/el.text",["text!designer/app/builder/ui/canvas/elements/text/el.text.html","jquery","knockout","libs/ckeditor_v2/ckeditor","common/util/stringHelper","designer/app/builder/data/data","designer/placeholder/placeholder","/i18n/resources/client","common/abTesting/abTesting","designer/app/builder/ui/uiHelper","websiteSettings","common/persistence/persistence","appconfig","designer/app/builder/managers/elementManager","designer/app/builder/managers/themeManager","designer/app/builder/managers/css/css","common/browser/browser","common/stats/googleanalytics","common/logger/logger","text!libs/ckeditor_v2/plugins/wsb/menu_styles.css","libs/knockout/ko.addins_v2","libs/ckeditor_v2/plugins/wsb/plugin_v2","common/ui/flyout"],function(e,t,n,i,a,r,o,s,l,d,c,u,p,g,h,m,b,f,v,y){function _(e,t){t&&(e.Width="300px",e.Height="21px"),e.Html=e.Html||O}function w(e){function r(e){var n=e.toolbox.toolbars[0].items[0].combo,a=n.onClick,r=function(){e.focus(),e.execCommand("removeFormat"),e.getStylesSet(function(n){t.each(n,function(t,n){var a=new i.style(n);e.removeStyle(a)})})};n.onClick=function(e){r(),a.call(this,e)}}function d(e){var t=e.toolbox.toolbars[0].items[1].combo,n=t.onClick;t.onClick=function(e){f.trackEvent("wsb-designer-text-editor","font-change","",e),n.call(this,e)}}function p(e){var n=[],a=e.toolbox.toolbars[0].items,r=a[1].combo,o=r.onClick,s=a[2].combo,l=s.onClick,d=a[4].button,c=d.click,u=a[5].button,p=u.click,g=function(e){if("span"!==e.getName().toLowerCase())return e;var t=e.getParent();return"span"!==t.getName().toLowerCase()?e:t.getChildren().length>1?e:g(t)},h=function(){n=[],e.getStylesSet(function(a){t.each(a,function(t,a){var r=new i.style(a);r._.definition.attributes&&r._.definition.attributes.class&&r.checkActive(e._.selectionPreviousPath)&&(n.push(r),e.removeStyle(r))})})},m=function(){var a=b.window.getSelection(),r=a.getRangeAt(0).commonAncestorContainer,o=r.getElementsByTagName?r.getElementsByTagName("*"):!1;if(o===!1){var s=e._.selectionPreviousPath.lastElement,l=g(s);
t.each(n,function(e,t){t.applyToObject(l)})}else t.each(o,function(e,r){if(a.containsNode(r,!0)){var o=new i.dom.element(r);t.each(n,function(e,t){t.applyToObject(o)})}});n=[]};r.onClick=function(e,t){h(e,t),o.call(this,e,t),m(e,t)},s.onClick=function(e,t){h(e,t),l.call(this,e,t),m(e,t)},i.currentInstance&&(i.currentInstance.prepOverrideStyleWithColor=h,i.currentInstance.overrideStyleWithColor=m),d.click=function(e,t){h(e,t),c.call(this,e,t),m(e,t)},u.click=function(e,t){h(e,t),p.call(this,e,t),m(e,t)}}function g(e,n){clearTimeout(v);var a=e.$,r=n.toolbox.toolbars[0].items,o=t(a),s=parseInt(o.css("font-size"),10),l=o.css("font-family").split(",")[0].replace(/^[\s\'\"]+|\.|[\s\'\"]+$/g,""),d=t("#"+r[2].id+"_text"),c=t("#"+r[1].id+"_text");l=l[0].toUpperCase()+l.slice(1),d.text(s),c.text(l),v=setTimeout(function(){0===d.closest("body").length&&null!=i.currentInstance&&(r=i.currentInstance.toolbox.toolbars[0].items,t("#"+r[2].id+"_text").text(s),t("#"+r[1].id+"_text").text(l))},500)}function h(e){try{var t=e.data.dataValue;0===t.indexOf("<p")&&(t=t.substring(t.indexOf(">")+1)),t=t.replace(/<\/p>([^<]+)<p/g,"</p><p>$1</p><p"),t=t.replace(/<p[^>]*>/g,"<br><br>"),t=t.replace(/<\/p[^>]*>/g,""),e.data.dataValue=t}catch(n){}}e.showVerticalResizeHandles(!1);var v=0;e.isEditable=n.computed(function(){return!e.isLocalizedThemeMode()}),e.htmlWithLocalizedTokens=n.computed({read:function(){var t=e.Html();for(var n in o){var i=o[n],a=new RegExp(i.token.replace(/\[/g,"\\[").replace(/\]/g,"\\]"),"gm"),r=i.localizedToken;t=t.replace(a,r)}return t},write:function(t){for(var n in o){var i=o[n],a=new RegExp(i.localizedToken.replace(/\[/g,"\\[").replace(/\]/g,"\\]"),"gm"),r=i.token;t=t.replace(a,r)}t!==e.Html()&&(e.Html(t),e.sizeToFit())}});var y=e.getLocalizedProperty("Html");e.tokenReplacedHtml=n.computed(function(){var e=y();for(var t in o){var n=o[t],i=new RegExp(n.token.replace(/\[/g,"\\[").replace(/\]/g,"\\]"),"gm"),r=n.value();r?n.isHtml||(r=a.htmlEncode(r)):r=n.localizedToken,e=e.replace(i,r)}return e}),e.boundingBoxPadding(15),[e.htmlWithLocalizedTokens,e.tokenReplacedHtml].forEach(function(t){t.subscribe(function(){e.ensureAccurateOuterSize()})}),e.themeCss=n.computed(function(){return m.baseCss()+m.customCss()}),e.sizeToFit=function(){I.disable();var n=0,i=0,a=t("#inner-text-"+e.ID());a.children().each(function(){var e=t(this);if("cke_pastebin"!==e.attr("id")&&(n+=e.outerHeight(!0),"table"===String(this.nodeName).toLowerCase())){var a=e.outerWidth(!0);a>i&&(i=a)}}),e.pixelHeight(n),e.pixelWidth()<i&&e.pixelWidth(i),I.enable()},e.handleResize=function(){e.sizeToFit()};var _=!1;return e.isMouseOver.subscribe(function(t){t&&!_&&(I.disable(),e.sizeToFit(),I.enable(),_=!0)}),e.cssImports=m.cssImports,e.themeStyles=n.computed(function(){var e=[{name:s.resources.Client__Text_Editor_H1_Style_Name,element:"h1"},{name:s.resources.Client__Text_Editor_H2_Style_Name,element:"h2"},{name:s.resources.Client__Text_Editor_H3_Style_Name,element:"h3"},{name:s.resources.Client__Text_Editor_H4_Style_Name,element:"h4"},{name:s.resources.Client__Text_Editor_H5_Style_Name,element:"h5"},{name:s.resources.Client__Text_Editor_H6_Style_Name,element:"h6"},{name:s.resources.Client__Text_Editor_Paragraph_Style_Name,element:"p"}],t=m.pageStyles().editor||{};for(var n in t){var i=t[n],a=/h(\d)/i.exec(i.tag);a&&(n=s.resources.Client__Text_Editor_Heading_Style_Name_Format.replace(/\{level\}/g,a[1]).replace(/\{name\}/g,n)),e.push({name:n,attributes:{"class":i.className},element:i.tag||"span"})}return e.sort(function(e,t){var n={a:M[e.element]||Number.MAX_VALUE,b:M[t.element]||Number.MAX_VALUE};return n.a<n.b?-1:n.b<n.a?1:e.name<t.name?-1:t.name<e.name?1:0}),e}).extend({throttle:1e3}),e.enableBackspace=!0,e.preventBubbling=function(){return!0},e.cancelMove=function(){e.state()===e.stateMap.move&&e.selectElement()},e.showSheild=n.computed(function(){return"edit"!==e.state()}),e.handleEditorCreation=function(n){var i=!1;n.on("selectionChange",function(e){g(e.data.path.lastElement,e.editor)}),n.on("paste",h),p(n),r(n),d(n),n.stateSubscription=e.state.subscribe(function(a){a===e.stateMap.edit?(i=!0,t("#"+e.ID()).find(".txt").focus(),n.setReadOnly(!1)):i&&(i=!1,n.focusManager.blur(!0),t("#"+e.ID()).find(".txt").blur(),b.window.document.body.focus())})},e.handleEditStart=function(){e.selectElement(),e.state(e.stateMap.edit),e.hideActionMenu(),I.collect("Edit Start")},e.handleEditStop=function(){I.enable("Edit Start"),e.state()===e.stateMap.edit&&e.state(e.stateMap.selected),t("#"+e.ID()).find(".txt").blur(),b.window.document.body.focus()},e.getRange=function(e){return e.getSelection().getRanges()},e.selectRange=function(e,t){t&&setTimeout(function(){e.getSelection().selectRanges(t)},0)},e.selectionMargin=n.computed(function(){return e.state()===e.stateMap.view?"-9px":"-15px"}),e.Title=s.resources.Text,e.SettingsTitle=s.resources.Text_Settings,e.i18Dict=s.resources,e.hasClickedOK=n.observable(!1),e.dontShowCheckboxChecked=n.observable(!!c.TextFlyoutHintDismissDate),e.textOverflowEnabled=n.observable("enabled"===l.getOption("textOverflow")),e.ShadowCssClass.subscribe(function(e){f.trackEvent("text_settings","shadow",e||"none")}),e.GradientType.subscribe(function(e){var t=e?"gradient_on":"gradient_off";f.trackEvent("text_settings",t,"checkbox")}),e.close=function(){var t=e.dontShowCheckboxChecked();e.hasClickedOK(!0),t&&u.Post("/api/websites/{websiteId}/websitesettings",{TextFlyoutHintDismissDate:(new Date).toISOString()})},e.Html.subscribe(function(){e.sizeToFit()}),e.selectable=n.computed(function(){return"edit"===e.state()?" selectable":""}),e.afterRender=function(n){setTimeout(function(){e.sizeToFit()},0),t.isFunction(n)&&n(e)},e.showProperties=function(t){e.hideActionMenu(),e.showMutator(t)},e.dblClick=function(){this.isLocalizedThemeMode()||e.state(e.stateMap.edit)},e.getActionMenuItems=function(){var t=e.getCommands();return[{text:s.resources.Edit,tip:s.resources.Edit,cssClass:"wsb-tool-Edit",click:function(){f.trackEvent("general_settings_modal","edit","text"),e.state(e.stateMap.edit)}},t.editProperties,t.clone,t["delete"],t.layoutCommands]},e}function S(){var e="keyup.editor input.editor";i.on("instanceCreated",function(e){var n=e.editor;n.on("instanceReady",function(e){if(t(e.editor.element.$).removeAttr("title"),b.mozilla)try{b.window.document.designMode="on",b.window.document.execCommand("enableObjectResizing",!1,!1),b.window.document.execCommand("enableInlineTableEditing",!1,!1),b.window.document.designMode="off"}catch(e){}})}),n.bindingHandlers.editor={init:function(a,o,d,c){function u(){a.setAttribute("contenteditable","true"),m.styles&&(i.config.stylesSet=n.utils.unwrapObservable(m.styles)),i.config.font_names=p.FontList.map(function(e){return e.fontName+"/"+e.fontStyle}).join(";"),i.config.fontSize_sizes=p.FontSizes.map(function(e){return e.fontSizeDisplay+"/"+e.fontSize}).join(";");var o=i.inline(a);m.editorCreate&&o.on("instanceReady",function(){m.editorCreate(o)});var d=function(){v&&m.content(k(a.innerHTML))};o.on("change",d),b.bind(e,d);var c="enabled"===l.getOption("placeHolder")||h.isThemeEditMode,u=function(e){if(e.preventDefault(),!t(this).hasClass("cke_button_disabled")){var n=f.getRange(o);N(!0),B=function(){f.handleEditStop(),f.handleEditStart(),f.selectRange(o,n),B=!1}}};o.on("focus",function(){a.setAttribute("contenteditable","true"),v=!0;var e=n.utils.unwrapObservable(c?m.content:m.viewModeContent)||"";e!==a.innerHTML&&(a.innerHTML=e),r.saver.saveWhileCollecting(!0);var i=t("#cke_"+o.name);if(i.length){var s=function(){var e=o.createRange();e.moveToElementEditablePosition(o.editable(),!1),o.getSelection().selectRanges([e]),i.css({width:i.width()+"px",cursor:"move",zIndex:10001}).draggable()};setTimeout(s,1);var l=function(){var e=t(".cke_combopanel__styles .cke_panel_frame");e.length?e.each(function(){var e=this.contentWindow.document,i=t("head",e),a="body { background-color: #b5b6b5; } .cke_panel_listItem a { border: none; } .cke_panel_listItem a:hover, .cke_panel_listItem a:focus, .cke_panel_listItem a:active { background-color: #e5e6e5; } .cke_panel_listItem.cke_selected a { background-color: #cfcfcf; }"+n.utils.unwrapObservable(m.css);t("<style/>").text(a).appendTo(i),t.each(n.utils.unwrapObservable(m.cssImports)||[],function(e,n){t('<link rel="stylesheet" type="text/css" />').attr("href",n).appendTo(i)})}):setTimeout(l,100)};setTimeout(l,100),i.find(".cke_button__cut_icon, .cke_button__copy_icon, .cke_button__paste_icon").each(function(){var e=t(this).parent();e.prop("onclick",null),e.prop("onmouseup",null),e.prop("href","#"),e.unbind("click",u).bind("click",u)})}m.startEditing&&m.startEditing()});var _=null;return o.on("menuShow",function(e){_=e.data[0];var n=t(".cke_panel_frame",_.element.$)[0].contentWindow.document,i=t(".cke_menuitem",n);t("#wsb-ck-menu-styles",n).length||t("body",n).prepend(t('<style id="wsb-ck-menu-styles"></style>').html(y)),t(".cke_menubutton__cut, .cke_menubutton__copy, .cke_menubutton__paste",i).each(function(){var e=t(this),n=/cke_menubutton__([^ ]+)/.exec(String(e.attr("class")));if(n.length>=2)switch(n=n[1],e.prop("onclick",null),e.prop("onmouseup",null),e.prop("href","#"),e.on("click",function(){var e=m.getRange(o);N(!0),B=function(){m.stopEditing(),m.startEditing(),m.selectRange(o,e),B=!1}}),n){case"cut":t(".cke_menubutton_label",e).text(s.resources.Clipboard_Cut).append(t(E));break;case"copy":t(".cke_menubutton_label",e).text(s.resources.Clipboard_Copy).append(t(P));break;case"paste":t(".cke_menubutton_label",e).text(s.resources.Clipboard_Paste).append(t(D))}})}),o.on("blur",function(){if(!B){a.setAttribute("contenteditable",!1),d(),v=!1,r.saver.saveWhileCollecting(!1);var e=n.utils.unwrapObservable(m.viewModeContent)||"";a.innerHTML=e,_&&_.hide(),m.stopEditing&&m.stopEditing()}}),n.utils.domNodeDisposal.addDisposeCallback(a,g),o}function g(){a.removeAttribute("contenteditable"),_&&(_.destroy(),b.unbind(e),_=null)}var m=o(),b=t(a),f=c,v=!1;a.innerHTML=n.utils.unwrapObservable(m.viewModeContent)||"",n.isObservable(m.viewModeContent)&&m.viewModeContent.subscribe(function(e){v||(a.innerHTML=e)});var _;n.utils.unwrapObservable(m.isEditable)!==!1&&(_=u()),n.isObservable(m.isEditable)&&m.isEditable.subscribe(function(e){e?setTimeout(function(){_=u()},1):g()}),m.styles&&n.isObservable(m.styles)&&m.styles.subscribe(function(e){i.config.stylesSet=e,g(),_=u()})}}}function k(e){try{if(-1===t.trim(e).indexOf("<"))return e;var n=t(e),i=t("<div></div>");i.append(n.filter(":not([id='cke_pastebin'])")),links=i.find("a");for(var a=0;a<links.length;a++)jqLink=t(links[a]),children=jqLink.children(),children.length>=1?(child=t(children[0]),color=child.css("color"),jqLink.css("color",color)):jqLink.css("color","");return i[0].innerHTML}catch(r){return e}}function x(e,t){e.call(this,t),this.Styling.ShowAdvancedTab(!1),w(this)}function C(){E=n.utils.getRenderedTemplate("wsb-ckeditor-menu-keymap",{ctrlKey:L,keyChar:s.resources.Keyboard_X}),P=n.utils.getRenderedTemplate("wsb-ckeditor-menu-keymap",{ctrlKey:L,keyChar:s.resources.Keyboard_C}),D=n.utils.getRenderedTemplate("wsb-ckeditor-menu-keymap",{ctrlKey:L,keyChar:s.resources.Keyboard_V})}function T(){i.on("dialogDefinition",function(e){var t=e.data.name,n=e.data.definition;if("table"===t){var i=n.getContents("info");i.get("txtWidth").default="200px",i.get("cmbAlign").default="right"}})}var E,P,D,I=r.undoer,A="text",M={h1:1,h2:2,h3:3,h4:4,h5:5,h6:6,p:7},O="<p>"+s.resources.Client__Designer__Type_your_paragraph_here+"</p>",L=b.isMacKeyboard?s.resources.Keyboard_Ctrl_Mac:s.resources.Keyboard_Ctrl_Win,N=n.observable(!1),B=!1;return{name:A,load:function(i,a){i.append(e),C(),n.applyBindings({isOpen:N,ctrlKey:L,cutKey:s.resources.Keyboard_X,copyKey:s.resources.Keyboard_C,pasteKey:s.resources.Keyboard_V,cut:s.resources.Clipboard_Cut,copy:s.resources.Clipboard_Copy,paste:s.resources.Clipboard_Paste,title:s.resources.Title_Copy_And_Paste,subtitle:s.resources.Subtitle_Copy_And_Paste,buttons:[{id:"btnOK",text:s.resources.OK,onClick:function(){return N(!1),B&&setTimeout(function(){B()},0),!1}}]},t("#wsb-ckeditor-copy-paste-modal")[0]),S(),T(),a(null,"text")},initModel:_,createElementViewModel:function(e,t,n){return n||t.Html(k(t.Html())),x.prototype=Object.create(e.prototype),new x(e,t)}}}),define("text!designer/app/builder/ui/canvas/elements/yelp/el.yelp.html",[],function(){return'<script type="text/html" id="wsb-canvas-template-yelp">\r\n    <div data-bind="attr: { style: Style, \'class\': \'js-wsbYelp \' + CssClasses() }"></div>\r\n    \r\n    <!-- ko if: visibleOverlay() === "default" -->\r\n    <div class="wsb-yelp-element-overlay"></div>\r\n    <!-- /ko -->\r\n    \r\n    <!-- ko if: visibleOverlay() === "multiple-listings" -->\r\n    <div class="wsb-yelp-listings">\r\n        <div class="wsb-yelp-content">\r\n            <h3 data-bind="text:i18NDict.Server__Which_one_is_you"></h3>\r\n            <div class="wsb-yelp-not-found-text">\r\n                <span data-bind="text: i18NDict.Server__Looks_like_we_found_a_couple_listings"></span>\r\n                <br/>\r\n                <span data-bind="text: i18NDict.Server__Please_select_your_listing_colon"></span>\r\n            </div>\r\n            <ul id="wsbYelpListingsOverlayResults" data-aid="wsbYelpListingsOverlay-results" data-bind="event: { mousedown: listingsOverlayOnMousedown }, foreach: listings" class="wsb-yelp-business-picker wsb-yelp-which">\r\n                <li class="wsb-yelp-business-picker-item" data-bind="click: $parent.selectListing">\r\n                    <dl>\r\n                        <dt data-bind="html: name"></dt>\r\n                        <dd data-bind="text: location.address + \' \' + location.city + \', \' + location.state_code + \' \' + location.postal_code"></dd>\r\n                    </dl>\r\n                </li>\r\n            </ul>\r\n            <div class="wsb-yelp-not-found-btns">\r\n                <a id="listingsFind" data-aid="wsbYelpListingsOverlay-find" data-bind="click: findListing, text: i18NDict.Server__I_dont_see_it" class="btn btn-inverse-grey"></a>\r\n                <a id="listingsCreate" data-aid="wsbYelpListingsOverlay-create" data-bind="click: createListing, text: i18NDict.Server__Create_one" class="btn btn-inverse-grey"></a>\r\n            </div>\r\n        </div>\r\n        <div class="wsb-yelp-overlay"></div>\r\n    </div>\r\n    <!-- /ko -->\r\n    \r\n    <!-- ko if: visibleOverlay() === "no-listings" -->\r\n    <div class="wsb-yelp-listings">\r\n        <div class="wsb-yelp-content">\r\n            <h3 data-bind="text: i18NDict.Server__Hmm_we_couldnt_find_you"></h3>\r\n\r\n            <div class="wsb-yelp-not-found-text" data-bind="text: i18NDict.Server__Looks_like_we_couldnt_find_your_listing"></div>\r\n\r\n            <div class="wsb-yelp-not-found-btns">\r\n                <a id="noListingsFind" data-aid="wsbYelpNoListingsOverlay-find" data-bind="click: findListing, text: i18NDict.Server__I_have_one_lets_find_it" class="btn btn-inverse-grey"></a>&nbsp;\r\n                <a id="noListingsCreate" data-aid="wsbYelpNoListingsOverlay-create" data-bind="click: createListing, text: i18NDict.Server__I_dont_have_one_yet" class="btn btn-inverse-grey"></a>\r\n            </div>\r\n        </div>\r\n        <div class="wsb-yelp-overlay"></div>\r\n    </div>\r\n     <!-- /ko -->\r\n</script>\r\n'}),define("text!designer/app/builder/ui/canvas/elements/yelp/mutator.yelp.html",[],function(){return'<script type="text/html" id ="mutator-template-element-yelp">\r\n<!-- ko if: $data.Type() === \'yelp\' -->\r\n<!-- ko with: mutatorViewModel -->\r\n<div id="yelpContainer" class="wsb-canvas-mutator-inner">\r\n    <div class="wsb-canvas-mutator-ctrl-outer clearfix">\r\n        <div class="wsb-canvas-mutator-ctrl-label wsb-url-label" data-bind= "text: i18Dict.ListingsColon">\r\n        </div>\r\n        <div data-bind="if: !hasListing()" class="wsb-canvas-mutator-ctrl-input">\r\n            <a id="propFindListing" data-aid="wsbYelpProps-find" href="#" data-bind="click: YelpListingChooser" class="btn btn-inverse-grey clearfix"><i class="icon-white icon-search"></i data-bind= "text: i18Dict.FindMyListing"></a> &nbsp;&nbsp;\r\n            <a id="propCreateListing" data-aid="wsbYelpProps-create" href="#" data-bind="click: YelpCustomerSetupUrl" target="_blank" class="wsb-yelp-change-listing" data-bind= "text: i18Dict.CreateOne"></a>\r\n        </div>\r\n        <div data-bind="if: hasListing" class="wsb-canvas-mutator-ctrl-input wsb-yelp-current-listing">\r\n            <div data-bind="text: YelpBusinessName" class="wsb-yelp-properties-current-listing-name"></div>\r\n            <div data-bind="html: YelpBusinessLocation" class="wsb-yelp-properties-current-listing"></div>\r\n        </div>\r\n        <div data-bind="if: hasListing" class="wsb-canvas-mutator-ctrl-input wsb-yelp-change-listing">\r\n            <a id="propChangeListing" data-aid="wsbYelpProps-change" href="javascript:void(0);" data-bind="click: YelpListingChooser" class="btn btn-inverse-grey clearfix"><i class="icon-white icon-search"></i><span  data-bind= "text: i18Dict.Change"></span></a>\r\n        </div>\r\n    </div>\r\n\r\n    <div class="wsb-canvas-mutator-ctrl-outer clearfix">\r\n        <div class="wsb-canvas-mutator-ctrl-label" data-bind= "text: i18Dict.ReviewsColon">\r\n        </div>\r\n        \r\n        <div class="wsb-canvas-mutator-ctrl-input wsb-yelp-reviews-choice clearfix">\r\n            <label class="checkbox">\r\n                <input data-aid="wsbYelpProps-showReviews" type="checkbox" data-bind="checked: YelpShowReviews" /><span  data-bind= "text: i18Dict.ShowReviews"></span>\r\n            </label>\r\n\r\n            <select data-aid="wsbYelpProps-maxReviews" data-bind="value: YelpMaxReviews" class="wsb-select-box wsb-yelp-max-reviews">\r\n                <option value="1">1</option>\r\n                <option value="2">2</option>\r\n                <option value="3">3</option>\r\n            </select>\r\n\r\n            <br/>\r\n            <label class="checkbox">\r\n                <input data-aid="wsbYelpProps-showSubmitReviewLink" type="checkbox" data-bind="checked: YelpShowSubmitReviewLink"/><span  data-bind= "text: i18Dict.ShowLinkToSubmitNewReviews"></span>\r\n            </label>\r\n        </div>\r\n    </div>\r\n\r\n    <div class="wsb-canvas-mutator-ctrl-outer wsb-yelp-show clearfix">\r\n        <div class="wsb-canvas-mutator-ctrl-label" data-bind= "text: i18Dict.ShowColon">\r\n        </div>\r\n        <div class="wsb-canvas-mutator-ctrl-input clearfix">\r\n            <label class="checkbox">\r\n                <input data-aid="wsbYelpProps-showPhoto" type="checkbox" data-bind="checked: YelpShowPhoto" /><span data-bind= "text: i18Dict.ProfilePhoto"></span>\r\n            </label>\r\n             <label class="checkbox">\r\n                <input data-aid="wsbYelpProps-showDeals" type="checkbox" data-bind="checked: YelpShowDeals"/><span  data-bind= "text: i18Dict.Deals"></span>\r\n            </label>\r\n            <label class="checkbox">\r\n                <input data-aid="wsbYelpProps-showMap" type="checkbox" data-bind="checked: YelpShowMap"><span data-bind= "text: i18Dict.Map"></span>\r\n            </label>\r\n        </div>\r\n    </div>\r\n</div>\r\n<!-- /ko -->\r\n<!-- /ko -->\r\n</script>'}),define("designer/social/yelp/social.yelp",["jquery","designer/util/util.instances"],function(e,t){function n(e,n){D=new t("wsb-social-yelp",P);var i=D.get(e);return i?i.refresh():i=D.create(e,n),i}function i(e){var t=D.get(e);return t?(D.destroy(e),!0):!1}function a(e,t,n){var i=n.onRenderComplete,a=n.getBusinessCallback;require(["text!"+t],function(t){s(t,n,function(t){e.html(t.html()),h(e,n),T(e,n),i&&i()},a)})}function r(t,n,i,a,r){if(""===t)o(a);else{var s=a,l={businessId:t};i&&(l={action:"business",options:{businessId:t}},s=function(e){var t={};e&&e.data&&"Yelp API Error"!==e.data&&(t=e.data),a&&a(t)}),e.ajax({type:"GET",url:n,data:l,success:s,error:r})}}function o(e){var t={id:"",name:"Passion Tea Company",url:"http://www.yelp.com/biz/urban-curry-san-francisco",image_url:"/assets/images/yelp-fake-business-logo.png",location:{display_address:["777 E WebsiteBuilder St.","World Wide, WB 12345"],coordinate:{latitude:37.7977459,longitude:-122.405864}},display_phone:"(111) 555-5555",rating:"4.0",rating_img_url:"http://s3-media1.ak.yelpcdn.com/assets/2/www/img/f1def11e4e79/ico/stars/v1/stars_5.png",review_count:"299",reviews:[{id:"fake",time_created:1317939620,excerpt:"As a student, I love this place. Quiet yet not library quiet. Great iced tea, a snack and I can put my head down without interuption. Did I mention free wi-fi and wonderful employees.",rating:5,rating_image_url:"http://s3-media1.ak.yelpcdn.com/assets/2/www/img/f1def11e4e79/ico/stars/v1/stars_5.png",user:{id:"fake",name:"April R.",image_url:"/assets/images/yelp-fake-person1.png"}},{id:"fake",time_created:1317939620,excerpt:"Sooo good, you make lunch something to look forward to. I go every week and never order the same thing twice. Soup, salads, sandwiches, oh my. Now, if you would only open one near my house.",rating:5,rating_image_url:"http://s3-media1.ak.yelpcdn.com/assets/2/www/img/f1def11e4e79/ico/stars/v1/stars_5.png",user:{id:"fake",name:"Mary C.",image_url:"/assets/images/yelp-fake-person2.png"}},{id:"fake",time_created:1317939620,excerpt:"I love this place! we go pretty regularly, and even when slammed, they still manage to find us a seat. Good food, and super fast. How can you go wrong with that. Best lunch place up here, hands down.",rating:4,rating_image_url:"http://s3-media4.ak.yelpcdn.com/assets/2/www/img/c2f3dd9799a5/ico/stars/v1/stars_4.png",user:{id:"fake",name:"Chrissy and Jake",image_url:"/assets/images/yelp-fake-person3.png"}}]};e(t)}function s(t,n,i,a){var o=n.businessId,s=n.apiBaseUrl,h=n.isHosted,m=e("<div>").html(t);r(o,s,h,function(t){if(t&&!e.isEmptyObject(t)){var r=t;l(m,n,r),d(m,n,r),c(m,n,r),u(m,n,r),p(m,n,r),i(m),a&&a(r)}else g(n,m,i),a&&a(void 0)},function(){g(n,m,i)})}function l(e,t,n){var i=e.find(".js-wsbYelpName"),a=e.find(".js-wsbYelpPhoto"),r=e.find(".js-wsbYelpLink"),o=e.find(".js-wsbYelpAddress"),s=e.find(".js-wsbYelpPhone"),l=n.location.display_address.join("<br/>");i.html(n.name),o.html(l),s.html(n.display_phone),a.attr({src:E(n.image_url),alt:t.i18N.resources.Photo_of.sfFormat(n.name)}),r.attr({href:E(n.url),title:t.i18N.resources.Link_to.sfFormat(n.name)})}function d(e,t,n){var i=e.find(".js-wsbYelpRatingImage"),a=e.find(".js-wsbYelpNumberOfReviews"),r=e.find(".js-wsbYelpNumberOfReviewsLink");i.attr({src:E(n.rating_img_url),alt:t.i18N.resources.Rating_is.sfFormat(n.rating)});var o=t.i18N.resources.Number_reviews.sfFormat(n.review_count);1==n.review_count&&(o=t.i18N.resources.One_review),a.html(o),r.attr({href:E(n.url),title:t.i18N.resources.Link_to.sfFormat(n.name)})}function c(e,t,n){var i=n.deals,a=e.find(".js-wsbYelpDealsContainer"),r=e.find(".js-wsbYelpNoDealsContainer"),o=e.find(".js-wsbYelpDealTitle"),s=e.find(".js-wsbYelpNoDealTitle"),l=t.i18N.resources.View_full_listing,d=e.find(".js-wsbYelpSubmitReviewLink"),c=E(n.url);if(i&&i.length){var u=i[0];o.html(u.title),a.attr({href:E(u.url),title:t.i18N.resources.Link_to.sfFormat(u.title)})}else o.html(l),o.removeClass("wsb-yelp-deal-title").addClass("wsb-yelp-no-deal-title"),a.attr({href:E(n.url),title:t.i18N.resources.Link_to.sfFormat(n.name)});d.attr({href:c,title:t.i18N.resources.Link_to_submit_review.sfFormat(n.name)}),s.html(l),r.attr({href:c,title:t.i18N.resources.Link_to.sfFormat(n.name)})}function u(e,t,n){var i=n.reviews,a=e.find(".js-wsbYelpReviewsList"),r=e.find(".js-wsbYelpReview").clone();if(a.html(""),i)if(i.length)for(var o=i.length,s=0;o>s;s++){var l=i[s],d=r.clone(),c=d.find(".js-wsbYelpReviewUserImage"),u=d.find(".js-wsbYelpReviewUserName"),p=d.find(".js-wsbYelpReviewDate"),g=d.find(".js-wsbYelpReviewRatingImage"),h=d.find(".js-wsbYelpReviewExcerpt"),m=d.find(".js-wsbReviewMoreLink"),b=new Date(1e3*l.time_created),f=b.getMonth()+1+"/"+b.getDate()+"/"+b.getFullYear();c.attr({src:E(l.user.image_url),alt:t.i18N.resources.User_Image}),u.html(l.user.name),p.html(f),h.html(l.excerpt),g.attr({src:E(l.rating_image_url),alt:t.i18N.resources.Rating_is.sfFormat(l.rating)}),m.attr({href:E(n.url)+"#hrid:"+l.id,title:t.i18N.resources.More}),a.append(d)}else{var v=e.find(".js-wsbYelpNoReviews");a.hide(),v.show()}}function p(e,t,n){var i,a,r,o=e.find(".js-wsbYelpMapIframe"),s=e.find(".js-wsbYelpMapLink");if(n.location.coordinate&&n.location.coordinate.latitude)i=n.location.coordinate,a=A.replace(/{name}/g,n.name),a=a.replace(/{lang}/g,t.i18N.lang),a=a.replace(/{latitude}/g,i.latitude).replace(/{longitude}/g,i.longitude),r=a+I;else{var l="";l=n.location.display_address.join(),a=A.replace(/{name}/g,l),a=a.replace(/{lang}/g,t.i18N.lang),a=a.replace(/{latitude}/g,"").replace(/{longitude}/g,"").replace(/&ll=,/g,""),r=a+I}o.attr("src",r),s.attr({href:a,title:t.i18N.resources.View_larger_map})}function g(e,t,n){var i=t.find(".js-wsbYelpWidget"),a=t.find(".js-wsbYelpError");i.hide(),a.show(),n(t)}function h(e,t){t.showPhoto?m(e):_(e),t.showDeals?b(e):w(e),t.showSubmitReviewLink?f(e):S(e),t.showReviews?v(e):k(e),t.showMap?y(e):x(e),C(e,t.maxReviews)}function m(e){var t=e.find(".js-wsbYelpLink"),n=e.find(".js-wsbYelpMainTitle");n.addClass("wsb-yelp-main-title"),t.show()}function b(e){var t=e.find(".js-wsbYelpDealsContainer"),n=e.find(".js-wsbYelpNoDealsContainer");n.hide(),t.show()}function f(e){var t=e.find(".js-wsbYelpSubmitReviewLink");t.show()}function v(e){var t=e.find(".js-wsbYelpReviewsContainer");t.show()}function y(e){var t=e.find(".js-wsbYelpMapContainer");t.show()}function _(e){var t=e.find(".js-wsbYelpLink"),n=e.find(".js-wsbYelpMainTitle");n.removeClass("wsb-yelp-main-title"),t.hide()}function w(e){var t=e.find(".js-wsbYelpDealsContainer"),n=e.find(".js-wsbYelpNoDealsContainer");t.hide(),n.show()}function S(e){var t=e.find(".js-wsbYelpSubmitReviewLink");t.hide()}function k(e){var t=e.find(".js-wsbYelpReviewsContainer");t.hide()}function x(e){var t=e.find(".js-wsbYelpMapContainer");t.hide()}function C(e,t){var n=e.find(".js-wsbYelpReview");n.hide().slice(0,t).show()}function T(e,t){if(t.isMobile)return void e.parent().css({height:"auto"});var n=e.find(".js-wsbYelpWidget"),i=e.find(".js-wsbYelpHeader"),a=e.find(".js-wsbYelpContent"),r=e.find(".js-wsbYelpFooter"),o=parseInt(n.css("padding-top"))+parseInt(n.css("padding-bottom")),s=parseInt(n.css("border-top-width"))+parseInt(n.css("border-bottom-width")),l=e.height()-o-s,d=l-i.outerHeight(!0)-r.outerHeight(!0),c=parseInt(n.css("padding-left"))+parseInt(n.css("padding-right")),u=parseInt(n.css("border-left-width"))+parseInt(n.css("border-right-width")),p=e.width()-c-u;n.css({height:l,width:p}),a.css({height:d,overflow:"auto"})}function E(e){var t=document.createElement("a");t.href=e;var n=t.hostname,i=t.pathname,a=t.search;return i=0!=i.indexOf("/")?"/"+i:i,"//"+n+i+a}function P(e,t){var n=this;n.container=e,n.viewPath=t.viewPath,n.settings=t.settings,n.onRenderComplete=t.settings.onRenderComplete,n.render=function(e){a(n.container,n.viewPath,e)},n.photo={show:function(){m(e)},hide:function(){_(e)}},n.deals={show:function(){b(e)},hide:function(){w(e)}},n.submitReviewLink={show:function(){f(e)},hide:function(){S(e)}},n.reviews={show:function(){v(e)},hide:function(){k(e)},showMaxReviews:function(t){C(e,t)}},n.map={show:function(){y(e)},hide:function(){x(e)}},n.fitToContainer=function(){T(e,t.settings)},n.render(n.settings)}var D=null,I="&iwloc=near&output=embed",A="//maps.google.com/maps?v=2&hl={lang}&q={name}&ll={latitude},{longitude}&z=14";return{init:n,destroy:i,populateMap:p}}),define("designer/app/builder/ui/controls/yelp/yelpData",["jquery","common/persistence/persistence"],function(e,t){function n(){r="/api/websites/{websiteId}/yelp/"}function i(e,n,i,a){var o=r+"search?query="+e+"&location="+n;t.Get(o,i,a)}function a(e,n,i){var a=r+"getBusiness?businessId="+e,o=function(e){n({business:e})};t.Get(a,o,i)}var r,o=function(e){return n(e),{apiBaseUrl:r,getBusinesses:i,getBusinessById:a}};return o}),define("designer/social/yelp/yelpData",["jquery","common/persistence/persistence"],function(e,t){function n(){r="/api/websites/{websiteId}/yelp/"}function i(e,n,i,a){var o=r+"search?query="+e+"&location="+n;t.Get(o,i,a)}function a(e,n,i){var a=r+"getBusiness?businessId="+e,o=function(e){n({business:e})};t.Get(a,o,i)}var r,o=function(e){return n(e),{apiBaseUrl:r,getBusinesses:i,getBusinessById:a}};return o}),define("text!designer/app/builder/ui/controls/yelp/yelplistingsearch.html",[],function(){return'\r\n<!-- yelp listing search -->\r\n<div id="yelpListingSearch" class="wsb-yelp-listing-search" style="display:none; width: 550px;">\r\n    <div class="wsb-required wsb-modal-required-label">* <span data-bind="text: i18Dict.Server__Required_fields"></span></div>\r\n\r\n    <div class="clearfix">\r\n        <div class="wsb-yelp-business-name-input clearfix">\r\n            <label class="wsb-block-label"><span data-bind="text: i18Dict.Server__Business_name_colon"></span> <span class="wsb-required">*</span></label>\r\n            <input id="wsbYelpSearch-name" type="text" class="wsb-text-box" data-bind="\r\n    value: Name,\r\n    valueUpdate: \'afterkeydown\',\r\n    event: { keypress: OnKeyWasPressedBusinessName, change: ValidateBusinessName() }"  />\r\n            <label id="yelpBusinessNameError" class="wsb-theme-setup-error text-error" data-bind="text: i18Dict.Server__Enter_business_name"></label>\r\n        </div>\r\n\r\n        <div class="wsb-yelp-business-address-input">\r\n            <label class="wsb-block-label"><span data-bind="text: i18Dict.Server__Address_colon"></span> <span  class="wsb-required">*</span></label>\r\n            <input id="wsbYelpSearch-address" data-aid="wsbYelpSearch-address" class="wsb-text-box" type="text" data-bind="\r\n    value: Address,\r\n    placesAutocomplete: true,\r\n    valueUpdate: \'afterkeydown\',\r\n    event: { keypress: OnKeyWasPressedAddress, change: ValidateAddress() }"  />\r\n            <label id="yelpLocationError" class="wsb-theme-setup-error text-error" data-bind="text: i18Dict.Enter_a_location"></label>\r\n        </div>\r\n\r\n        <div class="wsb-yelp-business-search">\r\n            <a id="searchYelpListings" data-aid="wsbYelpSearch-search" href="#" data-bind="click: SearchYelp" class="btn btn-inverse-grey clearfix"><i class="icon-white icon-search"></i><span data-bind="text: i18Dict.Server__Search"></span></a>\r\n        </div> \r\n    </div> \r\n    \r\n    <ul data-aid="wsbYelpSearch-results" class="wsb-yelp-business-picker" data-bind="foreach: BusinessSearchResults" style="clear:both;">\r\n        <li class="wsb-yelp-business-picker-item" data-bind="css: { \'wsb-business-picker-item-selected\': $parent.BusinessId() === id }, attr: { title: id }, clickBubble: true, click: $parent.selectBusiness">\r\n            <dl>\r\n                <dt data-bind="html: name"></dt>\r\n                <dd data-bind="text: location.address + \' \' + location.city + \', \' + location.state_code + \' \' + location.postal_code"></dd>\r\n            </dl>\r\n        </li>  \r\n    </ul>\r\n    \r\n    <div class="wsb-yelp-loading" data-bind="visible: Searching"></div>\r\n    <div class="wsb-yelp-status-message" data-bind="text: StatusMessage, visible: StatusMessage !== undefined"></div>\r\n\r\n    <a data-aid="wsbYelpSearch-create" href="#" id="createListing22" data-bind="click: createListing, text: i18Dict.Server__Create_a_yelp_listing" target="_blank" class="wsb-yelp-change-listing"></a>\r\n</div>\r\n'}),define("designer/app/builder/ui/controls/yelp/yelpListingSearch",["jquery","knockout","userData","common/stats/googleanalytics","designer/social/yelp/yelpData","appconfig","common/logger/logger","/i18n/resources/client","designer/app/app","text!designer/app/builder/ui/controls/yelp/yelplistingsearch.html"],function(e,t,n,i,a,r,o,s,l,d){function c(){k(s.resources.Client__Designer__Searching_through_listings),x(!0),i.trackEvent("yelp_settings","search_listing ","button"),f.getBusinesses(_(),w(),function(e){S(e.businesses),x(!1),b(void 0),void 0===e.businesses||0===e.businesses.length?(k(s.resources.Client__No_listings_found),g(!1)):(g(!1),k(void 0))
},function(){x(!1)})}function u(){function t(){i.trackEvent("yelp_settings","create_listing ","link"),window.open(r.yelpCustomerSetupUrl,"_blank")}function n(t){return t.keyCode==e.ui.keyCode.ENTER&&c(),!0}function a(t){return t.keyCode==e.ui.keyCode.ENTER&&c(),!0}function o(){w().length?(e("#yelpLocationError").hide(),e("#wsbYelpSearch-address").removeClass("input-validation-error")):(e("#yelpLocationError").show(),e("#wsbYelpSearch-address").addClass("input-validation-error"))}function l(){_().length?(e("#yelpBusinessNameError").hide(),e("#wsbYelpSearch-name").removeClass("input-validation-error")):(e("#yelpBusinessNameError").show(),e("#wsbYelpSearch-name").addClass("input-validation-error"))}function d(e){b(e.id),v(e),g(!0)}return{BusinessSearchResults:S,Address:w,Name:_,BusinessId:b,YelpBusiness:v,createListing:t,OnKeyWasPressedBusinessName:a,OnKeyWasPressedAddress:n,SearchYelp:c,selectBusiness:d,StatusMessage:k,Searching:x,ValidateAddress:o,ValidateBusinessName:l,i18Dict:{Server__Required_fields:s.resources.Server__Required_fields,Server__Business_name_colon:s.resources.Server__Business_name_colon,Server__Enter_business_name:s.resources.Server__Enter_business_name,Enter_a_location:s.resources.Enter_a_location,Server__Search:s.resources.Server__Search,Server__Create_a_yelp_listing:s.resources.Server__Create_a_yelp_listing,Server__Address_colon:s.resources.Server__Address_colon}}}function p(n){if(!y){n=n||e("body"),l.addControl(d,l.currentApp,"yelpListingSearch");var i=n.find("#yelpListingSearch")[0];return t.cleanNode(i),m=new u,t.applyBindings(m,i),y=!0,m}}function g(t){try{var n=e("#yelpListingSearch");t?n.wsbDialog("enableButton","ok"):n.wsbDialog("disableButton","ok")}catch(i){o.log(i)}}function h(t,n){function a(e,t){e&&"cancel"===e.id?i.trackEvent("yelp_settings","cancel_foundlisting ","link"):t&&i.trackEvent("yelp_settings","xclose_foundlisting ","button")}function r(){i.trackEvent("yelp_settings","save_foundlisting ","button"),n(v()),o.wsbDialog("close")}_(""),w(""),S(void 0);var o=e("#yelpListingSearch");o.keypress(function(t){t.keyCode==e.ui.keyCode.ENTER&&c()}),e("#yelpBusinessNameError").hide(),e("#yelpLocationError").hide(),e("#wsbYelpSearch-name").removeClass("input-validation-error"),e("#wsbYelpSearch-address").removeClass("input-validation-error"),o.wsbDialog({title:s.resources.Client__Designer__Find_Your_Listing,draggable:!1,autoResize:!0,buttons:[{id:"ok",text:s.resources.OK,onClick:r},{id:"cancel",text:s.resources.Cancel,cancel:!0,style:"link"}],onCancel:a,onOpen:function(){g(!1)}})}var m,b=t.observable(""),f=a(),v=t.observable(void 0),y=!1,_=t.observable(""),w=t.observable(""),S=t.observableArray(void 0),k=t.observable(""),x=t.observable(!1);return{init:p,open:h,createViewModel:function(){return new u}}}),define("designer/app/builder/ui/canvas/elements/yelp/el.yelp",["text!designer/app/builder/ui/canvas/elements/yelp/el.yelp.html","text!designer/app/builder/ui/canvas/elements/yelp/mutator.yelp.html","jquery","knockout","designer/app/builder/ui/canvas/elements/helper","common/logger/logger","appconfig","designer/app/builder/data/data","userData","common/stats/googleanalytics","designer/social/yelp/social.yelp","designer/app/builder/ui/controls/yelp/yelpData","designer/app/builder/ui/controls/yelp/yelpListingSearch","/i18n/resources/client","wsbcore/overlay","common/geo/placesAutocomplete"],function(e,t,n,i,a,r,o,s,l,d,c,u,p,g){function h(){var e=this;e.Title=g.resources.Yelp,e.SettingsTitle=g.resources.Yelp_Settings;var t;e.minWidth=e.Width.Min(),e.minHeight=e.Height.Min(),e.YelpBusiness=i.observable(void 0),e.visibleOverlay=i.observable(""),e.listings=i.observableArray(),e.napsoc={name:x.observables().Name,address:x.observables().Address},e.afterRender=function(i){t=b(e),n.isFunction(i)&&i(e)},e.listingsOverlayOnMousedown=function(e,t){t.stopPropagation()},e.state.subscribe(function(){Boolean(e.state().match(/^resize/i))&&""===e.YelpBusinessId()&&e.state(e.stateMap.move)}),e.sizeChanged=i.computed(function(){e.Height(),e.Width(),t&&t.fitToContainer()}).extend({throttle:{type:"throttle",delay:k}}),e.napsocChanged=i.computed(function(){e.napsoc.name(),e.napsoc.address(),""===e.YelpBusinessId()&&f(e,t)}).extend({throttle:{type:"debounce",delay:500}}),e.YelpBusinessId.subscribe(function(){f(e,t)}),e.YelpShowPhoto.subscribe(function(e){e?t.photo.show():t.photo.hide(),d.trackEvent("yelp_settings","profilephoto_"+(e?"on":"off"),"checkbox")}),e.YelpShowDeals.subscribe(function(e){e?t.deals.show():t.deals.hide(),d.trackEvent("yelp_settings","deals_"+(e?"on":"off"),"checkbox")}),e.YelpShowSubmitReviewLink.subscribe(function(e){e?t.submitReviewLink.show():t.submitReviewLink.hide(),t.fitToContainer(),d.trackEvent("yelp_settings","submit_reviews_"+(e?"on":"off"),"checkbox")}),e.YelpShowReviews.subscribe(function(n){n?t.reviews.show():t.reviews.hide(),d.trackEvent("yelp_settings","show_reviews",""+e.YelpMaxReviews())}),e.YelpShowMap.subscribe(function(e){e?t.map.show():t.map.hide(),t.fitToContainer(),d.trackEvent("yelp_settings","map_"+(e?"on":"off"),"checkbox")}),e.YelpMaxReviews.subscribe(function(e){t.reviews.showMaxReviews(e)}),e.selectListing=function(t){d.trackEvent("yelp_settings","select_listing","button"),e.YelpBusinessId(t.id),e.YelpBusiness(t)},e.findListing=function(t,i){var a=n(i.currentTarget).attr("id");"listingsFind"===a?d.trackEvent("yelp_settings","i_dont_see_it","button"):"noListingsFind"===a?d.trackEvent("yelp_settings","have_one","button"):"propFindListing"===a?d.trackEvent("yelp_settings","findmy_listing","button"):"propChangeListing"===a&&d.trackEvent("yelp_settings","change_listing","button"),p.open(e,function(t){e.YelpBusinessId(t.id),e.YelpBusiness(t)})},e.createListing=function(e,t){var i=n(t.currentTarget).attr("id");"listingsCreate"===i?d.trackEvent("yelp_settings","create_one","button"):"noListingsCreate"===i?d.trackEvent("yelp_settings","dont_haveone","button"):"propCreateListing"===i&&d.trackEvent("yelp_settings","create_one","button"),window.open(o.yelpCustomerSetupUrl,"_blank")},e.dblClick=function(){e.isLocalizedThemeMode()||e.showProperties()},e.mutatorViewModel=new m(e),e.i18NDict={Server__Which_one_is_you:g.resources.Server__Which_one_is_you,Server__Looks_like_we_found_a_couple_listings:g.resources.Server__Looks_like_we_found_a_couple_listings,Server__Please_select_your_listing_colon:g.resources.Server__Please_select_your_listing_colon,Server__I_dont_see_it:g.resources.Server__I_dont_see_it,Server__Create_one:g.resources.Server__Create_one,Server__I_have_one_lets_find_it:g.resources.Server__I_have_one_lets_find_it,Server__I_dont_have_one_yet:g.resources.Server__I_dont_have_one_yet,Server__Hmm_we_couldnt_find_you:g.resources.Server__Hmm_we_couldnt_find_you,Server__Looks_like_we_couldnt_find_your_listing:g.resources.Server__Looks_like_we_couldnt_find_your_listing}}function m(e){this.i18Dict={ListingsColon:g.resources.Server__Listings_colon,FindMyListing:g.resources.Server__Find_my_listing,CreateOne:g.resources.Server__Create_one,Change:g.resources.Change,ReviewsColon:g.resources.Server__Reviews_colon,ShowReviews:g.resources.Server__Show_reviews,ShowLinkToSubmitNewReviews:g.resources.Server__Show_link_to_submit_new_reviews,ShowColon:g.resources.Server__Show_colon,ProfilePhoto:g.resources.Server__Profile_photo,Deals:g.resources.Server__Deals,Map:g.resources.Server__Map};var t=this;t.YelpBusinessId=e.YelpBusinessId,t.YelpShowSubmitReviewLink=e.YelpShowSubmitReviewLink,t.YelpShowReviews=e.YelpShowReviews,t.YelpMaxReviews=e.YelpMaxReviews,t.YelpShowPhoto=e.YelpShowPhoto,t.YelpShowDeals=e.YelpShowDeals,t.YelpShowMap=e.YelpShowMap,t.YelpBusiness=e.YelpBusiness,t.YelpListingChooser=e.findListing,t.YelpCustomerSetupUrl=e.createListing,t.YelpBusinessName=i.computed(function(){var t=e.YelpBusiness(),n="";return t&&t.name&&(n=t.name),n}),t.YelpBusinessLocation=i.computed(function(){var t=e.YelpBusiness(),n="";return t&&t.location&&(n=t.location.display_address.join("<br/>")),n}),t.hasListing=i.computed(function(){return e.YelpBusinessId().length>0})}function b(e){var t=n("#"+e.ID()),i=t.find(".js-wsbYelp");return t.sfMsgOverlay({message:g.resources.Loading}),p.init(),c.init(i,{viewPath:w,settings:{isMobile:!1,isHosted:!1,apiBaseUrl:_,businessId:e.YelpBusinessId(),showSubmitReviewLink:e.YelpShowSubmitReviewLink(),showReviews:e.YelpShowReviews(),maxReviews:e.YelpMaxReviews(),showPhoto:e.YelpShowPhoto(),showDeals:e.YelpShowDeals(),showMap:e.YelpShowMap(),onRenderComplete:function(){v(e)},getBusinessCallback:function(t){e.YelpBusiness(t)},i18N:g}})}function f(e,t){var i=n("#"+e.ID());t&&(i.sfMsgOverlay({message:g.resources.Loading}),t.render({isMobile:!1,isHosted:!1,apiBaseUrl:_,businessId:e.YelpBusinessId(),showSubmitReviewLink:e.YelpShowSubmitReviewLink(),showReviews:e.YelpShowReviews(),maxReviews:e.YelpMaxReviews(),showPhoto:e.YelpShowPhoto(),showDeals:e.YelpShowDeals(),showMap:e.YelpShowMap(),onRenderComplete:function(){v(e)},i18N:g}))}function v(e){var t=n("#"+e.ID());""!==e.YelpBusinessId()?(e.visibleOverlay("default"),t.sfMsgOverlay({message:null})):S.getBusinesses(e.napsoc.name(),e.napsoc.address(),function(n){if(n&&n.total&&n.total>0){var i=n.businesses,a=n.total<=5?n.total:5;i=i.slice(0,a),e.listings(i),e.visibleOverlay("multiple-listings")}else e.visibleOverlay("no-listings");t.sfMsgOverlay({message:null})},function(){e.visibleOverlay("no-listings"),t.sfMsgOverlay({message:null})})}var y="yelp",_="/api/websites/{websiteId}/yelp/getBusiness".replace("{websiteId}",l.websiteId),w="/socialmediatemplates/yelp",S=u(),k=17;_+="?locale="+g.locale;var x;return{name:y,initModel:function(e,t){e.YelpBusinessId=e.YelpBusinessId||"",e.YelpShowSubmitReviewLink=void 0!==e.YelpShowSubmitReviewLink?e.YelpShowSubmitReviewLink:!0,e.YelpShowReviews=void 0!==e.YelpShowReviews?e.YelpShowReviews:!0,e.YelpShowPhoto=void 0!==e.YelpShowPhoto?e.YelpShowPhoto:!0,e.YelpShowDeals=void 0!==e.YelpShowDeals?e.YelpShowDeals:!0,e.YelpShowMap=void 0!==e.YelpShowMap?e.YelpShowMap:!0,e.YelpMaxReviews=a.coerceNumericValue(e,e.YelpMaxReviews,i.unwrap(e.YelpMaxReviews),{defaultValue:3}),t&&(e.Width="500px",e.Height="650px")},createElementViewModel:function(e,t){h.prototype=new e(t),h.prototype.constructor=h;var n=new h;return n},load:function(n,i){x=s.getDataModel().napsoc,n.append(e).append(t),i(null,"yelp")}}}),define("text!designer/app/builder/ui/canvas/elements/form/el.form.html",[],function(){return'<script type="text/html" id="wsb-canvas-template-form">\r\n    <div class="wsb-form-shield"></div>\r\n	<div data-widget-content="true" data-bind="attr: { style: Style, \'class\': \'form \' + CssClasses() } ">\r\n		<div class="form-row">\r\n			<label class="form-label"><span data-bind="text: labels.name"></span> <span class="form-req">*</span></label>\r\n			<input type="text" class="form-value" />\r\n		</div>\r\n		<div class="form-row">\r\n			<label class="form-label"><span data-bind="text: labels.email"></span> <span class="form-req">*</span></label>\r\n			<input type="text" class="form-value" />\r\n            <label class="form-label opt-in-label"><input type="checkbox" data-bind="visible: showOptIn" class="opt-in opt-in-checkbox" /><span class="opt-in" data-bind="text: labels.optin, visible: showOptIn"></span></label>\r\n        </div>\r\n		<div class="form-row">\r\n			<label class="form-label"><span data-bind="text: labels.subject"></span> <span class="form-req">*</span></label>\r\n			<input type="text" class="form-value" />\r\n		</div>\r\n		<div class="form-row">\r\n			<label class="form-label"><span data-bind="text: labels.message"></span> <span class="form-req">*</span></label>\r\n			<textarea class="form-value"></textarea>\r\n		</div>\r\n		<div class="form-row">\r\n			<input type="submit" data-bind="attr: { value: labels.submit }" class="form-submit" onclick="return false;" />\r\n		</div>\r\n	</div>\r\n</script>\r\n\r\n'}),define("text!designer/app/builder/ui/canvas/elements/form/mutator.form.html",[],function(){return'<script type="text/html" id ="mutator-template-element-form">\r\n\r\n<!-- ko if: Type() === \'form\' -->\r\n<!-- ko with: mutatorViewModel -->\r\n<div class="wsb-canvas-mutator-inner">\r\n    \r\n    <!-- ko if: isShowUpgradeOption -->\r\n   \r\n       <div class="wsb-canvas-mutator-ctrl-outer clearfix">\r\n           <div>\r\n               <span data-bind= "text: i18Dict.CustomformWhyUpgrade"></span>\r\n               <a href="#" data-bind="click: onUpgradeAccountClick, text: i18Dict.LearnMore" class="sf-dialog-link"></a>\r\n           </div>\r\n         \r\n       </div>\r\n   \r\n    <!-- /ko -->\r\n\r\n\r\n    <div data-bind="mutatorElement: {\r\n        name: \'picker\',\r\n        data: emailAddress,\r\n        context: {\r\n            title: i18Dict.EmailToColon,\r\n            isPlaceholder: hasEmailPlaceholder,\r\n            placeholderText: emailPlaceholderText,\r\n            placeholderCssClass: \'wsb-napsoc-placeholder\',\r\n            placeholderTooltip: napsocEmailAddress,\r\n            flyoutTemplate: \'email-picker-template\',\r\n            flyoutModel: $data\r\n        }\r\n    }"></div>\r\n\r\n    <!-- ko if: showOptIn -->\r\n    <div class="wsb-canvas-mutator-ctrl-outer clearfix">\r\n        <div class="wsb-canvas-mutator-ctrl-label wsb-form-finished-label" data-bind="text: i18Dict.CollectEmailsColon"></div>\r\n        <div class="wsb-canvas-mutator-ctrl-input wsb-form-finished-property clearfix">\r\n            <label class="checkbox">\r\n                <input type="checkbox" class="checkbox" name="GemSubmitOption"\r\n                       data-bind="checked: gemSubmit" />\r\n                <span data-bind="text: i18Dict.NoteAllEmails"></span>\r\n            </label>\r\n        </div>\r\n    </div>\r\n    <!-- /ko -->\r\n\r\n    <div class="wsb-canvas-mutator-ctrl-outer clearfix">\r\n        <div class="wsb-canvas-mutator-ctrl-label wsb-form-finished-label" data-bind= "text: i18Dict.WhenFinishedColon"></div>\r\n        <div class="wsb-canvas-mutator-ctrl-input wsb-form-finished-property clearfix">\r\n            <label class="radio">\r\n                <input \r\n                    type="radio" \r\n                    name="PostSubmitOption" \r\n                    data-bind="value: postSubmitOptions.showMessage, checked: PostSubmitOption">\r\n                    <span data-bind="text: i18Dict.DisplayText"></span>\r\n            </label>\r\n             <!-- ko if: showPostSubmitMessage -->\r\n            <textarea data-bind="value: PostSubmitMessage, valueUpdate:\'input\'" class="wsb-textarea" maxlength="1000"></textarea>\r\n            <!-- /ko -->\r\n            <label class="radio">\r\n                <input \r\n                    type="radio" \r\n                    name="PostSubmitOption" \r\n                    data-bind="value: postSubmitOptions.redirect, checked: PostSubmitOption">\r\n                    <span data-bind="text: i18Dict.SendToWebPage"></span>\r\n            </label>\r\n           \r\n            <!-- ko if: showRedirectUrl -->\r\n                <input data-bind="urlPicker: { url: redirectUrl, pages: $parent.pages, disableUpload: true, validate: validate, isValid: urlIsValid, validationMessage: validationMessage, showError: showError }" class="wsb-redo-select" />\r\n            <!-- /ko -->\r\n        </div>\r\n    </div>\r\n</div>\r\n<!-- /ko -->\r\n<!-- /ko -->\r\n</script>'}),define("text!designer/app/builder/ui/controls/form/formhint.html",[],function(){return'<div id="form-hint-anchor" style="height: 0; position: absolute; z-index: 99999999;"\r\n        data-bind="style: { top: top() + \'px\', left: left() + \'px\', width: width() + \'px\' },\r\n    contextFlyout: {\r\n        template: \'form-hint-template\',\r\n        position: position,\r\n        dismissOtherFlyouts: false,\r\n        isOpen: showMenuHintFlyout,\r\n        cssClass: \'wsb-form-hint-container\'\r\n    }">\r\n</div>\r\n\r\n<script type="text/html" id="form-hint-template">\r\n    <div class="wsb-form-hint">\r\n        <!-- ko if: showWhyUpgrade -->\r\n        <p data-bind="text: i18Dict[\'Server__customform_why_upgrade\']"></p>\r\n        <!-- /ko -->\r\n        <!-- ko if: showUpgradeBenefits -->\r\n        <p>@Html.Raw(Strings.Server__form_upgrade_add_field)</p>\r\n        <!-- /ko -->\r\n        <a href="#" data-bind="click: okClicked, text: i18Dict[\'Server__Learn_more\']" class="btn btn-success"></a>\r\n        <a href="#" data-bind="click: close, text: i18Dict[\'No_Thanks\']" class="sf-dialog-link"></a>\r\n        <!-- ko if: showWhyUpgrade -->\r\n        <label class="checkbox" data-bind="text: i18Dict[\'Server__Dont_show_again\']">\r\n            <input type="checkbox" data-bind="checked: dontShowCheckboxChecked" /> \r\n        </label>\r\n        <!-- /ko -->\r\n    </div>\r\n</script>'}),define("designer/app/builder/ui/controls/form/hint",["jquery","knockout","common/stats/googleanalytics","websiteSettings","wsbcore/context","common/persistence/persistence","common/inAppPurchase/inAppPurchase","designer/app/app","text!designer/app/builder/ui/controls/form/formhint.html","/i18n/resources/client"],function(e,t,n,i,a,r,o,s,l,d){function c(){var n=this,i=(s.getMap(),function(){t.cleanNode(p[0]),t.applyBindings(u,p[0])}),a=function(){var e=n.dontShowCheckboxChecked();e&&r.Post("/api/websites/{websiteId}/websitesettings",{showMenuFlyout:(new Date).toISOString()})};n.showWhyUpgrade=t.observable(!0),n.showUpgradeBenefits=t.observable(!1),n.left=t.observable(0),n.top=t.observable(0),n.width=t.observable(0),n.position=t.observable("lc"),n.dontShowCheckboxChecked=t.observable(!1),n.showMenuHintFlyout=t.observable(!1),n.i18Dict=d.resources,n.isOpen=function(){return n.showMenuHintFlyout()},n.open=function(){var t=e("#wsb-canvas-actionmenu"),a=t.offset(),r=t.width(),o=t.height(),s=a.top>200,l=s?"lc":"uc";l!=n.position()&&(n.position(l),i()),n.left(a.left),n.top(s?a.top:a.top+o),n.width(r),n.showMenuHintFlyout(!0)},n.okClicked=function(){n.close(),o.ShowUpgradeDialog({clientTrackingId:"wsb-contact-form-upgrade-button",clientTrackingValue:"custom_form"})},n.close=function(){n.showMenuHintFlyout(!1),a()}}var u,p,g,p,g,h=!1,m=!!i.showMenuFlyout,b=function(){return!!u},f=function(){if(!b){if(s.addControl(l,s.currentApp,"form-hint-anchor"),s.addControl(l,s.currentApp,"form-hint-template"),p=e("#form-hint-anchor"),h=1==p.length,!h)return;g=e("#form-hint-template"),u=new c,t.applyBindings(u,p[0])}};return{initModule:f,open:function(e){h&&u&&(m||e)&&(u.showWhyUpgrade(!e),u.showUpgradeBenefits(e),u.open())},close:function(){h&&u&&u.close()},isOpen:function(){return h&&u?u.isOpen():!1}}}),define("designer/app/builder/ui/canvas/elements/form/el.form",["text!designer/app/builder/ui/canvas/elements/form/el.form.html","text!designer/app/builder/ui/canvas/elements/form/mutator.form.html","designer/app/builder/managers/elementManager","designer/app/builder/managers/themeManager","knockout","common/stats/googleanalytics","jquery","designer/app/builder/ui/canvas/elements/helper","designer/app/builder/data/data","designer/app/builder/ui/controls/mutator/mutator","websiteInfo","common/regexhelper/regexhelper","/i18n/resources/client","common/inAppPurchase/inAppPurchase","designer/app/builder/ui/canvas/elements/customform/customFormModel","common/abTesting/abTesting","common/persistence/persistence","designer/app/builder/ui/controls/form/hint","userData","common/ui/flyout","libs/knockout/ko.observables"],function(e,t,n,i,a,r,o,s,l,d,c,u,p,g,h,m,b,f,v){function y(){function e(){r.trackEvent("form_settings","upgrade_tocustom","button"),P.collect("upgrade form");var e={Type:"customform"},i=0;o("#"+t.ID()).find(".form-row").each(function(){i+=o(this).outerHeight(!0)}),t.pixelHeight(i),_.each(["EmailAddress","PostSubmitOption","PostSubmitMessage","PostSubmitRedirectUrl","Top","Left","Width","Height"],function(n){e[n]=t[n]()}),t.isDeleted(!0);var a=n.addNewElementToCanvas(e),s=n.getElementViewModel(a.id()),l={left:t.pixelLeft(),top:t.pixelTop()};return s.updateChildElements(!0,l),P.enable("upgrade form"),s}var t=this;this.Title=p.resources.Form,this.SettingsTitle=p.resources.Form_Settings,this.UrlKeyPressed=!1,t.labels={name:S("ContactForm_NameLabel"),email:S("ContactForm_EmailAddressLabel"),subject:S("ContactForm_SubjectLabel"),message:S("ContactForm_MessageLabel"),submit:S("ContactForm_SubmitButtonCaption"),optin:S("ContactForm_OptInLabel")},t.emailAddress=t.EmailAddress.trimmed().extend({validation:{custom:[{message:p.resources.Client__Designer__Enter_a_valid_email_address,test:function(e){return e&&e.length}},{message:p.resources.Client__Designer__Enter_a_valid_email_address,test:function(e){return e!=C&&e.length>0?e===C||u.validateEmailAddress(e):!0}}]}}),t.hasEmailPlaceholder=a.computed(function(){return t.emailAddress()===C}),t.napsocEmailAddress=k.observables().Email,t.emailPlaceholderText=a.computed(function(){return p.resources.Client__Designer__My_email+": "+(t.napsocEmailAddress()||p.resources.Client__Designer__Not_set)}),t.useEmailPlaceholder=function(){t.emailAddress(C)},t.onUpgradeAccountClick=function(){E?e():(g.ShowUpgradeDialog({clientTrackingId:"wsb-contact-form-upgrade-button",clientTrackingValue:"custom_form"}),d.hide())},t.showPostSubmitMessage=a.computed(function(){return t.PostSubmitOption()==T.showMessage}),t.showRedirectUrl=a.computed(function(){return t.PostSubmitOption()==T.redirect}),t.redirectUrl=t.PostSubmitRedirectUrl.trimmed().extend({validation:{custom:[{message:p.resources.Enter_a_valid_URL_or_select_page,test:function(e){return t.UrlKeyPressed?e&&e.length:!0}},{message:p.resources.Enter_a_valid_URL_or_select_page,test:function(e){var n=o.trim(e);if(n.length>0||t.UrlKeyPressed){var i=/^file:([0-9]+)$/i;return t.UrlKeyPressed=!0,i.test(e)?!1:u.validateUrl(n)}return!0}}]}}),t.postSubmitOptions=T,t.dblClick=function(){if(!t.isLocalizedThemeMode())if(E){var n=e();n.getCommands().editProperties.click()}else t.showProperties();return!1},t.editForm=t.dblClick,t.editProperties={text:p.resources.Settings,tip:p.resources.Settings,cssClass:"wsb-tool-Settings",click:function(){return t.editForm(),!1}};var i=v.isApiReseller&&c.Account.AccountType===c.accountTypes.personal;i||(t.addField={text:p.resources.Client__Designer__Element_Add_Element,tip:p.resources.Add,cssClass:"wsb-tool-Add-Element",click:function(){if(E){t.hideActionMenu();var n=e();n.addElement()}else g.ShowUpgradeDialog({clientTrackingId:"wsb-contact-form-upgrade-button",clientTrackingValue:"custom_form"})}}),t.getActionMenuItems=a.computed(function(){var e=t.getCommands(),n=[t.editProperties,e.clone,e["delete"],e.layoutCommands];return i||n.unshift(t.addField),n}),t.urlIsValid=a.observable(!0),t.gemSubmit=t.FormGemSubmit,t.isValid=a.computed(function(){if(t.emailAddress()&&0===t.emailAddress().length||!t.emailAddress.isValid())return!1;var e=t.PostSubmitOption();return 0==e&&0===o.trim(t.PostSubmitMessage()).length?!1:1!=e||0!==t.PostSubmitRedirectUrl().length&&t.redirectUrl.isValid()?!0:!1}),t.validate=!1,t.isValid.subscribe(function(e){d[e?"enableButton":"disableButton"](0)}),t.validationMessage=a.observable(""),t.showError=a.observable(!0),t.mutatorViewModel=new w(t),t.onAfterShowMenu=function(){setTimeout(function(){f.open(!1)},500)},t.onAfterHideMenu=function(){f.isOpen()&&f.close()},t.showOptIn=a.computed(function(){return t.FormGemSubmit()&&!v.isReseller})}function w(e){return e.i18Dict={CustomformWhyUpgrade:p.resources.Server__customform_why_upgrade,LearnMore:p.resources.Server__Learn_more,WhenFinishedColon:p.resources.Server__When_finished_colon,DisplayText:p.resources.Server__Display_text,SendToWebPage:p.resources.Server__Send_to_web_page,EmailToColon:p.resources.Server__Email_to_colon,CollectEmailsColon:p.resources.Server__Collect_emails_colon,NoteAllEmails:p.resources.Server__Note_all_emails},e.isShowUpgradeOption=c.Account.AccountType==c.accountTypes.personal&&!v.isApiReseller&&"enabled"===m.getOption("customForm"),e}function S(e){return a.computed(function(){var t=i.themeLocale();if(t){t in D||(D[t]=a.observable());var n=D[t]();if(n)return n[e];t in I||(I[t]=b.Get("/api/formLabels?locale="+t).then(function(e){D[t](e)}))}return p.resources[e]})}var k,x="form",C="[EMAIL_ADDRESS]",T={showMessage:0,redirect:1},E=c.Account.AccountType!==c.accountTypes.personal&&!v.isApiReseller&&"enabled"===m.getOption("customForm"),P=l.undoer,D={},I={};return{name:x,initModel:function(e,t){function n(t,n){return s.coerceNumericValue(e,e[t],a.unwrap(e[t]),{defaultValue:n})}f.initModule(e),e.EmailAddress=e.EmailAddress||C,e.PostSubmitOption=n("PostSubmitOption",T.showMessage),e.PostSubmitPageId=n("PostSubmitPageId",null)||null,e.FormGemSubmit=void 0!==e.FormGemSubmit?e.FormGemSubmit:!0,e.PostSubmitMessage=e.PostSubmitMessage||p.resources.Client__Designer__Thank_you_for_contacting_us,e.PostSubmitRedirectUrl=e.PostSubmitRedirectUrl||"",e.FormName=e.FormName||x+"-"+parseInt(1e6*Math.random()),t&&(e.Width="260px",e.Height="360px")},createElementViewModel:function(e,t){return y.prototype=new e(t),y.prototype.constructor=y,new y},load:function(n,i){k=l.getDataModel().napsoc,n.append(e).append(t),i(null,x)}}}),define("text!designer/app/builder/ui/canvas/elements/customform/el.customform.html",[],function(){return'<script type="text/html" id="wsb-canvas-template-customform">\r\n    <div data-bind="style: {width: Width}" class="customform form">\r\n        <div class="form-row form-row-designer-override">\r\n\r\n            <!-- ko if:isLeftOrientation -->\r\n            <table>\r\n                <tr>\r\n                    <!-- ko ifnot: isButton  -->\r\n                    <td class="customform_left_label">\r\n                        <div class="customform_label adjacent">\r\n                            <div class="form-label" style="display: inline" data-bind="\r\n                                css: { customform_editlabel: isLabelEditable },\r\n                                text: formLabel">\r\n                            </div>\r\n                            <span class="form-req" data-bind="visible: isRequired">*</span>\r\n                        </div>\r\n                    </td>\r\n\r\n                    <!-- /ko -->\r\n                    <td class="customform_left_fields">\r\n                        <div class="form-element" data-bind="template: { name: formTemplate(), data: $data }"></div>\r\n                    </td>\r\n                </tr>\r\n            </table>\r\n            <!-- /ko -->\r\n            <!-- ko ifnot:isLeftOrientation -->\r\n            <!-- ko ifnot: isButton  -->\r\n            <div class="customform_label above">\r\n                <div class="form-label" style="display:inline" data-bind="\r\n                    css: { customform_editlabel: isLabelEditable },\r\n                    text: formLabel">\r\n                </div>\r\n                <span class="form-req" data-bind="visible: isRequired">*</span>\r\n            </div>\r\n            <!-- /ko -->\r\n            <div class="form-element" data-bind="template: { name: formTemplate(), data: $data }"></div>\r\n            <!-- /ko -->\r\n\r\n        </div>\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="custom_form_input">\r\n    <input disabled class="form-value" type="text" data-bind="watermark: configData().placeHolderText, event: { mousedown: ignore }"/>\r\n</script>\r\n\r\n<script type="text/html" id="custom_form_paragraph">\r\n    <textarea disabled class="form-value" data-bind="watermark: configData().placeHolderText, event: { mousedown: ignore }"></textarea>\r\n</script>\r\n\r\n<script type="text/html" id="custom_form_radio">\r\n    <div data-bind="foreach: configData().items" style="width: 100%">\r\n        <div data-bind="css: { form_options_vertical: parseInt($parent.configData().orientation()) === 0, form_options_horizontal: parseInt($parent.configData().orientation()) === 1 }">\r\n            <label><input disabled type="radio" data-bind="    attr: { name: $parent.optionName() }" />\r\n            <span data-bind="text: $data" ></span></label>\r\n        </div>\r\n    </div>\r\n    <div style="clear:both"></div>\r\n</script>\r\n\r\n<script type="text/html" id="custom_form_checkbox">\r\n    <div data-bind="foreach: configData().items" style="width: 100%;">\r\n        <div data-bind="css: { form_options_vertical: parseInt($parent.configData().orientation()) === 0, form_options_horizontal: parseInt($parent.configData().orientation()) === 1 }">\r\n            <label><input disabled type="checkbox" data-bind="    attr: { name: $parent.optionName() }" />\r\n            <span data-bind="text: $data" ></span></label>\r\n        </div>\r\n    </div>\r\n    <div style="clear:both"></div>  \r\n</script>\r\n\r\n<script type="text/html" id="custom_form_dropdown">\r\n    <select disabled class="form-value" data-bind="options: configData().items, attr: { title: configData().toolTipText }"></select>\r\n</script>\r\n\r\n<script type="text/html" id="custom_form_file">\r\n    <div>        \r\n        <label class="file-upload-button" data-bind="text: configData().fileButtonText, attr: { title: configData().toolTipText }"></label>\r\n        \r\n        <div data-bind="text: configData().fileDisplayText" class="file-display-text"></div>        \r\n    </div>  \r\n</script>\r\n\r\n<script type="text/html" id="custom_form_date">\r\n    <div style="white-space: nowrap; word-spacing: -4px;">\r\n        <span data-bind="visible: configData().dateAllowDateRange() === true && parseInt(configData().dateDisplayMode()) === 0, text: i18N.FromUpperCase" class="fromto-label-left fromto-designer-override"></span>\r\n        <span class="form-value datefield" data-bind="visible: parseInt(configData().dateDisplayMode()) !== 2" >\r\n            <span class="dp-input" data-bind="text: currentDate"></span>\r\n            <span class="fake-dp-trigger"></span>\r\n        </span> \r\n        <!-- ko if: configData().dateAllowOnlyInterval -->\r\n        <select disabled class="form-value timefield timefield-designer-override" data-bind="visible: parseInt(configData().dateDisplayMode()) !== 1, css: { indent: parseInt(configData().dateDisplayMode()) !== 2 }">\r\n            <option data-bind="text: currentTime"></option>\r\n        </select>\r\n        <!-- /ko -->\r\n        <!-- ko ifnot: configData().dateAllowOnlyInterval -->\r\n        <span class="form-value timefield" data-bind="visible: parseInt(configData().dateDisplayMode()) !== 1, css: { indent: parseInt(configData().dateDisplayMode()) !== 2 }, text: currentTime" ></span>\r\n        <!-- /ko -->\r\n        <span data-bind="visible: configData().dateAllowDateRange() === true && parseInt(configData().dateDisplayMode()) !== 0">\r\n            <span class="to-label-middle" data-bind="text: i18N.ToUpperCase"></span> \r\n            <span class="form-value datefield" data-bind="visible: parseInt(configData().dateDisplayMode()) === 1">\r\n                <span class="dp-input" data-bind="text: tomorrow"></span>\r\n                <span class="fake-dp-trigger"></span>\r\n            </span>\r\n            <!-- ko if: configData().dateAllowOnlyInterval -->\r\n            <select disabled class="form-value timefield" data-bind="visible: parseInt(configData().dateDisplayMode()) === 2">\r\n                 <option data-bind="text: nextHour"></option>\r\n            </select>\r\n            <!-- /ko -->\r\n            <!-- ko ifnot: configData().dateAllowOnlyInterval -->\r\n            <span class="form-value timefield" data-bind="visible: parseInt(configData().dateDisplayMode()) === 2, text: nextHour"></span>\r\n            <!-- /ko -->\r\n        </span>         \r\n    </div>\r\n    <div data-bind="visible: configData().dateAllowDateRange() === true && parseInt(configData().dateDisplayMode()) === 0" style="white-space: nowrap; word-spacing: -4px;">\r\n        <span class="fromto-label-left multiple-datetime-line fromto-designer-override" data-bind="text: i18N.ToUpperCase"></span>\r\n        <span class="form-value datefield multiple-datetime-line">\r\n            <span class="dp-input" data-bind="text: tomorrow"></span>\r\n            <span class="fake-dp-trigger"></span>\r\n        </span>\r\n        <!-- ko if: configData().dateAllowOnlyInterval -->\r\n        <select disabled class="form-value timefield multiple-datetime-line timefield-designer-override" data-bind="css: { indent: parseInt(configData().dateDisplayMode()) !== 2 }">\r\n            <option data-bind="text: currentTime"></option>\r\n        </select>\r\n        <!-- /ko -->\r\n        <!-- ko ifnot: configData().dateAllowOnlyInterval -->\r\n        <span class="form-value timefield multiple-datetime-line" data-bind="css: { indent: parseInt(configData().dateDisplayMode()) !== 2 }, text: currentTime"></span>\r\n        <!-- /ko -->\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="custom_form_address">\r\n   <input disabled class="form-value" type="text" data-bind="watermark: configData().placeHolderText, attr: { title: configData().toolTipText }" />\r\n</script>\r\n\r\n<script type="text/html" id="custom_form_phone">\r\n    <input disabled class="form-value" type="text" data-bind="watermark: configData().placeHolderText, attr: { title: configData().toolTipText }"/>\r\n</script>\r\n\r\n<script type="text/html" id="custom_form_email">\r\n   <input disabled class="form-value" type="text"  data-bind="watermark: configData().placeHolderText, event: { mousedown: ignore }" />\r\n   <label class="form-label opt-in-label"><input type="checkbox" data-bind="visible: showOptIn" class="opt-in opt-in-checkbox" /><span data-bind="visible: showOptIn, text: i18N.Optin" class="opt-in"></span></label>\r\n</script>\r\n\r\n<script type="text/html" id="custom_form_button">\r\n    <input disabled class="form-submit" type="submit" data-bind="value: i18N.Submit, event: { mousedown: ignore }" />\r\n</script>\r\n\r\n<script type="text/html" id="customForm_save">\r\n    <div></div> \r\n</script>\r\n\r\n<script type="text/html" id="customForm_delete">\r\n    <div></div> \r\n</script>\r\n\r\n<script type="text/html" id="customForm-editor-template">\r\n    <div></div> \r\n</script>\r\n\r\n\r\n'
}),define("text!designer/app/builder/ui/canvas/elements/customform/mutator.customform.html",[],function(){return'<script type="text/html" id ="mutator-template-element-customform">\r\n<!-- ko if: Type() === \'customform\' -->\r\n<!-- ko with: mutatorViewModel -->\r\n<div class="wsb-canvas-mutator-inner"> \r\n    <!-- ko if: isPredefinedFormEnabled --> \r\n    <div data-bind="mutatorElement: { name: \'select\', data: selectedFormType, context: { title: i18N.FormTypeColon, options: formTypes, optionsText: \'name\', optionsValue: \'id\' } }"></div>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: showOptIn -->\r\n    <div class="wsb-canvas-mutator-ctrl-outer clearfix">\r\n        <div class="wsb-canvas-mutator-ctrl-label wsb-form-finished-label" data-bind="text: i18N.CollectEmailsColon"></div>\r\n        <div class="wsb-canvas-mutator-ctrl-input wsb-form-finished-property clearfix">\r\n            <label class="checkbox">\r\n                <input type="checkbox" class="checkbox" name="GemSubmitOption"\r\n                       data-bind="checked: gemSubmit" />\r\n                <span data-bind="text: i18Dict.NoteAllEmails"></span>\r\n            </label>\r\n        </div>\r\n    </div>\r\n    <!-- /ko -->\r\n\r\n    <div data-bind="mutatorElement: { name: \'toggle\', data: selectedLabelOrientationName, context: { title: i18N.LabelLayoutColon, options: labelOrientationsNames, click: chooseOrientation } }"></div>\r\n \r\n    <div data-bind="mutatorElement: {\r\n    name: \'picker\',\r\n    data: emailAddress,\r\n    context: {\r\n        title: i18N.EmailToColon,\r\n        isPlaceholder: hasEmailPlaceholder,\r\n        placeholderText: emailPlaceholderText,\r\n        placeholderCssClass: \'wsb-napsoc-placeholder\',\r\n        placeholderTooltip: napsocEmailAddress,\r\n        flyoutTemplate: \'email-picker-template\',\r\n        flyoutModel: $data\r\n    }\r\n}">\r\n    </div>\r\n\r\n    <div class="wsb-canvas-mutator-ctrl-outer clearfix">\r\n        <div class="wsb-canvas-mutator-ctrl-label wsb-form-finished-label" data-bind="text: i18N.WhenFinished"></div>\r\n        <div class="wsb-canvas-mutator-ctrl-input wsb-form-finished-property clearfix">\r\n            <label class="radio">\r\n                <input\r\n                    type="radio"\r\n                    name="PostSubmitOption"\r\n                    data-bind="value: availablePostSubmitOptions.showMessage, checked: postSubmitOption" />\r\n                <span data-bind="text: postSubmitOptions.showMessage"></span>\r\n            </label>\r\n            <!-- ko if: showPostSubmitMessage -->\r\n            <textarea data-bind="value: postSubmitMessage || i18N.ThankYou()" class="wsb-textarea" maxlength="1000"></textarea>\r\n            <!-- /ko -->\r\n            <label class="radio">\r\n                <input\r\n                    type="radio"\r\n                    name="PostSubmitOption"\r\n                    data-bind="value: availablePostSubmitOptions.redirect, checked: postSubmitOption" />\r\n                <span data-bind="text: postSubmitOptions.redirect"></span>\r\n            </label>\r\n\r\n            <!-- ko if: showRedirectUrl -->\r\n            <input data-bind="urlPicker: { url: redirectUrl, pages: $parent.pages, disableUpload: true, validate: validate, isValid: urlIsValid, validationMessage: validationMessage, showError: showError }" class="wsb-redo-select" />\r\n            <!-- /ko -->\r\n        </div>\r\n    </div>\r\n\r\n\r\n</div>\r\n<!-- /ko -->\r\n<!-- /ko -->\r\n</script>\r\n'}),define("designer/app/builder/ui/canvas/elements/customform/formMutatorViewModel",["knockout","common/stats/googleanalytics","jquery","designer/app/builder/data/data","designer/app/builder/ui/canvas/elements/customform/formUtils","napsoc","designer/app/builder/ui/canvas/elements/customform/customFormModel","common/regexhelper/regexhelper","appconfig","/i18n/resources/client","designer/app/builder/ui/canvas/elements/customform/formUtils","common/abTesting/abTesting","userData","libs/knockout/ko.observables"],function(e,t,n,i,a,r,o,s,l,d,c,u,p){function g(i){function l(){if(w)return w;var e=n.grep(c.availableForms,function(e){return e.isDefault===!0})[0];return e?e.id:void(g=!0)}var c=this,g=!1;c.availableForms=o.getAvailableForms(),c.orientationOptions=a.getLocalizedMapping(f,h),c.labelOrientationsNames=n.map(c.orientationOptions,function(e){return e.name}),c.layoutOptions=a.getLocalizedMapping(v,m),c.layoutOptionsNames=n.map(c.layoutOptions,function(e){return e.name}),c.postSubmitOptions=y,c.availablePostSubmitOptions=b,c.formTypes=n.map(c.availableForms,function(e){return{id:e.id,name:e.name}}),c.UrlKeyPressed=!1,c.validate=!1,c.isPredefinedFormEnabled="enabled"===u.getOption("predefinedForm"),c.i18N={FormTypeColon:d.resources.Server__Form_type_colon,LabelLayoutColon:d.resources.Server__Label_layout_colon,EmailToColon:d.resources.Server__Email_to_colon,ThankYou:d.resources.Server__Thank_you_for_contacting_form,WhenFinished:d.resources.Server__When_finished_colon,CollectEmailsColon:d.resources.Server__Collect_emails_colon,NoteAllEmails:d.resources.Server__Note_all_emails};var S=i.configData();c.emailAddress=S.emailAddress.trimmed(),c.gemSubmit=S.gemSubmit,c.napsocEmailAddress=r.observables().Email,c.redirectUrl=S.redirectUrl.trimmed(),c.postSubmitOption=S.postSubmitOption,c.postSubmitMessage=S.postSubmitMessage,c.selectedLabelOrientation=S.labelOrientation,c.selectedLayout=S.mode,c.selectedFormType=e.observable(l()),c.urlIsValid=e.observable(!0),c.validationMessage=e.observable(""),c.showError=e.observable(!0),c.hasEmailPlaceholder=e.computed(function(){return c.emailAddress()===_}),c.emailPlaceholderText=e.computed(function(){return d.resources.Client__Designer__Element_My_email_colon+" "+(c.napsocEmailAddress()||d.resources.Client__Designer__Element_Lparen_Not_set_Rparen)}),c.showPostSubmitMessage=e.computed(function(){return c.postSubmitOption()==b.showMessage}),c.showRedirectUrl=e.computed(function(){return c.postSubmitOption()==b.redirect}),c.showOptIn=e.computed(function(){return!p.isReseller}),c.selectedLabelOrientationName=e.computed({read:function(){var e=c.selectedLabelOrientation(),t=n.grep(c.orientationOptions,function(t){return e===t.id}),i=t.length?t[0].name:c.orientationOptions[0].name;return i},write:function(e){var t=n.grep(c.orientationOptions,function(t){return e===t.name}),i=t.length?t[0].id:0;c.selectedLabelOrientation(i)}}),c.selectedLayoutName=e.computed({read:function(){var e=c.selectedLayout(),t=n.grep(c.layoutOptions,function(t){return e===t.id}),i=t.length?t[0].name:c.layoutOptions[0].name;return i},write:function(e){var t=n.grep(c.layoutOptions,function(t){return e===t.name}),i=t.length?t[0].id:0;c.selectedLayout(i)}}),c.chooseLayout=function(e){t.trackEvent("form_settings","chooseLayout",e),c.selectedLayoutName(e)},c.chooseOrientation=function(e){t.trackEvent("form_settings",e.toLowerCase()+"_layout","button"),c.selectedLabelOrientationName(e)},c.useEmailPlaceholder=function(){c.emailAddress(_)},c.postSubmitOption.subscribe(function(e){t.trackEvent("form_settings",e?"sent_toweb":"display_text","radio")}),c.selectedFormType.subscribe(function(e){return w=e,g?void(g=!1):void i.replaceForm(e)}),c.gemSubmit.subscribe(function(e){t.trackEvent("form_settings","collect_emails_"+(e?"on":"off"),"checkbox"),i.toggleGemSubmit(e)});var k=d.resources.Enter_a_valid_URL_or_select_page;c.redirectUrl=c.redirectUrl.extend({validation:{custom:[{message:k,test:function(e){return c.UrlKeyPressed?e&&e.length:!0}},{message:k,test:function(e){var t=n.trim(e);if(t.length>0||c.UrlKeyPressed){var i=/^file:([0-9]+)$/i;return c.UrlKeyPressed=!0,i.test(e)?!1:s.validateUrl(t)}return!0}}]}})}{var h=o.availableOrientations,m=o.availableLayoutOptions,b=o.availablePostSubmitOptions,f={above:d.resources.Client__Designer__Element_Above,left:d.resources.Client__Designer__Element_Beside},v={singleColumn:d.resources.Client__Designer__Element_1_Column,freeForm:d.resources.Client__Designer__Element_Free_Form},y={showMessage:d.resources.Client__Designer__Element_Display_text,redirect:d.resources.Client__Designer__Element_Send_to_web_page},_=o.emailPlaceholder,w=0;i.undoer}return{create:function(e){return new g(e)}}}),define("designer/app/builder/ui/canvas/elements/customform/formViewModel",["knockout","common/stats/googleanalytics","jquery","designer/app/builder/data/data","designer/app/builder/ui/canvas/elements/customform/formMutatorViewModel","designer/app/builder/ui/canvas/elements/customform/customFormModel","designer/app/builder/ui/canvas/elements/customform/formUtils","designer/app/builder/ui/controls/formFlyOut/formFlyOut","common/regexhelper/regexhelper","/i18n/resources/client","designer/app/builder/managers/elementManager","userData"],function(e,t,n,i,a,r,o,s,l,d,c,u){function p(i){function l(e){C.configData().labelOrientation(e),d("isLeftOrientation",e===f.left),x.updateChildElements(!0,null,!0,!0),C.updateFormConfigData()}function d(t,n){var i=x.ChildElements();_.each(i,function(i){t in i&&(e.isObservable(i[t])?i[t](n):i[t]=n)})}function p(e){e.labelOrientation.subscribe(l),e.emailAddress.subscribe(C.updateFormConfigData),e.redirectUrl.subscribe(C.updateFormConfigData),e.postSubmitOption.subscribe(C.updateFormConfigData),e.postSubmitMessage.subscribe(C.updateFormConfigData),e.gemSubmit.subscribe(C.updateFormConfigData)}function S(e){var t=e||n("#"+C.ID());C.Height(void 0),C.pixelHeight(t.find(".form-row").height()+w)}function k(){return _.filter(x.ChildElements(),function(e){return e.isButton()})[0]}var x,C=this,T=C.getLocalizedProperty("FormConfigData"),E=!1,P=!1,D=null,I=null,A=new Date,M=A.getTime(),O=36e5,L=new Date(M+24*O),N=new Date(M+O),B=/([\d]+:)([\d]{2})(:[\d]{2})(.*)/;C.minWidth=300,C.i18N={Title:h.Client__Designer__Element_Form_Element,SettingsTitle:h.Form_Settings,ClickToEditForm:h.Server__Click_to_edit_form,FromUpperCase:h.Server__From_uppercase,ToUpperCase:h.Server__To_uppercase,Submit:h.Submit,SaveFormAs:h.Server__Save_form_as,SaveAsColon:h.Server__Save_as_colon,DescriptionColon:h.Description_colon,Cancel:h.Cancel,Save:h.Save,LoadAnExistingForm:h.Server__Load_an_Existing_Form,DeleteColon:h.Delete+":",Delete:h.Delete,Add:h.Add,Theme:h.Theme,Next:h.Next,Optin:h.ContactForm_OptInLabel},C.currentDate=A.toLocaleDateString(),C.currentTime=A.toLocaleTimeString().replace(B,"$100$4"),C.tomorrow=L.toLocaleDateString(),C.nextHour=N.toLocaleTimeString().replace(B,"$100$4"),C.mutatorViewModel=!1,C.formLabel=C.getLocalizedProperty("FormLabel"),C.formType=C.FormType,C.showFlyout=e.observable(!1),C.isLeftOrientation=e.observable(!1),C.isButton=e.computed(function(){return C.formType()===v.button},C,{deferEvaluation:!0}),C.isEmail=e.computed(function(){return C.formType()===v.email},C,{deferEvaluation:!0}),C.formTemplate=e.computed(function(){return"custom_form_"+o.getKeyFromDict(v,C.formType())},C,{deferEvaluation:!0}),C.configData=e.computed(function(){var e=T(),t=C.formType();if("string"==typeof e)if(D)e=D;else{e=JSON.parse(e),e=o.makeNumbersNotStrings(e);var n=y[o.getKeyFromDict(v,t)];for(var i in n)i in e||(e[i]=n[i]);e=g(e),D=e}return e},C,{deferEvaluationDisabled:!0}),C.showOptIn=e.computed(function(){return!u.isReseller&&C.configData().gemSubmit&&C.configData().gemSubmit()}),C.hasOnlyOneElement=e.computed(function(){var e=C.GroupID(),t=c.getAllElementsByGroupId(e);return t.length<2},C,{deferEvaluation:!0}),C.isRequired=e.computed(function(){return C.configData().isRequired?C.configData().isRequired():!1},C,{deferEvaluation:!0}),C.isOnlyRemainingRequiredField=e.computed(function(){var e=C.GroupID(),t=c.getAllElementsByGroupId(e),i=n.grep(t,function(e){return"isRequired"in e.configData()?e.configData().isRequired():!1});return i.length<2},C,{deferEvaluation:!0}),C.optionName=e.computed(function(){return"form"+C.ID()},C,{deferEvaluation:!0}),C.isLabelEditable=e.computed(function(){var e=C.state(),t="selected"==e||"edit"==e;return t},C,{deferEvaluation:!0}),C.disableDrag=C.isButton,C.Styling.Transparency(!1),C.Styling.Color(!1),C.Styling.Border(!1),C.Styling.BackgroundColor(!1),C.Styling.Padding(!1),C.Styling.Size(!1),C.Styling.RoundedCorner(!1),C.Styling.Shadow(!1),C.Styling.ShowAdvancedTab(!1),C.Styling.ShowBasicTabOnly(!0),C.SettingsTitle=h.Form_Settings,C.ignore=function(){return!1},C.updateFormConfigData=function(){E=!0;var t=e.toJSON(C.configData());i.FormConfigData(t),E=!1},C.replaceFormType=function(i,a){m.collect("replace form element");var l=o.getKeyFromDict(v,i),d=a||n("#"+C.ID());P=!0,C.showSelected&&C.showSelected(!1),t.trackEvent("custom_form_elements","replaceFormType",l),d.fadeOut(250,function(){var t=y[l];if(void 0!==t){for(prop in t){var a=t[prop],o=C.configData();n.isArray(a)?o[prop]=e.observableArray(a):o[prop]?o[prop](a):o[prop]=e.observable(a)}isReplaced=!0,C.formType(i),C.formLabel(r.getDefaultFormLabel(i)),s.update(C),i==v.email&&x.updateEmailFields(),d.fadeIn(250,function(){P=!1,S(d),x.updateChildElements(!0),C.showSelected&&C.showSelected(!0),m.enable("replace form element")})}})},C.startLabelEdit=function(){},C.inlineEditorBlur=function(){},C.validateLabel=function(e){return e=e.replace(/\n/g," "),e=e.replace(/\t/g," "),e=e.replace(/\r/g," "),e=e.replace(/^\s+/g,"")},C.replaceForm=function(e){var t=r.getFormById(e),n=C.GroupID(),i=c.getAllElementsByGroupId(n);r.replace(i,t),x.updateEmailFields(),x.updateChildElements(!0);var a=k();p(a.configData()),a.showProperties(C.getMutatorOptions())},C.toggleGemSubmit=function(e){x.updateEmailFields(e),r.gemSubmit=e,x.updateChildElements(!0)},C.updateHeight=S,C.getMutatorOptions=function(){return{anchor:n("#"+x.ID())}},C.beforeDelete=function(){C.showFlyout(!1)},C.isRecentlyAdded=!1,C.createNewElement=function(){var e=C.GroupID(),t=x.ChildElements()[0],n=c.copyElement(t,e,null,!0,null,null),i=n.configData(),a=y.input;i.items(a.items),i.placeHolderText(a.placeHolderText),i.isRequired(a.isRequired),i.toolTipText(a.toolTipText),n.isEmail&&n.isEmail()&&i.gemSubmit(!1),n.pixelTop(k().pixelTop()-1),n.updateHeight();c.getAllElementsByGroupId(e);return x.updateChildElements(!0),n.isRecentlyAdded=!0,n},C.setContainerViewModel=function(e){x=e},C.clearOutStates=function(){x.clearOutStates()},C.showFlyout.subscribe(function(e){e?(s.show(C,C.isRecentlyAdded),C.isRecentlyAdded=!1):s.hide(!1)}),C.FormConfigData.subscribe(function(t){if(C.isButton()||S(),!E){var n=JSON.parse(t);for(var i in n)if(!(i.indexOf("__")>-1)&&i in C.configData()){var a=C.configData()[i];e.isObservable(a)&&a(n[i])}}}),C.state.subscribe(function(e){var t="edit"==e;I&&t&&(0==n.trim(C.formLabel()).length&&C.formLabel(b),I.removeAttr("data-ignoredrag").blur().addClass("wsb-undo-select").removeClass("wsb-redo-select"))},C,"beforeChange"),C.isButton()&&p(C.configData()),C.isButton()&&(C.mutatorViewModel=a.create(C)),C.updateAfterGrouped=function(e){_.each(e.ChildElements(),function(t){t.setContainerViewModel(e)});var t=k();if(void 0===t)return void c.deleteElement(C);var n=k().configData();d("isLeftOrientation",n.labelOrientation()===f.left),d("Layer",x.Layer())},C.updateFormConfigData()}function g(t){var n={};for(var i in t){var a=["string","number","boolean"],r=t[i];if(-1!=a.indexOf(typeof r)||null===r||void 0===r){var o=e.observable(r);n[i]=o}else if(r instanceof Array){var s=_.map(r,function(e){return null===e||_.isPlainObject(e)?"":-1==a.indexOf(typeof e)?g(e):e}),l=e.observableArray(s);n[i]=l}else n[i]=r instanceof Function?r:g(r)}return n}var h=d.resources,m=i.undoer,b=h.Client__Designer__Element_Label,f=r.availableOrientations,v=r.availableFormTypes,y=r.defaultConfigData,w=10;return p}),define("designer/app/builder/ui/canvas/elements/customform/el.customform",["text!designer/app/builder/ui/canvas/elements/customform/el.customform.html","text!designer/app/builder/ui/canvas/elements/customform/mutator.customform.html","knockout","designer/app/builder/ui/canvas/elements/helper","designer/app/builder/managers/elementManager","designer/app/builder/data/data","common/logger/serverLogger","jquery","designer/app/builder/ui/canvas/elements/customform/formViewModel","designer/app/builder/ui/canvas/elements/customform/customFormModel"],function(e,t,n,i,a,r,o,s,l,d){function c(e,t){var n=d.getDefaultForm(),i=a.createNewGroup(t.pageIds,"content","form").groupId(),r=1/0,o=_.map(n.elements,function(t){return r=Math.min(parseInt(t.Top),r),{Type:e.Type,Top:t.Top,Left:"0px",Width:e.Width,Height:t.Height,FormType:t.FormType,FormLabel:t.FormLabel,FormConfigData:t.FormConfigData,FormHelpTip:t.FormHelpTip,GroupID:i,Shared:e.Shared}});o.sort(function(e,t){return parseInt(e.Top)-parseInt(t.Top)});var s=parseInt(o[0].Top);_.each(o,function(e){var t=s,n=parseInt(e.Height);e.Top=t+"px",s=t+n}),t.id=function(){return i},a.addNewElementsToCanvas(o,void 0,!0),t.id=i,e.Type="shufflecontainer",e.Width=parseInt(e.Width)+128+"px"}var u="customform";return{name:u,initModel:function(e,t,a){return void 0===e.FormConfigData?void c(e,a):(e.FormType=i.coerceNumericValue(a,e.FormType,n.unwrap(e.FormType),{defaultValue:d.availableFormTypes.input}),e.FormLabel=e.FormLabel||d.getDefaultFormLabel(e.FormType),void(e.FormHelpTip=e.FormHelpTip||""))},createElementViewModel:function(e,t){return l.prototype=new e(t),l.prototype.constructor=l,new l(t)},load:function(n,i){n.append(e).append(t),d.initModule(u),i(null,u)}}}),define("text!designer/app/builder/ui/canvas/elements/audioplayer/el.audioplayer.html",[],function(){return'<script type="text/html" id="wsb-canvas-template-audioplayer">\r\n	<div data-widget-content="true" data-bind="attr: { style: Style, \'class\': CssClasses }">\r\n		<div data-bind="attr: { id: $data.mode + \'-audioplayer-\' + $data.ID() }" class="wsb-media-audioplayer">\r\n			<div class="wsb-media-audioplayer-details">\r\n				<div class="art" style="display: none"></div>\r\n				<div class="tags">\r\n					<div class="name"></div>\r\n					<div class="author"></div>\r\n					<div class="length"></div>\r\n					<span class="shuffle" title="Shuffle"></span>\r\n					<span class="loop" title="Loop"></span>\r\n				</div>\r\n			</div>\r\n			<div class="wsb-media-audioplayer-desc">\r\n				<p></p>\r\n			</div>\r\n			<div class="wsb-media-audioplayer-controls">\r\n				<span class="back" title="Previous"></span>\r\n				<span class="play" title="Play"></span>\r\n				<span class="pause" title="Pause" style="display: none"></span>\r\n				<span class="forward" title="Next"></span>\r\n				<div class="progress-time"></div>\r\n				<div class="progress">\r\n					<div>\r\n						<span></span>\r\n					</div>\r\n				</div>\r\n			</div>\r\n			<div class="wsb-media-audioplayer-playlist" style="display: none">\r\n				<ul></ul>\r\n			</div>\r\n		</div>\r\n	</div>\r\n</script>'}),define("text!designer/app/builder/ui/canvas/elements/audioplayer/mutator.audioplayer.html",[],function(){return'<script type="text/html" id ="mutator-template-element-audioplayer">\r\n\r\n<!-- ko if: $data.Type() === \'audioplayer\' && $data.mutatorViewModel -->\r\n<!-- ko with: mutatorViewModel -->\r\n<div class="wsb-canvas-mutator-inner wsb-media-audioplayer-properties">\r\n    \r\n    <div class="wsb-canvas-mutator-ctrl-outer clearfix">\r\n        <div class="wsb-canvas-mutator-ctrl-label wsb-repeat-label" data-bind= "text: i18Dict.TracksColon"></div>\r\n        <div class="wsb-canvas-mutator-ctrl-input clearfix">\r\n            <span class="tracks" data-bind="text: AudioPlayerAssets().length"></span>\r\n\r\n            <span class="btn btn-inverse-grey wsb-add-images-btn" data-bind="click: OpenManager">\r\n                <i class="icon-audio icon-wsb-white"></i><span data-bind= "text: i18Dict.ManagePlaylist"></span>\r\n            </span>\r\n        </div>       \r\n        \r\n    </div>\r\n    <div data-bind="mutatorElement: { name: \'checkboxlist\',\r\n                                      data: [{ value: AudioPlayerShowPlayList, name:i18Dict.ShowPlaylist }, \r\n                                               { value: AudioPlayerLoop, name:i18Dict.LoopPlaylist },\r\n                                               { value: AudioPlayerShuffle, name:i18Dict.Shuffle }, \r\n                                               { value: AudioPlayerAutoStart, name:StartAutomaticallyHTML }],\r\n                                     \r\n        context: { title:i18Dict.OptionsColon, afterRender: afterRender } }"></div>\r\n    <div data-bind="mutatorElement: { name: \'imagepicker\', data: { docId: AudioPlayerAlbumImage }, context: { title:i18Dict.AlbumArtColon} }"></div>\r\n    <div class="wsb-canvas-mutator-ctrl-outer clearfix">\r\n        <div class="wsb-canvas-mutator-ctrl-label wsb-repeat-label" data-bind= "text: i18Dict.DescriptionColon"></div>\r\n        <div class="wsb-canvas-mutator-ctrl-input clearfix">\r\n            <textarea data-bind="value: AudioPlayerDescription, valueUpdate: \'input\'" class="wsb-textarea" maxlength="1000"></textarea>\r\n        </div>\r\n    </div>\r\n</div>\r\n<!-- /ko -->\r\n<!-- /ko -->\r\n</script>\r\n'}),define("libs/jquery/plugins/jquery.dotdotdot",["jquery"],function(e){!function(e){function t(e,t,n){var i=e.children(),r=!1;e.empty();for(var o=0,s=i.length;s>o;o++){var l=i.eq(o);if(e.append(l),n&&e.append(n),a(e,t)){l.remove(),r=!0;break}n&&n.remove()}return r}function n(t,r,o,s,l){var d=t.contents(),c=!1;t.empty();for(var u="table, thead, tbody, tfoot, tr, col, colgroup, object, embed, param, ol, ul, dl, select, optgroup, option, textarea, script, style",p=0,g=d.length;g>p&&!c;p++){var h=d[p],m=e(h);void 0!==h&&(t.append(m),l&&t[t.is(u)?"after":"append"](l),3==h.nodeType?a(o,s)&&(c=i(m,r,o,s,l)):c=n(m,r,o,s,l),c||l&&l.remove())}return c}function i(e,t,n,o,d){var c=!1,u=e[0];if(void 0===u)return!1;for(var p="letter"==o.wrap?"":" ",g=l(u).split(p),h=-1,m=-1,b=0,f=g.length-1;f>=b;){var v=Math.floor((b+f)/2);if(v==m)break;m=v,s(u,g.slice(0,m+1).join(p)+o.ellipsis),a(n,o)?f=m:(h=m,b=m)}if(-1==h||1==g.length&&0==g[0].length){var y=e.parent();e.remove();var _=d?d.length:0;if(y.contents().size()>_){var w=y.contents().eq(-1-_);c=i(w,t,n,o,d)}else{var S=y.prev(),u=S.contents().eq(-1)[0];if(void 0!==u){var k=r(l(u),o);s(u,k),d&&S.append(d),y.remove(),c=!0}}}else{var k=r(g.slice(0,h+1).join(p),o);c=!0,s(u,k)}return c}function a(e,t){return e.innerHeight()>t.maxHeight}function r(t,n){for(;e.inArray(t.slice(-1),n.lastCharacter.remove)>-1;)t=t.slice(0,-1);return 0>e.inArray(t.slice(-1),n.lastCharacter.noEllipsis)&&(t+=n.ellipsis),t}function o(e){return{width:e.innerWidth(),height:e.innerHeight()}}function s(e,t){e.innerText?e.innerText=t:e.nodeValue?e.nodeValue=t:e.textContent&&(e.textContent=t)}function l(e){return e.innerText?e.innerText:e.nodeValue?e.nodeValue:e.textContent?e.textContent:""}function d(t,n){return void 0===t?!1:t?"string"==typeof t?(t=e(t,n),t.length?t:!1):"object"==typeof t?void 0===t.jquery?!1:t:!1:!1}function c(e){for(var t=e.innerHeight(),n=["paddingTop","paddingBottom"],i=0,a=n.length;a>i;i++){var r=parseInt(e.css(n[i]),10);isNaN(r)&&(r=0),t-=r}return t}function u(e,t){return e?(t="string"==typeof t?"dotdotdot: "+t:["dotdotdot:",t],void 0!==window.console&&void 0!==window.console.log&&window.console.log(t),!1):!1}if(!e.fn.dotdotdot){e.fn.dotdotdot=function(i){if(0==this.length)return i&&i.debug===!1||u(!0,'No element found for "'+this.selector+'".'),this;if(this.length>1)return this.each(function(){e(this).dotdotdot(i)});var r=this;r.data("dotdotdot")&&r.trigger("destroy.dot"),r.data("dotdotdot-style",r.attr("style")),r.css("word-wrap","break-word"),r.bind_events=function(){return r.bind("update.dot",function(i,o){i.preventDefault(),i.stopPropagation(),l.maxHeight="number"==typeof l.height?l.height:c(r),l.maxHeight+=l.tolerance,void 0!==o&&(("string"==typeof o||o instanceof HTMLElement)&&(o=e("<div />").append(o).contents()),o instanceof e&&(s=o)),b=r.wrapInner('<div class="dotdotdot" />').children(),b.empty().append(s.clone(!0)).css({height:"auto",width:"auto",border:"none",padding:0,margin:0});var d=!1,u=!1;return g.afterElement&&(d=g.afterElement.clone(!0),g.afterElement.remove()),a(b,l)&&(u="children"==l.wrap?t(b,l,d):n(b,r,b,l,d)),b.replaceWith(b.contents()),b=null,e.isFunction(l.callback)&&l.callback.call(r[0],u,s),g.isTruncated=u,u}).bind("isTruncated.dot",function(e,t){return e.preventDefault(),e.stopPropagation(),"function"==typeof t&&t.call(r[0],g.isTruncated),g.isTruncated}).bind("originalContent.dot",function(e,t){return e.preventDefault(),e.stopPropagation(),"function"==typeof t&&t.call(r[0],s),s}).bind("destroy.dot",function(e){e.preventDefault(),e.stopPropagation(),r.unwatch().unbind_events().empty().append(s).attr("style",r.data("dotdotdot-style")).data("dotdotdot",!1)}),r},r.unbind_events=function(){return r.unbind(".dot"),r},r.watch=function(){if(r.unwatch(),"window"==l.watch){var t=e(window),n=t.width(),i=t.height();t.bind("resize.dot"+g.dotId,function(){n==t.width()&&i==t.height()&&l.windowResizeFix||(n=t.width(),i=t.height(),m&&clearInterval(m),m=setTimeout(function(){r.trigger("update.dot")},10))})}else h=o(r),m=setInterval(function(){var e=o(r);(h.width!=e.width||h.height!=e.height)&&(r.trigger("update.dot"),h=o(r))},100);return r},r.unwatch=function(){return e(window).unbind("resize.dot"+g.dotId),m&&clearInterval(m),r};var s=r.contents(),l=e.extend(!0,{},e.fn.dotdotdot.defaults,i),g={},h={},m=null,b=null;return g.afterElement=d(l.after,r),g.isTruncated=!1,g.dotId=p++,r.data("dotdotdot",!0).bind_events().trigger("update.dot"),l.watch&&r.watch(),r},e.fn.dotdotdot.defaults={ellipsis:"... ",wrap:"word",lastCharacter:{remove:[" ",",",";",".","!","?"],noEllipsis:[]},tolerance:0,callback:null,after:null,height:null,watch:!1,windowResizeFix:!0,debug:!1};var p=1,g=e.fn.html;e.fn.html=function(e){return void 0!==e?this.data("dotdotdot")&&"function"!=typeof e?this.trigger("update",[e]):g.call(this,e):g.call(this)};var h=e.fn.text;e.fn.text=function(t){if(void 0!==t){if(this.data("dotdotdot")){var n=e("<div />");return n.text(t),t=n.html(),n.remove(),this.trigger("update",[t])}return h.call(this,t)}return h.call(this)}}}(e)}),function(e,t){"function"==typeof define&&define.amd?define("libs/jplayer/jquery.jplayer",["jquery"],t):t("object"==typeof exports?require("jquery"):e.jQuery?e.jQuery:e.Zepto)}(this,function(e,t){e.fn.jPlayer=function(n){var i="jPlayer",a="string"==typeof n,r=Array.prototype.slice.call(arguments,1),o=this;return n=!a&&r.length?e.extend.apply(null,[!0,n].concat(r)):n,a&&"_"===n.charAt(0)?o:(this.each(a?function(){var a=e(this).data(i),s=a&&e.isFunction(a[n])?a[n].apply(a,r):a;return s!==a&&s!==t?(o=s,!1):void 0}:function(){var t=e(this).data(i);t?t.option(n||{}):e(this).data(i,new e.jPlayer(n,this))}),o)},e.jPlayer=function(t,n){if(arguments.length){this.element=e(n),this.options=e.extend(!0,{},this.options,t);var i=this;this.element.bind("remove.jPlayer",function(){i.destroy()}),this._init()}},"function"!=typeof e.fn.stop&&(e.fn.stop=function(){}),e.jPlayer.emulateMethods="load play pause",e.jPlayer.emulateStatus="src readyState networkState currentTime duration paused ended playbackRate",e.jPlayer.emulateOptions="muted volume",e.jPlayer.reservedEvent="ready flashreset resize repeat error warning",e.jPlayer.event={},e.each(["ready","setmedia","flashreset","resize","repeat","click","error","warning","loadstart","progress","suspend","abort","emptied","stalled","play","pause","loadedmetadata","loadeddata","waiting","playing","canplay","canplaythrough","seeking","seeked","timeupdate","ended","ratechange","durationchange","volumechange"],function(){e.jPlayer.event[this]="jPlayer_"+this}),e.jPlayer.htmlEvent=["loadstart","abort","emptied","stalled","loadedmetadata","canplay","canplaythrough"],e.jPlayer.pause=function(){e.jPlayer.prototype.destroyRemoved(),e.each(e.jPlayer.prototype.instances,function(e,t){t.data("jPlayer").status.srcSet&&t.jPlayer("pause")})},e.jPlayer.timeFormat={showHour:!1,showMin:!0,showSec:!0,padHour:!1,padMin:!0,padSec:!0,sepHour:":",sepMin:":",sepSec:""};var n=function(){this.init()};n.prototype={init:function(){this.options={timeFormat:e.jPlayer.timeFormat}},time:function(e){e=e&&"number"==typeof e?e:0;var t=new Date(1e3*e),n=t.getUTCHours(),i=this.options.timeFormat.showHour?t.getUTCMinutes():t.getUTCMinutes()+60*n,a=this.options.timeFormat.showMin?t.getUTCSeconds():t.getUTCSeconds()+60*i,r=this.options.timeFormat.padHour&&10>n?"0"+n:n,o=this.options.timeFormat.padMin&&10>i?"0"+i:i,s=this.options.timeFormat.padSec&&10>a?"0"+a:a,l="";return l+=this.options.timeFormat.showHour?r+this.options.timeFormat.sepHour:"",l+=this.options.timeFormat.showMin?o+this.options.timeFormat.sepMin:"",l+=this.options.timeFormat.showSec?s+this.options.timeFormat.sepSec:""}};var i=new n;e.jPlayer.convertTime=function(e){return i.time(e)},e.jPlayer.uaBrowser=function(e){var t=e.toLowerCase(),n=/(webkit)[ \/]([\w.]+)/,i=/(opera)(?:.*version)?[ \/]([\w.]+)/,a=/(msie) ([\w.]+)/,r=/(mozilla)(?:.*? rv:([\w.]+))?/,o=n.exec(t)||i.exec(t)||a.exec(t)||t.indexOf("compatible")<0&&r.exec(t)||[];return{browser:o[1]||"",version:o[2]||"0"}},e.jPlayer.uaPlatform=function(e){var t=e.toLowerCase(),n=/(ipad|iphone|ipod|android|blackberry|playbook|windows ce|webos)/,i=/(ipad|playbook)/,a=/(android)/,r=/(mobile)/,o=n.exec(t)||[],s=i.exec(t)||!r.exec(t)&&a.exec(t)||[];return o[1]&&(o[1]=o[1].replace(/\s/g,"_")),{platform:o[1]||"",tablet:s[1]||""}},e.jPlayer.browser={},e.jPlayer.platform={};var a=e.jPlayer.uaBrowser(navigator.userAgent);a.browser&&(e.jPlayer.browser[a.browser]=!0,e.jPlayer.browser.version=a.version);var r=e.jPlayer.uaPlatform(navigator.userAgent);r.platform&&(e.jPlayer.platform[r.platform]=!0,e.jPlayer.platform.mobile=!r.tablet,e.jPlayer.platform.tablet=!!r.tablet),e.jPlayer.getDocMode=function(){var t;return e.jPlayer.browser.msie&&(document.documentMode?t=document.documentMode:(t=5,document.compatMode&&"CSS1Compat"===document.compatMode&&(t=7))),t},e.jPlayer.browser.documentMode=e.jPlayer.getDocMode(),e.jPlayer.nativeFeatures={init:function(){var e,t,n,i=document,a=i.createElement("video"),r={w3c:["fullscreenEnabled","fullscreenElement","requestFullscreen","exitFullscreen","fullscreenchange","fullscreenerror"],moz:["mozFullScreenEnabled","mozFullScreenElement","mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozfullscreenerror"],webkit:["","webkitCurrentFullScreenElement","webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange",""],webkitVideo:["webkitSupportsFullscreen","webkitDisplayingFullscreen","webkitEnterFullscreen","webkitExitFullscreen","",""],ms:["","msFullscreenElement","msRequestFullscreen","msExitFullscreen","MSFullscreenChange","MSFullscreenError"]},o=["w3c","moz","webkit","webkitVideo","ms"];for(this.fullscreen=e={support:{w3c:!!i[r.w3c[0]],moz:!!i[r.moz[0]],webkit:"function"==typeof i[r.webkit[3]],webkitVideo:"function"==typeof a[r.webkitVideo[2]],ms:"function"==typeof a[r.ms[2]]},used:{}},t=0,n=o.length;n>t;t++){var s=o[t];if(e.support[s]){e.spec=s,e.used[s]=!0;break}}if(e.spec){var l=r[e.spec];e.api={fullscreenEnabled:!0,fullscreenElement:function(e){return e=e?e:i,e[l[1]]},requestFullscreen:function(e){return e[l[2]]()},exitFullscreen:function(e){return e=e?e:i,e[l[3]]()}},e.event={fullscreenchange:l[4],fullscreenerror:l[5]}}else e.api={fullscreenEnabled:!1,fullscreenElement:function(){return null},requestFullscreen:function(){},exitFullscreen:function(){}},e.event={}}},e.jPlayer.nativeFeatures.init(),e.jPlayer.focus=null,e.jPlayer.keyIgnoreElementNames="A INPUT TEXTAREA SELECT BUTTON";var o=function(t){var n,i=e.jPlayer.focus;i&&(e.each(e.jPlayer.keyIgnoreElementNames.split(/\s+/g),function(e,i){return t.target.nodeName.toUpperCase()===i.toUpperCase()?(n=!0,!1):void 0}),n||e.each(i.options.keyBindings,function(n,a){return a&&e.isFunction(a.fn)&&("number"==typeof a.key&&t.which===a.key||"string"==typeof a.key&&t.key===a.key)?(t.preventDefault(),a.fn(i),!1):void 0}))};e.jPlayer.keys=function(t){var n="keydown.jPlayer";e(document.documentElement).unbind(n),t&&e(document.documentElement).bind(n,o)},e.jPlayer.keys(!0),e.jPlayer.prototype={count:0,version:{script:"2.9.2",needFlash:"2.9.0",flash:"unknown"},options:{swfPath:"js",solution:"html, flash",supplied:"mp3",auroraFormats:"wav",preload:"metadata",volume:.8,muted:!1,remainingDuration:!1,toggleDuration:!1,captureDuration:!0,playbackRate:1,defaultPlaybackRate:1,minPlaybackRate:.5,maxPlaybackRate:4,wmode:"opaque",backgroundColor:"#000000",cssSelectorAncestor:"#jp_container_1",cssSelector:{videoPlay:".jp-video-play",play:".jp-play",pause:".jp-pause",stop:".jp-stop",seekBar:".jp-seek-bar",playBar:".jp-play-bar",mute:".jp-mute",unmute:".jp-unmute",volumeBar:".jp-volume-bar",volumeBarValue:".jp-volume-bar-value",volumeMax:".jp-volume-max",playbackRateBar:".jp-playback-rate-bar",playbackRateBarValue:".jp-playback-rate-bar-value",currentTime:".jp-current-time",duration:".jp-duration",title:".jp-title",fullScreen:".jp-full-screen",restoreScreen:".jp-restore-screen",repeat:".jp-repeat",repeatOff:".jp-repeat-off",gui:".jp-gui",noSolution:".jp-no-solution"},stateClass:{playing:"jp-state-playing",seeking:"jp-state-seeking",muted:"jp-state-muted",looped:"jp-state-looped",fullScreen:"jp-state-full-screen",noVolume:"jp-state-no-volume"},useStateClassSkin:!1,autoBlur:!0,smoothPlayBar:!1,fullScreen:!1,fullWindow:!1,autohide:{restored:!1,full:!0,fadeIn:200,fadeOut:600,hold:1e3},loop:!1,repeat:function(t){t.jPlayer.options.loop?e(this).unbind(".jPlayerRepeat").bind(e.jPlayer.event.ended+".jPlayer.jPlayerRepeat",function(){e(this).jPlayer("play")
}):e(this).unbind(".jPlayerRepeat")},nativeVideoControls:{},noFullWindow:{msie:/msie [0-6]\./,ipad:/ipad.*?os [0-4]\./,iphone:/iphone/,ipod:/ipod/,android_pad:/android [0-3]\.(?!.*?mobile)/,android_phone:/(?=.*android)(?!.*chrome)(?=.*mobile)/,blackberry:/blackberry/,windows_ce:/windows ce/,iemobile:/iemobile/,webos:/webos/},noVolume:{ipad:/ipad/,iphone:/iphone/,ipod:/ipod/,android_pad:/android(?!.*?mobile)/,android_phone:/android.*?mobile/,blackberry:/blackberry/,windows_ce:/windows ce/,iemobile:/iemobile/,webos:/webos/,playbook:/playbook/},timeFormat:{},keyEnabled:!1,audioFullScreen:!1,keyBindings:{play:{key:80,fn:function(e){e.status.paused?e.play():e.pause()}},fullScreen:{key:70,fn:function(e){(e.status.video||e.options.audioFullScreen)&&e._setOption("fullScreen",!e.options.fullScreen)}},muted:{key:77,fn:function(e){e._muted(!e.options.muted)}},volumeUp:{key:190,fn:function(e){e.volume(e.options.volume+.1)}},volumeDown:{key:188,fn:function(e){e.volume(e.options.volume-.1)}},loop:{key:76,fn:function(e){e._loop(!e.options.loop)}}},verticalVolume:!1,verticalPlaybackRate:!1,globalVolume:!1,idPrefix:"jp",noConflict:"jQuery",emulateHtml:!1,consoleAlerts:!0,errorAlerts:!1,warningAlerts:!1},optionsAudio:{size:{width:"0px",height:"0px",cssClass:""},sizeFull:{width:"0px",height:"0px",cssClass:""}},optionsVideo:{size:{width:"480px",height:"270px",cssClass:"jp-video-270p"},sizeFull:{width:"100%",height:"100%",cssClass:"jp-video-full"}},instances:{},status:{src:"",media:{},paused:!0,format:{},formatType:"",waitForPlay:!0,waitForLoad:!0,srcSet:!1,video:!1,seekPercent:0,currentPercentRelative:0,currentPercentAbsolute:0,currentTime:0,duration:0,remaining:0,videoWidth:0,videoHeight:0,readyState:0,networkState:0,playbackRate:1,ended:0},internal:{ready:!1},solution:{html:!0,aurora:!0,flash:!0},format:{mp3:{codec:"audio/mpeg",flashCanPlay:!0,media:"audio"},m4a:{codec:'audio/mp4; codecs="mp4a.40.2"',flashCanPlay:!0,media:"audio"},m3u8a:{codec:'application/vnd.apple.mpegurl; codecs="mp4a.40.2"',flashCanPlay:!1,media:"audio"},m3ua:{codec:"audio/mpegurl",flashCanPlay:!1,media:"audio"},oga:{codec:'audio/ogg; codecs="vorbis, opus"',flashCanPlay:!1,media:"audio"},flac:{codec:"audio/x-flac",flashCanPlay:!1,media:"audio"},wav:{codec:'audio/wav; codecs="1"',flashCanPlay:!1,media:"audio"},webma:{codec:'audio/webm; codecs="vorbis"',flashCanPlay:!1,media:"audio"},fla:{codec:"audio/x-flv",flashCanPlay:!0,media:"audio"},rtmpa:{codec:'audio/rtmp; codecs="rtmp"',flashCanPlay:!0,media:"audio"},m4v:{codec:'video/mp4; codecs="avc1.42E01E, mp4a.40.2"',flashCanPlay:!0,media:"video"},m3u8v:{codec:'application/vnd.apple.mpegurl; codecs="avc1.42E01E, mp4a.40.2"',flashCanPlay:!1,media:"video"},m3uv:{codec:"audio/mpegurl",flashCanPlay:!1,media:"video"},ogv:{codec:'video/ogg; codecs="theora, vorbis"',flashCanPlay:!1,media:"video"},webmv:{codec:'video/webm; codecs="vorbis, vp8"',flashCanPlay:!1,media:"video"},flv:{codec:"video/x-flv",flashCanPlay:!0,media:"video"},rtmpv:{codec:'video/rtmp; codecs="rtmp"',flashCanPlay:!0,media:"video"}},_init:function(){var n=this;if(this.element.empty(),this.status=e.extend({},this.status),this.internal=e.extend({},this.internal),this.options.timeFormat=e.extend({},e.jPlayer.timeFormat,this.options.timeFormat),this.internal.cmdsIgnored=e.jPlayer.platform.ipad||e.jPlayer.platform.iphone||e.jPlayer.platform.ipod,this.internal.domNode=this.element.get(0),this.options.keyEnabled&&!e.jPlayer.focus&&(e.jPlayer.focus=this),this.androidFix={setMedia:!1,play:!1,pause:!1,time:0/0},e.jPlayer.platform.android&&(this.options.preload="auto"!==this.options.preload?"metadata":"auto"),this.formats=[],this.solutions=[],this.require={},this.htmlElement={},this.html={},this.html.audio={},this.html.video={},this.aurora={},this.aurora.formats=[],this.aurora.properties=[],this.flash={},this.css={},this.css.cs={},this.css.jq={},this.ancestorJq=[],this.options.volume=this._limitValue(this.options.volume,0,1),e.each(this.options.supplied.toLowerCase().split(","),function(t,i){var a=i.replace(/^\s+|\s+$/g,"");if(n.format[a]){var r=!1;e.each(n.formats,function(e,t){return a===t?(r=!0,!1):void 0}),r||n.formats.push(a)}}),e.each(this.options.solution.toLowerCase().split(","),function(t,i){var a=i.replace(/^\s+|\s+$/g,"");if(n.solution[a]){var r=!1;e.each(n.solutions,function(e,t){return a===t?(r=!0,!1):void 0}),r||n.solutions.push(a)}}),e.each(this.options.auroraFormats.toLowerCase().split(","),function(t,i){var a=i.replace(/^\s+|\s+$/g,"");if(n.format[a]){var r=!1;e.each(n.aurora.formats,function(e,t){return a===t?(r=!0,!1):void 0}),r||n.aurora.formats.push(a)}}),this.internal.instance="jp_"+this.count,this.instances[this.internal.instance]=this.element,this.element.attr("id")||this.element.attr("id",this.options.idPrefix+"_jplayer_"+this.count),this.internal.self=e.extend({},{id:this.element.attr("id"),jq:this.element}),this.internal.audio=e.extend({},{id:this.options.idPrefix+"_audio_"+this.count,jq:t}),this.internal.video=e.extend({},{id:this.options.idPrefix+"_video_"+this.count,jq:t}),this.internal.flash=e.extend({},{id:this.options.idPrefix+"_flash_"+this.count,jq:t,swf:this.options.swfPath+(".swf"!==this.options.swfPath.toLowerCase().slice(-4)?(this.options.swfPath&&"/"!==this.options.swfPath.slice(-1)?"/":"")+"jquery.jplayer.swf":"")}),this.internal.poster=e.extend({},{id:this.options.idPrefix+"_poster_"+this.count,jq:t}),e.each(e.jPlayer.event,function(e,i){n.options[e]!==t&&(n.element.bind(i+".jPlayer",n.options[e]),n.options[e]=t)}),this.require.audio=!1,this.require.video=!1,e.each(this.formats,function(e,t){n.require[n.format[t].media]=!0}),this.options=this.require.video?e.extend(!0,{},this.optionsVideo,this.options):e.extend(!0,{},this.optionsAudio,this.options),this._setSize(),this.status.nativeVideoControls=this._uaBlocklist(this.options.nativeVideoControls),this.status.noFullWindow=this._uaBlocklist(this.options.noFullWindow),this.status.noVolume=this._uaBlocklist(this.options.noVolume),e.jPlayer.nativeFeatures.fullscreen.api.fullscreenEnabled&&this._fullscreenAddEventListeners(),this._restrictNativeVideoControls(),this.htmlElement.poster=document.createElement("img"),this.htmlElement.poster.id=this.internal.poster.id,this.htmlElement.poster.onload=function(){(!n.status.video||n.status.waitForPlay)&&n.internal.poster.jq.show()},this.element.append(this.htmlElement.poster),this.internal.poster.jq=e("#"+this.internal.poster.id),this.internal.poster.jq.css({width:this.status.width,height:this.status.height}),this.internal.poster.jq.hide(),this.internal.poster.jq.bind("click.jPlayer",function(){n._trigger(e.jPlayer.event.click)}),this.html.audio.available=!1,this.require.audio&&(this.htmlElement.audio=document.createElement("audio"),this.htmlElement.audio.id=this.internal.audio.id,this.html.audio.available=!!this.htmlElement.audio.canPlayType&&this._testCanPlayType(this.htmlElement.audio)),this.html.video.available=!1,this.require.video&&(this.htmlElement.video=document.createElement("video"),this.htmlElement.video.id=this.internal.video.id,this.html.video.available=!!this.htmlElement.video.canPlayType&&this._testCanPlayType(this.htmlElement.video)),this.flash.available=this._checkForFlash(10.1),this.html.canPlay={},this.aurora.canPlay={},this.flash.canPlay={},e.each(this.formats,function(t,i){n.html.canPlay[i]=n.html[n.format[i].media].available&&""!==n.htmlElement[n.format[i].media].canPlayType(n.format[i].codec),n.aurora.canPlay[i]=e.inArray(i,n.aurora.formats)>-1,n.flash.canPlay[i]=n.format[i].flashCanPlay&&n.flash.available}),this.html.desired=!1,this.aurora.desired=!1,this.flash.desired=!1,e.each(this.solutions,function(t,i){if(0===t)n[i].desired=!0;else{var a=!1,r=!1;e.each(n.formats,function(e,t){n[n.solutions[0]].canPlay[t]&&("video"===n.format[t].media?r=!0:a=!0)}),n[i].desired=n.require.audio&&!a||n.require.video&&!r}}),this.html.support={},this.aurora.support={},this.flash.support={},e.each(this.formats,function(e,t){n.html.support[t]=n.html.canPlay[t]&&n.html.desired,n.aurora.support[t]=n.aurora.canPlay[t]&&n.aurora.desired,n.flash.support[t]=n.flash.canPlay[t]&&n.flash.desired}),this.html.used=!1,this.aurora.used=!1,this.flash.used=!1,e.each(this.solutions,function(t,i){e.each(n.formats,function(e,t){return n[i].support[t]?(n[i].used=!0,!1):void 0})}),this._resetActive(),this._resetGate(),this._cssSelectorAncestor(this.options.cssSelectorAncestor),this.html.used||this.aurora.used||this.flash.used?this.css.jq.noSolution.length&&this.css.jq.noSolution.hide():(this._error({type:e.jPlayer.error.NO_SOLUTION,context:"{solution:'"+this.options.solution+"', supplied:'"+this.options.supplied+"'}",message:e.jPlayer.errorMsg.NO_SOLUTION,hint:e.jPlayer.errorHint.NO_SOLUTION}),this.css.jq.noSolution.length&&this.css.jq.noSolution.show()),this.flash.used){var i,a="jQuery="+encodeURI(this.options.noConflict)+"&id="+encodeURI(this.internal.self.id)+"&vol="+this.options.volume+"&muted="+this.options.muted;if(e.jPlayer.browser.msie&&(Number(e.jPlayer.browser.version)<9||e.jPlayer.browser.documentMode<9)){var r='<object id="'+this.internal.flash.id+'" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" width="0" height="0" tabindex="-1"></object>',o=['<param name="movie" value="'+this.internal.flash.swf+'" />','<param name="FlashVars" value="'+a+'" />','<param name="allowScriptAccess" value="always" />','<param name="bgcolor" value="'+this.options.backgroundColor+'" />','<param name="wmode" value="'+this.options.wmode+'" />'];i=document.createElement(r);for(var s=0;s<o.length;s++)i.appendChild(document.createElement(o[s]))}else{var l=function(e,t,n){var i=document.createElement("param");i.setAttribute("name",t),i.setAttribute("value",n),e.appendChild(i)};i=document.createElement("object"),i.setAttribute("id",this.internal.flash.id),i.setAttribute("name",this.internal.flash.id),i.setAttribute("data",this.internal.flash.swf),i.setAttribute("type","application/x-shockwave-flash"),i.setAttribute("width","1"),i.setAttribute("height","1"),i.setAttribute("tabindex","-1"),l(i,"flashvars",a),l(i,"allowscriptaccess","always"),l(i,"bgcolor",this.options.backgroundColor),l(i,"wmode",this.options.wmode)}this.element.append(i),this.internal.flash.jq=e(i)}this.status.playbackRateEnabled=this.html.used&&!this.flash.used?this._testPlaybackRate("audio"):!1,this._updatePlaybackRate(),this.html.used&&(this.html.audio.available&&(this._addHtmlEventListeners(this.htmlElement.audio,this.html.audio),this.element.append(this.htmlElement.audio),this.internal.audio.jq=e("#"+this.internal.audio.id)),this.html.video.available&&(this._addHtmlEventListeners(this.htmlElement.video,this.html.video),this.element.append(this.htmlElement.video),this.internal.video.jq=e("#"+this.internal.video.id),this.internal.video.jq.css(this.status.nativeVideoControls?{width:this.status.width,height:this.status.height}:{width:"0px",height:"0px"}),this.internal.video.jq.bind("click.jPlayer",function(){n._trigger(e.jPlayer.event.click)}))),this.aurora.used,this.options.emulateHtml&&this._emulateHtmlBridge(),!this.html.used&&!this.aurora.used||this.flash.used||setTimeout(function(){n.internal.ready=!0,n.version.flash="n/a",n._trigger(e.jPlayer.event.repeat),n._trigger(e.jPlayer.event.ready)},100),this._updateNativeVideoControls(),this.css.jq.videoPlay.length&&this.css.jq.videoPlay.hide(),e.jPlayer.prototype.count++},destroy:function(){this.clearMedia(),this._removeUiClass(),this.css.jq.currentTime.length&&this.css.jq.currentTime.text(""),this.css.jq.duration.length&&this.css.jq.duration.text(""),e.each(this.css.jq,function(e,t){t.length&&t.unbind(".jPlayer")}),this.internal.poster.jq.unbind(".jPlayer"),this.internal.video.jq&&this.internal.video.jq.unbind(".jPlayer"),this._fullscreenRemoveEventListeners(),this===e.jPlayer.focus&&(e.jPlayer.focus=null),this.options.emulateHtml&&this._destroyHtmlBridge(),this.element.removeData("jPlayer"),this.element.unbind(".jPlayer"),this.element.empty(),delete this.instances[this.internal.instance]},destroyRemoved:function(){var t=this;e.each(this.instances,function(e,n){t.element!==n&&(n.data("jPlayer")||(n.jPlayer("destroy"),delete t.instances[e]))})},enable:function(){},disable:function(){},_testCanPlayType:function(e){try{return e.canPlayType(this.format.mp3.codec),!0}catch(t){return!1}},_testPlaybackRate:function(e){var t,n=.5;e="string"==typeof e?e:"audio",t=document.createElement(e);try{return"playbackRate"in t?(t.playbackRate=n,t.playbackRate===n):!1}catch(i){return!1}},_uaBlocklist:function(t){var n=navigator.userAgent.toLowerCase(),i=!1;return e.each(t,function(e,t){return t&&t.test(n)?(i=!0,!1):void 0}),i},_restrictNativeVideoControls:function(){this.require.audio&&this.status.nativeVideoControls&&(this.status.nativeVideoControls=!1,this.status.noFullWindow=!0)},_updateNativeVideoControls:function(){this.html.video.available&&this.html.used&&(this.htmlElement.video.controls=this.status.nativeVideoControls,this._updateAutohide(),this.status.nativeVideoControls&&this.require.video?(this.internal.poster.jq.hide(),this.internal.video.jq.css({width:this.status.width,height:this.status.height})):this.status.waitForPlay&&this.status.video&&(this.internal.poster.jq.show(),this.internal.video.jq.css({width:"0px",height:"0px"})))},_addHtmlEventListeners:function(t,n){var i=this;t.preload=this.options.preload,t.muted=this.options.muted,t.volume=this.options.volume,this.status.playbackRateEnabled&&(t.defaultPlaybackRate=this.options.defaultPlaybackRate,t.playbackRate=this.options.playbackRate),t.addEventListener("progress",function(){n.gate&&(i.internal.cmdsIgnored&&this.readyState>0&&(i.internal.cmdsIgnored=!1),i._getHtmlStatus(t),i._updateInterface(),i._trigger(e.jPlayer.event.progress))},!1),t.addEventListener("loadeddata",function(){n.gate&&(i.androidFix.setMedia=!1,i.androidFix.play&&(i.androidFix.play=!1,i.play(i.androidFix.time)),i.androidFix.pause&&(i.androidFix.pause=!1,i.pause(i.androidFix.time)),i._trigger(e.jPlayer.event.loadeddata))},!1),t.addEventListener("timeupdate",function(){n.gate&&(i._getHtmlStatus(t),i._updateInterface(),i._trigger(e.jPlayer.event.timeupdate))},!1),t.addEventListener("durationchange",function(){n.gate&&(i._getHtmlStatus(t),i._updateInterface(),i._trigger(e.jPlayer.event.durationchange))},!1),t.addEventListener("play",function(){n.gate&&(i._updateButtons(!0),i._html_checkWaitForPlay(),i._trigger(e.jPlayer.event.play))},!1),t.addEventListener("playing",function(){n.gate&&(i._updateButtons(!0),i._seeked(),i._trigger(e.jPlayer.event.playing))},!1),t.addEventListener("pause",function(){n.gate&&(i._updateButtons(!1),i._trigger(e.jPlayer.event.pause))},!1),t.addEventListener("waiting",function(){n.gate&&(i._seeking(),i._trigger(e.jPlayer.event.waiting))},!1),t.addEventListener("seeking",function(){n.gate&&(i._seeking(),i._trigger(e.jPlayer.event.seeking))},!1),t.addEventListener("seeked",function(){n.gate&&(i._seeked(),i._trigger(e.jPlayer.event.seeked))},!1),t.addEventListener("volumechange",function(){n.gate&&(i.options.volume=t.volume,i.options.muted=t.muted,i._updateMute(),i._updateVolume(),i._trigger(e.jPlayer.event.volumechange))},!1),t.addEventListener("ratechange",function(){n.gate&&(i.options.defaultPlaybackRate=t.defaultPlaybackRate,i.options.playbackRate=t.playbackRate,i._updatePlaybackRate(),i._trigger(e.jPlayer.event.ratechange))},!1),t.addEventListener("suspend",function(){n.gate&&(i._seeked(),i._trigger(e.jPlayer.event.suspend))},!1),t.addEventListener("ended",function(){n.gate&&(e.jPlayer.browser.webkit||(i.htmlElement.media.currentTime=0),i.htmlElement.media.pause(),i._updateButtons(!1),i._getHtmlStatus(t,!0),i._updateInterface(),i._trigger(e.jPlayer.event.ended))},!1),t.addEventListener("error",function(){n.gate&&(i._updateButtons(!1),i._seeked(),i.status.srcSet&&(clearTimeout(i.internal.htmlDlyCmdId),i.status.waitForLoad=!0,i.status.waitForPlay=!0,i.status.video&&!i.status.nativeVideoControls&&i.internal.video.jq.css({width:"0px",height:"0px"}),i._validString(i.status.media.poster)&&!i.status.nativeVideoControls&&i.internal.poster.jq.show(),i.css.jq.videoPlay.length&&i.css.jq.videoPlay.show(),i._error({type:e.jPlayer.error.URL,context:i.status.src,message:e.jPlayer.errorMsg.URL,hint:e.jPlayer.errorHint.URL})))},!1),e.each(e.jPlayer.htmlEvent,function(a,r){t.addEventListener(this,function(){n.gate&&i._trigger(e.jPlayer.event[r])},!1)})},_addAuroraEventListeners:function(t,n){var i=this;t.volume=100*this.options.volume,t.on("progress",function(){n.gate&&(i.internal.cmdsIgnored&&this.readyState>0&&(i.internal.cmdsIgnored=!1),i._getAuroraStatus(t),i._updateInterface(),i._trigger(e.jPlayer.event.progress),t.duration>0&&i._trigger(e.jPlayer.event.timeupdate))},!1),t.on("ready",function(){n.gate&&i._trigger(e.jPlayer.event.loadeddata)},!1),t.on("duration",function(){n.gate&&(i._getAuroraStatus(t),i._updateInterface(),i._trigger(e.jPlayer.event.durationchange))},!1),t.on("end",function(){n.gate&&(i._updateButtons(!1),i._getAuroraStatus(t,!0),i._updateInterface(),i._trigger(e.jPlayer.event.ended))},!1),t.on("error",function(){n.gate&&(i._updateButtons(!1),i._seeked(),i.status.srcSet&&(i.status.waitForLoad=!0,i.status.waitForPlay=!0,i.status.video&&!i.status.nativeVideoControls&&i.internal.video.jq.css({width:"0px",height:"0px"}),i._validString(i.status.media.poster)&&!i.status.nativeVideoControls&&i.internal.poster.jq.show(),i.css.jq.videoPlay.length&&i.css.jq.videoPlay.show(),i._error({type:e.jPlayer.error.URL,context:i.status.src,message:e.jPlayer.errorMsg.URL,hint:e.jPlayer.errorHint.URL})))},!1)},_getHtmlStatus:function(e,t){var n=0,i=0,a=0,r=0;isFinite(e.duration)&&(this.status.duration=e.duration),n=e.currentTime,i=this.status.duration>0?100*n/this.status.duration:0,"object"==typeof e.seekable&&e.seekable.length>0?(a=this.status.duration>0?100*e.seekable.end(e.seekable.length-1)/this.status.duration:100,r=this.status.duration>0?100*e.currentTime/e.seekable.end(e.seekable.length-1):0):(a=100,r=i),t&&(n=0,r=0,i=0),this.status.seekPercent=a,this.status.currentPercentRelative=r,this.status.currentPercentAbsolute=i,this.status.currentTime=n,this.status.remaining=this.status.duration-this.status.currentTime,this.status.videoWidth=e.videoWidth,this.status.videoHeight=e.videoHeight,this.status.readyState=e.readyState,this.status.networkState=e.networkState,this.status.playbackRate=e.playbackRate,this.status.ended=e.ended},_getAuroraStatus:function(e,t){var n=0,i=0,a=0,r=0;this.status.duration=e.duration/1e3,n=e.currentTime/1e3,i=this.status.duration>0?100*n/this.status.duration:0,e.buffered>0?(a=this.status.duration>0?e.buffered*this.status.duration/this.status.duration:100,r=this.status.duration>0?n/(e.buffered*this.status.duration):0):(a=100,r=i),t&&(n=0,r=0,i=0),this.status.seekPercent=a,this.status.currentPercentRelative=r,this.status.currentPercentAbsolute=i,this.status.currentTime=n,this.status.remaining=this.status.duration-this.status.currentTime,this.status.readyState=4,this.status.networkState=0,this.status.playbackRate=1,this.status.ended=!1},_resetStatus:function(){this.status=e.extend({},this.status,e.jPlayer.prototype.status)},_trigger:function(t,n,i){var a=e.Event(t);a.jPlayer={},a.jPlayer.version=e.extend({},this.version),a.jPlayer.options=e.extend(!0,{},this.options),a.jPlayer.status=e.extend(!0,{},this.status),a.jPlayer.html=e.extend(!0,{},this.html),a.jPlayer.aurora=e.extend(!0,{},this.aurora),a.jPlayer.flash=e.extend(!0,{},this.flash),n&&(a.jPlayer.error=e.extend({},n)),i&&(a.jPlayer.warning=e.extend({},i)),this.element.trigger(a)},jPlayerFlashEvent:function(t,n){if(t===e.jPlayer.event.ready)if(this.internal.ready){if(this.flash.gate){if(this.status.srcSet){var i=this.status.currentTime,a=this.status.paused;this.setMedia(this.status.media),this.volumeWorker(this.options.volume),i>0&&(a?this.pause(i):this.play(i))}this._trigger(e.jPlayer.event.flashreset)}}else this.internal.ready=!0,this.internal.flash.jq.css({width:"0px",height:"0px"}),this.version.flash=n.version,this.version.needFlash!==this.version.flash&&this._error({type:e.jPlayer.error.VERSION,context:this.version.flash,message:e.jPlayer.errorMsg.VERSION+this.version.flash,hint:e.jPlayer.errorHint.VERSION}),this._trigger(e.jPlayer.event.repeat),this._trigger(t);if(this.flash.gate)switch(t){case e.jPlayer.event.progress:this._getFlashStatus(n),this._updateInterface(),this._trigger(t);break;case e.jPlayer.event.timeupdate:this._getFlashStatus(n),this._updateInterface(),this._trigger(t);break;case e.jPlayer.event.play:this._seeked(),this._updateButtons(!0),this._trigger(t);break;case e.jPlayer.event.pause:this._updateButtons(!1),this._trigger(t);break;case e.jPlayer.event.ended:this._updateButtons(!1),this._trigger(t);break;case e.jPlayer.event.click:this._trigger(t);break;case e.jPlayer.event.error:this.status.waitForLoad=!0,this.status.waitForPlay=!0,this.status.video&&this.internal.flash.jq.css({width:"0px",height:"0px"}),this._validString(this.status.media.poster)&&this.internal.poster.jq.show(),this.css.jq.videoPlay.length&&this.status.video&&this.css.jq.videoPlay.show(),this.status.video?this._flash_setVideo(this.status.media):this._flash_setAudio(this.status.media),this._updateButtons(!1),this._error({type:e.jPlayer.error.URL,context:n.src,message:e.jPlayer.errorMsg.URL,hint:e.jPlayer.errorHint.URL});break;case e.jPlayer.event.seeking:this._seeking(),this._trigger(t);break;case e.jPlayer.event.seeked:this._seeked(),this._trigger(t);break;case e.jPlayer.event.ready:break;default:this._trigger(t)}return!1},_getFlashStatus:function(e){this.status.seekPercent=e.seekPercent,this.status.currentPercentRelative=e.currentPercentRelative,this.status.currentPercentAbsolute=e.currentPercentAbsolute,this.status.currentTime=e.currentTime,this.status.duration=e.duration,this.status.remaining=e.duration-e.currentTime,this.status.videoWidth=e.videoWidth,this.status.videoHeight=e.videoHeight,this.status.readyState=4,this.status.networkState=0,this.status.playbackRate=1,this.status.ended=!1},_updateButtons:function(e){e===t?e=!this.status.paused:this.status.paused=!e,e?this.addStateClass("playing"):this.removeStateClass("playing"),!this.status.noFullWindow&&this.options.fullWindow?this.addStateClass("fullScreen"):this.removeStateClass("fullScreen"),this.options.loop?this.addStateClass("looped"):this.removeStateClass("looped"),this.css.jq.play.length&&this.css.jq.pause.length&&(e?(this.css.jq.play.hide(),this.css.jq.pause.show()):(this.css.jq.play.show(),this.css.jq.pause.hide())),this.css.jq.restoreScreen.length&&this.css.jq.fullScreen.length&&(this.status.noFullWindow?(this.css.jq.fullScreen.hide(),this.css.jq.restoreScreen.hide()):this.options.fullWindow?(this.css.jq.fullScreen.hide(),this.css.jq.restoreScreen.show()):(this.css.jq.fullScreen.show(),this.css.jq.restoreScreen.hide())),this.css.jq.repeat.length&&this.css.jq.repeatOff.length&&(this.options.loop?(this.css.jq.repeat.hide(),this.css.jq.repeatOff.show()):(this.css.jq.repeat.show(),this.css.jq.repeatOff.hide()))},_updateInterface:function(){this.css.jq.seekBar.length&&this.css.jq.seekBar.width(this.status.seekPercent+"%"),this.css.jq.playBar.length&&(this.options.smoothPlayBar?this.css.jq.playBar.stop().animate({width:this.status.currentPercentAbsolute+"%"},250,"linear"):this.css.jq.playBar.width(this.status.currentPercentRelative+"%"));var e="";this.css.jq.currentTime.length&&(e=this._convertTime(this.status.currentTime),e!==this.css.jq.currentTime.text()&&this.css.jq.currentTime.text(this._convertTime(this.status.currentTime)));var t="",n=this.status.duration,i=this.status.remaining;this.css.jq.duration.length&&("string"==typeof this.status.media.duration?t=this.status.media.duration:("number"==typeof this.status.media.duration&&(n=this.status.media.duration,i=n-this.status.currentTime),t=this.options.remainingDuration?(i>0?"-":"")+this._convertTime(i):this._convertTime(n)),t!==this.css.jq.duration.text()&&this.css.jq.duration.text(t))},_convertTime:n.prototype.time,_seeking:function(){this.css.jq.seekBar.length&&this.css.jq.seekBar.addClass("jp-seeking-bg"),this.addStateClass("seeking")},_seeked:function(){this.css.jq.seekBar.length&&this.css.jq.seekBar.removeClass("jp-seeking-bg"),this.removeStateClass("seeking")},_resetGate:function(){this.html.audio.gate=!1,this.html.video.gate=!1,this.aurora.gate=!1,this.flash.gate=!1},_resetActive:function(){this.html.active=!1,this.aurora.active=!1,this.flash.active=!1},_escapeHtml:function(e){return e.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;").split('"').join("&quot;")},_qualifyURL:function(e){var t=document.createElement("div");return t.innerHTML='<a href="'+this._escapeHtml(e)+'">x</a>',t.firstChild.href},_absoluteMediaUrls:function(t){var n=this;return e.each(t,function(e,i){i&&n.format[e]&&"data:"!==i.substr(0,5)&&(t[e]=n._qualifyURL(i))}),t},addStateClass:function(e){this.ancestorJq.length&&this.ancestorJq.addClass(this.options.stateClass[e])},removeStateClass:function(e){this.ancestorJq.length&&this.ancestorJq.removeClass(this.options.stateClass[e])},setMedia:function(t){var n=this,i=!1,a=this.status.media.poster!==t.poster;this._resetMedia(),this._resetGate(),this._resetActive(),this.androidFix.setMedia=!1,this.androidFix.play=!1,this.androidFix.pause=!1,t=this._absoluteMediaUrls(t),e.each(this.formats,function(a,r){var o="video"===n.format[r].media;return e.each(n.solutions,function(a,s){if(n[s].support[r]&&n._validString(t[r])){var l="html"===s,d="aurora"===s;return o?(l?(n.html.video.gate=!0,n._html_setVideo(t),n.html.active=!0):(n.flash.gate=!0,n._flash_setVideo(t),n.flash.active=!0),n.css.jq.videoPlay.length&&n.css.jq.videoPlay.show(),n.status.video=!0):(l?(n.html.audio.gate=!0,n._html_setAudio(t),n.html.active=!0,e.jPlayer.platform.android&&(n.androidFix.setMedia=!0)):d?(n.aurora.gate=!0,n._aurora_setAudio(t),n.aurora.active=!0):(n.flash.gate=!0,n._flash_setAudio(t),n.flash.active=!0),n.css.jq.videoPlay.length&&n.css.jq.videoPlay.hide(),n.status.video=!1),i=!0,!1}}),i?!1:void 0}),i?(this.status.nativeVideoControls&&this.html.video.gate||this._validString(t.poster)&&(a?this.htmlElement.poster.src=t.poster:this.internal.poster.jq.show()),"string"==typeof t.title&&(this.css.jq.title.length&&this.css.jq.title.html(t.title),this.htmlElement.audio&&this.htmlElement.audio.setAttribute("title",t.title),this.htmlElement.video&&this.htmlElement.video.setAttribute("title",t.title)),this.status.srcSet=!0,this.status.media=e.extend({},t),this._updateButtons(!1),this._updateInterface(),this._trigger(e.jPlayer.event.setmedia)):this._error({type:e.jPlayer.error.NO_SUPPORT,context:"{supplied:'"+this.options.supplied+"'}",message:e.jPlayer.errorMsg.NO_SUPPORT,hint:e.jPlayer.errorHint.NO_SUPPORT})},_resetMedia:function(){this._resetStatus(),this._updateButtons(!1),this._updateInterface(),this._seeked(),this.internal.poster.jq.hide(),clearTimeout(this.internal.htmlDlyCmdId),this.html.active?this._html_resetMedia():this.aurora.active?this._aurora_resetMedia():this.flash.active&&this._flash_resetMedia()},clearMedia:function(){this._resetMedia(),this.html.active?this._html_clearMedia():this.aurora.active?this._aurora_clearMedia():this.flash.active&&this._flash_clearMedia(),this._resetGate(),this._resetActive()},load:function(){this.status.srcSet?this.html.active?this._html_load():this.aurora.active?this._aurora_load():this.flash.active&&this._flash_load():this._urlNotSetError("load")},focus:function(){this.options.keyEnabled&&(e.jPlayer.focus=this)},play:function(e){var t="object"==typeof e;t&&this.options.useStateClassSkin&&!this.status.paused?this.pause(e):(e="number"==typeof e?e:0/0,this.status.srcSet?(this.focus(),this.html.active?this._html_play(e):this.aurora.active?this._aurora_play(e):this.flash.active&&this._flash_play(e)):this._urlNotSetError("play"))},videoPlay:function(){this.play()},pause:function(e){e="number"==typeof e?e:0/0,this.status.srcSet?this.html.active?this._html_pause(e):this.aurora.active?this._aurora_pause(e):this.flash.active&&this._flash_pause(e):this._urlNotSetError("pause")},tellOthers:function(t,n){var i=this,a="function"==typeof n,r=Array.prototype.slice.call(arguments);"string"==typeof t&&(a&&r.splice(1,1),e.jPlayer.prototype.destroyRemoved(),e.each(this.instances,function(){i.element!==this&&(!a||n.call(this.data("jPlayer"),i))&&this.jPlayer.apply(this,r)}))},pauseOthers:function(e){this.tellOthers("pause",function(){return this.status.srcSet},e)},stop:function(){this.status.srcSet?this.html.active?this._html_pause(0):this.aurora.active?this._aurora_pause(0):this.flash.active&&this._flash_pause(0):this._urlNotSetError("stop")},playHead:function(e){e=this._limitValue(e,0,100),this.status.srcSet?this.html.active?this._html_playHead(e):this.aurora.active?this._aurora_playHead(e):this.flash.active&&this._flash_playHead(e):this._urlNotSetError("playHead")},_muted:function(e){this.mutedWorker(e),this.options.globalVolume&&this.tellOthers("mutedWorker",function(){return this.options.globalVolume},e)},mutedWorker:function(t){this.options.muted=t,this.html.used&&this._html_setProperty("muted",t),this.aurora.used&&this._aurora_mute(t),this.flash.used&&this._flash_mute(t),this.html.video.gate||this.html.audio.gate||(this._updateMute(t),this._updateVolume(this.options.volume),this._trigger(e.jPlayer.event.volumechange))},mute:function(e){var n="object"==typeof e;n&&this.options.useStateClassSkin&&this.options.muted?this._muted(!1):(e=e===t?!0:!!e,this._muted(e))},unmute:function(e){e=e===t?!0:!!e,this._muted(!e)},_updateMute:function(e){e===t&&(e=this.options.muted),e?this.addStateClass("muted"):this.removeStateClass("muted"),this.css.jq.mute.length&&this.css.jq.unmute.length&&(this.status.noVolume?(this.css.jq.mute.hide(),this.css.jq.unmute.hide()):e?(this.css.jq.mute.hide(),this.css.jq.unmute.show()):(this.css.jq.mute.show(),this.css.jq.unmute.hide()))},volume:function(e){this.volumeWorker(e),this.options.globalVolume&&this.tellOthers("volumeWorker",function(){return this.options.globalVolume},e)},volumeWorker:function(t){t=this._limitValue(t,0,1),this.options.volume=t,this.html.used&&this._html_setProperty("volume",t),this.aurora.used&&this._aurora_volume(t),this.flash.used&&this._flash_volume(t),this.html.video.gate||this.html.audio.gate||(this._updateVolume(t),this._trigger(e.jPlayer.event.volumechange))},volumeBar:function(t){if(this.css.jq.volumeBar.length){var n=e(t.currentTarget),i=n.offset(),a=t.pageX-i.left,r=n.width(),o=n.height()-t.pageY+i.top,s=n.height();this.volume(this.options.verticalVolume?o/s:a/r)}this.options.muted&&this._muted(!1)},_updateVolume:function(e){e===t&&(e=this.options.volume),e=this.options.muted?0:e,this.status.noVolume?(this.addStateClass("noVolume"),this.css.jq.volumeBar.length&&this.css.jq.volumeBar.hide(),this.css.jq.volumeBarValue.length&&this.css.jq.volumeBarValue.hide(),this.css.jq.volumeMax.length&&this.css.jq.volumeMax.hide()):(this.removeStateClass("noVolume"),this.css.jq.volumeBar.length&&this.css.jq.volumeBar.show(),this.css.jq.volumeBarValue.length&&(this.css.jq.volumeBarValue.show(),this.css.jq.volumeBarValue[this.options.verticalVolume?"height":"width"](100*e+"%")),this.css.jq.volumeMax.length&&this.css.jq.volumeMax.show())},volumeMax:function(){this.volume(1),this.options.muted&&this._muted(!1)},_cssSelectorAncestor:function(t){var n=this;this.options.cssSelectorAncestor=t,this._removeUiClass(),this.ancestorJq=t?e(t):[],t&&1!==this.ancestorJq.length&&this._warning({type:e.jPlayer.warning.CSS_SELECTOR_COUNT,context:t,message:e.jPlayer.warningMsg.CSS_SELECTOR_COUNT+this.ancestorJq.length+" found for cssSelectorAncestor.",hint:e.jPlayer.warningHint.CSS_SELECTOR_COUNT}),this._addUiClass(),e.each(this.options.cssSelector,function(e,t){n._cssSelector(e,t)}),this._updateInterface(),this._updateButtons(),this._updateAutohide(),this._updateVolume(),this._updateMute()},_cssSelector:function(t,n){var i=this;if("string"==typeof n)if(e.jPlayer.prototype.options.cssSelector[t]){if(this.css.jq[t]&&this.css.jq[t].length&&this.css.jq[t].unbind(".jPlayer"),this.options.cssSelector[t]=n,this.css.cs[t]=this.options.cssSelectorAncestor+" "+n,this.css.jq[t]=n?e(this.css.cs[t]):[],this.css.jq[t].length&&this[t]){var a=function(n){n.preventDefault(),i[t](n),i.options.autoBlur?e(this).blur():e(this).focus()
};this.css.jq[t].bind("click.jPlayer",a)}n&&1!==this.css.jq[t].length&&this._warning({type:e.jPlayer.warning.CSS_SELECTOR_COUNT,context:this.css.cs[t],message:e.jPlayer.warningMsg.CSS_SELECTOR_COUNT+this.css.jq[t].length+" found for "+t+" method.",hint:e.jPlayer.warningHint.CSS_SELECTOR_COUNT})}else this._warning({type:e.jPlayer.warning.CSS_SELECTOR_METHOD,context:t,message:e.jPlayer.warningMsg.CSS_SELECTOR_METHOD,hint:e.jPlayer.warningHint.CSS_SELECTOR_METHOD});else this._warning({type:e.jPlayer.warning.CSS_SELECTOR_STRING,context:n,message:e.jPlayer.warningMsg.CSS_SELECTOR_STRING,hint:e.jPlayer.warningHint.CSS_SELECTOR_STRING})},duration:function(e){this.options.toggleDuration&&(this.options.captureDuration&&e.stopPropagation(),this._setOption("remainingDuration",!this.options.remainingDuration))},seekBar:function(t){if(this.css.jq.seekBar.length){var n=e(t.currentTarget),i=n.offset(),a=t.pageX-i.left,r=n.width(),o=100*a/r;this.playHead(o)}},playbackRate:function(e){this._setOption("playbackRate",e)},playbackRateBar:function(t){if(this.css.jq.playbackRateBar.length){var n,i,a=e(t.currentTarget),r=a.offset(),o=t.pageX-r.left,s=a.width(),l=a.height()-t.pageY+r.top,d=a.height();n=this.options.verticalPlaybackRate?l/d:o/s,i=n*(this.options.maxPlaybackRate-this.options.minPlaybackRate)+this.options.minPlaybackRate,this.playbackRate(i)}},_updatePlaybackRate:function(){var e=this.options.playbackRate,t=(e-this.options.minPlaybackRate)/(this.options.maxPlaybackRate-this.options.minPlaybackRate);this.status.playbackRateEnabled?(this.css.jq.playbackRateBar.length&&this.css.jq.playbackRateBar.show(),this.css.jq.playbackRateBarValue.length&&(this.css.jq.playbackRateBarValue.show(),this.css.jq.playbackRateBarValue[this.options.verticalPlaybackRate?"height":"width"](100*t+"%"))):(this.css.jq.playbackRateBar.length&&this.css.jq.playbackRateBar.hide(),this.css.jq.playbackRateBarValue.length&&this.css.jq.playbackRateBarValue.hide())},repeat:function(e){var t="object"==typeof e;this._loop(t&&this.options.useStateClassSkin&&this.options.loop?!1:!0)},repeatOff:function(){this._loop(!1)},_loop:function(t){this.options.loop!==t&&(this.options.loop=t,this._updateButtons(),this._trigger(e.jPlayer.event.repeat))},option:function(n,i){var a=n;if(0===arguments.length)return e.extend(!0,{},this.options);if("string"==typeof n){var r=n.split(".");if(i===t){for(var o=e.extend(!0,{},this.options),s=0;s<r.length;s++){if(o[r[s]]===t)return this._warning({type:e.jPlayer.warning.OPTION_KEY,context:n,message:e.jPlayer.warningMsg.OPTION_KEY,hint:e.jPlayer.warningHint.OPTION_KEY}),t;o=o[r[s]]}return o}a={};for(var l=a,d=0;d<r.length;d++)d<r.length-1?(l[r[d]]={},l=l[r[d]]):l[r[d]]=i}return this._setOptions(a),this},_setOptions:function(t){var n=this;return e.each(t,function(e,t){n._setOption(e,t)}),this},_setOption:function(t,n){var i=this;switch(t){case"volume":this.volume(n);break;case"muted":this._muted(n);break;case"globalVolume":this.options[t]=n;break;case"cssSelectorAncestor":this._cssSelectorAncestor(n);break;case"cssSelector":e.each(n,function(e,t){i._cssSelector(e,t)});break;case"playbackRate":this.options[t]=n=this._limitValue(n,this.options.minPlaybackRate,this.options.maxPlaybackRate),this.html.used&&this._html_setProperty("playbackRate",n),this._updatePlaybackRate();break;case"defaultPlaybackRate":this.options[t]=n=this._limitValue(n,this.options.minPlaybackRate,this.options.maxPlaybackRate),this.html.used&&this._html_setProperty("defaultPlaybackRate",n),this._updatePlaybackRate();break;case"minPlaybackRate":this.options[t]=n=this._limitValue(n,.1,this.options.maxPlaybackRate-.1),this._updatePlaybackRate();break;case"maxPlaybackRate":this.options[t]=n=this._limitValue(n,this.options.minPlaybackRate+.1,16),this._updatePlaybackRate();break;case"fullScreen":if(this.options[t]!==n){var a=e.jPlayer.nativeFeatures.fullscreen.used.webkitVideo;(!a||a&&!this.status.waitForPlay)&&(a||(this.options[t]=n),n?this._requestFullscreen():this._exitFullscreen(),a||this._setOption("fullWindow",n))}break;case"fullWindow":this.options[t]!==n&&(this._removeUiClass(),this.options[t]=n,this._refreshSize());break;case"size":this.options.fullWindow||this.options[t].cssClass===n.cssClass||this._removeUiClass(),this.options[t]=e.extend({},this.options[t],n),this._refreshSize();break;case"sizeFull":this.options.fullWindow&&this.options[t].cssClass!==n.cssClass&&this._removeUiClass(),this.options[t]=e.extend({},this.options[t],n),this._refreshSize();break;case"autohide":this.options[t]=e.extend({},this.options[t],n),this._updateAutohide();break;case"loop":this._loop(n);break;case"remainingDuration":this.options[t]=n,this._updateInterface();break;case"toggleDuration":this.options[t]=n;break;case"nativeVideoControls":this.options[t]=e.extend({},this.options[t],n),this.status.nativeVideoControls=this._uaBlocklist(this.options.nativeVideoControls),this._restrictNativeVideoControls(),this._updateNativeVideoControls();break;case"noFullWindow":this.options[t]=e.extend({},this.options[t],n),this.status.nativeVideoControls=this._uaBlocklist(this.options.nativeVideoControls),this.status.noFullWindow=this._uaBlocklist(this.options.noFullWindow),this._restrictNativeVideoControls(),this._updateButtons();break;case"noVolume":this.options[t]=e.extend({},this.options[t],n),this.status.noVolume=this._uaBlocklist(this.options.noVolume),this._updateVolume(),this._updateMute();break;case"emulateHtml":this.options[t]!==n&&(this.options[t]=n,n?this._emulateHtmlBridge():this._destroyHtmlBridge());break;case"timeFormat":this.options[t]=e.extend({},this.options[t],n);break;case"keyEnabled":this.options[t]=n,n||this!==e.jPlayer.focus||(e.jPlayer.focus=null);break;case"keyBindings":this.options[t]=e.extend(!0,{},this.options[t],n);break;case"audioFullScreen":this.options[t]=n;break;case"autoBlur":this.options[t]=n}return this},_refreshSize:function(){this._setSize(),this._addUiClass(),this._updateSize(),this._updateButtons(),this._updateAutohide(),this._trigger(e.jPlayer.event.resize)},_setSize:function(){this.options.fullWindow?(this.status.width=this.options.sizeFull.width,this.status.height=this.options.sizeFull.height,this.status.cssClass=this.options.sizeFull.cssClass):(this.status.width=this.options.size.width,this.status.height=this.options.size.height,this.status.cssClass=this.options.size.cssClass),this.element.css({width:this.status.width,height:this.status.height})},_addUiClass:function(){this.ancestorJq.length&&this.ancestorJq.addClass(this.status.cssClass)},_removeUiClass:function(){this.ancestorJq.length&&this.ancestorJq.removeClass(this.status.cssClass)},_updateSize:function(){this.internal.poster.jq.css({width:this.status.width,height:this.status.height}),!this.status.waitForPlay&&this.html.active&&this.status.video||this.html.video.available&&this.html.used&&this.status.nativeVideoControls?this.internal.video.jq.css({width:this.status.width,height:this.status.height}):!this.status.waitForPlay&&this.flash.active&&this.status.video&&this.internal.flash.jq.css({width:this.status.width,height:this.status.height})},_updateAutohide:function(){var e=this,t="mousemove.jPlayer",n=".jPlayerAutohide",i=t+n,a=function(t){var n,i,a=!1;"undefined"!=typeof e.internal.mouse?(n=e.internal.mouse.x-t.pageX,i=e.internal.mouse.y-t.pageY,a=Math.floor(n)>0||Math.floor(i)>0):a=!0,e.internal.mouse={x:t.pageX,y:t.pageY},a&&e.css.jq.gui.fadeIn(e.options.autohide.fadeIn,function(){clearTimeout(e.internal.autohideId),e.internal.autohideId=setTimeout(function(){e.css.jq.gui.fadeOut(e.options.autohide.fadeOut)},e.options.autohide.hold)})};this.css.jq.gui.length&&(this.css.jq.gui.stop(!0,!0),clearTimeout(this.internal.autohideId),delete this.internal.mouse,this.element.unbind(n),this.css.jq.gui.unbind(n),this.status.nativeVideoControls?this.css.jq.gui.hide():this.options.fullWindow&&this.options.autohide.full||!this.options.fullWindow&&this.options.autohide.restored?(this.element.bind(i,a),this.css.jq.gui.bind(i,a),this.css.jq.gui.hide()):this.css.jq.gui.show())},fullScreen:function(e){var t="object"==typeof e;t&&this.options.useStateClassSkin&&this.options.fullScreen?this._setOption("fullScreen",!1):this._setOption("fullScreen",!0)},restoreScreen:function(){this._setOption("fullScreen",!1)},_fullscreenAddEventListeners:function(){var t=this,n=e.jPlayer.nativeFeatures.fullscreen;n.api.fullscreenEnabled&&n.event.fullscreenchange&&("function"!=typeof this.internal.fullscreenchangeHandler&&(this.internal.fullscreenchangeHandler=function(){t._fullscreenchange()}),document.addEventListener(n.event.fullscreenchange,this.internal.fullscreenchangeHandler,!1))},_fullscreenRemoveEventListeners:function(){var t=e.jPlayer.nativeFeatures.fullscreen;this.internal.fullscreenchangeHandler&&document.removeEventListener(t.event.fullscreenchange,this.internal.fullscreenchangeHandler,!1)},_fullscreenchange:function(){this.options.fullScreen&&!e.jPlayer.nativeFeatures.fullscreen.api.fullscreenElement()&&this._setOption("fullScreen",!1)},_requestFullscreen:function(){var t=this.ancestorJq.length?this.ancestorJq[0]:this.element[0],n=e.jPlayer.nativeFeatures.fullscreen;n.used.webkitVideo&&(t=this.htmlElement.video),n.api.fullscreenEnabled&&n.api.requestFullscreen(t)},_exitFullscreen:function(){var t,n=e.jPlayer.nativeFeatures.fullscreen;n.used.webkitVideo&&(t=this.htmlElement.video),n.api.fullscreenEnabled&&n.api.exitFullscreen(t)},_html_initMedia:function(t){var n=e(this.htmlElement.media).empty();e.each(t.track||[],function(e,t){var i=document.createElement("track");i.setAttribute("kind",t.kind?t.kind:""),i.setAttribute("src",t.src?t.src:""),i.setAttribute("srclang",t.srclang?t.srclang:""),i.setAttribute("label",t.label?t.label:""),t.def&&i.setAttribute("default",t.def),n.append(i)}),this.htmlElement.media.src=this.status.src,"none"!==this.options.preload&&this._html_load(),this._trigger(e.jPlayer.event.timeupdate)},_html_setFormat:function(t){var n=this;e.each(this.formats,function(e,i){return n.html.support[i]&&t[i]?(n.status.src=t[i],n.status.format[i]=!0,n.status.formatType=i,!1):void 0})},_html_setAudio:function(e){this._html_setFormat(e),this.htmlElement.media=this.htmlElement.audio,this._html_initMedia(e)},_html_setVideo:function(e){this._html_setFormat(e),this.status.nativeVideoControls&&(this.htmlElement.video.poster=this._validString(e.poster)?e.poster:""),this.htmlElement.media=this.htmlElement.video,this._html_initMedia(e)},_html_resetMedia:function(){this.htmlElement.media&&(this.htmlElement.media.id!==this.internal.video.id||this.status.nativeVideoControls||this.internal.video.jq.css({width:"0px",height:"0px"}),this.htmlElement.media.pause())},_html_clearMedia:function(){this.htmlElement.media&&(this.htmlElement.media.src="about:blank",this.htmlElement.media.load())},_html_load:function(){this.status.waitForLoad&&(this.status.waitForLoad=!1,this.htmlElement.media.load()),clearTimeout(this.internal.htmlDlyCmdId)},_html_play:function(e){var t=this,n=this.htmlElement.media;if(this.androidFix.pause=!1,this._html_load(),this.androidFix.setMedia)this.androidFix.play=!0,this.androidFix.time=e;else if(isNaN(e))n.play();else{this.internal.cmdsIgnored&&n.play();try{if(n.seekable&&!("object"==typeof n.seekable&&n.seekable.length>0))throw 1;n.currentTime=e,n.play()}catch(i){return void(this.internal.htmlDlyCmdId=setTimeout(function(){t.play(e)},250))}}this._html_checkWaitForPlay()},_html_pause:function(e){var t=this,n=this.htmlElement.media;if(this.androidFix.play=!1,e>0?this._html_load():clearTimeout(this.internal.htmlDlyCmdId),n.pause(),this.androidFix.setMedia)this.androidFix.pause=!0,this.androidFix.time=e;else if(!isNaN(e))try{if(n.seekable&&!("object"==typeof n.seekable&&n.seekable.length>0))throw 1;n.currentTime=e}catch(i){return void(this.internal.htmlDlyCmdId=setTimeout(function(){t.pause(e)},250))}e>0&&this._html_checkWaitForPlay()},_html_playHead:function(e){var t=this,n=this.htmlElement.media;this._html_load();try{if("object"==typeof n.seekable&&n.seekable.length>0)n.currentTime=e*n.seekable.end(n.seekable.length-1)/100;else{if(!(n.duration>0)||isNaN(n.duration))throw"e";n.currentTime=e*n.duration/100}}catch(i){return void(this.internal.htmlDlyCmdId=setTimeout(function(){t.playHead(e)},250))}this.status.waitForLoad||this._html_checkWaitForPlay()},_html_checkWaitForPlay:function(){this.status.waitForPlay&&(this.status.waitForPlay=!1,this.css.jq.videoPlay.length&&this.css.jq.videoPlay.hide(),this.status.video&&(this.internal.poster.jq.hide(),this.internal.video.jq.css({width:this.status.width,height:this.status.height})))},_html_setProperty:function(e,t){this.html.audio.available&&(this.htmlElement.audio[e]=t),this.html.video.available&&(this.htmlElement.video[e]=t)},_aurora_setAudio:function(t){var n=this;e.each(this.formats,function(e,i){return n.aurora.support[i]&&t[i]?(n.status.src=t[i],n.status.format[i]=!0,n.status.formatType=i,!1):void 0}),this.aurora.player=new AV.Player.fromURL(this.status.src),this._addAuroraEventListeners(this.aurora.player,this.aurora),"auto"===this.options.preload&&(this._aurora_load(),this.status.waitForLoad=!1)},_aurora_resetMedia:function(){this.aurora.player&&this.aurora.player.stop()},_aurora_clearMedia:function(){},_aurora_load:function(){this.status.waitForLoad&&(this.status.waitForLoad=!1,this.aurora.player.preload())},_aurora_play:function(t){this.status.waitForLoad||isNaN(t)||this.aurora.player.seek(t),this.aurora.player.playing||this.aurora.player.play(),this.status.waitForLoad=!1,this._aurora_checkWaitForPlay(),this._updateButtons(!0),this._trigger(e.jPlayer.event.play)},_aurora_pause:function(t){isNaN(t)||this.aurora.player.seek(1e3*t),this.aurora.player.pause(),t>0&&this._aurora_checkWaitForPlay(),this._updateButtons(!1),this._trigger(e.jPlayer.event.pause)},_aurora_playHead:function(e){this.aurora.player.duration>0&&this.aurora.player.seek(e*this.aurora.player.duration/100),this.status.waitForLoad||this._aurora_checkWaitForPlay()},_aurora_checkWaitForPlay:function(){this.status.waitForPlay&&(this.status.waitForPlay=!1)},_aurora_volume:function(e){this.aurora.player.volume=100*e},_aurora_mute:function(e){e?(this.aurora.properties.lastvolume=this.aurora.player.volume,this.aurora.player.volume=0):this.aurora.player.volume=this.aurora.properties.lastvolume,this.aurora.properties.muted=e},_flash_setAudio:function(t){var n=this;try{e.each(this.formats,function(e,i){if(n.flash.support[i]&&t[i]){switch(i){case"m4a":case"fla":n._getMovie().fl_setAudio_m4a(t[i]);break;case"mp3":n._getMovie().fl_setAudio_mp3(t[i]);break;case"rtmpa":n._getMovie().fl_setAudio_rtmp(t[i])}return n.status.src=t[i],n.status.format[i]=!0,n.status.formatType=i,!1}}),"auto"===this.options.preload&&(this._flash_load(),this.status.waitForLoad=!1)}catch(i){this._flashError(i)}},_flash_setVideo:function(t){var n=this;try{e.each(this.formats,function(e,i){if(n.flash.support[i]&&t[i]){switch(i){case"m4v":case"flv":n._getMovie().fl_setVideo_m4v(t[i]);break;case"rtmpv":n._getMovie().fl_setVideo_rtmp(t[i])}return n.status.src=t[i],n.status.format[i]=!0,n.status.formatType=i,!1}}),"auto"===this.options.preload&&(this._flash_load(),this.status.waitForLoad=!1)}catch(i){this._flashError(i)}},_flash_resetMedia:function(){this.internal.flash.jq.css({width:"0px",height:"0px"}),this._flash_pause(0/0)},_flash_clearMedia:function(){try{this._getMovie().fl_clearMedia()}catch(e){this._flashError(e)}},_flash_load:function(){try{this._getMovie().fl_load()}catch(e){this._flashError(e)}this.status.waitForLoad=!1},_flash_play:function(e){try{this._getMovie().fl_play(e)}catch(t){this._flashError(t)}this.status.waitForLoad=!1,this._flash_checkWaitForPlay()},_flash_pause:function(e){try{this._getMovie().fl_pause(e)}catch(t){this._flashError(t)}e>0&&(this.status.waitForLoad=!1,this._flash_checkWaitForPlay())},_flash_playHead:function(e){try{this._getMovie().fl_play_head(e)}catch(t){this._flashError(t)}this.status.waitForLoad||this._flash_checkWaitForPlay()},_flash_checkWaitForPlay:function(){this.status.waitForPlay&&(this.status.waitForPlay=!1,this.css.jq.videoPlay.length&&this.css.jq.videoPlay.hide(),this.status.video&&(this.internal.poster.jq.hide(),this.internal.flash.jq.css({width:this.status.width,height:this.status.height})))},_flash_volume:function(e){try{this._getMovie().fl_volume(e)}catch(t){this._flashError(t)}},_flash_mute:function(e){try{this._getMovie().fl_mute(e)}catch(t){this._flashError(t)}},_getMovie:function(){return document[this.internal.flash.id]},_getFlashPluginVersion:function(){var e,t=0;if(window.ActiveXObject)try{if(e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")){var n=e.GetVariable("$version");n&&(n=n.split(" ")[1].split(","),t=parseInt(n[0],10)+"."+parseInt(n[1],10))}}catch(i){}else navigator.plugins&&navigator.mimeTypes.length>0&&(e=navigator.plugins["Shockwave Flash"],e&&(t=navigator.plugins["Shockwave Flash"].description.replace(/.*\s(\d+\.\d+).*/,"$1")));return 1*t},_checkForFlash:function(e){var t=!1;return this._getFlashPluginVersion()>=e&&(t=!0),t},_validString:function(e){return e&&"string"==typeof e},_limitValue:function(e,t,n){return t>e?t:e>n?n:e},_urlNotSetError:function(t){this._error({type:e.jPlayer.error.URL_NOT_SET,context:t,message:e.jPlayer.errorMsg.URL_NOT_SET,hint:e.jPlayer.errorHint.URL_NOT_SET})},_flashError:function(t){var n;n=this.internal.ready?"FLASH_DISABLED":"FLASH",this._error({type:e.jPlayer.error[n],context:this.internal.flash.swf,message:e.jPlayer.errorMsg[n]+t.message,hint:e.jPlayer.errorHint[n]}),this.internal.flash.jq.css({width:"1px",height:"1px"})},_error:function(t){this._trigger(e.jPlayer.event.error,t),this.options.errorAlerts&&this._alert("Error!"+(t.message?"\n"+t.message:"")+(t.hint?"\n"+t.hint:"")+"\nContext: "+t.context)},_warning:function(n){this._trigger(e.jPlayer.event.warning,t,n),this.options.warningAlerts&&this._alert("Warning!"+(n.message?"\n"+n.message:"")+(n.hint?"\n"+n.hint:"")+"\nContext: "+n.context)},_alert:function(e){var t="jPlayer "+this.version.script+" : id='"+this.internal.self.id+"' : "+e;this.options.consoleAlerts?window.console&&window.console.log&&window.console.log(t):alert(t)},_emulateHtmlBridge:function(){var t=this;e.each(e.jPlayer.emulateMethods.split(/\s+/g),function(e,n){t.internal.domNode[n]=function(e){t[n](e)}}),e.each(e.jPlayer.event,function(n,i){var a=!0;e.each(e.jPlayer.reservedEvent.split(/\s+/g),function(e,t){return t===n?(a=!1,!1):void 0}),a&&t.element.bind(i+".jPlayer.jPlayerHtml",function(){t._emulateHtmlUpdate();var e=document.createEvent("Event");e.initEvent(n,!1,!0),t.internal.domNode.dispatchEvent(e)})})},_emulateHtmlUpdate:function(){var t=this;e.each(e.jPlayer.emulateStatus.split(/\s+/g),function(e,n){t.internal.domNode[n]=t.status[n]}),e.each(e.jPlayer.emulateOptions.split(/\s+/g),function(e,n){t.internal.domNode[n]=t.options[n]})},_destroyHtmlBridge:function(){var t=this;this.element.unbind(".jPlayerHtml");var n=e.jPlayer.emulateMethods+" "+e.jPlayer.emulateStatus+" "+e.jPlayer.emulateOptions;e.each(n.split(/\s+/g),function(e,n){delete t.internal.domNode[n]})}},e.jPlayer.error={FLASH:"e_flash",FLASH_DISABLED:"e_flash_disabled",NO_SOLUTION:"e_no_solution",NO_SUPPORT:"e_no_support",URL:"e_url",URL_NOT_SET:"e_url_not_set",VERSION:"e_version"},e.jPlayer.errorMsg={FLASH:"jPlayer's Flash fallback is not configured correctly, or a command was issued before the jPlayer Ready event. Details: ",FLASH_DISABLED:"jPlayer's Flash fallback has been disabled by the browser due to the CSS rules you have used. Details: ",NO_SOLUTION:"No solution can be found by jPlayer in this browser. Neither HTML nor Flash can be used.",NO_SUPPORT:"It is not possible to play any media format provided in setMedia() on this browser using your current options.",URL:"Media URL could not be loaded.",URL_NOT_SET:"Attempt to issue media playback commands, while no media url is set.",VERSION:"jPlayer "+e.jPlayer.prototype.version.script+" needs Jplayer.swf version "+e.jPlayer.prototype.version.needFlash+" but found "},e.jPlayer.errorHint={FLASH:"Check your swfPath option and that Jplayer.swf is there.",FLASH_DISABLED:"Check that you have not display:none; the jPlayer entity or any ancestor.",NO_SOLUTION:"Review the jPlayer options: support and supplied.",NO_SUPPORT:"Video or audio formats defined in the supplied option are missing.",URL:"Check media URL is valid.",URL_NOT_SET:"Use setMedia() to set the media URL.",VERSION:"Update jPlayer files."},e.jPlayer.warning={CSS_SELECTOR_COUNT:"e_css_selector_count",CSS_SELECTOR_METHOD:"e_css_selector_method",CSS_SELECTOR_STRING:"e_css_selector_string",OPTION_KEY:"e_option_key"},e.jPlayer.warningMsg={CSS_SELECTOR_COUNT:"The number of css selectors found did not equal one: ",CSS_SELECTOR_METHOD:"The methodName given in jPlayer('cssSelector') is not a valid jPlayer method.",CSS_SELECTOR_STRING:"The methodCssSelector given in jPlayer('cssSelector') is not a String or is empty.",OPTION_KEY:"The option requested in jPlayer('option') is undefined."},e.jPlayer.warningHint={CSS_SELECTOR_COUNT:"Check your css selector and the ancestor.",CSS_SELECTOR_METHOD:"Check your method name.",CSS_SELECTOR_STRING:"Check your css selector is a string.",OPTION_KEY:"Check your option name."}}),define("designer/app/builder/ui/controls/media/audioplayer/media.audioplayer",["jquery","designer/util/util.instances","designer/util/util.model","common/util/documentHelper","libs/jquery/plugins/jquery.dotdotdot","libs/jplayer/jquery.jplayer","wsbcore/overlay"],function(e,t,n,i){var a,r,o,s="wsb-media-audioplayer",l="designer",d="mobile",c="AudioPlayerAutoStart",u="AudioPlayerLoop",p="AudioPlayerShuffle",g="AudioPlayerShowPlayList",h="AudioPlayerDescription",m="albumImageUrl",b="assets",f="AudioPlayerMetaData",v='<li title="{0} {1}"><span class="pos">{2}.</span><span class="title">{0}</span><span class="length">{3}</span></li>';return a=function(e,t){this.$element=e,this.model=new n(t),this.mode=this.model.get("mode"),this.i18N=this.model.get("i18N"),this.amdRoot=this.model.get("amdRoot"),this.subscriptions=[],this.songs=[],this.playlist=[],this.playerReady=!1,this.playing=!1,this.queued=!1,this.current=0,this.shuffle=!1,this.loop=!1,this.$player=!1,this.$overlay=!1,this.$details=void 0,this.$art=void 0,this.$name=void 0,this.$author=void 0,this.$length=void 0,this.$desc=!1,this.$controls=void 0,this.$loop=void 0,this.$shuffle=void 0,this.$back=void 0,this.$forward=!1,this.$playlist=void 0,this.$ul=!1,this.mode===l&&(this.lastDescription=!1,this.hadPlaylist=!1),this.init()},a.prototype={init:function(){var t=this,n=this.$element.attr("id");this.$player=e("<div></div>").attr("id",n+"-player").appendTo(this.$element),this.mode===l&&(this.$overlay=e("<div></div>").appendTo(this.$element).css({position:"absolute",top:0,filter:"alpha(opacity = 0)","background-color":"transparent"})),this.$details=e("."+s+"-details",this.$element),this.$art=e(".art",this.$details),this.$name=e(".name",this.$details),this.$author=e(".author",this.$details),this.$length=e(".length",this.$details),this.$desc=e("."+s+"-desc",this.$element),this.$controls=e("."+s+"-controls",this.$element),this.$shuffle=e(".shuffle",this.$details),this.$loop=e(".loop",this.$details),this.$playlist=e("."+s+"-playlist",this.$element),this.$ul=e("ul",this.$playlist),this.mode!==l&&(this.mode===d?(this.$shuffle.hide(),this.$loop.hide()):(this.$shuffle.bind("click",function(){t.toggleShuffle(),t.buildPlaylist()}),this.$loop.bind("click",function(){t.toggleLoop()})),this.$back=e(".back",this.$controls).bind("click",function(){var e=t.playlist.length;1==e?t.playerReady&&t.$player.jPlayer(t.playing?"play":"pause",0):t.current-1<0?t.load(e-1,t.playing):t.load(t.current-1,t.playing)}),this.$forward=e(".forward",this.$controls).bind("click",function(){var e=t.playlist.length;1==e?t.playerReady&&t.$player.jPlayer(t.playing?"play":"pause",0):t.current+1>=e?(t.shuffle&&t.shuffleSongs(),t.load(0,t.playing)):t.load(t.current+1,t.playing)}),this.$player.jPlayer({ready:function(){t.playerReady=!0,t.queued&&t.queued.length&&a.prototype.load.apply(t,t.queued)},swfPath:t.amdRoot+"/libs/jplayer/",preload:this.model.get(c)?"none":"auto",smoothPlayBar:!0,backgroundColor:"#000000",cssSelectorAncestor:"#"+n+" ."+s+"-controls",cssSelector:{play:".play",pause:".pause",seekBar:".progress > div",playBar:".progress > div > span",currentTime:".progress-time"},errorAlerts:!1,warningAlerts:!1}).bind(e.jPlayer.event.play,function(){t.playing=!0}).bind(e.jPlayer.event.pause,function(){t.playing=!1}).bind(e.jPlayer.event.ended,function(){var e=t.playlist.length;t.current+1>=e?t.loop?1==e?t.$player.jPlayer("play",0):(t.shuffle&&t.shuffleSongs(),t.load(0,!0)):t.$player.jPlayer("pause",0):t.load(t.current+1,!0)})),this.refresh()},refresh:function(){var t=this,n=this.model.get(f);this.songs=e.map(this.model.get(b),function(t,a){return n[a]?{pos:a+1,src:t.src||i.getDocumentUrl(t.id),title:e.trim(n[a].title||n[a].Title||""),author:e.trim(n[a].author||n[a].Author||""),length:e.trim(n[a].length||n[a].Length||"0:00")}:null}),this.playlist=this.songs.slice(0),this.$element.sfMsgOverlay(this.songs.length?{message:null}:{message:this.i18N.resources.Client__Playlist_is_empty,style:null});var a=this.model.get(m);if(e(".tags",this.$details).toggleClass("with-img",0!=a),a){this.$art.addClass("loading").show().html("");var o=e("<img/>").bind("load",function(){o.appendTo(t.$art.removeClass("loading")).css(r(o,t.$art)).unbind("load")});o[0].src=a}else this.$art.hide();var s=e.trim(this.model.get(h));this.$desc.toggle(!!s).find("p").text(s),this.toggleShuffle(this.model.get(p)),this.toggleLoop(this.model.get(u));var v=this.model.get(g),y=Math.ceil(this.$controls.position().top+this.$controls.outerHeight())-1;if(this.$playlist.toggle(v),v?(this.$playlist.css("top",y),this.buildPlaylist()):this.$ul.children().remove(),this.load(0,this.mode!==d&&this.model.get(c)),this.mode===l){if(this.model.set("minHeight",y),!this.model.model||!this.model.model.undoer)return;var _=this.model.model.undoer;if(_.getCurrentState().isCollect){var w=y+1;(v&&!this.hadPlaylist||v&&this.hadPlaylist&&s!==this.lastDescription)&&(w+=30*this.playlist.length),this.model.get("Height").replace("px","")<w&&this.model.set("Height",w+"px")}this.$overlay.css({width:this.$element.width(),height:this.$element.height()}),this.lastDescription=s,this.hadPlaylist=v}},load:function(e,t){var n=this.playlist[e];n&&(this.playerReady||this.mode===l?(this.playerReady&&(this.$player.jPlayer("setMedia",{mp3:n.src}),t&&this.$player.jPlayer("play")),this.$name.text(n.title).attr("title",n.title).dotdotdot({height:60}),this.$author.text(this.i18N.resources.Client__by.sfFormat(n.author)),this.$length.text(this.i18N.resources.Client__Length+" "+n.length),this.current=e,this.$ul.children().removeClass("active").eq(e).addClass("active")):this.queued=arguments)},shuffleSongs:function(){for(var e,t,n=this.playlist.splice(this.current,1),i=this.playlist.length;i>0;)e=Math.random()*i--|0,t=this.playlist[i],this.playlist[i]=this.playlist[e],this.playlist[e]=t;this.playlist=this.playlist.slice(0,this.current).concat(n,this.playlist.slice(this.current))},toggleShuffle:function(e){if(this.shuffle=void 0!==e?!!e:!this.shuffle,this.$shuffle.toggleClass("active",this.shuffle),this.$ul.toggleClass("shuffled",this.shuffle),this.shuffle)this.shuffleSongs();else{var t=this.playlist[this.current];this.playlist=this.songs.slice(0);for(var n=0;n<this.playlist.length;n++)if(this.playlist[n].pos===t.pos){this.current=n;break}}},toggleLoop:function(e){this.loop=void 0!==e?!!e:!this.loop,this.$loop.toggleClass("active",this.loop)},buildPlaylist:function(){this.$ul.children().remove();for(var e=0;e<this.playlist.length;e++)this.$ul.append(this.buildLi(e,this.playlist[e]));this.$ul.children().eq(this.current).addClass("active")},buildLi:function(t,n){var i=this,a=i.i18N.resources.Client__by.sfFormat(n.author),r=e(v.sfFormat(n.title,a,n.pos,n.length));return this.mode!==l&&r.bind("click",function(){i.load(t,i.playing)}),r},destroy:function(){for(var e in this.subscriptions)this.subscriptions[e].dispose();o.destroy(this.$element),this.$element.remove()}},r=function(e,t){var n=e.width(),i=e.height(),a=i/n,r=t.width(),o=t.height(),s=o/r,l=0,d=0,c=void 0,u=void 0;return 1>a?1>s&&a>s?d=r:l=o:a>1?s>1&&s>a?l=o:d=r:1>s?d=r:l=o,l?c=-(n*(l/i)-r)/2:u=-(i*(d/n)-o)/2,{width:d||"auto",height:l||"auto",left:c,top:u}},e.jPlayer.timeFormat.padMin=!1,o=new t(s,a),{render:function(e,t){var n=o.get(e);return n?n.refresh():n=o.create(e,t),n},destroy:function(e){var t=o.get(e);return t?(t.destroy(),!0):!1}}}),define("designer/app/builder/ui/controls/media/manager/media.manager",["jquery","knockout","wsbcore","text!/Designer/MediaManager","designer/app/builder/ui/controls/media/chooser/media.chooser","common/stats/googleanalytics","/i18n/resources/client","designer/app/builder/data/data","designer/app/builder/managers/pageManager","designer/app/builder/managers/themeManager","common/util/documentHelper","libs/jquery/jqui","wsbcore/overlay"],function(e,t,n,i,a,r,o,s,l,d,c){function u(){var n=this;this.type=t.observable(""),this.type.subscribe(function(e){e===P?n.style("grid"):e===D&&n.style("list")}),this.isCaptioningAvailable=t.computed(function(){return!d.isLocalizedTheme()},this),this.localizedThemeNotice=t.computed(function(){return d.isLocalizedTheme()?o.resources.Client__MediaChooser_LocalizedThemeModeNoticeFormat_Plural.replace("{locale}",d.themeLocale()):null},this),this.style=t.observable(""),this.style.subscribe(function(e){B&&B.length&&("list"===e?L.sortable("option","handle",".move"):"grid"===e&&L.sortable("option","handle",!1))}),this.assets=t.observableArray([]),this.assets.subscribe(function(e){var t=!1;if(C.length!=e.length)t=!0;else for(var i=n.type(),a=0;a<C.length;a++){var r=C[a].toJS(),o=e[a].toJS();if(i===P){for(var s in r)if(r[s]!==o[s]){t=!0;break}}else if(i===D){if(r.id!==o.id){t=!0;break}if(r.src!==o.src){t=!0;break}}if(t)break}var l=e.length&&t;B&&B.length&&A.wsbDialog(l?"enableButton":"disableButton",0)}),this.audioFiles=a.getAudio(!0),this.archivedAudioFiles=a.getArchivedAudio(!0),this.openChooser=function(){var e=[];n.assets().length&&t.utils.arrayForEach(n.assets().slice(),function(t){"0"!==t.id&&e.push({id:t.id.toString()})}),y("add","button"),a["open"+(_===P?"Images":"Audio")](!0,e,function(e){if(e&&e.length){var i=_===P?b:f;t.utils.arrayForEach(e,function(e){n.assets.push(new i(e))})}})},this.onAdd=function(i){var a=e(i).children("div.loading");if(a.length){var r=arguments[arguments.length-1];if(_===P){var o=t.toJS(r),s=e("<img/>").bind("load",function(){s.appendTo(a.removeClass("loading")).css(n.autoFitCss(s,a)).unbind("load")});s[0].src=o.src||c.getDocumentUrl(o.id||o.Id)}else a.removeClass("loading")}},this.scrolled=function(){F&&F.length&&(y("close-rename","scroll"),F.sfContext("close"))},this.remove=function(e){F&&F.length&&F.sfContext("close"),y("remove","icon"),n.assets.remove(e)},this.autoFitCss=function(e,t){var n=e.width(),i=e.height(),a=i/n,r=t.width(),o=t.height(),s=o/r,l=0,d=0,c=void 0,u=void 0;return 1>a?1>s&&a>s?d=r:l=o:a>1?s>1&&s>a?l=o:d=r:1>s?d=r:l=o,l?c=-(n*(l/i)-r)/2:u=-(i*(d/n)-o)/2,{width:d||"auto",height:l||"auto",left:c,top:u}}}function p(e,t){m(P,e,t)}function g(e,t){m(D,e,t)}function h(){return T}function m(n,a,r){if(A&&A.length){if(A.wsbDialog("isopen")){var s=this,l=w;return w=function(){e.isFunction(l)&&l.apply(s,arguments),setTimeout(function(){m(n,a,r)},1e3)},void A.wsbDialog("close")}}else e(i).appendTo("body"),A=e("#"+E),M=e("."+E+"-content",A),O=e("."+E+"-list",M),L=e("ul",O),N=e("#wsb-media-manager-template-rename");_=n,w=r||!1,S="media_manager-"+n,k=!1,T||(T=new u);var d=[];C=[],e.isArray(a)||(a=[]);var c=_===P?b:f;t.utils.arrayForEach(a.slice(0),function(e){C.push(new c(e)),d.push(new c(e))}),T.type(_),T.assets(d),A.wsbDialog({title:I[_],buttons:[{text:o.resources.Save,onClick:function(){if(e.isFunction(w)){var n=[];t.utils.arrayForEach(T.assets().slice(0),function(e){_===P?n.push(e.toJS()):_===D&&n.push(e.toModel())}),w(n)}y("close","save"),A.wsbDialog("close")
}},{text:o.resources.Cancel,cancel:!0,style:"link",onClick:function(){y("close","cancel")}}],destroyOnClose:!1,onOpen:function(e){if(!B||!B.length){t.applyBindings(T,(B=e)[0]);var n={items:"li",delay:30,distance:10,cursor:"move",containment:M,forcePlaceholderSize:!0,forceHelperSize:!0,placeholder:_+" placeholder",start:function(){L.addClass("sorting"),y("reorder-start","icon"),F&&F.length&&(y("close-rename","reorder"),F.sfContext("close"))},stop:function(e,n){var i=t.dataFor(n.item[0]),a=n.item.index();y("reorder-end",T.assets.indexOf(i)===a?"no-change":"changed"),L.removeClass("sorting"),n.item.remove(),i.renamer&&i.renamer.$anchor&&(i.renamer.$anchor=!1),T.assets.remove(i),T.assets.splice(a,0,i)}};"list"===T.style()&&(n.handle=".move"),L.sortable(n),L.disableSelection()}A.wsbDialog("disableButton",0)},onClose:function(t){t?y("cancel","link"):y("xclose","icon"),F&&F.length&&(y("close-rename","exit"),F.sfContext("close")),e.isFunction(w)&&w()}})}var b,f,v,y,_,w,S,k,x,C,T,E="wsb-media-manager",P="image",D="audio",I={};I[P]=o.resources.Client__Designer__Manage_Photos,I[D]=o.resources.Manage_Playlist;var A,M,O,L,N,B,F;return b=function(e){var n=t.toJS(e);this.id=n.id||n.Id||0,this.src=n.src||"",this.caption=t.observable(n.caption||""),this.newCaption=t.observable(this.caption()),this.link=t.observable(n.link||""),this.newLink=t.observable(this.link()),this.type="image",this.isValid=t.computed(this.checkValid,this,{deferEvaluation:!0}),this.renamer=new v(this)},b.prototype={checkValid:function(){var e=this.caption(),t=this.newCaption(),n=this.link(),i=this.newLink();return t!==e?!0:i!==n?!0:!1},save:function(){this.isValid()&&(this.caption(this.newCaption()),this.link(this.newLink()),T.assets.valueHasMutated(),F&&F.length&&(y("close-rename","save"),F.sfContext("close")))},reset:function(){this.newCaption(this.caption()),this.newLink(this.link())},toModel:function(){return{id:this.id,src:this.src,caption:this.caption(),link:this.link(),type:this.type}},toJS:function(){return t.toJS(this.toModel())}},f=function(e){var n=(e.id||"0").toString();this.id=n,this.src=e.src||"";var i=e.toModel?e.toModel():"0"!==n&&t.utils.arrayFirst(T.audioFiles().concat(T.archivedAudioFiles()),function(e){return e.referenceId===n||e.id===n})||{name:t.observable(e.title||""),author:t.observable(e.author||""),length:e.length||"0:00"};this.title=i.name,this.author=i.author,this.length=i.length,this.type="audio"},f.prototype={toModel:function(){return{id:this.id,src:this.src,title:this.title,author:this.author,length:this.length,type:this.type}},toJS:function(){return t.toJS(this.toModel())}},v=function(e){this.parent=e,this.skipReset=!1,this.$anchor=!1},v.prototype={open:function(i,a){var r=i.renamer;if(!r.$anchor){var o=!1;r.$anchor=e(a.currentTarget),e(N[0].innerHTML).sfContext({autoOpen:!0,anchor:r.$anchor,closeOnBlur:!0,closeTimeoutInterval:3e4,positionIdeal:"uc",width:270,onOpen:function(a){if(F=a,x=!1,y("rename_file","icon"),!o){var s=r.getViewModel();t.applyBindings(s,a[0]),o=!0}r.skipReset||i.reset();var l=a.parents(".sf-flyout");e(".sflayer-dialog").append(l);var d=n.util.zIndex.getLayerForElement(l),c=n.util.zIndex.maxForLayer(d)+1;l.css("z-index",c)},onClose:function(){y("close-rename","blur")}})}},getViewModel:function(){if("image"===this.parent.type){this.imageViewModel||(this.imageViewModel={type:"image",close:this.close,onOpen:this.onOpen,pages:t.computed(function(){return e.map(l.pages(),function(e){return{id:e.Id,name:e.Name,type:"page"}})})});var n=this;return e.extend({newCaption:n.parent.newCaption,newLink:n.parent.newLink,isValid:n.parent.isValid,save:function(){n.parent.save()},onClose:function(){n.skipReset=!0,n.onClose(),n.skipReset=!1}},this.imageViewModel)}return{}},close:function(){F&&F.length&&(y("close-rename","cancel"),F.sfContext("close"))},onOpen:function(){B.hide()},onClose:function(){B.show(),F.sfContext("open"),x=!1}},y=function(e,t,n){if("close"===e){if(k)return;k=!0}else if("close-rename"===e){if(x)return;x=!0}r.trackEvent(S,e,t,n)},{getViewModel:h,openImages:p,openAudio:g}}),define("designer/app/builder/ui/canvas/elements/audioplayer/el.audioplayer",["text!designer/app/builder/ui/canvas/elements/audioplayer/el.audioplayer.html","text!designer/app/builder/ui/canvas/elements/audioplayer/mutator.audioplayer.html","jquery","designer/app/builder/data/data","knockout","designer/app/builder/ui/controls/media/chooser/media.chooser","appconfig","common/stats/googleanalytics","/i18n/resources/client","designer/app/builder/ui/controls/media/audioplayer/media.audioplayer","designer/app/builder/ui/controls/media/manager/media.manager","common/util/documentHelper"],function(e,t,n,i,a,r,o,s,l,d,c,u){function p(e,t){e.call(this,t);var i=this;this.i18Dict=k,h||(h=r.getAudio(!0)),m||(m=r.getArchivedAudio(!0)),i.ko=a,i.wsb=v,i.isNew=a.observable(y),i.mode="designer",i.i18N=l,i.Title=l.resources.Audio_Player,i.SettingsTitle=l.resources.Audio_Player_Settings,i.updateMetas=function(){var e=i.AudioPlayerMetaData(),t=[],r=!1;if(n.each(i.AudioPlayerAssets().slice(0),function(e,n){{var r,o=(a.utils.unwrapObservable(n.id)||"0").toString();a.utils.unwrapObservable(n.src)}r="0"===o?x:a.utils.arrayFirst(h().concat(m()),function(e){return e.referenceId===o||e.id===o}),r?t.push({title:r.title||r.name||a.observable(""),author:r.author||a.observable(""),length:r.length||"0:00"}):(i.isNew()||_.disable(),i.AudioPlayerAssets.remove(n),i.isNew()||_.enable())}),e.length!==t.length)r=!0;else for(var o=0;o<e.length;o++)if(JSON.stringify(a.toJS(e[o]))!==JSON.stringify(a.toJS(t[o]))){r=!0;break}r&&i.AudioPlayerMetaData(t)},i.hasChanged=a.observable(!1),i.hasChanged.subscribe(function(e){e&&this.instance&&(this.updateMetas(),this.instance.refresh()),this.hasChanged(!1)},i),i.AudioPlayerMetaData=a.observableArray([]),i.albumImageUrl=a.computed(function(){return u.getDocumentUrl(i.AudioPlayerAlbumImage())}),i.assets=a.computed(function(){return i.AudioPlayerAssets().map(function(e){var t=a.utils.unwrapObservable(e.id);return t&&(e.src=e.src||u.getDocumentUrl(t)),e})}),i.afterRender=function(e){i.updateMetas(),f?(i.$element=n("#designer-audioplayer-"+i.ID()),i.instance=f.render(i.$element,i),n.isFunction(e)&&e(i)):(f=d,i.afterRender(e))},i.onRemove=function(){i.instance&&i.instance.destroy(),i.isNew(!1)},i.setAssets=function(e,t){if(n.isArray(e)){var r=[],o=n.map(e.slice(0),function(e,t){var n={id:e.id||"0",src:e.src};return"0"===n.id&&(e=x),e?(r[t]={title:e.title||e.name||a.observable(""),author:e.author||a.observable(""),length:e.length||"0:00"},n):null});i.AudioPlayerMetaData(r),i.AudioPlayerAssets(o),t&&e.length>1&&i.AudioPlayerShowPlayList(!0),i.isNew()&&i.isNew(!1)}},i.openManager=function(e){if(b){var t=i.AudioPlayerMetaData().slice(0),r=n.map(i.AudioPlayerAssets().slice(0),function(e,n){var r={id:(a.utils.unwrapObservable(e.id)||"0").toString(),src:a.utils.unwrapObservable(e.src)};return"0"===r.id?(r.title=t[n].title,r.author=t[n].author,r.length=t[n].length,a.toJS(r)):a.utils.arrayFirst(h().concat(m()),function(e){return e.referenceId===r.id||e.id===r.id})?a.toJS(r):(i.isNew()||_.disable(),i.AudioPlayerAssets.remove(e),i.AudioPlayerMetaData.splice(n,1),i.isNew()||_.enable(),null)});"action"===e?s.trackEvent("general_settings","audio_manage_playlist","icon"):s.trackEvent("audio_settings","manage_playlist","button"),b.openAudio(r,i.setAssets)}else b=c,i.openManager(e)},i.mutatorViewModel=new g(i),a.computed(function(){var e;for(var t in this.mutatorViewModel)"AudioPlayerDescription"!==t&&a.isObservable(this.mutatorViewModel[t])&&(e=this.mutatorViewModel[t]());for(var n=this.AudioPlayerMetaData(),i=0;i<n.length;i++)n[i]&&(e=n[i].title()+n[i].author());this.hasChanged(!0)},i).extend({throttle:{type:"debounce",delay:1}}),i.mutatorViewModel.OpenManager=function(){i.openManager("properties")},i.getActionMenuItems=a.computed(function(){var e=i.getCommands();return[{text:l.resources.Manage_Playlist,tip:l.resources.Manage_Playlist,cssClass:"wsb-audio-manage",click:function(){i.openManager("action")}},e.editProperties,e.clone,e["delete"],e.layoutCommands]}),i.onResized=function(){i.instance&&i.instance.refresh()},i.Height.subscribe(function(){Boolean(this.state().match(/^resize/i))||this.onResized()},i),i.Width.subscribe(function(){Boolean(this.state().match(/^resize/i))||this.onResized()},i)}function g(e){this.i18Dict=k,this.StartAutomaticallyHTML=this.i18Dict.StartAutomatically+" <span class='sf-tip' data-title='"+this.i18Dict.StartAutomatically+"' data-content='"+this.i18Dict.PeopleDontLikeMusicAnymore+"'></span>";var t="",i="0";this.AudioPlayerAutoStart=e.AudioPlayerAutoStart,this.AudioPlayerAutoStart.subscribe(function(e){s.trackEvent(S,(e?"enable":"disable")+"-autostart",w)}),this.AudioPlayerLoop=e.AudioPlayerLoop,this.AudioPlayerLoop.subscribe(function(e){s.trackEvent(S,(e?"enable":"disable")+"-loop",w)}),this.AudioPlayerShuffle=e.AudioPlayerShuffle,this.AudioPlayerShuffle.subscribe(function(e){s.trackEvent(S,(e?"enable":"disable")+"-shuffle",w)}),this.AudioPlayerShowPlayList=e.AudioPlayerShowPlayList,this.AudioPlayerShowPlayList.subscribe(function(e){s.trackEvent(S,(e?"enable":"disable")+"-playlist",w)}),this.AudioPlayerDescription=e.AudioPlayerDescription,this.AudioPlayerDescriptionThrottled=a.computed(this.AudioPlayerDescription).extend({throttle:{type:"debounce",delay:400}}),this.AudioPlayerDescriptionThrottled.subscribe(function(e){var i=n.trim(e);if(t!==i){var a="update";i&&!t?a="enable":t&&!i&&(a="disable"),s.trackEvent(S,a+"-description",w),t=i}}),this.AudioPlayerAlbumImage=e.AudioPlayerAlbumImage,this.AudioPlayerAlbumImage.subscribe(function(e){var t=(e||"0").toString();if(i!==t){var n="update";"0"!==t&&"0"===i?n="enable":"0"!==i&&"0"===t&&(n="disable"),s.trackEvent(S,n+"-albumimage",w),i=t}}),this.AudioPlayerAssets=e.AudioPlayerAssets,this.afterRender=function(e){var t=n(e).find(".sf-tip");t.length&&t.sfTipper({wireup:!0}).bind("click",function(){s.trackEvent(S,"click-autostart-bubble",w)})}}var h,m,b,f,v=!1,y=!0,_=i.undoer,w="audioplayer",S="wsb-designer-properties-flyout",k={ShowPlaylist:l.resources.Server__Show_playlist,LoopPlaylist:l.resources.Server__Loop_playlist,Shuffle:l.resources.Server__Shuffle,StartAutomatically:l.resources.Server__Start_automatically,OptionsColon:l.resources.Server__Options_colon,AlbumArtColon:l.resources.Server__Album_art_colon,TracksColon:l.resources.Server__Tracks_colon,ManagePlaylist:l.resources.Manage_Playlist,DescriptionColon:l.resources.Description_colon,PeopleDontLikeMusicAnymore:l.resources.Server__People_dont_like_music_autoplay,Ok:l.resources.OK,None:l.resources.None},x={id:"0",src:o.customerAmdPathRoot+"/audio/default.mp3",title:a.observable("Taking Chances"),author:a.observable("Skip Peck"),length:"2:24"},C="audioplayer";return{name:C,initModel:function(e,t){e.AudioPlayerAutoStart=e.AudioPlayerAutoStart||!1,e.AudioPlayerLoop=e.AudioPlayerLoop||!1,e.AudioPlayerShuffle=e.AudioPlayerShuffle||!1,e.AudioPlayerShowPlayList=e.AudioPlayerShowPlayList||!1,e.AudioPlayerDescription=e.AudioPlayerDescription||"",e.AudioPlayerAlbumImage=e.AudioPlayerAlbumImage||"0",e.AudioPlayerAssets=e.AudioPlayerAssets||[{id:x.id,src:x.src}],t&&(e.Width="350px",e.Height="160px")},createElementViewModel:function(e,t){p.prototype=Object.create(e.prototype);var n=new p(e,t);return n.minWidth=208,n.undoer=_,n},load:function(n,i){n.append(e).append(t),i(null,C)}}}),define("text!designer/app/builder/ui/canvas/elements/paypal/el.paypal.html",[],function(){return'\r\n<script type="text/html" id="wsb-canvas-template-paypal">\r\n    <div data-widget-content="true" data-bind="attr: { style: Style, \'class\': CssClasses }">\r\n        <!-- ko if: needShowPriceList() -->\r\n        <div style="text-align: center;padding-bottom: 5px;">\r\n            <select data-bind="\r\n            options: giftCertPriceList,\r\n            optionsText: \'label\',\r\n            optionsValue: \'price\'"></select>\r\n        </div>\r\n        <!-- /ko -->\r\n        <div class="paypal-button-container">\r\n            <img data-bind="attr:{src: buttonImageUrl, alt: i18Dict.Server__PayPal_the_safer_easier_way_to_pay_online}" />\r\n        </div>\r\n        <!-- ko if: PayPalButtonType() == buttonTypeEnum.Subscribe && showUnsubscribe() -->\r\n        <div class="paypal-button-container">\r\n            <img data-bind="attr: {src: unsubSubscribeImageUrl, alt: i18Dict.Server__PayPal_the_safer_easier_way_to_pay_online}" />\r\n        </div>\r\n        <!-- /ko -->\r\n        <div style="width: 100%; height: 100%; position: absolute; top: 0px; background-color: transparent;"></div>\r\n    </div>\r\n</script>\r\n\r\n\r\n<script type="text/html" id="paypalWizard_container">\r\n    <div class="paypal-wizard-inner" data-bind="template: { name: pageTemplate()}"></div>\r\n</script>\r\n\r\n\r\n<!-- Button chooser -->\r\n<script type="text/html" id="paypalWizard_button">\r\n    <h3 class="sf-dialog-title" style="cursor: text;" data-bind="text: i18Dict.Server__How_would_you_like_your_payments"></h3>\r\n    \r\n    <div class="wsb-canvas-mutator-inner wsb-paypal-step">\r\n        <div class="wsb-paypal-steps" data-bind="text: xStepOfY(1, stepCount())"></div>\r\n        <!--ko if:showBuyNow-->\r\n        <div class="paypal-wizard-sbtndiv clearfix" data-bind="click: selectBuyNow">\r\n            <span id="paypal-buy-btn" data-bind="css: {selected: buttonType() == \'BuyNow\'}"></span>\r\n            <div class="paypal-wizard-block">\r\n                <div class="paypal-wizard-textwrapper">\r\n                    <div class="wsb-paypal-payment-title" data-bind="text: i18Dict.Server__One_click_check_out"></div>\r\n                    <div class="wsb-paypal-payment-text" data-bind="text: i18Dict.Server__Your_visitors_can_purchase_one_product_at_a_time"></div>\r\n                </div>\r\n                \r\n                <div class="paypal-wizard-buttonwrapper">\r\n                    <img data-bind="attr: {src: i18Dict.ButtonPathUrl + \'/\' + i18Dict.BuyNowImage, alt: i18Dict.Server__PayPal_the_safer_easier_way_to_pay_online }" />\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <!-- /ko -->\r\n        \r\n        <!--ko if:showCart-->\r\n        <div class="paypal-wizard-sbtndiv clearfix" data-bind="click: selectCart">\r\n            <span id="paypal-cart-btn" data-bind="css: {selected: buttonType() == \'Cart\'}"></span>\r\n            <div class="paypal-wizard-block">\r\n                <div class="paypal-wizard-textwrapper">\r\n                    <div class="wsb-paypal-payment-title" data-bind="text: i18Dict.Server__Shopping_cart"></div>\r\n                    <div class="wsb-paypal-payment-text" data-bind="text: i18Dict.Server__Visitors_can_add_multiple_items_to_a_shopping_cart"></div>\r\n                </div>\r\n                <div class="paypal-wizard-buttonwrapper">\r\n                    <img data-bind="attr: { src: i18Dict.ButtonPathUrl + \'/btn_cart_LG.gif\', alt: i18Dict.Server__PayPal_the_safer_easier_way_to_pay_online}" />\r\n                     \r\n                </div>\r\n            </div>\r\n        </div>\r\n        <!-- /ko -->\r\n        \r\n        <!--ko if:showDonate-->\r\n        <div class="paypal-wizard-sbtndiv clearfix" data-bind="click: selectDonate">\r\n            <span id="paypal-donate-btn" data-bind="css: {selected: buttonType() == \'Donate\'}"></span>\r\n            <div class="paypal-wizard-block">\r\n                <div class="paypal-wizard-textwrapper">\r\n                    <div class="wsb-paypal-payment-title" data-bind="text: i18Dict.Server__Accept_donations"></div>\r\n                    <div class="wsb-paypal-payment-text" data-bind="text: i18Dict.Server__For_charities_drives_etc"></div>\r\n                </div>\r\n                <div class="paypal-wizard-buttonwrapper">\r\n                    <img data-bind="attr: {src: i18Dict.ButtonPathUrl + \'/btn_donate_LG.gif\', alt: i18Dict.Server__PayPal_the_safer_easier_way_to_pay_online } " />\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <!-- /ko -->\r\n        \r\n        <!--ko if:showGift-->\r\n        <div class="paypal-wizard-sbtndiv clearfix" data-bind="click: selectGift">\r\n            <span id="paypal-gift-btn" data-bind="css: {selected: buttonType() == \'Gift\'}"></span>\r\n            <div class="paypal-wizard-block">\r\n                <div class="paypal-wizard-textwrapper">\r\n                    <div class="wsb-paypal-payment-title" data-bind="text: i18Dict.Server__Gift_certificates"></div>\r\n                    <div class="wsb-paypal-payment-text" data-bind="text: i18Dict.Server__Get_more_business_with_gift_certs"></div>\r\n                </div>\r\n                <div class="paypal-wizard-buttonwrapper">\r\n                    <img data-bind="attr: { src: i18Dict.ButtonPathUrl + \'/btn_gift_LG.gif\', alt: i18Dict.Server__PayPal_the_safer_easier_way_to_pay_online }" />                    \r\n                </div>\r\n            </div>\r\n        </div>\r\n        <!--/ko-->\r\n        \r\n        <!-- ko if:showSubscribe -->\r\n        <div class="paypal-wizard-sbtndiv clearfix" data-bind="click: selectSubscribe">\r\n            <span id="paypal-subscribe-btn" data-bind="css: {selected: buttonType() == \'Subscribe\'}, click: selectSubscribe"></span>\r\n            <div class="paypal-wizard-block">\r\n                <div class="paypal-wizard-textwrapper">\r\n                    <div class="wsb-paypal-payment-title" data-bind="text:i18Dict.Server__Repeat_billing"></div>\r\n                    <div class="paypal-required-txt2" data-bind="text: \'(\' + i18Dict.Server__Requires_PayPal_premier_or_business_account+ \')\'"></div>\r\n                    <div class="wsb-paypal-payment-text" data-bind="text: i18Dict.Server__Bill_your_customers_in_repeat_cycles"></div>\r\n                </div>\r\n                <div class="paypal-wizard-buttonwrapper">\r\n                    <img data-bind="attr: {src: i18Dict.ButtonPathUrl + \'/btn_subscribe_LG.gif\', alt: i18Dict.Server__PayPal_the_safer_easier_way_to_pay_online }" />\r\n                    \r\n                </div>\r\n            </div>\r\n        </div>\r\n        <!-- /ko -->\r\n    </div>\r\n</script>\r\n\r\n\r\n<!-- Buy now Payment Options -->\r\n<script type="text/html" id="paypalWizard_buynow">\r\n    <h3 class="sf-dialog-title" style="cursor: text;" data-bind="text: i18Dict.Server__Buy_now_set_up_payment_options"></h3>\r\n    \r\n    <div class="wsb-canvas-mutator-inner wsb-paypal-step">\r\n\r\n        <div class="paypal-required-txt">&#42; <span data-bind="text: i18Dict.Server__Required_fields"></span></div>\r\n        \r\n        <div class="wsb-paypal-steps" data-bind="text: xStepOfY(2, stepCount())">\r\n        </div>\r\n\r\n        <div class="wsb-paypal-item-name">\r\n            <label class="wsb-block-label"><span data-bind="text: i18Dict.Server__Item_name_colon"></span> <span class="wsb-required">*</span></label>\r\n            <input type="text" data-bind="value: buttonConfigData.itemName, valueUpdate: \'afterkeydown\', css: \'wsb-text-box\' + ((!buttonConfigData.itemName.isValid || buttonConfigData.itemName.isValid() || !showErrorBuynowItemName())  ? \'\' : \' wsb-text-box-error\')" />\r\n            <!-- ko if: buttonConfigData.itemName.isValid && !buttonConfigData.itemName.isValid() && showErrorBuynowItemName() -->\r\n            <div class="wsb-text-box-error-text" data-bind="text: buttonConfigData.itemName.validationMessage"></div>\r\n            <!-- /ko -->\r\n        </div>\r\n\r\n        <div class="wsb-paypal-buy-money clearfix">\r\n\r\n            <div class="wsb-paypal-buy-price">\r\n                <label class="wsb-block-label">\r\n                    <span data-bind="text: i18Dict.Server__Price_colon"></span> <span class="wsb-required">*</span>\r\n                </label>\r\n\r\n                <span class="wsb-paypal-buy-currency" data-bind="text: getCurrencySymbol"></span>\r\n                \r\n                <input type="text" data-bind="\r\n                    value: buttonConfigData.price, \r\n                    valueUpdate: \'afterkeydown\',\r\n                    css: \'wsb-text-box\' + ((!buttonConfigData.price.isValid || buttonConfigData.price.isValid() || !showErrorBuynowPrice()) ? \'\' : \' wsb-text-box-error\'),\r\n                    event: {change: formatPrice.bind($data, \'price\')}" />\r\n                \r\n                <!-- ko if: buttonConfigData.price.isValid && !buttonConfigData.price.isValid() && showErrorBuynowPrice() -->\r\n                <div class="wsb-text-box-error-text" data-bind="text: buttonConfigData.price.validationMessage"></div>\r\n                <!-- /ko -->\r\n            </div>\r\n\r\n\r\n            <div class="wsb-paypal-buy-price">\r\n                <label class="wsb-block-label" data-bind="text: i18Dict.Server__Shipping_colon">                   \r\n                </label>\r\n\r\n                <span class="wsb-paypal-buy-currency" data-bind="text: getCurrencySymbol()"></span>\r\n                \r\n                <input type="text" data-bind="\r\n                    value: buttonConfigData.shipping, \r\n                    valueUpdate: \'afterkeydown\', \r\n                    css: \'wsb-text-box\' + ((!buttonConfigData.shipping.isValid || buttonConfigData.shipping.isValid() || !showErrorShipping()) ? \'\' : \' wsb-text-box-error\'),\r\n                    event: {change: formatPrice.bind($data, \'shipping\')}" />\r\n                \r\n                <!-- ko if: buttonConfigData.shipping.isValid && !buttonConfigData.shipping.isValid() && showErrorShipping() -->\r\n                <div class="wsb-text-box-error-text" data-bind="text: buttonConfigData.shipping.validationMessage"></div>\r\n                <!-- /ko -->\r\n            </div>\r\n        </div>\r\n        \r\n        <div class="wsb-paypal-currency-item clearfix">\r\n\r\n            <div class="wsb-paypal-item-id">\r\n                <label class="wsb-block-label">\r\n                    <span data-bind="text: i18Dict.Server__Item_id_colon"></span>\r\n                    <span data-aid="itemIdTip" class="sf-tip"\r\n                          data-bind="attr: { \'date-title\': i18Dict.Server__Item_id, \'data-content\': i18Dict.Server__Setting_an_item_id_helps }"></span>\r\n                </label>\r\n\r\n                <input type="text" class="wsb-text-box" data-bind="value: buttonConfigData.itemID" />\r\n            </div>\r\n\r\n            <div class="wsb-paypal-item-id">\r\n                <label class="wsb-block-label" data-bind="text: i18Dict.Server__Currency_colon">\r\n                </label>\r\n                \r\n                <select class="wsb-select-box" data-bind="options: currencyList, optionsText: \'name\', optionsValue: \'id\', value: currency"></select>\r\n            </div> \r\n\r\n        </div>\r\n    </div>\r\n</script>\r\n\r\n\r\n<!-- Cart payments -->\r\n<script type="text/html" id="paypalWizard_cart">\r\n    <h3 class="sf-dialog-title" style="cursor: text;" data-bind="text: i18Dict.Server__Shopping_cart_set_up_payment_options"></h3>\r\n    \r\n    <div class="wsb-canvas-mutator-inner wsb-paypal-step clearfix">\r\n\r\n        <div class="paypal-required-txt">&#42; <span data-bind="text: i18Dict.Server__Required_fields"></span></div>\r\n\r\n        <div class="wsb-paypal-steps" data-bind="text: xStepOfY(2, stepCount())"></div>\r\n\r\n\r\n        <div class="wsb-paypal-item-name">\r\n            <label class="wsb-block-label"><span data-bind="text: i18Dict.Server__Item_name_colon"></span> <span class="wsb-required">*</span></label>\r\n\r\n            <input type="text" data-bind="value: buttonConfigData.itemName, valueUpdate: \'afterkeydown\', css: \'wsb-text-box\' + ((!buttonConfigData.itemName.isValid || buttonConfigData.itemName.isValid() || !showErrorBuynowItemName())  ? \'\' : \' wsb-text-box-error\')" />\r\n            <!-- ko if: buttonConfigData.itemName.isValid && !buttonConfigData.itemName.isValid() && showErrorBuynowItemName() -->\r\n            <div class="wsb-text-box-error-text" data-bind="text: buttonConfigData.itemName.validationMessage"></div>\r\n            <!-- /ko -->\r\n        </div>\r\n\r\n        <div class="wsb-paypal-buy-money clearfix">\r\n            <div class="wsb-paypal-buy-price">\r\n                <label class="wsb-block-label">\r\n                    <span data-bind="text: i18Dict.Server__Price_colon"></span> <span class="wsb-required">*</span>\r\n                </label>\r\n\r\n                <span class="wsb-paypal-buy-currency" data-bind="text: getCurrencySymbol"></span>\r\n                \r\n                <input type="text" data-bind="\r\n                    value: buttonConfigData.price, \r\n                    valueUpdate: \'afterkeydown\',\r\n                    css: \'wsb-text-box\' + ((!buttonConfigData.price.isValid || buttonConfigData.price.isValid() || !showErrorBuynowPrice()) ? \'\' : \' wsb-text-box-error\'),\r\n                    event: {change: formatPrice.bind($data, \'price\')}" />\r\n               \r\n                <!-- ko if: buttonConfigData.price.isValid && !buttonConfigData.price.isValid() && showErrorBuynowPrice() -->\r\n                <div class="wsb-text-box-error-text" data-bind="text: buttonConfigData.price.validationMessage"></div>\r\n                <!-- /ko -->\r\n            </div>\r\n\r\n            <div class="wsb-paypal-buy-price">\r\n                <label class="wsb-block-label" data-bind="text: i18Dict.Server__Shipping_colon">\r\n                </label>\r\n                <span class="wsb-paypal-buy-currency" data-bind="text: getCurrencySymbol"></span>\r\n\r\n                <input type="text" data-bind="value: buttonConfigData.shipping, \r\n                    valueUpdate: \'afterkeydown\', \r\n                    css: \'wsb-text-box\' + ((!buttonConfigData.shipping.isValid || buttonConfigData.shipping.isValid() || !showErrorShipping()) ? \'\' : \' wsb-text-box-error\'),\r\n                    event: {change: formatPrice.bind($data, \'shipping\')}" />\r\n                \r\n                <!-- ko if: buttonConfigData.shipping.isValid && !buttonConfigData.shipping.isValid() && showErrorShipping() -->\r\n                <div class="wsb-text-box-error-text" data-bind="text: buttonConfigData.shipping.validationMessage"></div>\r\n                <!-- /ko -->\r\n            </div>\r\n        </div>\r\n\r\n        <div class="wsb-paypal-currency-item clearfix">\r\n            <div class="wsb-paypal-item-id">\r\n                <label class="wsb-block-label">\r\n                    <span data-bind="text: i18Dict.Server__Item_id_colon"></span>\r\n                    <span data-aid="itemIdTip" class="sf-tip"\r\n                          data-bind="attr: { \'date-title\': i18Dict.Server__Item_id, \'data-content\': i18Dict.Server__Setting_an_item_id_helps }"></span>\r\n                </label>\r\n               \r\n                <input type="text" data-bind="value: buttonConfigData.itemID" class="wsb-text-box" />\r\n            </div>\r\n\r\n            <div class="wsb-paypal-item-id">\r\n                <label class="wsb-block-label" data-bind="text: i18Dict.Server__Currency_colon">\r\n\r\n                </label>\r\n\r\n                <select class="wsb-select-box" data-bind="options: currencyList, optionsText: \'name\', optionsValue: \'id\', value: currency"></select>\r\n            </div>\r\n        </div>\r\n\r\n    </div>\r\n</script>\r\n\r\n\r\n<!-- Donations -->\r\n<script type="text/html" id="paypalWizard_donate">\r\n    <h3 class="sf-dialog-title" style="cursor: text;" data-bind="text: i18Dict.Server__Donations_set_up_payment_options"></h3>\r\n\r\n    <div class="wsb-canvas-mutator-inner wsb-paypal-step clearfix">\r\n        <div class="paypal-required-txt">&#42; <span data-bind="text: i18Dict.Server__Required_fields"></span></div>\r\n    \r\n        <div class="wsb-paypal-steps" data-bind="text: xStepOfY(2, stepCount())">\r\n        </div>\r\n\r\n        <div class="wsb-paypal-item-name">\r\n            <label class="wsb-block-label"><span data-bind="text: i18Dict.Server__Organization_colon"></span> <span class="wsb-required">*</span></label>\r\n            <input type="text" data-bind="\r\n                value: buttonConfigData.organization, \r\n                valueUpdate: \'afterkeydown\',\r\n                css: \'wsb-text-box\' + ((!buttonConfigData.organization.isValid || buttonConfigData.organization.isValid() || !showErrorDonateOrgnization()) ? \'\' : \' wsb-text-box-error\')" />\r\n            <!-- ko if: buttonConfigData.organization.isValid && !buttonConfigData.organization.isValid() && showErrorDonateOrgnization() -->\r\n            <div class="wsb-text-box-error-text" data-bind="text: buttonConfigData.organization.validationMessage"></div>\r\n            <!-- /ko -->\r\n        </div>\r\n\r\n        <div class="wsb-paypal-donation-amnt">\r\n            <label class="wsb-block-label" data-bind="text: i18Dict.Server__Donation_amount_colon"></label>\r\n            <ul class="wsb-paypal-donation-choices">\r\n                <li>\r\n                    <label class="radio">\r\n                        <input type="radio" name="paypal_donate_amount" data-bind="value: amountTypeEnum.NotFixed, checked: donateAmountType" />\r\n                        <span data-bind="text: i18Dict.Server__Let_visitors_enter_amount"></span>\r\n                    </label>\r\n                </li>\r\n                <li class="wsb-paypal-donation-specific">\r\n                    <label class="radio">\r\n                        <input type="radio" name="paypal_donate_amount" data-bind="value: amountTypeEnum.Fixed, checked: donateAmountType" />\r\n                        <span data-bind="text: i18Dict.Server__Specific_amount_colon"></span>\r\n                    </label>\r\n                    <span data-bind="text: getCurrencySymbol" class="wsb-paypal-buy-currency"></span>\r\n                    <input type="text" data-bind="\r\n                            value: buttonConfigData.fixedContributionAmount,\r\n                            enable: donateAmountType()==amountTypeEnum.Fixed,\r\n                            css: (!buttonConfigData.fixedContributionAmount.isValid || buttonConfigData.fixedContributionAmount.isValid() || !showErrorDonateFixedAmount()) ? \'wsb-text-box\' : \'wsb-text-box wsb-text-box-error\',\r\n                            valueUpdate: \'afterkeydown\',\r\n                            event: {change: formatPrice.bind($data, \'fixedContributionAmount\')}" />\r\n                    <!-- ko if: buttonConfigData.fixedContributionAmount.isValid && !buttonConfigData.fixedContributionAmount.isValid() && showErrorDonateFixedAmount() -->\r\n                    <div class="wsb-text-box-error-text" data-bind="text: buttonConfigData.fixedContributionAmount.validationMessage"></div>\r\n                    <!-- /ko -->\r\n                </li>\r\n            </ul>\r\n        </div>\r\n\r\n        <div class="wsb-paypal-donation-currency">\r\n            <label class="wsb-block-label">                \r\n                <span data-bind="text: i18Dict.Server__Tracking_id_colon"></span>\r\n                <span data-aid="trackingIdTip" class="sf-tip"\r\n                      data-bind="attr: { \'data-title\': i18Dict.Server__Tracking_id, \'data-content\': i18Dict.Server__Setting_a_unique_id_will_make_tracking_easier }"></span>\r\n            </label>  \r\n            <input type="text" class="wsb-text-box wsb-redo-select" data-bind="value:buttonConfigData.trackingID" />\r\n        </div>\r\n\r\n         <div class="wsb-paypal-item-id">\r\n             <label class="wsb-block-label" data-bind="text: i18Dict.Server__Currency_colon">                 \r\n             </label>\r\n\r\n            <select class="wsb-select-box" data-bind="options: currencyList, optionsText: \'name\', optionsValue: \'id\', value: currency"></select>\r\n        </div> \r\n    </div>\r\n</script>\r\n\r\n\r\n<!-- Paypal Gift certificate -->\r\n<script type="text/html" id="paypalWizard_gift">\r\n    <h3 class="sf-dialog-title" style="cursor: text;" data-bind="text: i18Dict.Server__Gift_certs_set_up_payment_options"></h3>\r\n    <div class="wsb-canvas-mutator-inner wsb-paypal-step clearfix">\r\n        <div class="paypal-required-txt">&#42; <span data-bind="text: i18Dict.Server__Required_fields"></span></div>\r\n\r\n        <div class="wsb-paypal-steps" data-bind="text: xStepOfY(2, stepCount())">\r\n        </div>\r\n\r\n        <div class="wsb-paypal-item-name">\r\n            <label class="wsb-block-label">\r\n                <span data-bind="text: i18Dict.Server__Url_where_recipients_can_shop_colon"></span><span class="wsb-required">*</span>\r\n            </label>\r\n\r\n            <input class="wsb-text-box wsb-redo-select" type="url" data-bind="urlPicker: { url: redeemUrl, pages: pages, showError: showErrorRedeemUrl, disableUpload: true }" />\r\n            \r\n        </div>\r\n\r\n        <div class="wsb-paypal-donation-amnt">\r\n            <label class="wsb-block-label" data-bind="text: i18Dict.Server__Gift_certificate_amount_colon"></label>\r\n            <ul class="wsb-paypal-donation-choices">\r\n                <li>\r\n                    <label class="radio">\r\n                        <input type="radio" name="paypal_gift_amount" data-bind="value: amountTypeEnum. NotFixed, checked: giftAmountType" />\r\n                        <span data-bind="text: i18Dict.Server__Let_visitors_choose"></span>\r\n                        <a class="wsb-link" href="javascript:void(0);" data-bind="click: showGiftCertPriceEditor, text: i18Dict.Server__See_choices"></a>\r\n                    </label>\r\n                </li>\r\n                <li class="wsb-paypal-donation-specific">\r\n                    <label class="radio">\r\n                        <input type="radio" name="paypal_gift_amount" data-bind="value: amountTypeEnum.Fixed, checked: giftAmountType" />                        \r\n                        <span data-bind="text: i18Dict.Server__Specific_amount_colon"></span>\r\n                    </label>\r\n                    <span data-bind="text: getCurrencySymbol" class="wsb-paypal-buy-currency"></span>\r\n                    <input type="text" data-bind="\r\n                        value: buttonConfigData.giftSpecificAmount, \r\n                        enable: giftAmountType()==amountTypeEnum.Fixed,\r\n                        valueUpdate: \'afterkeydown\',\r\n                        css: (!buttonConfigData.giftSpecificAmount.isValid || buttonConfigData.giftSpecificAmount.isValid() || !showErrorGiftFixedAmount()) ? \'wsb-text-box \' : \'wsb-text-box wsb-text-box-error\',\r\n                        event: {change: formatPrice.bind($data, \'giftSpecificAmount\')}" />\r\n                        <!-- ko if: buttonConfigData.giftSpecificAmount.isValid && !buttonConfigData.giftSpecificAmount.isValid() && showErrorGiftFixedAmount() -->\r\n                        <div class="wsb-text-box-error-text" data-bind="text: buttonConfigData.giftSpecificAmount.validationMessage"></div>\r\n                        <!-- /ko -->\r\n                </li>\r\n            </ul>\r\n        </div>\r\n\r\n        <div class="wsb-paypal-item-id">\r\n            <label class="wsb-block-label" data-bind="text: i18Dict.Server__Currency_colon">                \r\n            </label>\r\n\r\n            <select class="wsb-select-box" data-bind="options: currencyList, optionsText: \'name\', optionsValue: \'id\', value: currency"></select>\r\n        </div> \r\n    </div>\r\n\r\n\r\n    <div data-aid="gift-certificate-price-config-panel" class="wsb-editnavdlg-content" style="height: 350px; display: none;" data-bind="event: {click: priceEditorPanel_Click}">\r\n        \r\n        <span class="paypal-gift-cert-price-item-label paypal-pricelist-header" data-bind="text: i18Dict.Server__Text_label_colon"></span>\r\n        <span class="paypal-gift-cert-price-item-value paypal-pricelist-header" data-bind="text: i18Dict.Server__Price_colon"></span>\r\n        \r\n        <div class="wsb-nav-arrange-wrap clearfix">\r\n            <ul class="wsb-editnavdlg-navlist clearfix paypal-pricelist" data-bind="foreach: buttonConfigData.giftCustomizedPriceList">\r\n                <li>\r\n                    <!-- ko if: !readOnly() -->\r\n                    <div class="wsb-editnavdlg-navitemcontent clearfix paypal-price-editor">\r\n                        <span class="paypal-gift-cert-price-item-label">\r\n                            <input type="text" data-bind="\r\n                                value: label, \r\n                                valueUpdate: \'afterkeydown\',\r\n                                attr: {id: \'txt-paypal-price-label-\' + $index() },\r\n                                css: \'wsb-text-box paypal-price-label\' + ((!label.isValid || label.isValid() || !showErrorLabel()) ? \'\' : \' wsb-text-box-error\'),\r\n                                click: function(){},\r\n                                clickBubble: false" />\r\n                        </span>\r\n                            \r\n                        <span class="paypal-gift-cert-price-item-value">\r\n                            <input type="text" data-bind="\r\n                                value: price, \r\n                                valueUpdate: \'afterkeydown\',\r\n                                css: \'wsb-text-box paypal-price-value\' + ((!price.isValid || price.isValid() || !showErrorPrice()) ? \'\' : \' wsb-text-box-error\'),\r\n                                event: {change: $parent.formatPrice.bind($data, \'giftCustomizedPriceList\', $index()), click: function(){}},\r\n                                clickBubble: false" />\r\n                        </span>\r\n                        <!-- ko if: label.isValid && !label.isValid() && showErrorLabel() -->\r\n                        <div class="wsb-text-box-error-text" data-bind="text: label.validationMessage"></div>\r\n                        <!-- /ko -->\r\n                        <!-- ko if: price.isValid && !price.isValid() && showErrorPrice() -->\r\n                        <div class="wsb-text-box-error-text" data-bind="text: price.validationMessage"></div>\r\n                        <!-- /ko -->\r\n                       \r\n                        <div class="wsb-editnavdlg-button-delete" data-bind="click: $parent.deleteIcon_click.bind($data, $index()), clickBubble: false"></div>\r\n                    </div>\r\n                    <!-- /ko -->\r\n                    <!-- ko if: readOnly() -->\r\n                    <div class="wsb-editnavdlg-navitemcontent clearfix">\r\n                        <div>\r\n                            <span class="paypal-gift-cert-price-item-label" data-bind="text: label"></span>\r\n                            <span class="paypal-gift-cert-price-item-value" data-bind="text: price"></span>\r\n                        </div>\r\n                        <div class="wsb-editnavdlg-button-edit" data-bind="click: $parent.editIcon_click.bind($data, $index()), clickBubble: false"></div>\r\n                        <div class="wsb-editnavdlg-button-delete" data-bind="click: $parent.deleteIcon_click.bind($data, $index()), clickBubble: false"></div>\r\n                    </div>\r\n                    <!-- /ko -->\r\n\r\n                </li>\r\n            </ul>\r\n            <a class="wsb-paypal-editnavdlg-addlink" href="javascript:void(0)" data-bind="click: addPriceItem_click, text: i18Dict.Server__Add_another"></a>\r\n        </div>\r\n    </div>\r\n</script>\r\n\r\n\r\n<!-- Certificate Design -->\r\n<script type="text/html" id="paypalWizard_gift_design">\r\n    <h3 class="sf-dialog-title" style="cursor: text;" data-bind="text: i18Dict.Server__Gift_certs_set_up_payment_options"></h3>\r\n\r\n    <div class="wsb-canvas-mutator-inner wsb-paypal-step clearfix">\r\n        <div class="paypal-required-txt">\r\n            &#42; <span data-bind="text: i18Dict.Server__Required_fields"></span>\r\n        </div>\r\n\r\n        <div class="wsb-paypal-steps" data-bind="text: xStepOfY(3, stepCount())">\r\n        </div>\r\n\r\n        <div data-aid="gift-certificate-design-config-panel">\r\n            <div class="wsb-paypal-cert-preview-link">\r\n                <a class="wsb-link" href="javascript:void(0)" data-bind="click: showGiftCertPreviewOnPayPal, text: i18Dict.Server__Preview_full_gift_certificate">\r\n\r\n                </a>\r\n            </div>\r\n\r\n            <iframe data-aid="gift-cert-preview-container" class="wsb-paypal-cert-preview" scrolling="no" frameborder="0"></iframe>\r\n        </div>\r\n\r\n        <div class="wsb-paypal-cert-logo">\r\n            <label class="wsb-block-label">\r\n                <span data-bind="text: i18Dict.Server__Logo_colon"></span> ( <span data-bind="text: logoDimensionString(285,45)"></span> )\r\n            </label>\r\n            <div class="wsb-paypal-cert-image-logo" data-bind="style:{width: logoImageSize.width, height: logoImageSize.height}">\r\n                <!-- ko if: giftCertLogoDocumentId() != 0 -->\r\n                <img data-bind="attr:{src: giftCertLogoUrl}, style:{width: logoImageSize.width, height: logoImageSize.height}" />\r\n                <!-- /ko -->\r\n            </div>\r\n            <div class="wsb-paypal-choose-logo">\r\n                <a href="javascript:void(0)" class="btn btn-inverse-grey" data-bind="click: chooseLogoImage">\r\n                    <i class="icon-wsb-white icon-img"></i> <span data-bind="text: i18Dict.Server__Choose_photo"></span>\r\n                </a>\r\n                <br />\r\n                <span class="paypal-gift-cert-logo-name" data-bind="text: buttonConfigData.logoImageName"></span>\r\n                <span class="wsb-editnavdlg-button-delete paypal-gift-cert-logo-delete" data-bind="click: removeLogoImage, visible: giftCertLogoDocumentId()!=0"></span>\r\n            </div>\r\n        </div>\r\n\r\n        <div class="wsb-paypal-cert-options">\r\n            <label class="radio wsb-paypa-cert-color-select">\r\n                <input type="radio" name="paypal_gift_design" data-bind="value: giftCertDesignTypeEnum.Color, checked: giftCertDesignType" />                \r\n                <span data-bind="text: i18Dict.Server__Select_color_colon"></span>\r\n                <select class="wsb-select-box" data-bind="\r\n                    options: giftCertBackgroundColors, \r\n                    optionsText: \'name\', \r\n                    optionsValue: \'value\', \r\n                    value: buttonConfigData.backgroundColor,\r\n                    enable: giftCertDesignType() == giftCertDesignTypeEnum.Color,\r\n                    click: function(){},\r\n                    event: {change: showGiftCertPreview},\r\n                    clickBubble: false">\r\n                </select>\r\n            </label>\r\n            <label class="radio">\r\n                <input type="radio" name="paypal_gift_design" data-bind="value: giftCertDesignTypeEnum.Template, checked: giftCertDesignType" />\r\n                <span data-bind="text: i18Dict.Server__Select_template_colon"></span>\r\n                <select class="wsb-select-box" data-bind="\r\n                    options: giftCertTemplates,\r\n                    optionsText: \'name\',\r\n                    optionsValue: \'value\',\r\n                    value: buttonConfigData.template,\r\n                    enable: giftCertDesignType() == giftCertDesignTypeEnum.Template,\r\n                    click: function(){},\r\n                    event: {change: showGiftCertPreview},\r\n                    clickBubble: false">\r\n                </select>\r\n            </label>\r\n        </div>\r\n    </div>\r\n</script>\r\n\r\n\r\n<!-- Subscribe -->\r\n<script type="text/html" id="paypalWizard_subscribe">\r\n    <h3 class="sf-dialog-title" style="cursor: text;" data-bind="text: i18Dict.Server__Subscription_set_up_payment_options"></h3>\r\n\r\n    <div class="wsb-canvas-mutator-inner wsb-paypal-step clearfix">\r\n        <div class="paypal-required-txt">&#42; <span data-bind="text: i18Dict.Server__Required_fields"></span></div>\r\n\r\n        <div class="wsb-paypal-steps" data-bind="text: xStepOfY(2, stepCount())">\r\n        </div>\r\n\r\n        <div class="wsb-alert-error" data-bind="text: i18Dict.Server__Note_to_use_repeat_billing"></div>\r\n\r\n        <div class="wsb-paypal-item-name">\r\n            <label class="wsb-block-label">\r\n                <span data-bind="text: i18Dict.Server__Item_name_colon"></span> <span class="wsb-required">*</span>\r\n            </label>\r\n            <input type="text" data-bind="\r\n                value: buttonConfigData.itemName, \r\n                valueUpdate: \'afterkeydown\',\r\n                css: \'wsb-text-box wsb-redo-select\' + ((!buttonConfigData.itemName.isValid || buttonConfigData.itemName.isValid() || !showErrorSubscribeItemName()) ? \'\' : \' wsb-text-box-error\')" />\r\n            <!-- ko if: buttonConfigData.itemName.isValid && !buttonConfigData.itemName.isValid() && showErrorSubscribeItemName() -->\r\n            <div class="wsb-text-box-error-text" data-bind="text: buttonConfigData.itemName.validationMessage"></div>\r\n            <!-- /ko -->\r\n        </div>\r\n\r\n        <div class="wsb-paypal-billing-subscription clearfix">\r\n\r\n            <div class="wsb-paypal-buy-money clearfix">\r\n                <div class="wsb-paypal-buy-price">\r\n                    <label class="wsb-block-label">\r\n                        <span data-bind="text: i18Dict.Server__Price_colon"></span> <span class="wsb-required">*</span>\r\n                    </label>\r\n\r\n                    <span class="wsb-paypal-buy-currency" data-bind="text: getCurrencySymbol"></span>\r\n                    \r\n                    <input type="text" data-bind="\r\n                    value:buttonConfigData.billingCycleData.price,\r\n                    valueUpdate: \'afterkeydown\',\r\n                    css: \'wsb-text-box\' + ((!buttonConfigData.billingCycleData.price.isValid || buttonConfigData.billingCycleData.price.isValid() || !showErrorSubscribePrice()) ? \'\' : \' wsb-text-box-error\'),\r\n                    event: {change: formatPrice.bind($data, \'billingCycleDataPrice\')}" />\r\n                    <!-- ko if: buttonConfigData.billingCycleData.price.isValid && !buttonConfigData.billingCycleData.price.isValid() && showErrorSubscribePrice() -->\r\n                    <div class="wsb-text-box-error-text" data-bind="text: buttonConfigData.billingCycleData.price.validationMessage"></div>\r\n                    <!-- /ko -->\r\n                </div>\r\n\r\n                <div class="wsb-paypal-buy-price">\r\n                    <label class="wsb-block-label" data-bind="text: i18Dict.Server__Tracking_id_colon">\r\n                    </label>\r\n\r\n                    <input type="text" class="wsb-text-box wsb-paypal-tracking-id" data-bind="value:buttonConfigData.subscriptionID" />\r\n                </div>\r\n\r\n            </div>\r\n\r\n            <div class="wsb-paypal-currency-item">\r\n                <div class="wsb-paypal-billing-cycle">\r\n                    <label class="wsb-block-label" data-bind="text: i18Dict.Server__Billing_cycle_colon">\r\n                    </label>\r\n                    <select class="wsb-select-box" data-bind="\r\n                        options: billingCycleTimes, \r\n                        optionsText: \'name\',\r\n                        optionsValue: \'value\',\r\n                        value: buttonConfigData.billingCycleData.times">\r\n                    </select>\r\n                    <select class="wsb-select-box" data-bind="\r\n                        options: billingCyclePeriods, \r\n                        optionsText: \'name\',\r\n                        optionsValue: \'value\',\r\n                        value: buttonConfigData.billingCycleData.period">\r\n                    </select>\r\n                </div>\r\n\r\n                <div class="wsb-paypal-item-id">\r\n                    <label class="wsb-block-label" data-bind="text: i18Dict.Server__End_billing_cycle_after_colon">\r\n\r\n                    </label>\r\n                    <select class="wsb-select-box" data-bind="\r\n                        options: [{name: i18Dict.Server__Never, value: \'Never\'}].concat(billingCycleTimes),\r\n                        optionsText: \'name\',\r\n                        optionsValue: \'value\',\r\n                        value: buttonConfigData.billingCycleData.expire">\r\n                    </select>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <div class="wsb-paypal-offer-trial">\r\n            <label class="checkbox">\r\n                <input type="checkbox" data-bind="checked: buttonConfigData.hasTrialPeriod" />\r\n            \r\n                <span data-bind="text: i18Dict.Server__Offer_trial_period_colon"></span>\r\n            </label>\r\n            <div class="wsb-paypal-trial-choices">\r\n                <span data-bind="text: getCurrencySymbol" class="wsb-paypal-buy-currency"></span>\r\n\r\n                <input type="text" class="wsb-text-box" data-bind="\r\n                    enable: buttonConfigData.hasTrialPeriod,\r\n                    value: buttonConfigData.trialPeriodBillingData.price,\r\n                    valueUpdate: \'afterkeydown\', \r\n                    css: \'wsb-text-box wsb-redo-select paypal-field\' + ((!buttonConfigData.trialPeriodBillingData.price.isValid || buttonConfigData.trialPeriodBillingData.price.isValid() || !showErrorSubscribeTrialPrice()) ? \'\' : \' wsb-text-box-error\'),\r\n                    event: {change: formatPrice.bind($data, \'trialPeriodBillingDataPrice\')}" />\r\n                <select class="wsb-select-box" data-bind="\r\n                    options: billingCycleTimes, \r\n                    optionsText: \'name\',\r\n                    optionsValue: \'value\',\r\n                    value: buttonConfigData.trialPeriodBillingData.times,\r\n                    enable: buttonConfigData.hasTrialPeriod">\r\n                </select>\r\n\r\n                <select class="wsb-select-box" data-bind="\r\n                    options: billingCyclePeriods, \r\n                    optionsText: \'name\',\r\n                    optionsValue: \'value\',\r\n                    value: buttonConfigData.trialPeriodBillingData.period,\r\n                    enable: buttonConfigData.hasTrialPeriod">\r\n                </select>\r\n\r\n                <!-- ko if: buttonConfigData.trialPeriodBillingData.price.isValid && !buttonConfigData.trialPeriodBillingData.price.isValid() && showErrorSubscribeTrialPrice() -->\r\n                <div class="wsb-text-box-error-text" data-bind="text: buttonConfigData.trialPeriodBillingData.price.validationMessage"></div>\r\n                <!-- /ko-->\r\n            </div>\r\n\r\n        </div>\r\n\r\n        <label class="checkbox">\r\n            <input type="checkbox" data-bind="checked: buttonConfigData.showUnsubscribe" />\r\n            <span data-bind="text: i18Dict.Server__Show_link_to_let_users_unsubscribe"></span>\r\n        </label>\r\n    </div>\r\n\r\n\r\n\r\n       \r\n</script>\r\n\r\n\r\n<!-- Connect to paypal -->\r\n<script type="text/html" id="paypalWizard_account">\r\n    <h3 class="sf-dialog-title" style="cursor: text;" data-bind="text: i18Dict.Server__Connect_Paypal_account"></h3>\r\n    \r\n    <div class="wsb-canvas-mutator-inner wsb-paypal-step">\r\n        <div class="wsb-paypal-steps" data-bind="text: xStepOfY(stepCount(), stepCount())"></div>\r\n        \r\n        \r\n        <!-- ko ifnot: buttonType() == \'Subscribe\'-->    \r\n        <div class="wsb-paypal-recieve-text" data-bind="text: i18Dict.Server__To_receive_payments_you_must_connect_Paypal">\r\n\r\n        </div>\r\n        <!-- /ko -->\r\n        <!-- ko if: buttonType() == \'Subscribe\'-->    \r\n        <div class="wsb-paypal-recieve-text" data-bind="html: i18Dict.Server__To_receive_payments_you_must_connect_PayPal_premier_or_business">\r\n\r\n        </div>\r\n        <!-- /ko -->\r\n\r\n        <div class="clearfix">\r\n\r\n            <div class="wsb-paypal-email">\r\n                <label class="wsb-block-label">\r\n                    <span data-bind="text: i18Dict.Server__Paypal_email_address_colon"></span>\r\n                    <span data-aid="payPalEmailTip" class="sf-tip" \r\n                          data-bind="attr: {\'data-title\': i18Dict.Server__PayPal_email_address_titlecase, \'data-content\': i18Dict.Server__This_is_the_email_you_used_for_PayPal }"></span>\r\n                </label>\r\n\r\n                <input \r\n                    type="text"\r\n                    data-bind="\r\n                    picker: { \r\n                        value: emailAddress, \r\n                        watermark: $data.watermark, \r\n                        normalize: $data.normalize,\r\n                        editorTemplate: $data.editorTemplate,\r\n                        editorModel: $data.editorModel,\r\n                        isPlaceholder: hasEmailPlaceholder,\r\n                        placeholderCssClass: \'wsb-napsoc-placeholder\',\r\n                        placeholderText: emailPlaceholderText,\r\n                        placeholderTooltip: napsocEmailAddress,\r\n                        flyoutTemplate: \'email-picker-template\',\r\n                        flyoutWidth: $data.flyoutWidth,\r\n                        flyoutModel: $data,\r\n                        clearPlaceholder: $data.clearPlaceholder\r\n                    }\r\n                    " />\r\n                <!-- ko if: emailAddress.isValid && !emailAddress.isValid() -->\r\n                <div class="wsb-text-box-error-text" data-bind="text: emailAddress.validationMessage"></div>\r\n                <!-- /ko -->\r\n            </div>\r\n            \r\n            <div class="wsb-paypal-create-account">\r\n                <a class="wsb-link" data-bind="attr: {href: i18Dict.PayPalHomePage}, ga: { click: { category: \'yelp_settings\', action: \'create_paypalacct\', label: \'link\' } }, text: i18Dict.Server__I_need_to_create_a_PayPal_account" target="_blank"></a>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</script>\r\n'
}),define("text!designer/app/builder/ui/canvas/elements/paypal/mutator.paypal.html",[],function(){return'<script type="text/html" id ="mutator-template-element-paypal">\r\n\r\n<!-- ko if: Type() === \'paypal\' && $data.mutatorViewModel -->\r\n<!-- ko with: mutatorViewModel -->\r\n<div class="wsb-canvas-mutator-inner">\r\n\r\n   <div class="wsb-canvas-mutator-ctrl-outer wsb-canvas-mutator-textbox clearfix">\r\n        <div class="paypal-vert-spacer wsb-canvas-mutator-ctrl-label wsb-repeat-label" data-bind= "text: i18Dict.PaypalAccountColon"></div>\r\n        <div class="wsb-canvas-mutator-ctrl-input">\r\n            <span class="paypal-vert-spacer wsb-canvas-paypal-field" data-bind="text:emailAddress"></span>\r\n            <a class="btn btn-inverse-grey" data-bind="click: changeEmail, text: i18Dict.Change" style="float:right;"></a>\r\n        </div>\r\n    </div>\r\n\r\n    <div class="wsb-canvas-mutator-ctrl-outer wsb-canvas-mutator-textbox clearfix">\r\n        <div class="paypal-vert-spacer wsb-canvas-mutator-ctrl-label wsb-repeat-label" data-bind= "text: i18Dict.PaymentTypeColon">\r\n        </div>\r\n        <div class="wsb-canvas-mutator-ctrl-input">\r\n            <span class="paypal-vert-spacer wsb-canvas-paypal-field" data-bind="text:getButtonName()"></span>\r\n            <a class="btn btn-inverse-grey" data-bind="click: changeButtonType, text: i18Dict.Change" style="float:right;"></a>\r\n        </div> \r\n    </div>\r\n    \r\n    <!-- ko if: buttonType() == buttonTypeEnum.BuyNow || buttonType() == buttonTypeEnum.ShoppingCart-->\r\n    <div class="wsb-canvas-mutator-ctrl-outer wsb-canvas-mutator-textbox clearfix">\r\n        <div class="paypal-vert-spacer wsb-canvas-mutator-ctrl-label wsb-repeat-label" data-bind= "text: i18Dict.ItemColon"></div>\r\n        <div class="wsb-canvas-mutator-ctrl-input">\r\n            <span class="paypal-vert-spacer wsb-canvas-paypal-field" data-bind="text:getItemName()"></span>\r\n            <span class="paypal-vert-spacer wsb-canvas-paypal-field" data-bind="text:getPrice()"></span>\r\n            <a class="btn btn-inverse-grey" data-bind="click: changeItem, text: i18Dict.Change" style="float:right;"></a>\r\n        </div>\r\n    </div>\r\n    <!--/ko-->\r\n    \r\n    <!-- ko if: buttonType() == buttonTypeEnum.Donate-->\r\n    <div class="wsb-canvas-mutator-ctrl-outer wsb-canvas-mutator-textbox clearfix">\r\n        <div class="paypal-vert-spacer wsb-canvas-mutator-ctrl-label wsb-repeat-label" data-bind= "text: i18Dict.OrganizationColon"></div>\r\n        <div class="wsb-canvas-mutator-ctrl-input">\r\n            <span class="paypal-vert-spacer wsb-canvas-paypal-field" data-bind="text:getOrganization()"></span>\r\n            <!--ko if: getFixedContributionAmount() -->\r\n            <span class="paypal-vert-spacer wsb-canvas-paypal-field" data-bind="text:getFixedContributionAmount()"></span>   \r\n            <!--/ko-->\r\n            <a class="btn btn-inverse-grey" data-bind="click: changeItem, text: i18Dict.Change" style="float:right;"></a>\r\n        </div>\r\n    </div>\r\n    <!--/ko-->\r\n    \r\n     <!-- ko if: buttonType() == buttonTypeEnum.Subscribe -->\r\n    <div class="wsb-canvas-mutator-ctrl-outer wsb-canvas-mutator-textbox clearfix">\r\n        <div class="paypal-vert-spacer wsb-canvas-mutator-ctrl-label wsb-repeat-label" data-bind= "text: i18Dict.ItemColon"></div>\r\n        <div class="wsb-canvas-mutator-ctrl-input">\r\n            <span class="paypal-vert-spacer wsb-canvas-paypal-field" data-bind="text:getItemName()"></span>\r\n            <span class="paypal-vert-spacer wsb-canvas-paypal-field" data-bind="text:getBillingCyclePrice()"></span>\r\n            <a class="btn btn-inverse-grey" data-bind="click: changeItem, text: i18Dict.Change" style="float:right;"></a>\r\n        </div>\r\n    </div>\r\n    <!--/ko-->\r\n\r\n    <!-- ko if: buttonType() == buttonTypeEnum.GiftCertificate-->\r\n    <div class="wsb-canvas-mutator-ctrl-outer wsb-canvas-mutator-textbox clearfix">\r\n        <div class="paypal-vert-spacer wsb-canvas-mutator-ctrl-label wsb-repeat-label" data-bind= "text: i18Dict.GiftCertificateColon"></div>\r\n        <div class="wsb-canvas-mutator-ctrl-input">\r\n            <a class="btn btn-inverse-grey" data-bind="click: previewGiftCert, text: i18Dict.PreviewSlashEdit" style="float:right;"></a>\r\n        </div>\r\n    </div>\r\n    <!--/ko-->\r\n\r\n    <div class="wsb-canvas-mutator-ctrl-outer wsb-canvas-mutator-checkbox clearfix">\r\n        <div class="wsb-canvas-mutator-ctrl-label" data-bind="text:i18Dict.OptionsColon"></div>\r\n        <div class="wsb-canvas-mutator-ctrl-input clearfix">\r\n            <label class="checkbox">\r\n                <input type="checkbox" data-bind="checked: showSmallButton" />\r\n                <span data-bind="text:i18Dict.SmallButton"></span>\r\n            </label>\r\n\r\n            <label class="checkbox">\r\n                <input type="checkbox" data-bind="\r\n                    checked: showPaymentOptions,\r\n                    enable: !showSmallButton() && buttonType()!=buttonTypeEnum.ShoppingCart" />\r\n                <span data-bind="text:i18Dict.ShowCreditCardLogos"></span>\r\n            </label>\r\n        </div>\r\n    </div>\r\n</div>\r\n<!-- /ko -->\r\n<!-- /ko -->\r\n    </script>\r\n'}),define("common/i18n/currencies",[],function(){return[{EnglishName:"Saudi Riyal",NativeName:"ريال سعودي",Symbol:"ر.س.‏",IsoCurrencySymbol:"SAR"},{EnglishName:"Bulgarian Lev",NativeName:"България лев",Symbol:"лв.",IsoCurrencySymbol:"BGN"},{EnglishName:"Euro",NativeName:"euro",Symbol:"€",IsoCurrencySymbol:"EUR"},{EnglishName:"New Taiwan Dollar",NativeName:"新台幣",Symbol:"NT$",IsoCurrencySymbol:"TWD"},{EnglishName:"Czech Koruna",NativeName:"Koruna Česká",Symbol:"Kč",IsoCurrencySymbol:"CZK"},{EnglishName:"Danish Krone",NativeName:"Dansk krone",Symbol:"kr.",IsoCurrencySymbol:"DKK"},{EnglishName:"US Dollar",NativeName:"US Dollar",Symbol:"$",IsoCurrencySymbol:"USD"},{EnglishName:"Israeli New Shekel",NativeName:"שקל חדש",Symbol:"₪",IsoCurrencySymbol:"ILS"},{EnglishName:"Hungarian Forint",NativeName:"forint",Symbol:"Ft",IsoCurrencySymbol:"HUF"},{EnglishName:"Icelandic Krona",NativeName:"Króna",Symbol:"kr.",IsoCurrencySymbol:"ISK"},{EnglishName:"Japanese Yen",NativeName:"円",Symbol:"¥",IsoCurrencySymbol:"JPY"},{EnglishName:"Korean Won",NativeName:"원",Symbol:"₩",IsoCurrencySymbol:"KRW"},{EnglishName:"Norwegian Krone",NativeName:"Norsk krone",Symbol:"kr",IsoCurrencySymbol:"NOK"},{EnglishName:"Polish Zloty",NativeName:"Złoty",Symbol:"zł",IsoCurrencySymbol:"PLN"},{EnglishName:"Real",NativeName:"Real",Symbol:"R$",IsoCurrencySymbol:"BRL"},{EnglishName:"Swiss Franc",NativeName:"Franc svizzer",Symbol:"fr.",IsoCurrencySymbol:"CHF"},{EnglishName:"Romanian Leu",NativeName:"Leu",Symbol:"lei",IsoCurrencySymbol:"RON"},{EnglishName:"Russian Ruble",NativeName:"рубль",Symbol:"р.",IsoCurrencySymbol:"RUB"},{EnglishName:"Croatian Kuna",NativeName:"hrvatska kuna",Symbol:"kn",IsoCurrencySymbol:"HRK"},{EnglishName:"Albanian Lek",NativeName:"Lek",Symbol:"Lek",IsoCurrencySymbol:"ALL"},{EnglishName:"Swedish Krona",NativeName:"Svensk krona",Symbol:"kr",IsoCurrencySymbol:"SEK"},{EnglishName:"Thai Baht",NativeName:"บาท",Symbol:"฿",IsoCurrencySymbol:"THB"},{EnglishName:"Turkish Lira",NativeName:"Türk Lirası",Symbol:"₺",IsoCurrencySymbol:"TRY"},{EnglishName:"Pakistan Rupee",NativeName:"روپيه",Symbol:"Rs",IsoCurrencySymbol:"PKR"},{EnglishName:"Indonesian Rupiah",NativeName:"Rupiah",Symbol:"Rp",IsoCurrencySymbol:"IDR"},{EnglishName:"Ukrainian Grivna",NativeName:"гривня",Symbol:"₴",IsoCurrencySymbol:"UAH"},{EnglishName:"Belarusian Ruble",NativeName:"рубль",Symbol:"р.",IsoCurrencySymbol:"BYR"},{EnglishName:"Latvian Lats",NativeName:"Lats",Symbol:"Ls",IsoCurrencySymbol:"LVL"},{EnglishName:"Lithuanian Litas",NativeName:"Litas",Symbol:"Lt",IsoCurrencySymbol:"LTL"},{EnglishName:"Ruble",NativeName:"рубл",Symbol:"т.р.",IsoCurrencySymbol:"TJS"},{EnglishName:"Iranian Rial",NativeName:"رىال",Symbol:"ريال",IsoCurrencySymbol:"IRR"},{EnglishName:"Vietnamese Dong",NativeName:"Đồng",Symbol:"₫",IsoCurrencySymbol:"VND"},{EnglishName:"Armenian Dram",NativeName:"դրամ",Symbol:"դր.",IsoCurrencySymbol:"AMD"},{EnglishName:"Azerbaijanian Manat",NativeName:"manat",Symbol:"man.",IsoCurrencySymbol:"AZN"},{EnglishName:"Macedonian Denar",NativeName:"денар",Symbol:"ден.",IsoCurrencySymbol:"MKD"},{EnglishName:"South African Rand",NativeName:"Rand",Symbol:"R",IsoCurrencySymbol:"ZAR"},{EnglishName:"Lari",NativeName:"ლარი",Symbol:"Lari",IsoCurrencySymbol:"GEL"},{EnglishName:"Indian Rupee",NativeName:"रुपया",Symbol:"₹",IsoCurrencySymbol:"INR"},{EnglishName:"Malaysian Ringgit",NativeName:"Ringgit Malaysia",Symbol:"RM",IsoCurrencySymbol:"MYR"},{EnglishName:"Tenge",NativeName:"Т",Symbol:"Т",IsoCurrencySymbol:"KZT"},{EnglishName:"som",NativeName:"сом",Symbol:"сом",IsoCurrencySymbol:"KGS"},{EnglishName:"Kenyan Shilling",NativeName:"Shilingi",Symbol:"S",IsoCurrencySymbol:"KES"},{EnglishName:"Turkmen manat",NativeName:"manat",Symbol:"m.",IsoCurrencySymbol:"TMT"},{EnglishName:"Uzbekistan Som",NativeName:"so‘m",Symbol:"so'm",IsoCurrencySymbol:"UZS"},{EnglishName:"Tugrik",NativeName:"Төгрөг",Symbol:"₮",IsoCurrencySymbol:"MNT"},{EnglishName:"PRC Renminbi",NativeName:"མི་དམངས་ཤོག་སྒོཪ།",Symbol:"¥",IsoCurrencySymbol:"CNY"},{EnglishName:"UK Pound Sterling",NativeName:"UK Pound Sterling",Symbol:"£",IsoCurrencySymbol:"GBP"},{EnglishName:"Riel",NativeName:"x179Aៀល",Symbol:"៛",IsoCurrencySymbol:"KHR"},{EnglishName:"Kip",NativeName:"ກີບ",Symbol:"₭",IsoCurrencySymbol:"LAK"},{EnglishName:"Syrian Pound",NativeName:"جنيه سوري",Symbol:"ل.س.‏",IsoCurrencySymbol:"SYP"},{EnglishName:"Sri Lanka Rupee",NativeName:"රුපියල්",Symbol:"රු.",IsoCurrencySymbol:"LKR"},{EnglishName:"Canadian Dollar",NativeName:"Canadian Dollar",Symbol:"$",IsoCurrencySymbol:"CAD"},{EnglishName:"Ethiopian Birr",NativeName:"ብር",Symbol:"ETB",IsoCurrencySymbol:"ETB"},{EnglishName:"Nepalese Rupees",NativeName:"रुपैयाँ",Symbol:"रु",IsoCurrencySymbol:"NPR"},{EnglishName:"Afghani",NativeName:"افغانى",Symbol:"؋",IsoCurrencySymbol:"AFN"},{EnglishName:"Philippine Peso",NativeName:"Philippine Peso",Symbol:"PhP",IsoCurrencySymbol:"PHP"},{EnglishName:"Rufiyaa",NativeName:"ރުފިޔާ",Symbol:"ރ.",IsoCurrencySymbol:"MVR"},{EnglishName:"Nigerian Naira",NativeName:"Naira",Symbol:"N",IsoCurrencySymbol:"NIO"},{EnglishName:"Boliviano",NativeName:"Boliviano",Symbol:"$b",IsoCurrencySymbol:"BOB"},{EnglishName:"Chilean Peso",NativeName:"Peso",Symbol:"$",IsoCurrencySymbol:"CLP"},{EnglishName:"New Zealand Dollar",NativeName:"tāra",Symbol:"$",IsoCurrencySymbol:"NZD"},{EnglishName:"Guatemalan Quetzal",NativeName:"Quetzal",Symbol:"Q",IsoCurrencySymbol:"GTQ"},{EnglishName:"Rwandan Franc",NativeName:"Ifaranga",Symbol:"RWF",IsoCurrencySymbol:"RWF"},{EnglishName:"XOF Senegal",NativeName:"XOF Senegal",Symbol:"XOF",IsoCurrencySymbol:"XOF"},{EnglishName:"Iraqi Dinar",NativeName:"دينار عراقي",Symbol:"د.ع.‏",IsoCurrencySymbol:"IQD"},{EnglishName:"Mexican Peso",NativeName:"Peso",Symbol:"$",IsoCurrencySymbol:"MXN"},{EnglishName:"Serbian Dinar",NativeName:"dinar",Symbol:"Din.",IsoCurrencySymbol:"CSD"},{EnglishName:"Brunei Dollar",NativeName:"Ringgit",Symbol:"$",IsoCurrencySymbol:"BND"},{EnglishName:"Bangladeshi Taka",NativeName:"টাকা",Symbol:"৳",IsoCurrencySymbol:"BDT"},{EnglishName:"Algerian Dinar",NativeName:"Dinar",Symbol:"DZD",IsoCurrencySymbol:"DZD"},{EnglishName:"Egyptian Pound",NativeName:"جنيه مصري",Symbol:"ج.م.‏",IsoCurrencySymbol:"EGP"},{EnglishName:"Hong Kong Dollar",NativeName:"港幣",Symbol:"HK$",IsoCurrencySymbol:"HKD"},{EnglishName:"Australian Dollar",NativeName:"Australian Dollar",Symbol:"$",IsoCurrencySymbol:"AUD"},{EnglishName:"Peruvian Nuevo Sol",NativeName:"Nuevo Sol",Symbol:"S/.",IsoCurrencySymbol:"PEN"},{EnglishName:"Libyan Dinar",NativeName:"دينار ليبي",Symbol:"د.ل.‏",IsoCurrencySymbol:"LYD"},{EnglishName:"Singapore Dollar",NativeName:"新币",Symbol:"$",IsoCurrencySymbol:"SGD"},{EnglishName:"Convertible Marks",NativeName:"konvertibilna marka",Symbol:"KM",IsoCurrencySymbol:"BAM"},{EnglishName:"Macao Pataca",NativeName:"澳門幣",Symbol:"MOP",IsoCurrencySymbol:"MOP"},{EnglishName:"Costa Rican Colon",NativeName:"Colón",Symbol:"₡",IsoCurrencySymbol:"CRC"},{EnglishName:"Moroccan Dirham",NativeName:"درهم مغربي",Symbol:"د.م.‏",IsoCurrencySymbol:"MAD"},{EnglishName:"Panamanian Balboa",NativeName:"Balboa",Symbol:"B/.",IsoCurrencySymbol:"PAB"},{EnglishName:"Tunisian Dinar",NativeName:"دينار تونسي",Symbol:"د.ت.‏",IsoCurrencySymbol:"TND"},{EnglishName:"Dominican Peso",NativeName:"Peso",Symbol:"RD$",IsoCurrencySymbol:"DOP"},{EnglishName:"Omani Rial",NativeName:"ريال عماني",Symbol:"ر.ع.‏",IsoCurrencySymbol:"OMR"},{EnglishName:"Jamaican Dollar",NativeName:"Jamaican Dollar",Symbol:"J$",IsoCurrencySymbol:"JMD"},{EnglishName:"Venezuelan Bolivar",NativeName:"Bolívar",Symbol:"Bs. F.",IsoCurrencySymbol:"VEF"},{EnglishName:"Yemeni Rial",NativeName:"ريال يمني",Symbol:"ر.ي.‏",IsoCurrencySymbol:"YER"},{EnglishName:"Colombian Peso",NativeName:"Peso",Symbol:"$",IsoCurrencySymbol:"COP"},{EnglishName:"Serbian Dinar",NativeName:"dinar",Symbol:"Din.",IsoCurrencySymbol:"RSD"},{EnglishName:"Belize Dollar",NativeName:"Belize Dollar",Symbol:"BZ$",IsoCurrencySymbol:"BZD"},{EnglishName:"Jordanian Dinar",NativeName:"دينار اردني",Symbol:"د.ا.‏",IsoCurrencySymbol:"JOD"},{EnglishName:"Trinidad Dollar",NativeName:"Trinidad Dollar",Symbol:"TT$",IsoCurrencySymbol:"TTD"},{EnglishName:"Argentine Peso",NativeName:"Peso",Symbol:"$",IsoCurrencySymbol:"ARS"},{EnglishName:"Lebanese Pound",NativeName:"ليرة لبناني",Symbol:"ل.ل.‏",IsoCurrencySymbol:"LBP"},{EnglishName:"Zimbabwe Dollar",NativeName:"Zimbabwe Dollar",Symbol:"Z$",IsoCurrencySymbol:"ZWL"},{EnglishName:"Kuwaiti Dinar",NativeName:"دينار كويتي",Symbol:"د.ك.‏",IsoCurrencySymbol:"KWD"},{EnglishName:"UAE Dirham",NativeName:"درهم اماراتي",Symbol:"د.إ.‏",IsoCurrencySymbol:"AED"},{EnglishName:"Peso Uruguayo",NativeName:"Peso",Symbol:"$U",IsoCurrencySymbol:"UYU"},{EnglishName:"Bahraini Dinar",NativeName:"دينار بحريني",Symbol:"د.ب.‏",IsoCurrencySymbol:"BHD"},{EnglishName:"Paraguay Guarani",NativeName:"Guaraní",Symbol:"Gs",IsoCurrencySymbol:"PYG"},{EnglishName:"Qatari Rial",NativeName:"ريال قطري",Symbol:"ر.ق.‏",IsoCurrencySymbol:"QAR"},{EnglishName:"Honduran Lempira",NativeName:"Lempira",Symbol:"L.",IsoCurrencySymbol:"HNL"}]}),define("designer/app/builder/ui/canvas/elements/paypal/el.paypal",["text!designer/app/builder/ui/canvas/elements/paypal/el.paypal.html","text!designer/app/builder/ui/canvas/elements/paypal/mutator.paypal.html","knockout","jquery","designer/app/builder/ui/canvas/elements/helper","appconfig","designer/app/builder/managers/pageManager","designer/app/builder/ui/controls/actionmenu/actionmenu","designer/app/builder/data/data","common/persistence/persistence","common/regexhelper/regexhelper","common/ui/dialog","designer/app/builder/ui/controls/media/chooser/media.chooser","common/stats/googleanalytics","/i18n/resources/client","common/i18n/currencies","common/util/documentHelper","wsbcore/tipper"],function(e,t,n,i,a,r,o,s,l,d,c,u,p,g,h,m,b){function f(e,t,a){function o(){return"{}"==d.PayPalButtonConfigData()}function l(){var e="step2",t=d.wizardModel;return t.isFirstPage()?e="step1":t.isLastPage()&&(e=3===t.stepCount()?"step3":"step4"),e}e.call(this,t);var d=this;d.showHorizontalResizeHandles(!1),d.showVerticalResizeHandles(!1);var c=d,u={text:h.resources.Settings,tip:h.resources.Settings,cssClass:"wsb-tool-Edit",click:function(){return c.isDialogClosed=!1,c.showProperties(),i('[data-aid="trackingIdTip"]').sfTipper({wireup:!0}),c.mutatorViewModel.setDisplayMode(),!1}},p={text:h.resources.Client__Designer__Set_Up,tip:h.resources.Client__Designer__Set_Up,cssClass:"wsb-tool-Edit",click:function(){return c.showWizard(),i('[data-aid="trackingIdTip"]').sfTipper({wireup:!0}),!1}},m={text:h.resources.Client__Designer__Modify_Price,tip:h.resources.Client__Designer__Modify_Price,cssClass:"wsb-tool-Edit",click:function(){return c.showWizard("step2"),i('[data-aid="trackingIdTip"]').sfTipper({wireup:!0}),!1}};d.getActionMenuItems=n.computed(function(){var e=d.getCommands();return o()?[p,e.clone,e["delete"],e.layoutCommands]:[u,m,e.clone,e["delete"],e.layoutCommands]}),c.Title=h.resources.PayPal,c.SettingsTitle=h.resources.PayPal_Settings,c.buttonImageUrl=n.computed(function(){var e="PP"+d.PayPalButtonType()+d.PayPalButtonDisplayMode();return r.payPalButtonPath+r.payPalConfig[e]}),c.unsubSubscribeImageUrl=n.computed(function(){var e="PPUnsubscribe"+("SM"==d.PayPalButtonDisplayMode()?"SM":"LG");return r.payPalConfig.PayPalButtonPath+r.payPalConfig[e]}),c.isDialogClosed=!0,c.state.subscribe(function(e){return"edit"==e?(c.isDialogClosed=!1,o()?void c.showWizard():void c.showProperties()):void 0}),c.buttonTypeEnum=S,c.effectiveEmailAddress=n.computed(function(){var e=d.PayPalEmailAddress();return e===T?w.observables().Email()||h.resources.Client__Designer__Not_set:e}),c.mutatorViewModel=new _(d);var b={},f=function(e,t){if(e&&t){var n=e+t,i=function(n){k.disable("paypal resize"),c.minWidth=n.width+8,c.minHeight=n.height+8,e==S.GiftCertificate&&c.giftCertPriceList().length>0&&(c.minHeight+=30),e==S.Subscribe&&c.showUnsubscribe()&&(c.minHeight+=t==C.Small?29:34);var i=parseFloat(c.Width()),a=parseFloat(c.Height());i<c.minWidth&&c.Width(c.minWidth+"px"),a<c.minHeight&&c.Height(c.minHeight+"px"),k.enable("paypal resize")};if(b.hasOwnProperty(n))i(b[n]);else{var a=new Image;a.onload=function(){var e={width:a.width,height:a.height};b[n]=e,i(e)},a.src=c.buttonImageUrl()}}};c.giftCertPriceList=n.computed(function(){var e=[];if(d.PayPalButtonType()==S.GiftCertificate){var t=i.parseJSON(c.PayPalButtonConfigData()),a=t.giftCustomizedPriceList,r=t.giftSpecificAmount;a&&a.length>0&&!r&&(e=n.toJS(a))}return e.length>0&&f(S.GiftCertificate,c.PayPalButtonDisplayMode()),e}),c.needShowPriceList=n.computed(function(){var e=i.parseJSON(c.PayPalButtonConfigData()).giftSpecificAmount;return!e&&c.giftCertPriceList().length>0}),c.showUnsubscribe=n.computed(function(){var e=i.parseJSON(c.PayPalButtonConfigData()).showUnsubscribe;return e&&f(S.Subscribe,c.PayPalButtonDisplayMode()),e}),c.wizardModel=null,c.showWizard=function(e,t,a){s.hide();var r="paypalwizard";i("#"+r).remove(),i("<div></div>").attr("id",r).addClass("paypal-wizard-container").css("width","772px").appendTo("body");var o=t?t.find("#"+r):i("#"+r),u=new y(d,o,e);c.wizardModel=u,o.wsbDialog({titleHidden:!0,destroyOnClose:!0,draggable:!1,onOpen:function(){k.collect("paypal wizard"),c.isDialogClosed=!1,o.attr("data-bind","template: { name: 'paypalWizard_container'}").wsbDialog("resize"),n.applyBindings(u,o.parent().parent()[0]),i('[data-aid="trackingIdTip"]').sfTipper({wireup:!0}),i('[data-aid="itemIdTip"]').sfTipper({wireup:!0}),i('[data-aid="payPalEmailTip"]').sfTipper({wireup:!0})},onClose:function(e,t){i("#"+r).remove(),c.isDialogClosed=!0,k.enable("paypal wizard"),t&&g.trackEvent("paypal_settings","xclose_from"+l(),"link")},buttons:[{id:"cancel",style:"link",cancel:!0,text:h.resources.Cancel,onClick:function(){g.trackEvent("paypal_settings","cancel_from"+l(),"link")}},{id:"prev",text:h.resources.Back,attributes:{"data-bind":"visible: !isFirstPage()"},onClick:function(){u.prevPage(),g.trackEvent("paypal_settings","back_to"+l(),"button")}},{id:"next",text:h.resources.Next,attributes:{"data-bind":"visible: !isLastPage(), css: 'btn btn-success' + (isValid &&!isValid() ? ' disabled': '')"},onClick:function(){u.nextPage(),g.trackEvent("paypal_settings","next_to"+l(),"button")}},{id:"finish",text:h.resources.Finish,attributes:{"data-bind":"visible: isLastPage() || isStep2(), enable: isValid, css: 'btn btn-success' + (isValid &&!isValid() ? ' disabled': '')"},onClick:function(){u.finish(),k.enable("paypal wizard"),g.trackEvent("paypal_settings","finish","button")}}],buttonAlign:"right"}),i.isFunction(a)&&a(u)},f(c.PayPalButtonType(),c.PayPalButtonDisplayMode()),c.PayPalButtonType.subscribe(function(e){f(e,c.PayPalButtonDisplayMode())}),c.PayPalButtonDisplayMode.subscribe(function(e){f(c.PayPalButtonType(),e)}),[c.PayPalButtonType,c.PayPalButtonDisplayMode,c.PayPalButtonConfigData,c.PayPalGiftCertLogoDocumentId].forEach(function(e){e.subscribe(function(){c.ensureAccurateOuterSize()})}),c.i18Dict={Server__PayPal_the_safer_easier_way_to_pay_online:h.resources.Server__PayPal_the_safer_easier_way_to_pay_online},a&&o()&&setTimeout(c.showWizard,100)}function v(){for(var e=[],t=0;t<x.length;t++)for(var n=0;n<m.length;n++)if(x[t]===m[n].IsoCurrencySymbol){var i=m[n].NativeName+" "+m[n].Symbol+" "+m[n].IsoCurrencySymbol;e.push({name:i,id:m[n].IsoCurrencySymbol});break}return e}function y(e,t,a){function s(e){var t=r.payPalGiftCertPreviewUrl+"&url_custom="+l.redeemUrl();if(t+=""!=l.giftCertLogoUrl()?"&logo_image_custom="+l.giftCertLogoUrl():"&logo_image_custom=http://",l.giftCertDesignType()==l.giftCertDesignTypeEnum.Color&&""!=l.buttonConfigData.backgroundColor()&&(t+="&style_color="+l.buttonConfigData.backgroundColor()),l.giftCertDesignType()==l.giftCertDesignTypeEnum.Template&&""!=l.buttonConfigData.template()&&(t+="&style_theme="+l.buttonConfigData.template()),!e)return void window.open(t,"paypal_gift_cert_url","status=0,toolbar=0,location=0,menubar=0,directories=0,resizable=1,scrollbars=1,width=640,height=480");window.cropPayPalGiftCertificate=function(){var e=i("<table><tr></tr></table>");e.find("tr").append(i(n.contents().find("table")[2]).parent()),n.contents().find("body").html(e),n.parent().sfMsgOverlay({message:null})},t="/SocialMediaAuth/PayPalGiftCertPreview?url="+encodeURIComponent(t);var n=i('[data-aid="gift-cert-preview-container"]');n.parent().sfMsgOverlay({message:h.resources.Loading}),n.attr("src",t)}var l=this,u={button:"button",account:"account",design:"gift_design"};l.buttonType=n.observable(e.PayPalButtonType()),l.isStep2=n.observable();var f;"step2"==a?(f=l.buttonType().toLowerCase(),l.isStep2(!0)):a?f=a:(f=u.button,l.isStep2(!1)),l.buttonType=n.observable(e.PayPalButtonType()),l.page=n.observable(f),l.page.subscribe(function(e){setTimeout(function(){e==S.Donate.toLowerCase()?i('[data-aid="trackingIdTip"]').sfTipper({wireup:!0}):e==S.BuyNow.toLowerCase()||e==S.ShoppingCart.toLowerCase()?i('[data-aid="itemIdTip"]').sfTipper({wireup:!0}):e==u.account?i('[data-aid="payPalEmailTip"]').sfTipper({wireup:!0}):e==u.design&&l.showGiftCertPreview()},100)}),l.currency=n.observable(e.PayPalCurrency()),l.getCurrencySymbol=n.computed(function(){for(var e="$",t=0;t<m.length;t++)if(l.currency()===m[t].IsoCurrencySymbol){e=m[t].Symbol;break}return e}),l.currencyList=v(),l.buttonConfigData=U(e),l.formatPrice=function(e,t){var n;switch(e){case"giftCustomizedPriceList":n=l.buttonConfigData[e]()[t].price;break;case"billingCycleDataPrice":n=l.buttonConfigData.billingCycleData.price;break;case"trialPeriodBillingDataPrice":n=l.buttonConfigData.trialPeriodBillingData.price;break;default:n=l.buttonConfigData[e]}var i=n();P(i)&&n(D(i))},l.amountTypeEnum=V,l.showErrorBuynowItemName=n.observable(!1),l.showErrorBuynowPrice=n.observable(!1),l.showErrorDonateOrgnization=n.observable(!1),l.showErrorDonateFixedAmount=n.observable(!1),l.showErrorGiftFixedAmount=n.observable(!1),l.showErrorSubscribePrice=n.observable(!1),l.showErrorSubscribeTrialPrice=n.observable(!1),l.showErrorSubscribeItemName=n.observable(!1),l.showErrorRedeemUrl=n.observable(!1),l.showErrorShipping=n.observable(!1),l.resetShowErrorFlags=function(){l.showErrorBuynowItemName(!1),l.showErrorBuynowPrice(!1),l.showErrorDonateOrgnization(!1),l.showErrorDonateFixedAmount(!1),l.showErrorGiftFixedAmount(!1),l.showErrorSubscribeItemName(!1),l.showErrorSubscribePrice(!1),l.showErrorSubscribeTrialPrice(!1),l.showErrorRedeemUrl(!1),l.showErrorShipping(!1)},l.pageTemplate=n.computed(function(){var e=l.page();return"paypalWizard_"+e}),l.stepCount=n.computed(function(){var e=l.buttonType();return e==S.GiftCertificate?4:3}),l.isFirstPage=n.computed(function(){return l.page()===u.button}),l.isLastPage=n.computed(function(){var e=l.page();return e==u.account}),l.buttonType.subscribe(function(){l.isStep2(!1)}),l.nextPage=function(){if(l.isValid()){var e=l.buttonType().toLowerCase(),t=l.page();t!=u.account&&(t==u.design?e=u.account:t==S.GiftCertificate.toLowerCase()?e=u.design:t==e&&(e=u.account),l.page(e))}},l.prevPage=function(){l.resetShowErrorFlags();var e=l.buttonType().toLowerCase(),t=l.page();t!=u.button&&(t==u.design?e=S.GiftCertificate.toLowerCase():t==e?e=u.button:e==S.GiftCertificate.toLowerCase()&&(e=u.design),l.page(e))},l.cancel=function(){t.wsbDialog("close")},l.finish=function(){l.isValid()&&(l.donateAmountType()==V.NotFixed&&l.buttonConfigData.fixedContributionAmount(""),e.PayPalEmailAddress(l.emailAddress()),e.PayPalButtonType(l.buttonType()),e.PayPalCurrency(l.currency()),e.PayPalButtonConfigData(j(l)),e.actionMenuItems=e.actionMenuItems_nextTime,t.wsbDialog("close"))},l.chooseBuyNow=function(){l.buttonType(S.BuyNow),l.nextPage()},l.chooseCart=function(){l.buttonType(S.ShoppingCart),l.nextPage()},l.chooseDonate=function(){l.buttonType(S.Donate),l.nextPage()},l.chooseGift=function(){l.buttonType(S.GiftCertificate),l.nextPage()},l.chooseSubscribe=function(){l.buttonType(S.Subscribe),l.nextPage()},l.selectBuyNow=function(){g.trackEvent("paypal_settings","buy_now","checkbox"),l.buttonType(S.BuyNow)},l.selectCart=function(){g.trackEvent("paypal_settings","add_tocart","checkbox"),l.buttonType(S.ShoppingCart)},l.selectDonate=function(){g.trackEvent("paypal_settings","donate","checkbox"),l.buttonType(S.Donate)},l.selectGift=function(){g.trackEvent("paypal_settings","gift_certificate","checkbox"),l.buttonType(S.GiftCertificate)},l.selectSubscribe=function(){g.trackEvent("paypal_settings","subscribe","checkbox"),l.buttonType(S.Subscribe)},l.showBuyNow=r.payPalConfig.enableBuyNow===!0,l.showDonate=r.payPalConfig.enableDonate===!0,l.showGift=r.payPalConfig.enableGift===!0,l.showSubscribe=r.payPalConfig.enableSubscribe===!0,l.showCart=r.payPalConfig.enableCart===!0,l.donateAmountType=n.observable(l.buttonType()==S.Donate&&""!=l.buttonConfigData.fixedContributionAmount()?V.Fixed:V.NotFixed),e.PayPalGiftCertRedeemUrl()||e.PayPalGiftCertRedeemUrl("page:"+i.grep(n.toJS(o.pages()),function(e){return e.IsHomePage})[0].Id),l.redeemUrl=e.PayPalGiftCertRedeemUrl,l.giftCertLogoDocumentId=e.PayPalGiftCertLogoDocumentId,l.giftCertLogoUrl=n.computed(function(){var e=l.giftCertLogoDocumentId();if(0==e)return"";var t=b.getDocumentUrl(e);return-1!=t.indexOf("document")&&(t="//"+window.location.hostname+t),t=window.location.protocol+t}),l.pages=n.computed(function(){return i.map(o.pages(),function(e){return{id:e.Id,name:e.Name,type:"page"}})}),l.giftCertDesignTypeEnum=F,l.giftCertBackgroundColors=R,l.giftCertTemplates=H,l.giftAmountType=n.observable(l.buttonType()==S.GiftCertificate&&""!=l.buttonConfigData.giftSpecificAmount()?V.Fixed:V.NotFixed),l.giftAmountType.subscribe(function(e){l.buttonType()==S.GiftCertificate&&e==V.NotFixed&&l.buttonConfigData.giftSpecificAmount("")}),l.giftCertDesignType=n.observable(""!=l.buttonConfigData.backgroundColor()?l.giftCertDesignTypeEnum.Color:l.giftCertDesignTypeEnum.Template),l.giftCertDesignType.subscribe(function(){l.showGiftCertPreview()}),l.showGiftCertPriceEditor=function(){l.giftAmountType(V.NotFixed);var e=i('[data-aid="gift-certificate-price-config-panel"]'),a=n.toJS(l.buttonConfigData.giftCustomizedPriceList()),r=[];i.each(a,function(e,t){var i={label:n.observable(t.label),price:n.observable(t.price),readOnly:n.observable(!0),showErrorLabel:n.observable(!1),showErrorPrice:n.observable(!1)};i.label=i.label.extend({validation:{custom:[{message:L,test:function(e){return e&&e.length}}]}}),i.label.subscribe(function(){i.showErrorLabel(!0)}),i.price=i.price.extend({validation:{custom:[{message:A,test:function(e){return l.buttonType()!=S.GiftCertificate?!0:E(e)}}]}}),i.price.subscribe(function(){i.showErrorPrice(!0)}),r.push(i)}),e.wsbDialog({veil:t,buttons:[{id:"ok",text:h.resources.OK,onClick:function(){return e.wsbDialog("close"),!1}},{id:"cancel",text:h.resources.Cancel,cancel:!0,onClick:function(){l.buttonConfigData.giftCustomizedPriceList(r)}}]})},l.priceEditorPanel_Click=function(){i.each(l.buttonConfigData.giftCustomizedPriceList(),function(e,t){!t.readOnly()&&t.price.isValid()&&t.label.isValid()&&t.readOnly(!0)})},l.editIcon_click=function(e){l.buttonConfigData.giftCustomizedPriceList()[e].readOnly(!1),i("#txt-paypal-price-label-"+e).focus()},l.deleteIcon_click=function(e){l.buttonConfigData.giftCustomizedPriceList.splice(e,1)},l.addPriceItem_click=function(){var e={label:n.observable(""),price:n.observable(""),readOnly:n.observable(!1),showErrorLabel:n.observable(!1),showErrorPrice:n.observable(!1)};e.label=e.label.extend({validation:{custom:[{message:L,test:function(e){return e&&e.length}}]}}),e.label.subscribe(function(){e.showErrorLabel(!0)}),e.price=e.price.extend({validation:{custom:[{message:A,test:function(e){return l.buttonType()!=S.GiftCertificate||l.giftAmountType()!=V.NotFixed?!0:E(e)}}]}}),e.price.subscribe(function(){e.showErrorPrice(!0)}),l.buttonConfigData.giftCustomizedPriceList.push(e)},l.logoImageSize={width:"285px",height:"45px"},l.chooseLogoImage=function(){var n=t.parent().parent().parent(),i=n.css("z-index");n.css("z-index",10);var a=[],r=e.PayPalGiftCertLogoDocumentId().toString();r&&a.push({id:r}),g.trackEvent("wsb-designer-media-chooser-image","open","paypal"),p.openImages(!1,a,function(t){t&&t.length&&(e.PayPalGiftCertLogoDocumentId(t[0].id),l.buttonConfigData.logoImageName(t[0].name()),l.showGiftCertPreview()),n.css("z-index",i)})},l.removeLogoImage=function(){e.PayPalGiftCertLogoDocumentId(0),l.buttonConfigData.logoImageName(""),l.showGiftCertPreview()},l.showGiftCertPreviewOnPayPal=function(){s(!1)},l.showGiftCertPreview=function(){s(!0)},l.isGiftCustomizedPriceListValid=n.computed(function(){if(l.buttonType()!=S.GiftCertificate||l.giftAmountType()==V.Fixed)return!0;for(var e=l.buttonConfigData.giftCustomizedPriceList().length,t=i('[data-aid="gift-certificate-price-config-panel"]'),n=0;e>n;n++){var a=l.buttonConfigData.giftCustomizedPriceList()[n];if(!a.label.isValid()||!a.price.isValid())return t.wsbDialog("isOpen")&&t.wsbDialog("disableButton",0),!1}return t.wsbDialog("isOpen")&&t.wsbDialog("enableButton",0),!0}),l.billingCycleTimes=[];for(var y=1;30>=y;y++){var _={name:y.toString(),value:y};l.billingCycleTimes.push(_)}l.billingCyclePeriods=[{name:h.resources.Client__day_or_days,value:"D"},{name:h.resources.Client__week_or_weeks,value:"W"},{name:h.resources.Client__months_or_months,value:"M"},{name:h.resources.Client__year_or_years,value:"Y"}],l.isPayEmail=n.observable();var k=function(e){if(r.payPalConfig.enableEmailValidation===!0){var t=e===T?l.napsocEmailAddress():e;if(t&&c.validateEmailAddress(t)){var n="/api/websites/{websiteId}/StockSocialMedia?paypalEmailAddress="+encodeURIComponent(t);d.Get(n,function(e){l.isPayEmail(e&&e.isValid)},function(){l.isPayEmail(!1)})}}};l.emailAddress=n.observable(e.PayPalEmailAddress()).extend({validation:{custom:[{message:I,test:function(e){return e&&e.length}},{message:I,test:function(e){return e===T||c.validateEmailAddress(e)}},{message:I,test:function(e){return r.payPalConfig.enableEmailValidation!==!0?!0:(void 0===l.isPayEmail()&&k(e),l.isPayEmail())}}]}}),l.throttledEmailAddress=n.computed(l.emailAddress).extend({throttle:{type:"debounce",delay:500}}),l.throttledEmailAddress.subscribe(function(e){k(e)}),l.hasEmailPlaceholder=n.computed(function(){return l.emailAddress()===T}),l.napsocEmailAddress=w.observables().Email,l.emailPlaceholderText=n.computed(function(){return h.resources.Client__Designer__My_email+": "+e.effectiveEmailAddress()}),l.useEmailPlaceholder=function(){l.emailAddress(T)},l.payPalHomePage=r.payPalConfig.PayPalHomePage,W(l),l.isValid=n.computed(function(){var e=l.buttonConfigData;switch(l.page()){case u.button:return!0;case S.BuyNow.toLowerCase():case S.ShoppingCart.toLowerCase():return e.itemName.isValid()&&e.price.isValid()&&e.shipping.isValid();
case S.Donate.toLowerCase():return e.organization.isValid()?l.donateAmountType()!=V.Fixed||e.fixedContributionAmount.isValid()?!0:!1:!1;case S.GiftCertificate.toLocaleLowerCase():return l.redeemUrl.isValid()?l.giftAmountType()!=V.Fixed||e.giftSpecificAmount.isValid()?!0:!1:!1;case u.design:return!0;case S.Subscribe.toLowerCase():return e.billingCycleData.price.isValid()&&e.trialPeriodBillingData.price.isValid();case u.account:return l.emailAddress.isValid()}return!0}),l.i18Dict={Server__PayPal_the_safer_easier_way_to_pay_online:h.resources.Server__PayPal_the_safer_easier_way_to_pay_online,Server__How_would_you_like_your_payments:h.resources.Server__How_would_you_like_your_payments,Server__One_click_check_out:h.resources.Server__One_click_check_out,Server__Your_visitors_can_purchase_one_product_at_a_time:h.resources.Server__Your_visitors_can_purchase_one_product_at_a_time,Server__Shopping_cart:h.resources.Server__Shopping_cart,Server__Accept_donations:h.resources.Server__Accept_donations,Server__For_charities_drives_etc:h.resources.Server__For_charities_drives_etc,Server__Gift_certificates:h.resources.Server__Gift_certificates,Server__Get_more_business_with_gift_certs:h.resources.Server__Get_more_business_with_gift_certs,Server__Repeat_billing:h.resources.Server__Repeat_billing,Server__Requires_PayPal_premier_or_business_account:h.resources.Server__Requires_PayPal_premier_or_business_account,Server__Bill_your_customers_in_repeat_cycles:h.resources.Server__Bill_your_customers_in_repeat_cycles,Server__Buy_now_set_up_payment_options:h.resources.Server__Buy_now_set_up_payment_options,Server__Required_fields:h.resources.Server__Required_fields,Server__Item_name_colon:h.resources.Server__Item_name_colon,Server__Price_colon:h.resources.Server__Price_colon,Server__Shipping_colon:h.resources.Server__Shipping_colon,Server__Item_id_colon:h.resources.Server__Item_id_colon,Server__Currency_colon:h.resources.Server__Currency_colon,Server__Shopping_cart_set_up_payment_options:h.resources.Server__Shopping_cart_set_up_payment_options,Server__Donations_set_up_payment_options:h.resources.Server__Donations_set_up_payment_options,Server__Organization_colon:h.resources.Server__Organization_colon,Server__Donation_amount_colon:h.resources.Server__Donation_amount_colon,Server__Let_visitors_enter_amount:h.resources.Server__Let_visitors_enter_amount,Server__Specific_amount_colon:h.resources.Server__Specific_amount_colon,Server__Tracking_id_colon:h.resources.Server__Tracking_id_colon,Server__Gift_certs_set_up_payment_options:h.resources.Server__Gift_certs_set_up_payment_options,Server__Url_where_recipients_can_shop_colon:h.resources.Server__Url_where_recipients_can_shop_colon,Server__Gift_certificate_amount_colon:h.resources.Server__Gift_certificate_amount_colon,Server__Let_visitors_choose:h.resources.Server__Let_visitors_choose,Server__See_choices:h.resources.Server__See_choices,Server__Text_label_colon:h.resources.Server__Text_label_colon,Server__Add_another:h.resources.Server__Add_another,Server__Preview_full_gift_certificate:h.resources.Server__Preview_full_gift_certificate,Server__Choose_photo:h.resources.Server__Choose_photo,Server__Select_color_colon:h.resources.Server__Select_color_colon,Server__Select_template_colon:h.resources.Server__Select_template_colon,Server__Subscription_set_up_payment_options:h.resources.Server__Subscription_set_up_payment_options,Server__Note_to_use_repeat_billing:h.resources.Server__Note_to_use_repeat_billing,Server__Billing_cycle_colon:h.resources.Server__Billing_cycle_colon,Server__End_billing_cycle_after_colon:h.resources.Server__End_billing_cycle_after_colon,Server__Offer_trial_period_colon:h.resources.Server__Offer_trial_period_colon,Server__Show_link_to_let_users_unsubscribe:h.resources.Server__Show_link_to_let_users_unsubscribe,Server__To_receive_payments_you_must_connect_Paypal:h.resources.Server__To_receive_payments_you_must_connect_Paypal,Server__To_receive_payments_you_must_connect_PayPal_premier_or_business:h.resources.Server__To_receive_payments_you_must_connect_PayPal_premier_or_business,Server__Paypal_email_address_colon:h.resources.Server__Paypal_email_address_colon,Server__I_need_to_create_a_PayPal_account:h.resources.Server__I_need_to_create_a_PayPal_account,Server__Never:h.resources.Server__Never,Server__Connect_Paypal_account:h.resources.Server__Connect_Paypal_account,Server__Logo_colon:h.resources.Server__Logo_colon,Server__PayPal_email_address_titlecase:h.resources.Server__PayPal_email_address_titlecase,Server__This_is_the_email_you_used_for_PayPal:h.resources.Server__This_is_the_email_you_used_for_PayPal,Server__Item_id:h.resources.Server__Item_id,Server__Setting_an_item_id_helps:h.resources.Server__Setting_an_item_id_helps,Server__Tracking_id:h.resources.Server__Tracking_id,Server__Setting_a_unique_id_will_make_tracking_easier:h.resources.Server__Setting_a_unique_id_will_make_tracking_easier,ButtonPathUrl:r.payPalButtonPath,BuyNowImage:"btn_buynow_LG.gif",PayPalHomePage:r.payPalHomePage},("ja"===h.lang||"id"===h.lang)&&(l.i18Dict.BuyNowImage="btn_buynowCC_LG_na.gif"),l.xStepOfY=function(e,t){return h.resources.Server__Step_x_of_y.format(e,t)},l.logoDimensionString=function(e,t){return h.resources.Server__Dimensions_number_x_number.format(e,t)}}function _(e){this.i18Dict={OptionsColon:h.resources.Server__Options_colon,SmallButton:h.resources.Server__Small_button,ShowCreditCardLogos:h.resources.Server__Show_credit_card_logos,PaypalAccountColon:h.resources.Server__Paypal_account_colon,PaymentTypeColon:h.resources.Server__Payment_type_colon,OrganizationColon:h.resources.Server__Organization_colon,ItemColon:h.resources.Server__Item_colon,Change:h.resources.Change,GiftCertificateColon:h.resources.Server__Gift_certificate_colon,PreviewSlashEdit:h.resources.Server__Preview_slash_edit,Server__Visitors_can_add_multiple_items_to_a_shopping_cart:h.resources.Server__Visitors_can_add_multiple_items_to_a_shopping_cart};var t=this;return t.buttonTypeEnum=S,t.buttonType=e.PayPalButtonType,t.currency=e.PayPalCurrency,t.emailAddress=e.effectiveEmailAddress,t.buttonTypeEnum=S,t.amountTypeEnum=V,t.displayMode=e.PayPalButtonDisplayMode,t.getButtonName=function(){var e;switch(t.buttonType()){case S.Donate:e=h.resources.Donate;break;case S.GiftCertificate:e=h.resources.Client__Gift_Certificate;break;case S.Subscribe:e=h.resources.Subscription;break;case S.ShoppingCart:e=h.resources.Client__Add_to_Shopping_Cart;break;default:e=h.resources.Buy_now}return e},t.getItemName=n.computed(function(){return i.parseJSON(e.PayPalButtonConfigData()).itemName}),t.getPrice=n.computed(function(){return i.parseJSON(e.PayPalButtonConfigData()).price}),t.getOrganization=n.computed(function(){return i.parseJSON(e.PayPalButtonConfigData()).organization}),t.getFixedContributionAmount=n.computed(function(){return i.parseJSON(e.PayPalButtonConfigData()).fixedContributionAmount}),t.getBillingCyclePrice=n.computed(function(){var t=i.parseJSON(e.PayPalButtonConfigData()).billingCycleData;return t&&t.price?t.price:""}),t.buttonType.subscribe(function(n){n==S.ShoppingCart&&e.PayPalButtonDisplayMode()==C.LargeWithPaymentOpitions&&t.showPaymentOptions(!1)}),t.showSmallButton=n.observable(e.PayPalButtonDisplayMode()==C.Small),t.showSmallButton.subscribe(function(n){n?(t.showPaymentOptions(!1),e.PayPalButtonDisplayMode(C.Small)):e.PayPalButtonDisplayMode(t.showPaymentOptions()?C.LargeWithPaymentOpitions:C.Large)}),t.showPaymentOptions=n.observable(e.PayPalButtonDisplayMode()==C.LargeWithPaymentOpitions),t.showPaymentOptions.subscribe(function(n){e.PayPalButtonDisplayMode(n?C.LargeWithPaymentOpitions:C.Large),n&&t.showSmallButton(!1)}),t.setDisplayMode=function(){t.displayMode()==C.Small?(t.showSmallButton(!0),t.showPaymentOptions(!1)):(t.showPaymentOptions(t.displayMode()==C.LargeWithPaymentOpitions),t.showSmallButton(!1))},t.changeEmail=function(){e.showWizard("account")},t.changeButtonType=function(){e.showWizard("button")},t.changeItem=function(){e.showWizard("step2")},t.previewGiftCert=function(){e.showWizard("gift_design")},t}var w,S={BuyNow:"BuyNow",Donate:"Donate",GiftCertificate:"Gift",Subscribe:"Subscribe",ShoppingCart:"Cart"},k=l.undoer,x=["USD","AUD","BRL","GBP","CAD","CZK","DKK","EUR","HKD","HUF","ILS","JPY","MXN","TWD","NZD","NOK","PHP","PLN","SGD","SEK","CHF","THB"],C={Small:"SM",Large:"LG",LargeWithPaymentOpitions:"LGP"},T="[EMAIL_ADDRESS]",E=function(e){var t=/^\d+(?:\.{0,1}\d{0,2})$/;return t.test(e)},P=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},D=function(e){return parseFloat(e).toFixed(2)},I=h.resources.Client__Designer__Enter_a_valid_PayPal_email_address,A=h.resources.Client__Designer__Enter_price,M=h.resources.Client__Designer__Enter_organization_name,O=h.resources.Client__Designer__Enter_item_name,L=h.resources.Client__Designer__Enter_item_label,N=h.resources.Client__Designer__Enter_a_valid_redeem_url,B=h.resources.Client__Designer__Enter_price,F={Color:"color",Template:"template"},R=[{name:h.resources.Client__Blue,value:"BLU"},{name:h.resources.Client__Orange,value:"ORG"},{name:h.resources.Client__Green,value:"GRN"},{name:h.resources.Client__Purple,value:"PPL"}],H=[{name:h.resources.Client__Birthday,value:"BD"},{name:h.resources.Client__Winter,value:"WT"},{name:h.resources.Client__Wedding_Anniversary,value:"WA"},{name:h.resources.Client__Graduation,value:"GT"},{name:h.resources.Client__New_Baby_Blue,value:"BB"},{name:h.resources.Client__New_Baby_Pink,value:"BP"},{name:h.resources.Client__New_Baby_Yellow,value:"BY"}],V={Fixed:"1",NotFixed:"0"},z=[5,10,25,40,50,75,100,150,200,300,500,750,1e3],j=function(e){var t={},i=e.buttonConfigData;switch(e.buttonType()){case S.BuyNow:case S.ShoppingCart:t={itemName:i.itemName(),itemID:i.itemID(),price:i.price(),taxRate:i.taxRate(),shipping:i.shipping()};break;case S.Donate:t={organization:i.organization(),trackingID:i.trackingID(),fixedContributionAmount:i.fixedContributionAmount()};break;case S.GiftCertificate:t={logoImageName:i.logoImageName(),giftSpecificAmount:i.giftSpecificAmount(),giftCustomizedPriceList:i.giftCustomizedPriceList()},e.giftCertDesignType()==F.Color?t.backgroundColor=i.backgroundColor():t.template=i.template();break;case S.Subscribe:t={itemName:i.itemName(),subscriptionID:i.subscriptionID(),showUnsubscribe:i.showUnsubscribe(),billingCycleData:{price:i.billingCycleData.price().toString(),times:i.billingCycleData.times().toString(),period:i.billingCycleData.period(),expire:"Never"==i.billingCycleData.expire()?"":i.billingCycleData.expire()},hasTrialPeriod:i.hasTrialPeriod()},t.trialPeriodBillingData=t.hasTrialPeriod?{price:i.trialPeriodBillingData.price().toString(),times:i.trialPeriodBillingData.times().toString(),period:i.trialPeriodBillingData.period()}:{price:"",times:"1",period:"M"}}return n.toJSON(t)},U=function(e){for(var t=i.parseJSON(e.PayPalButtonConfigData()),a=["itemName","itemID","price","shipping","taxRate","organization","trackingID","fixedContributionAmount","backgroundColor","template","giftSpecificAmount","giftCustomizedPriceList","billingCycleData","trialPeriodBillingData","subscriptionID","hasTrialPeriod","showUnsubscribe","logoImageName"],r={},o=0;o<a.length;o++){var s=a[o];if("hasTrialPeriod"==s||"showUnsubscribe"==s)r[s]=n.observable(t.hasOwnProperty(s)&&Boolean(t[s]));else if("giftCustomizedPriceList"==s){r[s]=n.observableArray([]);var l;t.hasOwnProperty(s)&&i.isArray(t[s])&&t[s].length>0?l=t[s]:(l=[],i.each(z,function(t,n){l.push({label:D(n)+" "+e.PayPalCurrency(),price:D(n)})})),i.each(l,function(t,i){var a={label:n.observable(i.label),price:n.observable(i.price),readOnly:n.observable(!0),showErrorLabel:n.observable(!1),showErrorPrice:n.observable(!1)};a.label=a.label.extend({validation:{custom:[{message:L,test:function(e){return e&&e.length}}]}}),a.label.subscribe(function(){a.showErrorLabel(!0)}),a.price=a.price.extend({validation:{custom:[{message:A,test:function(t){return e.PayPalButtonType()!=S.GiftCertificate?!0:E(t)}}]}}),a.price.subscribe(function(){a.showErrorPrice(!0)}),r[s].push(a)})}else"billingCycleData"==s||"trialPeriodBillingData"==s?t.hasOwnProperty(s)?(r[s]={price:n.observable(t[s].price),times:n.observable(t[s].times),period:n.observable(t[s].period)},"billingCycleData"==s&&(r[s].expire=n.observable(t[s].expire))):(r[s]={price:n.observable(""),times:n.observable("1"),period:n.observable("M")},"billingCycleData"==s&&(r[s].expire=n.observable("Never"))):r[s]=n.observable(t.hasOwnProperty(s)&&Boolean(t[s])?t[s]:"")}return r},W=function(e){e.buttonConfigData.itemName=e.buttonConfigData.itemName.extend({validation:{custom:[{message:O,test:function(e){return e&&e.length}}]}}),e.buttonConfigData.itemName.subscribe(function(){e.showErrorBuynowItemName(!0),e.showErrorSubscribeItemName(!0)}),e.buttonConfigData.organization=e.buttonConfigData.organization.extend({validation:{custom:[{message:M,test:function(e){return e&&e.length}}]}}),e.buttonConfigData.organization.subscribe(function(){e.showErrorDonateOrgnization(!0)}),e.buttonConfigData.price=e.buttonConfigData.price.extend({validation:{custom:[{message:A,test:function(e){return E(e)}}]}}),e.buttonConfigData.price.subscribe(function(){e.showErrorBuynowPrice(!0)}),e.buttonConfigData.shipping=e.buttonConfigData.shipping.extend({validation:{custom:[{message:B,test:function(e){return e?E(e):!0}}]}}),e.buttonConfigData.shipping.subscribe(function(){e.showErrorShipping(!0)}),e.buttonConfigData.fixedContributionAmount=e.buttonConfigData.fixedContributionAmount.extend({validation:{custom:[{message:A,test:function(t){return e.donateAmountType()==V.NotFixed?!0:E(t)}}]}}),e.buttonConfigData.fixedContributionAmount.subscribe(function(){e.showErrorDonateFixedAmount(!0)}),e.redeemUrl=e.redeemUrl.extend({validation:{custom:[{message:N,test:function(e){var t=/^page\:(\d*)$/,n=/^(http[s]?:\/\/){0,1}(www\.){0,1}[a-zA-Z0-9\.\-]+\.[a-zA-Z]{2,5}[\.]{0,1}/;return t.test(e)||n.test(e)}}]}}),e.redeemUrl.subscribe(function(){e.showErrorRedeemUrl(!0)}),e.buttonConfigData.giftSpecificAmount=e.buttonConfigData.giftSpecificAmount.extend({validation:{custom:[{message:A,test:function(t){return e.giftAmountType()==V.NotFixed?!0:E(t)}}]}}),e.buttonConfigData.giftSpecificAmount.subscribe(function(){e.showErrorGiftFixedAmount(!0)}),e.buttonConfigData.billingCycleData.price=e.buttonConfigData.billingCycleData.price.extend({validation:{custom:[{message:A,test:function(e){return E(e)}}]}}),e.buttonConfigData.billingCycleData.price.subscribe(function(){e.showErrorSubscribePrice(!0)}),e.buttonConfigData.trialPeriodBillingData.price=e.buttonConfigData.trialPeriodBillingData.price.extend({validation:{custom:[{message:A,test:function(t){return e.buttonConfigData.hasTrialPeriod()?E(t):!0}}]}}),e.buttonConfigData.trialPeriodBillingData.price.subscribe(function(){e.showErrorSubscribeTrialPrice(!0)})},q="paypal";return{name:q,initModel:function(e,t){e.PayPalButtonType=e.PayPalButtonType||S.BuyNow,e.PayPalEmailAddress=e.PayPalEmailAddress||T,e.PayPalCurrency=e.PayPalCurrency||"USD",e.PayPalButtonDisplayMode=e.PayPalButtonDisplayMode||C.LargeWithPaymentOpitions,e.PayPalGiftCertLogoDocumentId=a.coerceNumericValue(e,e.PayPalGiftCertLogoDocumentId,n.unwrap(e.PayPalGiftCertLogoDocumentId),{defaultValue:0}),e.PayPalGiftCertRedeemUrl=e.PayPalGiftCertRedeemUrl||"",e.PayPalButtonConfigData=e.PayPalButtonConfigData||"{}",t&&(e.Width="10px",e.Height="10px")},createElementViewModel:function(e,t,n){return f.prototype=Object.create(e.prototype),new f(e,t,n)},load:function(n,i){w=l.getDataModel().napsoc,n.append(e).append(t),i(null,q)}}}),define("text!designer/app/builder/ui/canvas/elements/image/el.image.html",[],function(){return'<script type="text/html" id="wsb-canvas-template-image">\r\n    <div data-widget-content="true" data-bind="attr: { \'class\': CssClasses, style: ImgOuterStyle }, visible: visible">\r\n        <div data-bind="attr: { style: ImgInnerStyle }">\r\n          <img data-bind="\r\n                attr: { id: ID() + \'-img\', src: imageUrl, width: localized.ImageWidth, height: localized.ImageHeight, alt: ImageAlt, style: imgStyle },\r\n\r\n                imageEditor: {\r\n                    editable: isEditing,\r\n                    isCropWindowMovable: isMovable,\r\n                    cropTop: cropTop,\r\n                    cropLeft: cropLeft,\r\n                    cropWidth: pixelWidth,\r\n                    cropHeight: pixelHeight,\r\n                    afterShow: showCropWindow,\r\n                    afterHide: hideCropWindow,\r\n                    finishedCropping: cropped\r\n                }" />\r\n        </div>\r\n    </div>\r\n</script>\r\n'}),define("text!designer/app/builder/ui/canvas/elements/image/mutator.image.html",[],function(){return'<script type="text/html" id="mutator-template-element-image">\r\n    <!-- ko if: elementViewModel.Type() === \'image\' -->\r\n    <!-- ko with: mutatorViewModel -->\r\n\r\n    <div class="wsb-canvas-mutator-inner">\r\n        <div class="wsb-canvas-mutator-ctrl-outer wsb-canvas-mutator-textbox clearfix">\r\n            <div>\r\n                <a href="#" data-bind="click: showImageChooser" class="btn btn-inverse-grey"><i class="icon-wsb-white icon-img"></i><span data-bind= "text: i18Dict.SwapImage"></span></a>&nbsp;\r\n                <a href="#" data-bind="click: showImageEditor" class="btn btn-inverse-grey"><i class="icon-wsb-white icon-advedit"></i><span data-bind= "text: i18Dict.ImageEditor"></span></a>&nbsp;\r\n            </div>\r\n            <div style="padding-top:10px;" data-bind="visible: revertIsVisible"><a href="#" data-bind="click: revertToOriginal, text: i18Dict.RevertToOriginalImage"></a></div>\r\n        </div>\r\n    \r\n        <!-- ko ifnot: isLocalizedThemeMode -->\r\n        <div data-bind="mutatorElement: { \r\n                    name: \'urlpicker\', \r\n                    data: linkUrl, \r\n                    context: { title:i18Dict.LinkColon, newWindow: linkToNewWindow } \r\n                }"></div>\r\n\r\n      \r\n      <div class="wsb-canvas-mutator-ctrl-outer clearfix">\r\n\r\n        <div class="wsb-canvas-mutator-ctrl-label wsb-btn-label" data-bind="html: i18Dict.DescriptionAltColon">\r\n        </div>\r\n       \r\n        <div class="wsb-canvas-mutator-ctrl-input wsb-btn-label-property clearfix">\r\n          <input type="text" class="wsb-button-input-label wsb-redo-select" data-bind="value: ImageAlt" style="overflow : inherit"/>\r\n        </div>\r\n      </div>\r\n\r\n        <div class="wsb-image-effect-carousel" data-bind="mutatorElement: { \r\n                    name: \'carousel-with-none\', \r\n                    data: cssClass, \r\n                    context: { \r\n                        title:i18Dict.EffectColon, \r\n                        optionTemplate: \'mutator-template-carousel-style\', \r\n                        optionValueProperty: \'cssClass\',\r\n                        options: cssClasses,\r\n                        noneTemplate: \'mutator-template-carousel-none-template\',\r\n                        noneValue: \'customStyle\' \r\n                    }\r\n                }"></div>\r\n        <!-- /ko -->\r\n    </div>\r\n    <!-- /ko -->\r\n    <!-- /ko -->\r\n</script>'}),define("designer/util/imageHelper",[],function(){function e(e,t){var n=new Image;n.onload=function(){t(n.width,n.height)},n.src=e}return{detectImageSize:e}}),define("libs/advimgeditor/advimgeditor_v2",["jquery","knockout","common/stats/googleanalytics","common/logger/logger","common/alertbox/alertbox","appconfig","/i18n/resources/client","wsbcore/helper","wsbcore/growl"],function(e,t,n,i,a,r,o,s){var l,d,c,u,p,g,h=!1,m=!1;return s.require(["js!//dme0ih8comzn4.cloudfront.net/js/feather.js"],function(){h=!0},function(){h=!0,m=!0}),d=function(){},c=function(){},u=function(t){if(!h)return void setTimeout(function(){u(t)},1e3);if(m)return void e("<div></div>").sfGrowl({title:o.resources.Client__Designer__Yikes_hit_a_snag,content:o.resources.Server__There_has_been_an_unexpected_error,icon:"error"});var i=function(e){return e.length>2&&"//"===e.substring(0,2)&&(e="http:"+e),e.replace(/^https:/,"http:")},s=i(t.url),d=function(e,i){return n.trackEvent("aviary_editor","save_aviary_editor","button"),t.onSave&&t.onSave(i),l.close(),!1},c=function(){l.launch({image:t.id,url:s})},p=function(e){t.onClose&&t.onClose(e),n.trackEvent("aviary_editor",e?"close_unsaved_aviary_editor":"close_saved_aviary_editor")};l?l.launch({image:t.id,url:s,onSave:d,onLoad:c,onClose:p}):l=new window.Aviary.Feather({apiKey:"la7i8n1vjiine1w8",apiVersion:3,language:r.aviaryLanguage,tools:["enhance","effects","frames","stickers","focus","warmth","brightness","contrast","saturation","sharpness","colorsplash","draw","text","redeye","whiten","blemish"],appendTo:"",theme:"light",onError:function(){n.trackEvent("aviary_editor","error"),a.show({message:'<div style="padding: 15px;">'+o.resources.There_was_a_problem_image+"</div>"})},onSave:d,onLoad:c,onClose:p})},p=function(){l&&g()},g=function(){l&&(l.close(),l=null)},{init:d,create:c,show:u,hide:p,destroy:g}}),define("libs/imgeditor/imgeditor_v2",["jquery","knockout","designer/util/imageHelper","common/stats/googleanalytics","libs/advimgeditor/advimgeditor_v2","/i18n/resources/client"],function(e,t,n,i,a,r){function o(r,o,c,u,p,h,m,b,f,v){function S(e){return i.trackEvent("aviary_editor","upgrade","icon"),f("aviary",function(t){x.upgradeCallback(t,e)}),!1}function k(){function t(e){a.show({id:r[0].id,url:e,onSave:function(e){d.imagePath(e),g(e)},onClose:function(){x.advancedEditorOpen(!1),y.$editor&&y.$editor.show()}})}x.advancedEditorOpen(!0),y.$editor&&y.$editor.hide();var n=r.attr("src");x.advancedEditUrl()||x.isUnsetImage()?t(n):/^\/document\/(?:(?:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})|(?:\d+))/i.test(n)?e.ajax({url:n,type:"post",data:{format:"json"},dataType:"json",success:function(e){var n="//"===e.url.substr(0,2)?"http:"+e.url:e.url;t(n)}}):t(n)}var x=this,C=null,T=null;x.isUnsetImage=p,x.advancedEditUrl=h,x.excludeFromEdit=m,x.advancedEditorDisplayFlags=b,x.advancedEditorButtonVisible=t.computed(function(){var e=x.excludeFromEdit(),t=x.advancedEditorDisplayFlags(),n=t.IsEnabled();return e!==!0&&n===!0}),x.isCropWindowMovable=c,x.startResize=function(t,n){if(!c)return!1;var a=e(n.currentTarget).attr("class").split("-"),r=a[a.length-1];return C={left:x.cropLeft(),top:x.cropTop()},T={width:x.cropWidth(),height:x.cropHeight()},l(n,function(e){var t;if(r.indexOf("e")>-1){var n=s(T.width+e.left,0,x.imageWidth()-x.cropLeft());x.cropWidth(n)}else if(r.indexOf("w")>-1){var i=s(C.left+e.left,0,x.cropLeft()+x.cropWidth());t=i-x.cropLeft(),x.cropLeft(i),x.cropWidth(x.cropWidth()-t)}if(r.indexOf("s")>-1){var a=s(T.height+e.top,0,x.imageHeight()-x.cropTop());x.cropHeight(a)}else if(r.indexOf("n")>-1){var o=s(C.top+e.top,0,x.cropTop()+x.cropHeight());t=o-x.cropTop(),x.cropTop(o),x.cropHeight(x.cropHeight()-t)}},function(){i.trackEvent("image_editor","resize","icon"),x.state(null)}),x.state(r),!1},x.startMove=function(e,t){var n={left:x.imageLeft(),top:x.imageTop()},a={left:x.cropLeft(),top:x.cropTop()},r={width:x.cropWidth(),height:x.cropHeight()};return l(t,function(e){var t=x.imageWidth()-r.width,i=x.imageHeight()-r.height;e.left=s(e.left,a.left-t,a.left),e.top=s(e.top,a.top-i,a.top),x.imageTop(n.top+e.top),x.imageLeft(n.left+e.left),x.cropTop(a.top-e.top),x.cropLeft(a.left-e.left)},function(){i.trackEvent("image_editor","move","image"),x.state(null)}),x.state("move"),!1};var E=r.offset();x.advancedEditorOpen=t.observable(!1),x.imagePath=t.observable(r.attr("src")),x.imageLeft=t.observable(E.left),x.imageTop=t.observable(E.top),x.imageWidth=t.observable(r.width()),x.imageHeight=t.observable(r.height()),x.cropLeft=t.observable(o.left),x.cropTop=t.observable(o.top),x.cropWidth=t.observable(o.width),x.cropHeight=t.observable(o.height),x.marginLeft=t.computed(function(){return Math.max(0,x.cropLeft())+"px"}),x.marginRight=t.computed(function(){return Math.max(0,x.imageWidth()-x.cropWidth()-x.cropLeft())+"px"}),x.marginTop=t.computed(function(){return Math.max(0,x.cropTop())+"px"}),x.marginBottom=t.computed(function(){return Math.max(0,x.imageHeight()-x.cropHeight()-x.cropTop())+"px"}),x.origImageWidth=t.observable(),x.origImageHeight=t.observable(),x.origImageArea=t.computed(function(){return x.origImageWidth()*x.origImageHeight()}),x.origImageRatio=t.computed(function(){return x.origImageWidth()/x.origImageHeight()}),x.minZoom=t.observable(.1),x.maxZoom=t.observable(10),x.zoom=t.computed({read:function(){return x.imageWidth()*x.imageHeight()/x.origImageArea()},write:function(e){var t=x.origImageRatio(),n={height:Math.sqrt(e*x.origImageArea()/t)};n.width=n.height*t;var i={width:n.width-x.imageWidth(),height:n.height-x.imageHeight()},a={width:i.width/2,height:i.height/2};x.imageLeft(x.imageLeft()-a.width),x.imageTop(x.imageTop()-a.height),x.cropLeft(x.cropLeft()+a.width),x.cropTop(x.cropTop()+a.height),x.imageWidth(n.width),x.imageHeight(n.height)}}),n.detectImageSize(r.attr("src"),function(e,t){x.origImageWidth(e),x.origImageHeight(t);var n;n=e>=t?Math.pow(5e3/e,2):Math.pow(5e3/t,2),n=Math.min(n,x.maxZoom());var i=x.zoom();x.minZoom(Math.min(x.minZoom(),i)),x.maxZoom(Math.max(n,i))}),x.state=t.observable(null);var P=20;x.toolbarTop=t.computed(function(){var e=x.imageTop()+x.cropTop(),t=_.height(),n=e+x.cropHeight()+P,i=w.height();if(t>n+i)return n+"px";var a=e-(i+P);return a>0?a+"px":t-i+"px"}),x.toolbarLeft=t.computed(function(){var e=w.width()/2;return Math.min(_.width()-e,Math.max(e,x.imageLeft()+x.cropLeft()+x.cropWidth()/2))+"px"}),x.buttons=u||[],x.resetZoom=function(){return i.trackEvent("image_editor","reset_to100","icon"),x.zoom(1),!1},x.upgradeCallback=function(e,t){var n=x.advancedEditorDisplayFlags(),i=n.IsEnabled(),a=n.RequiresUpgrade();i===!0&&a!==!0&&"function"==typeof t&&t()},x.showAdvancedEditor=function(){var e=x.advancedEditorDisplayFlags(),t=e.IsEnabled(),n=e.RequiresUpgrade();return i.trackEvent("image_editor","open_aviaryeditor","icon"),t===!0?n===!0?void S(k):void k():void 0},x.resetZoom=function(){return i.trackEvent("image_editor","reset_to100","icon"),x.zoom(1),!1},x.trimWhitespace=function(){var e={left:x.cropLeft(),top:x.cropTop(),width:x.cropWidth(),height:x.cropHeight()},t={width:x.imageWidth(),height:x.imageHeight()};e.left<0&&(e.width+=e.left,e.left=0),e.top<0&&(e.height+=e.top,e.top=0),e.left+e.width>t.width&&(e.width=t.width-e.left),e.top+e.height>t.height&&(e.height=t.height-e.top),x.cropLeft(e.left),x.cropTop(e.top),x.cropWidth(e.width),x.cropHeight(e.height)},x.keydown=function(e,t){switch(t.which){case 27:return x.cancel(),!1}return!0},x.save=function(){return i.trackEvent("image_editor","ok","button"),v.hide(!0),!1},x.cancel=function(){return i.trackEvent("image_editor","cancel","link"),v.hide(!1),!1},x.output=function(){return{imageOffsetLeft:x.imageLeft()-E.left,imageOffsetTop:x.imageTop()-E.top,imageWidth:x.imageWidth(),imageHeight:x.imageHeight(),cropLeft:x.cropLeft(),cropTop:x.cropTop(),cropWidth:x.cropWidth(),cropHeight:x.cropHeight()}}}function s(e,t,n){return t>n?s(e,n,t):Math.max(t,Math.min(n,e))}function l(t,n,i){var a={left:t.pageX,top:t.pageY},r=e(document);r.bind("mousemove.imgeditor",function(e){var t={left:e.pageX-a.left,top:e.pageY-a.top};return n(t),!1}).bind("mouseup.imgeditor",function(e){return i(e),r.unbind("mousemove.imgeditor mouseup.imgeditor"),!1})}var d,c,u,p,g,h,m,b,f,v,y={},_={width:t.observable(window.innerWidth),height:t.observable(window.innerHeight)},w={width:t.observable(0),height:t.observable(0)};return p=function(){_.width(window.innerWidth),_.height(window.innerHeight)},h=function(t){return y.$container=t||e("body"),y.$window=e(window),y.$document=e(window.document),this},m=function(n){if(!y.$editor){d=new o(n.image,n.cropRegion,n.isCropWindowMovable!==!1,n.buttons,n.isUnsetImage,n.advancedEditUrl,n.excludeFromEdit,n.advancedEditorDisplayFlags,n.showUpgradeDialog,this),d.i18Dict=r.resources,y.$editor=e("<div data-bind=\"template: 'wsb-image-editor'\"/>").appendTo("body").focus(),t.applyBindings(d,y.$editor[0]),y.$window.bind("resize.imgeditor",p),y.$document.bind("keydown.imgeditor",function(e){d.keydown(d,e)});var i=e(".wsb-image-editor-controls");w.width(i.outerWidth()),w.height(i.outerHeight()),u=n.afterHide,c=n.onSave,g=n.onAdvancedEdit,n.afterShow&&n.afterShow()}},v=function(){d&&d.showAdvancedEditor()},b=function(e){y.$editor&&(d.advancedEditorOpen()||(y.$editor.hide(),f(),e&&(d.trimWhitespace(),c(d.output())),u&&u()))},f=function(){y.$editor&&(y.$editor.remove(),y.$editor=null,y.$window.unbind("resize.imgeditor",p),y.$document.unbind("keydown.imgeditor"))},{init:h,show:m,showAdvancedEditor:v,hide:b,destroy:f}}),define("designer/app/builder/ui/canvas/elements/image/el.image",["text!designer/app/builder/ui/canvas/elements/image/el.image.html","text!designer/app/builder/ui/canvas/elements/image/mutator.image.html","jquery","knockout","designer/app/event","designer/app/builder/ui/canvas/elements/helper","libs/imgeditor/imgeditor_v2","designer/app/builder/ui/controls/media/chooser/media.chooser","appconfig","designer/app/builder/data/data","common/stats/googleanalytics","designer/util/imageHelper","common/util/documentHelper","common/abTesting/abTesting","/i18n/resources/client","designer/customStyle/styleContainer","libs/knockout/ko.observables"],function(e,t,n,i,a,r,o,s,l,d,c,u,p,g,h,m){function b(e){if(e.width>5e3||e.height>5e3){var t;t=e.width>=e.height?5e3/e.width:5e3/e.height;var n={width:e.width*t,height:e.height*t};return n}return e.width<=0&&(e.width=1),e.height<=0&&(e.height=1),e}function f(e,t){function n(t,n){return n=n||{},r.coerceNumericValue(e,e[t],i.unwrap(e[t]),n)}if(e.ImageOffsetTop=n("ImageOffsetTop",{defaultValue:0}),e.ImageOffsetLeft=n("ImageOffsetLeft",{defaultValue:0}),e.ImageWidth=n("ImageWidth",{min:1}),e.ImageHeight=n("ImageHeight",{min:1}),e.OriginalImageWidth=n("OriginalImageWidth",{min:1}),e.OriginalImageHeight=n("OriginalImageHeight",{min:1}),e.LinkPageId=n("LinkPageId"),e.LinkUrl=e.LinkUrl||null,e.ProcessedImageDocumentId=e.ProcessedImageDocumentId||0,e.LinkToNewWindow=e.LinkToNewWindow||!1,e.DocumentId=e.DocumentId||0,e.ImageExcludedFromEdit=e.ImageExcludedFromEdit||!1,e.AdvancedEditUrl=e.AdvancedEditUrl||null,e.OriginalDocumentId=e.OriginalDocumentId||0,e.ImageAlt=e.ImageAlt||null,t){var a={width:parseFloat(e.Width),height:parseFloat(e.Height)};C&&(a.width/a.height>C.ratio?a.height=Math.round(a.width/C.ratio):a.width=Math.round(a.height*C.ratio)),a=b(a),e.ImageWidth=a.width,e.ImageHeight=a.height,e.CssClass="img",e.Width=a.width+"px",e.Height=a.height+"px"}}function v(){i.bindingHandlers.imageEditor={init:function(e){n(e).unbind("dragstart").bind("dragstart",function(e){return e.preventDefault(),!1})},update:function(e,t,a,r,s){var l=t(),d=i.utils.unwrapObservable(l.editable);if(d&&!s.imageEditorCreated){s.imageEditorCreated=!0;var c=n(e);E.collect("imgedit"),o.show({image:c,cropRegion:{left:i.utils.unwrapObservable(l.cropLeft),top:i.utils.unwrapObservable(l.cropTop),width:i.utils.unwrapObservable(l.cropWidth),height:i.utils.unwrapObservable(l.cropHeight)},isCropWindowMovable:i.utils.unwrapObservable(l.isCropWindowMovable)!==!1,buttons:i.utils.unwrapObservable(l.buttons),afterShow:l.afterShow,afterHide:l.afterHide,onSave:function(e){l.finishedCropping(e.imageOffsetLeft,e.imageOffsetTop,e.imageWidth,e.imageHeight,e.cropLeft,e.cropTop,e.cropWidth,e.cropHeight),E.enable("imgedit")},isUnsetImage:r.isUnsetImage,advancedEditorDisplayFlags:r.advancedEditorDisplayFlags,excludeFromEdit:r.localized.ImageExcludedFromEdit,onAdvancedEdit:function(e){r.localized.AdvancedEditUrl(e)},advancedEditUrl:r.localized.AdvancedEditUrl,ImageAlt:r.ImageAlt,showUpgradeDialog:r.showUpgradeDialog})}else o.hide(),s.imageEditorCreated=!1}}}function y(e,t,a){var r=a(),o=i.utils.unwrapObservable(a()),s=n(t),l=s.html();o!==l&&r(l)}function _(){u.detectImageSize(k,function(e,t){C={width:e,height:t,ratio:e/t}})}function w(e){this.i18Dict={LinkColon:h.resources.Server__Link_colon,EffectColon:h.resources.Server__Effect_colon,SwapImage:h.resources.Replace_Image,ImageEditor:h.resources.Server__Image_editor,DescriptionAltColon:h.resources.Server__Description_Alt.replace("{0}","</br>"),RevertToOriginalImage:h.resources.Server__Revert_to_original_image};
var t=this;t.areAdvancedPropertiesSupported=i.computed(function(){return!e.isLocalizedThemeMode()});var a={linkUrl:e.LinkUrl.trimmed(),ImageAlt:e.ImageAlt,linkToNewWindow:e.LinkToNewWindow,cssClass:e.CssClass,originalDocumentId:e.localized.OriginalDocumentId,isUnsetImage:e.isUnsetImage,showImageChooser:e.showPhotoChooser,advEditorAbTestEnabled:e.advEditorAbTestEnabled,advancedEditorDisplayFlags:e.advancedEditorDisplayFlags,excludeFromEdit:e.localized.ImageExcludedFromEdit,showImageEditor:e.showImageEditor,revertToOriginal:e.revertToOriginal,revertIsVisible:e.revertIsVisible,isLocalizedThemeMode:e.isLocalizedThemeMode,backgroundColorEnabled:t.areAdvancedPropertiesSupported,borderEnabled:t.areAdvancedPropertiesSupported,roundedCornerEnabled:t.areAdvancedPropertiesSupported,transparencyEnabled:t.areAdvancedPropertiesSupported,paddingEnabled:t.areAdvancedPropertiesSupported,sizeEnabled:t.areAdvancedPropertiesSupported};t.width=i.computed({read:function(){return e.Width()},write:function(t){var n=parseFloat(t)-parseFloat(e.refSize.width);if(0!=n){var i={x:n,y:0},a=e.state();e.state("resizeRight"),e.startResize(),e.resize(i),e.state(a),e.refSize.width=parseFloat(t),e.pixelWidth(e.refSize.width)}}}),t.height=i.computed({read:function(){return e.Height()},write:function(t){var n=parseFloat(t)-parseFloat(e.refSize.height);if(0!=n){var i={x:0,y:n},a=e.state();e.state("resizeBottom"),e.startResize(),e.resize(i),e.state(a),e.refSize.height=parseFloat(t),e.pixelHeight(e.refSize.height)}}}),n.extend(t,a)}function S(e,t){e.call(this,t);var n=this;n.Title=h.resources.Image,n.SettingsTitle=h.resources.Image_Settings,n.Styling.Shadow(!1);var a=i.observable("enabled"===g.getOption("advancedImageEditor","disabled"));n.AdvancedEditorDisplayFlags=n.getFeatureFlags("image.aviary",a),n.isEditing=i.observable(!1),n.menulist=[],n.isActionMenuDisabled=function(){return!1};var r,d={text:h.resources.Replace_Image,tip:h.resources.Replace_Image,cssClass:"wsb-tool-Change",click:function(){return c.trackEvent("image_general_settings","replace_image","button"),n.showPhotoChooser(),!1}},f={text:h.resources.Crop_Image||"Crop Image",tip:h.resources.Crop_Image||"Crop Image",cssClass:"wsb-tool-resizeImg",click:function(){return c.trackEvent("image_general_settings","crop_image","button"),n.hideActionMenu(),n.showImageEditor(),!1}};I||(r={text:h.resources.Server__Image_editor,tip:h.resources.Server__Image_editor,cssClass:"wsb-tool-EditImg",click:function(){return c.trackEvent("image_general_settings","click_on_image_editor","button"),n.hideActionMenu(),n.showImageEditor(),o.showAdvancedEditor(),!1}}),n.getActionMenuItems=i.computed(function(){var e=n.getCommands(),t=n.isLocalizedThemeMode()?[e.editProperties,d]:[d,f,e.clone,e.editProperties,e["delete"],e.layoutCommands];return I||t.splice(2,0,r),t}),n.localized={},["AdvancedEditUrl","OriginalDocumentId","DocumentId","ImageExcludedFromEdit","OriginalImageWidth","OriginalImageHeight","ImageWidth","ImageHeight","ImageAlt","ImageOffsetLeft","ImageOffsetTop","ProcessedDocumentId"].forEach(function(e){n.localized[e]=n.getLocalizedProperty(e)}),n.isUnsetImage=i.computed(function(){return 0==n.localized.DocumentId()}),n.imageUrl=i.computed(function(){var e=n.localized.AdvancedEditUrl();return e?e:n.isUnsetImage()?k:p.getDocumentUrl(n.localized.DocumentId())}),n.cropLeft=i.computed(function(){return-n.localized.ImageOffsetLeft()}).extend({throttle:{type:"throttle",delay:T}}),n.cropTop=i.computed(function(){return-n.localized.ImageOffsetTop()}).extend({throttle:{type:"throttle",delay:T}}),n.ImgOuterStyle=i.computed(function(){var e="position:relative;"+n.Style();return e}).extend({throttle:{type:"throttle",delay:T}}),n.imgStyle=i.computed(function(){var e=new m;return e.set("position","absolute"),e.set("top",n.localized.ImageOffsetTop()+"px"),e.set("left",n.localized.ImageOffsetLeft()+"px"),e.set("width",n.localized.ImageWidth()+"px"),e.set("height",n.localized.ImageHeight()+"px"),e.stringify()}).extend({throttle:{type:"throttle",delay:T}}),n.ImgInnerStyle=i.computed(function(){var e=new m,t=n.RoundedCornerSize?n.RoundedCornerSize():0;return e.set("overflow","hidden"),e.set("position","relative"),e.set("width",n.Width()),e.set("height",n.Height()),e.set("border-radius",t>0?t+"px":"0"),e.stringify()}).extend({throttle:{type:"throttle",delay:T}}),n.advancedEditorDisplayFlags=i.computed(function(){return n.isLocalizedThemeMode()||I?{IsEnabled:function(){return!1}}:n.AdvancedEditorDisplayFlags()}),n.revertIsVisible=i.computed(function(){var e=n.localized.OriginalDocumentId(),t=n.localized.ImageExcludedFromEdit(),i=n.advancedEditorDisplayFlags(),a=i.IsEnabled();return!(!e||0==e||t===!0||a!==!0)}),n.LinkToNewWindow.subscribe(function(e){var t="open_innewwindow_"+(e?"on":"off");c.trackEvent("image_settings",t,"checkbox")}),n.stylePrefix="img",n.showCropWindow=function(){n.hidden(!0)},n.showPhotoChooser=function(){var e=[];n.isUnsetImage()||e.push({id:n.localized.DocumentId().toString()}),c.trackEvent("image_general_settings","replace_image","button"),s.openImages(!1,e,function(e){e&&e.length&&n.setContent(e[0].id,p.getDocumentUrl(e[0].id),e[0].excludeFromEdit,!1)})},n.setContent=function(e,t,i,a){E.collect("Swap Image"),n.clearOutAdvanceEdit(),n.localized.DocumentId(e),n.localized.ImageExcludedFromEdit(i===!0),u.detectImageSize(t,function(e,t){var i,r={width:n.pixelWidth(),height:n.pixelHeight()},o=r.width/r.height,s=e/t;if(i=o>s?{width:r.width,height:Math.round(r.width/s)}:{width:Math.round(r.height*s),height:r.height},n.localized.OriginalImageWidth(e),n.localized.OriginalImageHeight(t),i=b(i),a){var d=l.canvasImageMaximumSize;i=d>=e&&d>=t?{width:e,height:t}:s>1?{width:d,height:Math.round(d/s)}:{width:Math.round(d*s),height:d},n.ImageWidth(i.width),n.ImageHeight(i.height),n.Width(i.width+"px"),n.Height(i.height+"px"),n.ImageOffsetLeft(0),n.ImageOffsetTop(0)}else n.localized.ImageWidth(i.width),n.localized.ImageHeight(i.height),n.localized.ImageOffsetLeft(0),n.localized.ImageOffsetTop(0);E.enable("Swap Image"),n.showImageEditor()})},n.cropped=function(e,t,i,a,r,o,s,l){var d={left:n.pixelLeft(),top:n.pixelTop(),width:n.pixelWidth(),height:n.pixelHeight(),offsetLeft:n.localized.ImageOffsetLeft(),offsetTop:n.localized.ImageOffsetTop()};n.pixelLeft(d.left+r+d.offsetLeft+e),n.pixelTop(d.top+o+d.offsetTop+t),n.pixelWidth(s),n.pixelHeight(l),n.localized.ImageOffsetLeft(Math.round(-r)),n.localized.ImageOffsetTop(Math.round(-o)),n.localized.ImageWidth(Math.round(i)),n.localized.ImageHeight(Math.round(a))},n.hideCropWindow=function(){n.state(n.stateMap.view),n.isEditing(!1),n.hidden(!1)},n.dblClick=function(){return c.trackEvent("wsb-designer-action-flyout","dblclick-image",x),P&&n.isUnsetImage()?n.showPhotoChooser():n.showImageEditor(),!1};var v,y;n.startResize=function(){v={left:-(n.ImageOffsetLeft()/n.ImageWidth()),top:-(n.ImageOffsetTop()/n.ImageHeight()),width:n.pixelWidth()/n.ImageWidth(),height:n.pixelHeight()/n.ImageHeight()},y={width:n.ImageWidth(),height:n.ImageHeight()}},n.resize=function(e){var t=n.state();if(n.refSize&&n.refPosition){var i=/Left/.test(t),a=!i&&/Right/.test(t),r=/Top/.test(t),o=!r&&/Bottom/.test(t),s=n.refSize.width/n.refSize.height,l=1;!o&&!r||i||a?(e.y=e.x/s,i&&(l=-1)):(e.x=s*e.y,r&&(l=-1));var d={width:e.x*l,height:e.y*l};if(d.width||d.height){var c={width:n.refSize.width+d.width,height:n.refSize.height+d.height};if(!(c.width<0||c.height<0)){var u=!1,p=u?c.width/n.refSize.width:c.height/n.refSize.height,g={width:y.width*p,height:y.height*p};g=b(g);var h=Math.round(-(v.left*g.width)),m=Math.round(-(v.top*g.height)),f={width:n.refSize.width*p-n.refSize.width,height:n.refSize.height*p-n.refSize.height},_={width:f.width-d.width,height:f.height-d.height};r&&n.pixelTop(n.refPosition.top-d.height),i&&n.pixelLeft(n.refPosition.left-d.width),u?m=Math.min(Math.round(m-_.height/2),0):h=Math.min(Math.round(h-_.width/2),0);var w=Math.abs(h)+c.width-Math.round(g.width),S=Math.abs(m)+c.height-Math.round(g.height);w>0&&(h=-(g.width-c.width)),S>0&&(m=-(g.height-c.height)),n.ImageWidth(Math.round(g.width)),n.ImageHeight(Math.round(g.height)),n.Width(c.width+"px"),n.Height(c.height+"px"),n.ImageOffsetTop(m),n.ImageOffsetLeft(h)}}}},n.showImageEditor=function(){return c.trackEvent("image_settings","open_image_editor","button"),n.hideProperties(!0),n.isEditing(!0),!1},n.clearOutAdvanceEdit=function(){n.localized.AdvancedEditUrl(null)},n.revertToOriginal=function(){c.trackEvent("wsb-designer-image-properties","revert-image","link");var e=n.localized.OriginalDocumentId();return e&&0!=e&&n.localized.DocumentId(e),n.clearOutAdvanceEdit(),n.localized.OriginalDocumentId(0),n.showImageEditor()},n.afterNewElementAdded=function(){n.showPhotoChooser()},n.mutatorViewModel=new w(n)}var k,x="image",C={width:0,height:0,ratio:1},T=17,E=d.undoer,P="enabled"===g.getOption("smartActions","disabled"),D=d.getDataModel(),I=D.user.isApiReseller&&D.info.Account.AccountType<20;return i.bindingHandlers.imageAlt={init:function(e,t,n,a,r){i.utils.registerEventHandler(e,"blur",function(i){y(i,e,t,n,a,r)}),i.utils.registerEventHandler(e,"keyup",function(i){y(i,e,t,n,a,r)})},update:function(e,t){var n=i.utils.unwrapObservable(t())||"";e.innerHTML!==n&&(e.innerHTML=n)}},{name:x,load:function(n,i){k=l.customerAmdPathRoot+"/images/beach.jpg",n.append(e).append(t),v(),o.init(n),_(),a.on(a.events.flyoutClose,function(){o.hide(!0)}),i(null,x)},initModel:f,createElementViewModel:function(e,t,n){return n&&C&&0==t.DocumentId()&&(t.OriginalImageWidth(C.width),t.OriginalImageHeight(C.height)),S.prototype=Object.create(e.prototype),new S(e,t)}}}),define("text!designer/app/builder/ui/canvas/elements/map/el.map.html",[],function(){return'<script type="text/html" id="wsb-canvas-template-map">\r\n  <div data-bind="attr: { style: NoSizeStyle, \'class\': CssClasses }">\r\n    <div data-widget-content="true" class="map" data-bind="attr: { style: SizeStyle }">\r\n      <div data-bind="attr: { id: \'map-\' + ID(), style: IframeStyle() }, googleMap: { address: resolvedAddress, mapOptions: { zoom: Zoom } }"></div>\r\n      <div class="wsb-map-element-overlay"></div>\r\n      <!-- ko if: ShowFullMapLink -->\r\n      <a href="#" class="larger-map-link" target="_blank" data-bind="attr: { href: linkUrl, style: OverlayStyle }, text: ViewLargerMap"></a>\r\n      <!-- /ko -->\r\n    </div>\r\n  </div>\r\n</script>\r\n'}),define("text!designer/app/builder/ui/canvas/elements/map/mutator.map.html",[],function(){return"<script type=\"text/html\" id=\"mutator-template-element-map\">\r\n    <!-- ko if: Type() === 'map' -->\r\n    <!-- ko with: mutatorViewModel -->\r\n    <div class=\"wsb-canvas-mutator-inner\">\r\n      <div data-bind=\"mutatorElement: {\r\n        name: 'picker',\r\n        data: address,\r\n        showError: showError,\r\n        context: {\r\n            title: i18Dict.addressColon,\r\n            editorTemplate: 'address-picker-autocomplete-template',\r\n            editorModel: $data,\r\n            isPlaceholder: hasAddressPlaceholder,\r\n            placeholderText: addressPlaceholderText,\r\n            placeholderCssClass: 'wsb-napsoc-placeholder',\r\n            placeholderTooltip: napsocAddress,\r\n            flyoutTemplate: 'address-picker-template',\r\n            flyoutModel: $data,\r\n            needsFormatted: needsFormatted,\r\n        }\r\n    }\"></div>\r\n        <div class=\"wsb-map-property\" data-bind=\"mutatorElement: {\r\n        name: 'slider',\r\n        data: zoom,\r\n        context: {\r\n            title: i18Dict.zoomColon,\r\n            min: 1,\r\n            max: 20,\r\n            unit: ''\r\n        }\r\n    }\"></div>\r\n        <div data-bind=\"mutatorElement: {\r\n        name: 'checkbox',\r\n        data: showFullMapLink,\r\n        context: {\r\n            title: i18Dict.optionsColon,\r\n            label: i18Dict.displayLargeMapLink\r\n        }\r\n    }\"></div>\r\n    </div>\r\n    <!-- /ko -->\r\n    <!-- /ko -->\r\n</script>"}),define("designer/util/googleMapsUrlHelper",[],function(){var e="//maps.google.com/maps?v=2&f=q&ie=UTF8&t=m&iwloc=";return{buildUrl:function(t){var n=[e];for(var i in t)t.hasOwnProperty(i)&&n.push("&",i,"=",encodeURIComponent(t[i]));return n.join("")}}}),define("designer/app/builder/ui/canvas/elements/map/el.map",["text!designer/app/builder/ui/canvas/elements/map/el.map.html","text!designer/app/builder/ui/canvas/elements/map/mutator.map.html","jquery","knockout","designer/app/builder/ui/canvas/elements/helper","designer/app/builder/data/data","/i18n/resources/client","designer/app/builder/ui/controls/mutator/mutator","common/geo/getClosestGeoLocation","designer/util/googleMapsUrlHelper","common/stats/googleanalytics","common/geo/googleMapBinding"],function(e,t,n,i,a,r,o,s,l,d,c){function u(){var e=this;e.Title=o.resources.Google_Map,e.SettingsTitle=o.resources.Google_Map_Settings,e.ViewLargerMap=o.resources.View_larger_map,e.SizeStyle=i.computed({deferEvalutation:!0,read:function(){return"width:"+e.Width()+";height:"+e.Height()+";"}}).extend({throttle:{type:"throttle",delay:f}}),e.NoSizeStyle=i.computed({deferEvalutation:!0,read:function(){var t=e.StyleCollection();return t.remove(function(e){return"width"===e.key||"height"===e.key}),t.stringify()}}).extend({throttle:{type:"throttle",delay:f}}),e.IframeStyle=i.computed({deferEvalutation:!0,read:function(){var t="width:100%;height:100%;",n=g(e);return null!==n&&(t+="border-radius:"+n+";-webkit-border-radius:"+n+";-moz-border-radius:"+n+";-o-border-radius:"+n+";"),t}}).extend({throttle:{type:"throttle",delay:f}}),e.OverlayStyle=i.computed({deferEvalutation:!0,read:function(){var t="",n=g(e);return null!==n&&(t+="border-radius: 0px 0px "+n+" "+n+";-webkit-border-radius: 0px 0px "+n+" "+n+";-moz-border-radius: 0px 0px "+n+" "+n+";-o-border-radius: 0px 0px "+n+" "+n+";"),t}}).extend({throttle:{type:"throttle",delay:f}}),e.resolvedAddress=i.computed(function(){var t=e.Address();return t?t===m?h.observables().FormattedStreetAddress()||h.observables().Address()||b.address:e.FormattedStreetAddress()||t:""}).extend({throttle:{type:"throttle",delay:f}}),e.buttonEnabled=i.observable(!0),e.toggleButton=function(t){void 0===t&&(t=!e.buttonEnabled()),s[t?"enableButton":"disableButton"](0),e.buttonEnabled(t)},e.iframeUrl=i.computed(function(){return d.buildUrl({q:e.resolvedAddress(),z:e.Zoom(),hl:o.lang,source:"s_q",output:"embed","wsb-w":e.Width(),"wsb-h":e.Height()})}).extend({throttle:{type:"debounce",delay:1e3}}),e.linkUrl=i.computed(function(){return d.buildUrl({q:e.resolvedAddress(),z:e.Zoom(),source:"embed"})}),e.dblClick=function(){e.isLocalizedThemeMode()||e.showProperties()},e.createMutatorViewModel=function(){return new p(e)}}function p(e){var t=this;return t.i18Dict={enterALocation:o.resources.Enter_a_location,designerNotSet:o.resources.Client__Designer__Not_set,addressColon:o.resources.Server__Address_colon,zoomColon:o.resources.Server__Zoom_colon,optionsColon:o.resources.Server__Options_colon,displayLargeMapLink:o.resources.Server__Display_large_map_link},t.needsFormatted=i.observable(e.FormattedStreetAddress()?!1:!0),t.needsFormatted.extend({notify:"always"}),t.needsFormatted.subscribe(function(n){var i=t.address();i&&(n?(e.toggleButton(!1),l.getClosestStreetAddress(t.address(),function(t){e.FormattedStreetAddress(t),e.toggleButton(!0)})):(e.FormattedStreetAddress(t.address()),e.toggleButton(!0)))}),t.address=e.Address.extend({validation:{required:t.i18Dict.enterALocation}}),t.address.subscribe(function(n){n?t.hasAddressPlaceholder()&&e.toggleButton(!0):e.toggleButton(!1)}),t.hasAddressPlaceholder=i.computed(function(){return e.Address()===m}),t.napsocAddress=i.computed(function(){var e=h.observables();return e.Address()?e.Address():void 0}),t.addressPlaceholderText=i.computed(function(){var e=h.observables().Address()||t.i18Dict.designerNotSet;return o.resources.Client__Designer__My_address+": "+e}),t.useAddressPlaceholder=function(){return t.address(m),e.Address.valueHasMutated(),!1},t.zoom=e.Zoom.extend({numericMinMax:{min:1,max:20}}),t.showFullMapLink=e.ShowFullMapLink,t.showFullMapLink.subscribe(function(e){c.trackEvent("google_map_settings","largemap_"+(e?"on":"off"),"checkbox")}),t.isValid=function(){return t.address.isValid()},t.showError=i.observable(!0),t}function g(e){var t=e.StyleCollection(),n=t.find("border-radius"),i=null;return n.length>0&&(i=n[0].value),i}var h,m="[STREET_ADDRESS]",b={address:"Scottsdale, AZ",zoom:14},f=17,v="map";return{name:v,initModel:function(e,t){e.Address=e.Address||m,e.FormattedStreetAddress=e.FormattedStreetAddress||"",e.Zoom=a.coerceNumericValue(e,e.Zoom,i.unwrap(e.Zoom),{defaultValue:b.zoom}),e.ShowFullMapLink=void 0!==e.ShowFullMapLink?e.ShowFullMapLink:!0,t&&(e.Width="320px",e.Height="240px")},load:function(n,i){h=r.getDataModel().napsoc,n.append(e).append(t),i(null,v)},createElementViewModel:function(e,t){return u.prototype=new e(t),u.prototype.constructor=u,new u}}}),define("text!designer/app/builder/ui/canvas/elements/shape/el.shape.html",[],function(){return'<script type="text/html" id="wsb-canvas-template-shape">\r\n    <div data-widget-content="true" data-bind="\r\n    attr: { \'class\': CssClasses, style: Style() },\r\n        shapeEditor: { editable: isEditing }">\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="shape-effect-template">\r\n    <div class="wsb-shape-effect-preview" data-bind="attr: { \'class\': \'wsb-shape-effect-preview \' + cssClass }"></div>\r\n</script>'}),define("text!designer/app/builder/ui/canvas/elements/shape/mutator.shape.html",[],function(){return"<script type=\"text/html\" id=\"mutator-template-element-shape\">\r\n    <!-- ko if: $data.Type() === 'shape' && $data.mutatorViewModel -->\r\n    <!-- ko with: mutatorViewModel -->\r\n    <div class=\"wsb-canvas-mutator-inner\">\r\n        <div class=\"wsb-shape-property-wrap\" data-bind=\"mutatorElement: {\r\n        name: 'gradientpicker',\r\n        data: {\r\n            useGradient: useBackgroundGradient,\r\n            gradientType: gradientType,\r\n            color1: backgroundColor,\r\n            color2: backgroundColor2\r\n        },\r\n        context: { title:i18Dict.ColorColon  }\r\n    }\"></div>\r\n\r\n        <div class=\"wsb-shape-effect-carousel clearfix\" data-bind=\"mutatorElement: {\r\n        name: 'carousel-with-none',\r\n        data: cssClass,\r\n        context: {\r\n            title:i18Dict.EffectColon ,\r\n            optionTemplate: 'shape-effect-template',\r\n            noneTemplate: 'mutator-template-carousel-none-template',\r\n            optionValueProperty: 'cssClass',\r\n            noneValue: 'customStyle',\r\n            options: effects\r\n        }\r\n    }\"></div>\r\n    </div>\r\n    <!-- /ko -->\r\n    <!-- /ko -->\r\n</script>"}),define("designer/app/builder/ui/canvas/elements/shape/el.shape",["text!designer/app/builder/ui/canvas/elements/shape/el.shape.html","text!designer/app/builder/ui/canvas/elements/shape/mutator.shape.html","jquery","knockout","common/logger/logger","designer/app/builder/data/data","/i18n/resources/client"],function(e,t,n,i,a,r,o){function s(e,t){e.ShapeColor=e.ShapeColor||"transparent",e.ShapeUrl=e.ShapeUrl||"",e.ShapeUrlNewWindow=e.ShapeUrlNewWindow||!1,t&&(e.Width="100px",e.Height="80px")}function l(e,t){function n(){var e=a.ShapeColor(),t=a.CssClass();e&&"transparent"!==e&&t&&setTimeout(function(){p.collect(),a.loadStyleItemsFromCssClass(t),a.BackgroundColor(e),a.ShapeColor("transparent"),p.enable()},100)}e.call(this,t);var a=this;a.Title=o.resources.Shape,a.SettingsTitle=o.resources.Shape_Settings,a.isEditing=i.computed(function(){return"edit"==a.state()}),a.effects=a.cssClasses,a.getShapeTypeFromCssClass=function(){var e=a.CssClass().split("_"),t=u[e[1]];return"undefined"==typeof t&&(t=u.Rectangle),t},a.dblClick=function(){a.isLocalizedThemeMode()||a.showProperties()},a.mutatorViewModel=new d(a);var r=a.StyleCollection;a.StyleCollection=i.computed(function(){var e=r(),t=a.BackgroundColor();return/\bcustomStyle\b/.test(a.CssClass())&&0==a.GradientType()&&t&&"transparent"!==t.toLowerCase()&&e.set("background",t),e}),n(),[a.CssClass,a.BorderWidth].forEach(function(e){e.subscribe(function(){setTimeout(function(){a.ensureAccurateOuterSize()},100)})})}function d(e){this.i18Dict={ColorColon:o.resources.Server__Color_colon,EffectColon:o.resources.Server__Effect_colon};var t=this;t.shapeType=e.ShapeType,t.Url=e.ShapeUrl,t.ShapeUrlNewWindow=e.ShapeUrlNewWindow,t.cssClass=e.CssClass,t.effects=e.effects,t.shapes=e.shapes}var c="shape",u={Circle:"Circle",Rectangle:"Rectangle",RoundedRectangle:"RoundedRectangle",Oval:"Oval"},p=r.undoer;return{name:c,initModel:s,load:function(n,i){n.append(e).append(t),i(null,c)},createElementViewModel:function(e,t,n){l.prototype=Object.create(e.prototype);var i=new l(e,t);return i.Styling.BackgroundColor(!1),i.Styling.Padding(!1),i.Styling.RemoveExistingCss(!1),i.Styling.AdvancedApplyToMobile(!1),n&&i.CssClass("shape"),i}}}),define("text!designer/app/builder/ui/canvas/elements/line/el.line.html",[],function(){return'<script type="text/html" id="wsb-canvas-template-line">\r\n    <div data-bind="attr: { style: getStyles }, shapeEditor: { editable: isEditing}"></div>\r\n</script>'}),define("text!designer/app/builder/ui/canvas/elements/line/mutator.line.html",[],function(){return'<script type="text/html" id="mutator-template-element-line">\r\n\r\n    <!-- ko if: $data.Type() === \'line\' && $data.mutatorViewModel -->\r\n    <!-- ko with: mutatorViewModel -->\r\n    <div class="wsb-canvas-mutator-inner">\r\n        <div class="wsb-canvas-mutator-ctrl-outer clearfix">\r\n            <div class="wsb-canvas-mutator-ctrl-label" data-bind= "text: i18Dict.DirectionColon"></div>\r\n            <div class="wsb-canvas-mutator-ctrl-input clearfix">\r\n                <ul class="wsb-horz-vert-wrap clearfix">\r\n                    <li><a data-bind="event: { click: setHorizontal }, attr: { \'class\': lineDirection() == \'horizontal\' ? \'btn btn-inverse-grey active\' : \'btn btn-inverse-grey\' }" href="#"><i class="icon-wsb-white icon-horz-arrows"></i><span data-bind="text: i18Dict.Horizontal"></span></a></li>\r\n                    <li><a data-bind="event: { click: setVertical }, attr: { \'class\': lineDirection() == \'vertical\' ? \'btn btn-inverse-grey active\' : \'btn btn-inverse-grey\' }" href="#"><i class="icon-wsb-white icon-vert-arrows"></i><span data-bind="text: i18Dict.Vertical"></span></a></li>\r\n                </ul>\r\n            </div>\r\n        </div>\r\n        <div class="wsb-line-property-wrap" data-bind="mutatorElement: {\r\n        name: \'borderpicker\',\r\n        data: {\r\n            width: borderWidth,\r\n            style: borderStyle,\r\n            color: borderColor,\r\n            borderStyles: borderStyles,\r\n            mutator: $data,\r\n            onBlur: onBlur\r\n        },\r\n        context: { title:i18Dict.BorderColon }\r\n    }"></div>\r\n    </div>\r\n    <!-- /ko -->\r\n    <!-- /ko -->\r\n</script>'}),define("designer/app/builder/ui/canvas/elements/line/el.line",["text!designer/app/builder/ui/canvas/elements/line/el.line.html","text!designer/app/builder/ui/canvas/elements/line/mutator.line.html","jquery","knockout","common/stats/googleanalytics","common/logger/logger","/i18n/resources/client"],function(e,t,n,i,a,r,o){function s(e,t){function n(e,t){this.name=e,this.value=t}function r(){var e=d.getLineStylesFromLineStyle();d.BorderColor(e.color),d.BorderStyle(e.style),d.BorderWidth(e.width),d.lineDirection(e.lineDirection),h=!1}function s(e){d.showHorizontalResizeHandles(e===u.horizontal),d.showVerticalResizeHandles(e===u.vertical)}e.call(this,t);var d=this;d.boundingBoxPadding(10),this.Title=o.resources.Line,this.SettingsTitle=o.resources.Line_Settings,d.Styling.BackgroundColor(!1),d.Styling.Border(!1),d.Styling.Shadow(!1),d.Styling.RoundedCorner(!1),d.Styling.Transparency(!1),d.Styling.Padding(!1),d.Styling.Size(!1),d.Styling.ShowAdvancedTab(!1),d.Styling.ShowBasicTabOnly(!0),d.BorderWidth.Min(1),d.BorderWidth.Max(99);var g=!1,h=!0;d.isEditing=i.computed(function(){return"edit"===d.state()}),d.getLineStylesFromLineStyle=function(){for(var e=d.LineStyle().split(";"),t=u.horizontal,n=1,i="solid",a="#ccc",r=0;r<e.length;r++)if(-1!==e[r].indexOf("border")){var o=e[r].split(":");"border-left"===o[0]&&(t=u.vertical);var s=o[1].replace(/^\s+|(?:\s+)?;?\s+$/g,"").replace(/\s+/," ").split(" ");n=parseInt(s[0]),i=s[1],a=s[2]}return{width:n,style:i,color:a,lineDirection:t}},d.getWidth=function(){var e=d.getLineStylesFromLineStyle();return e.width},d.getStyle=function(){var e=d.getLineStylesFromLineStyle();return e.style},d.getColor=function(){var e=d.getLineStylesFromLineStyle();return e.color},d.getLineDirection=function(){var e=d.getLineStylesFromLineStyle();return e.lineDirection};var m=d.getLineStylesFromLineStyle();d.lineWidth=i.observable(m.width),d.lineStyle=i.observable(m.style),d.lineColor=i.observable(m.color),d.lineDirection=i.observable(m.lineDirection),s(m.lineDirection),d.lineDirection.subscribe(s),d.getStyles=i.computed({deferEvaluation:!0,read:function(){var e={width:d.Width(),height:d.Height(),borderWidth:d.BorderWidth(),borderStyle:d.BorderStyle(),borderColor:d.BorderColor(),transparency:d.Transparency(),lineStyle:d.LineStyle(),lineDirection:d.lineDirection()};if(h||g)return e.lineStyle;var t="",n="",i=parseInt(e.height,10),a=parseInt(e.width,10);if(d.lineDirection(i>=a?u.vertical:u.horizontal),d.lineDirection()===u.horizontal?(t="width: "+e.width+";",t+="border-top: "):(t+="border-left: ",n="height: "+e.height+";"),t+=e.borderWidth+"px",t+=" "+e.borderStyle+" "+e.borderColor+";",t+=n,e.transparency<=100){var r=(100-e.transparency)/100;t+="opacity: "+r+";",t+="filter: alpha(opacity="+r+");"}return d.LineStyle(t),t}}),d.getStyles.extend({throttle:{type:"throttle",delay:p}}),d.borderStyles=[new n(o.resources.Client__Solid,"solid"),new n(o.resources.Client__Dotted,"dotted"),new n(o.resources.Client__Dashed,"dashed"),new n(o.resources.Client__Doubled,"double"),new n(o.resources.Client__Grooved,"groove"),new n(o.resources.Client__Ridged,"ridge"),new n(o.resources.Client__Inset,"inset"),new n(o.resources.Client__Outset,"outset")],d.blur=function(){0==d.lineWidth()&&d.lineWidth(1)},d.dblClick=function(){d.isLocalizedThemeMode()||(a.trackEvent("WSB-Designer","Double-Click",c),d.showProperties())},d.getOuterWidth=function(){return d.lineDirection()===u.vertical?this.BorderWidth()+2*(this.Padding()||0)+this.outerSizeDiff.widthDiff():this.pixelWidth()+2*(this.Padding()||0)+this.outerSizeDiff.widthDiff()},d.getOuterHeight=function(){return d.lineDirection()===u.vertical?this.pixelHeight()+2*(this.Padding()||0)+this.outerSizeDiff.heightDiff():this.BorderWidth()+2*(this.Padding()||0)+this.outerSizeDiff.heightDiff()},this.outlineWidth=i.computed(function(){return"inherit"}),this.outlineHeight=i.computed(function(){return"inherit"}),d.mutatorViewModel=new l(d),r()}function l(e){this.i18Dict={BorderColon:o.resources.Server__Border_colon,DirectionColon:o.resources.Server__Direction_colon,Horizontal:o.resources.Server__Horizontal,Vertical:o.resources.Server__Vertical},this.onBlur=e.blur,this.setHorizontal=function(){if(a.trackEvent("line_settings","horizontal",c),e.lineDirection()!==u.horizontal){changingOrientation=!0,e.lineDirection(u.horizontal);var t=parseInt(e.Width()),n=parseInt(e.Height());e.Width(n+"px"),e.Height(t+"px"),changingOrientation=!1,e.lineDirection.notifySubscribers()}},this.setVertical=function(){if(a.trackEvent("line_settings","vertical",c),e.lineDirection()!==u.vertical){changingOrientation=!0,e.lineDirection(u.vertical);var t=parseInt(e.Width()),n=parseInt(e.Height());e.Width(n+"px"),e.Height(t+"px"),changingOrientation=!1,e.lineDirection.notifySubscribers()}},this.lineDirection=e.lineDirection}function d(){i.bindingHandlers.lineEditor={update:function(e,t,n,a,r){var o=t(),s=i.utils.unwrapObservable(o.editable);s?r.editable={}:r.editable&&(r.editable=null)}}}var c="line",u={horizontal:"horizontal",vertical:"vertical"},p=17;return{name:c,initModel:function(e,t){e.BorderWidth=e.BorderWidth||2,e.BorderStyle=e.BorderStyle||"solid",e.BorderColor=e.BorderColor||"#999",e.LineStyle=e.LineStyle||"border-top: 2px solid #999;",t&&(e.Width="200px",e.Height="20px")},load:function(n,i){n.append(e).append(t),d(),i(null,c)},createElementViewModel:function(e,t){return s.prototype=Object.create(e.prototype),new s(e,t)}}}),define("text!designer/app/builder/ui/canvas/elements/navigation/el.navigation.html",[],function(){return'<script type="text/html" id="wsb-canvas-template-navigation">\r\n    <div data-widget-content="true" data-bind="\r\n        attr: {id:\'wsb-nav-\' + ID(), \'class\': \'wsb-nav \' + CssClass() + \' wsb-nav-\' + ID() },\r\n        css: {\r\n            \'nav-horizontal\':    isHorizontal,\r\n            \'nav-vertical\':      isVertical,\r\n            \'nav-btn-left\':      isLeftButtonAlignment,\r\n            \'nav-btn-center\':    isCenterButtonAlignment,\r\n            \'nav-btn-right\':     isRightButtonAlignment,\r\n            \'nav-btn-stretch\':   isStretchButtonAlignment,\r\n            \'nav-text-left\':     isLeftTextAlignment,\r\n            \'nav-text-center\':   isCenterTextAlignment,\r\n            \'nav-text-right\':    isRightTextAlignment,\r\n            \'nav-equal-width\':   UseEqualWidths\r\n        },\r\n        style: { width: Width, height: Height }\r\n    ">\r\n        <style data-bind="html: menuStyle()"></style>\r\n        <div class="wsb-nav-element-shield" data-bind="style: {\r\n            top: selectionMargin,\r\n            bottom: selectionMargin,\r\n            left: selectionMargin,\r\n            right: selectionMargin\r\n        }"></div>\r\n\r\n        <ul class="wsb-undo-select wsb-navigation-top-level-menu" data-bind="foreach: localizedNavItems">\r\n            <!-- ko if: $parent.isValidNavItem($data) -->\r\n            <li data-bind="\r\n                    style: { width: $parent.itemWidth },\r\n                    css: {\r\n                        active: $parent.isCurrentPage($data),\r\n                        \'has-children\': $parent.itemHasChildren($data)\r\n                    }\r\n                ">\r\n                <a href="#" data-bind="\r\n                        text: $parent.getNavItemText($data),\r\n                        click: $parent.navigate,\r\n                        event: { dragstart: $parent.onDragStart },\r\n                        clickBubble: false"></a>\r\n                <!-- ko template: {\r\n                    name: \'subnavigation-template\',\r\n                    data: { items: ko.utils.unwrapObservable($data.subItems), nav: $parent }\r\n                } -->\r\n                <!-- /ko -->\r\n            </li>\r\n            <!-- /ko -->\r\n        </ul>\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="subnavigation-template">\r\n    <!-- ko if: $data.items && items.length -->\r\n        <ul class="nav-subnav" data-bind="foreach: items">\r\n            <!-- ko if: $parent.nav.isValidNavItem($data) -->\r\n                <li data-bind="css: { \r\n                    active: $parent.nav.isCurrentPage($data),\r\n                    \'has-children\': $parent.nav.itemHasChildren($data)\r\n                }">\r\n                    <a href="#" data-bind="\r\n                        text: $parent.nav.getNavItemText($data),\r\n                        click: $parent.nav.navigate,\r\n                        event: { dragstart: $parent.nav.onDragStart },\r\n                        clickBubble: false"></a>\r\n                    <!-- ko template: { \r\n                        data: { items: ko.utils.unwrapObservable($data.subItems), nav: $parent.nav },\r\n                        name: \'subnavigation-template\' \r\n                    } -->\r\n                    <!-- /ko -->\r\n                </li>\r\n            <!-- /ko -->\r\n        </ul>\r\n    <!-- /ko -->\r\n</script>\r\n\r\n'}),define("text!designer/app/builder/ui/canvas/elements/navigation/mutator.navigation.html",[],function(){return'<script type="text/html" id="mutator-template-element-navigation">\r\n    <!-- ko if: $data.Type() === \'navigation\' && $data.elementViewModel.editorViewModel -->\r\n    <div class="wsb-canvas-mutator-inner wsb-nav-properties-page clearfix" data-bind="\r\n        event: {\r\n            mousedown: elementViewModel.editorViewModel.captureEvent,\r\n            mouseup: elementViewModel.editorViewModel.captureEvent\r\n        },\r\n        mousedownBubble: false,\r\n        mouseupBubble: false\r\n    ">\r\n        <div class="wsb-canvas-mutator-ctrl-outer clearfix">\r\n            <div class="wsb-canvas-mutator-ctrl-label wsb-color-label" data-bind= "text: mutatorViewModel.i18Dict.OptionsColon"></div>\r\n            <div class="wsb-canvas-mutator-ctrl-input">\r\n                <div class="navigation-editor-toolbar-group">\r\n                    <a href="#" class="navigation-editor-btn navigation-editor-horizontal-btn" data-bind="\r\n                        click: elementViewModel.editorViewModel.makeHorizontal,\r\n                        clickBubble: false,\r\n                        tooltip: mutatorViewModel.i18Dict.HorizontalMenu"></a>\r\n                    <a href="#" class="navigation-editor-btn navigation-editor-vertical-btn" data-bind="\r\n                        click: elementViewModel.editorViewModel.makeVertical,\r\n                        clickBubble: false,\r\n                        tooltip: mutatorViewModel.i18Dict.VerticalMenu"></a>\r\n                </div>\r\n                <ul class="nav-btn-dropdown" data-bind="\r\n                    dropList: {\r\n                        value: elementViewModel.editorViewModel.buttonAlignment,\r\n                        isNumeric: true,\r\n                        cssClass: \'button-navigation-select\',\r\n                        width: \'auto\',\r\n                        zIndex: 2000000001,\r\n                        inDialog: true\r\n                    },\r\n                    tooltip:mutatorViewModel.i18Dict.ButtonAlignment ">\r\n                    <li data-bind="attr: { \'data-value\': elementViewModel.editorViewModel.buttonAlignments.left }">\r\n                        <div data-main="true" class="navigation-editor-icon-container">\r\n                            <div class="navigation-editor-icon navigation-editor-btn-align-left"></div>\r\n                        </div>\r\n                        <div class="dropdown-text" data-bind= "text: mutatorViewModel.i18Dict.Left">\r\n                        </div>\r\n                    </li>\r\n                    <li data-bind="attr: { \'data-value\': elementViewModel.editorViewModel.buttonAlignments.center }">\r\n                        <div data-main="true" class="navigation-editor-icon-container">\r\n                            <div class="navigation-editor-icon navigation-editor-btn-align-center"></div>\r\n                        </div>\r\n                        <div class="dropdown-text" data-bind= "text: mutatorViewModel.i18Dict.Center">\r\n                        </div>\r\n                    </li>\r\n                    <li data-bind="attr: { \'data-value\': elementViewModel.editorViewModel.buttonAlignments.right }">\r\n                        <div data-main="true" class="navigation-editor-icon-container">\r\n                            <div class="navigation-editor-icon navigation-editor-btn-align-right"></div>\r\n                        </div>\r\n                        <div class="dropdown-text" data-bind= "text: mutatorViewModel.i18Dict.Right">\r\n                        </div>\r\n                    </li>\r\n                    <li data-bind="attr: { \'data-value\': elementViewModel.editorViewModel.buttonAlignments.stretch }">\r\n                        <div data-main="true" class="navigation-editor-icon-container">\r\n                            <div class="navigation-editor-icon navigation-editor-btn-align-stretch"></div>\r\n                        </div>\r\n                        <div class="dropdown-text" data-bind= "text: mutatorViewModel.i18Dict.Stretch"></div>\r\n                    </li>\r\n                </ul>\r\n                <ul class="nav-text-dropdown" data-bind="\r\n                    dropList: {\r\n                        value: elementViewModel.editorViewModel.textAlignment,\r\n                        isNumeric: true,\r\n                        cssClass: \'text-alignment-select\',\r\n                        width: \'auto\',\r\n                        zIndex: 2000000001,\r\n                        inDialog: true,\r\n                        useSync: true\r\n                    },\r\n                    tooltip:mutatorViewModel.i18Dict.TextAlignment \r\n                ">\r\n                    <li data-bind="attr: { \'data-value\': elementViewModel.editorViewModel.textAlignments.left }">\r\n                        <div data-main="true" class="navigation-editor-icon-container">\r\n                            <div class="navigation-editor-icon navigation-editor-text-align-left"></div>\r\n                        </div>\r\n                        <div class="dropdown-text" data-bind= "text: mutatorViewModel.i18Dict.Left">\r\n                        </div>\r\n                    </li>\r\n                    <li data-bind="attr: { \'data-value\': elementViewModel.editorViewModel.textAlignments.center }">\r\n                        <div data-main="true" class="navigation-editor-icon-container">\r\n                            <div class="navigation-editor-icon navigation-editor-text-align-center"></div>\r\n                        </div>\r\n                        <div class="dropdown-text" data-bind= "text: mutatorViewModel.i18Dict.Center">\r\n                        </div>\r\n                    </li>\r\n                    <li data-bind="attr: { \'data-value\': elementViewModel.editorViewModel.textAlignments.right }">\r\n                        <div data-main="true" class="navigation-editor-icon-container">\r\n                            <div class="navigation-editor-icon navigation-editor-text-align-right"></div>\r\n                        </div>\r\n                        <div class="dropdown-text" data-bind= "text: mutatorViewModel.i18Dict.Right">\r\n                        </div>\r\n                    </li>\r\n                </ul>\r\n                <a href="#" class="navigation-editor-btn navigation-editor-equal-width-btn" data-bind="\r\n                    css: { disabled: !elementViewModel.editorViewModel.isEqualWidthAllowed() },\r\n                    click: elementViewModel.editorViewModel.isEqualWidthAllowed() ? elementViewModel.editorViewModel.toggleEqualWidth : undefined,\r\n                    clickBubble: false,\r\n                    tooltip:mutatorViewModel.i18Dict.EqualWidth "></a>\r\n            </div>\r\n        </div>\r\n\r\n        <div class="wsb-canvas-mutator-ctrl-outer clearfix">\r\n            <div class="wsb-canvas-mutator-ctrl-label wsb-color-label" data-bind= "text: mutatorViewModel.i18Dict.ThemeColon"></div>\r\n            <div class="wsb-canvas-mutator-ctrl-input clearfix">\r\n                <!-- ko if: elementViewModel.editorViewModel.cssClassesLoaded -->\r\n                <select class="wsb-select-box wsb-theme-select"\r\n                        data-aid="wsb-navigation-select-theme"\r\n                        data-bind="\r\n                        options: elementViewModel.editorViewModel.cssClasses,\r\n                        optionsText: \'i18NStyleName\',\r\n                        optionsValue: \'cssClass\',\r\n                        value: elementViewModel.editorViewModel.selectedCssClass"></select>\r\n                <!-- /ko -->\r\n                <!-- ko ifnot: elementViewModel.editorViewModel.cssClassesLoaded -->\r\n                <div class="loading wsb-select-box"><span data-bind= "text: mutatorViewModel.i18Dict.Loading"></span></div>\r\n                <!-- /ko -->\r\n            </div>\r\n        </div>\r\n\r\n        <div class="wsb-canvas-mutator-ctrl-outer clearfix">\r\n            <div class="wsb-canvas-mutator-ctrl-label wsb-color-label" data-bind= "text: mutatorViewModel.i18Dict.FontColon"></div>\r\n            <div class="wsb-canvas-mutator-ctrl-input wsb-font-selects ">\r\n                <select class="wsb-select-box"\r\n                        data-aid="wsb-navigation-select-font-family"\r\n                        data-bind="\r\n                        options: elementViewModel.styleProperties.AvailableFonts,\r\n                        optionsText: \'fontName\',\r\n                        optionsValue: \'fontStyle\',\r\n                        value: elementViewModel.styleProperties.MenuFontFamily,\r\n                        ga: { change: { category: \'nav_settings\', action: \'font\', label: elementViewModel.styleProperties.MenuFontFamily } }"></select>\r\n              <select class="wsb-select-box"\r\n                      data-aid="wsb-navigation-select-font-size"\r\n                      data-bind="\r\n                        options: elementViewModel.styleProperties.AvailableFontSizes,\r\n                        optionsText: \'fontSizeDisplay\',\r\n                        optionsValue: \'fontSize\',\r\n                        value: elementViewModel.styleProperties.MenuFontSize,\r\n                        ga: { change: { category: \'nav_settings\', action: \'font_size\', label: elementViewModel.styleProperties.MenuFontSize } }"></select>\r\n            </div>\r\n        </div>\r\n\r\n        <div class="wsb-nav-properties-page-section clearfix">\r\n            <div class="wsb-canvas-mutator-colorpicker navigation-editor-color-picker clearfix">\r\n                <div class="wsb-color-label wsb-nav-properties-colorpicker-label" data-bind= "text: mutatorViewModel.i18Dict.TextColon"> </div>\r\n                <div class="wsb-nav-properties-colorpicker clearfix">\r\n                    <div data-aid="wsb-navigation-select-menu-color" data-bind="colorPicker: {\r\n                        color: elementViewModel.styleProperties.MenuColor,\r\n                        zIndex: 2000020050,\r\n                        allowNull: true,\r\n                        inDialog: true,\r\n                        onChange: elementViewModel.getEventTrackingHandler(\'text_color\')\r\n                    }"></div>\r\n                </div>\r\n            </div>\r\n            <div class="wsb-canvas-mutator-colorpicker navigation-editor-color-picker clearfix">\r\n                <div class="wsb-color-label wsb-nav-properties-colorpicker-label2" data-bind= "text: mutatorViewModel.i18Dict.HoverColon"> </div>\r\n                <div class="wsb-nav-properties-colorpicker clearfix">\r\n                    <div data-aid="wsb-navigation-select-menu-hover-color" data-bind="colorPicker: {\r\n                        color: elementViewModel.styleProperties.MenuHoverColor,\r\n                        zIndex: 2000020050,\r\n                        allowNull: true,\r\n                        inDialog: true,\r\n                        onChange: elementViewModel.getEventTrackingHandler(\'hovered_textcolor\')\r\n                    }"></div>\r\n                </div>\r\n            </div>\r\n            <div class="wsb-canvas-mutator-colorpicker navigation-editor-color-picker clearfix">\r\n                <div class="wsb-color-label wsb-nav-properties-colorpicker-label2" data-bind= "text: mutatorViewModel.i18Dict.SelectedColon"> </div>\r\n                <div class="wsb-nav-properties-colorpicker clearfix">\r\n                    <div data-aid="wsb-navigation-select-menu-selected-color" data-bind="colorPicker: {\r\n                        color: elementViewModel.styleProperties.MenuActiveColor,\r\n                        zIndex: 2000020050,\r\n                        allowNull: true,\r\n                        inDialog: true,\r\n                        onChange: elementViewModel.getEventTrackingHandler(\'selected_textcolor\')\r\n                    }"></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="wsb-canvas-mutator-ctrl-outer wsb-nav-properties-page-section clearfix">\r\n            <div class="wsb-canvas-mutator-colorpicker navigation-editor-color-picker clearfix">\r\n                <div class="wsb-color-label wsb-nav-properties-colorpicker-label" data-bind= "text: mutatorViewModel.i18Dict.BackgroundColon"> </div>\r\n                <div class="wsb-nav-properties-colorpicker clearfix">\r\n                    <div data-aid="wsb-navigation-select-menu-background-color" data-bind="colorPicker: {\r\n                        color: elementViewModel.styleProperties.MenuBackgroundColor,\r\n                        zIndex: 2000020050,\r\n                        allowNull: true,\r\n                        inDialog: true,\r\n                        onChange: elementViewModel.getEventTrackingHandler(\'background_color\')\r\n                    }"></div>\r\n                </div>\r\n            </div>\r\n            <div class="wsb-canvas-mutator-colorpicker navigation-editor-color-picker clearfix">\r\n                <div class="wsb-color-label wsb-nav-properties-colorpicker-label2" data-bind= "text: mutatorViewModel.i18Dict.HoverColon"> </div>\r\n                <div class="wsb-nav-properties-colorpicker clearfix">\r\n                    <div data-aid="wsb-navigation-select-menu-background-hover-color" data-bind="colorPicker: {\r\n                        color: elementViewModel.styleProperties.MenuHoverBackgroundColor,\r\n                        zIndex: 2000020050,\r\n                        allowNull: true,\r\n                        inDialog: true,\r\n                        onChange: elementViewModel.getEventTrackingHandler(\'hovered_backgroundcolor\')\r\n                    }"></div>\r\n                </div>\r\n            </div>\r\n            <div class="wsb-canvas-mutator-colorpicker navigation-editor-color-picker clearfix">\r\n                <div class="wsb-color-label wsb-nav-properties-colorpicker-label2" data-bind= "text: mutatorViewModel.i18Dict.SelectedColon"> </div>\r\n                <div class="wsb-nav-properties-colorpicker clearfix">\r\n                    <div data-aid="wsb-navigation-select-menu-selected-background-color" data-bind="colorPicker: {\r\n                        color: elementViewModel.styleProperties.MenuActiveBackgroundColor,\r\n                        zIndex: 2000020050,\r\n                        allowNull: true,\r\n                        inDialog: true,\r\n                        onChange: elementViewModel.getEventTrackingHandler(\'selected_backgroundcolor\')\r\n                    }"></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="wsb-canvas-mutator-ctrl-outer">\r\n            <a href="#" data-aid="wsb-navigation-save-changes" class="btn btn-inverse-grey" data-bind="\r\n                click: elementViewModel.showNavigationEditDialog,\r\n                clickBubble: false,\r\n                ga: { click: { category: \'nav_settings\', action: \'edit_menu\', label: \'button\' } }\r\n            ">\r\n                <i class="icon-wsb-white wsb-nav-properties-icon-edit-menu"></i><span data-bind= "text: mutatorViewModel.i18Dict.EditMenu"></span>\r\n            </a>\r\n            <a href="#" data-aid="wsb-navigation-revert-changes" class="wsb-link" data-bind="\r\n                click: elementViewModel.resetCustomStyles,\r\n                visible: elementViewModel.isCustomStyle(),\r\n                clickBubble: false,\r\n                ga: { click: { category: \'nav_settings\', action: \'revert_to_original\', label: \'link\' } }\r\n            "><span data-bind= "text: mutatorViewModel.i18Dict.Resetnavigationstyle"></span>\r\n            </a>\r\n        </div>\r\n    </div>\r\n    <!-- /ko -->\r\n\r\n</script>'
}),define("designer/app/builder/ui/canvas/elements/navigation/subNavigation",["jquery"],function(e){function t(e){return parseFloat(e)||0}function n(n,i){if(n[0]===window)return 0;var a="none"===n.css(i+"Style")?0:n.css(i+"Width"),r=e.browser.msie&&"8.0"==e.browser.version;switch(a){case"thin":return r?1:2;case"medium":return r?3:4;case"thick":return r?5:6;default:return t(a)}}function i(e){return e.find("> ul")}function a(){e(function(){e(".wsb-nav").parent().css("z-index",1e4)})}var r={scroll:"scrollLeft",pos:"left",margin:"marginLeft",border:"borderLeft",size:"width",outerSize:"outerWidth"},o={scroll:"scrollTop",pos:"top",margin:"marginTop",border:"borderTop",size:"height",outerSize:"outerHeight"},s=!(e.browser.webkit||/chrome/i.test(navigator.userAgent)),l=function(i){function a(e,a){return function(r){var o=a(r)+t(r.css(e.margin));return s&&(o+=n(r.parent(),e.border)),{isVisible:function(){var t=r.offset(),a=t[e.pos]+o-h[e.pos]-n(g,e.border),s=i[e.outerSize]()||0,l=g[e.scroll]()||0;return a>l&&a+s<l+m[e.size]},apply:function(){i.css(e.pos,r.position()[e.pos]+o+"px"),i.css("z-index",1e4)}}}}function l(e){return a(e,function(){return 1-i[e.outerSize]()})}function d(e){return a(e,function(){return 0})}function c(e){return a(e,function(t){return(t[e.outerSize]()-i[e.outerSize]())/2})}function u(e){return a(e,function(t){return t[e.outerSize]()-i[e.outerSize]()})}function p(e){return a(e,function(t){return t[e.outerSize]()-1})}var g,h,m,b=i.parents("#mobileView");return b.length?(g=b,h=b.offset(),m={width:g[0].clientWidth,height:g[0].clientHeight}):(g=e(window),h={top:0,left:0},m={width:g[0].innerWidth||document.documentElement.clientWidth,height:g[0].innerHeight||document.documentElement.clientHeight}),{leftOf:l(r),leftAlignedWith:d(r),centeredWith:c(r),rightAlignedWith:u(r),rightOf:p(r),above:l(o),topAlignedWith:d(o),bottomAlignedWith:u(o),below:p(o)}};return e(document).on("mouseover.subnav",".wsb-nav li",function(){var t=e(this);t.parents(".wsb-element-navigation").css("zIndex",10001);var n=i(t);if(n.length){var a=t.parents(".wsb-nav").css("zIndex",10001);n.css({display:"table",visibility:"visible"});for(var r=l(n),o=r.leftAlignedWith(t),s=r.centeredWith(t),d=r.rightAlignedWith(t),c={horizontal:{primaryAxisPlacements:[r.below(t),r.above(t)],secondaryAxisPlacements:a.is(".nav-text-left")?[o,s,d]:a.is(".nav-text-right")?[d,s,o]:[s,o,d]},vertical:{primaryAxisPlacements:[r.rightOf(t),r.leftOf(t)],secondaryAxisPlacements:[r.topAlignedWith(t),r.bottomAlignedWith(t)]}},u=a.is(".nav-horizontal")&&1===t.parents("ul").length?[c.horizontal,c.vertical]:[c.vertical,c.horizontal],p=u[0],g=p.primaryAxisPlacements[0],h=0;h<u.length;h++){for(var m=u[h],b=null,f=0;f<m.primaryAxisPlacements.length;f++)if(m.primaryAxisPlacements[f].isVisible()){b=m.primaryAxisPlacements[f];break}if(b){g=b,p=m;break}}for(var v=p.secondaryAxisPlacements[0],h=0;h<p.secondaryAxisPlacements.length;h++)if(p.secondaryAxisPlacements[h].isVisible()){v=p.secondaryAxisPlacements[h];break}g.apply(),v.apply()}}).on("mouseout.subnav",".wsb-nav li",function(){var t=e(this);t.parents(".wsb-element-navigation").css("zIndex",1e4),t.parents(".wsb-nav").css("zIndex",1e4),i(t).css("visibility","hidden").off("mouseout.subnav")}),{initialize:a}}),define("designer/app/builder/ui/canvas/elements/navigation/el.navigation",["text!designer/app/builder/ui/canvas/elements/navigation/el.navigation.html","text!designer/app/builder/ui/canvas/elements/navigation/mutator.navigation.html","jquery","knockout","libs/jquery/jqui","designer/app/builder/ui/canvas/elements/helper","designer/app/builder/ui/controls/navigationDialog/el.navigation.dialog","designer/app/builder/ui/controls/navigationDialog/navigation.dialog.helper","common/stats/googleanalytics","/i18n/resources/client","designer/app/builder/data/data","designer/app/builder/managers/pageManager","common/abTesting/abTesting","common/api/api.guid","designer/app/builder/ui/canvas/elements/navigation/subNavigation","libs/knockout/ko.addins_v2"],function(e,t,n,i,a,r,o,s,l,d,c,u,p,g){function h(){var e=this,t=[],n=[];e.pushSelector=function(n){return t.push(n),e},e.pushValue=function(t,i,a){return i&&"nil"!==i&&n.push({key:t,value:i,decoration:a}),e},e.reset=function(){n=[],t=[]},e.render=function(){var e,i=[],a=!0;for(i.push(t.join(", ")+" {"),e=0;e<n.length;e++)n[e].value&&"nil"!==n[e].value&&(i.push(n[e].key+":"+n[e].value+(n[e].decoration?n[e].decoration:"")+";"),a=!1);return i.push("}"),a?"":i.join("")}}function m(e){function t(e,t){var n=t.slice(0);n.unshift(0,e().length),e.splice.apply(e,n)}var a=e;if(a.localizedNavItems=a.getLocalizedJsonProperty("NavItems"),a.pages=i.computed(function(){return _.filter(u.pages(),function(e){return!e.isDeleted()})}),!N()){var r=a.cssClasses();r&&1===r.length?a.cssClasses.subscribe(function(){N(!0)}):N(!0)}a.cssClassesLoaded=N,a.CssClass=a.CssClass||i.observable("");var c=[];a.pages.subscribe(function(e){c=e},null,"beforeChange"),a.pages.subscribe(function(e){var t=_.difference(e,c);if(t.length>0){var n=t[0],r=s.createNavItemModel(n.Id(),null,null,null,!0);a.NavItems.push(r)}else{var o=_.difference(c,e);if(o.length>0){var n=o[0];a.NavItems.remove(function(e){return e.subItems&&e.subItems()&&e.subItems.remove(function(e){return e.subItems&&e.subItems()&&e.subItems.remove(function(e){return!e.url()&&n.Id()==e.pageId()}),!e.url()&&n.Id()==e.pageId()}),!e.url()&&n.Id()==i.unwrap(e.pageId)})}}}),a.NavigateEnabled=i.observable(!0),[a.Orientation,a.NavItems,a.MenuFontSize,a.MenuFontFamily].forEach(function(e){e.subscribe(function(){a.ensureAccurateOuterSize()})}),a.handleResize=function(){T=T||a.getDomElement().find("ul");var e=T.width();a.pixelWidth()<e&&a.pixelWidth(e)},a.boundingBoxPadding(10),a.boundingBoxZIndex=i.computed(function(){return a.zIndex()-1}),a.selectionMargin=i.computed(function(){return-a.boundingBoxPadding()+"px"});var p=a.zIndex;if(a.zIndex=i.computed(function(){return a.NavItems().some(function(e){return e.subItems&&e.subItems()&&e.subItems().length})?a.isMouseOver()?10001:1e4:p()}),a.pages=u.pages,a.isCurrentPage=function(e){return i.computed(function(){return a.currentPageId()===i.unwrap(e.pageId)})},a.itemHasChildren=function(e){return i.computed(function(){var t=i.utils.unwrapObservable(e.subItems);return!(!t||!t.length)})},a.orientations=D,a.buttonAlignments=I,a.textAlignments=A,a.isHorizontal=i.computed(function(){return a.Orientation()===D.horizontal}),a.isVertical=i.computed(function(){return a.Orientation()===D.vertical}),a.isLeftButtonAlignment=i.computed(function(){return a.ButtonAlignment()===I.left}),a.isRightButtonAlignment=i.computed(function(){return a.ButtonAlignment()===I.right}),a.isCenterButtonAlignment=i.computed(function(){return a.ButtonAlignment()===I.center}),a.isStretchButtonAlignment=i.computed(function(){return a.ButtonAlignment()===I.stretch}),a.isLeftTextAlignment=i.computed(function(){return a.TextAlignment()===A.left}),a.isCenterTextAlignment=i.computed(function(){return a.TextAlignment()===A.center}),a.isRightTextAlignment=i.computed(function(){return a.TextAlignment()===A.right}),a.itemWidth=i.computed(function(){var e=a.ButtonAlignment()===I.stretch||a.UseEqualWidths();return a.Orientation()===D.horizontal?e?100/a.NavItems().length+"%":"auto":e?null:"auto"}),a.stylePrefix="nav",L.test((a.ID()||"").toString())){var g=a.cssClasses();g.length>1&&(!a.CssClass()||a.CssClass()===g[0].cssClass)&&a.CssClass(g[1].cssClass)}return a.getDefaultColor=function(){var e;if(arguments.length>1)for(e=1;e<arguments.length;e++)if(arguments[e])return arguments[e];return arguments[0]},a.isCustomStyle=i.computed(function(){var t=e.MenuBackgroundColor()||e.MenuActiveBackgroundColor()||e.MenuColor()||e.MenuActiveColor()||e.MenuHoverBackgroundColor()||e.MenuHoverColor()||e.MenuFontFamily()&&"nil"!==e.MenuFontFamily()||e.MenuFontSize()&&"nil"!==e.MenuFontSize();return t}),a.resetCustomStyles=function(){a.MenuActiveBackgroundColor(null),a.MenuActiveColor(null),a.MenuBackgroundColor(null),a.MenuColor(null),a.MenuFontFamily("nil"),a.MenuFontSize("nil"),a.MenuHoverBackgroundColor(null),a.MenuHoverColor(null)},e.NavigationPropertiesTestEnabled()||a.resetCustomStyles(),a.menuStyle=i.computed(function(){var t=[];if(e.NavigationPropertiesTestEnabled()){var n="#wsb-nav-"+a.ID(),i=a.getDefaultColor(e.MenuBackgroundColor(),e.MenuActiveBackgroundColor()),r=new h;r.reset(),t.push(r.pushSelector(n+" ul > li > a").pushValue("font-family",e.MenuFontFamily()).pushValue("color",e.MenuColor()).render()),r.reset(),t.push(r.pushSelector(n+" > ul > li > a").pushValue("font-size",e.MenuFontSize()).render()),r.reset(),t.push(r.pushSelector(n+" ul > li").pushSelector(n+" > ul > li > a").pushSelector(n+" .nav-subnav li a").pushValue("background-image",e.MenuBackgroundColor()?"none":null).pushValue("background-color",e.MenuBackgroundColor()).render()),r.reset(),t.push(r.pushSelector(n+"  ul > li:hover").pushSelector(n+"  ul > li:hover > a").pushSelector(n+"  ul > li.active:hover").pushSelector(n+"  ul > li.active > a:hover").pushSelector(n+"  ul > li.active .nav-subnav li:hover").pushSelector(n+"  ul > li.active .nav-subnav li:hover > a").pushValue("background-image",e.MenuHoverBackgroundColor()?"none !important":null).pushValue("background-color",e.MenuHoverBackgroundColor()," !important").pushValue("color",e.MenuHoverColor()," !important").render()),r.reset(),t.push(r.pushSelector(n+" > ul.wsb-navigation-top-level-menu > li.active").pushSelector("div"+n+" > ul.wsb-navigation-top-level-menu > li.active > a").pushValue("background-image",i?"none":null).pushValue("background-color",i).pushValue("color",e.MenuActiveColor()).render()),r.reset()}return t.join(" ").trim()}),a.menulist=[],a.getActionMenuItems=i.computed(function(){var t=a.getCommands();return[{text:d.resources.Edit,tip:d.resources.Edit,cssClass:"wsb-tool-Edit",click:function(){l.trackEvent("general_settings_modal","edit","navigation"),a.hideActionMenu(),a.showNavigationEditDialog()}},e.NavigationPropertiesTestEnabled()?t.editProperties:t.edit,t.clone,t["delete"],t.layoutCommands]}),a.dblClick=function(){return e.isLocalizedThemeMode()||a.showNavigationEditDialog(),!1},a.onDragStart=function(){return a.draggingStarted=!0,!1},a.navigate=function(e,t){if(!a.NavigateEnabled())return!1;if(a.draggingStarted)return delete a.draggingStarted,!1;var n=(i.unwrap(this.pageId)||"").toString(),r=this.url();if(!n){var o=O.exec(r);o&&(n=o[1])}return n?(n!==a.currentPageId&&(u.switchPage(n),t.stopPropagation()),t.preventDefault(),!0):!window.open(r)},a.isValidNavItem=function(e){if(e.isActive&&!e.isActive())return!1;var t=i.unwrap(e.pageId);return!t||u.pages().some(function(e){return e.Id()==t})},a.getNavItemText=function(e){var t=(i.unwrap(e.pageId)||"").toString();if(!t)return i.unwrap(e.title);var a=n.grep(u.pages(),function(e){return e.Id()===t})[0];return a?a.localizedName():void 0},a.onNavItemsChanged=function(e){t(a.NavItems,e)},a.showNavigationEditDialog=function(){var e=function(){o.open(a.NavItems(),{updateCallback:a.onNavItemsChanged,openCallback:function(){a.state(a.stateMap.edit)},closeCallback:function(){a.state(a.stateMap.view)}})};a.isMutatorOpen()?a.hideProperties(!0,e):e();var t=a.state.subscribe(function(){"selected"!==a.state()&&(o.close(),t.dispose())})},a.onRemove=function(){a.pageCollectionSubscription&&a.pageCollectionSubscription.dispose()},a.styleProperties={MenuFontFamily:i.computed({read:function(){return e.MenuFontFamily()||"nil"},write:function(t){e.MenuFontFamily(t)}}),MenuFontSize:i.computed({read:function(){return e.MenuFontSize()||"nil"},write:function(t){e.MenuFontSize(t)}}),MenuBackgroundColor:e.MenuBackgroundColor,MenuColor:e.MenuColor,MenuActiveBackgroundColor:e.MenuActiveBackgroundColor,MenuActiveColor:e.MenuActiveColor,MenuHoverColor:e.MenuHoverColor,MenuHoverBackgroundColor:e.MenuHoverBackgroundColor,AvailableFonts:P,AvailableFontSizes:E},a.getEventTrackingHandler=function(e){return function(){l.trackEvent("nav_settings",e,"swatch")}},a.editorViewModel=new b(a),a.mutatorViewModel=new w(a),e}function b(e){var t=this;t.cssClasses=e.cssClasses,t.selectedCssClass=e.CssClass,t.selectedCssClass.subscribe(function(e){l.trackEvent("nav_settings","theme",e)}),t.isHorizontal=e.isHorizontal,t.isVertical=e.isVertical,t.useEqualWidth=e.UseEqualWidths,t.isEqualWidthAllowed=i.computed(function(){return e.ButtonAlignment()!==e.buttonAlignments.stretch}),t.buttonAlignment=e.ButtonAlignment,t.buttonAlignment.subscribe(function(e){l.trackEvent("nav_settings","options","button_alignment_"+e)}),t.textAlignment=e.TextAlignment,t.textAlignment.subscribe(function(e){l.trackEvent("nav_settings","options","text_alignment_"+e)}),t.buttonAlignments=e.buttonAlignments,t.textAlignments=e.textAlignments,t.makeHorizontal=function(){return l.trackEvent("nav_settings","options","make_horizontal"),e.Orientation(e.orientations.horizontal),!1},t.makeVertical=function(){return l.trackEvent("nav_settings","options","make_vertical"),e.Orientation(e.orientations.vertical),!1},t.toggleEqualWidth=function(){return l.trackEvent("nav_settings","options","equal_width"),e.UseEqualWidths(!e.UseEqualWidths()),!1},t.styleProperties=e.styleProperties,t.showNavigationEditDialog=e.showNavigationEditDialog,t.captureEvent=function(){return!0},t.cssClassesLoaded=e.cssClassesLoaded}function f(e,t){function n(t,n){return r.coerceNumericValue(e,e[t],i.unwrap(e[t]),{defaultValue:n})}function a(){var e=[],t=0;return u.pages().forEach(function(n){n.isDeleted()||(M>t?(e.push(s.createNavItemModel(n.Id(),null,null)),t++):e.push(s.createNavItemModel(n.Id(),null,null,null,!1)))}),e}e.MenuFontFamily=e.MenuFontFamily||"",e.MenuFontSize=e.MenuFontSize||"",e.MenuBackgroundColor=e.MenuBackgroundColor||"",e.MenuColor=e.MenuColor||"",e.MenuActiveBackgroundColor=e.MenuActiveBackgroundColor||"",e.MenuActiveColor=e.MenuActiveColor||"",e.MenuHoverColor=e.MenuHoverColor||"",e.MenuHoverBackgroundColor=e.MenuHoverBackgroundColor||"",e.Orientation=n("Orientation",D.horizontal),e.ButtonAlignment=n("ButtonAlignment",I.stretch),e.TextAlignment=n("TextAlignment",A.center),e.UseEqualWidths=e.UseEqualWidths||!1,e.NavigateEnabled=void 0!==e.NavigateEnabled?e.NavigateEnabled:!0,v(e.NavItems),e.NavItems=e.NavItems||a(),t&&(e.Width="600px",e.Height="40px",e.CssClass="nav",e.Shared=!0)}function v(e){if(e){var t=i.toJS(e);if(t){var n,a,r,o,l=!1;for(o=0;o<t.length;o++)r=!1,n=t[o],a=i.unwrap(n.pageId),r=v(n.subItems),r&&(n.subItems=r),a&&!g.isValid(a)&&(a=g.toUuid(a),r=!0),r&&(t[o]=s.createNavItemModel(a,i.unwrap(n.title),i.unwrap(n.url),i.unwrap(n.subItems),i.unwrap(n.isActive)),l=!0);if(l){for(o=0;o<t.length;o++)t[o]=y(t[o]);i.isObservable(e)&&e(t)}return l&&t}}}function y(e){if(e){if(!i.isObservable(e.pageId)){if(e.subItems&&e.subItems.length)for(var t=0;t<e.subItems.length;t++)e.subItems[t]=y(e.subItems[t]);e=s.createNavItemModel(e.pageId,e.title,e.url,e.subItems,e.isActive)}return e}}function w(){this.i18Dict={HorizontalMenu:d.resources.Server__Horizontal_menu,VerticalMenu:d.resources.Server__Vertical_menu,ButtonAlignment:d.resources.Server__Button_alignment,TextAlignment:d.resources.Server__Text_alignment,EqualWidth:d.resources.Server__Equal_width,OptionsColon:d.resources.Server__Options_colon,Left:d.resources.Server__Left,Center:d.resources.Server__Center,Right:d.resources.Server__Right,Stretch:d.resources.Server__Stretch,ThemeColon:d.resources.Server__Theme_colon,Loading:d.resources.Loading,FontColon:d.resources.Server__Font_colon,TextColon:d.resources.Server__Text_colon,BackgroundColon:d.resources.Server__Background_colon,HoverColon:d.resources.Server__Hover_colon,SelectedColon:d.resources.Server__Selected_colon,EditMenu:d.resources.Server__Edit_menu,Resetnavigationstyle:d.resources.Server__ResetNavigationStyle}}function S(e,t){e.call(this,t),this.Styling.CalculateClassStyles(!1),this.Styling.BackgroundColor(!1),this.Styling.Border(!1),this.Styling.Shadow(!1),this.Styling.RoundedCorner(!1),this.Styling.Transparency(!1),this.Styling.Padding(!1),this.Styling.Size(!1),this.Styling.ShowBasicTabOnly(!0),this.Styling.AdvancedApplyToMobile(!1),this.Styling.ShowAdvancedTab(!1),this.stylePrefix="nav",this.NavigationPropertiesTestEnabled=i.observable("enabled"===p.getOption("navPropertiesEditor","disabled")),this.Title=d.resources.Navigation,this.SettingsTitle=d.resources.Navigation_Settings,m(this)}var k,x,C,T,E,P,D={horizontal:0,vertical:1},I={left:0,center:1,right:2,stretch:3},A={left:0,center:1,right:2},M=5,O=/^page:((?:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})|(?:\-?\d+))$/,L=/^-\d+$/,N=i.observable(!1),B="navigation";return{name:B,initModel:f,load:function(n,a){k=c.getDataModel(),x=k.config,E=i.toJS(x.FontSizes),E.unshift({fontSizeDisplay:d.resources.Client__Designer__Default,fontSize:"nil"}),P=i.toJS(x.FontList),P.unshift({fontName:d.resources.Client__Designer__Default,fontStyle:"nil"}),C=n,n.append(e).append(t),a(null,B)},createElementViewModel:function(e,t,n){return S.prototype=Object.create(e.prototype),new S(e,t,n)}}}),define("text!designer/app/builder/ui/canvas/elements/gallery/el.gallery.html",[],function(){return'<script type="text/html" id="wsb-canvas-template-gallery">\r\n	<div data-widget-content="true" data-bind="attr: { \'class\': CssClasses, style: Style() }">\r\n		<div class="wsb-media-gallery" data-bind="attr: { id: $data.mode + \'-\' + $data.ID() }">\r\n			<ul class="wsb-media-gallery-slider"></ul>\r\n		</div>\r\n	</div>\r\n</script>'}),define("text!designer/app/builder/ui/canvas/elements/gallery/mutator.gallery.html",[],function(){return"<script type=\"text/html\" id =\"mutator-template-element-gallery\">\r\n<!-- ko if: $data.Type() === 'gallery' && $data.mutatorViewModel -->\r\n<!-- ko with: mutatorViewModel -->\r\n<div class=\"wsb-canvas-mutator-inner\">\r\n    <div data-bind=\"mutatorElement: { name: 'slider', data: GallerySpeed, context: { title:i18Dict.SpeedColon, min: 1, max: 10, unit:i18Dict.Sec } }\"></div>\r\n    <div data-bind=\"mutatorElement: { name: 'select', data: GalleryTransition, context: { title:i18Dict.TransitionColon, options: [{name:i18Dict.None, id: 'None'}, {name:i18Dict.Fade, id: 'Fade'}, {name:i18Dict.Slide, id: 'Slide'}, {name:i18Dict.SlideVertically, id: 'Slide Vertically'}, {name:i18Dict.Stack, id: 'Stack'}, {name:i18Dict.StackVertically, id: 'Stack Vertically'}] } }\"></div>\r\n    <div data-bind=\"mutatorElement: { name: 'checkboxlist', data: [{value: GalleryAutoSize, name:i18Dict.AutoZoomToFit}, {value: GalleryCaption, name:i18Dict.ShowCaptions}, {value: GalleryAutoStart, name:i18Dict.StartAutomatically}], context: { title:i18Dict.OptionsColon } }\"></div>\r\n    <div data-bind=\"mutatorElement: { name: 'carousel', data: GalleryTheme, context: {\r\n        title: i18Dict.StyleColon,\r\n        optionTemplate: 'mutator-template-carousel-style',\r\n        optionValueProperty: 'value',\r\n        options: effects\r\n    } }\">\r\n    </div>\r\n    <div class=\"wsb-canvas-mutator-ctrl-outer clearfix\">\r\n        <a href=\"javascript:void(0);\" class=\"btn btn-inverse-grey wsb-add-images-btn\" data-bind=\"click: OpenChooser\"><i class=\"icon-img icon-wsb-white\"></i><span data-bind= \"text: i18Dict.AddSlashManagePhotos\"></span></a>\r\n    </div>\r\n</div>\r\n<!-- /ko -->\r\n<!-- /ko -->\r\n</script>\r\n"}),define("designer/app/builder/ui/controls/media/gallery/media.gallery",["designer/util/util.instances","designer/util/util.model","common/util/documentHelper","jquery"],function(e,t,n,i){function a(e,n){this.$element=e,this.$slider=i("."+r+"-slider",this.$element),this.model=new t(n),this.mode=this.model.get("mode"),this.source=this.model.get("source")||"default",this.loaded=this.subscriptions=[],this.timer=this.animating=this.paginationType=this.arrowsType=!1,this.$pagination=this.$paginationArrows=this.$arrows=this.$layout=this.$overlay=!1,this.preloadAmount=3,this.isInitializing=!0,this.init()}var r="wsb-media-gallery",o={None:!1,Default:"pagination",Thumbnail:"pagination-thumbs"},s={None:!1,Default:"bordered"},l={None:!1,Default:"arrows",Hover:"arrows-hover"},d=[{pagination:o.None,border:s.Default,arrows:l.Default},{pagination:o.Default,border:s.None,arrows:l.None},{pagination:o.Default,border:s.Default,arrows:l.Default},{pagination:o.Default,border:s.None,arrows:l.Default},{pagination:o.Thumbnail,border:s.None,arrows:l.Hover}],c={pagination:o.Default,border:s.Default,arrows:l.Default},u=function(e){return e<d.length?d[e]:c};a.prototype={init:function(){var e=this;if(this.model.isKO){var t=function(){e.refresh(),e.isInitializing&&(e.isInitializing=!1)};this.subscriptions.push(this.model.get("localizedAssets",!0).subscribe(function(){e.isInitializing=!0,t()}));var n=this.model.get("mutatorViewModel",!0);if(n)for(var i in n)this.model.ko.isObservable(n[i])&&this.subscriptions.push(n[i].subscribe(t))}this.refresh()},"goto":function(e,t){if(!this.animating&&this.assets[e]){var n=this;this.animating=!0,clearTimeout(this.timer),this.preloadFrom(e);var a=0,s=this.model.get("GalleryTransition"),l=this.$cur||!1;l&&(a=i("li",this.$slider).index(l));var d=i("li:eq("+e+")",this.$slider),c=!1;this.$cur?a===e&&(s="None"):(this.$cur=l=i("li:eq("+e+")",this.$slider),this.zindex=this.model.get("Layer"),c=!0,t="next");var p=this.zindex;t||(t=e>=a?"next":"prev");var g=function(){if(n.$cur=d,n.animating=!1,n.model.get("GalleryAutoStart")||!c&&"homefinder"!==n.source){var t,i=e+1,a=n.assets.length;i>=a&&(i=0,t="next"),n.timer=setTimeout(function(){n.goto(i,t)},1e3*(parseFloat(n.model.get("GallerySpeed"))||1))}};switch(u(n.model.get("GalleryTheme")).pagination!==o.None&&n.$pagination&&n.$pagination.length&&n.$pagination.trigger("paginate."+r,e),s){case"FirstTime":d.css("left",0).fadeIn("slow",function(){g()});break;case"None":d.css({left:0,"z-index":p+1}).show(),c||a===e||l.css("z-index",p).hide(),g();break;case"Fade":d.css({left:0,"z-index":p+1}).hide().fadeIn("slow",function(){g()}),c||l.fadeOut("slow");break;case"Slide":var h=l.width();c?d.css({left:"prev"===t?-h:h,"z-index":p+1}).show().animate({left:0},500,function(){g()}):(l.css("z-index",p),d.css({left:"prev"===t?-h:h,"z-index":p+1}).show().animate({left:0},{duration:500,queue:!1}),l.animate({left:"prev"===t?h:-h},500,function(){l.hide(),g()}));break;case"Slide Vertically":var m=l.height();c?d.css({top:"prev"===t?-m:m,left:0,"z-index":p+1}).show().animate({top:0},500,function(){g()}):(l.css("z-index",p),d.css({top:"prev"===t?-m:m,left:0,"z-index":p+1}).show().animate({top:0},{duration:500,queue:!1}),l.animate({top:"prev"===t?m:-m},500,function(){l.hide(),g()}));break;case"Stack":var h=l.width();c?d.css({left:"prev"===t?-h:h,"z-index":p+1}).show().animate({left:0},500,function(){g()}):(l.css("z-index",p),d.css({left:"prev"===t?-h:h,"z-index":p+1}).show().animate({left:0},{duration:500,queue:!1}),l.fadeOut(500,function(){g()}));break;case"Stack Vertically":var m=l.height();c?d.css({top:"prev"===t?-m:m,left:0,"z-index":p+1}).show().animate({top:0},500,function(){g()}):(l.css("z-index",p),d.css({top:"prev"===t?-m:m,left:0,"z-index":p+1}).show().animate({top:0},{duration:500,queue:!1}),l.fadeOut(500,function(){g()}))}}},refresh:function(){var e=this,t=this.assets=this.model.get("localizedAssets")||this.model.get("GalleryAssets"),n=this.model.get("GalleryTheme"),a=u(n),d=this.model.get("effects"),c=d?d[parseInt(n)]:!1,p=c&&c.className?c.className:!1;this.model.isKO&&!e.isInitializing&&this.model.set("className",p),this.loaded=[],this.animating=!0,clearTimeout(this.timer);var g=this.width=parseInt(this.model.get("Width").replace("px","")),h=this.model.get("Height");if("mobile"==this.mode){var m=this.$element.width(),b=m/g;1!=b&&(g=this.width=m,h=parseInt(h.replace("px",""))*b)}this.$element.css({height:h,width:g}),this.arrowsType=a.arrows,this.arrowsType===l.Default?(this.arrowsRefresh(),g=this.width=g-44,this.$slider.css("margin-left",22)):this.arrowsType===l.Hover?(this.arrowsRefresh(),this.$slider.css("margin-left",0)):(this.arrowsRemove(),this.$slider.css("margin-left",0)),a.border===s.Default?(this.$slider.addClass(s.Default),g=this.width=g-30):this.$slider.removeClass(s.Default),this.$cur=!1,this.$slider.empty().css("width",g);for(var f=0;f<t.length;f++)this.$slider.append(i('<li class="loading"/>').css({width:this.width,left:this.width})),this.loaded[f]=!1;if(this.paginationType=a.pagination,this.paginationType!==o.None?(this.paginationRefresh(),this.$slider.css("height",this.$element.height()-this.$pagination.outerHeight(!0))):(this.paginationRemove(),this.$slider.css("height",this.$element.height())),a.border===s.Default&&this.$slider.css("height",this.$slider.height()-30),this.arrowsType===l.Default?this.$arrows.css("top",(this.$slider.outerHeight(!0)-44)/2):this.arrowsType===l.Hover&&this.$arrows.height(this.$slider.outerHeight(!0)).css("z-index",this.model.get("Layer")+2),"designer"==this.mode){var v=this.zindex||this.model.get("Layer");this.$overlay&&this.$overlay.length||(this.$overlay=i("<div/>").addClass(r+"-overlay").appendTo(this.$element)),this.$overlay.css({position:"absolute",top:0,width:this.$element.outerWidth(),height:this.$element.outerHeight(),"z-index":v+2}).children().remove()}this.load(0,function(){e.animating=!1,e.goto(0)})},getAutofitCSS:function(e,t){var n,i=e.width(),a=e.height(),r=a/i,o=t.width(),s=t.height(),l=s/o,d=0,c=0,u=0;return 1>r?1>l&&r>l?d=o:n=s:r>1?l>1&&l>r?n=s:d=o:1>l?d=o:n=s,n?c=-(i*(n/a)-o)/2:u=-(a*(d/i)-s)/2,{width:d||"auto",height:n||"auto",left:c,top:u}},load:function(e,t){var a=this,s=this.assets[e];if(s&&!this.loaded[e]){this.loaded[e]=!0;var l=i("li:eq("+e+")",this.$slider);switch(s.type){case"video":break;case"image":default:var d=!1,c=!1,u=i("<img/>").bind("load",function(){var n=l.removeClass("loading");if(s.link){if(n=i("<a/>").attr({title:s.caption}).appendTo(l),s.link.search("window.wsb.gotoAddress")>=0){var p=s.link.match(/preview\/(?:desktop|mobile)\/(?:(?:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})|(?:\d+))/)[0];n.attr("href","#"),n.click(function(){window.wsb.gotoAddress(p)})}else n.attr("href",s.link);Boolean(s.link.match(/^((http|https|ftp|mailto):|\/\/)/i))&&n.attr("target","_blank")}if(u.appendTo(n),a.model.get("GalleryAutoSize"))u.css(a.getAutofitCSS(u.addClass("autosize"),l));else{var g=Math.floor((l.height()-u.height())/2);g>0&&u.css("marginTop",g)}d&&c&&(c.addClass("autosize").appendTo(i("<div/>").addClass(r+"-"+o.Thumbnail+"-thumbnail-wrapper").appendTo(d.removeClass("loading"))),c.css(a.getAutofitCSS(c,d))),a.model.get("GalleryCaption")&&s.caption&&n.append(i("<div/>").addClass(r+"-caption").css("width",a.width).text(s.caption)),i.isFunction(t)&&t(e),u.unbind("load")}),p=s.src||n.getDocumentUrl(s.id);u[0].src=p,a.paginationType&&a.paginationType==o.Thumbnail&&a.$pagination&&(d=i("li:eq("+e+")",a.$pagination),c=i("<img/>"),c[0].src=p)}}else i.isFunction(t)&&t(!1)},preloadFrom:function(e){for(var t=this.assets.length,n=e;n<e+this.preloadAmount;n++){var i=n;n>t&&(i=0+(t-n)),this.load(i)}for(var n=e;n>e-this.preloadAmount;n--){var i=n;0>n&&(i=t+n),this.load(i)}},paginationRefresh:function(){var e=this;if(this.paginationRemove(),this.$pagination=i("<ul/>").addClass(r+"-"+this.paginationType).appendTo(this.$element),this.paginationType===o.Thumbnail){var t=this.$pagination.wrap(i("<div/>").addClass(r+"-"+o.Thumbnail+"-wrapper")).parent(),n=i("<div/>").addClass(r+"-"+o.Thumbnail+"-left-arrow"),a=i("<div/>").addClass(r+"-"+o.Thumbnail+"-right-arrow");this.$paginationArrows=n.insertBefore(t).add(a.insertAfter(t));var s=t.width(),l=93,d=2,c=5,u=Math.floor(s/(l+2*d)),p=Math.min(Math.floor((s/u-l)/2),c),g=Math.ceil(u/2);this.preloadAmount=u;for(var h=this.assets.length,m=0;h>m;m++)this.paginationThumbCreate(m,p);var b=i("li:first",this.$pagination).outerWidth(!0),f=s-b*u;t.width(s-=f).css("left",(parseInt(t.css("left").replace("px",""))||0)+Math.floor(f/2)),this.$pagination.width((l+2*c)*h),h>1&&a.addClass("enabled"),this.$paginationArrows.bind("click",function(){var t=i(this);if(!e.animating&&t.hasClass("enabled")){var a,r=e.$cur?i("li",e.$slider).index(e.$cur):0;t.attr("class")==n.attr("class")?(a="prev",r--):(a="next",r++),1>r?r=0:r>=h-1&&(r=h-1),e.goto(r,a)}}),this.$pagination.bind("paginate."+r,function(t,r){i("li",e.$pagination).removeClass("active"),i("li:eq("+r+")",e.$pagination).addClass("active"),1>r?(n.removeClass("enabled"),h>1&&a.addClass("enabled")):r>=h-1?(a.removeClass("enabled"),h>1&&n.addClass("enabled")):(n.addClass("enabled"),a.addClass("enabled")),e.$pagination.animate({left:r>=g?-(b*(r+1-g)):0},500,function(){e.animating=!1})})}else{for(var m=0;m<this.assets.length;m++)this.paginationCreate(m);this.$pagination.bind("paginate."+r,function(t,n){i("li",e.$pagination).removeClass("active"),i("li:eq("+n+")",e.$pagination).addClass("active")})}},paginationCreate:function(e){var t=this;this.$pagination.append(i("<li/>").bind("click",function(){t.animating||t.goto(e)}))},paginationThumbCreate:function(e,t){var n=this;this.$pagination.append(i("<li/>").css({marginLeft:t,marginRight:t}).bind("click",function(){n.animating||n.goto(e)}))},paginationRemove:function(){this.$pagination&&this.$pagination.length&&(this.$pagination.children("li").unbind().remove(),this.$pagination.remove(),this.$paginationArrows&&this.$paginationArrows.length&&(this.$paginationArrows.unbind().remove(),this.$paginationArrows=!1),this.$pagination=!1)},arrowsRefresh:function(){this.arrowsRemove();var e=this,t=i("<div/>").addClass(r+"-"+this.arrowsType+"-left-arrow"),n=i("<div/>").addClass(r+"-"+this.arrowsType+"-right-arrow");this.$arrows=t.insertBefore(this.$slider).add(n.insertAfter(this.$slider)),this.$arrows.bind("click",function(){if(!e.animating){var n,a=i(this),r=e.$cur?i("li",e.$slider).index(e.$cur):0,o=e.assets.length;a.attr("class")==t.attr("class")?(n="prev",r--):(n="next",r++),0>r?r=o-1:r>=o&&(r=0),e.goto(r,n)}}),this.arrowsType===l.Hover&&this.$arrows.css("opacity",0).bind("mouseenter",function(){i(this).stop().fadeTo(100,1)}).bind("mouseleave",function(){i(this).stop().fadeTo(100,0)})},arrowsRemove:function(){this.$arrows&&this.$arrows.length&&(this.$arrows.unbind().remove(),this.$arrows=!1)},destroy:function(){for(var e in this.subscriptions)this.subscriptions[e].dispose();clearTimeout(this.timer),this.paginationRemove(),this.arrowsRemove(),p.destroy(this.$element),this.$element.remove()}};var p=new e(r,a);return{render:function(e,t){var n=p.get(e);return n?n.refresh():n=p.create(e,t),n},destroy:function(e){var t=p.get(e);return t?(p.destroy(e),!0):!1}}}),define("designer/app/builder/ui/canvas/elements/gallery/el.gallery",["text!designer/app/builder/ui/canvas/elements/gallery/el.gallery.html","text!designer/app/builder/ui/canvas/elements/gallery/mutator.gallery.html","jquery","knockout","designer/app/builder/ui/canvas/elements/helper","appconfig","common/stats/googleanalytics","common/abTesting/abTesting","/i18n/resources/client","designer/app/builder/ui/controls/media/gallery/media.gallery","designer/app/builder/ui/controls/media/manager/media.manager"],function(e,t,n,i,a,r,o,s,l,d,c){function u(e,t){e.call(this,t);var a,r,s=this;s.ko=i,s.wsb=h,s.isNew=m,s.mode="designer",s.Title=l.resources.Slideshow,s.SettingsTitle=l.resources.Slideshow_Settings,s.className=i.observable(s.CssClass()),s.className=i.computed({read:function(){return s.CssClass()},write:function(e){var t=s.CssClass();e||s.CssClass("default"),s.InitComplete()&&(null!==t.match(/customStyle/i)&&(e+=" customStyle"),s.CssClass(n.trim(e)))}}),s.minWidth=s.Width.Min(),s.minHeight=s.Height.Min(),s.effects=i.computed(function(){var e=n.grep(s.cssClasses(),function(e){return e.cssClass.indexOf("_")>0}),t=v.length;return n.each(e,function(e,n){n.value=t++,n.cssClass="wsb-media-gallery-theme-1",n.className="slideshow_"+n.name.toLowerCase()}),n.merge(n.merge([],v),e)}),s.localizedAssets=s.getLocalizedJsonProperty("GalleryAssets"),s.openChooser=function(e){"action"===e?o.trackEvent("general_settings","slidehow_add_manage_photos","icon"):o.trackEvent("slideshow_settings ","add_manage_photos","button"),g?g.openImages(s.localizedAssets(),function(e){n.isArray(e)&&(s.localizedAssets(e),s.isNew()&&s.isNew(!1))
}):(g=c,s.openChooser(e))},s.isActionMenuDisabled=function(){return!1};var u={text:l.resources.Server__Add_slash_Manage_Photos,tip:l.resources.Server__Add_slash_Manage_Photos,cssClass:"wsb-tool-Change",click:function(){s.openChooser("action")}};s.dblClick=function(){return o.trackEvent("wsb-designer-action-flyout","dblclick-gallery",b),y&&s.isNew()?s.openChooser("action"):s.showProperties(),!1},s.getActionMenuItems=i.computed(function(){var e=s.getCommands();return s.isLocalizedThemeMode()?[u]:[u,e.editProperties,e["delete"],e.layoutCommands]}),s.afterRender=function(e){a=n("#designer-"+s.ID()+".wsb-media-gallery"),r=d.render(a,s),n.isFunction(e)&&e(s)},s.onRemove=function(){r&&r.destroy(),s.isNew(!1)},s.onResized=function(){r&&r.refresh()},s.Height.subscribe(function(){Boolean(s.state().match(/^resize/i))||s.onResized()}),s.Width.subscribe(function(){Boolean(s.state().match(/^resize/i))||s.onResized()}),s.mutatorViewModel=new p(s),s.beforeResize=function(){var e=this.getDomElement().offset();s.getDomElement().children("div:first-child").css({opacity:"0.1",left:e.left+"px",top:e.top+"px",position:"fixed"})},s.afterResize=function(){s.getDomElement().children("div:first-child").css({opacity:"",left:"",top:"",position:""})}}function p(e){this.i18Dict={SpeedColon:l.resources.Server__Speed_colon,Sec:l.resources.Server__sec,TransitionColon:l.resources.Server__Transition_colon,None:l.resources.None,Fade:l.resources.Server__Fade,Slide:l.resources.Server__Slide,SlideVertically:l.resources.Server__Slide_Vertically,Stack:l.resources.Server__Stack,StackVertically:l.resources.Server__Stack_Vertically,AutoZoomToFit:l.resources.Server__Auto_zoom_to_fit,ShowCaptions:l.resources.Server__Show_captions,StartAutomatically:l.resources.Server__Start_automatically,OptionsColon:l.resources.Server__Options_colon,AddSlashManagePhotos:l.resources.Server__Add_slash_Manage_Photos,StyleColon:l.resources.Server__Style_colon},this.GalleryAutoStart=e.GalleryAutoStart,this.GalleryAutoStart.subscribe(function(e){o.trackEvent("slideshow_settings","autostart_"+(e?"on":"off"),"checkbox")}),this.GalleryCaption=e.GalleryCaption,this.GalleryCaption.subscribe(function(e){o.trackEvent("slideshow_settings","captions_"+(e?"on":"off"),"checkbox")}),this.GallerySpeed=e.GallerySpeed.extend({numericMinMax:{min:1,max:10}}),this.GalleryTheme=e.GalleryTheme,this.GalleryTransition=e.GalleryTransition,this.GalleryTransition.subscribe(function(e){o.trackEvent("slideshow_settings","transition",e)}),this.GalleryAutoSize=e.GalleryAutoSize,this.GalleryAutoSize.subscribe(function(e){o.trackEvent("slideshow_settings","zoomtofit_"+(e?"on":"off"),"checkbox")}),this.effects=e.effects,this.OpenChooser=function(){e.openChooser("properties")}}var g,h=!1,m=i.observable(!0),b="gallery",f=l.resources.Client__Designer__Caption_displays_here,v=[{name:"Theme 1",value:0,cssClass:"wsb-media-gallery-theme-1"},{name:"Theme 2",value:1,cssClass:"wsb-media-gallery-theme-2"},{name:"Theme 3",value:2,cssClass:"wsb-media-gallery-theme-3"},{name:"Theme 4",value:3,cssClass:"wsb-media-gallery-theme-4"},{name:"Theme 5",value:4,cssClass:"wsb-media-gallery-theme-5"}],y="enabled"===s.getOption("smartActions","disabled"),b="gallery";return{name:b,initModel:function(e,t){e.GalleryAutoStart=void 0!==e.GalleryAutoStart?e.GalleryAutoStart:!0,e.GalleryCaption=void 0!==e.GalleryCaption?e.GalleryCaption:!0,e.GalleryAutoSize=void 0!==e.GalleryAutoSize?e.GalleryAutoSize:t,e.GallerySpeed=a.coerceNumericValue(e,e.GallerySpeed,i.unwrap(e.GallerySpeed),{defaultValue:4}),e.GalleryTheme=e.GalleryTheme||0,e.GalleryTransition=e.GalleryTransition||"Fade",e.GalleryAssets=e.GalleryAssets||[{id:0,src:r.customerAmdPathRoot+"/images/beach.jpg",caption:f,link:"",type:"image"},{id:0,src:r.customerAmdPathRoot+"/images/fields.jpg",caption:f,link:"",type:"image"},{id:0,src:r.customerAmdPathRoot+"/images/folliage.jpg",caption:f,link:"",type:"image"}],t&&(e.Width="474px",e.Height="300px")},createElementViewModel:function(e,t){u.prototype=Object.create(e.prototype);var n=new u(e,t);return n},load:function(n,i){n.append(e).append(t),i(null,b)}}}),define("text!designer/app/builder/ui/canvas/elements/facebook/el.facebook.html",[],function(){return'<script type="text/html" id="wsb-canvas-template-facebook">\r\n    <div data-widget-content="true" data-bind="attr: { id: $data.mode + \'-\' + $data.ID(), style: Style, \'class\': \'wsb-social-facebook \' + CssClasses() }"></div>\r\n</script>\r\n<!-- Facebook Page Picker -->\r\n<script type="text/html" id="facebook-picker-template">\r\n    <div class="wsb-address-picker">\r\n        <h3 data-bind="text: i18Dict.Server__Select_facebook_page_colon"></h3>\r\n        <!-- ko if: isAuthorized() -->\r\n        <!-- ko if: facebookPages().length -->\r\n        <a class="wsb-address-picker-item" href="#" data-bind="text: i18Dict.Settings_Facebook_Page, attr: { title: facebookSavedUrl }, click: useFacebookPlaceHolder, clickBubble: false"></a>\r\n        <!-- ko foreach: facebookPages -->\r\n        <a class="wsb-address-picker-item" href="#" data-bind="text: $data.Name, attr: { title: $data.Name }, click: $parent.setFacebookPage, clickBubble: false"></a>\r\n        <!-- /ko -->\r\n        <!-- /ko -->\r\n        <!-- ko ifnot: facebookPages().length -->\r\n        <p>\r\n            <span data-bind="text: i18Dict.Server__You_dont_have_any_pages_for_people_to_like"></span>\r\n            <a href="https://www.facebook.com/business/build" target="_blank" data-bind="attr: {title: i18Dict[\'Server__Create_a_Facebook_page\']}, text: i18Dict[\'Server__Learn_more\']"></a>\r\n        </p>\r\n        <!-- /ko -->\r\n        <!-- /ko -->\r\n        <!-- ko ifnot: isAuthorized() -->\r\n        <div class="social-authorization">\r\n            <span data-bind="click: openAuthWindow" class="social-btn-facebook social-btn-connect">\r\n                <i class="icon-wsb-white icon-fb"></i>\r\n                <span data-bind="text: i18Dict.Server__Connect_to_Facebook"></span>\r\n            </span>\r\n        </div>\r\n        <!-- /ko -->\r\n    </div>\r\n</script>'}),define("text!designer/app/builder/ui/canvas/elements/facebook/mutator.facebook.html",[],function(){return"<script type=\"text/html\" id =\"mutator-template-element-facebook\">\r\n<!-- ko if: $data.Type() === 'facebook' && $data.mutatorViewModel -->\r\n<!-- ko with: mutatorViewModel -->\r\n<div class=\"wsb-canvas-mutator-inner\">\r\n    <div data-bind=\"mutatorElement: { \r\n        name: 'picker', \r\n        data: FacebookUrl, \r\n        context: { \r\n            title:i18Dict.UrlColon, \r\n            isPlaceholder: isMyFacebookPage, \r\n            placeholderText: facebookPlaceholderText,\r\n            placeholderCssClass: 'wsb-napsoc-placeholder',\r\n            placeholderTooltip: facebookSavedUrl,\r\n            flyoutTemplate: 'facebook-picker-template',\r\n            flyoutModel: $data,\r\n            normalize: facebookNormalizer\r\n        }\r\n    }\"></div>\r\n    <div data-bind=\"mutatorElement: { name: 'checkboxlist', data: [{value: FacebookStream, name:i18Dict.Stream}, {value: FacebookFaces, name:i18Dict.Faces}, {value: FacebookHeader, name:i18Dict.Header}], context: { title:i18Dict.ShowColon } }\"></div>\r\n</div>\r\n<!-- /ko -->\r\n<!-- /ko -->\r\n</script>"}),define("designer/social/facebook/social.facebook",["designer/util/util.instances","designer/util/util.model","appconfig","/i18n/resources/client","jquery","designer/util/facebookSDKHelper","wsbcore/overlay","wsbcore/growl"],function(e,t,n,i,a,r){function o(e,n){this.$element=e,this.model=new t(n),this.mode=this.model.get("mode"),this.subscriptions=[],this.mutatorViewModel={},this.init()}var s="wsb-social-facebook",l="[FACEBOOK_PAGE]",d="http://www.facebook.com/seeamazingplaces";o.prototype={init:function(){var e=this;if(this.model.isKO){var t=function(){e.refresh()},n=this.mutatorViewModel=this.model.get("mutatorViewModel",!0);if(n){var i=["FacebookUrl","FacebookStream","FacebookFaces","FacebookHeader","facebookSavedUrl"];for(var r in n)-1!==a.inArray(r,i)&&this.model.ko.isObservable(n[r])&&this.subscriptions.push(n[r].subscribe(t))}}this.refresh()},refresh:function(){var e=this,t=this.model.get("FacebookUrl");if(this.$element.find("div.iframe-protector").remove(),this.$element.find("div.fb-page").remove(),"designer"==this.mode){if(!this.mutatorViewModel.isValid())return void this.$element.sfMsgOverlay({message:i.resources.Social__Twitter__InvalidRequest,style:null});this.mutatorViewModel.isFacebookPlaceHolder()&&(t=this.mutatorViewModel.facebookSavedUrl(),t||(t=d))}else t==l&&(t=d);this.$element.sfMsgOverlay({message:i.resources.Loading});var n={Width:parseInt(this.model.get("Width").replace("px","")),Height:parseInt(this.model.get("Height").replace("px",""))},o={"class":"fb-page","data-href":t,"data-width":n.Width,"data-height":n.Height,"data-show-facepile":this.model.get("FacebookFaces"),"data-hide-cover":!1,"data-show-posts":this.model.get("FacebookStream"),"data-small-header":this.model.get("FacebookHeader"),"data-adapt-container-width":!0};r.setLocale(i.lang,i.region),r.likeBoxGenerator(this.$element,o,function(){e.$element.sfMsgOverlay({message:null}),e.$element.append(a("<div/>",{"class":"iframe-protector"}).css({width:n.Width,height:n.Height,position:"absolute",top:0,filter:"alpha(opacity = 0)",opacity:"0","background-color":"white"}))},function(){a("<div></div>").sfGrowl({title:i.resources.Client__Designer__Yikes_hit_a_snag,content:i.resources.Server__There_has_been_an_unexpected_error,icon:"error"})})},destroy:function(){for(var e in this.subscriptions)this.subscriptions[e].dispose();c.destroy(this.$element),this.$element.remove()}};var c=new e(s,o);return{render:function(e,t){var n=c.get(e);return n?n.refresh():n=c.create(e,t),n},destroy:function(e){var t=c.get(e);return t?(c.destroy(e),!0):!1}}}),define("designer/app/builder/ui/canvas/elements/facebook/el.facebook",["text!designer/app/builder/ui/canvas/elements/facebook/el.facebook.html","text!designer/app/builder/ui/canvas/elements/facebook/mutator.facebook.html","designer/social/facebook/social.facebook","knockout","designer/app/builder/data/data","common/social/oauth/social.oauth","/i18n/resources/client","designer/app/builder/ui/controls/mutator/mutator","jquery","common/stats/googleanalytics"],function(e,t,n,i,a,r,o,s,l,d){function c(){var e,t,a=this;a.ko=i,a.mode="designer",a.Title=o.resources.Facebook,a.SettingsTitle=o.resources.Facebook_Settings,a.getActionMenuItems=i.computed(function(){var e=a.getCommands();return[e.editProperties,e["delete"],e.layoutCommands]}),a.dblClick=function(){a.isLocalizedThemeMode()||a.showProperties()},a.afterRender=function(i){e=l("#designer-"+a.ID()+".wsb-social-facebook"),t=n.render(e,a),l.isFunction(i)&&i(a)},a.onRemove=function(){t&&t.destroy()},a.onResized=function(){t&&t.refresh()},a.Height.subscribe(function(){Boolean(a.state().match(/^resize/i))||a.onResized()}),a.Width.subscribe(function(){Boolean(a.state().match(/^resize/i))||a.onResized()}),a.buttonEnabled=i.observable(!0),a.toggleButton=function(e){void 0===e&&(e=!a.buttonEnabled()),s[e?"enableButton":"disableButton"](0),a.buttonEnabled(e)},a.isAuthorized=i.observable(m.isAuthorized()),m.bind("auth",function(){a.isAuthorized(!0),a.mutatorViewModel.refreshPages(!0)}).bind("unauth",function(){a.isAuthorized(!1),a.mutatorViewModel.facebookPages([])}),a.mutatorViewModel=new p(a),a.isAuthorized()&&a.mutatorViewModel.refreshPages()}function u(e,t){d.trackEvent("facebook_settings",e+"_"+(t?"on":"off"),"checkbox")}function p(e){this.i18Dict={UrlColon:o.resources.Server__Url_colon,ColorColon:o.resources.Server__Color_colon,LightTheme:o.resources.Server__Light_theme,DarkTheme:o.resources.Server__Dark_theme,Stream:o.resources.Server__Stream,Faces:o.resources.Server__Faces,Header:o.resources.Server__Header,ShowColon:o.resources.Server__Show_colon,Server__Select_facebook_page_colon:o.resources.Server__Select_facebook_page_colon,Server__You_dont_have_any_pages_for_people_to_like:o.resources.Server__You_dont_have_any_pages_for_people_to_like,Server__Connect_to_Facebook:o.resources.Server__Connect_to_Facebook,Settings_Facebook_Page:o.resources.Settings_Facebook_Page,Server__Create_a_Facebook_page:o.resources.Server__Create_a_Facebook_page,Server__Learn_more:o.resources.Server__Learn_more},this.FacebookStream=e.FacebookStream,this.FacebookStream.subscribe(function(e){u("stream",e)}),this.FacebookFaces=e.FacebookFaces,this.FacebookFaces.subscribe(function(e){u("faces",e)}),this.FacebookHeader=e.FacebookHeader,this.FacebookHeader.subscribe(function(e){u("header",e)});var t=this,n=i.observable(!0),a=i.observable(!0),r="(https?://)?(w{3}.)?facebook.com";this.FacebookUrl=e.FacebookUrl.extend({validation:{custom:[{message:f,test:function(e){return!!e}},{message:f,test:function(e){if(e===b)return a(!0),!0;var t=new RegExp(r,"i");return t.test(e)}},{message:o.resources.Client__Designer__Testing_URL,test:function(){return n()}},{message:f,test:function(){return a()}}]}}),this.FacebookUrlForAjax=i.computed(function(){return t.FacebookUrl()}).extend({throttle:{type:"throttle",delay:500}}),this.FacebookUrlForAjax.subscribe(function(e){n(!1),l.ajax({url:"/Facebook/DetectFacebookPageExistence?page_name="+e.replace(/(https?:\/\/)?(www\.)?facebook.com\//i,"").replace(/\?/,"/").split("/").shift().split("-").pop(),timeout:3e3,cache:!0,success:function(e){a("OK"===e?!0:!1)},error:function(){a(!1)},complete:function(){n(!0)}})}),t.isValid=i.computed(function(){return t.FacebookUrl.isValid()&&a()}),t.isValid.subscribe(function(n){t.toggleButton(n),n&&e.onResized()}),this.isAuthorized=e.isAuthorized,this.openAuthWindow=function(){d.trackEvent("facebook_settings","connect","button"),m.openAuthWindow()},this.removeAuth=function(){m.removeAuth()},this.facebookPages=i.observableArray([]),this.refreshPages=function(e){m.getPages(function(e){if(t.facebookPages.removeAll(),e&&e.length)for(var n in e)t.facebookPages.push({Name:e[n].Name,Link:e[n].Link})},e)},this.facebookSavedUrl=g.observables().FacebookUrl,this.isFacebookPlaceHolder=function(){return t.FacebookUrl()===b},this.facebookPlaceholderText=i.computed(function(){var e=t.FacebookUrl();if(e){if(e===b)return t.facebookSavedUrl()?o.resources.Settings_Facebook_Page:o.resources.Client__Designer__Settings_Facebook_Page_Not_Set;var n=t.facebookPages();for(var i in n)if(n[i].Link==e)return n[i].Name;return e.replace(/\/$/,"").split("/pages/").pop().split("facebook.com/").pop().split("/").shift()}return o.resources.Client__Designer__Facebook_Page_Not_Set}),this.useFacebookPlaceHolder=function(){return t.setFacebookPage(b)},this.setFacebookPage=function(n){return n&&(n.Link&&(n=n.Link),t.FacebookUrl(n),e.FacebookUrl.valueHasMutated()),!1},this.isMyFacebookPage=i.computed(function(){var e=t.FacebookUrl();if(!e)return!1;if(e===b)return!0;if(t.facebookPages().length){var n=t.facebookPages();for(var i in n)if(e===n[i].Link)return!0}return!1}),this.toggleButton=function(t){e.toggleButton(t)},this.facebookNormalizer=function(e){var t=e.value(),n=l.trim(t);n&&(n=encodeURI("https://www.facebook.com/"+n.replace(/^(https?:\/\/)?(www\.)?(facebook.com)?\/?/i,""))),n!==t&&e.value(n)}}var g,h="facebook",m=!1,b="[FACEBOOK_PAGE]",f=o.resources.Client__Designer__Enter_a_valid_Facebook_page;return{name:h,initModel:function(e,t){m=r("facebook"),e.FacebookUrl=e.FacebookUrl||b,e.FacebookStream=e.FacebookStream||!1,e.FacebookFaces=void 0!==e.FacebookFaces?e.FacebookFaces:!0,e.FacebookHeader=e.FacebookHeader||!1,t&&(e.Width="292px",e.Height="240px")},createElementViewModel:function(e,t){return c.prototype=new e(t),c.prototype.constructor=c,new c},load:function(n,i){g=a.getDataModel().napsoc,n.append(e).append(t),i(null,h)}}}),define("text!designer/app/builder/ui/canvas/elements/twitter/el.twitter.html",[],function(){return'<script type="text/html" id="wsb-canvas-template-twitter">\r\n    <div data-widget-content="true" data-bind="attr: { id: $data.mode + \'-\' + $data.ID(), style: Style, \'class\': \'wsb-social-twitter \' + CssClasses() }">\r\n        <div class="wsb-social-twitter-header">\r\n            <div class="wsb-social-twitter-title"></div>\r\n        </div>\r\n        <div class="wsb-social-twitter-feed">\r\n            <ul></ul>\r\n        </div>\r\n        <div class="wsb-social-twitter-footer">\r\n            <div></div>\r\n        </div>\r\n    </div>\r\n</script>'}),define("text!designer/app/builder/ui/canvas/elements/twitter/mutator.twitter.html",[],function(){return'<script type="text/html" id ="mutator-template-element-twitter">\r\n<!-- ko if: Type() === \'twitter\' -->\r\n<!-- ko with: mutatorViewModel -->\r\n<div class="wsb-canvas-mutator-inner">\r\n    <div class="wsb-canvas-mutator-ctrl-outer wsb-canvas-mutator-textbox clearfix">\r\n        <div class="wsb-canvas-mutator-ctrl-label wsb-twit-user-label" data-bind= "text: i18Dict.UsernameColon"></div>\r\n        <div class="wsb-canvas-mutator-ctrl-input wsb-twit-user-property clearfix">\r\n            @\r\n            <input type="text" data-bind="value: TwitterUsername, enable: TwitterFeedType() == 0,\r\n    css: \'wsb-text-box wsb-twitter-name-input wsb-redo-select\' + (((TwitterFeedType() == 0) && (!TwitterUsernameIsValid())) ? \' wsb-text-box-error\' : \'\')" /><br />\r\n            <label>&nbsp;&nbsp;&nbsp;&nbsp;</label><label class="wsb-text-box-error-text" data-bind="text: TwitterUsernameValidationMessage, visible: !TwitterUsernameIsValid() && TwitterFeedType() == 0"></label>\r\n        </div>\r\n    </div>\r\n\r\n    <div data-bind="mutatorElement: { name: \'radio\', data: TwitterFeedType, context: { title:i18Dict.FeedColon, group: \'TwitterFeedType\', options: [i18Dict.Server__By_Username, i18Dict.Server__By_Search] } }"></div>\r\n\r\n    <div class="wsb-canvas-mutator-ctrl-outer wsb-canvas-mutator-textbox clearfix">\r\n        <div class="wsb-canvas-mutator-ctrl-label wsb-twit-user-label" data-bind= "text: i18Dict.SearchColon"></div>\r\n        <div class="wsb-canvas-mutator-ctrl-input wsb-twit-user-property clearfix">\r\n            <input type="text" data-bind="value: TwitterSearchTerm, enable: TwitterFeedType() == 1,\r\n                css: \'wsb-text-box wsb-twitter-search-input wsb-redo-select\' + (((TwitterFeedType() == 1) && (TwitterSearchTerm.isValid && !TwitterSearchTerm.isValid())) ? \' wsb-text-box-error\' : \'\')" />\r\n            <div class="wsb-text-box-error-text" data-bind="text: TwitterSearchTerm.validationMessage(), visible: !TwitterSearchTerm.isValid() && TwitterFeedType() == 1"></div>\r\n        </div>\r\n    </div>\r\n    \r\n    <div class="wsb-canvas-mutator-ctrl-outer wsb-canvas-mutator-textbox clearfix">\r\n        <div class="wsb-canvas-mutator-ctrl-label wsb-twit-user-label" data-bind= "text: i18Dict.ShowColon"></div>\r\n        <div class="wsb-canvas-mutator-ctrl-input wsb-twit-user-property clearfix">\r\n            <input type="text" data-bind="value: TwitterTweetCount,\r\n                css: \'wsb-text-box wsb-twitter-show-input wsb-redo-select\' + ((TwitterTweetCount && TwitterTweetCount.isValid && !TwitterTweetCount.isValid()) ? \' wsb-text-box-error\' : \'\')" />\r\n            <div class="wsb-text-box-error-text" data-bind="text: TwitterTweetCount.validationMessage(), visible: !TwitterTweetCount.isValid()"></div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<!-- /ko -->\r\n<!-- /ko -->\r\n</script>'}),define("designer/social/twitter/social.twitter",["designer/util/util.instances","designer/util/util.model","jquery","wsbcore/helper"],function(e,t,n,i){function a(e,n){this.$element=e,this.model=new t(n),this.mode=this.model.get("mode"),this.subscriptions=[],this.hasError=!1,this.i18N=this.model.get("i18N"),this.init()}var r="wsb-social-twitter",o=!1;i.require(["js!//platform.twitter.com/widgets"],n.noop,function(){o=!0}),a.prototype={init:function(){var e=this;if(this.$header=n("."+r+"-header",this.$element),this.$feed=n("."+r+"-feed",this.$element),this.$ul=n("ul",this.$feed),this.$footer=n("."+r+"-footer",this.$element),this.model.isKO){var t=function(){e.refresh()},i=this.mutatorViewModel=this.model.get("mutatorViewModel",!0);if(i)for(var a in i)this.model.ko.isObservable(i[a])&&this.subscriptions.push(i[a].subscribe(t))}if(!window.twttr){var o={_e:[],ready:function(e){o._e.push(e)}};window.twttr=o}"designer"===this.mode?require(["wsbcore/overlay"],function(){e.refresh()}):this.refresh()},refresh:function(){var e,t=this;if(this.$ul.empty(),this.$header.children().not("."+r+"-title").remove(),n("."+r+"-title",this.$header).text(""),"designer"===this.mode){if(this.$element.sfMsgOverlay({message:this.i18N.resources.Loading}),!this.model.get("isAuthorized"))return this.onError();if(e=this.getData(),!e)return this.onError()}else if(e=this.getData(),!e)return this.destroy();n.ajax({url:this.model.get("ajaxUrl"),data:e,cache:!1,dataType:"json",success:function(e){e&&"success"===e.status?t.onSuccess(e.data):t.onError(e)},error:function(){t.onError()}}),this.updateDisplay()},updateDisplay:function(e){if(("designer"!==this.mode||this.$element.first().is(":visible"))&&(this.$feed.height(this.$element.height()-this.$header.outerHeight(!0)-this.$footer.outerHeight(!0)),"designer"===this.mode))if(this.$overlay&&this.$overlay.length||(this.$overlay=n("<div/>").addClass(r+"-overlay").appendTo(this.$element)),this.$overlay.css({filter:"alpha(opacity = 0)","background-color":"transparent"}).children().remove(),this.hasError||e){var t=this;this.hasError=!0,this.$element.addClass("hasError").sfMsgOverlay({message:null,style:null}),this.$connectButton||(this.$connectButton=n("<div/>").addClass("social-authorization").append(n("<div/>").addClass("wsb-twitter-yikes").html(this.i18N.resources.Yikes)).append(n("<span/>").addClass("social-btn-twitter social-btn-connect").append(n("<i/>").addClass("icon-wsb-white icon-twitter")).append(this.i18N.resources.Social__Twitter__ConnectToTwitter)).append(n("<div/>").addClass("social-authorization-message").html(this.i18N.resources.Social__Twitter__MustAuthorize)));var i=this.$connectButton.clone().appendTo(this.$overlay);e&&e.constructor===String&&n(".social-authorization-message",i).prepend(n("<p/>").addClass("social-error").text(e)),i.css("top",(this.$overlay.height()-i.outerHeight())/2).find(".social-btn-twitter").bind("click",function(){t.mutatorViewModel.openAuthWindow()})}else this.$element.removeClass("hasError")},getData:function(){var e=0===this.model.get("TwitterFeedType")?"user":"search",t=this.model.get("TwitterTweetCount"),n={};switch(this.mode){case"designer":case"preview":case"mobilepreview":if(n={websiteId:this.model.get("websiteId"),count:t},"user"===e){if(n.username=this.model.get("TwitterUsername"),!n.username)return!1}else if(n.query=this.model.get("TwitterSearchTerm"),!n.query)return!1;break;case"publish":case"mobilepublish":n={action:e,options:{value:this.model.get("user"===e?"TwitterUsername":"TwitterSearchTerm"),limit:t}}}return n},onSuccess:function(e){var t=n.isArray(e)?e:e.statuses;this.createButtons();for(var i in t)this.createTweet(t[i]);"designer"===this.mode&&(this.mutatorViewModel.toggleButton(!0),this.$element.sfMsgOverlay({message:null}))},onError:function(e){if("designer"===this.mode)switch(this.mutatorViewModel.toggleButton(!1),parseInt(e&&e.code?e.code:0)){case 401:this.mutatorViewModel.removeAuth(),this.updateDisplay(this.i18N.resources.Social__Twitter__PleaseReconnect);break;case 403:case 429:case 500:case 502:case 503:case 504:this.mutatorViewModel.removeAuth(),this.updateDisplay(this.i18N.resources.Social__Twitter__ErrorConnecting);break;case 400:case 404:case 406:this.$element.sfMsgOverlay({message:this.i18N.resources.Social__Twitter__InvalidRequest,style:null}),this.hasError=!1,this.updateDisplay();break;default:this.model.get("isAuthorized")?this.$element.sfMsgOverlay({message:null,style:null}):this.hasError=!0,this.updateDisplay()}else this.destroy()},createTweet:function(e){var t=n("<li/>").appendTo(this.$ul),i=this.normalizeFeed(e);t.append(n("<a/>").addClass("tweet-time").attr({href:i.feedUrl,target:"_blank"}).append(n("<time/>").attr("title",i.timePosted).text(i.timeString))),t.append(n("<div/>").addClass("tweet-author").append(n("<a/>").attr({href:i.profileUrl,target:"_blank"}).append(n("<img/>").addClass("tweet-avatar").attr("src",i.profileImg)).append(n("<span/>").addClass("tweet-user").append(n("<span/>").text(i.userName))).append(n("<span/>").addClass("tweet-nick").text("@").append(n("<span/>").text(i.screenName))))),t.append(n("<div/>").addClass("tweet-text").append(i.$tweet))},createButtons:function(){if(this.$header.find(".twitter-share-button").remove(),n("<a/>").addClass("twitter-share-button").attr({href:"https://twitter.com/share","data-text":this.i18N.resources.Social__Twitter__CheckOutSite,"data-count":"none"}).text("Tweet").css("margin-bottom",5).appendTo(this.$header),0===this.model.get("TwitterFeedType")){this.$header.find(".twitter-follow-button").remove();var e=this.model.get("TwitterUsername");n("<a/>").addClass("twitter-follow-button").attr({href:"https://twitter.com/"+e,"data-show-count":"false"}).text(this.i18N.resources.Social__Twitter__Follow.sfFormat("@"+e)).appendTo(this.$header),n("."+r+"-title",this.$header).text("@"+e)}if(o)this.hasError=!1,this.updateDisplay();else{var t=this;window.twttr.ready(function(){window.twttr.widgets.load(),t.hasError=!1,t.updateDisplay()})}},normalizeFeed:function(e){var t=Boolean(location.protocol.match(/https/)),i=e.retweeted_status,a=null;i&&(a=e,e=e.retweeted_status);var r=this.formatTweet(e),o=n("<p/>").html(r.tweet);if(r.media.length){var s=n("<div/>").addClass("tweet-media");for(var l in r.media){var d=r.media[l];s.append(n("<a/>").addClass("tweet-media-link").attr({href:d.url,title:d.expanded_url,target:"_blank"}).append(n("<img/>").attr("src",(t?d.media_url_https:d.media_url)+":thumb")))}o.after(s)}i&&a&&o.after(n("<div/>").addClass("tweet-retweet").text(this.i18N.resources.Client__Retweeted_by+" ").append(n("<a/>").attr({title:this.i18N.resources.Social__Twitter__OnTwitter.sfFormat("@"+a.user.screen_name),href:"https://twitter.com/"+a.user.screen_name,target:"_blank"}).text(a.user.name)));var c=e.user.screen_name,u="https://twitter.com/"+c;return{userName:e.user.name,screenName:c,profileUrl:u,profileImg:e.user.profile_image_url.replace(/^https+\:/,""),feedUrl:u+"/statuses/"+e.id_str,timePosted:this.i18N.resources.Client__Time_posted.sfFormat(this.formatTimeStamp(e.created_at)),timeString:this.formatTimeText(e.created_at),$tweet:o}},getDate:function(e){return new Date(/msie|trident/i.test(navigator.userAgent)?e.replace(/( \+)/," UTC$1"):e)},formatTweet:function(e){var t=function(e){var t=[];for(var n in e.entities){var i=e.entities[n];if(i.length)for(var a in i.reverse()){var r=i[a].indices[0],o={type:n,obj:i[a]};if(t.length){if(r>t[0].obj.indices[0])t.unshift(o);else if(1===t.length||r<t[t.length-1].obj.indices[0])t.push(o);else for(var s in t)if(r>t[s].obj.indices[0]){t.splice(s,0,o);break}}else t.push(o)}}return t},n=t(e),i=e.text,a=[];if(n.length)for(var r in n){var o=n[r];switch(o.type){case"hashtags":i=i.substring(0,o.obj.indices[0])+i.substring(o.obj.indices[0]).replace("#"+o.obj.text,'<a class="tweet-hash" title="'+this.i18N.resources.Client__Search_on_Twitter.sfFormat(o.obj.text)+'" href="https://twitter.com/search?q=%23'+encodeURIComponent(o.obj.text)+'&src=hash" target="_blank">#<span>'+o.obj.text+"</span></a>","i");break;case"user_mentions":i=i.substring(0,o.obj.indices[0])+i.substring(o.obj.indices[0]).replace("@"+o.obj.screen_name,'<a class="tweet-mention" title="@'+o.obj.name+' on Twitter" href="https://twitter.com/'+o.obj.screen_name+'" target="_blank">@<span>'+o.obj.screen_name+"</span></a>","i");break;case"media":"photo"===o.obj.type&&a.push(o.obj);case"urls":i=i.substring(0,o.obj.indices[0])+i.substring(o.obj.indices[0]).replace(o.obj.url,'<a class="tweet-'+("media"===o.type?"media-link":"link")+'" title="'+o.obj.expanded_url+'" href="'+o.obj.url+'" target="_blank">'+o.obj.display_url+"</a>","i")}}return{tweet:i,media:a}},formatTimeStamp:function(e){return this.getDate(e).toLocaleString()},formatTimeText:function(e){var t=this.i18N.abbreviatedMonthNames,n=this.getDate(e),i=new Date-n,a=1e3,r=60*a,o=60*r,s=24*o;if(!isNaN(i)&&i>=0){if(2*a>i)return this.i18N.resources.Client__now;if(r>i)return Math.floor(i/a)+"s";if(o>i)return Math.floor(i/r)+"m";if(s>i)return Math.floor(i/o)+"h";if(i>s&&2*s>i)return this.i18N.resources.Client__yesterday;if(365*s>i)return("0"+n.getDate()).slice(-2)+" "+t[n.getMonth()]}return("0"+n.getDate()).slice(-2)+" "+t[n.getMonth()]+" "+n.getFullYear()},destroy:function(){for(var e in this.subscriptions)this.subscriptions[e].dispose();s.destroy(this.$element),this.$element.remove()}};var s=new e(r,a);return{render:function(e,t){var n=s.get(e);return n?n.refresh():n=s.create(e,t),n},destroy:function(e){var t=s.get(e);return t?(s.destroy(e),!0):!1}}}),define("designer/app/builder/ui/canvas/elements/twitter/el.twitter",["text!designer/app/builder/ui/canvas/elements/twitter/el.twitter.html","text!designer/app/builder/ui/canvas/elements/twitter/mutator.twitter.html","designer/social/twitter/social.twitter","jquery","knockout","designer/app/builder/ui/canvas/elements/helper","common/social/oauth/social.oauth","common/persistence/persistence","/i18n/resources/client","userData","designer/app/builder/ui/controls/mutator/mutator","common/stats/googleanalytics"],function(e,t,n,i,a,r,o,s,l,d,c,u){function p(e,t){e.call(this,t);var r,o,s=this;s.i18N=l,s.ko=a,s.wsb=h,s.mode="designer",s.Title=l.resources.Twitter,s.SettingsTitle=l.resources.Social__Twitter__Settings,s.websiteId=d.websiteId,s.getActionMenuItems=a.computed(function(){var e=s.getCommands();return[{text:l.resources.Settings,tip:l.resources.Settings,cssClass:"wsb-tool-Edit",enabled:s.isAuthorized,click:function(){u.trackEvent("general_settings_modal","settings","twitter"),s.dblClick()}},e["delete"],e.layoutCommands]}),s.dblClick=function(){s.isAuthorized()&&!s.isLocalizedThemeMode()&&s.showProperties()},s.afterRender=function(e){r=i("#designer-"+s.ID()+".wsb-social-twitter"),o=n.render(r,s),i.isFunction(e)&&e(s)},s.onRemove=function(){o&&o.destroy()},s.onResized=function(){o&&o.updateDisplay()},s.minWidth=s.Width.Min(),s.minHeight=s.Height.Min(),s.Height.subscribe(function(){Boolean(s.state().match(/^resize/i))||s.onResized()}),s.Width.subscribe(function(){Boolean(s.state().match(/^resize/i))||s.onResized()}),s.getUsername=function(e){s.TwitterUsername()||b.getUsername(function(e){e?s.TwitterUsername(e):b.removeAuth()},e===!0)},b.bind("auth",function(){s.isAuthorized(!0),s.getUsername(!0)}).bind("unauth",function(){s.isAuthorized(!1)}),s.ajaxUrl=a.computed(function(){return"//"+window.location.host+(s.TwitterFeedType()==f?b.settings.ajaxUrls.timeline:b.settings.ajaxUrls.search)}),s.mutatorViewModel=new g(s),s.isAuthorized()?s.getUsername():b.removeAuth()}function g(e){this.i18Dict={FeedColon:l.resources.Server__Feed_colon,UsernameColon:l.resources.Server__Username_colon,SearchColon:l.resources.Server__Search_colon,ShowColon:l.resources.Server__Show_colon,Server__By_Username:l.resources.Server__By_Username,Server__By_Search:l.resources.Server__By_Search};var t=this;this.TwitterSearchTermKeyPressed=!1,this.TwitterFeedType=e.TwitterFeedType,this.TwitterFeedType.subscribe(function(e){var t="feed_by_"+(e?"username":"search");u.trackEvent("twitter_settings",t,"radio")}),this.TwitterUsername=e.TwitterUsername,this.TwitterUsernameValidationMessage=a.observable(l.resources.Social__Twitter__EnterValidUsername),this.TwitterUsernameIsValid=a.observable(!0),this.TwitterUsername.subscribe(function(e){e.length>0&&t.TwitterFeedType()==f?t.validateTwitterUsername(e):t.TwitterUsernameIsValid(!1)}),this.validateTwitterUsername=function(e){0===e.length?t.TwitterUsernameIsValid(!1):s.Get(y.replace("{screenName}",e),function(e){t.TwitterUsernameIsValid("200"==e.statusCode?!0:!1)})},this.TwitterSearchTerm=e.TwitterSearchTerm.extend({validation:{custom:[{message:l.resources.Client__Designer__Enter_a_search_term,test:function(e){return t.TwitterSearchTermKeyPressed?e&&e.length:!0
}},{message:l.resources.Client__Designer__Enter_a_search_term,test:function(e){return e.length>0||t.TwitterSearchTermKeyPressed?t.TwitterFeedType()==v?(t.TwitterSearchTermKeyPressed=!0,e&&e.length):!0:!0}}]}}),this.TwitterTweetCount=e.TwitterTweetCount.extend({validation:{custom:[{message:l.resources.Client__Designer__Enter_a_number,test:function(e){return e>0?0/0==parseInt(e)?!1:!0:!1}}]}}),this.isAuthorized=e.isAuthorized,this.openAuthWindow=function(){b.openAuthWindow()},this.removeAuth=function(){b.removeAuth()},this.toggleButton=function(e){c[e?"enableButton":"disableButton"](0)},this.validateTwitterUsername(this.TwitterUsername(),this.TwitterUsernameValid)}var h=!1,m="twitter",b=!1,f=0,v=1,y="/SocialMediaAuth/TwitterVerifyScreenName/?websiteId={websiteId}&screenName={screenName}";return{name:m,initModel:function(e,t){function n(t,n){return r.coerceNumericValue(e,e[t],a.unwrap(e[t]),{defaultValue:n})}b=o("twitter"),e.TwitterFeedType=n("TwitterFeedType",f),e.TwitterTweetCount=n("TwitterTweetCount",5),e.TwitterUsername=e.TwitterUsername||"",e.TwitterSearchTerm=e.TwitterSearchTerm||"",e.isAuthorized=e.isAuthorized||b.isAuthorized(),t&&(e.Width="335px",e.Height="500px")},createElementViewModel:function(e,t){return p.prototype=Object.create(e.prototype),new p(e,t)},load:function(n,i){n.append(e).append(t),i(null,"twitter")}}}),define("text!designer/app/builder/ui/canvas/elements/blog/el.blog.html",[],function(){return'<script type="text/html" id="wsb-canvas-template-blog">\r\n    <div data-widget-content="true" data-bind="attr: { id: $data.mode + \'-\' + $data.ID(), style: Style, \'class\': CssClasses }">\r\n    </div>\r\n</script>'}),define("text!designer/app/builder/ui/canvas/elements/blog/mutator.blog.html",[],function(){return'<script type="text/html" id ="mutator-template-element-blog">\r\n\r\n<!-- ko if: $data.Type() === \'blog\' -->\r\n<!-- ko with: mutatorViewModel -->\r\n<div class="wsb-canvas-mutator-inner">\r\n    <div class="wsb-canvas-mutator-ctrl-outer wsb-blog-url-properties clearfix">\r\n        <div class="wsb-canvas-mutator-ctrl-label wsb-btn-label"  data-bind= "text: i18Dict.BlogOrRssFeedColon"></div>\r\n        <div class="wsb-canvas-mutator-ctrl-input wsb-btn-label-property clearfix">\r\n            <input id="txtBlogUrl" class="wsb-text-box blog-properties-txt-width" type="text"\r\n                   data-bind="value: BlogUrl, event: {change: urlChanged}" />\r\n            <!-- ko ifnot: isBlogValid -->\r\n            <label \r\n                id="urlErrorMessage" \r\n                class="text-error wsb-block-label"><span data-bind= "text: i18Dict.BlogErrorMessage"></span>  <a href="/help/article/4765" target="_blank" data-bind= "    text: i18Dict.LearnMore"></a>\r\n            </label>\r\n            <!-- /ko -->\r\n        </div>\r\n    </div>\r\n    \r\n    <div class="wsb-blog-listing-per-pg" data-bind="mutatorElement: { name: \'slider\', data: BlogListingsPerPage,    context: { title:i18Dict.BlogNumberOfListingsColon, min: 1, max: 10, unit: \'\' } }"></div>\r\n    \r\n    <div data-bind="mutatorElement: { name: \'checkboxlist\', data: [{ value: ShowBlogImages, name:i18Dict.BlogShowImages }, { value: ShowBlogCategories, name:i18Dict.BlogShowCategories }], context: { title:i18Dict.OptionsColon } }"></div>\r\n\r\n    <div class="wsb-canvas-mutator-ctrl-outer wsb-blog-url-properties clearfix">\r\n        <div class="wsb-canvas-mutator-ctrl-label wsb-btn-label"  data-bind= "text: i18Dict.LayoutColon"></div>\r\n        <div class="wsb-canvas-mutator-ctrl-input wsb-btn-label-property clearfix">\r\n            <div data-bind="css: BlogLayout1Class, click: BlogSelectLayout1 "></div>\r\n            <div data-bind="css: BlogLayout2Class, click: BlogSelectLayout2"></div>\r\n        </div>\r\n    </div>\r\n    <div class="clearfix"></div>\r\n</div>\r\n<!-- /ko -->\r\n<!-- /ko -->\r\n</script>'}),define("designer/util/blogUrlHelper",[],function(){function e(e){var t=e.replace(/http[s]?:\/\/(www.)?/,"http://").toLowerCase(),n={url:t,blogType:"other"},i=t.match(/tumblr.com(\/blog)?/);if(i)return n.blogType="tumblr",n.url=i[1]?"http://"+t.substring(23)+".tumblr.com/rss":t+"/rss",n;var a=t.indexOf("blogspot.com");return a>-1?(n.blogType="blogger",n.url=t.substring(0,a+12)+"/feeds/posts/default",n):n}return{getCustomUrl:e}}),define("designer/app/builder/ui/controls/blog/blog",["designer/util/util.instances","designer/util/util.model","jquery","designer/util/blogUrlHelper","wsbcore/share","wsbcore/overlay"],function(e,t,n,i){function a(e,n){this.$element=e,this.model=new t(n),this.mode=this.model.get("mode"),this.i18N=this.model.get("i18N"),this.init()}function r(e){var t=/<img[^>]+>/i,i=n('<a href="'+e.link+'" target="_blank" class="wsb-blog-vert-image">'),a=t.exec(e.content);return a&&i.append(a[0]),i}function o(e){var t=/<img[^>]+>/i,i=n('<a href="'+e.link+'" target="_blank" class="wsb-blog-horz-image">'),a=t.exec(e.content);return a?(i.append(a[0]),i):null}function s(e){return e=e.replace(/http[s]?:\/\//,"http://").toLowerCase(),"http://"+e.match(/:\/\/(.[^/]+)/)[1]}var l,d,c="wsb-blog",u="ui-blog",p=!1,g=!1,h=[];window.googleAPILoaded=function(){for(p=!0,g=!1;h.length>0;){var e=h.shift();google.load("feeds","1",{callback:e})}},a.prototype={init:function(){this.refresh()},initializeGoogleFeeds:function(e){p||"object"==typeof google&&"object"==typeof google.feeds?(p=!0,e()):g?h.push(e):(h.push(e),g=!0,require(["//www.google.com/jsapi?sensor=false&key=AIzaSyAsaQtr02Mt5fQigviYgmIy37VP-hcO9TU&callback=googleAPILoaded"]))},refresh:function(){var e=[];d=this.$element,d.empty();var t,a=this.model.get("BlogPageLayoutId"),r=this,o=r.model.get("ID");d.addClass(u),"designer"==this.mode&&(this.$overlay&&this.$overlay.length||(this.$overlay=n("<div/>").addClass(c+"-overlay")),this.$overlay.css({filter:"alpha(opacity = 0)"}).children().remove(),this.$overlay.appendTo(this.$element)),d.find("#"+o+" .blogContainer").length?(t=n("#"+o+" .blogContainer"),t.empty()):(t=n('<div class="wsb-blog-container blogContainer" style="height: '+r.model.get("Height")+'">'),d.append(t)),t.sfMsgOverlay({message:r.i18N.resources.Loading});var s=function(){var n=i.getCustomUrl(r.model.get("BlogUrl")),o=n.url;l=n.blogType;var s=new google.feeds.Feed(o),d=r.model.get("BlogListingsPerPage"),c=r.model.get("ShowBlogImages"),u=r.model.get("ShowBlogCategories");s.setNumEntries(d),s.includeHistoricalEntries(),s.load(function(n){var i=n.error?"":n.feed.entries;if(t.sfMsgOverlay({message:null}),""==i)t.append("<div id='nofeeds'>"+r.i18N.resources.Client__No_entries_to_display+"</div>");else{for(var o=0;o<i.length;o++)e[o]=i[o];r.renderFeedEntries(e,a,c,u,t)}})};this.initializeGoogleFeeds(s)},destroy:function(){m.destroy(this.$element),this.$element.remove()},renderFeedEntries:function(e,t,i,a,d){var c,u=this;if(1==t)for(var p=0;p<e.length;p++){var g=n('<div class="wsb-blog-text-vert-wrap">');if(1==i)var h=r(e[p]);if(g.append('<div class="wsb-blog-post-header"><a href="'+e[p].link+'" target="_blank">'+e[p].title+"</a></div>"),e[p].publishedDate&&(c=new Date(e[p].publishedDate),g.append('<p id="wsb-blog-publish-date">'+c.toLocaleString()+"</p>")),1==a)for(var m=0;m<e[p].categories.length;m++)switch(l){case"tumblr":g.append((m>0?", ":"")+'<a class="wsb-blog-category" href="'+s(u.model.get("BlogUrl"))+"/tagged/"+e[p].categories[m]+'" target="_blank">'+e[p].categories[m]+"</a>");break;case"blogger":g.append((m>0?", ":"")+'<a class="wsb-blog-category" href="'+s(u.model.get("BlogUrl"))+"/search/label/"+e[p].categories[m]+'" target="_blank">'+e[p].categories[m]+"</a>")}g.append('<div class="wsb-blog-entry-text"><a href="'+e[p].link+'" target="_blank">'+e[p].contentSnippet+"</a></div>"),n('<div class="wsb-blog-vert-entry-wrap"></div>').append(h).append(g).appendTo(d)}else{var b=n("<ul class='wsb-blog-horz-wrap'>");d.append(b);for(var f=0;f<e.length;f++){var v=n("<li>");if(b.append(v),1==i){var y=o(e[f]);y&&v.append(y)}else v.css({height:"250px"});if(v.append('<h3 class="wsb-blog-post-header"><a href="'+e[f].link+'" target="_blank">'+e[f].title+"</a></div>"),e[f].publishedDate&&(c=new Date(e[f].publishedDate),v.append('<p id="wsb-blog-publish-date">'+c.toLocaleString()+"</p>")),1==a)for(var _=0;_<e[f].categories.length;_++)switch(l){case"tumblr":v.append((_>0?", ":"")+'<a class="wsb-blog-category" href="'+s(u.model.get("BlogUrl"))+"/tagged/"+e[f].categories[_]+'" target="_blank">'+e[f].categories[_]+"</a>");break;case"blogger":v.append((_>0?", ":"")+'<a class="wsb-blog-category" href="'+s(u.model.get("BlogUrl"))+"/search/label/"+e[f].categories[_]+'" target="_blank">'+e[f].categories[_]+"</a>")}v.append('<div class="wsb-blog-entry-text"><a href="'+e[f].link+'" target=_blank >'+e[f].contentSnippet+"</a></div>")}}}};var m=new e(c,a);return{render:function(e,t){var n=m.get(e);return n?n.refresh():n=m.create(e,t),n},destroy:function(e){var t=m.get(e);return t?(m.destroy(e),!0):!1}}}),define("designer/app/builder/ui/canvas/elements/blog/el.blog",["text!designer/app/builder/ui/canvas/elements/blog/el.blog.html","text!designer/app/builder/ui/canvas/elements/blog/mutator.blog.html","jquery","knockout","designer/app/builder/ui/canvas/elements/helper","designer/app/builder/data/data","common/logger/logger","common/stats/googleanalytics","/i18n/resources/client","designer/app/builder/ui/controls/mutator/mutator","designer/app/builder/ui/controls/blog/blog","designer/util/blogUrlHelper"],function(e,t,n,i,a,r,o,s,l,d,c,u){function p(){var e,t,a=this;a.ko=i,a.isNew=f,a.mode="designer",a.publishPreview=!1,a.editMode=!0,a.hasChanged=i.observable(!1),a.isBlogValid=i.observable(!0),a.i18N=l,a.Title=l.resources.Client__Blog_Title,a.SettingsTitle=l.resources.Blog_Settings,a.initializeGoogleFeeds=function(e){h||"object"==typeof window.google&&"object"==typeof window.google.feeds?(h=!0,e()):m?v.push(e):(v.push(e),m=!0,require(["//www.google.com/jsapi?sensor=false&key=AIzaSyAsaQtr02Mt5fQigviYgmIy37VP-hcO9TU&callback=googleAPILoaded"]))},a.urlChanged=function(){return a.hasChanged(!0),!0},a.BlogSelectLayout1=function(){a.BlogPageLayoutId(1)},a.BlogSelectLayout2=function(){a.BlogPageLayoutId(2)},a.BlogLayout1Class=i.computed(function(){return 1==a.BlogPageLayoutId()?"wsb-blog-layout-1-selected":"wsb-blog-layout-1"}),a.BlogLayout2Class=i.computed(function(){return 2==a.BlogPageLayoutId()?"wsb-blog-layout-2-selected":"wsb-blog-layout-2"}),a.onRemove=function(){t&&t.destroy(),a.isNew(!1)},a.dblClick=function(){a.isLocalizedThemeMode()||(a.isBlogValid(!0),a.hasChanged(!1),a.showProperties())},a.getActionMenuItems=i.computed(function(){var e=a.getCommands();return[{text:l.resources.Settings,tip:l.resources.Settings,cssClass:"wsb-tool-Settings",click:a.dblClick},e.clone,e["delete"],e.layoutCommands]}),a.BlogUrl.subscribe(function(e){var n=u.getCustomUrl(e).url,i=function(){var e=new window.google.feeds.Feed(n),i=a.BlogListingsPerPage();e.setNumEntries(i),e.includeHistoricalEntries(),e.load(function(e){var n=e.error?"":e.feed.entries;""!=n?(t&&t.refresh(),a.isBlogValid(!0),a.isBlogValid.notifySubscribers(!0)):(a.isBlogValid(!1),a.isBlogValid.notifySubscribers(!1))})};a.initializeGoogleFeeds(i)}),a.BlogListingsPerPage.subscribe(function(e){void 0!==e&&(s.trackEvent("blog_settings","listings-per-page",""+e),t&&t.refresh())}),a.BlogPageLayoutId.subscribe(function(e){void 0!==e&&(s.trackEvent("blog_settings","change-blog-layout-to-layout-"+e,"button"),t&&t.refresh())}),a.ShowBlogImages.subscribe(function(e){void 0!==e&&(0==e?s.trackEvent("blog_settings","hide-blog-images","checkbox"):s.trackEvent("blog_settings","show-blog-images","checkbox"),t&&t.refresh())}),a.ShowBlogCategories.subscribe(function(e){void 0!==e&&(0==e?s.trackEvent("blog_settings","hide-blog-categories","checkbox"):s.trackEvent("blog_settings","show-blog-categories","checkbox"),t&&t.refresh())}),a.afterRender=function(i){e=n("#designer-"+a.ID()),t=c.render(e,a),n.isFunction(i)&&i(a)},a.onResized=function(){t&&t.refresh()},a.Height.subscribe(function(){Boolean(a.state().match(/^resize/i))||a.onResized()}),a.Width.subscribe(function(){Boolean(a.state().match(/^resize/i))||a.onResized()}),a.mutatorViewModel=new g(a)}function g(e){this.i18Dict={BlogNumberOfListingsColon:l.resources.Server__Blog_Number_of_Listings_colon,BlogShowImages:l.resources.Server__Blog_Show_Images,BlogShowCategories:l.resources.Server__Blog_Show_Categories,OptionsColon:l.resources.Server__Options_colon,BlogOrRssFeedColon:l.resources.Server__Blog_or_RSS_Feed_colon,BlogErrorMessage:l.resources.Server__Blog_Error_Message,LearnMore:l.resources.Server__Learn_more,LayoutColon:l.resources.Server__Layout_colon};var t=this;t.BlogUrl=e.BlogUrl.extend({validation:{required:"URL is required"}}),t.BlogListingsPerPage=e.BlogListingsPerPage.extend({numericMinMax:{min:1,max:10}}),t.ShowBlogCategories=e.ShowBlogCategories,t.ShowBlogImages=e.ShowBlogImages,t.Height=e.Height,t.Width=e.Width,t.BlogLayout1Class=e.BlogLayout1Class,t.BlogLayout2Class=e.BlogLayout2Class,t.BlogSelectLayout1=e.BlogSelectLayout1,t.BlogSelectLayout2=e.BlogSelectLayout2,t.isBlogValid=e.isBlogValid,t.hasChanged=e.hasChanged,t.isValid=i.computed(function(){return e.isBlogValid()}),t.urlChanged=e.urlChanged,t.isValid.subscribe(function(e){d&&d.isOpen()&&d[e?"enableButton":"disableButton"](0)}),t.beforeSaveEvent=function(n){if(t.hasChanged()){var i=u.getCustomUrl(e.BlogUrl()).url,a=function(){var a=new window.google.feeds.Feed(i),r=t.BlogListingsPerPage();a.setNumEntries(r),a.includeHistoricalEntries(),a.load(function(i){var a=i.error?"":i.feed.entries;""!=a?(e.isBlogValid(!0),e.isBlogValid.notifySubscribers(!0),n()):(e.isBlogValid(!1),e.isBlogValid.notifySubscribers(!1)),t.hasChanged(!1)})};e.initializeGoogleFeeds(a)}else""!=e.BlogUrl()?n():(e.isBlogValid(!1),e.isBlogValid.notifySubscribers(!1))}}var h,m,b="blog",f=i.observable(!0),v=[],y="http://foodnetwork.tumblr.com";return{name:b,initModel:function(e,t){function n(t,n){return a.coerceNumericValue(e,e[t],i.unwrap(e[t]),{defaultValue:n})}e.BlogUrl=e.BlogUrl||y,e.ShowBlogImages=void 0!==e.ShowBlogImages?e.ShowBlogImages:!0,e.ShowBlogCategories=void 0!==e.ShowBlogCategories?e.ShowBlogCategories:!0,e.BlogListingsPerPage=n("BlogListingsPerPage",5),e.BlogPageLayoutId=n("BlogPageLayoutId",1),e.hasChanged=e.hasChanged||!1,t&&(e.Width="500px",e.Height="560px")},createElementViewModel:function(e,t){return p.prototype=new e(t),p.prototype.constructor=p,new p},load:function(n,i){n.append(e).append(t),i(null,b)}}}),define("text!designer/app/builder/ui/canvas/elements/button/el.button.html",[],function(){return'<script type="text/html" id="wsb-canvas-template-button">\r\n    <div data-bind="style: { width: boxWidth, height: boxHeight }">\r\n        <div data-widget-content="true" data-bind="\r\n                buttonEditor: { editable: isEditing },\r\n                attr: { \'id\':\'wsb-button-\'+ ID(), \'class\': \'wsb-button \' + CssClasses(), \'style\': styleNoPadding }">\r\n            <span data-bind="html: localizedButtonLabel, style: { whiteSpace: ButtonAutoSize() ? \'nowrap\' : \'normal\' }" class="wsb-button-content wsb-undo-select"></span>\r\n        </div>\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="button-effect-template">\r\n    <a data-bind="attr: { class: \'wsb-button carousel-button \' + cssClass }">\r\n        <span class="wsb-button-content" data-bind="text: $parents[2].i18Dict.Button"></span>\r\n    </a>\r\n</script>'}),define("text!designer/app/builder/ui/canvas/elements/button/mutator.button.html",[],function(){return'<script type="text/html" id ="mutator-template-element-button">\r\n\r\n<!-- ko if: $data.Type() === \'button\' -->\r\n<!-- ko with: mutatorViewModel -->\r\n<div class="wsb-canvas-mutator-inner">\r\n    <div class="wsb-canvas-mutator-ctrl-outer clearfix">\r\n        <div class="wsb-canvas-mutator-ctrl-label wsb-btn-label" data-bind= "text: i18Dict.LabelColon">\r\n        </div>\r\n        <div class="wsb-canvas-mutator-ctrl-input wsb-btn-label-property clearfix">\r\n            <div contenteditable="true" data-bind="ButtonHtml: ButtonLabel" class="wsb-button-input-label wsb-redo-select"></div>\r\n        </div>\r\n    </div>\r\n\r\n    <div class="wsb-url-property" data-bind="mutatorElement: { name: \'urlpicker\', data: ButtonLink, context: { title:i18Dict.LinkColon, newWindow: ButtonOpenLinkInNewWindow } }"></div>\r\n    \r\n    <div class="wsb-shape-property-wrap" data-bind="mutatorElement: {\r\n        name: \'gradientpicker\',\r\n        data: {\r\n            useGradient: useBackgroundGradient,\r\n            gradientType: gradientType,\r\n            color1: backgroundColor,\r\n            color2: backgroundColor2\r\n        },\r\n        context: { title:i18Dict.BackgroundColorColon  }\r\n    }"></div>\r\n    \r\n    <div class="wsb-shape-property-wrap" data-bind="mutatorElement: {\r\n        name: \'colorpicker\',\r\n        data: color,\r\n        context: { title:i18Dict.FontColorColon }\r\n    }"></div>\r\n\r\n    <div class="wsb-button-effect-carousel" data-bind="mutatorElement: { \r\n            name: \'carousel-with-none\', \r\n            data: CssClass, \r\n            context: { \r\n                title:i18Dict.EffectColon,\r\n                optionTemplate: \'button-effect-template\', \r\n                optionValueProperty: \'cssClass\', \r\n                options: effects,\r\n                noneTemplate: \'mutator-template-carousel-none-template\',\r\n                noneValue: \'customStyle\'\r\n            }\r\n        }"> \r\n    </div>\r\n</div>\r\n<!-- /ko -->\r\n<!-- /ko -->\r\n</script>'}),define("designer/app/builder/ui/canvas/elements/button/el.button",["text!designer/app/builder/ui/canvas/elements/button/el.button.html","text!designer/app/builder/ui/canvas/elements/button/mutator.button.html","jquery","knockout","common/logger/logger","designer/app/builder/data/data","/i18n/resources/client","common/util/stringHelper","common/browser/browser","designer/app/builder/ui/controls/actionmenu/actionmenu","designer/app/builder/ui/controls/mutator/mutator","common/stats/googleanalytics"],function(e,t,n,i,a,r,o,s,l,d,c,u){function p(e,t){e.call(this,t);var a=this;a.ButtonLabel.subscribe(function(e){k.test(e)&&a.ButtonLabel(e.replace(k,""))}),a.showProperties=function(e){d.hide(),e=e||{},e.elementViewModel=a,c.show(e)},a.ButtonLabel.subscribe(function(){setTimeout(function(){a.ensureAccurateOuterSize()},100)}),a.Title=o.resources.Button,a.SettingsTitle=o.resources.Button_Settings,a.localizedButtonLabel=a.getLocalizedProperty("ButtonLabel"),a.enableBackspace=!0,a.showBoundingBox=i.computed(function(){return this.getIsSelected()&&!this.isMoving()&&!this.isResizing()&&!this.isLocalizedThemeMode()&&this.allowBoundingBox()&&this.state()!==this.stateMap.edit},a),a.isEditing=i.computed(function(){return"edit"==a.state()}),a.stylePrefix="button",a.styleNoPadding=i.computed({deferredEvaluation:!0,read:function(){var e=a.StyleCollection();return e.remove("padding"),e.stringify()}}),a.ensureAccurateOuterSize=function(e){x.disable();var t=e||this,i=t.getDomElement();if(i&&i.length){var a=i.outerWidth(),r=i.outerHeight(),o=t.pixelWidth()+2*(t.Padding()||0)+2*(t.BorderWidth()||0),s=t.pixelHeight()+2*(t.Padding()||0)+2*(t.BorderWidth()||0);n.fn.textWidth=function(e,t){return n.fn.textWidth.fakeEl||(n.fn.textWidth.fakeEl=n("<span>").hide().appendTo(document.body)),n.fn.textWidth.fakeEl.text(e||this.val()||this.text()).css("font",t||this.css("font")),n.fn.textWidth.fakeEl.width()};var l=i.find(".wsb-button-content")[0],d=n(l).textWidth();t.minWidth=d,t.outerSizeDiff.widthDiff(a-o),t.outerSizeDiff.heightDiff(r-s),x.enable()}},a.mutatorViewModel=new g(a),a.updateFromFileUpload=function(e){if(e){var t=e.toJS(),n=o.resources.Download;t.name&&(n=t.extension?o.resources.Client__Designer__Download_file.format(t.name)+" ("+t.extension.toUpperCase()+")":o.resources.Client__Designer__Download_file.format(t.name)),a.ButtonLabel(n),a.ButtonLink("file:"+t.referenceId)}},a.afterRender=function(e){setTimeout(function(){a.ensureAccurateOuterSize(),n.isFunction(e)&&e(a)},10)},a.boxWidth=i.observable(a.Width()),a.boxHeight=i.observable(a.Height())}function g(e){this.i18Dict={LinkColon:o.resources.Server__Link_colon,BackgroundColorColon:o.resources.Server__Background_color_colon,FontColorColon:o.resources.Server__Font_color_colon,EffectColon:o.resources.Server__Effect_colon,LabelColon:o.resources.Server__Label_colon,Button:o.resources.Button},this.Width=e.Width,this.Height=e.Height,this.CssClass=e.CssClass,this.ButtonAutoSize=e.ButtonAutoSize,this.ButtonLabel=e.ButtonLabel,this.ButtonLink=e.ButtonLink,this.ButtonOpenLinkInNewWindow=e.ButtonOpenLinkInNewWindow||i.observable(""),this.effects=e.cssClasses,this.ButtonOpenLinkInNewWindow.subscribe(function(e){u.trackEvent("button_settings","newwindow_"+(e?"on":"off"),"checkbox")})}function h(){i.bindingHandlers.buttonEditor={update:function(e,t,n,a,r){var o=t(),s=i.utils.unwrapObservable(o.editable);s?(y(e,t,n,a,r),r.editable={}):r.editable&&(_(e,t,n,a,r),r.editable=null)}},i.bindingHandlers.ButtonHtml={init:function(e,t,n,a,r){i.utils.registerEventHandler(e,"focus",function(i){b(i,e,t,n,a,r)}),i.utils.registerEventHandler(e,"blur",function(i){f(i,e,t,n,a,r)}),i.utils.registerEventHandler(e,"keyup",function(i){v(i,e,t,n,a,r)})},update:function(e,t){var n=i.utils.unwrapObservable(t())||"";e.innerHTML!==n&&(e.innerHTML=n)}}}function m(e){if(e)if("undefined"!=typeof l.window.getSelection&&"undefined"!=typeof document.createRange){var t=document.createRange();t.selectNodeContents(e),t.collapse(!1);var n=l.window.getSelection();n.removeAllRanges(),n.addRange(t)}else if("undefined"!=typeof document.body.createTextRange){var i=document.body.createTextRange();i.moveToElementText(e),i.collapse(!1),i.select()}}function b(){}function f(e,t,a){var r=a(),o=i.utils.unwrapObservable(a()),s=n(t),l=s.html()||S;o!==l&&r(l)}function v(e,t,a){var r=a(),o=i.utils.unwrapObservable(a()),s=n(t),l=s.html();o!==l&&r(l)}function y(e,t,i,a){var r=n(e),o=r.find(".wsb-button-content");a.state(a.stateMap.edit),o.attr("contenteditable",!0).removeClass("wsb-undo-select"),o.focus(),r.scrollTop(o.height()).scrollLeft(o.width()),m(o[0])}function _(e,t,i,a){var r=n(e),o=r.find(".wsb-button-content"),s=o.html();a.ButtonLabel()!==s&&(x.collect(),s?a.ButtonLabel(s):(o.html(S),a.ButtonLabel(S)),setTimeout(function(){x.persistChanges()},10)),m(o[0]),o.scrollTop(0).scrollLeft(0),o.removeAttr("contenteditable").addClass("wsb-undo-select").blur(),a.state(a.stateMap.view)}var w="button",S=o.resources.Client__Designer__Enter_text,k=/<\/?a(?![a-z])(?:[^<>]+)?>/gi,x=r.undoer;return{name:w,initModel:function(e,t){e.ButtonLabel=e.ButtonLabel||S,e.ButtonLink=e.ButtonLink||null,e.ButtonOpenLinkInNewWindow=e.ButtonOpenLinkInNewWindow||!1,e.ButtonAutoSize=e.ButtonAutoSize||!0,t&&(e.Width="82px",e.Height="32px")},createElementViewModel:function(e,t,n){p.prototype=Object.create(e.prototype);var i=new p(e,t);return n&&i.CssClass("button"),i.Styling.BackgroundColor(!1),i.Styling.Padding(!1),i},load:function(n,i){n.append(e).append(t),h(),i(null,w)}}}),define("text!designer/app/builder/ui/canvas/elements/carousel/el.carousel.html",[],function(){return'<script type="text/html" id="wsb-canvas-template-carousel">\r\n	<div data-widget-content="true" data-bind="attr: { id: $data.mode + \'-\' + $data.ID(), style: Style, \'class\': \'wsb-media-carousel \' + CssClasses() }"></div>\r\n</script>'}),define("text!designer/app/builder/ui/canvas/elements/carousel/mutator.carousel.html",[],function(){return'<script type="text/html" id ="mutator-template-element-carousel">\r\n\r\n<!-- ko if: $data.Type() === \'carousel\' && $data.mutatorViewModel -->\r\n<!-- ko with: mutatorViewModel -->\r\n<div class="wsb-canvas-mutator-inner">\r\n\r\n    <div data-bind="mutatorElement: { name: \'slider\', data: CarouselThumbSize, context: { title:i18Dict.ThumbnailSizeColon, min: 100, max: 300, unit:i18Dict.Px } }"></div>\r\n\r\n    <div data-bind="mutatorElement: { name: \'slider\', data: CarouselThumbSpacing, context: { title:i18Dict.SpacingColon, min: 0, max: 50, unit:i18Dict.Px } }"></div>\r\n\r\n    <div data-bind="mutatorElement: { name: \'checkboxlist\', data: [{value: CarouselCaption, name:i18Dict.ShowCaptionsIfAvailable}], context: { title:i18Dict.CaptionsColon } }"></div>\r\n    \r\n    <div data-bind="mutatorElement: { \r\n        name: \'carousel\', \r\n        data: CarouselTheme, \r\n        context: { title:i18Dict.StyleColon, optionTemplate: \'mutator-template-carousel-style\', optionValueProperty: \'cssClass\', options: cssClasses }\r\n    }"></div>\r\n    \r\n    <div class="wsb-canvas-mutator-ctrl-outer clearfix">\r\n        <a href="javascript:void(0);" class="btn btn-inverse-grey wsb-add-images-btn" data-bind="click: OpenChooser"><i class="icon-img icon-wsb-white"></i><span data-bind= "text: i18Dict.AddSlashManagePhotos"></span></a>\r\n    </div>\r\n</div>\r\n<!-- /ko -->\r\n<!-- /ko -->\r\n    </script>'}),define("libs/fancybox/fancybox",["jquery","css!libs/fancybox/fancybox.css"],function(){!function(e,t,n,i){var a=n(e),r=n(t),o=n.fancybox=function(){o.open.apply(this,arguments)},s=navigator.userAgent.match(/msie/),l=null,d=t.createTouch!==i,c=function(e){return e&&e.hasOwnProperty&&e instanceof n},u=function(e){return e&&"string"===n.type(e)},p=function(e){return u(e)&&0<e.indexOf("%")},g=function(e,t){var n=parseInt(e,10)||0;return t&&p(e)&&(n*=o.getViewport()[t]/100),Math.ceil(n)},h=function(e,t){return g(e,t)+"px"};n.extend(o,{version:"2.1.4",defaults:{padding:15,margin:20,width:800,height:600,minWidth:100,minHeight:100,maxWidth:9999,maxHeight:9999,autoSize:!0,autoHeight:!1,autoWidth:!1,autoResize:!0,autoCenter:!d,fitToView:!0,aspectRatio:!1,topRatio:.5,leftRatio:.5,scrolling:"auto",wrapCSS:"",arrows:!0,closeBtn:!0,closeClick:!1,nextClick:!1,mouseWheel:!0,autoPlay:!1,playSpeed:3e3,preload:3,modal:!1,loop:!0,ajax:{dataType:"html",headers:{"X-fancyBox":!0}},iframe:{scrolling:"auto",preload:!0},swf:{wmode:"transparent",allowfullscreen:"true",allowscriptaccess:"always"},keys:{next:{13:"left",34:"up",39:"left",40:"up"},prev:{8:"right",33:"down",37:"right",38:"down"},close:[27],play:[32],toggle:[70]},direction:{next:"left",prev:"right"},scrollOutside:!0,index:0,type:null,href:null,content:null,title:null,tpl:{wrap:'<div class="fancybox-wrap" tabIndex="-1"><div class="fancybox-skin"><div class="fancybox-outer"><div class="fancybox-inner"></div></div></div></div>',image:'<img class="fancybox-image" src="{href}" alt="" />',iframe:'<iframe id="fancybox-frame{rnd}" name="fancybox-frame{rnd}" class="fancybox-iframe" frameborder="0" vspace="0" hspace="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen'+(s?' allowtransparency="true"':"")+"></iframe>",error:'<p class="fancybox-error">The requested content cannot be loaded.<br/>Please try again later.</p>',closeBtn:'<a title="Close" class="fancybox-item fancybox-close" href="javascript:;"></a>',next:'<a title="Next" class="fancybox-nav fancybox-next" href="javascript:;"><span></span></a>',prev:'<a title="Previous" class="fancybox-nav fancybox-prev" href="javascript:;"><span></span></a>'},openEffect:"fade",openSpeed:250,openEasing:"swing",openOpacity:!0,openMethod:"zoomIn",closeEffect:"fade",closeSpeed:250,closeEasing:"swing",closeOpacity:!0,closeMethod:"zoomOut",nextEffect:"elastic",nextSpeed:250,nextEasing:"swing",nextMethod:"changeIn",prevEffect:"elastic",prevSpeed:250,prevEasing:"swing",prevMethod:"changeOut",helpers:{overlay:!0,title:!0},onCancel:n.noop,beforeLoad:n.noop,afterLoad:n.noop,beforeShow:n.noop,afterShow:n.noop,beforeChange:n.noop,beforeClose:n.noop,afterClose:n.noop},group:{},opts:{},previous:null,coming:null,current:null,isActive:!1,isOpen:!1,isOpened:!1,wrap:null,skin:null,outer:null,inner:null,player:{timer:null,isActive:!1},ajaxLoad:null,imgPreload:null,transitions:{},helpers:{},open:function(e,t){return e&&(n.isPlainObject(t)||(t={}),!1!==o.close(!0))?(n.isArray(e)||(e=c(e)?n(e).get():[e]),n.each(e,function(a,r){var s,l,d,p,g,h={};"object"===n.type(r)&&(r.nodeType&&(r=n(r)),c(r)?(h={href:r.data("fancybox-href")||r.attr("href"),title:r.data("fancybox-title")||r.attr("title"),isDom:!0,element:r},n.metadata&&n.extend(!0,h,r.metadata())):h=r),s=t.href||h.href||(u(r)?r:null),l=t.title!==i?t.title:h.title||"",p=(d=t.content||h.content)?"html":t.type||h.type,!p&&h.isDom&&(p=r.data("fancybox-type"),p||(p=(p=r.prop("class").match(/fancybox\.(\w+)/))?p[1]:null)),u(s)&&(p||(o.isImage(s)?p="image":o.isSWF(s)?p="swf":"#"===s.charAt(0)?p="inline":u(r)&&(p="html",d=r)),"ajax"===p&&(g=s.split(/\s+/,2),s=g.shift(),g=g.shift())),d||("inline"===p?s?d=n(u(s)?s.replace(/.*(?=#[^\s]+$)/,""):s):h.isDom&&(d=r):"html"===p?d=s:!p&&!s&&h.isDom&&(p="inline",d=r)),n.extend(h,{href:s,type:p,content:d,title:l,selector:g}),e[a]=h}),o.opts=n.extend(!0,{},o.defaults,t),t.keys!==i&&(o.opts.keys=t.keys?n.extend({},o.defaults.keys,t.keys):!1),o.group=e,o._start(o.opts.index)):void 0},cancel:function(){var e=o.coming;e&&!1!==o.trigger("onCancel")&&(o.hideLoading(),o.ajaxLoad&&o.ajaxLoad.abort(),o.ajaxLoad=null,o.imgPreload&&(o.imgPreload.onload=o.imgPreload.onerror=null),e.wrap&&e.wrap.stop(!0,!0).trigger("onReset").remove(),o.coming=null,o.current||o._afterZoomOut(e))},close:function(e){o.cancel(),!1!==o.trigger("beforeClose")&&(o.unbindEvents(),o.isActive&&(o.isOpen&&!0!==e?(o.isOpen=o.isOpened=!1,o.isClosing=!0,n(".fancybox-item, .fancybox-nav").remove(),o.wrap.stop(!0,!0).removeClass("fancybox-opened"),o.transitions[o.current.closeMethod]()):(n(".fancybox-wrap").stop(!0).trigger("onReset").remove(),o._afterZoomOut())))},play:function(e){var t=function(){clearTimeout(o.player.timer)},i=function(){t(),o.current&&o.player.isActive&&(o.player.timer=setTimeout(o.next,o.current.playSpeed))},a=function(){t(),n("body").unbind(".player"),o.player.isActive=!1,o.trigger("onPlayEnd")};!0===e||!o.player.isActive&&!1!==e?o.current&&(o.current.loop||o.current.index<o.group.length-1)&&(o.player.isActive=!0,n("body").bind({"afterShow.player onUpdate.player":i,"onCancel.player beforeClose.player":a,"beforeLoad.player":t}),i(),o.trigger("onPlayStart")):a()},next:function(e){var t=o.current;t&&(u(e)||(e=t.direction.next),o.jumpto(t.index+1,e,"next"))},prev:function(e){var t=o.current;t&&(u(e)||(e=t.direction.prev),o.jumpto(t.index-1,e,"prev"))},jumpto:function(e,t,n){var a=o.current;a&&(e=g(e),o.direction=t||a.direction[e>=a.index?"next":"prev"],o.router=n||"jumpto",a.loop&&(0>e&&(e=a.group.length+e%a.group.length),e%=a.group.length),a.group[e]!==i&&(o.cancel(),o._start(e)))},reposition:function(e,t){var i,a=o.current,r=a?a.wrap:null;r&&(i=o._getPosition(t),e&&"scroll"===e.type?(delete i.position,r.stop(!0,!0).animate(i,200)):(r.css(i),a.pos=n.extend({},a.dim,i)))},update:function(e){var t=e&&e.type,n=!t||"orientationchange"===t;n&&(clearTimeout(l),l=null),o.isOpen&&!l&&(l=setTimeout(function(){var i=o.current;i&&!o.isClosing&&(o.wrap.removeClass("fancybox-tmp"),(n||"load"===t||"resize"===t&&i.autoResize)&&o._setDimension(),"scroll"===t&&i.canShrink||o.reposition(e),o.trigger("onUpdate"),l=null)},n&&!d?0:300))},toggle:function(e){o.isOpen&&(o.current.fitToView="boolean"===n.type(e)?e:!o.current.fitToView,d&&(o.wrap.removeAttr("style").addClass("fancybox-tmp"),o.trigger("onUpdate")),o.update())},hideLoading:function(){r.unbind(".loading"),n("#fancybox-loading").remove()},showLoading:function(){var e,t;o.hideLoading(),e=n('<div id="fancybox-loading"><div></div></div>').click(o.cancel).appendTo("body"),r.bind("keydown.loading",function(e){27===(e.which||e.keyCode)&&(e.preventDefault(),o.cancel())}),o.defaults.fixed||(t=o.getViewport(),e.css({position:"absolute",top:.5*t.h+t.y,left:.5*t.w+t.x}))},getViewport:function(){var t=o.current&&o.current.locked||!1,n={x:a.scrollLeft(),y:a.scrollTop()};return t?(n.w=t[0].clientWidth,n.h=t[0].clientHeight):(n.w=d&&e.innerWidth?e.innerWidth:a.width(),n.h=d&&e.innerHeight?e.innerHeight:a.height()),n},unbindEvents:function(){o.wrap&&c(o.wrap)&&o.wrap.unbind(".fb"),r.unbind(".fb"),a.unbind(".fb")
},bindEvents:function(){var e,t=o.current;t&&(a.bind("orientationchange.fb"+(d?"":" resize.fb")+(t.autoCenter&&!t.locked?" scroll.fb":""),o.update),(e=t.keys)&&r.bind("keydown.fb",function(a){var r=a.which||a.keyCode,s=a.target||a.srcElement;return 27===r&&o.coming?!1:void!(a.ctrlKey||a.altKey||a.shiftKey||a.metaKey||s&&(s.type||n(s).is("[contenteditable]"))||!n.each(e,function(e,s){return 1<t.group.length&&s[r]!==i?(o[e](s[r]),a.preventDefault(),!1):-1<n.inArray(r,s)?(o[e](),a.preventDefault(),!1):void 0}))}),n.fn.mousewheel&&t.mouseWheel&&o.wrap.bind("mousewheel.fb",function(e,i,a,r){for(var s=n(e.target||null),l=!1;s.length&&!l&&!s.is(".fancybox-skin")&&!s.is(".fancybox-wrap");)l=s[0]&&!(s[0].style.overflow&&"hidden"===s[0].style.overflow)&&(s[0].clientWidth&&s[0].scrollWidth>s[0].clientWidth||s[0].clientHeight&&s[0].scrollHeight>s[0].clientHeight),s=n(s).parent();0!==i&&!l&&1<o.group.length&&!t.canShrink&&(r>0||a>0?o.prev(r>0?"down":"left"):(0>r||0>a)&&o.next(0>r?"up":"right"),e.preventDefault())}))},trigger:function(e,t){var i,a=t||o.coming||o.current;if(a){if(n.isFunction(a[e])&&(i=a[e].apply(a,Array.prototype.slice.call(arguments,1))),!1===i)return!1;a.helpers&&n.each(a.helpers,function(t,i){i&&o.helpers[t]&&n.isFunction(o.helpers[t][e])&&(i=n.extend(!0,{},o.helpers[t].defaults,i),o.helpers[t][e](i,a))}),n.event.trigger(e+".fb")}},isImage:function(e){return u(e)&&e.match(/(^data:image\/.*,)|(\.(jp(e|g|eg)|gif|png|bmp|webp)((\?|#).*)?$)/i)},isSWF:function(e){return u(e)&&e.match(/\.(swf)((\?|#).*)?$/i)},_start:function(e){var t,i,a={};if(e=g(e),t=o.group[e]||null,!t)return!1;if(a=n.extend(!0,{},o.opts,t),t=a.margin,i=a.padding,"number"===n.type(t)&&(a.margin=[t,t,t,t]),"number"===n.type(i)&&(a.padding=[i,i,i,i]),a.modal&&n.extend(!0,a,{closeBtn:!1,closeClick:!1,nextClick:!1,arrows:!1,mouseWheel:!1,keys:null,helpers:{overlay:{closeClick:!1}}}),a.autoSize&&(a.autoWidth=a.autoHeight=!0),"auto"===a.width&&(a.autoWidth=!0),"auto"===a.height&&(a.autoHeight=!0),a.group=o.group,a.index=e,o.coming=a,!1===o.trigger("beforeLoad"))o.coming=null;else{if(i=a.type,t=a.href,!i)return o.coming=null,o.current&&o.router&&"jumpto"!==o.router?(o.current.index=e,o[o.router](o.direction)):!1;if(o.isActive=!0,("image"===i||"swf"===i)&&(a.autoHeight=a.autoWidth=!1,a.scrolling="visible"),"image"===i&&(a.aspectRatio=!0),"iframe"===i&&d&&(a.scrolling="scroll"),a.wrap=n(a.tpl.wrap).addClass("fancybox-"+(d?"mobile":"desktop")+" fancybox-type-"+i+" fancybox-tmp "+a.wrapCSS).appendTo(a.parent||"body"),n.extend(a,{skin:n(".fancybox-skin",a.wrap),outer:n(".fancybox-outer",a.wrap),inner:n(".fancybox-inner",a.wrap)}),n.each(["Top","Right","Bottom","Left"],function(e,t){a.skin.css("padding"+t,h(a.padding[e]))}),o.trigger("onReady"),"inline"===i||"html"===i){if(!a.content||!a.content.length)return o._error("content")}else if(!t)return o._error("href");"image"===i?o._loadImage():"ajax"===i?o._loadAjax():"iframe"===i?o._loadIframe():o._afterLoad()}},_error:function(e){n.extend(o.coming,{type:"html",autoWidth:!0,autoHeight:!0,minWidth:0,minHeight:0,scrolling:"no",hasError:e,content:o.coming.tpl.error}),o._afterLoad()},_loadImage:function(){var e=o.imgPreload=new Image;e.onload=function(){this.onload=this.onerror=null,o.coming.width=this.width,o.coming.height=this.height,o._afterLoad()},e.onerror=function(){this.onload=this.onerror=null,o._error("image")},e.src=o.coming.href,!0!==e.complete&&o.showLoading()},_loadAjax:function(){var e=o.coming;o.showLoading(),o.ajaxLoad=n.ajax(n.extend({},e.ajax,{url:e.href,error:function(e,t){o.coming&&"abort"!==t?o._error("ajax",e):o.hideLoading()},success:function(t,n){"success"===n&&(e.content=t,o._afterLoad())}}))},_loadIframe:function(){var e=o.coming,t=n(e.tpl.iframe.replace(/\{rnd\}/g,(new Date).getTime())).attr("scrolling",d?"auto":e.iframe.scrolling).attr("src",e.href);n(e.wrap).bind("onReset",function(){try{n(this).find("iframe").hide().attr("src","//about:blank").end().empty()}catch(e){}}),e.iframe.preload&&(o.showLoading(),t.one("load",function(){n(this).data("ready",1),d||n(this).bind("load.fb",o.update),n(this).parents(".fancybox-wrap").width("100%").removeClass("fancybox-tmp").show(),o._afterLoad()})),e.content=t.appendTo(e.inner),e.iframe.preload||o._afterLoad()},_preloadImages:function(){var e,t,n=o.group,i=o.current,a=n.length,r=i.preload?Math.min(i.preload,a-1):0;for(t=1;r>=t;t+=1)e=n[(i.index+t)%a],"image"===e.type&&e.href&&((new Image).src=e.href)},_afterLoad:function(){var e,t,i,a,r,s=o.coming,l=o.current;if(o.hideLoading(),s&&!1!==o.isActive)if(!1===o.trigger("afterLoad",s,l))s.wrap.stop(!0).trigger("onReset").remove(),o.coming=null;else{switch(l&&(o.trigger("beforeChange",l),l.wrap.stop(!0).removeClass("fancybox-opened").find(".fancybox-item, .fancybox-nav").remove()),o.unbindEvents(),e=s.content,t=s.type,i=s.scrolling,n.extend(o,{wrap:s.wrap,skin:s.skin,outer:s.outer,inner:s.inner,current:s,previous:l}),a=s.href,t){case"inline":case"ajax":case"html":s.selector?e=n("<div>").html(e).find(s.selector):c(e)&&(e.data("fancybox-placeholder")||e.data("fancybox-placeholder",n('<div class="fancybox-placeholder"></div>').insertAfter(e).hide()),e=e.show().detach(),s.wrap.bind("onReset",function(){n(this).find(e).length&&e.hide().replaceAll(e.data("fancybox-placeholder")).data("fancybox-placeholder",!1)}));break;case"image":e=s.tpl.image.replace("{href}",a);break;case"swf":e='<object id="fancybox-swf" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="100%" height="100%"><param name="movie" value="'+a+'"></param>',r="",n.each(s.swf,function(t,n){e+='<param name="'+t+'" value="'+n+'"></param>',r+=" "+t+'="'+n+'"'}),e+='<embed src="'+a+'" type="application/x-shockwave-flash" width="100%" height="100%"'+r+"></embed></object>"}(!c(e)||!e.parent().is(s.inner))&&s.inner.append(e),o.trigger("beforeShow"),s.inner.css("overflow","yes"===i?"scroll":"no"===i?"hidden":i),o._setDimension(),o.reposition(),o.isOpen=!1,o.coming=null,o.bindEvents(),o.isOpened?l.prevMethod&&o.transitions[l.prevMethod]():n(".fancybox-wrap").not(s.wrap).stop(!0).trigger("onReset").remove(),o.transitions[o.isOpened?s.nextMethod:s.openMethod](),o._preloadImages()}},_setDimension:function(){var e,t,i,a,r,s,l,d,c,u=o.getViewport(),m=0,b=!1,f=!1,b=o.wrap,v=o.skin,y=o.inner,_=o.current,f=_.width,w=_.height,S=_.minWidth,k=_.minHeight,x=_.maxWidth,C=_.maxHeight,T=_.scrolling,E=_.scrollOutside?_.scrollbarWidth:0,P=_.margin,D=g(P[1]+P[3]),I=g(P[0]+P[2]);if(b.add(v).add(y).width("auto").height("auto").removeClass("fancybox-tmp"),P=g(v.outerWidth(!0)-v.width()),e=g(v.outerHeight(!0)-v.height()),t=D+P,i=I+e,a=p(f)?(u.w-t)*g(f)/100:f,r=p(w)?(u.h-i)*g(w)/100:w,"iframe"===_.type){if(c=_.content,_.autoHeight&&1===c.data("ready"))try{c[0].contentWindow.document.location&&(y.width(a).height(9999),s=c.contents().find("body"),E&&s.css("overflow-x","hidden"),r=s.height())}catch(A){}}else(_.autoWidth||_.autoHeight)&&(y.addClass("fancybox-tmp"),_.autoWidth||y.width(a),_.autoHeight||y.height(r),_.autoWidth&&(a=y.width()),_.autoHeight&&(r=y.height()),y.removeClass("fancybox-tmp"));if(f=g(a),w=g(r),d=a/r,S=g(p(S)?g(S,"w")-t:S),x=g(p(x)?g(x,"w")-t:x),k=g(p(k)?g(k,"h")-i:k),C=g(p(C)?g(C,"h")-i:C),s=x,l=C,_.fitToView&&(x=Math.min(u.w-t,x),C=Math.min(u.h-i,C)),t=u.w-D,I=u.h-I,_.aspectRatio?(f>x&&(f=x,w=g(f/d)),w>C&&(w=C,f=g(w*d)),S>f&&(f=S,w=g(f/d)),k>w&&(w=k,f=g(w*d))):(f=Math.max(S,Math.min(f,x)),_.autoHeight&&"iframe"!==_.type&&(y.width(f),w=y.height()),w=Math.max(k,Math.min(w,C))),_.fitToView)if(y.width(f).height(w),b.width(f+P),u=b.width(),D=b.height(),_.aspectRatio)for(;(u>t||D>I)&&f>S&&w>k&&!(19<m++);)w=Math.max(k,Math.min(C,w-10)),f=g(w*d),S>f&&(f=S,w=g(f/d)),f>x&&(f=x,w=g(f/d)),y.width(f).height(w),b.width(f+P),u=b.width(),D=b.height();else f=Math.max(S,Math.min(f,f-(u-t))),w=Math.max(k,Math.min(w,w-(D-I)));E&&"auto"===T&&r>w&&t>f+P+E&&(f+=E),y.width(f).height(w),b.width(f+P),u=b.width(),D=b.height(),b=(u>t||D>I)&&f>S&&w>k,f=_.aspectRatio?s>f&&l>w&&a>f&&r>w:(s>f||l>w)&&(a>f||r>w),n.extend(_,{dim:{width:h(u),height:h(D)},origWidth:a,origHeight:r,canShrink:b,canExpand:f,wPadding:P,hPadding:e,wrapSpace:D-v.outerHeight(!0),skinSpace:v.height()-w}),!c&&_.autoHeight&&w>k&&C>w&&!f&&y.height("auto")},_getPosition:function(e){var t=o.current,n=o.getViewport(),i=t.margin,a=o.wrap.width()+i[1]+i[3],r=o.wrap.height()+i[0]+i[2],i={position:"absolute",top:i[0],left:i[3]};return t.autoCenter&&t.fixed&&!e&&r<=n.h&&a<=n.w?i.position="fixed":t.locked||(i.top+=n.y,i.left+=n.x),i.top=h(Math.max(i.top,i.top+(n.h-r)*t.topRatio)),i.left=h(Math.max(i.left,i.left+(n.w-a)*t.leftRatio)),i},_afterZoomIn:function(){var e=o.current;e&&(o.isOpen=o.isOpened=!0,o.wrap.css("overflow","visible").addClass("fancybox-opened"),o.update(),(e.closeClick||e.nextClick&&1<o.group.length)&&o.inner.css("cursor","pointer").bind("click.fb",function(t){!n(t.target).is("a")&&!n(t.target).parent().is("a")&&(t.preventDefault(),o[e.closeClick?"close":"next"]())}),e.closeBtn&&n(e.tpl.closeBtn).appendTo(o.skin).bind("click.fb",function(e){e.preventDefault(),o.close()}),e.arrows&&1<o.group.length&&((e.loop||0<e.index)&&n(e.tpl.prev).appendTo(o.outer).bind("click.fb",o.prev),(e.loop||e.index<o.group.length-1)&&n(e.tpl.next).appendTo(o.outer).bind("click.fb",o.next)),o.trigger("afterShow"),e.loop||e.index!==e.group.length-1?o.opts.autoPlay&&!o.player.isActive&&(o.opts.autoPlay=!1,o.play()):o.play(!1))},_afterZoomOut:function(e){e=e||o.current,n(".fancybox-wrap").trigger("onReset").remove(),n.extend(o,{group:{},opts:{},router:!1,current:null,isActive:!1,isOpened:!1,isOpen:!1,isClosing:!1,wrap:null,skin:null,outer:null,inner:null}),o.trigger("afterClose",e)}}),o.transitions={getOrigPosition:function(){var e=o.current,t=e.element,n=e.orig,i={},a=50,r=50,s=e.hPadding,l=e.wPadding,d=o.getViewport();return!n&&e.isDom&&t.is(":visible")&&(n=t.find("img:first"),n.length||(n=t)),c(n)?(i=n.offset(),n.is("img")&&(a=n.outerWidth(),r=n.outerHeight())):(i.top=d.y+(d.h-r)*e.topRatio,i.left=d.x+(d.w-a)*e.leftRatio),("fixed"===o.wrap.css("position")||e.locked)&&(i.top-=d.y,i.left-=d.x),i={top:h(i.top-s*e.topRatio),left:h(i.left-l*e.leftRatio),width:h(a+l),height:h(r+s)}},step:function(e,t){var n,i,a=t.prop;i=o.current;var r=i.wrapSpace,s=i.skinSpace;("width"===a||"height"===a)&&(n=t.end===t.start?1:(e-t.start)/(t.end-t.start),o.isClosing&&(n=1-n),i="width"===a?i.wPadding:i.hPadding,i=e-i,o.skin[a](g("width"===a?i:i-r*n)),o.inner[a](g("width"===a?i:i-r*n-s*n)))},zoomIn:function(){var e=o.current,t=e.pos,i=e.openEffect,a="elastic"===i,r=n.extend({opacity:1},t);delete r.position,a?(t=this.getOrigPosition(),e.openOpacity&&(t.opacity=.1)):"fade"===i&&(t.opacity=.1),o.wrap.css(t).animate(r,{duration:"none"===i?0:e.openSpeed,easing:e.openEasing,step:a?this.step:null,complete:o._afterZoomIn})},zoomOut:function(){var e=o.current,t=e.closeEffect,n="elastic"===t,i={opacity:.1};n&&(i=this.getOrigPosition(),e.closeOpacity&&(i.opacity=.1)),o.wrap.animate(i,{duration:"none"===t?0:e.closeSpeed,easing:e.closeEasing,step:n?this.step:null,complete:o._afterZoomOut})},changeIn:function(){var e,t=o.current,n=t.nextEffect,i=t.pos,a={opacity:1},r=o.direction;i.opacity=.1,"elastic"===n&&(e="down"===r||"up"===r?"top":"left","down"===r||"right"===r?(i[e]=h(g(i[e])-200),a[e]="+=200px"):(i[e]=h(g(i[e])+200),a[e]="-=200px")),"none"===n?o._afterZoomIn():o.wrap.css(i).animate(a,{duration:t.nextSpeed,easing:t.nextEasing,complete:o._afterZoomIn})},changeOut:function(){var e=o.previous,t=e.prevEffect,i={opacity:.1},a=o.direction;"elastic"===t&&(i["down"===a||"up"===a?"top":"left"]=("up"===a||"left"===a?"-":"+")+"=200px"),e.wrap.animate(i,{duration:"none"===t?0:e.prevSpeed,easing:e.prevEasing,complete:function(){n(this).trigger("onReset").remove()}})}},o.helpers.overlay={defaults:{closeClick:!0,speedOut:200,showEarly:!0,css:{},locked:!d,fixed:!0},overlay:null,fixed:!1,create:function(e){e=n.extend({},this.defaults,e),this.overlay&&this.close(),this.overlay=n('<div class="fancybox-overlay"></div>').appendTo("body"),this.fixed=!1,e.fixed&&o.defaults.fixed&&(this.overlay.addClass("fancybox-overlay-fixed"),this.fixed=!0)},open:function(e){var t=this;e=n.extend({},this.defaults,e),this.overlay?this.overlay.unbind(".overlay").width("auto").height("auto"):this.create(e),this.fixed||(a.bind("resize.overlay",n.proxy(this.update,this)),this.update()),e.closeClick&&this.overlay.bind("click.overlay",function(e){n(e.target).hasClass("fancybox-overlay")&&(o.isActive?o.close():t.close())}),this.overlay.css(e.css).show()},close:function(){n(".fancybox-overlay").remove(),a.unbind("resize.overlay"),this.overlay=null,!1!==this.margin&&(n("body").css("margin-right",this.margin),this.margin=!1),this.el&&this.el.removeClass("fancybox-lock")},update:function(){var e,n="100%";this.overlay.width(n).height("100%"),s?(e=Math.max(t.documentElement.offsetWidth,t.body.offsetWidth),r.width()>e&&(n=r.width())):r.width()>a.width()&&(n=r.width()),this.overlay.width(n).height(r.height())},onReady:function(e,i){n(".fancybox-overlay").stop(!0,!0),this.overlay||(this.margin=r.height()>a.height()||"scroll"===n("body").css("overflow-y")?n("body").css("margin-right"):!1,this.el=n(t.all&&!t.querySelector?"html":"body"),this.create(e)),e.locked&&this.fixed&&(i.locked=this.overlay.append(i.wrap),i.fixed=!1),!0===e.showEarly&&this.beforeShow.apply(this,arguments)},beforeShow:function(e,t){t.locked&&(this.el.addClass("fancybox-lock"),!1!==this.margin&&n("body").css("margin-right",g(this.margin)+t.scrollbarWidth)),this.open(e)},onUpdate:function(){this.fixed||this.update()},afterClose:function(e){this.overlay&&!o.isActive&&this.overlay.fadeOut(e.speedOut,n.proxy(this.close,this))}},o.helpers.title={defaults:{type:"float",position:"bottom"},beforeShow:function(e){var t=o.current,i=t.title,a=e.type;if(n.isFunction(i)&&(i=i.call(t.element,t)),u(i)&&""!==n.trim(i)){switch(t=n('<div class="fancybox-title fancybox-title-'+a+'-wrap">'+i+"</div>"),a){case"inside":a=o.skin;break;case"outside":a=o.wrap;break;case"over":a=o.inner;break;default:a=o.skin,t.appendTo("body"),s&&t.width(t.width()),t.wrapInner('<span class="child"></span>'),o.current.margin[2]+=Math.abs(g(t.css("margin-bottom")))}t["top"===e.position?"prependTo":"appendTo"](a)}}},n.fn.fancybox=function(e){var t,i=n(this),a=this.selector||"",s=function(r){var s,l,d=n(this).blur(),c=t;!(r.ctrlKey||r.altKey||r.shiftKey||r.metaKey||d.is(".fancybox-wrap")||(s=e.groupAttr||"data-fancybox-group",l=d.attr(s),l||(s="rel",l=d.get(0)[s]),l&&""!==l&&"nofollow"!==l&&(d=a.length?n(a):i,d=d.filter("["+s+'="'+l+'"]'),c=d.index(this)),e.index=c,!1===o.open(d,e)||!r.preventDefault()))};return e=e||{},t=e.index||0,a&&!1!==e.live?r.undelegate(a,"click.fb-start").delegate(a+":not('.fancybox-item, .fancybox-nav')","click.fb-start",s):i.unbind("click.fb-start").bind("click.fb-start",s),this.filter("[data-fancybox-start=1]").trigger("click"),this},r.ready(function(){if(n.scrollbarWidth===i&&(n.scrollbarWidth=function(){var e=n('<div style="width:50px;height:50px;overflow:auto"><div/></div>').appendTo("body"),t=e.children(),t=t.innerWidth()-t.height(99).innerWidth();return e.remove(),t}),n.support.fixedPosition===i){var e=n.support,t=n('<div style="position:fixed;top:20px;"></div>').appendTo("body"),a=20===t[0].offsetTop||15===t[0].offsetTop;t.remove(),e.fixedPosition=a}n.extend(o.defaults,{scrollbarWidth:n.scrollbarWidth(),fixed:n.support.fixedPosition,parent:n("body")})})}(window,document,jQuery)}),define("designer/app/builder/ui/controls/media/lightbox/media.lightbox",["designer/util/util.instances","designer/util/util.model","common/util/documentHelper","jquery","libs/fancybox/fancybox"],function(e,t,n,i){function a(e,n){this.$element=e,this.model=new t(n),this.mode=this.model.get("mode"),this.i18N=this.model.get("i18N"),this.subscriptions=[],this.init()}var r="wsb-media-carousel",o=/(msie) ([\w.]+)/.exec(window.navigator.userAgent.toLowerCase()),s=o&&3===o.length&&"msie"===o[1]&&parseInt(o[2],10)<11;a.prototype={$titleTemplate:!1,init:function(){var e=this;if(this.model.isKO){var t=function(){e.refresh()};this.subscriptions.push(this.model.get("localizedAssets",!0).subscribe(t));var n=this.model.get("mutatorViewModel",!0);if(n)for(var a in n)this.model.ko.isObservable(n[a])&&this.subscriptions.push(n[a].subscribe(t))}this.$titleTemplate||(this.$titleTemplate=i("<div/>").addClass("fancybox-title fancybox-title-float-wrap").append(i("<span/>").addClass("child"))),this.refresh("designer"==this.mode&&this.model.get("isNew"))},refresh:function(e){this.assets=this.model.get("localizedAssets")||this.model.get("CarouselAssets"),this.$element.children().remove();for(var t=0;t<this.assets.length;t++)this.addAsset(this.assets[t],t+1);if("designer"==this.mode)this.model.set("minWidth",i("> a:first",this.$element).outerWidth(!0)),this.model.set("isNew",e),this.updateOverlay();else if("desktop"==this.mode){var n=this,a=!1,r=i("a",this.$element),o=this.model.get("preview"),s=this.model.get("CarouselCaption");r.selector="",r.fancybox({afterLoad:function(e){a=e},afterShow:function(){if(a){var e=n.assets[a.index];if(e&&(i(".fancybox-next").attr("title",n.i18N.resources.Next),i(".fancybox-prev").attr("title",n.i18N.resources.Previous),s||e.link)){var t=i(".fancybox-title",a.theme);if(t.length||(t=n.$titleTemplate.clone().insertAfter(i(".fancybox-outer",a.skin))),e.link){var r=i("<a/>").addClass("fancy-title-float-wrap-link");if(e.link.search("window.wsb.gotoAddress")>=0){var l=e.link.match(/preview\/(?:desktop|mobile)\/(?:(?:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})|(?:\d+))/)[0];r.attr("href","#").click(function(){window.wsb.gotoAddress(l)})}else r.attr("href",e.link);Boolean(e.link.match(/^((http|https|ftp|mailto):|\/\/)/i))?r.attr("target","_blank"):o&&r.one("click",function(){i.fancybox.close()}),r.appendTo(t)}s&&!e.caption&&i("span",t).text(n.i18N.resources.Image+" "+(a.index+1)+"/"+n.assets.length)}}},beforeClose:function(){a=!1}})}},updateOverlay:function(){var e=i("."+r+"-overlay",this.$element);e.length||i("<div/>").addClass(r+"-overlay").css(s?{filter:"alpha(opacity = 0.01)","background-color":"background:rgba(0,0,0,0.01);"}:{filter:"alpha(opacity = 0)","background-color":"transparent"}).appendTo(this.$element)},addAsset:function(e){var t,a=this,o=e.src||n.getDocumentUrl(e.id),s=this.model.get("CarouselCaption")&&e.caption?e.caption:null,l=o,d=null;"mobile"==this.mode&&e.link&&(e.link.search("window.wsb.gotoAddress")>=0?(t=e.link.match(/preview\/(?:desktop|mobile)\/(?:(?:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})|(?:\d+))/)[0],l="#"):l=e.link,Boolean(e.link.match(/^((https?|ftp|file):\/{2}|mailto:)/i))&&(d="_blank"));var c=i("<a/>").addClass(r+"-wrapper").addClass("loading").css({height:"100%",width:"100%"}).attr({rel:r+"-"+this.mode+"-"+this.model.get("ID"),href:l,title:s,target:d,"data-fancybox-type":"image"}).css({height:this.model.get("CarouselThumbSize"),width:this.model.get("CarouselThumbSize"),margin:this.model.get("CarouselThumbSpacing"),display:"inline-block","vertical-align":"middle"}).appendTo(this.$element);"mobile"==this.mode&&t&&c.click(function(){window.wsb.gotoAddress(t)});var u=i("<img/>").bind("load",function(){u.appendTo(c.removeClass("loading"));var e=u.width(),t=u.height(),n=c.width(),i=c.height();u.css(e>t?{height:i,left:-(e*(i/t)-n)/2}:t>e?{width:n,top:-(t*(n/e)-i)/2}:{width:n,height:i});var r=a.model.get("CarouselTheme");r&&c.addClass(r),u.unbind("load")});u[0].src=o},destroy:function(){for(var e in this.subscriptions)this.subscriptions[e].dispose();l.destroy(this.$element),this.$element.remove()}};var l=new e(r,a);return{render:function(e,t){var n=l.get(e);return n?n.refresh():n=l.create(e,t),n},destroy:function(e){var t=l.get(e);return t?(l.destroy(e),!0):!1}}}),define("designer/app/builder/ui/canvas/elements/carousel/el.carousel",["text!designer/app/builder/ui/canvas/elements/carousel/el.carousel.html","text!designer/app/builder/ui/canvas/elements/carousel/mutator.carousel.html","jquery","knockout","designer/app/builder/ui/canvas/elements/helper","appconfig","common/stats/googleanalytics","common/abTesting/abTesting","/i18n/resources/client","designer/app/builder/data/data","designer/app/builder/ui/controls/media/lightbox/media.lightbox","designer/app/builder/ui/controls/media/manager/media.manager"],function(e,t,n,i,a,r,o,s,l,d,c,u){function p(e,t){e.call(this,t);var a=this;a.calculateHeight=i.computed(function(){},a);var r;a.ko=i,a.i18N=l,a.isNew=i.observable(m),a.mode="designer",a.Title=l.resources.Photo_Gallery,a.stylePrefix="img",a.SettingsTitle=l.resources.Photo_Gallery_Settings,a.localizedAssets=a.getLocalizedJsonProperty("CarouselAssets"),a.openChooser=function(e){h?("action"===e?o.trackEvent("general_settings","photo_gallery_add_manage_photos","icon"):o.trackEvent("photo_gallery_settings ","add_manage_photos","button"),h.openImages(a.localizedAssets(),function(e){n.isArray(e)&&(a.localizedAssets(e),a.isNew()&&a.isNew(!1))})):(h=u,a.openChooser(e))},a.isActionMenuDisabled=function(){return!1};var s={text:l.resources.Server__Add_slash_Manage_Photos,tip:l.resources.Server__Add_slash_Manage_Photos,cssClass:"wsb-tool-Change",click:function(){a.openChooser("action")}};a.getActionMenuItems=i.computed(function(){var e=a.getCommands();return a.isLocalizedThemeMode()?[s]:[s,e.editProperties,e["delete"],e.layoutCommands]}),a.dblClick=function(){return o.trackEvent("wsb-designer-action-flyout","dblclick-carousel",b),w&&a.isNew()?a.openChooser("action"):a.showProperties(),!1},a.afterRender=function(e){var t,i=n("#designer-"+a.ID()+".wsb-media-carousel");r=c.render(i,a),t="enable"===y.getCurrentState(),t&&y.disable(),a.sizeToFit(),t&&y.enable(),n.isFunction(e)&&e(a)},a.onRemove=function(){r&&r.destroy(),a.isNew(!1)},a.CarouselAssets.subscribe(function(){a.calculateHeight()}),a.CarouselThumbSize.subscribe(function(){a.calculateHeight()}),a.CarouselThumbSpacing.subscribe(function(){a.calculateHeight()}),a.CarouselTheme.subscribe(function(){setTimeout(a.calculateHeight,100)}),a.calculateHeight=function(){if(a.ID){var e=n("#designer-"+a.ID()+".wsb-media-carousel > .wsb-media-carousel-wrapper");if(!(e.length<=0)){var t=n(n("#designer-"+a.ID()+".wsb-media-carousel > .wsb-media-carousel-wrapper")[0]),i=Math.floor(parseInt(a.Width())/t.outerWidth(!0)),r=Math.ceil(a.CarouselAssets().length/i);a.Height(r*t.outerHeight(!0)+"px")}}},a.onResized=function(){r&&(a.sizeProperties.forEach(function(e){e.valueHasMutated()}),r.updateOverlay(),a.calculateHeight())},a.Height.subscribe(function(){/^resize/i.test(a.state())||a.onResized()}),a.Width.subscribe(function(){/^resize/i.test(a.state())||a.onResized()}),a.mutatorViewModel=new g(a),a.sizeProperties=[a.localizedAssets,a.CarouselThumbSize,a.CarouselThumbSpacing],a.sizeProperties.forEach(function(e){e.subscribe(function(){a.ensureAccurateOuterSize()})}),a.showVerticalResizeHandles(!1)}function g(e){this.i18Dict={ThumbnailSizeColon:l.resources.Server__Thumbnail_size_colon,Px:l.resources.Server__px,SpacingColon:l.resources.Server__Spacing_colon,ShowCaptionsIfAvailable:l.resources.Server__Show_captions_if_available,CaptionsColon:l.resources.Server__Captions_colon,StyleColon:l.resources.Server__Style_colon,AddSlashManagePhotos:l.resources.Server__Add_slash_Manage_Photos},this.CarouselCaption=e.CarouselCaption,this.CarouselCaption.subscribe(function(e){o.trackEvent("photo_gallery_settings","caption_"+(e?"on":"off"),"checkbox")}),this.CarouselThumbSize=e.CarouselThumbSize.extend({numericMinMax:{min:100,max:300}}),this.CarouselThumbSpacing=e.CarouselThumbSpacing.extend({numericMinMax:{min:0,max:50}}),this.CarouselTheme=e.CarouselTheme,this.cssClasses=e.cssClasses,this.OpenChooser=function(){e.openChooser("properties")}}var h,m=!0,b="carousel",f=l.resources.Client__Designer__Caption_displays_here,v=[r.customerAmdPathRoot+"/images/beach.jpg",r.customerAmdPathRoot+"/images/fields.jpg",r.customerAmdPathRoot+"/images/folliage.jpg"],y=d.undoer,w="enabled"===s.getOption("smartActions","disabled");return function(){var e,t;for(e=0;e<v.length;e++)t=new Image,t.src=v[e]}(),{name:b,initModel:function(e,t){function n(t,n){return a.coerceNumericValue(e,e[t],i.unwrap(e[t]),{defaultValue:n})}e.CarouselCaption=void 0!==e.CarouselCaption?e.CarouselCaption:!0,e.CarouselThumbSize=n("CarouselThumbSize",150),e.CarouselThumbSpacing=n("CarouselThumbSpacing",5),e.CarouselTheme=e.CarouselTheme||"img",e.CarouselAssets=e.CarouselAssets||_.map(v,function(e){return{id:0,src:e,caption:f,link:"",type:"image"}}),t&&(e.Width="480px",e.Height="160px")},createElementViewModel:function(e,t){p.prototype=Object.create(e.prototype);var n=new p(e,t);return n},load:function(n,i){n.append(e).append(t),i(null,b)}}}),define("text!designer/app/builder/ui/canvas/elements/htmlsnippet/el.htmlsnippet.html",[],function(){return'<script type="text/html" id="wsb-canvas-template-htmlsnippet">\r\n    <div data-bind="attr: { style: Style, \'class\': CssClasses }, htmlsnippetEditor: { editable: isEditing }">\r\n        <div data-bind="overlay: { template: \'htmlsnippet-loading\', isVisible: showLoadingOverlay }">\r\n            <iframe \r\n                data-bind="\r\n                    attr: {\r\n                        id: \'htmlsnippetiframe-\' + ID(),\r\n                        src: \'/designer/htmlsnippetiframe/\' + ID()\r\n                    },\r\n                    style: { width: Width, height: Height },\r\n                    event: { load: handleIframeLoad }"\r\n                data-widget-content="true"\r\n                scrolling="no"\r\n                frameborder="0"\r\n                allowtransparency="true"\r\n                style="border: none; margin: 0; padding: 0; overflow: hidden;"></iframe>\r\n        </div>\r\n        <div data-bind="style: { width: Width, height: Height }" style="opacity: 0; top: 0; bottom: 0; left: 0; right: 0; position: absolute; filter: alpha(opacity = 0); background-color: white;"></div>\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="htmlsnippet-initialcontent">\r\n    {0}\r\n</script>\r\n\r\n<script type="text/html" id="htmlsnippet-loading">\r\n</script>\r\n\r\n<script type="text/html" id="htmlsnippet-mixedcontentwarning">\r\n    <div class="wsb-canvas-mutator-inner" style="height: 230px;">\r\n        <p data-bind="text: i18Dict[\'Server__Your_browsers_security_settings_may_show_an_error\']"></p>\r\n        <p>@Html.Raw(string.Format(Strings.Server__To_prevent_further_browser_warnings, @"<strong>", @"</strong>"))</p>\r\n        <div><img src="@ViewData["amdPathRoot"]/images/show-all-content-box.png" alt="" /></div>\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="htmlsnippet-mixedcontentwarning-title">\r\n    <span data-bind="text: i18Dict[\'Server__You_might_get_warned\']"></span>\r\n</script>'}),define("text!designer/app/builder/ui/canvas/elements/htmlsnippet/mutator.htmlsnippet.html",[],function(){return'<script type="text/html" id="mutator-template-element-htmlsnippet">\r\n    <!-- ko if: $data.Type() === \'htmlsnippet\' && $data.mutatorViewModel -->\r\n    <!-- ko with: mutatorViewModel -->\r\n    <div class="wsb-canvas-mutator-inner">\r\n        <div class="wsb-canvas-mutator-ctrl-outer">\r\n            <div class="wsb-editnavdlg-text" data-bind="html : settings">\r\n            </div>\r\n            <div id="htmlSnippetAceEditorWrapper">\r\n                <div id="htmlSnippetAceEditor" data-bind="aceEditor: { value: tempHtmlSnippet, mode: \'html\', useWrapMode: true }" class="wsb-redo-select"></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <!-- /ko -->\r\n    <!-- /ko -->\r\n</script>\r\n'}),define("designer/app/builder/ui/canvas/elements/htmlsnippet/htmlsnippetiframehelper",[],function(){var e=function(){var e=function(e){var t="wmode=opaque";if(null==e)return"";if(-1!==e.indexOf("youtube")&&-1===e.indexOf("wmode")){var n;if(-1!=e.indexOf("?")){var i=e.split("?"),a=i[1],r=i[0];n=r+"?"+t+"&"+a}else n=e+"?"+t;return n}return e},t=$("#__htmlsnippet"),n=t.html();if("undefined"!=typeof n){for(var i=t[0].getElementsByTagName("embed"),a=0;a<i.length;a++)i[a].setAttribute("wmode","opaque");var r=t[0].getElementsByTagName("object");for(a=0;a<r.length;a++){var o=$(r[a]).find("param[name='wmode'], param[name=WMode]");o.length?o.each(function(e,t){t.setAttribute("value","opaque")}):r[a].innerHTML+="<param name='wmode' value='opaque'/>"}for(a=0;a<r.length;a++){var s=$(r[a]).find("embed");s.length&&s.each(function(t,n){n.setAttribute("src",e(n.getAttribute("src")))})}var l=t[0].getElementsByTagName("iframe");for(a=0;a<l.length;a++){var d=l[a];d.setAttribute("src",e(d.getAttribute("src")))}}};return e}),define("designer/app/builder/ui/canvas/elements/htmlsnippet/el.htmlsnippet",["text!designer/app/builder/ui/canvas/elements/htmlsnippet/el.htmlsnippet.html","text!designer/app/builder/ui/canvas/elements/htmlsnippet/mutator.htmlsnippet.html","designer/app/builder/data/data","jquery","knockout","designer/aceEditor/aceEditor","designer/app/builder/data/designerData","/i18n/resources/client","designer/app/builder/ui/canvas/elements/htmlsnippet/htmlsnippetiframehelper"],function(e,t,n,i,a,r,o,s,l){function d(){var e=this;e.Title=s.resources.Html_Code,e.SettingsTitle=s.resources.HtmlCode_Settings,e.isEditing=a.computed(function(){return"edit"==e.state()}),e.dblClick=function(){e.isLocalizedThemeMode()||e.showProperties()},e.afterNewElementAdded=function(){e.isLocalizedThemeMode()||e.showProperties()},e.getActionMenuItems=a.computed(function(){var t=e.getCommands();return[t.editProperties,t["delete"],t.layoutCommands]}),e.i18Dict=s.resources,e.dialog=null,e.isDialogClosed=!1,e.htmlsnippetProperties={},e.elementViewModel=e,e.height=0,e.initIFrame=!1,e.editor=null,e.overlayContent=a.observable(g),e.overlayOpacity=a.observable("1"),e.backgroundColor=a.observable("#fff"),e.showLoadingOverlay=a.observable(!0),e.handleIframeLoad=function(){e.showLoadingOverlay(!1)},e.mutatorViewModel=new c(e),e.iframeJqueryId=a.computed(function(){return"#htmlsnippetiframe-"+e.ID()});var t=null;e.HtmlSnippet.subscribe(function(){e.showLoadingOverlay(!0),h.test((e.ID()||"").toString())||o.updatePageElement(u.address.currentPage(),e.ID(),{HtmlSnippet:e.HtmlSnippet()}).then(function(n){n&&n.HtmlSnippet&&(e.mutatorViewModel.tempHtmlSnippet(n.HtmlSnippet),e.HtmlSnippet(n.HtmlSnippet));var a=e.iframeJqueryId();t&&t[0]&&"#"+t[0].id===a||(t=i(a)),t.attr("src","/designer/htmlsnippetiframe/"+e.ID())})})}function c(e){this.tempHtmlSnippet=a.observable(e.HtmlSnippet()),this.settings=s.resources.Server__Use_settings_to_place_code.format("<a data-aid='htmlsnippet-settings' href='javascript:void(0);'>","</a>","&lt;HEAD&gt;","&lt;BODY&gt;"),this.onSave=function(t){return e.HtmlSnippet(t.tempHtmlSnippet()),!0}}var u,p="htmlsnippet",g="",h=/^-\d+$/;return window.iframehelper=l,{name:p,initModel:function(e,t){e.HtmlSnippet=e.HtmlSnippet||g,t&&(e.Width="284px",e.Height="100px")},createElementViewModel:function(e,t){return d.prototype=new e(t),d.prototype.constructor=d,new d},load:function(a,r){u=n.getDataModel();var o=s.resources.Server__HtmlSnippet_default_text.format("<strong>","</strong>","</p><p>");e=e.format(o),g=i(e).filter("#htmlsnippet-initialcontent").html(),a.append(e).append(t),r(null,p)}}}),define("text!designer/app/builder/ui/canvas/elements/homefinder/el.homefinder.html",[],function(){return'<script type="text/html" id="wsb-canvas-template-homefinder">\r\n    <div data-widget-content="true" data-bind="attr: { id: $data.mode + \'-\' + $data.ID(), style: Style, \'class\': CssClasses }">\r\n    </div>\r\n</script>\r\n'}),define("text!designer/app/builder/ui/canvas/elements/homefinder/mutator.homefinder.html",[],function(){return'<script type="text/html" id ="mutator-template-element-homefinder">\r\n\r\n<!-- ko if: $data.Type() === \'homefinder\' && $data.mutatorViewModel -->\r\n<!-- ko with: mutatorViewModel -->\r\n<div class="wsb-canvas-mutator-inner">\r\n    <div class="wsb-canvas-mutator-ctrl-outer wsb-canvas-mutator-select clearfix">\r\n        <div class="wsb-canvas-mutator-ctrl-label wsb-repeat-label" data-bind= "text: i18Dict.ListingsColon"></div>\r\n        <div class="wsb-repeat-property clearfix">\r\n            <a href="javascript:void(0);" class="btn btn-inverse-grey wsb-add-images-btn" data-bind="visible: !HomeFinderPartyId(), click: findListing"><i class="icon-search icon-white"></i> <span data-bind= "text: i18Dict.FindMyListings"></span></a>\r\n            <div data-bind="visible: HomeFinderPartyId">\r\n                <label data-bind="html: i18Dict.Server__Active_listings_by + \'&nbsp;\'"></label><b><label data-bind="text: HomeFinderPartyTypeText() + \'&nbsp;\'"></label></b><a href="javascript:void(0);" class="btn btn-inverse-grey wsb-add-images-btn" data-bind="    click: findListing" data-bind= "text: i18Dict.Edit"></a>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div data-bind="mutatorElement: { name: \'select\', data: HomeFinderDisplayAs, context: { title:i18Dict.LayoutColon, options: [{name:i18Dict.ListingsAndMap, id: \'Listings & Map\'}, {name:i18Dict.ListingsOnly, id: \'Listings Only\'}, {name:i18Dict.MapOnly, id: \'Map Only\'}] } }"></div>\r\n    <div data-bind="mutatorElement: { name: \'radio\', data: HomeFinderInclude, context: { title:i18Dict.IncludeColon, group: \'HomeFinderInclude\', options: [i18Dict.Server__Sale_and_rental_properties, i18Dict.Server__Rental_properties_only] } }"></div>\r\n    <div class="wsb-hf-listing-per-pg" data-bind="mutatorElement: { name: \'slider\', data: HomeFinderListingsPerPage, context: { title:i18Dict.ListingPerPageColon, min: 1, max: 10, unit: \'\' } }"></div>\r\n</div>\r\n<!-- /ko -->\r\n<!-- /ko -->\r\n    </script>'
}),define("designer/app/builder/ui/controls/homefinder/homefinder",["designer/util/util.instances","designer/util/util.model","designer/app/builder/ui/controls/media/gallery/media.gallery","jquery","common/abTesting/abTesting","wsbcore/overlay","common/ui/dialog"],function(e,t,n,i,a){function r(e,n){this.$element=e,this.model=new t(n),this.mode=this.model.get("mode"),this.i18N=this.model.get("i18N"),this.poiList=[],this.unGeoedList=[],this.pagingInfo={pageIndex:1,totalPage:1},this.init(),this.markersArray=[]}var o,s="wsb-homefinder",l="ui-homefinder",d={ListingsOnly:"Listings Only",ListingsMap:"Listings & Map",MapOnly:"Map Only"},c={SaleAndRental:"0",RentalOnly:"1"},u=!1,p=!1,g=[],h=!0;window.googleMapsLoaded=function(){for(u=!0,p=!1;g.length>0;){var e=g.shift();e()}},r.prototype={init:function(){this.refresh()},refresh:function(){this.$element.sfMsgOverlay({message:this.i18N.resources.Loading});var e=this,t=this.model.get("HomeFinderAddressMLS");t+="&resultSize="+this.model.get("HomeFinderListingsPerPage")+"&page="+this.pagingInfo.pageIndex,e.model.get("HomeFinderInclude")==c.RentalOnly&&(t+="&tab=6"),e.poiList=[],i.ajax({url:t,dataType:"jsonp",timeout:1e4,crossDomain:!0,success:function(t){if(604===t.status.code)return void e.$element.sfMsgOverlay({message:e.i18N.resources.Client__No_listings_found,style:null});200==t.status.code&&(e.pagingInfo.totalPage=t.data.meta.totalPages);var n="http://www.homefinder.com/"+(e.isPopulated(e.model.get("hfTrackingQueryString"))?"?"+e.model.get("hfTrackingQueryString"):"");if(e.$element.empty(),e.$element.addClass(l).append('<div class="wsb-hf-result-map"></div>').append('<div class="wsb-hf-result-set" style="height: '+e.model.get("Height")+';" />').append(i('<div class="wsb-hf-footer clearfix"></div>').append('<a class="wsb-hf-logo" href="'+n+'" target="_blank"></a>').append('<ul class="wsb-hf-paging" />')),e.model.get("staticMap")&&e.$element.append(i("<div/>").css({width:"100%",height:"100%",position:"absolute",top:0,filter:"alpha(opacity = 0)","background-color":"transparent"})),e.model.get("mobileRendering")===!0)e.$element.find(".wsb-hf-result-map").hide();else if(e.model.get("HomeFinderDisplayAs")==d.MapOnly||e.model.get("HomeFinderDisplayAs")==d.ListingsMap){var a=e.$element.find(".wsb-hf-result-map").show();e.model.get("HomeFinderDisplayAs")==d.ListingsMap?a.addClass("half"):a.removeClass("half"),e.renderMap(t)}else e.$element.find(".wsb-hf-result-map").hide();(e.model.get("mobileRendering")===!0||e.model.get("HomeFinderDisplayAs")==d.ListingsOnly||e.model.get("HomeFinderDisplayAs")==d.ListingsMap)&&e.renderListings(t,e.$element.find(".wsb-hf-result-set "),!1,!1),e.recalculateHeight(),e.$element.sfMsgOverlay({message:null})},error:function(){var t=a.isEnabled("eolHomefinder");e.$element.sfMsgOverlay({message:null});var n;n=t?e.i18N.resources.HomeFinder_is_no_longer_available:e.i18N.resources.Client__HomeFinder_awry,e.$element.append(i('<div class="wsb-hf-error"><div class="wsb-hf-error-wrap"><div class="wsb-hf-yikes">'+e.i18N.resources.Yikes+'</div><div class="wsb-hf-error-text">'+n+'</div><div class="wsb-hf-error-btn-wrapper"><a id="hfRefresh" class="wsb-widget-error-btn">'+e.i18N.resources.Refresh_feed+'</a></div></div> <div class="wsb-hf-footer wsb-hf-error-footer clearfix"><a class="wsb-hf-logo" href="http://www.homefinder.com/?utm_campaign=godaddy_wst_widget&amp;utm_source=godaddy&amp;utm_medium=widgets" target="_blank"></a></div></div>')),t?e.$element.find("#hfRefresh").hide():e.$element.find("#hfRefresh").click(function(){e.$element.empty(),e.refresh()})}})},renderMap:function(e){var t=this,n=function(){t.isPopulated(e.data)&&(i.each(e.data.listings,function(e,n){""!=n.address.latitude&&""!=n.address.longitude?t.poiList.push({latLng:{lat:n.address.latitude,lng:n.address.longitude},listing:n}):t.unGeoedList.push(n)}),0==t.unGeoedList.length?t.displayGoogleMap():(h=!1,i.each(t.unGeoedList,function(e,n){o||(o=new google.maps.Geocoder);var i=t.getListingAddressText(n.address);o&&o.geocode({address:i},function(n,i){if(h=!1,i==google.maps.GeocoderStatus.OK){var a=n[0];a.geometry.location&&t.poiList.push({latLng:{lat:a.geometry.location.lat(),lng:a.geometry.location.lng()},listing:t.unGeoedList[e]})}h=!0})}),timerId=setInterval(function(){h&&(clearInterval(timerId),t.displayGoogleMap())},500)))};this.initializeGoogleMaps(n)},renderListings:function(e,t,a,r,o,s){var l=this,d=!1;if((a||r)&&(d=!0),200==e.status.code){l.pagingInfo.totalPage=e.data.meta.totalPages;var c=i('<ul class="wsb-hf-listings" />').appendTo(t);if(i.each(e.data.listings,function(e,t){var u=i('<a class="hf-view-link" />');u.attr("href",t.url+(l.isPopulated(l.model.get("hfTrackingQueryString"))?"?"+l.model.get("hfTrackingQueryString"):"")).attr("target","_blank");var p=i('<a class="hf-view-link" />');p.attr("href",t.url+(l.isPopulated(l.model.get("hfTrackingQueryString"))?"?"+l.model.get("hfTrackingQueryString"):"")).attr("target","_blank");var g=i('<div class="wsb-hf-mls" />');l.editMode&&d&&g.append("MLS ID#: "+t.mlsId);var h=i('<div class="wsb-hf-price" />').append(l.model.get("enableListingLink")?u.append(l._getListingFormatPriceText(t.price,t.isRental)):l._getListingFormatPriceText(t.price,t.isRental)),m=i('<div class="wsb-hf-address" />').append(l.model.get("enableListingLink")?p.append(l.getListingAddressText(t.address)):l.getListingAddressText(t.address)),b=l.isPopulated(t.photos)&&l.isPopulated(t.photos.length)?t.photos.length:0,f={},v=[];l.isPopulated(t.primaryPhoto)&&l.isPopulated(t.primaryPhoto.url)&&(f={src:t.primaryPhoto.url.replace("/normal","/large"),link:t.url,id:1e4,type:"image"},v.push(f),b++);var y=i("<span></span>");if(b>0){var _="wsb-hf-photo-link-"+t.id,w=l.i18N.resources.Client__One_Photo;if(b>1&&(w=l.i18N.resources.Client__Photos.sfFormat(b)),l.model.get("editMode")||(w='<a class="'+_+'" href="javascript:void(0);">'+w+"</a>"),l.isPopulated(t.photos))for(e=0;e<t.photos.length;e++){var S=t.photos[e],k={src:S.url.replace("/normal","/large"),link:t.url,id:e,type:"image"};v.push(k)}y=i('<div class="wsb-hf-photos" />').append(w)}var x=i('<div class="wsb-hf-photo" />').append(i("<img />").attr("src",l.getListingPhotoUrl(t.primaryPhoto))),C=i('<li class="wsb-hf-listing clearfix" />').attr("id","listing-"+t.id);if(l.model.get("editMode")&&r){i('<input type="checkbox" class="listing-checkbox" />').attr("value",t.id).click(function(){s(t.id,this.checked)}).appendTo(i('<div class="ph-checkbox" />').appendTo(C))}var T=i('<div class="wsb-hf-details" />').appendTo(C);T.append(i('<div class="wsb-hf-details-inner" />').append(i('<div class="wsb-hf-details-bed" />').append(l._getListingBedBathText(t.bed))).append(i('<div class="wsb-hf-details-bath" />').append(l._getListingBedBathText(t.bath))).append(i(t.isRental?'<div class="wsb-hf-rent-label">'+l.i18N.resources.Client__Rental+"</div>":'<div class="wsb-hf-sale-label">'+l.i18N.resources.Client__For_Sale+"</div>"))),a&&l.isPopulated(t.agent)&&l.isPopulated(t.broker)&&C.append(i('<div class="wsb-hf-agnt-brkr-btn-wrap" />').append(i('<a href="javascript:void(0)" class="wsb-hf-agnt-brkr-btn wsb-hf-agnt-btn">'+l.i18N.resources.Agent+"</a>").click(function(){o(t.agent.id,"A")})).append(i(' <a href="javascript:void(0)" class="wsb-hf-agnt-brkr-btn wsb-hf-brkr-btn">'+l.i18N.resources.Broker+"</a>").click(function(){o(t.broker.id,"B")})));var E=i('<div class="wsb-hf-info" />').append(h).append(m).append(g).append(T),P=i('<div class="wsb-hf-photo-info-wrap clearfix"></div>');P.append(x).append(y),C.append(P).append(E),c.append(C),i("."+_,l.element).click(function(){var e={ID:t.id,mode:"desktop",preview:!1,source:"homefinder",Layer:0,Width:"600px",Height:"400px",GalleryAssets:v,GalleryAutoStart:!1,GalleryAutoSize:!1,GalleryCaption:!1,GallerySpeed:5,GalleryTheme:4,GalleryTransition:"Fade"},a=n.render($element=i("<div/>").attr("id",e.mode+"-"+e.ID).addClass("wsb-media-gallery").append(i("<ul/>").addClass("wsb-media-gallery-slider")).wsbDialog({height:"600px",width:"400px",autoResize:!0,cancelDisabled:!1,closeOnEscape:!0,titleHidden:!0,buttons:[],onClose:function(){a&&a.destroy&&a.destroy()}}),e)})}),a&&(i(".wsb-hf-agnt-brkr-btn-wrap",l.$element).hide(),i(".wsb-hf-listing",l.$element).hover(function(){i(this).find(".wsb-hf-agnt-brkr-btn-wrap").show()},function(){i(this).find(".wsb-hf-agnt-brkr-btn-wrap").hide()})),l.sizeListingImages(),!d){var u=l.$element.find(".wsb-hf-paging");l.renderPaging(u)}}},displayGoogleMap:function(){$this=this;try{var e=$this.getCenterLatLng($this.poiList);$this.$element.find(".wsb-hf-result-map").empty();var t,n,i=new google.maps.Map($this.$element.find(".wsb-hf-result-map")[0],{center:new google.maps.LatLng(e.lat,e.lng),zoom:14,draggable:!this.model.get("staticMap"),navigationControl:!this.model.get("staticMap"),scaleControl:!this.model.get("staticMap"),mapTypeControl:!this.model.get("staticMap"),overviewMapControl:!this.model.get("staticMap"),panControl:!this.model.get("staticMap"),rotateControl:!this.model.get("staticMap"),disableDoubleClickZoom:this.model.get("staticMap"),scrollwheel:!this.model.get("staticMap"),streetViewControl:!this.model.get("staticMap"),mapTypeId:google.maps.MapTypeId.ROADMAP}),a=new google.maps.InfoWindow;$this.clearMarkers();var r=new google.maps.LatLngBounds;for(n=0;n<$this.poiList.length;n++){var o=new google.maps.LatLng($this.poiList[n].latLng.lat,$this.poiList[n].latLng.lng),s=$this.getListingAddressText($this.poiList[n].listing.address),l=$this.i18N.resources.Client__Click_to_see.replace("{0}",s);t=new google.maps.Marker({position:o,map:i,clickable:!$this.model.get("editMode"),title:l}),google.maps.event.addListener(t,"click",function(e,t){return function(){a.setContent('<div class="wsb-hf-map-content"><div class="wsb-hf-map-photo"><img src="'+$this.getListingPhotoUrl($this.poiList[t].listing.primaryPhoto)+'" /></div><div class="wsb-hf-map-info"><div class="wsb-hf-map-price">'+$this._getListingFormatPriceText($this.poiList[t].listing.price)+'</div><div class="wsb-hf-map-address"><a href="'+$this.poiList[t].listing.url+'" target="_blank">'+$this.getListingAddressText($this.poiList[t].listing.address)+'</a></div><div class="wsb-hf-map-details-inner"><div class="wsb-hf-listing-type">'+$this.poiList[t].listing.type+'</div><div class="wsb-hf-details-bed">'+$this._getListingBedBathText($this.poiList[t].listing.bed)+'</div><div class="wsb-hf-details-bath">'+$this._getListingBedBathText($this.poiList[t].listing.bath)+'</div></div></div><div class="wsb-hf-realty-name">'+($this.isPopulated($this.poiList[t].listing.broker)&&$this.isPopulated($this.poiList[t].listing.broker.name)?$this.poiList[t].listing.broker.name:"")+'</div><div class="wsb-hf-realtor-name">'+($this.isPopulated($this.poiList[t].listing.agent)&&$this.isPopulated($this.poiList[t].listing.agent.name)?$this.poiList[t].listing.agent.name:"")+'</div></div><div class="wsb-hf-map-link"><a href="'+$this.poiList[t].listing.url+'" target="_blank">View details on HomeFinder.com &raquo</a></div>'),a.open(i,e)}}(t,n)),$this.markersArray.push(t),t.setMap(i),r.extend(o)}$this.poiList&&$this.poiList.length>1&&i.fitBounds(r),google.maps.event.trigger(i,"resize")}catch(d){d.message="displayGoogleMap ("+$this.$element.attr("id")+") : "+d.message}},getListingAddressText:function(e){var t=[];return""!=e.line1&&t.push(e.line1),""!=e.city&&t.push(e.city),""!=e.state&&t.push(e.state),""!=e.zip&&t.push(e.zip),t.join(", ")},getListingPhotoUrl:function(e){var t=this;return t.isPopulated(e)&&t.isPopulated(e.url)?e.url:t.model.get("customerAMDPathRoot")+"images/homefinder/noPhotoAvailable.png"},sizeListingImages:function(){var e=this;e.$element.find(".wsb-hf-photo").each(function(t,n){e.sizeImage(i(n))})},sizeImage:function(e){var t=this,n=e.width(),i=e.height(),a=e.find("img"),r=function(e){var t=e.width,r=e.height,o=t,s=r,l=t/r,d=r/t;r>i&&(r=i,t=Math.round(r*l)),t>n&&(t=n,r=Math.round(t*d));var c=n-t,u=i-r;c>u?(t=n,t>o&&(t=o),r=Math.round(t*d)):u>c&&(r=i,r>s&&(r=s),t=Math.round(r*l)),t>o&&(t=o,r=Math.round(t*d)),r>s&&(r=s,t=Math.round(r*l));var p=Math.floor((n-t)/2),g=Math.floor((i-r)/2);a.css({left:p+"px",top:g+"px",position:"absolute",width:t+"px",height:r+"px"}).show()};t.getImageProps(a.attr("src"),r)},getImageProps:function(e,t){var n=function(e,t,i,a){0==t.height?a>=30?window.console&&console.log&&console.log("Giving up... unable to get image dimensions for "+e):setTimeout(function(){n(e,t,i,++a)},100):i({height:t.height,width:t.width,src:e})},i=new Image;i.src=e,n(e,i,t,0)},destroy:function(){m.destroy(this.$element),this.$element.remove()},initializeGoogleMaps:function(e){u||"object"==typeof google&&"object"==typeof google.maps?(u=!0,e()):p?g.push(e):(g.push(e),p=!0,require(["//maps.googleapis.com/maps/api/js?v=3.21&key=AIzaSyAsaQtr02Mt5fQigviYgmIy37VP-hcO9TU&libraries=places&callback=googleMapsLoaded&language="+this.i18N.lang]))},formatDataUrl:function(e){for(var t="//services.homefinder.com/listingServices/search?apikey=chmd5yfqfqfgxbfuj8q9ga8y",n=0;n<e.length;n++)t+="&"+option.name+"="+option.value},isPopulated:function(e){var t=null!=e&&void 0!=e;return t&&e.constructor==String&&(t=e.length>0&&"undefined"!=e),t},clearMarkers:function(){for(var e=0;e<$this.markersArray.length;e++)$this.markersArray[e].setMap(null)},recalculateHeight:function(){var e,t,n,i,a=this;e=a.model.get("Height").replace("px",""),n=a.$element.find(".wsb-hf-footer").outerHeight(),a.model.get("mobileRendering")===!0?a.$element.find(".wsb-hf-result-set ").css("height",""):(a.model.get("HomeFinderDisplayAs")==d.ListingsOnly&&(i=e-n,a.$element.find(".wsb-hf-result-set ").height(i)),a.model.get("HomeFinderDisplayAs")==d.MapOnly&&(i=e-t-n,a.$element.find(".wsb-hf-result-map").height(i),a.$element.find(".wsb-hf-result-set ").height(0)),a.model.get("HomeFinderDisplayAs")==d.ListingsMap&&(t=a.$element.find(".wsb-hf-result-map").height(),i=e-t-n,a.$element.find(".wsb-hf-result-set ").height(i)))},getCenterLatLng:function(e){var t=-90,n=90,a=-180,r=180;return 1==e.length?e[0].latLng:(i.each(e,function(e,i){var o=i.latLng.lat,s=i.latLng.lng;o>t&&(t=o),n>o&&(n=o),s>a&&(a=s),r>s&&(r=s)}),{lat:(t+n)/2,lng:(a+r)/2})},renderPaging:function(e){var t=this;if(e.empty(),1!=t.pagingInfo.totalPage){var n=Math.floor(t.pagingInfo.pageIndex/5);t.pagingInfo.pageIndex%5==0&&n--,t.pagingInfo.pageIndex>1&&e.append(i('<li><a href="javascript:void(0)" class="wsb-hf-prev"></a></li>').click(function(){t.pagingInfo.pageIndex--,t.pagingInfo.pageIndex<1&&(t.pagingInfo.pageIndex=1),t.refresh()})),t.pagingInfo.pageIndex>5&&e.append(i('<li><a href="javascript:void(0)">1</a></li>').click(function(){t.pagingInfo.pageIndex=1,t.refresh()})),n>0&&e.append(i('<li><a href="javascript:void(0)">..</a></li>').addClass("batch").click(function(){t.pagingInfo.pageIndex-=5,t.pagingInfo.pageIndex<1&&(t.pagingInfo.pageIndex=1),t.refresh()}));for(var a=1;5>=a;a++){var r=5*n+a;if(r<=t.pagingInfo.totalPage){var o=i('<a href="javascript:void(0)" />').append(r);i("<li></li>").append(o).appendTo(e),r!=t.pagingInfo.pageIndex?o.click(function(){t.pagingInfo.pageIndex=parseInt(i(this).text()),t.refresh()}):o.addClass("selected")}}if(n<Math.floor(t.pagingInfo.totalPage/5)&&e.append(i('<li><a href="javascript:void(0)">..</a></li>').addClass("batch").click(function(){t.pagingInfo.pageIndex+=5,t.pagingInfo.pageIndex>t.pagingInfo.totalPage&&(t.pagingInfo.pageIndex=t.pagingInfo.totalPage),t.refresh()})),t.pagingInfo.pageIndex>5&&t.pagingInfo.pageIndex<t.pagingInfo.totalPage-5+t.pagingInfo.totalPage%5){var s=i('<a href="javascript:void(0)" />').append(t.pagingInfo.totalPage);i("<li></li>").append(s).appendTo(e).click(function(){t.pagingInfo.pageIndex=t.pagingInfo.totalPage,t.refresh()})}t.pagingInfo.pageIndex<t.pagingInfo.totalPage&&e.append(i('<li><a href="javascript:void(0)" class="wsb-hf-next"></a></li>').click(function(){t.pagingInfo.pageIndex++,t.pagingInfo.pageIndex>t.pagingInfo.totalPage&&(t.pagingInfo.pageIndex=t.pagingInfo.totalPage),t.refresh()}))}},_getListingFormatPriceText:function(e,t){for(var n=e.toString(),i="",a=n.length,r=0;a>r;r++)i=n.charAt(a-1-r)+i,r%3==2&&r!=a-1&&(i=","+i);return t?"$"+i+" / Per Month":"$"+i},_getListingBedBathText:function(e){return e?e.total?e.total:e:"--"}};var m=new e(s,r),b={staticMap:!1,editMode:!1,enableListingLink:!0,publishPreview:!0};return{render:function(e,t){var n=m.get(e);return n?n.refresh():(i.extend(t,b),n=m.create(e,t)),n},destroy:function(e){var t=m.get(e);return t?(m.destroy(e),!0):!1}}}),define("text!designer/app/builder/ui/controls/homefinder/homefinderListingSearch.html",[],function(){return'<div id="wsb-homefinder-search">\r\n    <div class="wsb-hf-search-dialog clearfix" style="display: none; position: relative; width: 580px">\r\n        <div id="hf-search">            \r\n            <div id="hf-step1" class="clearfix">\r\n                <div class="wsb-hf-address-search">\r\n                    <label class="wsb-block-label" for="txtHFAddress" data-bind="text: i18Dict[\'Server__Search_by_address_or_zip\']"></label>\r\n                    <input aria-disabled="false" id="txtHFAddress" class="wsb-text-box search-text watermark cygnus-validation" value="" type="text" data-bind="value: HomefinderAddress, placesAutocomplete: true">\r\n                    <input type="button" id="btnAddressSearch" class="btn btn-inverse-grey" data-bind="click: SearchByAddress, attr: { value: i18Dict[\'Server__Search\'] }" />\r\n                </div>\r\n\r\n                <div class="wsb-hf-mls-search">\r\n                    <label class="wsb-block-label" for="txtMlsId" data-bind="text: i18Dict[\'Server__Search_by_mls\']"></label>\r\n                    <input aria-disabled="false" id="txtMlsId" class="wsb-text-box search-text watermark cygnus-validation" value="" type="text" data-bind="value: HomefinderMLSId">\r\n                    <input type="button" id="btnMlsSearch" class="btn btn-inverse-grey" data-bind="click: SearchByMLSId, attr: { value: i18Dict[\'Server__Search\'] }" />\r\n                </div>\r\n            </div>\r\n\r\n            <div id="hf-step2">\r\n                <div class="wsb-hf-selet-title" data-bind="visible: HomefinderStep() == 2, text: i18Dict[\'Server__Select_a_property_to_find_your_listings\']"></div>\r\n             \r\n                <div class="wsb-hf-display-options-wrap clearfix" data-bind="visible: HomefinderStep() == 3">\r\n                    <label class="radio wsb-hf-radio" for="rdShowAll">\r\n                        <input id="rdShowAll" name="selectionType" value="party" checked="checked" type="radio" data-bind="checked: HomefinderSelectionType, text: i18Dict[\'Server__Show_active_listings\']">\r\n                    </label>\r\n\r\n                    <label class="radio wsb-hf-radio" for="rdShowSelected">\r\n                        <input id="rdShowSelected" name="selectionType" value="selected" type="radio" data-bind="checked: HomefinderSelectionType, text: i18Dict[\'Server__Show_selected_listings\']">\r\n                    </label>\r\n                </div>\r\n                <div class="display-options-error" data-bind="visible: HomefinderShowError, html: HomefinderErrorMessage"></div>\r\n            </div>\r\n\r\n            <div class="result-area" style="position: relative;">\r\n                <div id="divLoading" class="wsb-hf-loading" data-bind="visible: HomefinderLoading, text: i18Dict[\'Loading\']"></div>\r\n                <div class="search-error" style="position: absolute; top: 0; left: 0; display: none;"></div>\r\n                <div class="wsb-hf-dialog-listings">\r\n                    <ul data-bind="foreach: HomefinderSearchResults" class="wsb-hf-listings">\r\n\r\n                        <li class="wsb-hf-dialog-listing clearfix">\r\n                \r\n                            <div class="wsb-hf-agnt-brkr-btn-wrap">\r\n                                <a href="javascript:void(0)" class="wsb-hf-agnt-brkr-btn wsb-hf-agnt-btn" data-bind="click: $parent.AgentClick, visible: agentId > 0, text: $parent.i18Dict[\'Agent\']"></a>\r\n                                <a href="javascript:void(0)" class="wsb-hf-agnt-brkr-btn wsb-hf-brkr-btn" data-bind="click: $parent.BrokerClick, visible: brokerId > 0, text: $parent.i18Dict[\'Broker\']"></a>\r\n                            </div>\r\n                            \r\n                            <div class="wsb-hf-photo">\r\n                                <img data-bind="attr: { src: photoUrl }" />\r\n                            </div>\r\n                            \r\n                            <div class="wsb-hf-info">\r\n                                <div class="wsb-hf-price" data-bind="html: price"></div>\r\n                                <div class="wsb-hf-address" data-bind="html: address"></div>\r\n                                <div class="wsb-hf-mls" data-bind="html: mlsId"></div>\r\n                                <div class="wsb-hf-details">\r\n                                    <div class="wsb-hf-details-inner">\r\n                                        <div class="wsb-hf-details-bed" data-bind="html: bedrooms"></div>\r\n                                        <div class="wsb-hf-details-bath" data-bind="html: bathrooms"></div>\r\n                                        <div class="wsb-hf-sale-label" data-bind="html: saleLabel"></div>\r\n                                    </div>\r\n                                </div>\r\n                                <div class="wsb-hf-dialog-chkbox-container">\r\n                                    <input type="checkbox" class="wsb-hf-dialog-chkbox" data-bind="attr: { value: homefinderId, checked: selected }, click: $parent.SelectProperty" />\r\n                                </div>\r\n                            </div>\r\n                                \r\n                        </li>\r\n                    </ul>\r\n                </div>\r\n            </div>\r\n            <div class="wsb-hf-logo">                \r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),define("designer/app/builder/ui/controls/homefinder/homefinderListingSearch",["jquery","knockout","userData","common/stats/googleanalytics","designer/app/builder/ui/controls/homefinder/homefinder","appconfig","common/logger/logger","libs/jquery/plugins/jquery.watermark/jquery.watermark","/i18n/resources/client","designer/app/app","text!designer/app/builder/ui/controls/homefinder/homefinderListingSearch.html"],function(e,t,n,i,a,r,o,s,l,d,c){function u(e){var t=null!=e&&"undefined"!=e;return t&&e.constructor==String&&(t=e.length>0&&"undefined"!=e),t}function p(e,t){var n;"A"==t?(z("agent"),n=t.Agent):(z("broker"),n=t.Broker),Q={url:"",serviceType:et.Party,params:{partyId:e,partyType:n}},N.removeAll(),R.removeAll(),X.pageIndex=1,P(!0),F(e),m()}function g(e,t){t&&(Q.serviceType=e,Q.params={searchText:t},X.pageIndex=1,P(!1),V("party"),N.removeAll(),m())}function h(){switch(Q.url=Z,Q.serviceType){case et.Party:Q.url+="&partyId="+Q.params.partyId+"&resultSize="+tt.resultSize;break;case et.ID:Q.url+="&id="+H()+"&resultSize="+tt.resultSize;break;case et.Area:Q.url+="&area="+Q.params.searchText+"&resultSize="+tt.resultSize;break;case et.MLSID:Q.url+="&mlsId="+Q.params.searchText+"&resultSize="+tt.resultSize;break;case et.StreetAddress:Q.url+="&area="+Q.params.area+"&streetAddress="+Q.params.streetAddress;break;case et.Zip:Q.url+="&area="+Q.params.zip;break;case et.City:Q.url+="&area="+Q.params.city+","+Q.params.state}Q.url+="&page="+X.pageIndex}function m(){u(Q.params)&&(h(),Y(!0),e.ajax({url:Q.url,data:"{}",dataType:"jsonp",timeout:1e4,crossDomain:!0}).done(function(e){switch(Y(!1),T(""),200==e.status.code&&(X.totalPages=e.data.meta.totalPages),Q.serviceType){case et.ID:v(e.data.listings);break;case et.Party:W(3),v(e.data.listings);break;case et.Area:case et.MLSID:case et.StreetAddress:case et.Zip:case et.City:if(200==e.status.code)W(2),v(e.data.listings);else if(606==e.status.code){var t=e.status.errorStack[0].data.area;1==t.length?u(t[0].listingsCount)&&t[0].listingsCount>0?(b(t[0]),X.pageIndex=1,m()):x():x()}else x()}}).fail(function(){Y(!1),C()}))}function b(e){switch(e.type){case"address":Q={url:"",serviceType:et.StreetAddress,params:{area:e.city+","+e.state,streetAddress:e.name}};break;case"zip":Q={url:"",serviceType:et.Zip,params:{zip:e.name}};break;case"city":Q={url:"",serviceType:et.City,params:{city:e.name,state:e.state}};break;case"county":Q={url:"",serviceType:et.Area,params:{searchText:e.name+" county,"+e.state}}}}function f(e){e.address&&(e.address.city&&q(e.address.city),e.address.state&&$(e.address.state))}function v(t){if(t){f(t[0]),e.each(t,function(e,t){var n=y(t);null!=n&&N.push(n)});var n=e(".wsb-hf-search-dialog");n.wsbDialog("resize"),e(".wsb-hf-agnt-brkr-btn-wrap").hide(),2==W()&&e(".wsb-hf-dialog-listing").hover(function(){e(this).find(".wsb-hf-agnt-brkr-btn-wrap").show()},function(){e(this).find(".wsb-hf-agnt-brkr-btn-wrap").hide()}),3!=W()&&e(".wsb-hf-dialog-chkbox").hide(),e(".wsb-hf-dialog-listing:odd").addClass("wsb-hf-listing-odd")}}function y(e){var t,n,i,a,r,o,s,d=-1,c=-1,u=l.resources.Client__For_Sale,p=!1;t=w(e.price,e.isRental),n=_(e.address),i=S(e.bed),a=S(e.bath),r=e.mlsId,e.agent&&(d=e.agent.id),e.broker&&(c=e.broker.id),o=e.id,R.indexOf(o)>=0&&(p=!0),s=k(e.primaryPhoto),e.isRental&&(u=l.resources.Client__For_Rent);var g={price:t,address:n,bedrooms:i,bathrooms:a,mlsId:r,agentId:d,brokerId:c,homefinderId:o,photoUrl:s,saleLabel:u,selected:p};return g}function _(e){var t=[];return""!=e.line1&&t.push(e.line1),""!=e.city&&t.push(e.city),""!=e.state&&t.push(e.state),""!=e.zip&&t.push(e.zip),t.join(", ")}function w(e,t){for(var n=e.toString(),i="",a=n.length,r=0;a>r;r++)i=n.charAt(a-1-r)+i,r%3==2&&r!=a-1&&(i=","+i);return t?l.resources.Client__Per_Month.sfFormat("$"+i):"$"+i}function S(e){return e?e.total?e.total:e:"--"}function k(e){return u(e)&&u(e.url)?e.url:r.customerAmdPathRoot+"images/homefinder/noPhotoAvailable.png"}function x(){T(l.resources.Client__HomeFinder_no_results),N.removeAll(),P(!1),W(1)}function C(){T(l.resources.Client__HomeFinder_unable_to_connect),P(!1),W(1)}function T(e){e?(K(e),G(!0)):(K(""),G(!1))}function E(){if("party"==V())B(Z+"&partyId="+F());else{var e=Z+"&id=";H()?(P(!0),T(""),e+=H()):(T(l.resources.Client__You_must_select_one_listing),P(!1)),B(e)}}function P(t){try{var n=e(".wsb-hf-search-dialog");t?n.wsbDialog("enableButton","ok"):n.wsbDialog("disableButton","ok")}catch(i){o.log(i)}}function D(){if(!J){d.addControl(c,d.currentApp,"wsb-homefinder-search");var n=document.getElementById("wsb-homefinder-search");t.cleanNode(n);var i=new O;t.applyBindings(i,n),e("#txtHFAddress").watermark(l.resources.Client__City_State_or_Zip),J=!0;var a=e(".wsb-hf-dialog-listings");a.scroll(function(){var e=a[0].scrollHeight-a.height();a.scrollTop()==e?X.pageIndex<X.totalPages&&!Y()&&(X.pageIndex++,m()):X.pageIndex!=X.totalPages&&0==a.find(".no-more-results").length&&a.append('<div class="no-more-results">'+l.resources.Client__No_More_Results+"</div>")})}}function I(){K(""),Y(!1),j(""),U(""),W(1),N.removeAll(),G(!1),R.removeAll(),X.pageIndex=1,X.totalPages=1}function A(){var e=!1,t=B().split("?");if(t.length>1){for(var n=t[1].split("&"),i=0;i<n.length;i++){var a=n[i].split("=");"partyId"==a[0]&&(Q={serviceType:et.Party,params:{partyId:F()}},e=!0,V("party")),"id"==a[0]&&(Q={serviceType:et.Party,params:{partyId:F()}},e=!0,V("selected"))}if(H())for(var r=H().split(","),o=0;o<r.length;o++)R.push(r[o]);e&&(W(3),P(!0),m())}}function M(e){R.indexOf(e)<0?(R.push(e),V("selected")):R.remove(e)}function O(){function e(){i.trackEvent("wsb-designer-properties-flyout","search-by-address","homefinder"),g(et.Area,j())}function t(){i.trackEvent("wsb-designer-properties-flyout","search-by-mls","homefinder"),g(et.MLSID,U())}function n(e){return i.trackEvent("wsb-designer-properties-flyout","selectproperty","homefinder"),M(e.homefinderId),!0}function a(e){i.trackEvent("wsb-designer-properties-flyout","agent","homefinder"),p(e.agentId,"A")}function r(e){i.trackEvent("wsb-designer-properties-flyout","broker","homefinder"),p(e.brokerId,"B")}return{HomefinderSearchResults:N,HomefinderAddress:j,HomefinderMLSId:U,HomefinderShowError:G,HomefinderErrorMessage:K,HomefinderLoading:Y,HomefinderStep:W,HomefinderSelectionsArray:R,SearchByAddress:e,SearchByMLSId:t,SelectProperty:n,AgentClick:a,BrokerClick:r,HomefinderSelectionType:V,i18Dict:l.resources}}function L(t,n){function a(){i.trackEvent("wsb-designer-properties-flyout","ok","homefinder"),E();var e={HomeFinderAddressMLS:B(),HomeFinderPartyId:F(),HomeFinderSelections:H(),HomeFinderSEOCity:q(),HomeFinderSEOState:$(),HomeFinderPartyType:z()};n(e),o.wsbDialog("close")}function r(){i.trackEvent("wsb-designer-properties-flyout","cancel","homefinder")}I(),B(t.HomeFinderAddressMLS()),F(t.HomeFinderPartyId()),H(t.HomeFinderSelections()),q(t.HomeFinderSEOCity()),$(t.HomeFinderSEOState()),z(t.HomeFinderPartyType());var o=e(".wsb-hf-search-dialog");o.wsbDialog({title:l.resources.Client__Find_Your_Listings,draggable:!1,autoResize:!0,buttons:[{id:"ok",text:l.resources.Save,onClick:a},{id:"cancel",text:l.resources.Cancel,cancel:!0,style:"link"}],onOpen:function(){z()&&F()?A():P(!1)},onCancel:r,destroyOnClose:!1})}var N=t.observableArray(),B=t.observable(""),F=t.observable(""),R=t.observableArray([]),H=t.observable(""),V=t.observable("party"),z=t.observable(""),j=t.observable(""),U=t.observable(""),W=t.observable(1),q=t.observable(),$=t.observable(),G=t.observable(!1),K=t.observable(""),Y=t.observable(!1);V.subscribe(function(e){void 0!==e&&i.trackEvent("wsb-designer-properties-flyout","selectionType","homefinder")}),R.subscribe(function(e){void 0!==e&&H(e.join(","))});var J=!1,Z="//services.homefinder.com/listingServices/search?apikey=chmd5yfqfqfgxbfuj8q9ga8y",X={pageIndex:1,totalPages:1},Q={url:void 0,serviceType:void 0,params:void 0},et={Area:"A",Party:"P",MLSID:"M",ID:"I",StreetAddress:"SA",Zip:"Z",City:"C"},tt={resultSize:10,editMode:!0};return{init:D,open:L}}),define("designer/app/builder/ui/canvas/elements/homefinder/el.homefinder",["text!designer/app/builder/ui/canvas/elements/homefinder/el.homefinder.html","text!designer/app/builder/ui/canvas/elements/homefinder/mutator.homefinder.html","jquery","knockout","designer/app/builder/ui/canvas/elements/helper","userData","napsoc","appconfig","common/logger/logger","libs/jquery/plugins/jquery.watermark/jquery.watermark","common/stats/googleanalytics","designer/app/builder/ui/controls/homefinder/homefinderListingSearch","/i18n/resources/client","designer/app/builder/ui/controls/homefinder/homefinder","common/geo/placesAutocomplete"],function(e,t,n,i,a,r,o,s,l,d,c,u,p,g){function h(e){var t=e&&"undefined"!=e;return t&&e.constructor==String&&(t=e.length>0&&"undefined"!=e),t}function m(){var e=this;this.Title=p.resources.HomeFinder,this.SettingsTitle=p.resources.HomeFinder_Settings,this.address=i.observable("");var t,a;e.ko=i,e.isNew=v,e.mode="designer",e.hfTrackingQueryString=r.isReseller?"":"utm_campaign=godaddy_wst_widget&utm_source=godaddy&utm_medium=widgets",e.publishPreview=!1,e.staticMap=!0,e.editMode=!0,e.resultSize=10,e.enableListingLink=!1,e.container=f,e.customerAMDPathRoot=s.customerAmdPathRoot,e.checkAll=!1,e.i18N=p,e.configData={pageSize:10,agentName:void 0,brokerName:void 0,brokerLogoUrl:void 0,partyId:void 0,partyType:void 0,state:void 0,city:void 0},e.findListing=function(){c.trackModal("wsb-designer-homefinder-findmylistings"),u.open(e,function(t){t&&(e.HomeFinderAddressMLS(t.HomeFinderAddressMLS),e.HomeFinderPartyId(t.HomeFinderPartyId),e.HomeFinderSelections(t.HomeFinderSelections),e.HomeFinderSEOCity(t.HomeFinderSEOCity),e.HomeFinderSEOState(t.HomeFinderSEOState),e.HomeFinderPartyType(t.HomeFinderPartyType))})},e.mutatorViewModel=new b(e),e.HomeFinderAddressMLS.subscribe(function(e){void 0!==e&&a&&a.refresh()}),e.HomeFinderDisplayAs.subscribe(function(e){void 0!==e&&(c.trackEvent("wsb-designer-properties-flyout","display-as","homefinder"),a&&a.refresh())}),e.HomeFinderListingsPerPage.subscribe(function(e){void 0!==e&&(c.trackEvent("wsb-designer-properties-flyout","listings-per-page","homefinder"),a&&a.refresh())
}),e.HomeFinderInclude.subscribe(function(e){void 0!==e&&(c.trackEvent("wsb-designer-properties-flyout","include","homefinder"),a&&a.refresh())}),e.onResized=function(){a&&a.refresh()},e.Height.subscribe(function(){Boolean(e.state().match(/^resize/i))||e.onResized()}),e.Width.subscribe(function(){Boolean(e.state().match(/^resize/i))||e.onResized()}),e.afterRender=function(i){t=n("#designer-"+e.ID()),u.init(),a=g.render(t,e),n.isFunction(i)&&i(e)},e.onRemove=function(){a&&a.destroy(),e.isNew(!1)},e.getFirstSearch=function(){var t=/\b\d{5}\b/g,i=o.Address().match(t),a="85260";i&&(a=i[i.length-1]);var r,s=S+"&area="+a+"&resultSize=100",l={city:"",state:""};n.ajax({url:s,data:"{}",dataType:"jsonp",timeout:1e4,crossDomain:!0}).done(function(t){if(h(t)&&h(t.data)&&h(t.data.listings)){for(var n=0;n<t.data.listings.length;n++){var i=t.data.listings[n];if(0==n&&(l.city=i.address.city,l.state=i.address.state),null!=i.agent&&i.agent.name==o.Name){r=i.agent.id,s=S+"&partyId="+r;break}}e.HomeFinderAddressMLS(s),e.HomeFinderSEOCity(l.city),e.HomeFinderSEOState(l.state)}})},e.HomeFinderAddressMLS()==y&&e.HomeFinderSEOCity()==_&&e.HomeFinderSEOState()==w&&e.getFirstSearch()}function b(e){this.i18Dict={LayoutColon:p.resources.Server__Layout_colon,ListingsAndMap:p.resources.Server__Listings_and_map,ListingsOnly:p.resources.Server__Listings_only,MapOnly:p.resources.Server__Map_only,IncludeColon:p.resources.Server__Include_colon,ListingPerPageColon:p.resources.Server__Listing_per_page_colon,ListingsColon:p.resources.Server__Listings_colon,FindMyListings:p.resources.Server__Find_my_listings,Edit:p.resources.Edit,Server__Active_listings_by:p.resources.Server__Active_listings_by,Server__Sale_and_rental_properties:p.resources.Server__Sale_and_rental_properties,Server__Rental_properties_only:p.resources.Server__Rental_properties_only},this.searchHomeFinder=void 0,this.dialog=void 0,this.initialHeight=void 0,this.resized=!1,this.request={url:void 0,serviceType:void 0,params:void 0},this.publishPreview=!0,this.pagingInfo={pageIndex:1,totalPage:1},this.timerId=void 0,this.selectedListings=e.HomeFinderSelections()?e.HomeFinderSelections().split(","):[],this.HomeFinderAddressMLS=e.HomeFinderAddressMLS,this.HomeFinderDisplayAs=e.HomeFinderDisplayAs,this.HomeFinderListingsPerPage=e.HomeFinderListingsPerPage,this.HomeFinderTextColor=e.HomeFinderTextColor,this.HomeFinderBackgroundColor=e.HomeFinderBackgroundColor,this.HomeFinderSelections=e.HomeFinderSelections,this.HomeFinderInclude=e.HomeFinderInclude,this.HomeFinderPartyId=e.HomeFinderPartyId,this.HomeFinderPartyType=e.HomeFinderPartyType,this.HomeFinderSEOCity=e.HomeFinderSEOCity,this.HomeFinderSEOState=e.HomeFinderSEOState,this.Height=e.Height,this.CssClass=e.CssClass,this.address=e.address,this.findListing=e.findListing,this.HomeFinderPartyTypeText=i.computed(function(){return"broker"===e.HomeFinderPartyType()?p.resources.Client__broker_lc:p.resources.Client__agent_lc}),this.HomeFinderAddressMLSInitial=e.HomeFinderAddressMLS(),this.displaySelectedListingsError=i.observable(!1),this.searchContainer=n("#wsb-homefinder-search").html(),this.searchContainerObject=function(){return n(this.searchContainer)},this.options={editMode:!0,resultSize:10,enableListingLink:!1,container:f,customerAMDPathRoot:s.customerAmdPathRoot,checkAll:!1,configData:{pageSize:10,agentName:void 0,brokerName:void 0,brokerLogoUrl:void 0,partyId:void 0,partyType:void 0,state:void 0,city:void 0}}}var f,v=i.observable(!0),y="//services.homefinder.com/listingServices/search?apikey=chmd5yfqfqfgxbfuj8q9ga8y&&area=85260&resultSize=100",_="Scottsdale",w="AZ",S="//services.homefinder.com/listingServices/search?apikey=chmd5yfqfqfgxbfuj8q9ga8y",k="homefinder";return{name:k,initModel:function(e,t){function n(t,n){return a.coerceNumericValue(e,e[t],i.unwrap(e[t]),{defaultValue:n})}e.HomeFinderAddressMLS=e.HomeFinderAddressMLS||y,e.HomeFinderSEOCity=e.HomeFinderSEOCity||_,e.HomeFinderSEOState=e.HomeFinderSEOState||w,e.HomeFinderSelections=e.HomeFinderSelections||"",e.HomeFinderDisplayAll=e.HomeFinderDisplayAll||"",e.HomeFinderPartyType=e.HomeFinderPartyType||"",e.HomeFinderDisplayAs=e.HomeFinderDisplayAs||"Listings & Map",e.HomeFinderInclude=e.HomeFinderInclude||"0",e.HomeFinderListingsPerPage=n("HomeFinderListingsPerPage",5),e.HomeFinderPartyId=n("HomeFinderPartyId",0)||"",t&&(e.Width="400px",e.Height="560px")},createElementViewModel:function(e,t){return m.prototype=new e(t),m.prototype.constructor=m,new m},load:function(n,i){n.append(e).append(t),i(null,k)}}}),define("text!designer/app/builder/ui/canvas/elements/locu/el.locu.html",[],function(){return'<script type="text/html" id="wsb-canvas-template-locu">\r\n    <div data-bind="attr: { style: Style, \'class\': CssClasses }" data-widget-content="true">\r\n        <!-- ko if: showOverlay-->\r\n        <div class="wsb-locu-overlay"></div>\r\n        <div class="wsb-locu-overlay-section-wrap">\r\n\r\n            <div class="wsb-locu-overlay-section">\r\n                <!-- ko if: overlayMode() == \'loading\' -->\r\n                <div class="wsb-locu-overlay-section-loading">\r\n                    <span data-bind="text: i18Dict[\'Loading\']"></span>\r\n                    <img data-bind="attr: {src: loadingImagePath }" />\r\n                </div>\r\n                <!-- /ko -->\r\n\r\n                <!-- ko if: overlayMode() == \'popover\' -->\r\n                <div class="wsb-locu-overlay-section-popover">\r\n                    <div class="wsb-locu-content-container">\r\n                        <div class="wsb-locu-overlay-header" data-bind="text: overlayText().title"></div>\r\n                        <div class="wsb-locu-overlay-popover-container">\r\n                            <div class="wsb-locu-overlay-popover-text" data-bind="text: overlayText().description"></div>                        \r\n                        </div>\r\n                    </div>\r\n                    <div class="wsb-locu-overlay-popbtn-container">\r\n                        <div class="wsb-locu-overlay-btn-container">\r\n                            <a class="btn" data-aid="btn-getStarted" data-bind="click: btn_getStarted_click, clickBubble: false, text: overlayText().btnLabel, css: overlayText().btnCss"></a>\r\n                            <a class="wsb-locu-overlay-link" data-bind="click: btn_getStartedCancel_click, clickBubble: false, text: i18Dict[\'Client__Locu__No_Thanks_Remove_It\']"></a>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <!-- /ko -->\r\n                \r\n                <div class="wsb-locu-overlay-section-createAccount" data-bind="visible: overlayMode() == \'createAccount\'">\r\n                    <iframe data-aid="ifm-overlay" data-bind="attr: { src: iframeUrl }" frameborder="0" allowtransparency="true"></iframe>\r\n                </div>\r\n                <!-- ko if: overlayMode() == \'error\' -->\r\n                <div class="wsb-locu-overlay-section-error">\r\n                    <div class="wsb-locu-error">\r\n                        <div class="wsb-locu-error-wrap">\r\n                            <div class="wsb-locu-yikes" data-bind="text: i18Dict[\'Yikes\']"></div>\r\n                            <div class="wsb-locu-error-text" data-bind="text: i18Dict[\'Server__Locu_Something_has_gone_awry\']"></div>\r\n                            <div class="wsb-locu-error-btn-wrapper"><a class="wsb-widget-error-btn" data-bind="click: refreshFeed_click, text: i18Dict[\'Refresh_feed\']"></a></div>\r\n                        </div>\r\n                        <div class="wsb-locu-footer wsb-locu-error-footer clearfix">\r\n                            <div class="wsb-sm-locu-logo"></div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <!-- /ko -->\r\n            </div>\r\n        </div>\r\n        <!-- /ko -->\r\n        <div style="width: 100%; height: 100%; overflow-y: auto;" data-ignoredrag>\r\n            <div data-bind="attr: { id: menuWidgetId }" data-aid="div-locu-menu"></div>\r\n        </div>\r\n    </div>\r\n    <div data-bind="attr: {\'data-locu\': overlayMode}" style="display:none;" />\r\n</script>\r\n'}),define("text!designer/app/builder/ui/canvas/elements/locu/mutator.locu.html",[],function(){return'<script type="text/html" id ="mutator-template-element-locu">\r\n<!-- ko if: $data.Type() === \'locu\' && $data.mutatorViewModel -->\r\n<!-- ko with: mutatorViewModel -->\r\n<div data-bind="text: i18Dict[\'Locu\']"></div>\r\n<!-- /ko -->\r\n<!-- /ko -->\r\n</script>'}),define("data/countries",[],function(){return[{id:"AF",name:"Afghanistan"},{id:"AX",name:"Åland Islands"},{id:"AL",name:"Albania"},{id:"DZ",name:"Algeria"},{id:"AS",name:"American Samoa"},{id:"AD",name:"Andorra"},{id:"AO",name:"Angola"},{id:"AI",name:"Anguilla"},{id:"AQ",name:"Antarctica"},{id:"AG",name:"Antigua and Barbuda"},{id:"AR",name:"Argentina"},{id:"AM",name:"Armenia"},{id:"AW",name:"Aruba"},{id:"AU",name:"Australia",type:"State",regions:["New South Wales"," Queensland"," South Australia"," Tasmania"," Victoria"," Western Australia"," Australian Capital Territory"," Northern Territory"]},{id:"AT",name:"Austria"},{id:"AZ",name:"Azerbaijan"},{id:"BS",name:"Bahamas"},{id:"BH",name:"Bahrain"},{id:"BD",name:"Bangladesh"},{id:"BB",name:"Barbados"},{id:"BY",name:"Belarus"},{id:"BE",name:"Belgium"},{id:"BZ",name:"Belize"},{id:"BJ",name:"Benin"},{id:"BM",name:"Bermuda"},{id:"BT",name:"Bhutan"},{id:"BO",name:"Bolivia, Plurinational State of"},{id:"BQ",name:"Bonaire, Sint Eustatius and Saba"},{id:"BA",name:"Bosnia and Herzegovina"},{id:"BW",name:"Botswana"},{id:"BV",name:"Bouvet Island"},{id:"BR",name:"Brazil"},{id:"IO",name:"British Indian Ocean Territory"},{id:"BN",name:"Brunei Darussalam"},{id:"BG",name:"Bulgaria"},{id:"BF",name:"Burkina Faso"},{id:"BI",name:"Burundi"},{id:"KH",name:"Cambodia"},{id:"CM",name:"Cameroon"},{id:"CA",name:"Canada",type:"Province",regions:[{id:"AB",name:" Alberta"},{id:"BC",name:" British Columbia"},{id:"MB",name:" Manitoba"},{id:"NB",name:" New Brunswick"},{id:"NL",name:" Newfoundland and Labrador"},{id:"NS",name:" Nova Scotia"},{id:"ON",name:" Ontario"},{id:"PE",name:" Prince Edward Island"},{id:"QC",name:" Quebec"},{id:"SK",name:" Saskatchewan"},{id:"NT",name:" Northwest Territories"},{id:"NU",name:" Nunavut"},{id:"YT",name:" Yukon Territory"}]},{id:"CV",name:"Cape Verde"},{id:"KY",name:"Cayman Islands"},{id:"CF",name:"Central African Republic"},{id:"TD",name:"Chad"},{id:"CL",name:"Chile"},{id:"CN",name:"China",type:"Region",regions:["Beijing","Tianjin","Hebei","Shanxi","Nei Mongol","Liaoning","Jilin","Heilongjiang","Shanghai","Jiangsu","Zhejiang","Anhui","Fujian","Jiangxi","Shandong","Henan","Hubei","Hunan","Guangdong","Guangxi","Hainan","Chongqing","Sichuan","Guizhou","Yunnan","Xizang","Shaanxi","Gansu","Qinghai","Ningxia","Xinjiang"]},{id:"CX",name:"Christmas Island"},{id:"CC",name:"Cocos (Keeling) Islands"},{id:"CO",name:"Colombia"},{id:"KM",name:"Comoros"},{id:"CG",name:"Congo"},{id:"CD",name:"Congo, The Democratic Republic of the"},{id:"CK",name:"Cook Islands"},{id:"CR",name:"Costa Rica"},{id:"CI",name:"Côte D'Ivoire"},{id:"HR",name:"Croatia"},{id:"CU",name:"Cuba"},{id:"CW",name:"Curaçao"},{id:"CY",name:"Cyprus"},{id:"CZ",name:"Czech Republic"},{id:"DK",name:"Denmark"},{id:"DJ",name:"Djibouti"},{id:"DM",name:"Dominica"},{id:"DO",name:"Dominican Republic"},{id:"EC",name:"Ecuador"},{id:"EG",name:"Egypt"},{id:"SV",name:"El Salvador"},{id:"GQ",name:"Equatorial Guinea"},{id:"ER",name:"Eritrea"},{id:"EE",name:"Estonia"},{id:"ET",name:"Ethiopia"},{id:"FK",name:"Falkland Islands (Malvinas)"},{id:"FO",name:"Faroe Islands"},{id:"FJ",name:"Fiji"},{id:"FI",name:"Finland"},{id:"FR",name:"France"},{id:"GF",name:"French Guiana"},{id:"PF",name:"French Polynesia"},{id:"TF",name:"French Southern Territories"},{id:"GA",name:"Gabon"},{id:"GM",name:"Gambia"},{id:"GE",name:"Georgia"},{id:"DE",name:"Germany"},{id:"GH",name:"Ghana"},{id:"GI",name:"Gibraltar"},{id:"GR",name:"Greece"},{id:"GL",name:"Greenland"},{id:"GD",name:"Grenada"},{id:"GP",name:"Guadeloupe"},{id:"GU",name:"Guam"},{id:"GT",name:"Guatemala"},{id:"GG",name:"Guernsey"},{id:"GN",name:"Guinea"},{id:"GW",name:"Guinea-Bissau"},{id:"GY",name:"Guyana"},{id:"HT",name:"Haiti"},{id:"HM",name:"Heard Island and Mcdonald Islands"},{id:"VA",name:"Holy See (Vatican City State)"},{id:"HN",name:"Honduras"},{id:"HK",name:"Hong Kong"},{id:"HU",name:"Hungary"},{id:"IS",name:"Iceland"},{id:"IN",name:"India",type:"State",regions:["Andaman and Nicobar Islands","Andhra Pradesh","Arunachal Pradesh","Assam","Bihar","Chandigarh","Chhattisgarh","Dadra and Nagar Haveli","Daman and Diu","Delhi","Goa","Gujarat","Haryana","Himachal Pradesh","Jammu and Kashmir","Jharkhand","Karnataka","Kerala","Lakshadweep","Madhya Pradesh","Maharashtra","Manipur","Meghalaya","Mizoram","Nagaland","Orissa","Puducherry","Punjab","Rajasthan","Sikkim","Tamil Nadu","Tripura","Uttarakhand","Uttar Pradesh","West Bengal"]},{id:"ID",name:"Indonesia"},{id:"IR",name:"Iran, Islamic Republic of"},{id:"IQ",name:"Iraq"},{id:"IE",name:"Ireland"},{id:"IM",name:"Isle of Man"},{id:"IL",name:"Israel"},{id:"IT",name:"Italy"},{id:"JM",name:"Jamaica"},{id:"JP",name:"Japan",type:"Region",regions:["Aichi","Akita","Aomori","Ehime","Gifu","Gunma","Hiroshima","Hokkaido","Fukui","Fukuoka","Fukushima","Hyogo","Ibaraki","Ishikawa","Iwate","Kagawa","Kagoshima","Kanagawa","Kochi","Kumamoto","Kyoto","Mie","Miyagi","Miyazaki","Nagano","Nagasaki","Nara","Niigata","Oita","Okayama","Okinawa","Osaka","Saga","Saitama","Shiga","Shimane","Shizuoka","Chiba","Tochigi","Tokushima","Tokyo","Tottori","Toyama","Wakayama","Yamagata","Yamaguchi","Yamanashi"]},{id:"JE",name:"Jersey"},{id:"JO",name:"Jordan"},{id:"KZ",name:"Kazakhstan"},{id:"KE",name:"Kenya"},{id:"KI",name:"Kiribati"},{id:"KP",name:"Korea, Democratic People's Republic of"},{id:"KR",name:"Korea, Republic of",type:"Province",regions:["Seoul","Busan","Daegu","Daejeon","Gwangju","Incheon","Ulsan","North Chungcheong","South Chungcheong","Gangwon","Gyeonggi","North Gyeongsang","South Gyeongsang","Jeju","North Jeolla","South Jeolla"]},{id:"KW",name:"Kuwait"},{id:"KG",name:"Kyrgyzstan"},{id:"LA",name:"Lao People's Democratic Republic"},{id:"LV",name:"Latvia"},{id:"LB",name:"Lebanon"},{id:"LS",name:"Lesotho"},{id:"LR",name:"Liberia"},{id:"LY",name:"Libya"},{id:"LI",name:"Liechtenstein"},{id:"LT",name:"Lithuania"},{id:"LU",name:"Luxembourg"},{id:"MO",name:"Macao"},{id:"MK",name:"Macedonia, The Former Yugoslav Republic of"},{id:"MG",name:"Madagascar"},{id:"MW",name:"Malawi"},{id:"MY",name:"Malaysia"},{id:"MV",name:"Maldives"},{id:"ML",name:"Mali"},{id:"MT",name:"Malta"},{id:"MH",name:"Marshall Islands"},{id:"MQ",name:"Martinique"},{id:"MR",name:"Mauritania"},{id:"MU",name:"Mauritius"},{id:"YT",name:"Mayotte"},{id:"MX",name:"Mexico",type:"State",regions:[" Aguascalientes"," Baja California"," Baja California Sur"," Campeche"," Chiapas"," Chihuahua"," Coahuila"," Colima"," Federal District"," Durango"," Guanajuato"," Guerrero"," Hidalgo"," Jalisco"," Mexico State"," Michoacán"," Morelos"," Nayarit"," Nuevo León"," Oaxaca"," Puebla"," Querétaro"," Quintana Roo"," San Luis Potosí"," Sinaloa"," Sonora"," Tabasco"," Tamaulipas"," Tlaxcala"," Veracruz"," Yucatán"," Zacatecas"]},{id:"FM",name:"Micronesia, Federated States of"},{id:"MD",name:"Moldova, Republic of"},{id:"MC",name:"Monaco"},{id:"MN",name:"Mongolia"},{id:"ME",name:"Montenegro"},{id:"MS",name:"Montserrat"},{id:"MA",name:"Morocco"},{id:"MZ",name:"Mozambique"},{id:"MM",name:"Myanmar"},{id:"NA",name:"Namibia"},{id:"NR",name:"Nauru"},{id:"NP",name:"Nepal"},{id:"NL",name:"Netherlands"},{id:"NC",name:"New Caledonia"},{id:"NZ",name:"New Zealand"},{id:"NI",name:"Nicaragua"},{id:"NE",name:"Niger"},{id:"NG",name:"Nigeria"},{id:"NU",name:"Niue"},{id:"NF",name:"Norfolk Island"},{id:"MP",name:"Northern Mariana Islands"},{id:"NO",name:"Norway"},{id:"OM",name:"Oman"},{id:"PK",name:"Pakistan"},{id:"PW",name:"Palau"},{id:"PS",name:"Palestinian, State of"},{id:"PA",name:"Panama"},{id:"PG",name:"Papua New Guinea"},{id:"PY",name:"Paraguay"},{id:"PE",name:"Peru"},{id:"PH",name:"Philippines"},{id:"PN",name:"Pitcairn"},{id:"PL",name:"Poland"},{id:"PT",name:"Portugal"},{id:"PR",name:"Puerto Rico"},{id:"QA",name:"Qatar"},{id:"RE",name:"Réunion"},{id:"RO",name:"Romania"},{id:"RU",name:"Russian Federation"},{id:"RW",name:"Rwanda"},{id:"BL",name:"Saint Barthélemy"},{id:"SH",name:"Saint Helena, Ascension and Tristan Da Cunha"},{id:"KN",name:"Saint Kitts and Nevis"},{id:"LC",name:"Saint Lucia"},{id:"MF",name:"Saint Martin (French Part)"},{id:"PM",name:"Saint Pierre and Miquelon"},{id:"VC",name:"Saint Vincent and The Grenadines"},{id:"WS",name:"Samoa"},{id:"SM",name:"San Marino"},{id:"ST",name:"Sao Tome and Principe"},{id:"SA",name:"Saudi Arabia"},{id:"SN",name:"Senegal"},{id:"RS",name:"Serbia"},{id:"SC",name:"Seychelles"},{id:"SL",name:"Sierra Leone"},{id:"SG",name:"Singapore"},{id:"SX",name:"Sint Maarten (Dutch Part)"},{id:"SK",name:"Slovakia"},{id:"SI",name:"Slovenia"},{id:"SB",name:"Solomon Islands"},{id:"SO",name:"Somalia"},{id:"ZA",name:"South Africa"},{id:"GS",name:"South Georgia and The South Sandwich Islands"},{id:"SS",name:"South Sudan"},{id:"ES",name:"Spain"},{id:"LK",name:"Sri Lanka"},{id:"SD",name:"Sudan"},{id:"SR",name:"Suriname"},{id:"SJ",name:"Svalbard and Jan Mayen"},{id:"SZ",name:"Swaziland"},{id:"SE",name:"Sweden"},{id:"CH",name:"Switzerland"},{id:"SY",name:"Syrian Arab Republic"},{id:"TW",name:"Taiwan"},{id:"TJ",name:"Tajikistan"},{id:"TZ",name:"Tanzania, United Republic of"},{id:"TH",name:"Thailand"},{id:"TL",name:"Timor-Leste"},{id:"TG",name:"Togo"},{id:"TK",name:"Tokelau"},{id:"TO",name:"Tonga"},{id:"TT",name:"Trinidad and Tobago"},{id:"TN",name:"Tunisia"},{id:"TR",name:"Turkey"},{id:"TM",name:"Turkmenistan"},{id:"TC",name:"Turks and Caicos Islands"},{id:"TV",name:"Tuvalu"},{id:"UG",name:"Uganda"},{id:"UA",name:"Ukraine"},{id:"AE",name:"United Arab Emirates"},{id:"GB",name:"United Kingdom"},{id:"US",name:"United States",type:"State",regions:[{id:"AL",name:"Alabama"},{id:"AK",name:"Alaska"},{id:"AZ",name:"Arizona"},{id:"AR",name:"Arkansas"},{id:"CA",name:"California"},{id:"CO",name:"Colorado"},{id:"CT",name:"Connecticut"},{id:"DE",name:"Delaware"},{id:"DC",name:"District of Columbia"},{id:"FL",name:"Florida"},{id:"GA",name:"Georgia"},{id:"HI",name:"Hawaii"},{id:"ID",name:"Idaho"},{id:"IL",name:"Illinois"},{id:"IN",name:"Indiana"},{id:"IA",name:"Iowa"},{id:"KS",name:"Kansas"},{id:"KY",name:"Kentucky"},{id:"LA",name:"Louisiana"},{id:"ME",name:"Maine"},{id:"MD",name:"Maryland"},{id:"MA",name:"Massachusetts"},{id:"MI",name:"Michigan"},{id:"MN",name:"Minnesota"},{id:"MS",name:"Mississippi"},{id:"MO",name:"Missouri"},{id:"MT",name:"Montana"},{id:"NE",name:"Nebraska"},{id:"NV",name:"Nevada"},{id:"NH",name:"New Hampshire"},{id:"NJ",name:"New Jersey"},{id:"NM",name:"New Mexico"},{id:"NY",name:"New York"},{id:"NC",name:"North Carolina"},{id:"ND",name:"North Dakota"},{id:"OH",name:"Ohio"},{id:"OK",name:"Oklahoma"},{id:"OR",name:"Oregon"},{id:"PA",name:"Pennsylvania"},{id:"RI",name:"Rhode Island"},{id:"SC",name:"South Carolina"},{id:"SD",name:"South Dakota"},{id:"TN",name:"Tennessee"},{id:"TX",name:"Texas"},{id:"UT",name:"Utah"},{id:"VT",name:"Vermont"},{id:"VA",name:"Virginia"},{id:"WA",name:"Washington"},{id:"WV",name:"West Virginia"},{id:"WI",name:"Wisconsin"},{id:"WY",name:"Wyoming"},{id:"AS",name:"American Samoa"},{id:"GU",name:"Guam"},{id:"MP",name:"Northern Mariana Islands"},{id:"PR",name:"Puerto Rico"},{id:"VI",name:"Virgin Islands"},{id:"UM",name:"U.S. Minor Outlying Islands"},{id:"FM",name:"Federated States of Micronesia"},{id:"MH",name:"Marshall Islands"},{id:"PW",name:"Palau"}]},{id:"UY",name:"Uruguay"},{id:"UZ",name:"Uzbekistan"},{id:"VU",name:"Vanuatu"},{id:"VE",name:"Venezuela, Bolivarian Republic"},{id:"VN",name:"Viet Nam"},{id:"VG",name:"Virgin Islands, British"},{id:"VI",name:"Virgin Islands, U.S."},{id:"WF",name:"Wallis and Futuna"},{id:"EH",name:"Western Sahara"},{id:"YE",name:"Yemen"},{id:"ZM",name:"Zambia"},{id:"ZW",name:"Zimbabwe"}]}),define("data/locuCategories",[],function(){return{"default":"restaurants",categories:[{section:"Business, Finance, Law",items:[{godaddy:"Accounting Service",locu:"accountants"},{godaddy:"Business Consulting",locu:"professional"},{godaddy:"Classic Legal",locu:"lawyers"},{godaddy:"Consulting Service",locu:"professional"},{godaddy:"Financial Planner",locu:"accountants"},{godaddy:"Human Resources Services",locu:"professional"},{godaddy:"Insurance Company",locu:"professional"},{godaddy:"Law Firm",locu:"lawyers"},{godaddy:"Scrupulous Accounting",locu:"accountants"},{godaddy:"Strategy Consulting",locu:"professional"},{godaddy:"TM Accountants",locu:"accountants"},{godaddy:"Urban Law Office",locu:"lawyers"}]},{section:"Design, Art, Portfolio",items:[{godaddy:"Architectural Design",locu:"architects"},{godaddy:"Art & Style",locu:"graphicdesign"},{godaddy:"Blurb",locu:"graphicdesign"},{godaddy:"Brick Architecture",locu:"architects"},{godaddy:"Children's Author",locu:""},{godaddy:"Digital World",locu:"web_design"},{godaddy:"Family Photography",locu:"photographers"},{godaddy:"Freelance Portfolio",locu:"graphicdesign"},{godaddy:"Graphic Design Studio",locu:"graphicdesign"},{godaddy:"Interior Design",locu:"interiordesign"},{godaddy:"Interior Solutions",locu:"interiordesign"},{godaddy:"Modern Designer",locu:"web_design"},{godaddy:"Photo Folio",locu:"photographers"},{godaddy:"Photography Business",locu:"photographers"},{godaddy:"Photography Studio",locu:"photographers"},{godaddy:"Professional Photography",locu:"photographers"},{godaddy:"Urban Studio",locu:"photographers"},{godaddy:"Web Design Studio",locu:"web_design"},{godaddy:"Wedding Photographer",locu:"photographers"}]},{section:"Education",items:[{godaddy:"Elementary School",locu:""},{godaddy:"International University",locu:"educationservices"},{godaddy:"Learning Center",locu:"tutoring"},{godaddy:"Modern Elementary School",locu:""},{godaddy:"Online Education",locu:"educationservices"},{godaddy:"Preschool Education",locu:""},{godaddy:"Privaate Music Lessons",locu:"musicalinstrumentsandteachers"},{godaddy:"Summer Camp",locu:"summer_camps"},{godaddy:"Swimming School",locu:"swimminglessons"},{godaddy:"Tutoring Source",locu:"tutoring"}]},{section:"Health, Beauty",items:[{godaddy:"Classic Barber Shop",locu:"barbers"},{godaddy:"Dental Office",locu:""},{godaddy:"Family Health Service",locu:"health"},{godaddy:"Hair Salon",locu:"salon"},{godaddy:"Luxury Spa Accessories",locu:"spas"},{godaddy:"Nail and Spa Care",locu:"othersalons"},{godaddy:"Natural Soaps",locu:""},{godaddy:"Serenity Spa",locu:"spas"},{godaddy:"Unique Boutique",locu:"othersalons"}]},{section:"Home Services, Construction",items:[{godaddy:"Aesthetic Landscaping",locu:"landscaping"},{godaddy:"Antique Restoration",locu:"homeservices"},{godaddy:"B & K Remodel",locu:"contractors"},{godaddy:"Brick Architecture",locu:"architects"},{godaddy:"Builder/Contractor",locu:"contractors"},{godaddy:"Cleaning Service",locu:"homeservices"},{godaddy:"ColorX Painting",locu:"painters"},{godaddy:"Contractor",locu:"contractors"},{godaddy:"Creative Landscape",locu:"homeservices"},{godaddy:"Flooring Store",locu:"homeservices"},{godaddy:"Foreman",locu:"contractors"},{godaddy:"Handyman",locu:"contractors"},{godaddy:"Heat & Cool",locu:"homeservices"},{godaddy:"Home Painter",locu:"painters"},{godaddy:"Housekeeper Pros",locu:"homeservices"},{godaddy:"Industrial Craftsmanship",locu:"contractors"},{godaddy:"Interior Design",locu:"interiordesign"},{godaddy:"Interior Solutions",locu:"interiordesign"},{godaddy:"Landscape Design",locu:"homeservices"},{godaddy:"Landscape Service",locu:"homeservices"},{godaddy:"Painting Company",locu:"painters"},{godaddy:"Painting Projects",locu:"painters"},{godaddy:"Plumbing Company",locu:"homeservices"},{godaddy:"Plumbing Service",locu:"homeservices"},{godaddy:"Pool Service",locu:"homeservices"},{godaddy:"Pristine Pool",locu:"homeservices"},{godaddy:"Professional Cleaning",locu:"homeservices"},{godaddy:"Roofing Company",locu:"contractors"},{godaddy:"Swimming Pool Service",locu:"homeservices"},{godaddy:"Vivid Paint",locu:"painters"},{godaddy:"Welding Company",locu:"contractors"},{godaddy:"Your Handyman",locu:"homeservices"},{godaddy:"Your Landscaper",locu:"homeservices"}]},{section:"Music & Entertainment",items:[{godaddy:"Country Singer",locu:"musicians"},{godaddy:"Feel The Music",locu:"musicians"},{godaddy:"Modern Musician",locu:"musicians"},{godaddy:"Music Lessons Dark",locu:"musicalinstrumentsandteachers"},{godaddy:"Music Lessons Light",locu:"musicalinstrumentsandteachers"},{godaddy:"Music Venue",locu:"musicvenues"},{godaddy:"Musician",locu:"musicians"},{godaddy:"Privaate Music Lessons",locu:"musicalinstrumentsandteachers"}]},{section:"Non-profit, Causes, Religion",items:[{godaddy:"Charity Organization",locu:""},{godaddy:"Children Center",locu:""},{godaddy:"Christian Church",locu:""},{godaddy:"Developing Country Charity",locu:""},{godaddy:"Family Support Center",locu:""},{godaddy:"Grace Church",locu:""},{godaddy:"Heart Charity Organization",locu:""},{godaddy:"Hope and Support",locu:""},{godaddy:"Hopeful Message",locu:""},{godaddy:"My Congregation",locu:""}]},{section:"Other",items:[{godaddy:"Abstract - Horizontal Nav",locu:""},{godaddy:"Abstract - Vertical Nav",locu:""},{godaddy:"Blank Canvas Black",locu:""},{godaddy:"Blank Canvas White",locu:""},{godaddy:"Blurb",locu:""},{godaddy:"Simple Gray",locu:""}]},{section:"Personal, Family, Wedding",items:[{godaddy:"Baby Boy Announcement",locu:""},{godaddy:"Baby Girl Announcement",locu:""},{godaddy:"Babysitters",locu:"childcare"},{godaddy:"Bulletin Board",locu:""},{godaddy:"Family Pet",locu:""},{godaddy:"Family Support Center",locu:""},{godaddy:"Hope and Support",locu:""},{godaddy:"Hopeful Message",locu:""},{godaddy:"Parenting",locu:""},{godaddy:"Resume InkSpot",locu:""},{godaddy:"Wedding Bliss",locu:""},{godaddy:"Wedding Cakes",locu:"restaurants"},{godaddy:"Wedding Photographer",locu:"photographers"},{godaddy:"Wedding Planner",locu:"wedding_planning"}]},{section:"Pets, Animals",items:[{godaddy:"Animal Shelter",locu:""},{godaddy:"Aquarium Company",locu:""},{godaddy:"Exotic Pet Clinic",locu:""},{godaddy:"Family Pet",locu:""},{godaddy:"Heart Pet Clinic",locu:""},{godaddy:"Horse Stable",locu:""},{godaddy:"Pampered Pets",locu:"pet_sitting"},{godaddy:"Pet Clinic",locu:""},{godaddy:"Pet Hospital",locu:""},{godaddy:"Premier Pet Sitters",locu:"pet_sitting"},{godaddy:"Vet Care Plus",locu:""},{godaddy:"Veterinarian",locu:""}]},{section:"Real Estate",items:[{godaddy:"Apartments For Rent",locu:""},{godaddy:"Commercial Real Estate",locu:""},{godaddy:"Hometown Real Estate",locu:""},{godaddy:"Modern Real Estate",locu:""},{godaddy:"Priceless Housing",locu:""},{godaddy:"Real Estate Properties",locu:""},{godaddy:"Residential Real Estate",locu:""},{godaddy:"Smith Real Estate",locu:""},{godaddy:"Suburban Real Estate",locu:""},{godaddy:"Terra Real Estate",locu:""},{godaddy:"Triumph Real Estate",locu:""},{godaddy:"Urban Apartments",locu:""},{godaddy:"Urban Real Estate",locu:""},{godaddy:"We Find Homes",locu:""}]},{section:"Restaurant, Food",items:[{godaddy:"BBQ Joint",locu:"restaurants"},{godaddy:"Bread & Wrap",locu:"restaurants"},{godaddy:"Bread Company",locu:"restaurants"},{godaddy:"Brewery",locu:"restaurants"},{godaddy:"British Pub",locu:"restaurants"},{godaddy:"Brunch",locu:"restaurants"},{godaddy:"Burger Grind",locu:"restaurants"},{godaddy:"Burger Joint",locu:"restaurants"},{godaddy:"Casual Brewery",locu:"restaurants"},{godaddy:"Casual Brewery",locu:"restaurants"},{godaddy:"Catering",locu:"restaurants"},{godaddy:"Chicago Pizza",locu:"restaurants"},{godaddy:"China China",locu:"restaurants"},{godaddy:"Chinese Cuisine",locu:"restaurants"},{godaddy:"City Diner",locu:"restaurants"},{godaddy:"Coffee Spot",locu:"restaurants"},{godaddy:"Farm Fresh Cafeteria",locu:"restaurants"},{godaddy:"Farmers Market",locu:"restaurants"},{godaddy:"French Cafe",locu:"restaurants"},{godaddy:"Gourmet Catering",locu:"restaurants"},{godaddy:"Gourmet Recipes",locu:"restaurants"},{godaddy:"Gourmet Restaurant",locu:"restaurants"},{godaddy:"Green Gourmet",locu:"restaurants"},{godaddy:"Happy Hour",locu:"restaurants"},{godaddy:"Indian Kitchen",locu:"restaurants"},{godaddy:"Italian Restaurant",locu:"restaurants"},{godaddy:"Japanese Cuisine",locu:"restaurants"},{godaddy:"Korean Cuisine",locu:"restaurants"},{godaddy:"Local Brew",locu:"restaurants"},{godaddy:"Mama Mia Italian",locu:"restaurants"},{godaddy:"Mexican Restaurant",locu:"restaurants"},{godaddy:"Middle Eastern Cuisine",locu:"restaurants"},{godaddy:"Ocean's Table",locu:"restaurants"},{godaddy:"Omelette",locu:"restaurants"},{godaddy:"Open Grill",locu:"restaurants"},{godaddy:"Organic Pizza",locu:"restaurants"},{godaddy:"Restaurant Consultant",locu:"restaurants"},{godaddy:"So Thai",locu:"restaurants"},{godaddy:"Specialty Foods",locu:"restaurants"},{godaddy:"Sumptuous Cuisine",locu:"restaurants"},{godaddy:"Sushi Restaurant",locu:"restaurants"},{godaddy:"Sweets Bakery",locu:"restaurants"},{godaddy:"Tea Shop",locu:"restaurants"},{godaddy:"Vietnamese Restaurant",locu:"restaurants"},{godaddy:"Wedding Cakes",locu:"restaurants"},{godaddy:"Winery Classic",locu:"restaurants"}]},{section:"Sell Products, E-commerce",items:[{godaddy:"Children's Author",locu:""},{godaddy:"Crop Farmer",locu:""},{godaddy:"Elegant Florist",locu:""},{godaddy:"Flooring Store",locu:"homeservices"},{godaddy:"Golden Crop Farmer",locu:""},{godaddy:"Luxury Spa Accessories",locu:""},{godaddy:"Natural Soaps",locu:""},{godaddy:"Smart Phone App",locu:""},{godaddy:"Tea Shop",locu:"tea"},{godaddy:"WakeUp Water Sports",locu:""},{godaddy:"Watch Store",locu:""}]},{section:"Sports, Recreation",items:[{godaddy:"Baseball Camps",locu:"summer_camps"},{godaddy:"Contemporary Fitness",locu:"fitness"},{godaddy:"Fitness Boot Camp",locu:"fitness"},{godaddy:"Fitness Club",locu:"fitness"},{godaddy:"Golf Club",locu:"golf"},{godaddy:"Horse Stable",locu:"horsebackriding"},{godaddy:"Legendary Golf Resort",locu:"golf"},{godaddy:"Little League",locu:"fitness"},{godaddy:"Lotus Yoga & Fitness",locu:"fitness"},{godaddy:"Mountain Biking",locu:""},{godaddy:"My Athlete",locu:"fitness"},{godaddy:"Outdoor Recreation",locu:""},{godaddy:"Pool Club",locu:"poolhalls"},{godaddy:"Power Fitness",locu:"fitness"},{godaddy:"Rugby",locu:"fitness"},{godaddy:"Skate Surf and Snow",locu:"surfing"},{godaddy:"Skydiving Club",locu:"skydiving"},{godaddy:"Soccer Coaching",locu:"fitness"},{godaddy:"Sports Camp",locu:"fitness"},{godaddy:"Summer Camp",locu:"summer_camps"},{godaddy:"Swimming School",locu:"swimminglessons"},{godaddy:"Underwater",locu:""},{godaddy:"Wake and Lake",locu:""},{godaddy:"WakeUp Water Sports",locu:""}]},{section:"Transportation, Auto",items:[{godaddy:"Car Repair",locu:"autorepair"},{godaddy:"Car Repair Company",locu:"autorepair"},{godaddy:"Car Repair Service",locu:"autorepair"},{godaddy:"Fuel & Gas",locu:""},{godaddy:"Gears Auto Repair",locu:"autorepair"},{godaddy:"Luxury Transport",locu:"limos"},{godaddy:"On Time Trucking",locu:"movers"},{godaddy:"Special Event Transport",locu:"limos"},{godaddy:"Transportation Service",locu:"movers"},{godaddy:"Trucking Service",locu:"movers"}]},{section:"Travel, Hotels",items:[{godaddy:"180 South",locu:""},{godaddy:"Bed & Breakfast",locu:""},{godaddy:"Best Travel",locu:"travelservices"},{godaddy:"Boutique Hotel",locu:""},{godaddy:"Caribbean Vacation",locu:"travelservices"},{godaddy:"Continent Travel",locu:"travelservices"},{godaddy:"Equator Travel Guide",locu:"vacationrentalagents"},{godaddy:"Garden Inn",locu:""},{godaddy:"Ok Travel",locu:"vacationrentalagents"},{godaddy:"Scenic Travel",locu:"vacationrentalagents"},{godaddy:"Travel Agency",locu:"vacationrentalagents"},{godaddy:"Travel Guide",locu:"vacationrentalagents"},{godaddy:"Tropical Vacation",locu:"vacationrentalagents"},{godaddy:"Winery Classic",locu:"restaurants"},{godaddy:"World Travel",locu:"travelservices"}]}]}
}),define("libs/jquery/plugins/jquery.xDomainRequest",["jquery"],function(e){if(!e.support.cors&&e.ajaxTransport&&window.XDomainRequest){var t=/^https?:\/\//i,n=/^get|post$/i,i=new RegExp("^"+location.protocol,"i"),a=/text\/html/i,r=/\/json/i,o=/\/xml/i;e.ajaxTransport("text html xml json",function(s,l){if(s.crossDomain&&s.async&&n.test(s.type)&&t.test(s.url)&&i.test(s.url)){var d=null,c=(l.dataType||"").toLowerCase();return{send:function(t,n){d=new XDomainRequest,/^\d+$/.test(l.timeout)&&(d.timeout=l.timeout),d.ontimeout=function(){n(500,"timeout")},d.onload=function(){var t="Content-Length: "+d.responseText.length+"\r\nContent-Type: "+d.contentType,i={code:200,message:"success"},s={text:d.responseText};try{if("html"===c||a.test(d.contentType))s.html=d.responseText;else if("json"===c||"text"!==c&&r.test(d.contentType))try{s.json=e.parseJSON(d.responseText)}catch(l){i.code=500,i.message="parseerror"}else if("xml"===c||"text"!==c&&o.test(d.contentType)){var u=new ActiveXObject("Microsoft.XMLDOM");u.async=!1;try{u.loadXML(d.responseText)}catch(l){u=void 0}if(!u||!u.documentElement||u.getElementsByTagName("parsererror").length)throw i.code=500,i.message="parseerror","Invalid XML: "+d.responseText;s.xml=u}}catch(p){throw p}finally{n(i.code,i.message,s,t)}},d.onprogress=function(){},d.onerror=function(){n(500,"error",{text:d.responseText})};var i="";l.data&&(i="string"===e.type(l.data)?l.data:e.param(l.data)),d.open(s.type,s.url),d.send(i)},abort:function(){d&&d.abort()}}}})}}),define("designer/app/builder/ui/canvas/elements/locu/el.locu",["jquery","knockout","designer/app/event","designer/app/builder/data/data","text!designer/app/builder/ui/canvas/elements/locu/el.locu.html","text!designer/app/builder/ui/canvas/elements/locu/mutator.locu.html","data/countries","data/locuCategories","common/stats/googleanalytics","common/abTesting/abTesting","common/inAppPurchase/inAppPurchase","common/impression/impression","common/logger/logger","/i18n/resources/client","designer/app/builder/managers/elementManager","designer/app/builder/managers/addressManager","common/persistence/persistence","libs/jquery/plugins/jquery.xDomainRequest"],function(e,t,n,i,a,r,o,s,l,d,c,u,g,h,m,b,f){function v(e){return e&&e.length}function y(e,t){return{validation:{custom:[{message:t,test:e}]}}}function _(e){u.add(u.apps.Locu,e)}function w(){return Boolean(O.LocuWidgetId)&&B.Account.AccountType!==B.accountTypes.personal}function S(){require(["common/geo/googleMaps"],function(e){var t=e({apiKey:F.googleMapApiKey,language:h.lang});k(t)})}function k(e){e.done(function(){for(;U.length>0;){var e=U.shift();e()}})}function x(e){window.google&&window.google.maps?e():(U.push(e),j||(j=!0,S()))}function C(n,i,a){function r(t){z.location={};var n=z.address();I=new window.google.maps.Geocoder,I.geocode({address:n},function(n,i){if(i==window.google.maps.GeocoderStatus.OK){var a=n[0],r={};e.each(a.address_components,function(t,n){return e.inArray("street_number",n.types)>=0?void(r.address1=n.long_name):e.inArray("route",n.types)>=0?void(r.address1+=" "+n.long_name):e.inArray("locality",n.types)>=0?void(r.locality=n.long_name):e.inArray("administrative_area_level_1",n.types)>=0?void(r.region=n.short_name):e.inArray("country",n.types)>=0?void(r.country=n.short_name):e.inArray("postal_code",n.types)>=0?void(r.postal_code=n.long_name):void 0}),z.location=r}e.isFunction(t)&&t()})}function d(){var t=z.country();return e.grep(o,function(e){return e.id===t})[0]}function u(t){e.ajax({type:"POST",url:F.matchUrl,crossDomain:!0,data:JSON.stringify(C()),dataType:"json",success:function(e){z.menuFound(!0);var n=k(e.results[0]);S(),t.call(z,n)},error:function(){S(),z.showError()}})}function S(){var t=z.menuWidgetId();try{if(window.Locu&&window.Locu.Widgets){var n=window.Locu.Widgets[t];n&&n.remove(function(){g.log("original widget and css style has been removed")},!1)}}catch(i){}e("#"+t).next().remove(),z.getCategory(function(n){e("#"+t).after("<script></script>").after("<script type='text/javascript' src='"+z.menuSource(n)+"'></script>")});var a=0,r=function(){if(w()){z.overlayMode(J),a++;var n=e("#"+t).next().attr("id");n?z.overlayMode(U):15>a?setTimeout(function(){r()},1e3):z.showError()}};r()}function k(t){if(!("external"in t&&"godaddy"in t.external&&t.external.godaddy.id==z.ID()))return void z.showError();if(!("matches"in t))return z.menuFound(!1),z.showPopover(),void z.matcherResults([]);var n=new Array,i=new Array,a=new Array;e.each(t.matches,function(e,t){if("matched"===t.match.status){var r=t.match.confidence;return r>R?void n.push(t):r>H?void i.push(t):void a.push(t)}});var r=2;1==n.length?(r=0,z.venueId(n[0].locu_id)):i.length>1&&(r=1);var o=e.merge(n,i);return e.each(o,function(e,t){t.matcherResultName=function(){return this.name+" "+this.location.locality},t.matcherResultAddress=function(){var e=this.location,t="";return e.address1&&(t+=e.address1+" "),e.address2&&(t+=e.address2+" "),e.locality&&(t+=e.locality+" "),e.region&&(t+=e.region+" "),e.postal_code&&(t+=e.postal_code+" "),e.country&&(t+=e.country),t.replace(/ *\([^)]*\) */g,"").replace(")","")}}),z.matcherResults(o),r}function C(){return{api_key:F.apiKey,max_matches:10,venues:[{external:{godaddy:{id:z.ID()}},name:z.name(),location:z.location}]}}function T(){var t=O.templateName,n=s["default"],i=!1;return e.each(s.categories,function(a,r){return e.each(r.items,function(e,a){return i?!1:a.godaddy===t?(i=!0,n=a.locu,!1):void 0}),i?!1:void 0}),n||s["default"]}function E(t){var n=e(".locu-web-menu");0!=n.length&&(t>1e3?n.removeClass("narrow").addClass("wide"):600>t?n.removeClass("wide").addClass("narrow"):n.removeClass("narrow").removeClass("wide"))}function P(){c.ShowUpgradeDialog({clientTrackingValue:"locu",onCloseCallback:function(e){z.needUpgrade(e.AccountType===B.accountTypes.personal)}})}function D(){return{name:M.Name,address:M.Address,email:M.Email,phone:M.Phone}}function V(n){var i=[{text:h.resources.Edit,tip:h.resources.Edit,cssClass:"wsb-tool-Edit",click:function(){z.editWidget()}},n.editProperties,e.extend(n["delete"],{click:function(){l.trackEvent("general_settings_modal","delete",z.Type()),z.Locked()||m.deleteElement(z),z.hideActionMenu(),_(W.LocuDeleteLocuFromPage)}}),n.layoutCommands],a={text:h.resources.Client__Designer__Auto_Height,tip:h.resources.Client__Designer__Auto_Height,cssClass:t.computed(function(){return"wsb-tool-check "+(z.LocuAutoHeight()?"toggle-on":"toggle-off")},z,{deferEvaluation:!0}),click:function(){return z.LocuAutoHeight(!z.LocuAutoHeight()),!1}};return q&&(i.splice(1,0,{text:h.resources.Client__Designer__Reset_OAuth,tip:h.resources.Client__Designer__Reset_OAuth,cssClass:"wsb-tool-Edit",click:function(){f.Get("/api/websites/{websiteId}/locu",function(e){e&&alert(h.resources.Client__Designer__OAuth_data_reset_successfully)})}}),i.splice(1,0,{text:h.resources.Client__Designer__Show_Error,tip:h.resources.Client__Designer__Show_Error,cssClass:"wsb-tool-Edit",click:function(){return z.showError(),z.hideActionMenu(),!1}})),i.splice(1,0,a),i}n.call(this,i);var z=this,j="login",U="none",J="loading",Z="error",X="createAccount",Q="popover";this.forcesLowerNeighborsToMove(!0),this.Styling.ShowAdvancedTab(!1),this.Width.Min(100),this.Height.Min(200),this.getActionMenuItems=function(){return V(this.getCommands())},a&&(this.pixelWidth(845),this.pixelHeight(800)),z.napsoc=D(),z.countries=o,z.location=null,z.minWidth=this.Width.Min(),z.minHeight=this.Height.Min(),z.Title=h.resources.Locu,z.SettingsTitle=h.resources.Locu_Settings,z.loadingImagePath=N.amdPathRoot+"/images/progress.gif",z.needUpgrade=t.observable(B.Account.AccountType===B.accountTypes.personal),z.menuFound=t.observable(!1),z.overlayMode=t.observable(U),z.email=t.observable(z.napsoc.email()),z.address=t.observable(z.napsoc.address()),z.name=t.observable(z.napsoc.name()).extend(y(v,$)),z.phone=t.observable(z.napsoc.phone()),z.fax=t.observable(""),z.address1=t.observable(""),z.address2=t.observable(""),z.locality=t.observable("").extend(y(v,G)),z.postal_code=t.observable(""),z.region=t.observable("").extend(y(v,K)),z.country=t.observable("US"),z.emailDisabled=t.observable(!0),z.iframeUrl=t.observable(""),z.matcherResults=t.observableArray(),z.venueId=t.observable(O.LocuVenueId),z.locuCategory=t.observable(""),z.menuWidgetId=t.computed(function(){return"-locu-"+z.ID()}),z.showOverlay=t.computed(function(){return z.overlayMode()!=U}),z.hasRegions=t.computed(function(){var e=d();return void 0!==e.type}),z.regions=t.computed(function(){var t=d();return t.regions?e.map(t.regions,function(e){return e instanceof Object?e.id:e}):void 0}),z.regionType=t.computed(function(){var e=d();return e.type+':<span class="wsb-required">*</span>'}),z.isCreateNewBusinessValid=t.computed(function(){return z.name.isValid()&&z.locality.isValid()&&z.region.isValid()},z,{deferEvaluation:!0}),z.getLoginUrl=t.computed(function(){var e={};if(z.venueId())e.LocuId=z.venueId();else{var n={name:"Name",address1:"Address1",address2:"Address2",locality:"Locality",region:"Region",country:"Country",postal_code:"PostalCode",phone:"Phone",fax:"Fax"};for(p in n){var i=z[p]();i&&(e[n[p]]=i)}}e.Categories=[z.locuCategory()];var a=A.address.currentPage(),r=L.isReseller?"true":"false";return"/api/websites/{websiteId}/locu?venue="+encodeURIComponent(t.toJSON(e))+"&pageId="+a+"&reseller="+r}),z.overlayText=t.computed(function(){return z.needUpgrade()?{title:h.resources.Client__Locu__Create_Menu_In_Minutes,description:h.resources.Client__Locu__Create_Menu_Description,btnLabel:h.resources.Upgrade,btnCss:"btn-upgrade"}:{title:h.resources.Client__Locu__Create_Menu_In_Minutes,description:h.resources.Client__Locu__Create_Menu_Description,btnLabel:h.resources.Client__Designer__Get_Started,btnCss:"btn-success"}}),z.napsoc.address.subscribe(function(e){w()||(z.address(e),z.location=null,z.getMatches())}),z.napsoc.name.subscribe(function(e){w()||(z.name(e),z.getMatches())}),z.pixelHeight.subscribe(function(){E(z.pixelWidth())}),z.pixelWidth.subscribe(function(e){E(e)}),z.LocuAutoHeight.subscribe(function(e){e===!0&&window.locuMenuResizeCallback(z)}),z.overlayMode.subscribe(function(e){e!==U&&z.state("view")}),z.resetColumns=function(){return E(z.pixelWidth(),z.pixelHeight()),!0},z.setLocation=function(){null!=z.location&&(z.location.country&&z.country(z.location.country),z.location.region&&z.region(z.location.region),z.location.locality&&z.locality(z.location.locality),z.location.address1&&z.address1(z.location.address1),z.location.postal_code&&z.postal_code(z.location.postal_code))},z.showError=function(){z.overlayMode(Z),w()||_(W.LocuGetError)},z.openMenu=function(){z.showCreateAccount()},z.notImplemented=function(){alert(h.resources.Client__Designer__To_be_implemented)},z.showPopover=function(){z.overlayMode(Q)},z.closeOverlay=function(){z.overlayMode(U)},z.showCreateAccount=function(){z.overlayMode(J),w()||S(),z.getCategory(function(e){z.locuCategory(e),f.Get(z.getLoginUrl(),function(e){if(e.needAuth)return z.iframeUrl(e.url),void setTimeout(function(){z.overlayMode(X)},0);if(z.venueId(e.locuId),e.widgetId&&e.locuId){z.overlayMode(J),O.LocuWidgetId=e.widgetId,O.LocuVenueId=e.locuId,z.overlayMode(U),Y.save();var t=e.url;_(W.LocuSignedIn),window.wsb.gotoAddress("","menu",{url:t,returnPath:b.getCurrentPath()})}else z.showError()},z.showError)})},z.showLogin=function(){z.overlayMode(j)},z.changeEmail=function(){z.emailDisabled(!1)},z.showStart=function(e){switch(e){case 0:z.menuFound(!0),z.showPopover();break;default:z.menuFound(!1),z.showPopover()}},z.menuSource=function(e){var t=z.menuWidgetId();if(!w()){var n="&placeholder=true&category="+e,i=z.venueId(),a=i===O.LocuVenueId?n:"&venue-id="+i+n;return F.devUrl+"?widget-key="+F.widgetKey+"&skip-reset=true&script-id="+t+a}return F.merchantUrl+"?id="+O.LocuWidgetId+"&skip-reset=true&medium=web&script-id="+t},z.postMessage=function(t){var n=e("#"+z.ID()).find("iframe");if(0==n.length&&(n=e("iframe.wsb-shell-locu-iframe")),0!=n.length){var i=n[0].src.split("/");n[0].contentWindow.postMessage(t,i[0]+"//"+i[2])}},z.editWidget=function(){return _(W.LocuEditedOnPage),z.overlayMode()!=J?(z.openMenu(),z.hideActionMenu(),!1):void 0},z.getCategory=function(t){if(z.locuCategory())t(z.locuCategory());else{var n="/api/websites/"+L.websiteId+"/themes/"+B.TemplateId;e.ajax({url:n,type:"GET",dataType:"json"}).done(function(e){z.locuCategory(e.LocuCategory&&e.LocuCategory.Name?e.LocuCategory.Name.toLowerCase():T()),t(z.locuCategory())}).fail(function(){z.locuCategory(T()),t(z.locuCategory())})}},z.getMatches=function(){return z.overlayMode(J),null==z.location?void x(function(){r(function(){z.setLocation();var e="";z.location.locality&&(e+=z.location.locality+" "),z.location.region&&(e+=z.location.region+" "),z.location.country&&"US"!=z.location.country&&(e+=z.location.country+" "),e&&z.address(e),u(z.showStart)})}):void u(z.showStart)},z.btn_getStarted_click=function(){l.trackEvent("locu_settings","get_started","button"),z.needUpgrade()?(_(W.LocuClickedUpgradeLink),P()):(_(z.menuFound()?W.LocuStrongMatchContinue:W.LocuCreateNewBusinessContinue),z.openMenu())},z.btn_getStartedCancel_click=function(){l.trackEvent("locu_settings","cancel_getstarted","link"),m.deleteElement(z),z.hideActionMenu(),_(W.LocuDeleteLocuFromPage)},z.refreshFeed_click=function(){w()?S():z.openMenu()},z.afterRender=function(t){if(z.visible()){if(!w())return z.getMatches(),void(e.isFunction(t)&&t(z));S(),e.isFunction(t)&&t(z)}},z.onRemove=function(){},z.onAnchorChange=function(){},z.startResize=function(){z.LocuAutoHeight(!1)},z.dblClick=function(){z.showOverlay()||z.isLocalizedThemeMode()||z.editWidget()},z.onResized=function(){},z.onBeforeShowMenu=function(){},A.address.currentPage.subscribe(function(){z.visible()&&z.afterRender()})}function T(t){if(-1!=e.inArray(t.origin.toLowerCase(),["https://locu.com","https://locu.godaddy.com","https://locu.test-godaddy.com","https://locu.dev-godaddy.com","https://staging.locu.com","https://kronos.locu.com","https://kronos.staging.locu.com"])){var n=JSON.parse(t.data);n.recipient&&"godaddy"===n.recipient&&e.each(z,function(e,t){switch(n.type){case"login":case"signup":if("cancel"===n.result&&(w()||t.showPopover(),"signup"==n.type?_(W.LocuAbandonedSignUp):"login"==n.type&&_(W.LocuAbandonedSignIn)),"fail"===n.result)return t.overlayMode("createAccount");if("loading"===n.result)return t.overlayMode("loading");break;case"dashboard-loaded":return void t.closeOverlay();case"last-updated":return void t.postMessage({type:"last-updated",recipient:"locu",time:parseInt((new Date).getTime()/1e3)});case"menu-updated":return void(n.locu_id!=t.venueId())}})}}function E(){e.each(z,function(e,t){t.afterRender()})}function P(){e.each(z,function(e,t){t.closeOverlay()})}function D(){e.each(z,function(e,t){t.showError()})}var I,A,M,O,L,N,B,F,R,H,V="locu",z={},j=!1,U=[],W=u.types,q="enable"===d.getOption("resetLocuOAuth"),$=h.resources.Client__Designer__Enter_your_business_name,G=h.resources.Client__Designer__Enter_a_city,K=h.resources.Client__Designer__Select_a_country,Y=i.saver;window.attachEvent?window.attachEvent("onmessage",T,!1):window.addEventListener("message",T,!1),window.locuMenuResizeCallback=function(t){if(t&&t.Height&&t.LocuAutoHeight()===!0){var n=e("#"+t.ID()).find(".locu-widget-wrapper");if(0==n.length)return;var i=n.height(),a=i-t.pixelHeight();a&&(t.lowerElements=void 0,t.Height(i+1+"px"))}t&&t.resetColumns?t.resetColumns():window.updateLocuColumns&&window.updateLocuColumns()},window.redirectToLocuEditor=function(e,t,n){t&&n?(O.LocuWidgetId=t,O.LocuVenueId=n,P(),window.wsb.gotoAddress("","menu",{url:e,returnPath:b.getCurrentPath()}),_(W.LocuSignedIn)):D()};var J=function(e,t){t?(e.Width="845px",e.Height="800px",e.LocuAutoHeight=!0):(e.Width=e.Width||"845px",e.Height=e.Height||"800px",e.LocuAutoHeight=void 0!==e.LocuAutoHeight?e.LocuAutoHeight:!0)},Z=function(e,t){A=i.getDataModel(),M=A.napsoc,O=A.settings,L=A.user,N=A.config,B=A.info,e.append(a).append(r),F=N.locuConfig,R=F.strongConfidence,H=F.sosoConfidence,n.on(n.events.refreshLocu,E),t(null,V)},X=function(e,t,n){C.prototype=Object.create(e.prototype);var i=new C(e,t,n);return z[i.ID()]=i,i};return{name:V,initModel:J,load:Z,createElementViewModel:X}}),define("text!designer/app/builder/ui/canvas/elements/shufflecontainer/el.shufflecontainer.html",[],function(){return'<script type="text/html" id="wsb-canvas-template-shufflecontainer">\r\n    <div class="el-shufflecontainer" data-widget-content="true" data-bind="event: { mouseleave: hideHover }">\r\n        <div class="el-shufflecontainer-selected"\r\n             data-bind="style: { width: selectedContainer.Width, height: selectedContainer.Height, top: selectedContainer.Top, left: selectedContainer.Left },\r\n                        visible: selectedId() && showSelected,\r\n                        event: { mousedown: ignore }, mousedownBubble: false">\r\n           \r\n        </div>\r\n        <div class="el-shufflecontainer-drag"\r\n             data-bind="style: { width: dragContainer.Width, height: dragContainer.Height, top: dragContainer.Top, left: dragContainer.Left },\r\n                visible: hoveredId,\r\n                css: { \'el-shufflingcontainer_faded\': isShuffling },\r\n                event: { mousedown: startShuffle, click: editElement }, \r\n                mousedownBubble: false">\r\n           \r\n            <span class="el-shufflecontainer-drag-contents" data-bind="html: hoveredHtml"></span>\r\n            <span class="el-shufflecontainer-drag-controls">\r\n                <span class="cf-controls-copy-icn" data-bind="event: { click: copyElement, mousedown: ignore },\r\n                        tooltip: i18N.Copy,\r\n                        mousedownBubble: false, clickBubble: false"></span>\r\n                <span class="cf-controls-settings-icn" data-bind="event: { click: editElement, mousedown: ignore },\r\n                        tooltip: i18N.Settings,\r\n                        mousedownBubble: false, clickBubble: false"></span>\r\n                <span class="cf-controls-delete-icn" data-bind="    event: { click: deleteElement, mousedown: ignore },\r\n                        tooltip: i18N.Delete,\r\n                        style: { visibility: (hasOnlyOneElement() ? \'hidden\' : \'visible\') },\r\n                        mousedownBubble: false, clickBubble: false"></span> \r\n            </span>\r\n        </div>\r\n        <div data-bind="attr: { \'data-groupId\': ID }" \r\n             class="el-shufflecontainer-group">\r\n            <!-- ko foreach: ChildElements -->\r\n            <div class="el-shufflecontainer-list" data-bind="event: { mousemove: $parent.mouseMove }, attr: { id: ID }">\r\n                <!-- ko template: \'wsb-canvas-template-\' + (Type() || \'default\') -->\r\n                <!-- /ko -->\r\n            </div>\r\n            <!-- /ko -->\r\n        </div>\r\n        <div class="el-shufflecontainer-placeholder"\r\n                 data-bind="style: { width: placeHolder.Width, height: placeHolder.Height, top: placeHolder.Top },\r\n                            visible: hoveredId"></div>\r\n    </div>\r\n</script>\r\n'}),define("text!designer/app/builder/ui/canvas/elements/shufflecontainer/mutator.shufflecontainer.html",[],function(){return'<script type="text/html" id="mutator-template-element-shufflecontainer">\r\n</script>'}),define("designer/app/builder/ui/canvas/elements/shufflecontainer/el.shufflecontainer",["text!designer/app/builder/ui/canvas/elements/shufflecontainer/el.shufflecontainer.html","text!designer/app/builder/ui/canvas/elements/shufflecontainer/mutator.shufflecontainer.html","designer/app/builder/managers/elementManager","designer/app/builder/managers/addressManager","jquery","designer/app/builder/data/data","designer/app/builder/ui/uiHelper","knockout","common/stats/googleanalytics","common/logger/logger","/i18n/resources/client"],function(e,t,n,i,a,r,o,s,l,d,c){function u(){function e(){_.each(d.ChildElements(),function(e){e.showFlyout&&e.showFlyout(!1)}),d.hideActionMenu()}function t(){d.hoveredId(!1),d.hoveredHtml(""),u=void 0,d.selectedId(!1),e(),h=void 0,d.hideProperties(!0),d.suppressActionMenuFromOpening=!1}function r(e){return e.replace(":","")}var d=this;d.ChildElements=s.observableArray(),d.updateEmailFields=function(e){var t=n.getAllElementsByGroupId(d.ID()),i=t.filter(function(e){return e.isEmail&&e.isEmail()}).sort(function(e,t){return parseInt(e.Top)<parseInt(t.Top)}),a=i[0];if(a){void 0==e&&(e=d.mutatorViewModel.gemSubmit()),a.configData().gemSubmit(e),a.updateFormConfigData();for(var r=1;r<i.length;r++){var o=i[r];o.configData().gemSubmit(!1),o.updateFormConfigData()}}},d.updateChildElements=function(e,t,r,o){b.disable("customfrom childupdate");var s;if(e){s=n.getAllElementsByGroupId(d.ID()),s.sort(function(e,t){return e.pixelTop()-t.pixelTop()});var l=d.pixelLeft();s.forEach(function(e){e.pixelLeft(l)}),r&&s.forEach(function(e){e.updateHeight()}),d.ChildElements(s)}else s=_.map(d.ChildElements(),function(e){return e});if(!o){var c=s[0];c.updateAfterGrouped&&c.updateAfterGrouped(d)}t&&(d.pixelLeft(t.left),d.pixelTop(t.top)),s.length>1&&v.address.currentAction()===i.actions.edit&&_.each(s,function(e){var t=a("#"+e.ID()).position().top-f;e.pixelTop(d.pixelTop()+t)}),d.sizeToFit(),b.enable("customfrom childupdate")},b.subscribe(d.ChildElements);var c=n.getAllElementsByGroupId(d.ID());c.sort(function(e,t){return e.pixelTop()-t.pixelTop()}),d.ChildElements(c);var u,h,w=[],S=c[0],k=0,x=0,C=0,T=!1,E=_.filter(c,function(e){return e.mutatorViewModel})[0];this.Title=S.i18N.Title,this.SettingsTitle=S.i18N.SettingsTitle,this.MutatorType=S.Type,this.i18N={Copy:m.Server__Copy_form,Settings:m.Server__Settings_form,Delete:m.Server__Delete_form},this.mutatorViewModel=E?E.mutatorViewModel:{},this.getActionMenuItems=p,d.showVerticalResizeHandles(!1),d.Styling.BackgroundColor(!1),d.Styling.Border(!1),d.Styling.Shadow(!1),d.Styling.RoundedCorner(!1),d.Styling.Transparency(!1),d.Styling.Padding(!1),d.Styling.Size(!1),d.Styling.ShowAdvancedTab(!1),d.Styling.ShowBasicTabOnly(!0),d.boundingBoxPadding(f);d.hasOnlyOneElement=s.observable(c.length<=2),d.selectedId=s.observable(!1),d.showSelected=s.observable(!0),d.hoveredId=s.observable(!1),d.isShuffling=s.observable(!1),d.hoveredHtml=s.observable(""),d.placeHolder={Width:s.observable(0),Height:s.observable(0),Top:s.observable(0)},d.dragContainer={Width:s.observable(0),Height:s.observable(0),Top:s.observable(0),Left:s.observable(0)},d.selectedContainer={Width:s.observable(0),Height:s.observable(0),Top:s.observable(0),Left:s.observable(0)},d.outlineWidth=s.observable(),d.outlineHeight=s.observable(),d.ensureAccurateOuterSize=function(e){b.disable();var t=e||this,n=t.getDomElement().parent();if(n&&n.length){var i=n.width(),a=n.height(),r=t.pixelWidth(),o=t.pixelHeight();t.outerSizeDiff.widthDiff(i-r),t.outerSizeDiff.heightDiff(a-o),b.enable()}},d.ignore=function(){return!1},d.mouseMove=function(e){!d.isSelected()||d.isMoving()||d.isResizing()||d.isShuffling()||(u=e,e.disableDrag&&e.disableDrag()||d.hoveredId(u.ID()))},d.startShuffle=function(e,n){d.hideActionMenu(),b.collect("shuffle");var i=void 0,r=0,s=!1,l=d.dragContainer,c=void 0,p=void 0,h=_.map(d.ChildElements(),function(e){return e}),m=_.filter(h,function(e){return!(e.disableDrag&&e.disableDrag())}).length,v=g(h),y=void 0===n.offsetY?n.originalEvent?n.originalEvent.layerY:n.layerY:n.offsetY,w=u.pixelTop()+y,S=u.ID(),k=u,x=_.findIndex(h,function(e){return e.ID()===S}),C=v[x],E=x;return l.startLeft=parseInt(l.Left()),l.startTop=parseInt(l.Top()),o.captureDrag({initEvent:n,threshhold:10,dragCallback:function(e){if(T=!0,d.isShuffling(!0),d.selectedId(!1),d.allowBoundingBox(!1),l.Left(l.startLeft+e.x+"px"),l.Top(l.startTop+e.y+"px"),0!==e.y){var t=r===e.y?i:e.y-r>0?1:-1,n=w+e.y,o=i!=t||void 0===i,u=!o&&!s&&(0>t&&C>n||t>0&&n>C);if(u){p=x,c=h[p];var g=a("#"+c.ID()),b=g.position().top;d.placeHolder.Top(b+"px"),d.placeHolder.Height(c.Height()),d.placeHolder.Width(c.Width()),o=!0}o&&(x+=t,0>x?(x=0,s=!0):x>=m?(x=m-1,s=!0):s=!1,k=h[x],C=v[x],i=t),r=e.y,i=t}},finishedCallback:function(){if(d.isShuffling()){if(l.Left(f+"px"),l.Top(d.placeHolder.Top()),void 0!==p&&E!=p){var e=d.pixelTop(),n=h.splice(E,1);h.splice(p,0,n[0]),d.ChildElements(h),_.each(d.ChildElements(),function(t){var n=a("#"+t.ID()).position().top-f;t.pixelTop(e+n)})}d.isShuffling(!1),d.allowBoundingBox(!0),t(),b.enable("shuffle")}}}),!1},d.copyElement=function(){var e=u;b.collect("copy form element"),l.trackEvent("custom_form_elements","copyElement",r(e.formLabel())),n.copyElement(e,d.ID()),d.updateChildElements(!0),b.enable("copy form element"),d.hasOnlyOneElement(d.ChildElements().length<=2)},d.addElement=function(){b.collect("add form element"),t(),l.trackEvent("general_settings","form_addelement","icon");var e=n.getAllElementsByGroupId(d.ID());h=e[0].createNewElement(),d.selectedId(h.ID()),setTimeout(function(){b.enable("add form element")},0),d.hasOnlyOneElement(d.ChildElements().length<=2)},d.deleteElement=function(){d.hasOnlyOneElement()||(l.trackEvent("custom_form_elements","deleteElement",r(u.formLabel())),b.collect("delete form element"),u.beforeDelete&&u.beforeDelete(),n.deleteElement(u),t(),d.updateEmailFields(),d.updateChildElements(!0),b.enable("delete form element"),d.hasOnlyOneElement(d.ChildElements().length<=2))},d.editElement=function(){if(T)return void(T=!1);var t=d.hoveredId();e(),h=_.filter(d.ChildElements(),function(e){return e.ID()===t})[0],l.trackEvent("custom_form_elements","settings_elements",r(h?h.formLabel():"")),d.selectedId(t),d.hideProperties(!0),d.hoveredId(!1)},d.isSelected.subscribe(function(e){e?d.updateChildElements(!1):t()}),d.isDeleted.subscribe(function(e){e&&t()}),d.hoveredId.subscribe(function(e){if(!e)return void(d.suppressActionMenuFromOpening=!1);u.updateHeight&&u.updateHeight();var t=u.Width(),n=u.Height(),i=a("#"+u.ID()),r=i.position().top;d.placeHolder.Width(t),d.placeHolder.Height(n),d.placeHolder.Top(r+"px"),d.dragContainer.Width(x+parseInt(t)+k+"px"),d.dragContainer.Height(10+parseInt(n)+5+"px"),d.dragContainer.Top(r+"px"),d.dragContainer.Left(f+"px"),d.hoveredHtml(i.html()),d.suppressActionMenuFromOpening=!0}),d.selectedId.subscribe(function(e){if(_.each(w,function(e){e.dispose()}),!e)return void(h.showFlyout&&h.showFlyout(!1));var t=h.Width(),n=h.Height(),i=a("#"+h.ID()),r=i.position().top;d.selectedContainer.Width(x+parseInt(t)+k+"px"),d.selectedContainer.Height(10+parseInt(n)+5+"px"),d.selectedContainer.Top(r+"px"),d.selectedContainer.Left(f+"px"),h.showFlyout&&h.showFlyout(!0),h.showSelected=d.showSelected,w.push(h.Height.subscribe(function(e){d.selectedContainer.Height(10+parseInt(e)+5+"px"),d.sizeToFit()})),w.push(h.Width.subscribe(function(e){d.selectedContainer.Height(x+parseInt(e)+k+"px")}))}),d.isMoving.subscribe(function(e){e&&t()}),d.isResizing.subscribe(function(e){e&&t()}),d.afterMove=function(e){var t=d.pixelTop(),n=d.ChildElements(),i=n[0].pixelTop(),a=t-i;_.each(d.ChildElements(),function(e){var t=e.pixelTop()+a;e.Left(d.Left()),e.pixelTop(t)}),_.isFunction(e)&&e()},d.handleResize=function(){_.each(d.ChildElements(),function(e){e.pixelWidth(d.pixelWidth()-C),e.Left(d.Left())})},d.hideHover=function(){d.hoveredId(!1)},d.afterRender=function(e){if(y.test((d.ChildElements()[0].ID()||"").toString()))setTimeout(function(){d.updateChildElements(!1),a.isFunction(e)&&e(d)},100);else{var t=c[0];t.updateAfterGrouped&&t.updateAfterGrouped(d),a.isFunction(e)&&e(d)}},d.clearOutStates=function(){t()},_.each(["Layer","Shared","Locked","IncludeInMobileSite"],function(e){d[e].subscribe(function(t){_.each(d.ChildElements(),function(n){n[e](t)})})}),d.afterNewElementAdded=function(){var e=d.pixelLeft();_.each(d.ChildElements(),function(t){t.pixelLeft(e)})}}function p(){var e=this.getCommands(),t=this;return[{text:c.resources.Client__Designer__Element_Add_Element,tip:c.resources.Add,cssClass:"wsb-tool-Add-Element",click:t.addElement},e.editProperties,e.clone,e["delete"],e.layoutCommands]}function g(e){return _.map(e,function(e){return Math.round(e.pixelTop()+e.pixelHeight()/2)})}var h="shufflecontainer",m=c.resources,b=r.undoer,f=15,v=r.getDataModel(),y=/^-\d+$/;return{name:h,initModel:function(){},load:function(n,i){n.append(e).append(t),i(null,h)},createElementViewModel:function(e,t){return u.prototype=new e(t),u.prototype.constructor=u,new u(t)}}}),define("text!designer/app/builder/ui/canvas/elements/subscribe/el.subscribe.html",[],function(){return'<script type="text/html" id="wsb-canvas-template-subscribe">\r\n    <div class="wsb-text-element-shield" style="top: 0; bottom: 0; left: 0; right: 0; z-index: 1;"></div>\r\n    <div data-widget-content="true" data-bind="\r\n                subscribeEditor: { editable: isEditing },\r\n                attr: { \'id\': \'wsb-subscribe-\'+ ID(),\r\n                        \'class\': \'wsb-subscribe \' + CssClasses(),\r\n                        \'style\': styleNoPadding }">\r\n        <div class="form" data-bind="\r\n             css: { \'subscribe-horizontal\': isHorizontal,\r\n                    \'subscribe-verticalOne\': isVerticalOne,\r\n                    \'subscribe-verticalTwo\': isVerticalTwo\r\n             }">\r\n            <div class="form-element wsb-subscribe-input-container">\r\n                <input disabled class="form-value wsb-subscribe-input" type="email" data-bind="watermark: localizedSubscribePlaceholder" />\r\n            </div>\r\n            <div class="wsb-subscribe-submit-container">\r\n                <input disabled class="form-submit wsb-subscribe-submit" type="button" data-bind="value: localizedSubscribeLabel">\r\n            </div>\r\n        </div>\r\n    </div>\r\n</script>'}),define("text!designer/app/builder/ui/canvas/elements/subscribe/mutator.subscribe.html",[],function(){return'<script type="text/html" id="mutator-template-element-subscribe">\r\n    <!-- ko if: $data.Type() === \'subscribe\' -->\r\n    <!-- ko with: mutatorViewModel -->\r\n    <div class="wsb-canvas-mutator-inner">\r\n        <div class="wsb-canvas-mutator-ctrl-outer clearfix">\r\n            <div class="wsb-canvas-mutator-ctrl-label wsb-btn-label" data-bind="text: i18Dict.ButtonText">\r\n            </div>\r\n            <div class="wsb-canvas-mutator-ctrl-input wsb-btn-label-property clearfix">\r\n                <input type="text" data-bind="value: SubscribeLabel, valueUpdate: \'afterkeydown\'" class="wsb-text-box wsb-redo-select"/>\r\n            </div>\r\n        </div>\r\n        <div class="wsb-canvas-mutator-ctrl-outer clearfix">\r\n            <div class="wsb-canvas-mutator-ctrl-label wsb-btn-label" data-bind="text: i18Dict.PlaceholderText">\r\n            </div>\r\n            <div class="wsb-canvas-mutator-ctrl-input wsb-btn-label-property clearfix">\r\n                <input type="text" data-bind="value: SubscribePlaceholder, valueUpdate: \'afterkeydown\'" class="wsb-text-box wsb-redo-select"/>\r\n            </div>\r\n        </div>\r\n        <div class="wsb-canvas-mutator-ctrl-outer clearfix">\r\n            <div class="wsb-canvas-mutator-ctrl-label wsb-layout-label" data-bind="text: i18Dict.Layout">\r\n            </div>\r\n            <a href="#" class="subscribe-layout-btn subscribe-horizontal-button" data-bind="\r\n                        css: { \'active-layout\': isHorizontal },\r\n                        click: makeHorizontal,\r\n                        clickBubble: false"></a>\r\n            <a href="#" class="subscribe-layout-btn subscribe-verticalOne-button" data-bind="\r\n                        css: { \'active-layout\': isVerticalOne },\r\n                        click: makeVerticalOne,\r\n                        clickBubble: false"></a>\r\n            <a href="#" class="subscribe-layout-btn subscribe-verticalTwo-button" data-bind="\r\n                        css: { \'active-layout\': isVerticalTwo },\r\n                        click: makeVerticalTwo,\r\n                        clickBubble: false"></a>\r\n        </div>\r\n    </div>\r\n<!-- /ko -->\r\n<!-- /ko -->\r\n</script>'
}),define("designer/app/builder/ui/canvas/elements/subscribe/el.subscribe",["text!designer/app/builder/ui/canvas/elements/subscribe/el.subscribe.html","text!designer/app/builder/ui/canvas/elements/subscribe/mutator.subscribe.html","jquery","knockout","common/stats/googleanalytics","common/logger/logger","designer/app/builder/data/data","/i18n/resources/client","common/util/stringHelper","common/browser/browser","designer/app/builder/ui/controls/actionmenu/actionmenu","designer/app/builder/ui/controls/mutator/mutator","designer/app/event"],function(e,t,n,i,a,r,o,s,l,d,c,u,p){function g(e,t){function r(e){var t=e[0],i=window.getComputedStyle(t),a={};for(var r in i)i.hasOwnProperty(r)&&!n.isNumeric(r)&&l.indexOf(r)>-1&&(a[r]=i[r]);return a}e.call(this,t);var o=this;o.Styling.ShowAdvancedTab(!1),o.Styling.ShowBasicTabOnly(!0),o.Styling.Border(!1),o.Styling.Shadow(!1),o.Styling.RoundedCorner(!1),o.Styling.Transparency(!1),o.Styling.Size(!1),o.showVerticalResizeHandles(!1),o.Title=s.resources.Subscribe,o.SettingsTitle=s.resources.Subscribe_Settings,o.SubscribeLabel.subscribe(function(e){v.test(e)&&o.SubscribeLabel(e.replace(v,""))}),o.SubscribePlaceholder.subscribe(function(e){v.test(e)&&o.SubscribePlaceholder(e.replace(v,""))}),o.isHorizontal=i.computed(function(){return o.SubscribeOrientation()===y.horizontal}),o.isVerticalOne=i.computed(function(){return o.SubscribeOrientation()===y.verticalOne}),o.isVerticalTwo=i.computed(function(){return o.SubscribeOrientation()===y.verticalTwo}),o.SubscribeLabel.subscribe(function(){setTimeout(function(){o.ensureAccurateOuterSize(!1)},100)}),o.SubscribePlaceholder.subscribe(function(){setTimeout(function(){o.ensureAccurateOuterSize(!1)},100)}),o.makeHorizontal=function(){return o.SubscribeOrientation(y.horizontal),t.SubscribeOrientation(y.horizontal),a.trackEvent("subscribe-widget-orientation-change","horizontal"),o.ensureAccurateOuterSize(!1),!1},o.makeVerticalOne=function(){return o.SubscribeOrientation(y.verticalOne),t.SubscribeOrientation(y.verticalOne),a.trackEvent("subscribe-widget-orientation-change","verticalOne"),!1},o.makeVerticalTwo=function(){return o.SubscribeOrientation(y.verticalTwo),t.SubscribeOrientation(y.verticalTwo),a.trackEvent("subscribe-widget-orientation-change","verticalTwo"),!1},n.fn.textWidth=function(e,t){n.fn.textWidth.fakeEl||(n.fn.textWidth.fakeEl=n("<span>").appendTo(document.body));var i=e||this.val()||this.text();return i=n.fn.textWidth.fakeEl.text(i).html(),i=i.replace(/\s/g,"&nbsp;"),n.fn.textWidth.fakeEl.html(i).css(t),n.fn.textWidth.fakeEl.width()},o.localizedSubscribeLabel=o.getLocalizedProperty("SubscribeLabel"),o.localizedSubscribePlaceholder=o.getLocalizedProperty("SubscribePlaceholder"),o.enableBackspace=!0,o.showBoundingBox=i.computed(function(){return this.getIsSelected()&&!this.isMoving()&&!this.isResizing()&&!this.isLocalizedThemeMode()&&this.allowBoundingBox()},o),o.isEditing=i.computed(function(){return"edit"==o.state()}),o.stylePrefix="subscribe",o.styleNoPadding=i.computed({deferredEvaluation:!0,read:function(){var e=o.StyleCollection();return e.remove("padding"),e.stringify()}}),o.mutatorViewModel=new h(o);var l=["direction","font","fontFamily","fontKerning","fontSize","fontStretch","fontStyle","fontVariant","fontVariantLigatures","fontWeight","letterSpacing","lineHeight","textDecoration","textIndent","textShadow","textTransform","unicodeBidi","verticalAlign","whiteSpace","wordSpacing"];o.ensureAccurateOuterSize=function(e){var i,a=n(o.getDomElement()),s=a.find(".form"),l=(parseInt(s.css("padding-left"))||0)+(parseInt(s.css("padding-right"))||0),d=a.find(".wsb-subscribe-input"),c=a.find(".wsb-subscribe-submit"),u=r(d),p=2*(parseInt(d.css("padding-left"))||0),g=2*(parseInt(d.css("border-left"))||0),h=d.textWidth(d.attr("placeholder"),u),m=h+p+g,b=Math.ceil(c[0].getBoundingClientRect().width);if(o.SubscribeOrientation()===y.horizontal)d.css("min-width",m+"px"),i=m+b+parseInt(c.css("margin-left"));else{var f=m>b?m:b;d.css("min-width",f+"px"),i=f}if(i+=l,i>parseInt(o.Width())){var v=i+"px";o.Width(v),t.Width(v)}if(o.minWidth=i,e){var _=parseInt(d.css("margin-bottom"))||0,w=parseInt(d.css("height")),S=(parseInt(s.css("padding-top"))||0)+(parseInt(s.css("padding-bottom"))||0),k=2*w+_+S+"px";o.Height(k),t.Height(k)}},o.afterRender=function(e){o.ensureAccurateOuterSize(!0),n.isFunction(e)&&e(o)},o.boxWidth=i.observable(o.Width()),o.boxHeight=i.observable(o.Height())}function h(e){var t=this;t.i18Dict={PlaceholderText:s.resources.Server__Placeholder_text_colon,ButtonText:s.resources.Server__Button_text_colon,Layout:s.resources.Server__Layout_colon},t.Width=e.Width,t.Height=e.Height,t.CssClass=e.CssClass,t.SubscribeLabel=e.SubscribeLabel,t.SubscribePlaceholder=e.SubscribePlaceholder,t.SubscribeOrientation=e.SubscribeOrientation,t.makeHorizontal=e.makeHorizontal,t.makeVerticalOne=e.makeVerticalOne,t.makeVerticalTwo=e.makeVerticalTwo,t.isHorizontal=e.isHorizontal,t.isVerticalOne=e.isVerticalOne,t.isVerticalTwo=e.isVerticalTwo}var m="subscribe",b=s.resources.Subscribe,f=s.resources.Client__Designer__Element_Enter_email_address,v=/<\/?a(?![a-z])(?:[^<>]+)?>/gi,y={horizontal:0,verticalOne:1,verticalTwo:2};return{name:m,initModel:function(e){e.SubscribePlaceholder=""===e.SubscribePlaceholder||e.SubscribePlaceholder?e.SubscribePlaceholder:f,e.SubscribeLabel=""===e.SubscribeLabel||e.SubscribeLabel?e.SubscribeLabel:b,e.SubscribeOrientation=void 0!==e.SubscribeOrientation?e.SubscribeOrientation:y.verticalOne},createElementViewModel:function(e,t){g.prototype=Object.create(e.prototype);var n=new g(e,t);return n.Styling.BackgroundColor(!1),n.Styling.Padding(!1),p.once("cssLoaded",function(){n.ensureAccurateOuterSize(!0)}),n},load:function(n,i){n.append(e).append(t),i(null,m)}}}),define("designer/app/builder/ui/canvas/groups/groups",["jquery","lodash","knockout","libs/async-util/async","designer/app/builder/data/data","designer/app/builder/managers/elementManager","designer/app/builder/managers/pageManager","designer/app/builder/ui/controls/gridGuides/gridGuidesFlyout","designer/app/builder/ui/canvas/groups/bindingHelper","text!designer/app/builder/ui/canvas/groups/groups.html","designer/app/builder/ui/canvas/elements/el.default","designer/app/builder/ui/canvas/elements/youtube/el.youtube","designer/app/builder/ui/canvas/elements/share/el.share","designer/app/builder/ui/canvas/elements/text/el.text","designer/app/builder/ui/canvas/elements/yelp/el.yelp","designer/app/builder/ui/canvas/elements/form/el.form","designer/app/builder/ui/canvas/elements/customform/el.customform","designer/app/builder/ui/canvas/elements/audioplayer/el.audioplayer","designer/app/builder/ui/canvas/elements/paypal/el.paypal","designer/app/builder/ui/canvas/elements/image/el.image","designer/app/builder/ui/canvas/elements/map/el.map","designer/app/builder/ui/canvas/elements/shape/el.shape","designer/app/builder/ui/canvas/elements/line/el.line","designer/app/builder/ui/canvas/elements/navigation/el.navigation","designer/app/builder/ui/canvas/elements/gallery/el.gallery","designer/app/builder/ui/canvas/elements/facebook/el.facebook","designer/app/builder/ui/canvas/elements/twitter/el.twitter","designer/app/builder/ui/canvas/elements/blog/el.blog","designer/app/builder/ui/canvas/elements/button/el.button","designer/app/builder/ui/canvas/elements/carousel/el.carousel","designer/app/builder/ui/canvas/elements/htmlsnippet/el.htmlsnippet","designer/app/builder/ui/canvas/elements/homefinder/el.homefinder","designer/app/builder/ui/canvas/elements/locu/el.locu","designer/app/builder/ui/canvas/elements/shufflecontainer/el.shufflecontainer","designer/app/builder/ui/canvas/elements/subscribe/el.subscribe"],function(e,t,n,i,a,r,o,s,l,d,c){function u(e){return t.transform(e,function(e,n){return t.isFunction(n.createElementViewModel)&&t.isFunction(n.initModel)&&t.isFunction(n.load)&&"string"==typeof n.name?e[n.name]=n:void 0})}function p(){m=this,m.groups=n.observableArray(),m.groups.push.apply(m.groups,h("root")),l.listenToChangesToElements(),r.CreateGroupContainerIfNeeded(m.groups())}function g(e,i){var a=this,d=e.groupId();a.groupId=e.groupId,a.type=e.type,a.maxZIndex=n.observable(0),a.groups=n.observableArray(),i||a.groups.push.apply(a.groups,h(d));var c=i?[]:t.chain(b.website.elements()).filter(function(e){return n.toJS(e.groupId)==d}).map(function(e){var t=l.convertNewModelToViewModel(e,!1);return t.Layer()>a.maxZIndex()&&a.maxZIndex(t.Layer()),t}).valueOf();return c.length>0&&r.elViewModelMap.valueHasMutated(),a.elements=n.observableArray(c||[]),a.elements().forEach(function(e){l.callAfterRender(e)}),a.groupClassName=n.computed(function(){var e=a.groupId();switch(e){case"content":return"wsb-canvas-page page";case"footer":return"wsb-canvas-page-footer footer";default:return""}}),a.groupDomId=n.computed(function(){var e=a.groupId();switch(e){case"content":return"wsb-group-content";case"footer":return"wsb-canvas-template-footer";default:return""}}),a.containerClassName=n.computed(function(){var e=a.groupId();switch(e){case"content":return"wsb-canvas-template-container";case"footer":return"footer-container";default:return""}}),a.containerId=n.computed(function(){var e=a.groupId();return"wsb-canvas-template-"+e+"-container"}),a.currentPage=n.computed(function(){return o.getCurrentPage()}),a.minHeight=n.computed(function(){var e=a.currentPage(),t=e.Id(),n=0;return a.elements().forEach(function(e){e.isDeleted()||"footer"!=d&&(e.isNewlyDragged()||e.Shared()&&e.isMoving()||e.pageIds().indexOf(t)<0||(n=Math.max(n,parseInt(e.boundingBoxBottom()))))}),isFinite(n)||(n=0),n}),a.minHeightFooter=n.computed(function(){var e=a.currentPage(),t=e.Id(),n=0;return a.elements().forEach(function(e){e.isDeleted()||e.isNewlyDragged()||e.Shared()&&e.isMoving()||e.pageIds().indexOf(t)<0||"footer"==d&&(n=Math.max(n,parseInt(e.boundingBoxBottom())))}),isFinite(n)||(n=0),n}),"content"===d&&a.minHeight.subscribe(function(e){var t=a.currentPage(),n=t.Settings;(!n.Height()||parseInt(n.Height())<e)&&n.Height(e+"px")}),a.outerStyle=n.computed(function(){var e=a.currentPage().Settings,t=e.Width(),n=e.Height(),i=a.minHeight(),r=a.minHeightFooter(),o=e.Style(),l=e.Background();switch(a.groupId()){case"content":o="display: block; margin: auto; height: "+n+"; width: "+t+"; background-color: "+l+"; min-height: "+i+"px; position: relative; ",s.drawGrid();break;case"footer":var d=Math.max(100,r);o="margin: auto; width: "+t+"; height: "+d+"px; position: relative; min-height: "+r+"px;";break;case"form":}return o}),a.innerStyle=n.computed(function(){switch(a.type()){case"content":case"form":default:return"position:absolute"}}),a}function h(e){return t.chain(b.website.groups()).filter(function(t){return t.parentId()==e}).map(function(e){return new g(e)}).valueOf()}var m,b,f,v=u(arguments),y=function(e,t){f=e.append(d),b=a.getDataModel(),c.load(e,function(){i.map(Object.keys(v),function(t,n){v[t].load(e,function(){n(null,t)})},function(){l.load({elDef:c,elementModules:v,GroupViewModel:g},f),t(null,p)})})};return{load:y}}),define("text!designer/app/builder/ui/canvas/canvas.html",[],function(){return'<div id="builder-canvas" class="wsb-canvas body" data-bind="attr: { style: fixedBackgroundStyle }, event: { click: click, mousedown: mousedown, contextmenu: click }, visible: showCanvas">\r\n\r\n    <!-- ko if: isIE9 -->\r\n    <div data-bind="attr: { style: backgroundCssForIE9OrBelowWhenNotScrollable }"></div>\r\n    <!-- /ko -->\r\n\r\n    <div class="wsb-canvas-page-container" data-bind="template: { name: \'designer-groups\', foreach: groups }, style: { paddingTop: marginTop }"></div>\r\n\r\n</div>'}),define("designer/app/builder/ui/canvas/canvas",["jquery","lodash","knockout","designer/app/builder/data/data","designer/app/event","libs/async-util/async","/i18n/resources/client","common/logger/serverLogger","common/stats/googleanalytics","common/inAppPurchase/inAppUpgradeComplete","designer/app/builder/ui/controls/actionmenu/actionmenu","designer/app/builder/ui/controls/mutator/mutator","designer/app/builder/ui/uiHelper","designer/app/builder/ui/canvas/multiselect/multiselect","designer/app/builder/ui/controls/hotkeys/hotkeys","designer/app/builder/ui/canvas/site/site","designer/app/builder/ui/canvas/groups/groups","designer/app/builder/managers/pageManager","designer/app/builder/managers/elementManager","designer/app/builder/managers/themeManager","designer/app/builder/ui/controls/csseditor/csseditor","designer/app/builder/ui/controls/hamburgerFlyOut/page","designer/app/builder/ui/controls/hamburgerFlyOut/site","text!designer/app/builder/ui/canvas/canvas.html"],function(e,t,n,i,a,r,o,s,l,d,c,u,p,g,h,m,b,f,v,y,_,w,S,k){function x(e){var t=[{text:o.resources.Background,tip:o.resources.Background,cssClass:"wsb-tool-Background",click:function(){l.trackEvent("canvas ","background","icon"),S.mutate(),c.hide()}},{text:o.resources.Client__Designer__Canvas_PageSettings,tip:o.resources.Client__Designer__Canvas_PageSettings,cssClass:"wsb-tool-pgbg",enabled:E,click:function(){l.trackEvent("canvas","page_settings","icon"),w.mutate(),c.hide()}},{cssClass:!1,text:"",click:function(){},tip:""}],n={left:e.pageX,top:e.pageY};return{menuItems:t,position:n}}var C,T,E,P=[m,b],D=[],I=!0,A=function(a,o){var l,m=e(k).appendTo(o);C=i.getDataModel(),E=n.computed(function(){return!y.isLocalizedTheme()});var b=C.user,w=C.settings;return T=i.undoer,r.map(P,function(e,t){e.load(m,function(n,i){D.push(i),t(n,e)})},function(e){l={showCanvas:C.address.isEditAction,mousedown:function(e,t){s.logFirstClick("canvas"),c.isVisible()?(c.hide(),I=!1):I=!0,p.closeFlyouts(t),u.hide(!0),v.getSelectedElements()&&(v.deselectAllElements(),I=!1),E()&&g.initiate(e,t),T.forceEnable()},disableBrowserContextMenu:function(){},marginTop:n.computed(function(){var e=f.getCurrentPage();return e.Settings.Style()}),click:function(e,t){I&&c.show(x(t))}},v.setCanvasViewModel(l),t.each(D,function(e){e.call(l)}),s.triggerTrace(s.beacons.builderLoad.steps.createCanvasViewModel,s.beacons.builderLoad.name),n.applyBindings(l,m[0]),s.triggerTrace(s.beacons.builderLoad.steps.bindCanvasViewModel,s.beacons.builderLoad.name),g.load(m),h.load(m,l),("ThemeEditMode"===b.editingMode||w.IsDdtAccount&&"1"===w.IsDdtAccount&&b.isDdtImpersonator)&&_.show(),d.showGrowls(),a&&a(e,l)}),l};return{load:A,getConfiguration:function(){return{modules:P}}}}),define("text!designer/app/builder/ui/preview/preview.html",[],function(){return'<div id="builder-preview" data-bind="visible: showPreview">\r\n    \r\n    <!-- ko if: showLoading -->\r\n    <div id="preview-loading"><table><tr><td data-bind="text: loadingText"></td></tr></table></div>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: showSaving -->\r\n    <div id="preview-loading"><table><tr>\r\n    <td>\r\n            <img data-bind="attr: { src: loadingImagePath }"/>\r\n            <span data-bind="text: savingText"></span>\r\n    </td>\r\n    </tr></table></div>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: showContent -->\r\n    <div class="wsb-preview-container" data-bind="css: {\'wsb-canvas\': isMobilePreview }">\r\n        <!--ko ifnot: isMobilePreview-->\r\n        <div id="preview-contents" data-bind="html:contentHtml"></div>\r\n        <!-- /ko-->\r\n\r\n        <!--ko if: isMobilePreview-->\r\n        <div data-bind="attr: { class: mobileContainerClass }" id="wsb-preview-mobile-container">\r\n            <div data-bind="attr: { class: mobilePhoneContainerClass }" id="wsb-preview-mobile-phone-container">\r\n                <div id="preview-contents" data-bind="html:contentHtml"></div>\r\n            </div>\r\n            <!-- ko if: displayMobileAside -->\r\n            <div class="mobile-preview-upgrade-aside">\r\n                <div data-bind="text: Strings.Get_A_Mobile_Friendly_Website" class="mobile-preview-upgrade-aside-title"></div>\r\n                <div data-bind="text: Strings.Get_A_Mobile_Friendly_Website_Content" class="mobile-preview-upgrade-aside-content"></div>\r\n                <a data-bind="text: Strings.Learn_more, click: mobileLearnMore" id="wsb-preview-mobile-learn-more" class="btn btn-success"></a>\r\n            </div>\r\n            <!-- /ko -->\r\n\r\n        </div>\r\n        <!--/ko-->\r\n        \r\n    </div>\r\n    <!-- /ko-->\r\n\r\n\r\n</div>\r\n'}),define("designer/app/builder/ui/preview/preview",["designer/app/app","designer/app/builder/managers/addressManager","jquery","lodash","knockout","/i18n/resources/client","libs/async-util/async","designer/app/builder/data/designerData","designer/app/builder/data/data","designer/app/builder/managers/elementManager","designer/app/builder/managers/themeManager","designer/app/builder/ui/uiHelper","common/logger/serverLogger","common/inAppPurchase/inAppPurchase","text!designer/app/builder/ui/preview/preview.html","wsbcore/growl"],function(e,t,n,i,a,r,o,s,l,d,c,u,p,g,h){function m(){function e(e,t,n){return t+(e?"":n)}function n(){var e=p.beacons.switchToPreview;p.startPerformanceTimers(e.name),p.triggerTrace(e.steps.switchToPreviewStart,e.name);var t=function(){setTimeout(function(){p.triggerTrace(e.steps.switchToPreviewEnd,e.name),p.postPerformance(e.name)},0)};if(C.getDirtyFlag("preview"))k={},C.hasChanges()?(T.forceEnable(),i.showSaving(!0),i.showContent(!1),C.save(function(e){e||f(function(){C.setDirtyFlag("preview",!1),t()})})):f(function(){C.setDirtyFlag("preview",!1),t()});else{var n=w.currentPage(),a=w.currentPlatform();k[n]&&k[n][a]?(b(),i.contentHtml(k[n][a]),t()):f(t)}}var i=this,o=r.resources;i.Strings={Get_A_Mobile_Friendly_Website:o.Get_A_Mobile_Friendly_Website,Get_A_Mobile_Friendly_Website_Content:o.Get_A_Mobile_Friendy_Website_Content,Learn_more:o.Learn_more},i.showLoading=a.observable(!1),i.showContent=a.observable(!1),i.showSaving=a.observable(!1),i.contentHtml=a.observable(""),i.isMobilePreview=a.computed(function(){var e=w.currentPlatform();return e===t.platforms.mobile}),i.canPublishMobile=a.computed(function(){return _.canPublishMobile()}),i.displayMobileAside=a.computed(function(){return i.isMobilePreview()&&!i.canPublishMobile()}),i.mobileContainerClass=a.computed(function(){return e(i.canPublishMobile(),"wsb-preview-mobile-container","-with-aside")}),i.mobilePhoneContainerClass=a.computed(function(){return e(i.canPublishMobile(),"wsb-preview-mobile-phone-container","-with-aside")}),i.showPreview=w.isPreviewAction,i.mobileLearnMore=function(){g.ShowUpgradeDialog({clientTrackingId:"wsb-preview-mobile-learn-more-click",clientTrackingValue:"mobile"})},i.loadingText=a.computed(function(){var e=w.currentPlatform(),n=r.resources.Server__Generating_Preview;return e==t.platforms.mobile&&(n=r.resources.Server__Generating_Mobile_Preview),n}),i.loadingImagePath=l.getDataModel().config.amdPathRoot+"/images/progress.gif",i.savingText=a.computed(function(){return r.resources.Saving_ellipsis}),w.currentPlatform.subscribe(n),w.currentPage.subscribe(function(){w.currentAction()!=t.actions.edit&&n()}),w.currentAction.subscribe(function(e){return e==t.actions.edit?void i.contentHtml(""):(e==t.actions.preview&&(u.closeFlyouts(),d.deselectAllElements()),void n())}),c.themeLocale.subscribe(function(){C.setDirtyFlag("preview",!0),n()})}function b(){return n.browser.msie&&E++>10?window.location.reload():void 0}function f(e){b(),S.showSaving(!1),S.showLoading(!0),S.showContent(!1);var t=w.currentPlatform(),i=w.currentPage(),a=c.themeLocale();s.getPreviewHtml(t,i,a).then(function(e){S.showLoading(!1),v(i,t,e),S.contentHtml(e),S.showContent(!0)}).fail(function(e){S.showLoading(!1),"abort"!==e.statusText&&(v(i,t,""),S.contentHtml(""),S.showContent(!0),n("<div></div>").sfGrowl({title:r.resources.Client__Designer__Yikes_hit_a_snag,content:r.resources.Client__Designer__TryAgainCustomerSupport.sfFormat('<a class="wsb-support-link" href="/help/support" target="_blank">',"</a>"),icon:"error"}),p.post({action:"preview",isGrowl:!0},p.level.error))}).always(function(){n.isFunction(e)&&e()})}function v(e,t,n){k[e]||(k[e]={}),k[e][t]=n}function y(t){var i=l.getDataModel();w=i.address,_=l.getDataModel().config,S=new m,k={},C.setDirtyFlag("preview",!1);var r=S.showPreview();x.container=e.getMap().apps.builder,x.preview=n(h).appendTo(x.container),x.loading=n("#preview-loading"),x.contents=n("#preview-contents"),a.applyBindings(S,x.preview[0]),r&&f(function(){C.setDirtyFlag("preview",!1)}),t&&t(null,null)}var _,w,S,k,x={},C=l.saver,T=l.undoer,E=0;return{load:y}}),define("text!designer/app/builder/ui/social/social.html",[],function(){return'<div id="wsb-shell-socialbranding" class="wsb-shell-socialbranding" data-bind="visible: visible">\r\n    <div class="wsb-shell-loading">\r\n        <img data-bind="attr: { src: loadingImagePath }" alt="" />&nbsp;<span style="display:inline-block; line-height:1.5em;" data-bind="text: socialLoadingMessage"></span>\r\n    </div>\r\n    <div id="wsb-shell-socialbranding-content">\r\n\r\n    </div>\r\n</div>'}),define("designer/app/builder/ui/social/social",["jquery","lodash","knockout","designer/app/app","/i18n/resources/client","designer/app/builder/data/data","designer/app/builder/managers/addressManager","common/socialPageManager/socialPageManager","text!designer/app/builder/ui/social/social.html"],function(e,t,n,i,a,r,o,s,l){function d(){this.loadingImagePath=u.config.amdPathRoot+"/images/progress.gif",this.socialLoadingMessage=a.resources.Loading,this.visible=n.computed(function(){return u.address.currentAction()===o.actions.social})}function c(t){u=r.getDataModel(),g.container=i.getMap().apps.builder,g.social=e(l).appendTo(g.container),p=new d,n.applyBindings(p,g.social[0]),s.init(),u.address.currentAction()==o.actions.social&&s.open(),u.address.currentAction.subscribe(function(e){e==o.actions.social&&s.open()}),e.isFunction(t)&&t(null,p)}var u,p,g={};return{load:c}}),define("designer/wsb/seo/serviceAreaMapper",["jquery","appconfig","common/logger/logger","/i18n/resources/client"],function(e){function t(e){a.setCenter(e),o.setPosition(e),google.maps.event.trigger(a,"resize"),a.panTo(e)}function n(e,t){var n={strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.15,map:a,center:e,radius:1.60934*t*1e3};return n}function i(e){var t=e.toString();switch(t){case"5":a.setZoom(11);break;case"10":a.setZoom(10);break;case"25":a.setZoom(9);break;case"50":a.setZoom(8);break;case"100":a.setZoom(7);break;default:a.setZoom(10)}}var a,r,o,s,l,d,c=[],u="seo-service-area-map",p="seo-targetArea",g=10,h=0,m={element:function(t){return e("#"+t)}},b=0,f=function(e,a,o){r&&r.setMap(null),m.element(u).css("visibility","visible"),m.element("targetingHeader").css("visibility","visible");var s=new google.maps.LatLng(e,a),l=n(s,o);r=new google.maps.Circle(l),h=o,i(o),t(s)},v=function(){if(s){var e=!1;for(var t in c)c[t].name==s.formatted_address&&(e=!0);r&&r.setMap(null);var n=null;if(s.geometry){var i=s.geometry.location.lat(),a=s.geometry.location.lng();n=e?{circleID:-1,name:s.formatted_address,lat:i,lng:a,radius:h}:y(s.formatted_address,i,a,h,!1)}return n}},y=function(e,a,r,o,s){m.element(u).css("visibility","visible"),m.element("targetingHeader").css("visibility","visible");var l,d=new google.maps.LatLng(a,r),p=n(d,o);l=new google.maps.Circle(p),s&&(i(o),t(d)),c.push(new E(b,e,a,r,o,l));var g=b;return b++,{circleID:g,name:e,lat:a,lng:r,radius:o}},_=function(e){for(var t=-1,n=0;n<c.length;n++)if(e==c[n].ID){t=n;break}if(t>=0){var i=c[t];i.circle.setMap(null),null!=s&&i.name==s.formatted_address&&i.radius==h&&f(i.lat,i.lon,i.radius),c.splice(t,1)}},w=function(){r=null,c=[],h=0,s=null,b=0},S=function(t){require(["common/geo/googleMaps"],function(n){var i=n({loadUsingClient:!0});i.done(function(){x(),e.isFunction(t)&&t()})})},k=function(e){g=e,s&&s.geometry&&f(s.geometry.location.lat(),s.geometry.location.lng(),g)},x=function(){var t={zoom:10,mapTypeId:google.maps.MapTypeId.ROADMAP,center:new google.maps.LatLng(41.9,87.65)},n=document.getElementById(u);a=new google.maps.Map(n,t);var i=document.getElementById(p);o=new google.maps.Marker({map:a}),l=new google.maps.places.AutocompleteService,e("#"+p).autocomplete({autoFocus:!0,delay:500,minLength:2,source:function(t,n){l.getPlacePredictions({input:t.term,types:["geocode"]},function(i){i=e.grep(i,function(e){var t=e.types;return t.indexOf("neighborhood")>=0||t.indexOf("locality")>=0||t.indexOf("sublocality")>=0||t.indexOf("postal_code")>=0||t.indexOf("country")>=0||t.indexOf("administrative_area1")>=0||t.indexOf("administrative_area2")>=0}),n(e.map(i,function(e){return{label:e.description,value:e.description,reference:e.reference,input:t.term}}))})},select:function(e,t){d=new google.maps.places.PlacesService(i),d.getDetails({reference:t.item.reference},function(e){T(e)})},open:function(){e(".ui-autocomplete").css("height","225px")}}).bind("focus",function(){e(this).autocomplete("search")}).data("ui-autocomplete")._renderItem=function(t,n){return e("<li></li>").data("item.autocomplete",n).append('<a><span class="wsb-autocomplete-item-text">'+C(n.input,n.label)+"</span></a>").appendTo(t)}},C=function(t,n){var t=(t||"").replace(/^\s+|\s+$/g,"");if(!t)return"";for(var i,a=t.split(/[\s,;]/).map(function(e){return e.replace(/^\s+|\s+$/g,"")}).filter(function(e){return!!e.length}),r=a.map(function(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}).join("|"),o=new RegExp("\\b("+r+")","gi"),s=[];i=o.exec(n);)s.push({index:i.index,text:i[1]});var l=0,d=e("<span/>");s.forEach(function(t){e("<span/>").text(n.substring(l,t.index)).appendTo(d),e('<span class="wsb-autocomplete-match-segment"/>').text(t.text).appendTo(d),l=t.index+t.text.length}),e("<span/>").text(n.substr(l)).appendTo(d);var c=d.html();return c},T=function(e){s=e,s.geometry&&f(s.geometry.location.lat(),s.geometry.location.lng(),g)},E=function(e,t,n,i,a,r){this.ID=e,this.name=t,this.lat=n,this.lon=i,this.radius=a,this.circle=r};return{showCircle:f,persistCircle:y,persistCurrentCircle:v,removeCircle:_,setRadius:k,triggerGoogleMapsApiLoad:S,reset:w}}),define("designer/wsb/seo/competitorSuggestion",["common/logger/logger","userData"],function(e,t){function n(e,n,i,a,r,o){var s="/api/websites/{websiteId}/GooglePlacesCompetitors/".replace("{websiteId}",t.websiteId),l=s+"search?category="+a.Name;l+="&lat="+e,l+="&lon="+n,l+="&radius="+i,$.ajax({url:l,type:"GET",success:function(e){void 0!=r&&null!=r&&r(e)},error:function(){void 0!=o&&null!=o&&o()}})}function i(e,n,i){var a="/api/websites/{websiteId}/GooglePlacesCompetitors/".replace("{websiteId}",t.websiteId),r=a+"GetBusiness?referenceId="+e;$.ajax({url:r,type:"GET",success:function(e){void 0!=n&&null!=n&&n(e)},error:function(){void 0!=i&&null!=i&&i()}})}return{competitorPlaceSearch:n,getPlaceData:i}}),define("common/napsoc/napsocForm",["jquery","knockout","common/regexhelper/regexhelper","common/stats/googleanalytics","appconfig","napsoc","userData","common/social/oauth/social.oauth","/i18n/resources/client","common/ui/dialog","common/abTesting/abTesting","common/util/stringHelper","common/geo/getClosestGeoLocation","common/util/localeHelper","common/geo/googleMapBinding","libs/knockout/ko.addins_v2","common/geo/placesAutocomplete","common/napsoc/industryPicker","common/ui/flyout","css!common/napsoc/napsoc.css"],function(e,t,n,i,a,r,o,s,l,d,c,u,p,g){function h(d){function h(e){e!==!0&&N()||V.openAuthWindow()}function m(e){V.getPages(function(e){if(F.removeAll(),e&&e.length){for(var t in e)F.push({Name:e[t].Name,Link:e[t].Link});R(!0),f(r.observables().FacebookUrl())}else R(!1)},e===!0)}function f(e){var t=!1,n=F();if(n&&n.length)for(var i in n)if(n[i].Link==e){O(n[i]),t=!0;break}B(t)}function v(e){e!==!0&&z()||j.openAuthWindow()}function y(){j.getUsername(function(e){e?L(e):(L(""),j.removeAuth())},!0)}function _(){Y(!1)}function w(){i.trackEvent("wsb-setup-napsoc","open-map","icon")}function S(){return P()&&q()}function k(){var e=r.observables();P(e.Name()),D(e.Address()),I(e.FormattedStreetAddress()),A(e.Phone()),b(e.BusinessCategoryId()),M(e.Email()),L(e.TwitterUsername()),f(e.FacebookUrl())}function x(){i.trackEvent("wsb-setup-napsoc","open-mightycall","link");var t=encodeURIComponent(M()),n=a.mightyCallUrl+"?email="+t,r=u.htmlEncode(n);e('<iframe src="'+r+'" style="width: 670px;" class="wsb-setup-napsoc-mightycall-iframe" />').wsbDialog({title:l.resources.MightyCall_Modal_Title,autoResize:!0,buttons:[{text:l.resources.Close,cancel:!0}],onClose:function(e,t){i.trackEvent("wsb-setup-napsoc","close-mightycall",t?"icon":"link")}})}function C(){var t=e.Deferred(),n={SiteName:P(),EmailAddress:M(),StreetAddress:D(),PhoneNumber:A(),FacebookUrl:B()?O().Link:"",Twitter:L(),BusinessCategoryId:b()};return I()?(n.FormattedStreetAddress=I(),T(n,t)):p.getClosestStreetAddress(D(),function(e){n.FormattedStreetAddress=e,T(n,t)}),t.promise()}function T(e,t){r.Post(e,function(){t.resolve()},function(){t.reject()})}d=d||{};var E={address:"Scottsdale, AZ",zoom:14},P=t.observable(""),D=t.observable(""),I=t.observable(),A=t.observable(""),M=t.observable(""),O=t.observable(""),L=t.observable(""),N=t.observable(""),B=t.observable(!1),F=t.observableArray(),R=t.observable(""),H=t.computed(function(){return d.isInDialog?!1:g.isMightyCallLocale&&"enabled"===c.getOption("mightyCall")?!o.isReseller:!1}),V=s("facebook");V.bind("auth",function(){N(!0),m(!0)}).bind("unauth",function(){N(!1),B(!1)}),N(V.isAuth),N()&&m();var z=t.observable(""),j=s("twitter");j.bind("auth",function(){y(),z(!0)}).bind("unauth",function(){z(!1)}),z(j.isAuth);var U=t.observable(!0);U.extend({notify:"always"}),U.subscribe(function(e){var t=D();t&&(e?p.getClosestStreetAddress(t,function(e){I(e)}):I(t))});var W=t.computed(function(){return I()||D()||E.address});k();var q=t.computed(function(){var e=M();return Boolean(e&&n.validateEmailAddress(e))}).extend({throttle:{type:"debounce",delay:500}}),$=t.computed(function(){return q()?"":l.resources.Client__Napsoc_EmailFormatValidationMessage}),G=t.computed(function(){return P()?"":l.resources.Client__Napsoc_SiteNameRequiredValidationMessage}),K=t.observable(),Y=t.observable(!1),J={Server__Required_fields:l.resources.Server__Required_fields,Server__Site_name:l.resources.Server__Site_name,Server__Napsoc_SiteNameRationale:l.resources.Server__Napsoc_SiteNameRationale,Server__Napsoc_EmailRationale:l.resources.Server__Napsoc_EmailRationale,Server__Email_address:l.resources.Server__Email_address,Server__Napsoc_BusinessCategoryLabel:l.resources.Server__Napsoc_BusinessCategoryLabel,Server__Napsoc_BusinessCategoryRationale:l.resources.Server__Napsoc_BusinessCategoryRationale,Server__Address:l.resources.Server__Address,Server__Napsoc_AddressRationale:l.resources.Server__Napsoc_AddressRationale,Server__Phone_number:l.resources.Server__Phone_number,Server__Napsoc_PhoneNumberRationale:l.resources.Server__Napsoc_PhoneNumberRationale,Server__Napsoc_AddressPrivacyCheckboxLabel:l.resources.Server__Napsoc_AddressPrivacyCheckboxLabel,Server__Napsoc_PhoneNumberPrivacyCheckboxLabel:l.resources.Server__Napsoc_PhoneNumberPrivacyCheckboxLabel,Server__Social:l.resources.Server__Social,Server__People_can_like_your_page_wth_one_click:l.resources.Server__People_can_like_your_page_wth_one_click,Server__Connected_to_Twitter:l.resources.Server__Connected_to_Twitter,Server__Connect_to_Twitter:l.resources.Server__Connect_to_Twitter,Server__Connected_to_Facebook:l.resources.Server__Connected_to_Facebook,Server__Connect_to_Facebook:l.resources.Server__Connect_to_Facebook,Server__You_dont_have_any_pages_for_people_to_like:l.resources.Server__You_dont_have_any_pages_for_people_to_like,Server__Note_colon:l.resources.Server__Note_colon,Server__ExternalHelpLinkText:l.resources.Server__ExternalHelpLinkText,Server__Use_with_like_box:l.resources.Server__Use_with_like_box,Saving_ellipsis:l.resources.Saving_ellipsis,Server__We_were_unable_to_save_your_site_settings:l.resources.Server__We_were_unable_to_save_your_site_settings};return{siteName:P,streetAddress:D,phoneNumber:A,businessCategoryId:b,emailAddress:M,emailAddressValid:q,emailAddressErrorMessage:$,siteNameErrorMessage:G,facebookPage:O,facebookPages:F,facebookIsAuth:N,hasFacebookPages:R,useFacebookPage:B,gaCategory:d.gaCategory,isInDialog:d.isInDialog,needsFormatted:U,mapAddress:W,searchBounds:K,onGeolocationFlyoutOpen:w,isMapOpen:Y,closeMap:_,twitterUsername:L,twitterIsAuth:z,authTwitter:v,authFacebook:h,isValid:S,save:C,reset:k,launchMightyCall:x,showMightyCallLink:H,Strings:J}
}function m(){var e=r.observables();b(e.BusinessCategoryId())}var b=t.observable();return{createViewModel:h,resetCategory:m}}),define("text!designer/wsb/seo/seoEditor.html",[],function(){return'<div class="wsb-shell-seo" id="wsb-shell-seo">\r\n<div class="wsb-shell-seo-sidebar wsb-undo-select" id="wsb-shell-seo-sidebar">\r\n    <!-- ko if: inBusinessMode() -->\r\n    <div id="wsb-seo-biz-overlay">\r\n        <div id="wsb-seo-bizInfo-outer-container">\r\n            <div class="wsb-seo-biz-container1">\r\n                <div class="wsb-seo-biz-inner-container">\r\n                    <!-- ko if: currentStep() == Steps.BizInfo -->\r\n                    <div id="wsb-seo-biz-info" class="wsb-seo-biz-input-container clearfix">\r\n                        <div class="wsb-seo-bizinfo-title-container">\r\n                            <div class="sf-dialog-title-seo" style="float:left" data-bind= "text: i18NDict[\'Client__SEO__BizInfo_WhatsBusinessName\']"></div>\r\n                            <div class="wsb-required wsb-seo-required-label" data-bind="text: i18NDict[\'Server__Required_fields\']"></div>\r\n                        </div>\r\n                        <div class="wsb-seo-biz-tagline" data-bind= "text: i18NDict[\'Client__SEO__BizInfo_TellUsMore\']"></div>\r\n                        <div class="wsb-seo-biz-container2">\r\n                            <div class="wsb-seo-biz-section">\r\n                                <span data-bind= "text: i18NDict[\'Client__SEO__BizInfo_BusinessName\']"></span><span class="field-validation-error">*</span>\r\n                                <input id="businessName" class="wsb-text-box wsb-seo-wizard-flyout-input-450" maxlength="75" data-bind="value: businessName, event: { click: businessNameToolTip }, css: { \'wsb-napsoc-text-input-validationerror\': ValidateBusinessNameErrorMessage() }">\r\n                                <div class="wsb-seo-error-text" data-bind="text: ValidateBusinessNameErrorMessage()"></div>\r\n                                <div id="businessNameTip" class="wsb-seo-tips">\r\n                                    <div class="wsb-seto-tip-title" data-bind= "text: i18NDict[\'Client__SEO__BizInfo_BusinessTipShort\']"></div>\r\n                                    <p data-bind= "text: i18NDict[\'Client__SEO__BizInfo_LeaveOffLegalJargon\']"></p>\r\n                                    <p data-bind= "text: i18NDict[\'Client__SEO__BizInfo_Examples\']"></p>\r\n                                    <ul>\r\n                                        <li data-bind= "text: i18NDict[\'Client__SEO__BizInfo_EriksCooling\']"></li>\r\n                                        <li data-bind= "text: i18NDict[\'Client__SEO__BizInfo_SportsDepot\']"></li>\r\n                                    </ul>\r\n                                </div>\r\n                                <!-- ko if: CategoryVisible() -->\r\n                                <label for="wsb-site-settings-industry" data-bind= "text: i18NDict[\'Server__Napsoc_BusinessCategoryLabel\']"></label><span class="field-validation-error">*</span>\r\n                                <input id="wsb-site-settings-industry" class="wsb-text-box wsb-seo-wizard-flyout-input-450" type="text"  maxlength="200" data-bind="attr: { placeholder: i18NDict[\'Client__SEO__BizInfo_CategoryPlaceholder\'] }, industryPicker: { value: categoryID }, css: { \'wsb-napsoc-text-input-validationerror\': ValidateBusinessCategoryErrorMessage() }" />\r\n                                <div class="wsb-seo-error-text" data-bind="text: ValidateBusinessCategoryErrorMessage()"></div>\r\n                                <!-- /ko -->\r\n                            </div>\r\n                            <div class="wsb-seo-biz-section-listing">\r\n                                <span id="offeringsSpan" data-bind= "text: i18NDict[\'Client__SEO__BizInfo_OfferingsDescription\']"></span><span class="field-validation-error">*</span>\r\n                                <!-- ko foreach: offerings -->\r\n                                <input id="OfferingsInput"  class="wsb-text-box wsb-seo-wizard-flyout-input-450" maxlength="80" data-bind="attr: { placeholder: $root.i18NDict[\'Client__SEO__BizInfo_OfferingsPlaceholder\'] }, value: offeringValue, event: { click: $root.businessCategoryToolTip }, css: { \'wsb-napsoc-text-input-validationerror\': $root.ValidateBusinessOfferingRequiredErrorMessage() }" />\r\n\r\n                                <!-- /ko -->\r\n                                <div class="wsb-seo-error-text" data-bind="text: ValidateBusinessOfferingRequiredErrorMessage()"></div>\r\n                                <div id="businessOfferingsTip" class="wsb-seo-tips">\r\n                                    <div class="wsb-seto-tip-title" data-bind= "text: i18NDict[\'Client__SEO__BizInfo_OfferignsTip\']"></div>\r\n                                    <p data-bind= "text: i18NDict[\'Client__SEO__BizInfo_OfferignsTipDescription\']"></p>\r\n                                    <p data-bind= "text: i18NDict[\'Client__SEO__BizInfo_Examples\']"></p>\r\n                                    <ul>\r\n                                        <li data-bind= "text: i18NDict[\'Client__SEO__BizInfo_OfferignsTipACRepair\']"></li>\r\n                                        <li data-bind= "text: i18NDict[\'Client__SEO__BizInfo_OfferignsTipBaseball\']"></li>\r\n                                    </ul>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <!-- /ko -->\r\n                    <!-- ko if: currentStep() == Steps.BizLocale -->\r\n                    <div id="wsb-seo-biz-locale" class="wsb-seo-biz-input-container clearfix">\r\n                        <div class="wsb-seo-locale-container">\r\n                            <div class="sf-dialog-title-seo"><span data-bind= "text: i18NDict[\'Client__SEO__BizLocale_WhereAreYour\']"></span> <b data-bind= "text: i18NDict[\'Client__SEO__BizLocale_CustomersBold\']"> </b>&nbsp;<span data-bind= "text: i18NDict[\'Client__SEO__BizLocale_Located\']"></span>\r\n                            </div>\r\n                            <p data-bind= "text: i18NDict[\'Client__SEO__BizLocale_LocationDescription\']">\r\n                            </p>\r\n                            <div class="wsb-seo-range-container clearfix">\r\n                                <div id="seo-range-local-container" class="wsb-seo-locale-range-container" data-bind="event: { mouseover: localOptionMouseOver, click: localOptionClick, mouseout: localOptionMouseOut }">\r\n                                    <div id="seo-range-local-graph" class="wsb-seo-locale-range-graph-container" data-bind="css: !isGlobal() || localHover() ? \'wsb-seo-locale-range-graph-container-select\' : \'\'">\r\n                                        <div class="wsb-seo-local-img"></div>\r\n                                        <div class="wsb-seo-locale-range-text" data-bind= "text: i18NDict[\'Client__SEO__BizLocale_LocationLocal\']"></div>\r\n                                    </div>\r\n                                    <div id="seo-range-local-text" class="wsb-seo-locale-text" data-bind="text: i18NDict[\'Client__SEO__BizLocale_LocationLocalCustomers\'], css: !isGlobal() || localHover() ? \'wsb-seo-locale-text-select\' : \'\'"> <b data-bind= "text: i18NDict[\'Client__SEO__BizLocale_LocationLocalCustomersBold\']"></b data-bind= "text: i18NDict[\'Client__SEO__BizLocale_LocationLocalCustomersTarget\']"></div>\r\n                                </div>\r\n                                <div id="seo-range-global-container" class="wsb-seo-locale-range-container wsb-seo-worldwide-choice" data-bind="event: { mouseover: globalOptionMouseOver, click: globalOptionClick, mouseout: globalOptionMouseOut }">\r\n                                    <div id="seo-range-global-graph" class="wsb-seo-locale-range-graph-container" data-bind="css: isGlobal() || globalHover() ? \'wsb-seo-locale-range-graph-container-select\' : \'\'">\r\n                                        <div class="wsb-seo-worldwide-img"></div>\r\n                                        <div class="wsb-seo-locale-range-text" data-bind= "text: i18NDict[\'Client__SEO__BizLocale_LocationWorldwide\']"></div>\r\n                                    </div>\r\n                                    <div id="seo-range-global-text" class="wsb-seo-locale-text" data-bind="text: i18NDict[\'Client__SEO__BizLocale_LocationWorldwideDescription\'], css: isGlobal() || globalHover() ? \'wsb-seo-locale-text-select\' : \'\'"> <b data-bind= "text: i18NDict[\'Client__SEO__BizLocale_LocationWorldwideDescriptionBold\']"></b></div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <!-- /ko -->\r\n                    <!-- ko if: currentStep() == Steps.BizServiceAreas-->\r\n                    <div id="wsb-seo-biz-serviceareas" class="wsb-seo-biz-input-container clearfix">\r\n                        <div class="wsb-seo-serviceareas-container">\r\n                            <div class="sf-dialog-title-seo" data-bind= "text: i18NDict[\'Client__SEO__BizServiceAreas_Where\']">\r\n                            </div>\r\n                            <div>\r\n                                <div class="wsb-seo-sa-input-container">\r\n                                    <div data-bind= "text: i18NDict[\'Client__SEO__BizServiceAreas_AddCityZip\']"> <span id="seo-targetArea-flyout-bubble" data-bind="event: { click: seotargetAreaToolTip }" class="wsb-seo-question-bubble"></span></div>\r\n                                    <input id="seo-targetArea" class="wsb-text-box wsb-seo-wizard-flyout-input" data-bind="css: { \'wsb-napsoc-text-input-validationerror\': ValidateBusinessServiceAreasErrorMessage() }, enterKey: addServiceAreaOnEnter">                                    \r\n                                    <a id="addTargetArea" class="btn btn-inverse-grey" data-bind="text: i18NDict[\'Client__SEO__BizServiceAreas_Add\'], event: { click: addServiceArea }"><i class="icon-plus-sign icon-white"></i></a>\r\n                                    <div class="wsb-seo-error-text" data-bind="text: ValidateBusinessServiceAreasErrorMessage()"></div>\r\n                                    <div id="seo-targetAreaTip" class="wsb-seo-tips">\r\n                                        <div class="wsb-seto-tip-title" data-bind= "text: i18NDict[\'Client__SEO__BizServiceAreas_Tip\']"></div>\r\n                                        <p data-bind= "text: i18NDict[\'Client__SEO__BizServiceAreas_TipDescription\']"></p>\r\n                                        <strong data-bind= "text: i18NDict[\'Client__SEO__BizInfo_Examples\']"></strong>\r\n                                        <ul>\r\n                                            <li data-bind= "text: i18NDict[\'Client__SEO__BizServiceAreas_TipCity\']"></li>\r\n                                            <li data-bind= "text: i18NDict[\'Client__SEO__BizServiceAreas_TipZip\']"></li>\r\n                                            <li data-bind= "text: i18NDict[\'Client__SEO__BizServiceAreas_TipNeighborhood\']"></li>\r\n                                        </ul>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                            <div class="wsb-seo-sa-targeting-container clearfix">\r\n                                <div id="targetingHeader" class="sf-dialog-title-seo" style="visibility: hidden;" data-bind= "text: i18NDict[\'Client__SEO__BizServiceAreas_Targeting\']">\r\n                                </div>\r\n                                <div class="wsb-seo-sa-map-container">\r\n                                    <div id="seo-service-area-map" class="wsb-seo-sa-map"></div>\r\n                                </div>\r\n                                <div class="wsb-seo-sa-areas-container">\r\n                                    <!-- ko foreach: serviceAreas -->\r\n                                    <div class="seo-wizard-service-locations-items clearfix">\r\n                                        <div class="wsb-seo-wizard-flyout-items wsb-seo-wizard-flyout-items2"\r\n                                            data-bind="text: locationName">\r\n                                        </div>\r\n                                        <span class="wsb-seo-wizard-flyout-x"\r\n                                            data-bind="event: { click: $root.removeServiceArea }"></span>\r\n                                    </div>\r\n                                    <!-- /ko -->\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <!-- /ko -->\r\n\r\n                    <!-- ko if: currentStep() == Steps.BizCompetitors -->\r\n                    <div class="wsb-seo-biz-input-container clearfix">\r\n                        <div class="wsb-seo-loading-options" data-bind= "text: i18NDict[\'Client__SEO__Loading\']"></div>\r\n                    </div>\r\n                    <!-- /ko -->                    \r\n                    <div class="wsb-seo-biz-footer-container">\r\n                        <a id="btn-seo-biz-back" class="btn btn-inverse-grey" data-bind="visible: (currentStep() != Steps.BizInfo), event: { click: navigateBack }" style="margin-right:5px;">\r\n                            <i class="wsb-seo-back-icn"></i>&nbsp;<span data-bind="text: i18NDict[\'Back\']"></span>\r\n                        </a>\r\n                        <a id="btn-seo-biz-next" class="btn btn-inverse-grey"\r\n                           data-bind="event: { click: navigateNext }"><span data-bind="text: i18NDict[\'Next\']"></span> <i class="wsb-seo-next-icn"></i></a>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: !inBusinessMode() -->\r\n    <div id="wsb-seoEditor-overlay" class="wsb-seoEditor-overlay-all" data-bind="visible: overlayVisible"></div>\r\n    <div class="wsb-seo-sidebar-overall wsb-undo-select" id="wsb-seo-sidebar-overall">\r\n        <div class="wsb-seo-all-steps-container">\r\n            <!-- ko if: currentStep() == Steps.PageAbout-->\r\n            <div class="clearfix">\r\n                <div class="sf-dialog-title-seo2" data-bind= "text: i18NDict[\'Client__SEO__PageAbout_WhatsThisAbout\']"></div>\r\n                <div class="wsb-seo-step-tip" data-bind= "text: i18NDict[\'Client__SEO__PageAbout_Tip\']"></div>\r\n                <div class="wsb-seo-options-container">\r\n                    <!-- ko foreach: offerings -->\r\n                    <!-- ko if: $data.offeringValue -->\r\n                    <div class="wsb-seo-option-container">\r\n                        <div class="wsb-seo-option-choose-container">\r\n                            <a href="#" data-bind="css: chosen() ? \'wsb-seo-option-selected\' : \'wsb-seo-option-deselected\', event: { click: $root.toggleOfferingChosen }">\r\n                                <div></div>\r\n                            </a>\r\n                        </div>\r\n                        <div class="wsb-seo-option-text-container">\r\n                            <span data-bind="text: $data.offeringValue, event: { click: $root.toggleOfferingChosen }"></span>\r\n                        </div>\r\n                    </div>\r\n                    <!-- /ko -->\r\n                    <!-- /ko -->\r\n                </div>\r\n                <div class="wsb-seo-aboutother-container">\r\n                    <!-- ko if: !pageAboutOther()-->\r\n                    <a class="sf-dialog-link" href="#" data-bind="text: i18NDict[\'Client__SEO__PageAbout_NotAbout\'], event: { click: pageAboutOtherClick }"></a>\r\n                    <!-- /ko -->\r\n                    <!-- ko if: pageAboutOther()-->\r\n                    <div class="wsb-seo-step-tip" data-bind= "text: i18NDict[\'Client__SEO__PageAboutOther_WhatsThisAbout\']"></div>\r\n                    <input class="wsb-text-box" data-bind="value: pageOtherOffering" />\r\n                    <!-- /ko -->\r\n                    <div class="wsb-seo-error-text" data-bind="text: ValidatePageAboutOfferingIsSetErrorMessage()"></div>\r\n                </div>\r\n            </div>\r\n            <!-- /ko -->\r\n            <!-- ko if: currentStep() == Steps.PrimaryLocation-->\r\n            <div class="clearfix">\r\n                <div class="sf-dialog-title-seo2" data-bind= "text: i18NDict[\'Client__SEO__PrimaryLocation_Which\']"> <b data-bind= "text: i18NDict[\'Client__SEO__PrimaryLocation_PrimaryLocation\']"></b></div>\r\n                <div class="wsb-seo-options-container">\r\n                    <!-- ko foreach: serviceAreas -->\r\n                    <div class="wsb-seo-option-container">\r\n                        <div class="wsb-seo-option-choose-container">\r\n                            <a href="#" data-bind="css: isPrimary() ? \'wsb-seo-radio-selected\' : \'wsb-seo-radio-deselected\', event: { click: $root.serviceAreaPrimarySelected }">\r\n                                <div></div>\r\n                            </a>\r\n                        </div>\r\n                        <div class="wsb-seo-text-container">\r\n                            <span data-bind="text: $data.locationName, event: { click: $root.serviceAreaPrimarySelected }"></span>\r\n                        </div>\r\n                    </div>\r\n                    <!-- /ko -->\r\n                    <div class="wsb-seo-error-text" data-bind="text: ValidatePrimaryLocationIsSetErrorMessage()"></div>\r\n                </div>\r\n            </div>\r\n            <!-- /ko -->\r\n            <!-- ko if: currentStep() == Steps.SelectKeywords-->\r\n            <div class="clearfix">\r\n                <div class="sf-dialog-title-seo2"><span data-bind= "text: i18NDict[\'Choose\']"></span>\r\n                    <span data-bind="text: minKeywordsToSelect"></span>-<span data-bind="text: maxKeywordsToSelect"></span>&nbsp;<span data-bind="text: i18NDict[\'Client__SEO__SelectKeywords_Phrases\']"></span>&nbsp;<b><span data-bind="text: i18NDict[\'Client__SEO__SelectKeywords_FindBusiness\'], visible: currentSeoPage() && currentSeoPage().IsHomePage()"></span>\r\n                                                                                                                                                                                                                                                          <span data-bind="text: i18NDict[\'Client__SEO__SelectKeywords_FindPage\'], visible: !currentSeoPage() || !currentSeoPage().IsHomePage()"></span></b>\r\n                </div>\r\n\r\n                <div class="wsb-seo-options-container wsb-seo-keywords-options-container">\r\n                    <!-- ko if:keywordPhraseOptionsToDisplay().length == 0 -->\r\n                    <div class="wsb-seo-loading-options" data-bind= "text: i18NDict[\'Client__SEO__Loading\']"></div>\r\n                    <!-- /ko -->\r\n                    <!-- ko if:keywordPhraseOptionsToDisplay().length > 0 -->\r\n                    <!-- ko foreach: keywordPhraseOptionsToDisplay -->\r\n                    <div id="seoKeywordOptions" class="wsb-seo-option-container" data-bind="event: { mouseover: $root.sidebarOptionMouseOver, mouseout: $root.sidebarOptionMouseOut }">\r\n                        <div class="wsb-seo-option-choose-container">\r\n                            <a href="#" data-bind="css: chosen() ? \'wsb-seo-option-selected\' : \'wsb-seo-option-deselected\', event: { click: $root.toggleKeywordChosen }">\r\n                                <div></div>\r\n                            </a>\r\n                        </div>\r\n                        <div class="wsb-seo-option-text-container wsb-seo-option-with-remove">\r\n                            <span data-bind="text: $data.displayText, event: { click: $root.toggleKeywordChosen }"></span>\r\n                        </div>\r\n                        <div class="wsb-seo-option-text-container">\r\n                            <a href="#" class="sf-tip" data-style="qt" data-bind = "attr: { \'data-content\': $root.i18NDict[\'Client__SEO__SelectKeywords_Not_Relevant_To_Me\'] }"></a>\r\n                        </div>\r\n                    </div>\r\n                    <!-- /ko -->\r\n\r\n                    <div class="wsb-seo-option-container">\r\n                        <div class="wsb-seo-option-choose-container">&nbsp;</div>\r\n                        <div class="wsb-seo-option-text-container wsb-seo-option-with-remove">\r\n                            <a href="#" data-bind="text: i18NDict[\'Client__SEO__SelectKeywords_Load_More_Phrases\'], visible: (maxKeywordPhrasesToShow() < keywordPhraseOptions().length), event: { click: showAllKeywords }"></a>\r\n                        </div>\r\n                    </div>\r\n                    <!-- /ko -->                    \r\n                </div>\r\n                <div class="wsb-seo-error-text" data-bind="text: ValidateSelectKeywordsIsSetErrorMessage()"></div>\r\n            </div>\r\n            <!-- /ko -->\r\n            <!-- ko if: currentStep() == Steps.FocusKeyword-->\r\n            <div class="clearfix">\r\n                <div class="sf-dialog-title-seo2"><span data-bind= "text: i18NDict[\'Client__SEO__FocusKeyword_Choose\']"></span> <b data-bind= "text: i18NDict[\'Client__SEO__FocusKeyword_MostRelevant\']"></b>&nbsp;<span data-bind= "text: i18NDict[\'Client__SEO__FocusKeyword_ToPage\']"></span></div>\r\n                <div class="wsb-seo-options-container">\r\n                    <!-- ko foreach: selectedKeywords -->\r\n                    <div class="wsb-seo-option-container">\r\n                        <div class="wsb-seo-option-choose-container">\r\n                            <a href="#" data-bind="css: isFocus() ? \'wsb-seo-radio-selected\' : \'wsb-seo-radio-deselected\', event: { click: $root.focusChosen }">\r\n                                <div></div>\r\n                            </a>\r\n                        </div>\r\n                        <div class="wsb-seo-text-container">\r\n                            <span data-bind="text: $data.displayText, event: { click: $root.focusChosen }"></span>\r\n                        </div>\r\n                    </div>\r\n                    <!-- /ko -->\r\n                    <div class="wsb-seo-error-text" data-bind="text: ValidateKeywordFocusIsSetErrorMessage()"></div>\r\n                </div>\r\n            </div>\r\n            <!-- /ko -->\r\n            <!-- ko if: currentStep() == Steps.Title-->\r\n            <div class="clearfix">\r\n                <div class="sf-dialog-title-seo2" data-bind= "text: i18NDict[\'Client__SEO__Title_Choose\']"> <b data-bind= "text: i18NDict[\'Client__SEO__Title_PageTitle\']"></b></div>\r\n                <div class="wsb-seo-options-container">\r\n                    <!-- ko if:titleOptionsToDisplay().length == 0 -->\r\n                    <div class="wsb-seo-loading-options" data-bind= "text: i18NDict[\'Client__SEO__Loading\']"></div>\r\n                    <!-- /ko -->\r\n                    <!-- ko if:titleOptionsToDisplay().length > 0 -->\r\n                    <div class="wsb-seo-title-options-container">\r\n                        <!-- ko foreach: titleOptionsToDisplay -->\r\n                        <div class="wsb-seo-option-container">\r\n                            <div class="wsb-seo-option-choose-container">\r\n                                <a href="#" data-bind="css: chosen() ? \'wsb-seo-radio-selected\' : \'wsb-seo-radio-deselected\', event: { click: $root.chooseTitle }">\r\n                                    <div></div>\r\n                                </a>\r\n                            </div>\r\n                            <div class="wsb-seo-option-text-container wsb-seo-page-title-override">\r\n                                <span data-bind="text: $data.displayText, event: { click: $root.chooseTitle }"></span>\r\n                            </div>\r\n                        </div>\r\n                        <!-- /ko -->\r\n                        <div class="wsb-seo-google-example-container">\r\n                            <div class="wsb-seo-google-title-example-nounderline" data-bind="text: titleLinkText() ">\r\n                            </div>\r\n                            <div data-bind= "text: i18NDict[\'Client__SEO__Title_DescriptionExplain\']">\r\n                            </div>\r\n                            <div class="wsb-ad-sample-text" data-bind= "text: i18NDict[\'Client__SEO__Title_Sample\']"></div>\r\n                        </div>\r\n                    </div>\r\n                    <!-- /ko -->\r\n                    <div class="wsb-seo-error-text" data-bind="text: ValidateTitleIsSetErrorMessage()"></div>\r\n                </div>\r\n            </div>\r\n            <!-- /ko -->\r\n            <!-- ko if: currentStep() == Steps.Description-->\r\n            <div class="clearfix">\r\n                <div class="sf-dialog-title-seo2"><span data-bind= "text: i18NDict[\'Client__SEO__Description_AlmostDone\']"> </span>&nbsp;<b data-bind= "text: i18NDict[\'Client__SEO__Description_description\']"></b></div>\r\n                <div class="wsb-seo-google-example-container">\r\n                    <div class="wsb-seo-google-title-example-nounderline" data-bind="text: (chosenTitle() != null) ? chosenTitle().displayText : \'\'"></div>\r\n                    <div class="wsb-seo-description-entry-container">\r\n                        <textarea  data-bind="attr: { placeholder: i18NDict[\'Client__SEO__Description_Placeholder\'] }, value: description, valueUpdate: \'afterkeydown\', event: { keyup: descriptionKeyup }"></textarea>\r\n                    </div>\r\n                    <div data-bind="css: (descriptionRemainingChars() > 0) ? \'wsb-seo-description-positive\' : \'wsb-seo-description-negative\', text: descriptionRemainingChars"></div>\r\n                </div>\r\n                <div class="wsb-seo-desc-keywordcheck-container">\r\n                    <div class="wsb-seo-step-tip-focus" data-bind="text: focusInDescription() ? i18NDict[\'Client__SEO__Description_ContainsRelevantPhrase\'] : i18NDict[\'Client__SEO__Description_MissingRelevantPhrase\']"></div>\r\n                    <div data-bind="css: focusInDescription() ? \'wsb-seo-focus-in-description\' : \'wsb-seo-focus-notin-description\', text: (focusKeyword() != null) ? focusKeyword().displayText : \'\'"></div>\r\n                </div>\r\n                <div class="wsb-seo-error-text clearfix" data-bind="text: ValidateDescriptionIncludesKeywordErrorMessage()"></div>\r\n            </div>\r\n            <!-- /ko -->\r\n            <!-- ko if: currentStep() == Steps.Heading-->\r\n            <div class="clearfix">\r\n                <div class="sf-dialog-title-seo2"><span data-bind= "text: i18NDict[\'Client__SEO__Heading_LetsMakeSure\']"></span> <b data-bind= "text: i18NDict[\'Client__SEO__Heading_Headline\']"></b>&nbsp;<span data-bind= "text: i18NDict[\'Client__SEO__Heading_SelectedPhrase\']"></span></div>\r\n                <div class="wsb-seo-desc-keywordcheck-container">\r\n                    <div class="wsb-seo-step-tip-focus" data-bind="text: h1ContainsFocus() ? i18NDict[\'Client__SEO__Description_ContainsSelectedPhrase\'] : i18NDict[\'Client__SEO__Description_MissingSelectedPhrase\']"></div>\r\n                    <div data-bind="css: h1ContainsFocus() ? \'wsb-seo-focus-in-description\' : \'wsb-seo-focus-notin-description\', text: (focusKeyword() != null) ? toPascalCase(focusKeyword().displayText()) : \'\'"></div>\r\n                </div>\r\n            </div>\r\n            <!-- /ko -->\r\n            <!-- ko if: currentStep() == Steps.KeywordsInContent-->\r\n            <div class="clearfix">                \r\n                <div class="sf-dialog-title-seo2"><span data-bind="text: i18NDict[\'Client__SEO__KeywordsInContent_LetsMakeSure\']"></span>&nbsp;<b data-bind= "text: i18NDict[\'Client__SEO__KeywordsInContent_page\']"></b></div>\r\n                <div class="wsb-seo-options-container">\r\n                    <ul class="wsb-seo-phrase-list-sidebar">\r\n	                    <!-- ko foreach: selectedKeywords -->\r\n	                    <li class="" data-bind="css: (foundInContent()) ? \'wsb-seo-keyword-in-content\' : \'\', text: displayText"></li>\r\n	                    <!-- /ko -->\r\n                    </ul>\r\n                </div>\r\n            </div>\r\n            <!-- /ko -->\r\n            <!-- ko if: currentStep() == Steps.Finish-->\r\n            <!-- ko if: nextSeoPage() != null -->\r\n            <div class="clearfix">\r\n                <div class="sf-dialog-title-seo2" data-bind= "text: i18NDict[\'Client__SEO__Finish_NiceJob\']"></div>\r\n                <div class="wsb-seo-step-tip" data-bind= "text: i18NDict[\'Client__SEO__Finish_LetsMakeChangesLive\']"></div>\r\n                <div class="wsb-seo-finish-publish">\r\n                    <a class="btn btn-success" data-bind="text: i18NDict[\'Client__SEO__Finish_PublishSite\'], event: { click: callPublish }"></a>\r\n                </div>\r\n                <div class="wsb-seo-finish-text"><span data-bind= "text: i18NDict[\'Client__SEO__Finish_NextPage\']"></span> <b><span data-bind="text: nextSeoPage().PageName()"></span></b></div>\r\n            </div>\r\n            <!-- /ko -->\r\n            <!-- ko if: nextSeoPage() == null -->\r\n            <div class="clearfix">\r\n                <div class="sf-dialog-title-seo2" data-bind= "text: i18NDict[\'Client__SEO__Finish_NiceJob\']"></div>\r\n                <div class="wsb-seo-step-tip" data-bind= "text: i18NDict[\'Client__SEO__Finish_LetsMakeChangesLive\']"></div>\r\n                <div class="wsb-seo-finish-publish">\r\n                    <a class="btn btn-success" data-bind="text: i18NDict[\'Client__SEO__Finish_Publish\'], event: { click: callPublish }"></a>\r\n                </div>\r\n                <div class="wsb-seo-finish-text" data-bind= "text: i18NDict[\'Client__SEO__Finish_YouveFinished\']"></div>\r\n            </div>\r\n            <!-- /ko -->\r\n            <!-- /ko -->\r\n\r\n            <div class="wsb-seo-step-nav-container">\r\n                <a id="btn-seo-sb-back" class="btn btn-inverse-grey" data-bind="visibility: (currentStep() != 1), event: { click: navigateBack }" style="margin-right:5px;">\r\n                    <i class="wsb-seo-back-icn"></i>&nbsp;<span data-bind="    text: backButtonText"></span>\r\n                </a>\r\n                <a id="btn-seo-sb-next" class="btn btn-inverse-grey" data-bind="event: { click: navigateNext }"><span data-bind="    text: nextButtonText"></span>&nbsp;\r\n                    <i class="wsb-seo-next-icn"></i>\r\n                </a>\r\n            </div>\r\n             <!-- ko if: currentStep() == Steps.Description-->\r\n                <a href="" style="float:right;margin-top: -15px;" data-bind="text: i18NDict[\'Client__SEO__SkipThisStep\'], event: { click: function (data, event) { navigateNext(data, event, true) } }"><span></span></a>\r\n            <!-- /ko -->\r\n            <!-- ko if: currentStep() != Steps.Finish-->\r\n            <div class="wsb-seo-explained-container">\r\n                <!-- ko if: currentStep() != Steps.SelectKeywords-->\r\n                <div class="wsb-seo-explained-title" data-bind= "text: i18NDict[\'Client__SEO__Explained\']"></div>\r\n                <!-- /ko -->\r\n                <!-- ko if: currentStep() == Steps.SelectKeywords-->\r\n                <a href="javascript:void(0)" onclick="$(\'#SelectKeywordsExplained\').toggle();" data-bind= "text: i18NDict[\'Client__SEO__Explained_WhyCantIType\']"></a>\r\n                <!-- /ko -->\r\n                <!-- ko if: currentStep() == Steps.PageAbout-->\r\n                <div class="wsb-seo-explained-content"><span data-bind= "text: i18NDict[\'Client__SEO__Explained__PageAbout_WeRecommend\']"></span> <b data-bind= "text: i18NDict[\'Client__SEO__Explained__SinglePhrase\']"></b>. <span data-bind="text:i18NDict[\'Client__SEO__Explained__PageAbout_HelpsSearchEngine\']"></span><br />\r\n                    <br /> \r\n                    <span data-bind= "text: i18NDict[\'Client__SEO__Explained__ForExample\']"></span> <b data-bind= "text: i18NDict[\'Client__SEO__Explained__HeatingRepair\']"></b><span data-bind= "text: i18NDict[\'Client__SEO__Explained__Both\']"></span> <b data-bind= "text: i18NDict[\'Client__SEO__Explained__Heating\']"></b><span data-bind= "text: i18NDict[\'Client__SEO__Explained__Units\']"></span> <b data-bind= "text: i18NDict[\'Client__SEO__Explained__ACRepair\']"></b>, <span data-bind="text: i18NDict[\'Client__SEO__Explained__PhraseShouldBe\']"></span> <b data-bind= "text: i18NDict[\'Client__SEO__Explained__ACRepair\']"></b>.<br />\r\n                    <br /> <span data-bind= "text: i18NDict[\'Client__SEO__Explained__WeWillOptimize\']"></span> <b data-bind= "text: i18NDict[\'Client__SEO__Explained__HeatingRepair\']"></b>,<span data-bind="    text: i18NDict[\'Client__SEO__Explained__HelpsBring\']"></span> <b><span data-bind= "text: i18NDict[\'Client__SEO__Explained__RightVisitors\']"></span></b><span data-bind= "text: i18NDict[\'Client__SEO__Explained__ToPage\']"></span>\r\n                </div>\r\n                <!-- /ko -->\r\n                <!-- ko if: currentStep() == Steps.PrimaryLocation-->\r\n                <div class="wsb-seo-explained-content"><span data-bind= "text: i18NDict[\'Client__SEO__Explained__PrimaryLocation_HelpTarget\']"></span><br /><span data-bind= "text: i18NDict[\'Client__SEO__Explained__PrimaryLocation_TargetMultiple\']"></span>\r\n                </div>\r\n                <!-- /ko -->\r\n                <!-- ko if: currentStep() == Steps.SelectKeywords-->\r\n                <div class="wsb-seo-explained-content" style="display: none;" id="SelectKeywordsExplained"><span data-bind= "text: i18NDict[\'Client__SEO__Explained__SelectKeywords_Description\']"></span>\r\n                    <br />\r\n                    <br />\r\n                    <i><span data-bind= "text: i18NDict[\'Client__SEO__Explained__WhyCantI\']"></span></i><br /><span data-bind= "text: i18NDict[\'Client__SEO__Explained__SelectKeywords_BasedOnResearch\']"></span><br />\r\n                </div>\r\n                <!-- /ko -->\r\n                <!-- ko if: currentStep() == Steps.FocusKeyword-->\r\n                <div class="wsb-seo-explained-content"><span data-bind= "text: i18NDict[\'Client__SEO__Explained__FocusKeyword_WeRecommend\']"></span> <b><span data-bind= "text: i18NDict[\'Client__SEO__Explained__SinglePhrase\']"></span></b>.<span data-bind="text: i18NDict[\'Client__SEO__Explained__FocusKeyword_HelpSearchEngines\']"></span><br />\r\n                    <br /><span data-bind= "text: i18NDict[\'Client__SEO__Explained__ForExample\']"></span> <b><span data-bind= "text: i18NDict[\'Client__SEO__Explained__HeatingRepair\']"></span></b>&nbsp;<span data-bind= "text: i18NDict[\'Client__SEO__Explained__Both\']"></span> <b><span data-bind= "text: i18NDict[\'Client__SEO__Explained__Heating\']"></span></b>&nbsp;<span data-bind= "text: i18NDict[\'Client__SEO__Explained__Units\']"></span> , <b><span data-bind= "text: i18NDict[\'Client__SEO__Explained__ACRepair\']"></span></b>,&nbsp;<span data-bind="text: i18NDict[\'Client__SEO__Explained__PhraseShouldBe\']"></span> <b><span data-bind= "text: i18NDict[\'Client__SEO__Explained__ACRepair\']"></span></b>.<br />\r\n                    <br /><span data-bind= "text: i18NDict[\'Client__SEO__Explained__WeWillOptimize\']"></span> <b><span data-bind= "text: i18NDict[\'Client__SEO__Explained__HeatingRepair\']"></span></b>, <span data-bind="text: i18NDict[\'Client__SEO__Explained__HelpsBring\']"></span>&nbsp;<b><span data-bind= "text: i18NDict[\'Client__SEO__Explained__RightVisitors\']"></span></b> <span data-bind= "text: i18NDict[\'Client__SEO__Explained__ToPage\']"></span>\r\n                </div>\r\n                <!-- /ko -->\r\n                <!-- ko if: currentStep() == Steps.Title-->\r\n                <div class="wsb-seo-explained-content"><span data-bind= "text: i18NDict[\'Client__SEO__Explained__Title\']"></span><br />\r\n                    <br /><span data-bind= "text: i18NDict[\'Client__SEO__Explained__Title_Research\']"></span><br />\r\n                    <br />\r\n                    <i> <span data-bind= "text: i18NDict[\'Client__SEO__Explained__WhyCantI\']"></span></i><br /><span data-bind= "text: i18NDict[\'Client__SEO__Explained__Title_Require\']"></span><br />\r\n                </div>\r\n                <!-- /ko -->\r\n                <!-- ko if: currentStep() == Steps.Description-->\r\n                <div class="wsb-seo-explained-content">\r\n                    <span data-bind= "text: i18NDict[\'Client__SEO__Explained__Description\']"></span><br />\r\n                    <br /><span data-bind= "text: i18NDict[\'Client__SEO__Explained__Description_Tip\']"></span><br />\r\n                    <br /><span data-bind= "text: i18NDict[\'Client__SEO__Example\']"></span>\r\n                    <br /><span data-bind= "text: i18NDict[\'Client__SEO__Explained__Description_CallUs\']"></span> <b data-bind= "text: i18NDict[\'Client__SEO__Explained__ACRepair\']"></b>\r\n                </div>\r\n                <!-- /ko -->\r\n                <!-- ko if: currentStep() == Steps.Heading-->\r\n                <div class="wsb-seo-explained-content"><span data-bind= "text: i18NDict[\'Client__SEO__Explained__Heading\']"></span><br />\r\n                    <br /><span data-bind= "text: i18NDict[\'Client__SEO__Explained__Heading_Tip\']"></span>\r\n                    <b data-bind= "text: i18NDict[\'Client__SEO__Explained__ACRepair\']"></b>&nbsp;<span data-bind= "text: i18NDict[\'Client__SEO__Explained__Heading_CouldBecome\']"></span> <b data-bind= "text: i18NDict[\'Client__SEO__Explained__Heading_Guaranteed\']"></b>.\r\n                </div>\r\n                <!-- /ko -->\r\n                <!-- ko if: currentStep() == Steps.KeywordsInContent-->\r\n                <div class="wsb-seo-explained-content"><span data-bind= "text: i18NDict[\'Client__SEO__Explained__KeywordsInContent\']"></span><br />\r\n                    <br /><span data-bind= "text: i18NDict[\'Client__SEO__Explained__KeywordsInContent_Tip\']"></span><br />\r\n                    <br />\r\n                </div>\r\n                <!-- /ko -->\r\n            </div>\r\n            <!-- /ko -->\r\n        </div>\r\n    </div>\r\n    <!-- /ko -->\r\n    <div id="seo-h1-overlay-pointer" class="wsb-seo-overlay-pointer" data-bind="style: { top: h1PointerPosition().top, left: h1PointerPosition().left }, visible: (headlineSuggestion() != null)">\r\n        <div class="wsb-seo-overlay-content-arrow"></div>\r\n        <div class="wsb-seo-overlay-text wsb-seo-overlay-added-text" data-bind="text: i18NDict[\'Client__SEO__Explained__Interactions_NotContainHeadline\'], visible: addHighlightedElement"></div>\r\n        <div class="wsb-seo-overlay-h1-content-container">\r\n            <div data-bind="text: i18NDict[\'Client__SEO__Explained__Interactions_HeadlineShouldContain\'], css: h1ContainsFocus() ? \'wsb-seo-overlay-text-success\' : \'wsb-seo-overlay-text\'"></div>\r\n            <div class="wsb-seo-overlay-suggest-item" data-bind="css: h1ContainsFocus() ? \'wsb-seo-keyword-in-content\' : \'\', text: (headlineSuggestion() != null) ? $root.toPascalCase(headlineSuggestion().displayText()) : \'\'"></div>\r\n        </div>\r\n        <!--\r\n        <div class="wsb-seo-overlay-reverth1-container">\r\n            <a href="#" data-bind="event: { click: revertDesignerChanges }">Revert Changes</a>\r\n        </div>\r\n        -->\r\n        <div class="wsb-seo-overlay-insert-container">\r\n            <button data-bind="text: i18NDict[\'Client__SEO__Explained__Interactions_InsertHeadline\'], event: { click: insertIntoHeadline }, visible: !h1ContainsFocus()" class="btn btn-inverse-grey"></button>\r\n        </div>\r\n    </div>\r\n    <div id="seo-content-overlay-pointer" class="wsb-seo-overlay-pointer" data-bind="style: { top: contentPointerPosition().top, left: contentPointerPosition().left }, visible: (contentSuggestion() != null)">\r\n        <div class="wsb-seo-overlay-content-arrow"></div>\r\n        <div class="wsb-seo-overlay-text wsb-seo-overlay-added-text" data-bind="text: i18NDict[\'Client__SEO__Explained__Interactions_NotContainParagraph\'], visible: addHighlightedElement"></div>\r\n        <div class="wsb-seo-overlay-keyword-content-container">\r\n            <!--\r\n                <div class="wsb-seo-overlay-revertcontent-container"><a href="#" data-bind="event: { click: revertDesignerChanges }">Revert Changes</a></div>\r\n                -->\r\n            <div data-bind="text: i18NDict[\'Client__SEO__Explained__Interactions_RecommendParagraph\'], css: allSelectedKeywordsInContent() ? \'wsb-seo-overlay-text-success\' : \'wsb-seo-overlay-text\'"></div>\r\n            <ul class="wsb-seo-phrase-list">\r\n                <!-- ko foreach: selectedKeywords -->\r\n                <li class="" data-bind="css: (foundInContent()) ? \'wsb-seo-keyword-in-content\' : \'\', text: displayText"></li>\r\n                <!-- /ko -->\r\n            </ul>\r\n        </div>\r\n    </div>\r\n    \r\n    <div id="seoWelcomeFirstTimeModal" class="sf-dialog wsb-seo-kickstart-modal" data-title="" style="display:none">           \r\n        <h2 class="wsb-seo-kickstart-modal-header" data-bind= "text: i18NDict[\'Client__SEO__StartSearchEngineOptimization\']"></h2>\r\n        <div class="wsb-seo-kickstart-modal-padding">\r\n            <div class="wsb-seo-kickstart-modal-image"></div>\r\n            <div>\r\n                <div data-bind= "text: i18NDict[\'Client__SEO__ReadyToKickstart\']"></div>\r\n                <div style="padding-top:20px"><span data-bind="text: i18NDict[\'Client__SEO__EstimatedTime\']"></span>: <strong data-bind= "text: i18NDict[\'Client__SEO__5To10Min\']"></strong></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <div id="initialLoadingModal" class="sf-dialog" data-title=" " style="display:none"></div>\r\n    \r\n    <div id="seoShowWhatWeHaveDone" class="sf-dialog wsb-seo-publish-modal" data-title="" style="display:none;">           \r\n        <h2 class="wsb-seo-publish-modal-header" data-bind= "text: i18NDict[\'Client__SEO__WhatWeDidForYou_Publish\']"></h2>\r\n        <div class="wsb-seo-publish-modal-padding">\r\n            <div>\r\n                <div data-bind= "text: i18NDict[\'Client__SEO__WhatWeDidForYou\']"></div>\r\n                <div style="padding:20px 0 0 20px"><div class="wsb-seo-publish-modal-image"></div><span data-bind= "text: i18NDict[\'Client__SEO__WhatWeDidForYou_Item1\']"></span></div>\r\n                <div style="padding:20px 0 0 20px"><div class="wsb-seo-publish-modal-image"></div><span data-bind= "text: i18NDict[\'Client__SEO__WhatWeDidForYou_Item2\']"></span></div>\r\n                <div style="padding:20px 0 0 20px"><div class="wsb-seo-publish-modal-image"></div><span data-bind= "text: i18NDict[\'Client__SEO__WhatWeDidForYou_Item3\']"></span></div>\r\n                <div style="padding:20px 0 0 20px"><div class="wsb-seo-publish-modal-image"></div><span data-bind= "text: i18NDict[\'Client__SEO__WhatWeDidForYou_Item4\']"></span></div>\r\n                <div style="padding:20px 0 0 20px"><div class="wsb-seo-publish-modal-image"></div><span data-bind= "text: i18NDict[\'Client__SEO__WhatWeDidForYou_Item5\']"></span></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <!--Seo Error Modal-->\r\n\r\n    <div id="seoErrorModal" style="display:none" data-bind = "attr: { title: i18NDict[\'Yikes_we_hit_a_snag\'] }">\r\n        <div style="padding:20px" data-bind="html: seoRefreshTryAgain">\r\n        </div>\r\n    </div>\r\n    \r\n    <div id="seoOptimizeHomePageFirst" style="display:none" data-bind = "attr: { title: i18NDict[\'Client__SEO__WelcomeModalNotSoFast\'] }">\r\n        <div style="padding:20px" data-bind= "text: i18NDict[\'Client__SEO__WelcomeModalBody\']">\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n\r\n<div class="wsb-actionbar-seo-controls">\r\n    <ul class="wsb-seo-wizard-progress clearfix">\r\n        <li class="wsb-business-step" data-bind="css: { active_step: activePage() == 0 }">\r\n            <a class="wsb-sev-biz-info-icn" data-bind="click: displayBusinessInformation"></a>\r\n            <span class="step-name" data-bind="click: displayBusinessInformation, text: i18NDict[\'Client__SEO__ActionBar_BusinessInfo\']"></span>\r\n        </li>\r\n        <!-- ko foreach: seoPages() -->\r\n            <!-- ko if: $data.IsHomePage() -->\r\n                <li class="wsb-page-step" data-bind="css: { active_step: $root.activePage() == $data.Id() }">\r\n                    <a class="wsb-sev-steps-pg-icn" data-bind="click: function () { $root.displayPage($data); }"></a>\r\n                    <span class="step-name" data-bind="text: $data.PageName, click: function () { $root.displayPage($data); }"></span>\r\n                </li>\r\n            <!-- /ko -->\r\n        <!-- /ko -->\r\n        <!-- ko foreach: seoPages() -->\r\n            <!-- ko if: !$data.IsHomePage() -->\r\n                <li class="wsb-page-step" data-bind="css: { active_step: $root.activePage() == $data.Id() }">\r\n                    <a class="wsb-sev-steps-pg-icn" data-bind="click: function () { $root.displayPage($data); }"></a>\r\n                    <span class="step-name" data-bind="text: $data.PageName, click: function () { $root.displayPage($data); }"></span>\r\n                </li>\r\n            <!-- /ko -->\r\n        <!-- /ko -->\r\n    </ul> \r\n</div>  \r\n</div>\r\n'
}),define("designer/wsb/seo/seoEditor",["jquery","knockout","designer/app/app","common/logger/logger","designer/app/builder/ui/controls/toolbox/hint","common/persistence/persistence","designer/app/builder/data/designerData","napsoc","designer/app/builder/ui/controls/toolbox/toolbox","designer/app/builder/ui/controls/publish/publish","common/regexhelper/regexhelper","designer/wsb/seo/serviceAreaMapper","designer/wsb/seo/competitorSuggestion","common/seoEnabled/seoEnabled","common/stats/googleanalytics","common/napsoc/napsocForm","designer/app/builder/data/data","designer/app/builder/managers/pageManager","designer/app/builder/managers/elementManager","designer/app/builder/managers/addressManager","businessCategories","common/abTesting/abTesting","/i18n/resources/client","common/metrics/productMetrics","text!designer/wsb/seo/seoEditor.html"],function(e,t,n,a,r,o,s,l,d,c,u,p,g,h,m,b,f,v,y,_,w,S,k,x,C){var T,E,P,D,I,A=f.saver,M={Home:0,About:1,Contact:2,Services:3,Menu:4,Other:5},O=["home","about","contact","services","menu","other"],L={BizInfo:1,BizLocale:2,BizServiceAreas:3,BizCompetitors:4,PageAbout:5,PrimaryLocation:6,SelectKeywords:7,FocusKeyword:8,Title:9,Description:10,Heading:11,KeywordsInContent:12,Finish:13},N=13,B=L.PageAbout,F=L.PrimaryLocation,R=L.Title,H=L.BizInfo,V=L.BizCompetitors,z=L.Finish,j={};!function(){Object.keys(L).reduce(function(e,t){return e[""+L[t]]=""+t,e},j)}();var U=function(t){void 0==t||null==t?(E={},W(),E.seoShellOverall=e(C).appendTo(E.container)):E=t},W=function(){E.desktop=e("#wsb-shell-seo-desktop"),E.mobile=e("#wsb-shell-preview-mobile"),E.container=n.getMap().apps.builder,E.canvas=e(".wsb-canvas"),E.toolbox=e(".wsb-shell-toolbox"),E.seoLocationAreaRadiusSelected=e("#seoLocationAreaRadius option:selected"),E.templateEditor=e("#wsb-canvas-template-container"),E.ckEditors=e(".cke"),E.h1OverlayPointer=e("#seo-h1-overlay-pointer"),E.contentOverlayPointer=e("#seo-content-overlay-pointer")},q=function(){function n(e){var t=l.observables();if(e&&null!=e){var n="";n=e.BusinessName&&""!=e.BusinessName?e.BusinessName:t.Name(),Y.businessId(e.ID),Y.businessName(n),Y.categoryID(e.CategoryID),Y.offerings.removeAll();for(var i=0;i<e.Offerings.length;i++){var a=new Z(e.Offerings[i]);Y.subscribeOfferingsForDirtyApiCalls(a),Y.offerings.push(a)}Y.isGlobal(e.IsGlobal)}else Y.businessId(0),Y.businessName(t.Name()),Y.categoryID(t.BusinessCategoryId()),Y.isGlobal(!1);for(var i=Y.offerings().length;2>i;i++){var r=new Z("");Y.subscribeOfferingsForDirtyApiCalls(r),Y.offerings.push(r)}}function r(){var e=[];t.utils.arrayForEach(Y.offerings(),function(t){null!=t&&""!=t.offeringValue()&&e.push(t.offeringValue())});var n=!1;Y.isMissingBusinessInfo()&&Y.businessInformationExists()&&(n=!0,Y.isMissingBusinessInfo(!1));var i={BusinessName:Y.businessName(),Offerings:e,IsGlobal:Y.isGlobal(),ID:Y.businessId(),CategoryID:Y.categoryID(),InitialInfoCompleteFlag:n};l.observables().BusinessCategoryId(Y.categoryID()),b.resetCategory(),o.Post("/api/websites/{websiteId}/SeoBusiness?businessId="+Y.businessId(),i,function(e){Y.businessId(e)},Y.showErrorDialog)}function d(){var e=[];t.utils.arrayForEach(Y.offerings(),function(t){null!=t&&""!=t.offeringValue()&&e.push(t.offeringValue())});var n={BusinessName:Y.businessName(),Offerings:e,IsGlobal:Y.isGlobal(),ID:Y.businessId(),CategoryID:Y.categoryID(),InitialInfoCompleteFlag:!1};o.Post("/api/websites/{websiteId}/SeoBusinessLocale?businessId="+Y.businessId(),n,function(){},Y.showErrorDialog)}function u(e){var n={ID:e.id(),Address:e.locationName(),Latitude:e.lat,Longitude:e.lon,AreaRadius:e.radius,IsPrimary:e.isPrimary()};o.Post("/api/websites/{websiteId}/SeoLocationServiceAreas?businessId="+Y.businessId(),n,function(e){var n=t.utils.arrayFirst(Y.serviceAreas(),function(e){return 0===e.id()});n.id(e)},function(){Y.showErrorDialog(),p.removeCircle(e.circleId),Y.serviceAreas.remove(e)})}function g(e){o.Delete("/api/websites/{websiteId}/SeoLocationServiceAreas?businessId="+Y.businessId()+"&bizLocationId="+e.id()+"&address="+escape(e.locationName()),function(){},Y.showErrorDialog)}function h(e){if(!(Y.serviceAreas().length<1)){var t=[];for(i=0;i<Y.serviceAreas().length;i++)t.push(Y.serviceAreas()[i].locationName());var n={SMProjectId:Y.SM_ProjectId,locations:t,primaryLocation:e};o.Put("/api/websites/{websiteId}/SeoLocation",n,function(){},Y.showErrorDialog)}}function f(){o.Delete("/api/websites/{websiteId}/SeoLocation?smProjectId="+Y.SM_ProjectId,function(){},Y.showErrorDialog)}function _(){var e=t.utils.arrayFirst(Y.serviceAreas(),function(e){return e.isPrimary()}),n={BusinessId:Y.businessId(),BusinessLocationId:e.id(),Address:e.locationName()};o.Post("/api/websites/{websiteId}/SeoPrimaryLocation",n,function(){},Y.showErrorDialog),h(e.locationName())}function C(){for(var e=[],t=Y.chosenOfferings(),n=0;n<t.length;n++)e.push(t[n].offeringValue());null!=Y.pageOtherOffering()&&""!=Y.pageOtherOffering().trim()&&e.push(Y.pageOtherOffering());var i={SMProjectId:Y.SM_ProjectId,SMPageId:Y.SM_PageId,Phrases:e};o.Put("/api/websites/{websiteId}/SeoProjectPagePhrase",i,Y.loadSuggestedKeywords(),Y.showErrorDialog)}function T(){var e=[],n=[],i=[];t.utils.arrayForEach(Y.selectedKeywords(),function(t){var n={displayText:t.value(),focus:t.isFocus()};e.push(n)}),t.utils.arrayForEach(Y.removedKeywords(),function(e){n.push(e.value())}),t.utils.arrayForEach(Y.neutralKeywords(),function(e){i.push(e.value())});var a={PageReferenceId:Y.activePage(),BusinessId:Y.businessId(),Keywords:e};o.Post("/api/websites/{websiteId}/SeoPageKeywords",a,function(){},Y.showErrorDialog);var r={SMProjectId:Y.SM_ProjectId,SMPageId:Y.SM_PageId,LikedKeywords:e,DislikedKeywords:n,NeutralKeywords:i};o.Post("/api/websites/{websiteId}/SeoKeywordSuggestionModifier",r,function(){},function(){}),t.utils.arrayForEach(Y.selectedKeywords(),function(e){m.trackEvent("wsb-seo-editor","selected-keyword-index-"+e.positionIndex,"checkbox")}),m.trackEvent("wsb-seo-editor","removed-keywords-count-"+Y.removedKeywords().length,"checkbox")}function U(){var e={WebsiteId:I.user.websiteId,SMProjectId:Y.SM_ProjectId,SMPageId:Y.SM_PageId,Value:Y.description(),DisplayText:Y.description(),PageReferenceId:Y.activePage()},t=Y.getPageObj(Y.activePage());void 0!=t&&t.PageDescription(Y.description()),o.Put("/api/websites/{websiteId}/SeoPageDescription",e,function(){},Y.showErrorDialog)}function q(){var n;if(void 0!=Y.highlightedElement()&&null!=Y.highlightedElement()){var i=e("#"+Y.highlightedElement().ID()).find("p"),a=!1,r="";t.utils.arrayForEach(Y.selectedKeywords(),function(t){for(var o=t.displayText(),s=!1,l=0;l<i.length;l++){var d=i[l];if(r=e(d).text(),Y.IsFoundInContentStrictWithLocationSplit(o,r)){s=!0;break}}t.foundInContent(s),s||a||(a=!0,n=t)})}return n}function $(e,n,i,a,r,o){var s=this;this.id=t.observable(0),this.locationName=t.observable(e),this.lat=n,this.lon=i,this.radius=a,this.isPrimary=t.observable(r),this.circleId=o,this.getRadiusString=t.computed(function(){return s.radius&&""!=s.radius?" ("+s.radius+" miles)":""},this)}function K(e,n,i,a,r,o){var s=this;s.displayText=t.observable(r),s.value=t.observable(e),s.chosen=t.observable(n),s.removed=t.observable(i),s.isFocus=t.observable(a),s.hover=t.observable(!1),s.foundInContent=t.observable(!1),s.positionIndex=o}var Y=this;Y.CategoryVisible=t.observable(!1),Y.i18NDict=k.resources,Y.seoRefreshTryAgain=k.resources.Client__SEO__Refresh_Try_Again.format("<a href='/help/support' target='_blank' class='publish-cancel-lnk'>","</a>"),Y.isLocaleInAcceptedList=function(){var e=I.config.seoModeConfig.CategoryVisibleRegex,t=k.locale;if(null!=e&&e.length>0)for(var n=0;n<e.length;n++)null!=t.match(e[n])&&Y.CategoryVisible(!0)},Y.currentStep=t.observable(L.PageAbout),Y.inBusinessMode=t.computed(function(){return Y.currentStep()<B}),Y.RadiusOptions=t.observableArray([{Value:5,Text:k.resources.Client__SEO__BizServiceAreas_FiveMiles},{Value:10,Text:k.resources.Client__SEO__BizServiceAreas_TenMiles},{Value:25,Text:k.resources.Client__SEO__BizServiceAreas_TwentyFiveMiles},{Value:50,Text:k.resources.Client__SEO__BizServiceAreas_FiftyMiles},{Value:100,Text:k.resources.Client__SEO__BizServiceAreas_HundredMiles}]),Y.selectedRadius=t.observable("10"),Y.showDoTheHomePageModal=t.observable(!1),Y.businessId=t.observable(0),Y.businessName=t.observable(""),Y.categoryID=t.observable(0),Y.offerings=t.observableArray([]),Y.isGlobal=t.observable(""),Y.isMissingBusinessInfo=t.observable(!1),Y.globalHover=t.observable(!1),Y.localHover=t.observable(!1),Y.activePage=t.observable(""),Y.firstStepInPanelSequence=t.observable(0),Y.backFromPageData=t.observable(void 0),Y.serviceAreas=t.observableArray([]),Y.minKeywordsToSelect=t.observable(2),Y.maxKeywordsToSelect=t.observable(3),Y.keywordPhraseOptions=t.observableArray([]),Y.titleOptions=t.observableArray([]),Y.h1Options=t.observableArray([]),Y.titleLinkText=t.observable(k.resources.Client__SEO__Title_DefaultTitleExample),Y.maxKeywordPhrasesToShow=t.observable(10),Y.description=t.observable(""),Y.focusInDescription=t.observable(!1),Y.headlineSuggestion=t.observable(void 0),Y.contentSuggestion=t.observable(void 0),Y.descriptionRemainingChars=t.observable(165),Y.pageAboutOther=t.observable(!1),Y.pageOtherOffering=t.observable(""),Y.pageType=t.observable(-1),Y.pageData=t.observable(""),Y.SM_ProjectId=0,Y.SM_PageId=0,Y.highlightedElement=t.observable(void 0),Y.addHighlightedElement=t.observable(!1),Y.firstTimeHeadline=t.observable(!0),Y.firstTimeGrader=t.observable(!0),Y.elementOriginalHtml="",Y.currentH1OverlayPosition={top:"0px",left:"0px"},Y.currentParagraphOverlayPosition={top:"0px",left:"0px"},Y.repositionOverlayPointer=t.observable(!0),Y.pageMarkCompleted=!1,Y.showStep=function(e,t){Y.currentStep(e),Y.clearDesignerHighlight(),Y.inBusinessMode()?(Y.activePage(0),E.canvas.hide()):(E.canvas.show(),e==L.Heading?Y.setupForH1Modification(t):e==L.KeywordsInContent&&Y.setupForContentGraderModification(t)),e==L.BizInfo&&Y.isLocaleInAcceptedList(),e==L.BizServiceAreas&&p.triggerGoogleMapsApiLoad(P.LoadServiceAreasWithMap),e==L.SelectKeywords&&Y.pageType()!=M.Other&&Y.loadSuggestedKeywords(),e==L.FocusKeyword&&null!=Y.focusKeyword()&&Y.loadSuggestedTitles(),e==L.Description&&(Y.pageType()==M.Home&&m.trackEvent("wsb-seo-editor","description-panel-loaded-homePage"),Y.ValidateDescriptionIncludesKeywordErrorMessage(""),Y.loadDescription()),Y.currentStep()==z&&(Y.showDoTheHomePageModal(!1),Y.markPageAsComplete());var n;for(var i in L)L[i]===e&&(n=i.toString())},Y.LoadServiceAreasWithMap=function(){p.reset(),Y.LoadServiceAreasWithCallBack(Y.LoadServiceAreasSuccessCallbackWithMap)},Y.LoadServiceAreasWithCallBack=function(e){(void 0==e||null==e)&&(e=function(){}),Y.serviceAreas([]),o.Get("/api/websites/{websiteId}/SeoLocationServiceAreas?businessId="+Y.businessId(),e,Y.showErrorDialog)},Y.LoadServiceAreasSuccessCallbackNoMap=function(e){if(e&&e.length>0){for(var t=0;t<e.length;t++){var n=e[t],i=new $(n.Address,n.Latitude,n.Longitude,n.AreaRadius,n.IsPrimary,0);i.id(n.ID),Y.serviceAreas.push(i)}Y.displayPage(Y.currentSeoPage())}else Y.activePage(0),Y.showStep(L.BizLocale)},Y.LoadServiceAreasSuccessCallbackWithMap=function(e){if(e&&e.length>0)for(var t=0;t<e.length;t++){var n=e[t],i=t==e.length-1,a=p.persistCircle(n.Address,n.Latitude,n.Longitude,n.AreaRadius,i),r=new $(n.Address,n.Latitude,n.Longitude,n.AreaRadius,n.IsPrimary,a.circleID);r.id(n.ID),Y.serviceAreas.push(r)}},Y.businessInformationExists=t.computed(function(){var e=t.utils.arrayFirst(Y.offerings(),function(e){return""!=e.offeringValue()});return Y.CategoryVisible()?Y.businessId()>0&&Y.categoryID()>0&&null!=e:Y.businessId()>0&&null!=e}),Y.ValidateBusinessNameErrorMessage=t.observable(""),Y.ValidateBusinessOfferingRequiredErrorMessage=t.observable(""),Y.ValidateBusinessServiceAreasErrorMessage=t.observable(""),Y.ValidateBusinessCategoryErrorMessage=t.observable(""),Y.ValidatePrimaryLocationIsSetErrorMessage=t.observable(""),Y.ValidateSelectKeywordsIsSetErrorMessage=t.observable(""),Y.ValidateKeywordFocusIsSetErrorMessage=t.observable(""),Y.ValidateTitleIsSetErrorMessage=t.observable(""),Y.ValidateDescriptionIncludesKeywordErrorMessage=t.observable(""),Y.ValidatePageAboutOfferingIsSetErrorMessage=t.observable(""),Y.ValidateBusinessNameIsValid=function(){return Y.ValidateBusinessNameErrorMessage(""),null==Y.businessName()||""==Y.businessName()?(Y.ValidateBusinessNameErrorMessage(k.resources.Client__SEO__BizInfo_Validation_BusinessNameMissing),m.trackEvent("wsb-seo-editor","validation-failed-missingBusinessName"),!1):Y.businessName().length>75?(Y.ValidateBusinessNameErrorMessage(k.resources.Client__SEO__BizInfo_Validation_BusinessTooLong),m.trackEvent("wsb-seo-editor","validation-failed-businessNameLength"),!1):!0},Y.ValidateBusinessOfferingsIsValid=function(){Y.ValidateBusinessOfferingRequiredErrorMessage(k.resources.Client__SEO__BizInfo_Validation_AtLeastOneOffering);var e=!1,n=!1;return t.utils.arrayForEach(Y.offerings(),function(t){Y.StringContainsComma(t.offeringValue())&&(Y.ValidateBusinessOfferingRequiredErrorMessage(k.resources.Client__SEO__BizInfo_Validation_OfferingWithComma),e=!1,n=!0),""!=t.offeringValue()&&t.offeringValue().length<81&&!n&&(Y.ValidateBusinessOfferingRequiredErrorMessage(""),e=!0)}),!e&&n?m.trackEvent("wsb-seo-editor","validation-failed-offering-comma"):e||m.trackEvent("wsb-seo-editor","validation-failed-zeroOfferings"),e},Y.ValidateServiceAreasIsValid=function(){return Y.ValidateBusinessServiceAreasErrorMessage(""),Y.serviceAreas().length<1?(Y.ValidateBusinessServiceAreasErrorMessage(k.resources.Client__SEO__BizServiceAreas_Validation_AtLeastOneServiceArea),m.trackEvent("wsb-seo-editor","validation-failed-zeroServiceAreas"),!1):!0},Y.ValidateCategoryNewValueIsValid=function(e){Y.ValidateBusinessCategoryErrorMessage("");var t;return void 0===e||null===e||0==e||""==e?(Y.ValidateBusinessCategoryErrorMessage(k.resources.Client__SEO__BizInfo_Validation_InvalidCategory),m.trackEvent("wsb-seo-editor","validation-failed-new-category0"),t=!1):(t=Y.isCategoryValid(e),t||m.trackEvent("wsb-seo-editor","validation-failed-new-invalidCategory")),t},Y.ValidateCategoryIsValid=function(){Y.ValidateBusinessCategoryErrorMessage("");var e;return Y.CategoryVisible()?(null==Y.categoryID()||0==Y.categoryID()?(Y.ValidateBusinessCategoryErrorMessage(k.resources.Client__SEO__BizInfo_Validation_InvalidCategory),m.trackEvent("wsb-seo-editor","validation-failed-category0"),e=!1):(e=Y.isCategoryValid(Y.categoryID()),e||m.trackEvent("wsb-seo-editor","validation-failed-invalidCategory")),e):!0},Y.invalidCategoriesArray=t.observableArray([k.resources.Client__SEO__BizInfo_Category_Undefined,k.resources.Client__SEO__BizInfo_Category_Mining,k.resources.Client__SEO__BizInfo_Category_Construction,k.resources.Client__SEO__BizInfo_Category_Manufacturing,k.resources.Client__SEO__BizInfo_Category_TransportationPublicUtils,k.resources.Client__SEO__BizInfo_Category_WholesaleTrade,k.resources.Client__SEO__BizInfo_Category_RetailTrade,k.resources.Client__SEO__BizInfo_CategoryFinanceInsuranceRealEstate,k.resources.Client__SEO__BizInfo_Category_Services,k.resources.Client__SEO__BizInfo_Category_PublicAdministration]),Y.isCategoryValid=function(e){var n=!0;return t.utils.arrayForEach(Y.invalidCategoriesArray(),function(t){var i=Y.getSelectedCategory(w,e);return t===i.Name&&(n=!1,Y.ValidateBusinessCategoryErrorMessage(k.resources.Client__SEO__BizInfo_Validation_CategoryMoreSpecific)),n}),n},Y.ValidatePrimaryLocationIsSet=function(){var e=!1;return Y.ValidatePrimaryLocationIsSetErrorMessage(k.resources.Client__SEO__PrimaryLocation_Validation_AtLeastOneLocation),t.utils.arrayForEach(Y.serviceAreas(),function(t){t.isPrimary()===!0&&(e=!0,Y.ValidatePrimaryLocationIsSetErrorMessage(""))}),e||m.trackEvent("wsb-seo-editor","validation-failed-primaryLocationNotSelected"),e},Y.ValidateSelectKeywordsIsSet=function(){var e=!1,t=k.resources.Client__SEO__SelectKeywords_Please_Select+" "+Y.minKeywordsToSelect()+"-"+Y.maxKeywordsToSelect()+" "+k.resources.Phrases.toLowerCase()+".";return Y.ValidateSelectKeywordsIsSetErrorMessage(t),Y.selectedKeywords().length>=Y.minKeywordsToSelect()&&Y.selectedKeywords().length<=Y.maxKeywordsToSelect()?(Y.ValidateSelectKeywordsIsSetErrorMessage(""),e=!0):Y.selectedKeywords().length<Y.minKeywordsToSelect()?m.trackEvent("wsb-seo-editor","validation-failed-tooFewKeywordsSelected"):m.trackEvent("wsb-seo-editor","validation-failed-tooManyKeywordsSelected"),e},Y.ValidateSelectKeywordsFocusIsSet=function(){var e=Y.focusKeyword();return null!=e?(Y.ValidateKeywordFocusIsSetErrorMessage(""),!0):(Y.ValidateKeywordFocusIsSetErrorMessage(k.resources.Client__SEO__FocusKeyword_Validation_AtLeastOneKeyword),m.trackEvent("wsb-seo-editor","validation-failed-focusNotSelected"),!1)},Y.ValidateTitleOptionIsChosen=function(){var e=Y.chosenTitle();return null!=e?(Y.ValidateTitleIsSetErrorMessage(""),!0):(Y.ValidateTitleIsSetErrorMessage(k.resources.Client__SEO__Title_Validation_SelectOption),m.trackEvent("wsb-seo-editor","validation-failed-titleNotSelected"),!1)},Y.ValidateDescriptionIncludesFocusKeyword=function(){return Y.focusInDescription()?(Y.ValidateDescriptionIncludesKeywordErrorMessage(""),!0):(Y.ValidateDescriptionIncludesKeywordErrorMessage(k.resources.Client__SEO__Description_Validation_IncludeFocus),m.trackEvent("wsb-seo-editor","validation-failed-focusNotIncludedInDescription"),!1)},Y.ValidatePageAboutOfferingIsSet=function(){return Y.chosenOfferings().length>0||null!=Y.pageOtherOffering()&&""!=Y.pageOtherOffering().trim()?(Y.ValidatePageAboutOfferingIsSetErrorMessage(""),!0):(Y.ValidatePageAboutOfferingIsSetErrorMessage(k.resources.Client__SEO__PageAbout_Validation_SelectOptionOrEnter),!1)},Y.isValid=function(){var e=!1;switch(Y.currentStep()){case L.BizInfo:var t=Y.ValidateBusinessNameIsValid(),n=Y.ValidateBusinessOfferingsIsValid(),i=Y.ValidateCategoryIsValid();e=n&&t&&i;break;case L.BizServiceAreas:var a=Y.ValidateServiceAreasIsValid();e=a;break;case L.PrimaryLocation:var r=Y.ValidatePrimaryLocationIsSet();e=r;break;case L.SelectKeywords:var o=Y.ValidateSelectKeywordsIsSet();e=o;break;case L.FocusKeyword:var s=Y.ValidateSelectKeywordsFocusIsSet();e=s;break;case L.Title:var l=Y.ValidateTitleOptionIsChosen();e=l;break;case L.Description:var d=Y.ValidateDescriptionIncludesFocusKeyword();e=d;break;case L.PageAbout:var c=Y.ValidatePageAboutOfferingIsSet();e=c;break;default:e=!0}return e},Y.navigateNext=function(e,t,n){if(null==Y.SM_ProjectId||0==Y.SM_ProjectId)return void Y.showErrorDialog();if(n)Y.currentStep()==L.Description&&(Y.pageType()==M.Home&&m.trackEvent("wsb-seo-editor","navigate-next-skip-description-homePage"),m.trackEvent("wsb-seo-editor","navigate-next-skip-description"));else{if(!Y.isValid())return;Y.save()}if(Y.currentStep()==V)if(null!=Y.backFromPageData())Y.displayPage(Y.backFromPageData());else{var i=Y.getHomePageData();Y.displayPage(i)}else if(Y.currentStep()==z){var a=Y.nextSeoPage();null==a?(G(),m.trackEvent("wsb-seo-editor","navigate-next-exiting")):(Y.displayPage(a),m.trackEvent("wsb-seo-editor","navigate-next-movingToNextPage"))}else Y.currentStep()==L.BizLocale&&Y.isGlobal()?Y.currentStep(L.BizCompetitors):Y.currentStep()==L.PageAbout?Y.currentStep(L.SelectKeywords):(Y.currentStep()==L.BizInfo&&x.sendBusinessCategoryMetrics(Y.categoryID()),Y.currentStep(Y.currentStep()+1)),Y.currentStep()>N&&Y.currentStep(N),Y.currentStep()==L.BizCompetitors?Y.navigateNext():Y.showStep(Y.currentStep(),!0);m.trackEvent("wsb-seo-editor","next_on"+j[Y.currentStep()-1],"button")},Y.navigateBack=function(){if(Y.currentStep()==Y.firstStepInPanelSequence()){var e=Y.previousSeoPage();return null!=e?void Y.displayPage(e):void Y.displayBusinessInformation()}Y.currentStep(Y.currentStep()==L.SelectKeywords&&Y.pageType()==M.Other?L.PageAbout:Y.currentStep()-1),Y.currentStep()<1&&Y.currentStep(1),Y.currentStep()==L.BizCompetitors?Y.navigateBack():Y.showStep(Y.currentStep(),!1),m.trackEvent("wsb-seo-editor","back_on"+j[""+Y.currentStep()],"button")},Y.backButtonText=t.computed(function(){if(Y.currentStep()==Y.firstStepInPanelSequence()){var e=Y.previousSeoPage();return null!=e?k.resources.Client__SEO__BackButton_EditPrevious:k.resources.Client__SEO__BackButton_Back}return k.resources.Client__SEO__BackButton_Back}),Y.nextButtonText=t.computed(function(){return Y.currentStep()==L.Finish?null==Y.nextSeoPage()?k.resources.Client__SEO__NextButton_Exit:k.resources.Client__SEO__NextButton_Next:k.resources.Client__SEO__NextButton_Next});var J=S.getOption("SEO_KW_MinMax");Y.minKeywordsToSelect=t.observable(I.config.seoModeConfig.UX.Keywords[J].MinOptionsToSelect),Y.maxKeywordsToSelect=t.observable(I.config.seoModeConfig.UX.Keywords[J].MaxOptionsToSelect),Y.ensureProject=function(e){Y.getHomePageData();o.Post("/api/websites/{websiteId}/SeoEnsureProject",{SMProjectId:-1,domain:D,name:Y.businessName().trim(),local:k.locale,isTest:I.user.shopperId.length<4},e,Y.showErrorDialog,!1)},Y.ensureProjectPage=function(e,t,n){o.Post("/api/websites/{websiteId}/SeoEnsureProjectPage",{SMProjectId:Y.SM_ProjectId,SMPageId:-1,pageUrl:D+"/"+Y.pageData().PageFilename(),pageType:e,PageReferenceId:t},n,Y.showErrorDialog,!1)},Y.ensureProjectCallbackWithEnsurePage=function(e){Y.ensureProjectCallback(e),Y.ensureProjectPage("home",Y.pageData().Id(),Y.ensureProjectPageFirstTimeCallback)},Y.ensureProjectCallback=function(e){Y.SM_ProjectId=e,Y.categoryID()>0&&0==Y.activePage()&&Y.saveCategory(Y.categoryID()),Y.subscribeToObservablesForDirtyApiCalls()},Y.ensureProjectPageFirstTimeCallback=function(t){Y.SM_PageId=t,e("#initialLoadingModal").sfDialog("close"),e("#seoWelcomeFirstTimeModal").sfDialog("close")},Y.ensureProjectPageCallback=function(t){Y.SM_PageId=t,e("#initialLoadingModal").sfDialog("close")},Y.displayPage=function(t){Y.pageData(t);var n=Y.getHomePageData();if(Y.showDoTheHomePageModal()&&t.Id()!=n.Id())return require(["wsbcore/dialog"],function(){e("#seoOptimizeHomePageFirst").sfDialog({buttons:[{id:"btnSeoOptmizeHomePageFirstOk",text:k.resources.Client__SEO__WelcomeModalButton,onClick:function(){e("#seoOptimizeHomePageFirst").sfDialog("close")},enabledClasses:"btn btn-success"}]})}),!1;if(Y.businessInformationExists()){Y.activePage(t.Id()),Y.backFromPageData(t);var i=Y.getPageType(t);Y.pageType(i);{O[i]}if(Y.ensureProjectPage(O[i],Y.activePage(),Y.ensureProjectPageCallback),0==Y.serviceAreas().length&&!Y.isGlobal())return void Y.LoadServiceAreasWithCallBack(Y.LoadServiceAreasSuccessCallbackNoMap);switch(Y.resetPageSelections(),i){case M.Home:1==Y.serviceAreas().length?(Y.serviceAreas()[0].isPrimary()||(Y.serviceAreas()[0].isPrimary(!0),_()),Y.firstStepInPanelSequence(L.SelectKeywords),Y.showStep(L.SelectKeywords)):Y.isGlobal()?(Y.firstStepInPanelSequence(L.SelectKeywords),Y.showStep(L.SelectKeywords)):(Y.firstStepInPanelSequence(F),Y.showStep(F));break;case M.About:case M.Services:case M.Menu:case M.Contact:Y.firstStepInPanelSequence(R),Y.showStep(R);var a=Y.getHomePageData();Y.loadInternalPageKeywords(a.Id()),Y.loadSuggestedTitles();break;default:Y.ValidatePageAboutOfferingIsSetErrorMessage(""),Y.firstStepInPanelSequence(B),Y.showStep(B)}E.desktop.hide(),v.switchPage(t.Id()),Y.scrollCanvas(0)}},Y.getHomePageData=function(){var e=X(),n=t.utils.arrayFirst(e,function(e){return e.IsHomePage()});return n},Y.nextSeoPage=function(){var e;if(0==Y.activePage())e=Y.getHomePageData();else{var n=X(),i=Y.activePage();e=t.utils.arrayFirst(n,function(e){return!e.IsHomePage()&&e.Id()>i})}return e},Y.previousSeoPage=function(){if(0==Y.activePage())return null;if(Y.currentSeoPage().IsHomePage())return null;for(var e=X(),t=Y.activePage(),n=e.length-1;n>=0;n--){var i=e[n];if(!i.IsHomePage()&&i.Id()<t)return i}return Y.getHomePageData()},Y.currentSeoPage=function(){var e=X(),n=Y.activePage(),i=t.utils.arrayFirst(e,function(e){return e.Id()==n});return i},Y.getPageType=function(e){var t=e.PageFilename().toString().toLowerCase().replace("_","").replace(" ","").replace("-",""),n=M.Other;return e.IsHomePage()?n=M.Home:"about.html"==t||"aboutus.html"==t?n=M.About:"contact.html"==t||"contactus.html"==t?n=M.Contact:"services.html"==t?n=M.Services:"menu.html"==t&&(n=M.Menu),n},Y.loadFirstScreen=function(){Y.GetHomePageCompletetionStatus(),Y.loadBusinessInformation(Y.loadFirstScreenCallback)},Y.GetHomePageCompletetionStatus=function(){o.Get("/api/websites/{websiteId}/SeoCompletionStatus",Y.GetHomePageCompletetionStatusSuccessCallBack,function(){a.log("SeoCompletionStatus Persistence Get Failed")})},Y.GetHomePageCompletetionStatusSuccessCallBack=function(e){for(var t=Y.getHomePageData(),n=[],i=0;i<e.length;i++)if(t.Id()==e[i].PageReferenceId){n=e[i];break}n.StatusId<2&&Y.showDoTheHomePageModal(!0)},Y.loadFirstScreenCallback=function(){Y.businessInformationExists()?(Y.ensureProject(Y.ensureProjectCallback),Y.displayPage(Y.getHomePageData())):(Y.pageData(Y.getHomePageData()),Y.isMissingBusinessInfo(!0),Y.activePage(0),Y.showStep(H),Y.businessId()<=0?Y.seoWelcomeFirstTimeModal():Y.ensureProject(Y.ensureProjectCallbackWithEnsurePage))},Y.loadBusinessInformation=function(t){e("#initialLoadingModal").sfDialog({message:k.resources.Client__SEO__Loading}),o.Get("/api/websites/{websiteId}/SeoBusiness",function(e){n(e),void 0!==t&&null!=t&&t()},Y.showErrorDialog)},Y.displayBusinessInformation=function(){if(Y.businessInformationExists()){var e=Y.getHomePageData();Y.ensureProjectPage("home",e.Id(),Y.ensureProjectPageCallback),Y.activePage(0),Y.showStep(H)}else Y.loadBusinessInformation(Y.displayBusinessInformationCallback)},Y.displayBusinessInformationCallback=function(){Y.activePage(0),Y.showStep(H)},Y.Steps=L,Y.PageTypes=M,Y.save=function(){switch(Y.currentStep()){case L.BizInfo:r();break;case L.BizLocale:d(),Y.isGlobal()&&f();break;case L.BizServiceAreas:var e=Y.primaryServiceArea();null!=e&&h(e.locationName());break;case L.PageAbout:C();break;case L.SelectKeywords:T();break;case L.Description:U();break;case L.Heading:A.save(),(void 0==I.settings.SearchMetricsPublishReady||null==I.settings.SearchMetricsPublishReady)&&(I.settings.SearchMetricsPublishReady=!0,s.updateWebsiteSettings({SearchMetricsPublishReady:!0}));break;case L.KeywordsInContent:A.save()}},Y.subscribeToObservablesForDirtyApiCalls=function(){Y.businessName.subscribe(Y.businessNamesubscribe),Y.categoryID.subscribe(Y.categoryIDsubscribe)},Y.businessNamesubscribe=function(e){Y.ValidateBusinessNameIsValid()&&(Y.save(),o.Put("/api/websites/{websiteId}/SeoProject",{SMProjectId:Y.SM_ProjectId,domain:D,name:e.trim(),local:k.locale},function(){},Y.showErrorDialog))},Y.categoryIDsubscribe=function(e){Y.ValidateCategoryNewValueIsValid(e)&&e&&Y.saveCategory(e)},Y.saveCategory=function(e){if(Y.CategoryVisible()){var t=Y.getSelectedCategory(w,e);t&&Y.isCategoryValid(t.Id)&&o.Put("/api/websites/{websiteId}/SeoProjectCategory",{SMProjectId:Y.SM_ProjectId,category:t.Name},Y.saveCategorySuccessCallBack(t),Y.saveCategoryFailureCallBack)}},Y.saveCategorySuccessCallBack=function(){Y.save()},Y.saveCategoryFailureCallBack=function(){a.log("Error putting project category in sem")},Y.subscribeOfferingsForDirtyApiCalls=function(e){e&&e.offeringValue.subscribe(Y.offeringValueSubscribe)},Y.offeringValueSubscribe=function(){if(Y.ValidateBusinessOfferingsIsValid()){var e=[];t.utils.arrayForEach(Y.offerings(),function(t){null!=t&&""!=t.offeringValue()&&e.push(t.offeringValue())}),o.Put("/api/websites/{websiteId}/SeoProjectPagePhrase",{SMProjectId:Y.SM_ProjectId,SMPageId:Y.SM_PageId,phrases:e},function(){Y.save()},function(){a.log("Error saving project page offerings in sem")})}},Y.hasValueChanged=function(e,t){return e&&t!=e},Y.getSelectedCategory=function(e,t){for(var n=null,i=0;i<e.length;i++){if(e[i].Id==Y.categoryID()){n=e[i];break}if(e[i].Children&&(n=Y.getSelectedCategory(e[i].Children,t)))break}return n},Y.localOptionMouseOver=function(){Y.localHover(!0)},Y.localOptionClick=function(){m.trackEvent("wsb-seo-editor","BizLocale","image"),Y.isGlobal(!1)},Y.businessNameToolTip=function(){require(["wsbcore/context"],function(){e("#businessNameTip").sfContext({anchor:e("#businessName"),positionIdeal:"tl",autoOpen:!0,width:285})})},Y.businessCategoryToolTip=function(){require(["wsbcore/context"],function(){e("#businessOfferingsTip").sfContext({anchor:e("#OfferingsInput"),positionIdeal:"bl",autoOpen:!0,width:322})})},Y.seotargetAreaToolTip=function(){require(["wsbcore/context"],function(){e("#seo-targetAreaTip").sfContext({anchor:e("#seo-targetArea-flyout-bubble"),positionIdeal:"bl",autoOpen:!0,width:250})})},Y.seoWelcomeFirstTimeModal=function(){require(["wsbcore/dialog"],function(){e("#initialLoadingModal").sfDialog("close"),e("#seoWelcomeFirstTimeModal").sfDialog({title:"Welcome",titleHidden:!0,dialogWidthIdeal:"565",closeOnEscape:!1,cancelDisabled:!0,buttons:[{id:"ok",text:k.resources.Client__Designer__Get_Started,onClick:function(){m.trackEvent("wsb-seo-editor","welcome-modal-get-started","button"),r(),e("#seoWelcomeFirstTimeModal").sfDialog({message:k.resources.Client__SEO__Loading}),Y.ensureProject(Y.ensureProjectCallbackWithEnsurePage)},style:"button",enabledClasses:"btn btn-success"},{id:"cancel",text:k.resources.Client__SEO__IllComeBack,onClick:function(){m.trackEvent("wsb-seo-editor","welcome-modal-come-back-later","link"),I.address.previousAction?(I.address.currentAction(I.address.previousAction),e("#seoWelcomeFirstTimeModal").sfDialog("close")):(e("#seoWelcomeFirstTimeModal").sfDialog({message:k.resources.Client__SEO__Loading}),window.location=document.referrer)},style:"link"}]})})},Y.showErrorDialog=function(){m.trackEvent("wsb-seo-editor","show-error-dialog-"+Y.currentStep()),require(["wsbcore/dialog"],function(){e("#seoErrorModal").sfDialog({buttons:[{id:"btnSeoErrorOk",text:k.resources.OK,onClick:function(){window.location.reload()},enabledClasses:"btn btn-success"}],title:k.resources.Yikes_we_hit_a_snag})})},Y.localOptionMouseOut=function(){Y.localHover(!1)},Y.globalOptionMouseOver=function(){Y.globalHover(!0)},Y.globalOptionClick=function(){m.trackEvent("wsb-seo-editor","select-global","image"),Y.isGlobal(!0)},Y.globalOptionMouseOut=function(){Y.globalHover(!1)},Y.changeMapRadius=function(){m.trackEvent("wsb-seo-editor","service-area-radius-changed","dropdown");var e=parseInt(Y.selectedRadius());p.setRadius(e)},Y.addServiceAreaOnEnter=function(){setTimeout(function(){Y.addServiceArea()},300)},Y.addServiceArea=function(){e("#seo-targetAreaTip").sfContext("close"),m.trackEvent("wsb-seo-editor","add-service-area","button");var n=p.persistCurrentCircle();if(null==n)Y.ValidateBusinessServiceAreasErrorMessage(k.resources.Client__SEO__BizServiceAreas_Validation_LocationNotFound);else{var i=new $(n.name,n.lat,n.lng,n.radius,!1,n.circleID),a=t.utils.arrayFirst(Y.serviceAreas(),function(e){return i.locationName()===e.locationName()});a?Y.ValidateBusinessServiceAreasErrorMessage(k.resources.Client__SEO__BizServiceAreas_Validation_SelectUniqueArea):(Y.ValidateBusinessServiceAreasErrorMessage(""),Y.serviceAreas.push(i),u(i),e("#seo-targetArea").val(""))}},Y.removeServiceArea=function(e){m.trackEvent("wsb-seo-editor","remove-service-area","link"),p.removeCircle(e.circleId),Y.serviceAreas.remove(e),g(e)},Y.loadInternalPageKeywords=function(e){Y.keywordPhraseOptions([]),o.Get("/api/websites/{websiteId}/SeoPageKeywords?businessId="+Y.businessId()+"&pageReferenceId="+e,Y.loadInternalKeywordsCallback,Y.showErrorDialog)},Y.loadInternalKeywordsCallback=function(e){if(e&&e.length>0)for(var t=0;t<e.length;t++){var n=e[t],i=new K(n.Keyword,!0,!1,n.IsFocus,n.DisplayText,t+1);Y.keywordPhraseOptions.push(i)}},Y.loadSuggestedKeywords=function(){return null==Y.SM_ProjectId||0==Y.SM_ProjectId?void Y.showErrorDialog():(Y.ValidateSelectKeywordsIsSetErrorMessage(""),Y.keywordPhraseOptions([]),void o.Get("/api/websites/{websiteId}/SeoKeywordSuggestions?websiteId="+I.user.websiteId+"&businessId="+Y.businessId()+"&pageReferenceId="+Y.activePage()+"&smPageId="+Y.SM_PageId+"&smProjectId="+Y.SM_ProjectId,Y.loadSuggestedKeywordsCallback,Y.showErrorDialog))},Y.loadSuggestedKeywordsCallback=function(t){if(t&&t.length>0){for(var n=0;n<t.length;n++){var i=t[n],a=new K(i.Suggestion,i.Chosen,!1,i.Focus,i.DisplayText,n+1);
Y.keywordPhraseOptions.push(a)}require(["wsbcore/tipper"],function(){e("#seoKeywordOptions .sf-tip").sfTipper({wireup:!0})})}},Y.loadSuggestedTitles=function(){Y.ValidateTitleIsSetErrorMessage(""),Y.titleOptions([]),o.Get("/api/websites/{websiteId}/SeoPageTitle?websiteId="+I.user.websiteId+"&smPageId="+Y.SM_PageId+"&pageReferenceId="+Y.activePage()+"&smProjectId="+Y.SM_ProjectId,Y.loadSuggestedTitlesCallback,Y.showErrorDialog)},Y.loadSuggestedTitlesCallback=function(e){if(e&&e.length>0)for(var t=0;t<e.length;t++){var n=e[t],i=new K(n.Suggestion,n.Chosen,!1,!1,Y.toPascalCase(n.Suggestion),t+1);Y.titleOptions.push(i),n.Chosen&&Y.titleLinkText(n.Suggestion)}},Y.loadDescription=function(){var e=Y.focusKeyword(),t=!1,n="";if(""!=Y.description())n=Y.description();else{var i=Y.getPageObj(Y.activePage());n=i.PageDescription(),""!=n&&null!=n&&Y.description(n)}null!=e&&null!=n&&(t=Y.IsFoundInContentStrictWithLocationSplit(e.displayText(),n)),Y.focusInDescription(t)},Y.getPageObj=function(e){for(var t=v.pages(),n=0,i=t.length;i>n;n++)if(t[n].Id()===e)return t[n];return null},Y.pageAboutOtherClick=function(){m.trackEvent("wsb-seo-editor","page-about-other-click","link"),Y.pageAboutOther(!0)},Y.toggleOfferingChosen=function(e){e.chosen(!e.chosen())},Y.chosenOfferings=t.computed(function(){return t.utils.arrayFilter(Y.offerings(),function(e){return e.chosen()})}),Y.resetChosenOfferings=function(){t.utils.arrayForEach(Y.offerings(),function(e){e.chosen(!1)})},Y.serviceAreaPrimarySelected=function(e){t.utils.arrayForEach(Y.serviceAreas(),function(t){t.isPrimary(t===e?!0:!1)}),_()},Y.primaryServiceArea=t.computed(function(){return t.utils.arrayFirst(Y.serviceAreas(),function(e){return e.isPrimary()})}),Y.resetPageSelections=function(){Y.keywordPhraseOptions.removeAll(),Y.titleOptions.removeAll(),Y.h1Options.removeAll(),Y.resetChosenOfferings(),Y.titleLinkText(k.resources.Client__SEO__Title_DefaultTitleExample),Y.description(""),Y.focusInDescription(!1),Y.pageAboutOther(!1),Y.pageOtherOffering(""),Y.firstTimeHeadline(!0),Y.firstTimeGrader(!0),Y.pageMarkCompleted=!1},Y.toggleKeywordChosen=function(e){e.chosen(!e.chosen())},Y.showAllKeywords=function(){Y.maxKeywordPhrasesToShow(Y.keywordPhraseOptions().length),m.trackEvent("wsb-seo-editor","show-More-Keywords-Pressed"),x.send("SeoWizardLoadMorePhrases",null,null,!0),setTimeout(function(){require(["wsbcore/tipper"],function(){e("#seoKeywordOptions .sf-tip").sfTipper({wireup:!0})})},200)},Y.keywordPhraseOptionsToDisplay=t.computed(function(){for(var e=[],t=0,n=0;n<Y.keywordPhraseOptions().length;n++){var i=Y.keywordPhraseOptions()[n];if(i.removed()||(e.push(i),t++),t>=Y.maxKeywordPhrasesToShow())break}return e}),Y.neutralKeywords=t.computed(function(){return t.utils.arrayFilter(Y.keywordPhraseOptionsToDisplay(),function(e){return!e.chosen()&&!e.removed()})}),Y.selectedKeywords=t.computed(function(){return t.utils.arrayFilter(Y.keywordPhraseOptions(),function(e){return e.chosen()&&!e.removed()})}),Y.removedKeywords=t.computed(function(){return t.utils.arrayFilter(Y.keywordPhraseOptions(),function(e){return e.removed()})}),Y.removeKeywordAllowed=t.computed(function(){return Y.keywordPhraseOptionsToDisplay().length>3}),Y.removeKeyword=function(t){e(".sf-qt").hide(),t.removed(!0)},Y.sidebarOptionMouseOver=function(e){e.hover(!0)},Y.sidebarOptionMouseOut=function(e){e.hover(!1)},Y.focusChosen=function(e){t.utils.arrayForEach(Y.keywordPhraseOptions(),function(t){t.isFocus(t===e?!0:!1)}),Y.saveFocusKeyword(e.value())},Y.saveFocusKeyword=function(e){if(null!=e&&""!=e){Y.titleOptions([]);var t={WebsiteId:I.user.websiteId,SMProjectId:Y.SM_ProjectId,SMPageId:Y.SM_PageId,Keyword:e,BusinessId:Y.businessId(),PageReferenceId:Y.activePage()};o.Put("/api/websites/{websiteId}/SeoFocusKeyword",t,function(){Y.loadSuggestedTitles()},Y.showErrorDialog)}},Y.focusKeyword=t.computed(function(){return Y.ValidateKeywordFocusIsSetErrorMessage(""),t.utils.arrayFirst(Y.selectedKeywords(),function(e){return e.isFocus()})}),Y.titleOptionsToDisplay=t.computed(function(){for(var e=[],t=4,n=0,i=0;i<Y.titleOptions().length;i++){var a=Y.titleOptions()[i];if(a.removed()||(e.push(a),n++),n>=t)break}return e}),Y.chooseTitle=function(e){t.utils.arrayForEach(Y.titleOptions(),function(t){t===e?(t.chosen(!0),Y.titleLinkText(t.displayText())):t.chosen(!1)}),Y.saveTitle(e.value(),e.displayText())},Y.saveTitle=function(e,t){if(null!=e&&""!=e){var n={WebsiteId:I.user.websiteId,SMProjectId:Y.SM_ProjectId,Value:e,DisplayText:t,PageReferenceId:Y.activePage(),SMPageId:Y.SM_PageId},i=Y.getPageObj(Y.activePage());void 0!=i&&i.PageTitle(t),o.Put("/api/websites/{websiteId}/SeoPageTitleModifier",n,function(){},Y.showErrorDialog)}},Y.chosenTitle=t.computed(function(){return t.utils.arrayFirst(Y.titleOptions(),function(e){return e.chosen()})}),Y.descriptionKeyup=function(){var e=165,t=Y.description();t.length>e&&Y.description(t.substring(0,e)),t=Y.description(),Y.descriptionRemainingChars(e-t.length);var n=Y.focusKeyword(),i=!1;null!=n&&null!=t&&(i=Y.IsFoundInContentStrictWithLocationSplit(n.displayText(),t)),i&&Y.ValidateDescriptionIncludesKeywordErrorMessage(""),Y.focusInDescription(i)},Y.offeringsKeyup=function(){var e=!1;return Y.ValidateBusinessOfferingRequiredErrorMessage(""),t.utils.arrayForEach(Y.offerings(),function(t){""!=t.offeringValue()&&(e=Y.StringContainsComma(t.offeringValue()),e&&Y.ValidateBusinessOfferingRequiredErrorMessage(k.resources.Client__SEO__BizInfo_Validation_OfferingWithComma))}),e},Y.StringContainsComma=function(e){return e.indexOf(",")>-1},Y.allSelectedKeywordsInContent=t.computed(function(){if(null!=Y.highlightedElement()&&void 0!=Y.highlightedElement()&&void 0!=Y.contentSuggestion()&&null!=Y.contentSuggestion()){var e=t.utils.arrayFirst(Y.selectedKeywords(),function(e){return!e.foundInContent()});return null==e}return!1}),Y.h1ContainsFocus=t.computed(function(){if(null!=Y.focusKeyword()&&null!=Y.highlightedElement()&&void 0!=Y.highlightedElement()){var t=Y.highlightedElement().Html(),n=Y.findValidElementInControl("h1");if(null==n)return!1;t=e(n).text();var i=Y.focusKeyword().displayText();return Y.IsFoundInContentStrictWithLocationSplit(i,t)}return!1}),Y.keywordsFoundInContent=t.computed(function(){if(null!=Y.highlightedElement()&&void 0!=Y.highlightedElement()){var t=Y.highlightedElement().Html(),n=Y.findValidElementInControl("p");t=null!=n?e(n).text():"",q(t)}}),Y.findValidElementInControl=function(t){if(null!=Y.highlightedElement()&&void 0!=Y.highlightedElement()){var n=e("#"+Y.highlightedElement().ID()).find(t),i=Y.retrieveFirstItemWithValidText(n);return i}return null},Y.IsFoundInContentStrictWithLocationSplit=function(e,t){if(null!=e&&null!=t){e=e.toLowerCase(),t=t.toLowerCase();var n=!1,i=e.indexOf(" in ");if(i>-1){var a=e.substr(0,i),r=e.substr(i+4);n=t.indexOf(a)>-1&&t.indexOf(r)>-1}else n=t.indexOf(e)>-1;return n}return!1},Y.IsFoundInContentStrict=function(e,t){if(null!=e&&null!=t){e=e.toLowerCase(),t=t.toLowerCase();var n=t.indexOf(e)>-1;return n}return!1},Y.IsFoundInContentLax=function(e,t){if(null!=e&&null!=t){e=e.toLowerCase(),t=t.toLowerCase();for(var n=!0,i=/\w+/g,a=e.match(i),r=t.match(i),o=0;o<a.length;o++){var s=r.indexOf(a[o]);if(0>s){n=!1;break}}return n}return!1},Y.onOverlayPointerDrag=function(){Y.repositionOverlayPointer(!1)},Y.setupForH1Modification=function(t){var n=Y.focusKeyword().displayText();Y.highlightFirstElementOfType("h1",Y.toPascalCase(n));var i=Y.findValidElementInControl("h1"),a=e(i).text();Y.firstTimeHeadline()&&!Y.addHighlightedElement()&&Y.IsFoundInContentStrictWithLocationSplit(n,a)?t?Y.navigateNext():Y.navigateBack():(Y.firstTimeHeadline(!1),Y.headlineSuggestion(Y.focusKeyword()),W(),E.h1OverlayPointer.draggable({drag:Y.onOverlayPointerDrag}))},Y.insertIntoHeadline=function(){if(null!=Y.highlightedElement()&&void 0!=Y.highlightedElement()&&null!=Y.headlineSuggestion()){var t=e("#"+Y.highlightedElement().ID()).find("h1"),n=Y.retrieveFirstItemWithValidText(t);if(null!=n){for(var i=Y.highlightedElement().tokenReplacedHtml(),a=n.outerHTML,r=n.outerHTML.replace("</h1>","<br></h1>"),o=e("<h1>"+Y.toPascalCase(Y.headlineSuggestion().displayText())+"</h1>"),s=0,l=n.attributes,d=l.length;d>s;s++){var c=n.attributes[s];o.attr(c.name,c.value)}var u=o[0].outerHTML;i=i.replace(a,u).replace(r,u),Y.highlightedElement().Html(i)}}},Y.setupForContentGraderModification=function(t){var n=Y.focusKeyword().displayText();Y.highlightFirstElementOfType("p",n);var i=Y.findValidElementInControl("p"),a=e(i).text(),r=q(a);Y.firstTimeGrader()&&!Y.addHighlightedElement()&&null==r?t?Y.navigateNext():Y.navigateBack():(Y.firstTimeGrader(!1),Y.contentSuggestion(Y.focusKeyword()),W(),E.contentOverlayPointer.draggable({drag:Y.onOverlayPointerDrag}))},Y.clearDesignerHighlight=function(){Y.scrollCanvas(0),Y.highlightedElement(null),Y.contentSuggestion(null),Y.headlineSuggestion(null),Y.addHighlightedElement(!1),Y.currentH1OverlayPosition={top:"0px",left:"0px"},Y.currentParagraphOverlayPosition={top:"0px",left:"0px"},Y.repositionOverlayPointer(!0),e(".cke").hide()},Y.retrieveFirstItemWithValidText=function(e){for(var t,n=0;n<e.length;n++){var i=e[n];if(Y.isValidElementForInteraction(i)){t=i;break}}return t},Y.isValidElementForInteraction=function(t){var n=e(t).text();if(null!=n){var i=n.trim();i=i.toLowerCase();var a=l.observables(),r=a.Name();return null!=r&&(r=r.trim().toLowerCase()),""!=i&&i!=r&&"[site_name]"!=i&&i!=Y.businessName()}},Y.highlightFirstElementOfType=function(t,n){function i(){var e=166,t=100,n=r.getBoundingClientRect(),i=n.top-e-t;0>i&&(i=0),Y.scrollCanvas(parseInt(i)),Y.highlightedElement(a),a.selectElement(),Y.elementOriginalHtml=a.Html()}Y.clearDesignerHighlight();for(var a,r,o=y.getAllElementViewModelsOnCurrentPage(!0),s=99999999,l=0;l<o.length;l++){var d=o[l];if("text"==d.Type()&&!d.Shared()){var c=e("#"+d.ID()).find(t);if(c.length>0){var u=Y.retrieveFirstItemWithValidText(c);if(null!=u){var p=parseInt(d.Top().substr(0,d.Top().length-2)),g=parseInt(d.Left().substr(0,d.Left().length-2)),h=Math.sqrt(Math.pow(p,2)+Math.pow(g,2));s>h&&(a=d,s=h,r=u)}}}}null==a?y.addNewElementToCanvas({Type:"text"},function(o){o.Html("<"+t+">"+n+"</"+t+">"),a=o,Y.addHighlightedElement(!0),e("#"+o.ID()).find(".wsb-text-element").focus(),r=e("#"+o.ID()).find(t)[0],m.trackEvent("wsb-seo-editor","added-missing-element-"+t),i()}):i()},Y.scrollCanvas=function(t){e(".wsb-canvas").scrollTop(t)},Y.h1PointerPosition=t.computed(function(){if(null!=Y.highlightedElement()&&void 0!=Y.highlightedElement()&&void 0!=Y.headlineSuggestion()&&null!=Y.headlineSuggestion()&&Y.repositionOverlayPointer()){var e=(Y.highlightedElement().Html(),Y.highlightedElement().Top(),Y.highlightedElement().Left(),Y.findValidElementInControl("h1"));if(null!=e){var t=e.getBoundingClientRect(),n=t.top+t.height+10;Y.currentH1OverlayPosition.left=t.left+"px",Y.currentH1OverlayPosition.top=n.toString()+"px"}}return Y.currentH1OverlayPosition}),Y.contentPointerPosition=t.computed(function(){if(null!=Y.highlightedElement()&&void 0!=Y.highlightedElement()&&void 0!=Y.contentSuggestion()&&null!=Y.contentSuggestion()&&Y.repositionOverlayPointer()){var e=(Y.highlightedElement().Html(),Y.highlightedElement().Top(),Y.highlightedElement().Left(),Y.findValidElementInControl("p"));if(null!=e){var t=e.getBoundingClientRect(),n=t.top+t.height+10;Y.currentParagraphOverlayPosition.left=t.left+"px",Y.currentParagraphOverlayPosition.top=n.toString()+"px"}}return Y.currentParagraphOverlayPosition}),Y.toPascalCase=function(e){return null!=e&&void 0!=e&&(e=e.replace(/\w\S*/g,function(e){return e[0].toUpperCase()+e.slice(1).toLowerCase()}),e=e.replace(k.resources.Client__SEO__In,k.resources.Client__SEO__In_lower),e=e.replace(k.resources.Client__SEO__Of,k.resources.Client__SEO__Of_lower)),e},Y.callPublish=function(){return Y.markPageAsComplete(),x.send("SeoWizardPublish",null,null,!0),I.settings.SeoPublishModalShown?void c.publish({callback:function(){},bypassConfirmation:!1}):void require(["wsbcore/dialog"],function(){e("#seoShowWhatWeHaveDone").sfDialog({titleHidden:!0,closeOnEscape:!1,cancelDisabled:!0,buttons:[{id:"btnSeoPublish",text:k.resources.Publish,onClick:function(){I.settings.SeoPublishModalShown=!0,m.trackEvent("wsb-seo-editor","publish_seo","button"),s.updateWebsiteSettings({SeoPublishModalShown:!0}).fail(function(){a.log("Error saving website setting 'SeoPublishModalShown'")}),c.publish({callback:function(){},bypassConfirmation:!0}),e("#seoShowWhatWeHaveDone").sfDialog("close")},enabledClasses:"btn btn-success"}]})})},Y.markPageAsComplete=function(){if(!Y.pageMarkCompleted){var e=Y.currentSeoPage().IsHomePage();o.Put("/api/websites/{websiteId}/SeoCompletionStatus/",{pageReferenceId:Y.activePage(),statusId:2,IsHomePage:e},function(){},Y.showErrorDialog)}Y.pageMarkCompleted=!0},Y.overlayVisible=t.computed(function(){return Y.currentStep()!=L.Heading&&Y.currentStep()!=L.KeywordsInContent});var Z=function(e){var n=this;n.offeringValue=t.observable(e),n.chosen=t.observable(!1)},X=function(){var e=[],n=v.pages(),i=0;n=n.sort(function(e,t){return e.Id()>t.Id()?1:-1});var a=t.utils.arrayFirst(n,function(e){return e.IsHomePage()});a&&(e.push(a),i++);for(var r=0;r<n.length;r++){var o=n[r];if(o.IsHomePage()||(e.push(o),i++),i>=5)break}return e};Y.seoPages=X},$=function(){return I=f.getDataModel(),h.isValid(I.info.Account.Domain,I.config)?void(E.seoShellOverall.is(":visible")||(e(".wsb-canvas").addClass("wsb-seo-offset"),m.trackEvent("wsb-seo-editor","launch","loaded"),x.send("SeoWizardStarted",null,null,!0),E.mobile.hide(),E.seoShellOverall.show(),P.loadFirstScreen(),setTimeout(function(){e(".sf-context-mode-custom").hide()},1e3),setTimeout(function(){e(".sf-context-mode-custom").hide()},3e3))):void I.address.currentAction(_.actions.edit)},G=function(){null!=P&&P.clearDesignerHighlight(),E.desktop.hide(),E.seoShellOverall.hide(),e(".wsb-canvas").removeClass("wsb-seo-offset")},K=function(n,i,a){I=f.getDataModel(),U(a),E.desktop.hide(),E.mobile.hide(),E.seoShellOverall.hide(),P=new q,I.address.isSeoAction()&&$(),I.address.isSeoAction.subscribe(function(e){e?$():G()}),t.applyBindings(P,E.seoShellOverall[0]),D="http://"+I.info.Account.Domain,e.isFunction(n)&&n(P)};return t.bindingHandlers.enterKey={init:function(e,n,i,a,r){var o=function(e,t){13===t.keyCode&&n().call(this,e,t)};t.applyBindingsToNode(e,{event:{keyup:o}},r)}},{load:K,show:$,hide:G,setJqueryMap:U,Steps:L,PageTypes:M,getSeoSideBarViewModelInstance:function(){return P},viewModel:{displayBusinessInformation:function(){P.displayBusinessInformation()},displayPage:function(e){P.displayPage(e)},activePage:function(){return P.activePage()}},createSeoSideBarViewModel:function(){return new q},setWsb:function(e){T=e}}}),define("text!designer/wsb/sev/sevimport.html",[],function(){return'<div id="sevimport-flyout" style="display: none; height: auto; width: 550px;">\r\n    <!-- ko if: state() == "processing" -->\r\n    <div id="sevimport-processing-flyout">\r\n        <div class="wsb-sev-loading">\r\n            <span class="wsb-upload-value wsb-upload-unknown-value"></span>\r\n        </div>\r\n        <span class="wsb-publish-note" data-bind="text: Strings.Server__Importing_changes"></span>\r\n    </div>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: state() == "results" -->\r\n    <div class="wsb-actionbar-flyout-content">\r\n        <p data-bind="text: Strings.Server__Were_ready_to_update_your_site_with_sev"></p>\r\n        <ul class="wsb-sev-import-list">\r\n            <!-- ko if: importResults().HasSiteMapFromSev -->\r\n            <li data-bind="attr: { \'class\': importResults().SuccessfulSiteMapFromSev ? \'sev-success\' : \'sev-error\' }">\r\n                <span data-bind="text: Strings.Server__Your_list_of_pages"></span>&nbsp;(Sitemap.xml)\r\n                <!-- ko if: !importResults().SuccessfulSiteMapFromSev -->\r\n                <div class="sev-error-subtext" data-bind="text: Strings.Server__There_was_an_error_and_this_item_will_not_be_published"></div>\r\n                <!-- /ko -->\r\n            </li>\r\n            <!-- /ko -->\r\n            <!-- ko if: importResults().HasCustomMetaFromSev -->\r\n            <li data-bind="attr: { \'class\': importResults().SuccessfulCustomMetaFromSev ? \'sev-success\' : \'sev-error\' }">\r\n                <span data-bind="text: Strings.Server__Page_descriptions"></span>\r\n                <!-- ko if: !importResults().SuccessfulCustomMetaFromSev -->\r\n                <div class="sev-error-subtext" data-bind="text: Strings.Server__There_was_an_error_and_this_item_will_not_be_published"></div>\r\n                <!-- /ko -->\r\n            </li>\r\n            <!-- /ko -->\r\n            <!-- ko if: importResults().HasRobotsFromSev -->\r\n            <li data-bind="attr: { \'class\': importResults().SuccessfulRobotsFromSev ? \'sev-success\' : \'sev-error\' }">\r\n                <span data-bind="text: Strings.Server__Search_engine_access_levels"></span>&nbsp; (robots.txt)\r\n                <!-- ko if: !importResults().SuccessfulRobotsFromSev -->\r\n                <div class="sev-error-subtext" data-bind="text: Strings.Server__There_was_an_error_and_this_item_will_not_be_published"></div>\r\n                <!-- /ko -->\r\n            </li>\r\n            <!-- /ko -->\r\n        </ul>\r\n    </div>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: state() == "request-error" -->\r\n    <div class="wsb-actionbar-flyout-content wsb-sev-error">\r\n        <p data-bind="text: FormattedStrings.Server__Please_try_again_or_contact_customer_support"></p>\r\n    </div>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: state() == "import-error" -->\r\n    <div class="wsb-actionbar-flyout-content wsb-sev-error">\r\n        <p data-bind="text: FormattedStrings.Server__Please_try_again_or_contact_customer_support"></p>\r\n    </div>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: state() == "final-error" -->\r\n    <div class="wsb-actionbar-flyout-content wsb-sev-error">\r\n        <p data-bind="text: Strings.Server__Looks_like_the_problem_isnt_going_away_contact_support"></p>\r\n    </div>\r\n    <!-- /ko -->\r\n    \r\n    <!-- ko if: state() == "no-success" -->\r\n    <div class="wsb-actionbar-flyout-content">\r\n        <p data-bind="text: Strings.Server__It_looks_like_the_import_from_sev_didnt_work"></p>\r\n    </div>\r\n    <!-- /ko -->\r\n</div>\r\n\r\n'}),define("designer/wsb/sev/sevimport",["jquery","knockout","common/logger/logger","common/persistence/persistence","common/stats/googleanalytics","designer/app/builder/ui/controls/publish/publish","designer/app/builder/data/data","designer/app/builder/managers/pageManager","/i18n/resources/client","text!designer/wsb/sev/sevimport.html","common/ui/dialog"],function(e,t,n,i,a,r,o,s,l,d){function c(t){if(!x){var n=s.importSevData,i=function(){e(d).appendTo("body"),p(),h(),u({publishCallback:function(){r.publish({callback:function(){},bypassConfirmation:!0})},importCallback:n}),x=!0};setTimeout(i,500)}t&&t("sevimport")}function u(t){k=e.extend({},S,t),g()}function p(){C={state:t.observable(""),requestData:[],importResults:t.observable({}),Strings:l.resources,FormattedStrings:{Server__Please_try_again_or_contact_customer_support:l.resources.Server__Please_try_again_or_contact_customer_support.format("<a href='/help/support' target='_blank'>","</a>"),Server__Looks_like_the_problem_isnt_going_away_contact_support:l.resources.Server__Looks_like_the_problem_isnt_going_away_contact_support.format("<a href='/help/support' target='_blank'>","</a>")}}}function g(){var e="/api/websites/{websiteId}/sevimports",t=function(e){k.retryAttempts=3,e.length>0&&(C.requestData=e,f(),m())},n=function(){k.retryAttempts--,k.retryAttempts<0?_():v()};i.Get(e,t,n)}function h(){t.applyBindings(C,e("#sevimport-flyout")[0])}function m(){var e="/api/websites/{websiteId}/sevimports",t=function(e){k.retryAttempts=3,e.HasSevImportRecords&&e.Success?(C.importResults(e),k.importCallback&&k.importCallback(),C.requestData.length===e.UnsuccessfulRequests.length?w():b()):w()},n=function(){k.retryAttempts--,k.retryAttempts<0?_():y()};i.Post(e,C.requestData,t,n)}function b(){C.state("results");var t=e("#sevimport-flyout");t.wsbDialog({title:k.title,autoResize:!0,buttons:[{id:"publish",text:l.resources.Client__Designer__Publish_Now,attributes:{"data-aid":"sevimport-publish"},onClick:function(){return a.trackEvent("wsb-designer-sevimport-modal","publish"),window.location="/builder/publish",!1}},{id:"publish-later",cancel:!0,text:l.resources.Client__Designer__Publish_Later,attributes:{"data-aid":"sevimport-publish-later"},onClick:function(){return a.trackEvent("wsb-designer-sevimport-modal","publish-later"),window.location.reload(),!1}}],onClose:function(e,t){t&&a.trackEvent("wsb-designer-sevimport-modal","close")}})}function f(){C.state("processing");var t=e("#sevimport-flyout");t.wsbDialog({title:k.title,autoResize:!0,buttons:[{id:"publish",text:l.resources.Client__Designer__Publish_Now,onClick:function(){return!1}},{id:"publish-later",cancel:!0,text:l.resources.Client__Designer__Publish_Later,onClick:function(){return!1}}],onClose:function(e,t){t&&a.trackEvent("wsb-designer-sevimport-processing-modal","close")},onOpen:function(){t.wsbDialog("disableButton",0),t.wsbDialog("disableButton",1)}})}function v(){C.state("request-error");var t=e("#sevimport-flyout");t.wsbDialog({title:l.resources.Client__Designer__Yikes_hit_a_snag,autoResize:!0,buttons:[{id:"retry",text:l.resources.Client__Designer__Retry,attributes:{"data-aid":"sevimport-request-error-retry"},onClick:function(){return a.trackEvent("wsb-designer-sevimport-request-error-modal","retry"),C.state("processing"),g(),!1}},{id:"cancel",cancel:!0,text:l.resources.Cancel,attributes:{"data-aid":"sevimport-request-error-cancel"},onClick:function(){return t.wsbDialog("close"),a.trackEvent("wsb-designer-sevimport-request-error-modal","cancel"),!1}}],onClose:function(e,t){t&&a.trackEvent("wsb-designer-sevimport-request-error-modal","close")}})}function y(){C.state("import-error");var t=e("#sevimport-flyout");t.wsbDialog({title:l.resources.Client__Designer__Yikes_hit_a_snag,autoResize:!0,buttons:[{id:"retry",text:l.resources.Client__Designer__Retry,attributes:{"data-aid":"sevimport-import-error-retry"},onClick:function(){return a.trackEvent("wsb-designer-sevimport-import-error-modal","retry"),C.state("processing"),m(),!1}},{id:"cancel",cancel:!0,text:l.resources.Cancel,attributes:{"data-aid":"sevimport-import-error-cancel"},onClick:function(){return t.wsbDialog("close"),a.trackEvent("wsb-designer-sevimport-import-error-modal","cancel"),!1}}],onClose:function(e,t){t&&a.trackEvent("wsb-designer-sevimport-import-error-modal","close")}})}function _(){C.state("final-error");var t=e("#sevimport-flyout");t.wsbDialog({title:l.resources.Call_the_cavalry,autoResize:!0,buttons:[{id:"close",text:l.resources.Close,attributes:{"data-aid":"sevimport-final-error-close"},onClick:function(){return a.trackEvent("wsb-designer-sevimport-final-error-modal","close","button"),t.wsbDialog("close"),C.state("finish"),!1}}],onClose:function(e,t){t&&a.trackEvent("wsb-designer-sevimport-final-error-modal","close","icon")}})}function w(){C.state("no-success");var t=e("#sevimport-flyout");t.wsbDialog({title:'<span style="color: #d00;">'+l.resources.Client__Designer__Oops_We_have_a_problem+"</a>",autoResize:!0,buttons:[{id:"close",text:l.resources.Close,attributes:{"data-aid":"sevimport-no-success-close"},onClick:function(){return a.trackEvent("wsb-designer-sevimport-no-success-modal","close","button"),t.wsbDialog("close"),C.state("finish"),!1}}],onClose:function(e,t){t&&a.trackEvent("wsb-designer-sevimport-no-success-modal","close","icon")}})}var S={publishCallback:null,importCallback:null,retryAttempts:3,title:l.resources.Client__Designer__Updating_Your_SEO},k={},x=!1,C={};return{init:u,load:c}}),define("common/i18n/truncator",["require","exports","module"],function(e,t){Truncator={},Truncator.truncate=function(e){function t(e){return(e||"").replace(/^\s+|\s+$/g,"")}function n(){for(var e=b.querySelectorAll(p),n=[],a=0;a<e.length;a++){var r=e[a],o=g.exec(r.id);if(o&&(!b.querySelector('[id="'+r.id+'"] '+h)||t(r.textContent))){var s=0,l=0,d=r;do s+=d.offsetLeft,l+=d.offsetTop;while(d=d.offsetParent);n.push({element:r,id:o[1],left:s,right:s+r.offsetWidth,top:l,bottom:l+r.offsetHeight})}}return i(n),n}function i(e){e.forEach(function(t){var n=b.querySelector('[id="'+t.element.id+'"] .wsb-button-content')||t.element;t.targetWidth=n.scrollWidth,t.targetHeight=n.scrollHeight,e.forEach(function(e){if(t!==e){var n={left:t.left,right:t.left+t.targetWidth,top:t.top,bottom:t.top+t.targetHeight},i=t.left>=e.left&&t.left<=e.right,a=n.left>=e.left&&n.left<=e.right,r=t.right>=e.left,o=r&&t.right<=e.right,s=n.right>=e.left,l=s&&n.right<=e.right,d=t.top>=e.top&&t.top<=e.bottom,c=n.top>=e.top&&n.top<=e.bottom,u=t.bottom>=e.top,p=u&&t.bottom<=e.bottom,g=n.bottom>=e.top,h=g&&n.bottom<=e.bottom,m=i&&o&&d&&p,b=a&&l,f=c&&h,v=b&&f,y=c||h||t.top<=e.top&&t.bottom>=e.bottom,_=a||l||t.left<=e.left&&t.right>=e.right;m?v||(t.targetWidth=Math.min(t.targetWidth,e.right-n.left),t.targetHeight=Math.min(t.targetHeight,e.bottom-n.top)):((y||f)&&(o?t.targetWidth=t.right-t.left:(l||s&&!r)&&(t.targetWidth=Math.min(t.targetWidth,e.left-n.left))),(_||b)&&(p?t.targetHeight=t.bottom-t.top:(h||g&&!u)&&(t.targetHeight=Math.min(t.targetHeight,e.top-n.top))))}});var i=s(n),a=2*i-1;i&&a>t.targetHeight&&(t.targetHeight=a)})}function a(e,t){t.nodeType===f?r(e,t):t.nodeType===v&&o(e,t)}function r(e,t){for(var n=b.createTextNode(y),i=e();t.childNodes.length&&(i.width>0||i.height>0);){var r=t.childNodes[t.childNodes.length-1];if(1===t.childNodes.length)return void a(e,r);if(t.removeChild(r),t.appendChild(n),i=e(),t.removeChild(n),i.width<=0&&i.height<=0)return t.appendChild(r),void a(e,r);i=e()}t.appendChild(n)}function o(e,t){for(var n=e();(n.width>0||n.height>0)&&t.nodeValue!==y;){var i=w.exec(t.nodeValue),a=i[0]===t.nodeValue?/[^.]\.*$/:w;t.nodeValue=t.nodeValue.replace(a,y),n=e()}}function s(e){for(var n=0;n<e.childNodes.length;n++){var i=e.childNodes[n];if(1===i.nodeType)return s(i);if(3===i.nodeType){var a=t(i.nodeValue);if(a)break}}var r=m(e);return r.lineHeight&&/^[\d\.]+px$/i.test(r.lineHeight)?parseFloat(r.lineHeight):null}function l(e){for(var t=0;t<e.length;t++){var n=e[t],i=n.element,a=b.querySelector('[id="'+i.id+'"] '+h);if(a){var o=function(){return{width:a.scrollWidth-n.targetWidth,height:a.scrollHeight-n.targetHeight}},s=a.innerHTML,l=o();(l.width>0||l.height>0)&&(r(o,a),S.push({elementId:n.id,elementType:"text",property:"Html",overflowAmount:l,originalContent:s,suggestedContent:a.innerHTML.replace(_,"</")}))}}}function d(e){for(var t=0;t<e.length;t++){var n=e[t],i=n.element,a=b.querySelector('[id="'+i.id+'"] .wsb-button-content');if(a){var o=a.innerHTML;a.innerHTML="",a.innerHTML=o;var s=function(){return{width:a.scrollWidth-n.targetWidth,height:a.scrollHeight-n.targetHeight}},l=s();(l.width>0||l.height>0)&&(r(s,a),S.push({elementId:n.id,elementType:"button",property:"ButtonLabel",overflowAmount:l,originalContent:o,suggestedContent:a.innerHTML}))}}}function c(e){for(var t=0;t<e.length;t++){var n=e[t],i=n.element,a=b.querySelector('[id="'+i.id+'"] .sf-upload-btns'),r=b.querySelector('[id="'+i.id+'"] .sf-btn-file');if(a&&r){var s=r.childNodes[0],l=s.nodeValue,d=function(){return{width:r.scrollWidth-a.offsetWidth,height:0}},c=d();(c.width>0||c.height>0)&&(o(d,s),S.push({elementId:n.id,elementType:"customform",property:"FormConfigData",jsonProperty:"fileButtonText",overflowAmount:c,originalContent:l,suggestedContent:s.nodeValue}))}}}function u(e){for(var t=0;t<e.length;t++){var n=e[t],i=n.element,a=b.querySelector('[id="'+i.id+'"] .form-row'),r=b.querySelector('[id="'+i.id+'"] .form-label-adjacent .form-label');if(a&&r){var s=r.childNodes[0],l=s.nodeValue,d=function(){return{width:r.scrollWidth-a.offsetWidth,height:r.scrollHeight-a.offsetHeight}},c=d();(c.width>0||c.height>0)&&(o(d,s),S.push({elementId:n.id,elementType:"customform",property:"FormLabel",overflowAmount:c,originalContent:l,suggestedContent:s.nodeValue}))}}}var e=e||{},p=e.elementsSelector||"#wsb-canvas-template-container > div, #wsb-canvas-template-footer-container > div",g=e.idFormat||/^wsb-element-((?:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})|(?:\d+))$/i,h=e.textContentSelector||" > .txt",m=this.getComputedStyle,b=this.document,f=1,v=3,y="...",_="<br>"+y+"</",w=/[.,:;-]*?(\s*|^)\S*$/,S=[],k=n();return l(k),d(k),u(k),c(k),{overflows:S}},t.truncate=Truncator.truncate}),define("designer/app/builder/ui/ui",["libs/async-util/async","designer/app/builder/ui/header/header","designer/app/builder/ui/controls/controls","designer/app/builder/ui/canvas/canvas","designer/app/builder/ui/preview/preview","designer/app/builder/ui/social/social","designer/wsb/seo/seoEditor","designer/wsb/sev/sevimport","common/i18n/truncator","designer/app/builder/managers/themeManager"],function(e,t,n,i,a,r,o,s,l,d){function c(l,c){e.map([t,n,i,a,r,o,s],function(e,t){e.load(t,c)},function(e,t){d.isLocalizedTheme()&&u(),d.themeLocale.subscribe(function(e){e&&u()}),l(e,t)})}function u(){var e=$.Deferred();return setTimeout(function(){l.truncate.call(window,{elementsSelector:".wsb-canvas-template-container > div > div, .wsb-canvas-template-footer-container > div > div",idFormat:p,textContentSelector:"> div > .txt"}),e.resolve()},5),e.promise()}var p=/((?:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})|(?:\-?\d+))/i;return{load:c}}),define("designer/app/builder/managers/managers",["libs/async-util/async","designer/app/builder/managers/pageManager","designer/app/builder/managers/elementManager","designer/app/builder/managers/css/css","designer/app/builder/managers/siteSettingsManager","designer/app/builder/managers/themeManager"],function(e,t,n,i,a,r){function o(o,s){e.map([t,n,i,a,r],function(e,t){e.load(t,s)},function(e,t){o(e,t)})}return{load:o}}),define("designer/app/builder/builder",["jquery","lodash","knockout","designer/app/app","designer/app/event","designer/app/builder/data/data","libs/async-util/async","common/logger/serverLogger","designer/app/builder/ui/ui","designer/app/builder/managers/managers","designer/app/builder/managers/addressManager","designer/app/builder/ui/controls/csseditor/csseditor","/i18n/resources/client","common/browser/browser"],function(e,t,n,i,a,r,o,s,l,d,c,u,p,g){function h(t,n,a){if(y!=f.notLoaded)return a();y=f.loading;var c=s.beacons.builderLoad;s.triggerTrace(c.steps.initApp,c.name),o.series([function(e){r.load(e,t,n)},function(e){d.load(e,i.getMap().apps.builder)},function(e){l.load(e,i.getMap().apps.builder)}],function(){return y=f.loaded,_.enable(),w.enable(),setTimeout(function(){_.reset()},1e3),s.triggerTrace(c.steps.loadBuilder,c.name),setTimeout(function(){s.triggerTrace(c.steps.renderBuilder,c.name),s.postPerformance(c.name)},0),window.UnloadingPage=!1,e(window).bind("beforeunload",function(e){if(g.msie)w.save();else if(w.hasChanges()){var t=p.resources.Client__Designer__ActionBar_UnsavedChanges;return e.returnValue=t,window.UnloadingPage=t}window.UnloadingPage=!0}),a()})}function m(e,t,n){c.navigateToAddressBarState(e,t,n)}var b,f={notLoaded:0,loading:1,loaded:2},v="builder",y=f.notLoaded,_=r.undoer,w=r.saver;return{appname:v,load:h,state:function(){return y},addToHeadTag:i.addToHeadTag,navigateToAddressBarState:m,setAppData:function(e){b=e}}}),define("common/util/util.persistence",["lodash","knockout","common/persistence/persistence"],function(e,t,n){function i(i,a){var r={},o={},s=!1;for(var l in i)r[l]=t.observable(void 0===i[l]||null===i[l]?"":i[l]),r[l].subscribe(function(e){i[l]=void 0===e||null===e?"":e});switch(i.observables=function(){return r},a){case"napsoc":s="/api/websites/{websiteId}/napsocsettings/",o={SiteName:"Name",StreetAddress:"Address",PhoneNumber:"Phone",EmailAddress:"Email",Twitter:"TwitterUsername"};break;case"websiteSettings":s="/api/websites/{websiteId}/websiteSettings/"}return s&&(i.Post=function(t,i,a,l){var d=function(){for(var n in t){var a=void 0!==o[n]?o[n]:n;
e.isFunction(r[a])&&r[a](t[n])}e.isFunction(i)&&i.apply(this,arguments)};n.Post(s,t,d,a,l)}),i}return{load:i}}),define("text!designer/app/menu/views/header.html",[],function(){return'<div id="menu-header">\r\n    <div id="menu-header-title">\r\n        <span>&gt;&nbsp;Menu Widget</span>\r\n    </div>\r\n    <div id="menu-header-buttons">\r\n        <div class="wsb-button">\r\n            <a class="btn btn-success" data-aid="link-back-to-wsb" href="javascript:void(0)">\r\n                <span class="return-to-wsb">@Strings.Server__Back_to_website_builder&nbsp;&#62;</span>\r\n            </a>\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),define("text!designer/app/menu/views/editor.html",[],function(){return'<div id="menu-editor" data-aid="wsb-shell-menu" class="wsb-shell-menu">\r\n    <div id="menu-loading"><table><tr><td><img src="/assets/images/progress.gif" alt=""/>@Strings.Loading</td></tr></table></div>\r\n    <iframe id="menu-editor-iframe" \r\n            data-aid="wsb-shell-locu-iframe" \r\n            class ="wsb-shell-locu-iframe" \r\n            frameborder="0" \r\n            allowtransparency="true" \r\n            style="display: inline;"></iframe>\r\n</div>'}),define("designer/app/menu/menu",["jquery","designer/app/app","designer/app/event","designer/util/util.i18n","common/impression/impression","text!designer/app/menu/views/header.html","text!designer/app/menu/views/editor.html"],function(e,t,n,i,a,r,o){function s(){var e={type:"close-window-requested",recipient:"locu"},t=l(),n=d();t&&t.postMessage(JSON.stringify(e),n),a.add(a.apps.Locu,a.types.LocuOpenedThirdPartyEditor)}function l(){return g.iframe[0].contentWindow}function d(){var e=g.iframe.attr("src"),t=e.split("/");return t[0]+"//"+t[2]}function c(){g.iframe.hide(),g.loading.show()}function u(){g.loading.hide(250),g.iframe.show(500)}var p,g={},h="menu",m=function(n,a,l,d){d=d||e("body"),g.editor||(g.editor=e(i.replaceRazorStringsWithI18n(o)).appendTo(t.getMap().apps[h]),t.addHeader(i.replaceRazorStringsWithI18n(r),h,h+"-header"),d.find("#menu-header-buttons > div").click(s),g.loading=d.find("#menu-loading"),g.iframe=d.find("#menu-editor-iframe"));var u;return p&&p.url&&(u=p.url),u&&(g.iframe.attr("src",u),c()),l&&l(),g.editor},b=function(t){if(-1!=e.inArray(t.origin.toLowerCase(),["https://locu.com","https://locu.godaddy.com","https://locu.test-godaddy.com","https://locu.dev-godaddy.com","https://staging.locu.com","https://kronos.locu.com","https://kronos.staging.locu.com"])){var i=JSON.parse(t.data);if(i.recipient&&"godaddy"===i.recipient){if("dashboard-loaded"==i.type)return void u();if("close-window-requested"===i.type&&i.granted===!0){var a=p?p.returnPath||"":"";window.wsb.gotoAddress(a,"builder",{}),n.emit(n.events.refreshLocu)}}}};return window.attachEvent?window.attachEvent("onmessage",b,!1):window.addEventListener("message",b,!1),{load:m,navigateToAddressBarState:function(){c()},setAppData:function(e){p=e},testCallback:b}}),function(e){"function"==typeof define&&define.amd?define("libs/jquery/plugins/jquery.binder",["jquery"],e):e("object"==typeof exports?require("jquery"):this.jQuery)}(function(e){function t(e){l[e]=l[e]||[]}function n(t){for(var n=e(),i=l[t]||[],a=0;a<i.length;a++){var r=i[a].elem;n=n.add(r)}return n}function i(e,t){d.apply(this,arguments);for(var n in l)l.hasOwnProperty(n)&&n===e&&this.each(function(){var e=r(l[n],this);e.handlers.push(t)});return this}function a(e,t){if(c.apply(this,arguments),"undefined"==typeof e)return this.each(function(){for(var e=0;e<l.length;e++)o(l[e],this)});for(var n in l)l.hasOwnProperty(n)&&n===e&&this.each("undefined"==typeof t?function(){o(l[n],this)}:function(){s(l[n],this,t)});return this}function r(e,t){for(var n=0;n<e.length;n++)if(e[n].elem===t)return e[n];var i={elem:t,handlers:[]};return e.push(i),i}function o(e,t){for(var n=0;n<e.length;n++)e[n].elem==t&&(e.splice(n,1),n--)}function s(e,t,n){for(var i=r(e,t),a=0;a<i.handlers.length;a++)i.handlers[a]==n&&(i.handlers.splice(a,1),a--);0==i.handlers.length&&o(e,t)}var l={},d=e.fn.bind,c=e.fn.unbind;return e.fn.bind=i,e.fn.unbind=a,e.binder={watch:t,get:n},e}),function(e){"function"==typeof define&&define.amd?define("libs/jquery/plugins/jquery.nearfar",["jquery","libs/jquery/plugins/jquery.binder","libs/jquery/jquery.throttle"],e):e("object"==typeof exports?require("jquery"):this.jQuery)}(function(e){function t(t,n){var i=e(this).data("near-far-config")||{};return i.near=n,e(this).data("near-far-config",i),this.bind("anyMouseMove",t)}function n(t,n,i){return"function"==typeof n&&(i=n,n=0),n=+n||0,0>=n&&(n=0),"undefined"==typeof i&&0===n?this.trigger(t?"near":"far",l):(n>0&&this.each(function(){var i=e(this).data("near-far-config")||{};t?i.near=n:i.far=n,e(this).data("near-far-config",i)}),"undefined"==typeof i?this:this.bind(t?"near":"far",i))}function i(t){l={x:t.pageX,y:t.pageY};var n=e.binder.get("near"),i=e.binder.get("far"),o=e.binder.get("anyMouseMove"),s=new e.Event("near",e.extend({},l,{near:!0,far:!1}));a(!0,l,n).trigger(s);var d=new e.Event("far",e.extend({},l,{near:!1,far:!0}));a(!1,l,i).trigger(d);var c=new e.Event("anyMouseMove",e.extend({},l,{near:!0,far:!1})),u=new e.Event("anyMouseMove",e.extend({},l,{near:!1,far:!0}));r(!0,l,o).trigger(c),r(!1,l,o).trigger(u)}function a(t,n,i){var a=e();return i.each(function(){var i=e(this);s(t,n,i)&&(a=a.add(i))}),a}function r(t,n,i){var a=e();return i.each(function(){var i=e(this);o(t,n,i)&&(a=a.add(i))}),a}function o(t,n,i){var a=i.data("near-far-config")||{},r=e.extend({},d,a),o=!0,s=i.offset(),l=r.near,c={x1:s.left-l,x2:s.left+i.outerWidth()+l,y1:s.top-l,y2:s.top+i.outerHeight()+l};return(n.x<c.x1||n.x>c.x2)&&(o=!1),(n.y<c.y1||n.y>c.y2)&&(o=!1),o!==t?!1:!0}function s(t,n,i){var a=i.data("near-far-config")||{},r=e.extend({},d,a),o=t?r.near:r.far,s=!0,l=i.offset(),o=t?r.near:r.far,c={x1:l.left-o,x2:l.left+i.outerWidth()+o,y1:l.top-o,y2:l.top+i.outerHeight()+o};return(n.x<c.x1||n.x>c.x2)&&(s=!1),(n.y<c.y1||n.y>c.y2)&&(s=!1),a.last===s||s!=t?!1:(a.last=s,i.data("near-far-config",a),!0)}var l={x:0,y:0},d={near:25,far:50,last:null};return e.binder.watch("near"),e.binder.watch("far"),e.binder.watch("anyMouseMove"),e(function(){e(window).mousemove(e.throttle(100,i))}),e.fn.near=function(e,t){return n.call(this,!0,e,t)},e.fn.far=function(e,t){return n.call(this,!1,e,t)},e.fn.nearfar=function(e,i,a){n.call(this,!0,e,i),n.call(this,!1,e,i),"function"==typeof a&&t.call(this,a,e)},e}),define("common/livePerson/livePersonButton",["jquery","libs/knockout/knockout","common/stats/googleanalytics","libs/jquery/plugins/jquery.nearfar"],function(e,t,n){function i(){return this instanceof i?(this.$lpButton=e("#lpButtonDiv"),this.$lpButtonDisplay=e("#lpChatStatus"),this.$lpChatStatus=e("#lpChatStatus"),void setTimeout(this.init.bind(this),2e3)):new i}var a="offline",r="online",o="offline",s="busy",l="online";return i.prototype={init:function(){this.status=t.observable(a),this.state=t.observable(a),this.status.subscribe(this.onStatusChange.bind(this)),this.near=t.observable(!1),this.near.subscribe(this.onNearChange.bind(this));var i=this;this.$lpButton.nearfar(100,null,function(e){i.status(i.getStatus()),i.near(e.near)}),this.$lpButtonDisplay.on("click",function(){var t=window.location.pathname.split("/")[2]||"dashboard";n.trackEvent(t,"chat_support","button"),e("#lpButtonDivOnline").click()})},getStatus:function(){return e(">:first",this.$lpButton).hasClass("g-btn-hlp")?l:o},onStatusChange:function(e){var t=this,n=this.state();switch(e){case l:case s:n!==r&&this.$lpChatStatus.show().stop(!0,!1).text("Chat Support").animate({bottom:0},"slow",function(){setTimeout(t.near.bind(t,!0),2e3)}),this.state(l);break;case o:n!==a&&this.$lpChatStatus.stop(!0,!1).text("Chat Offline").animate({bottom:-30},"slow",function(){t.$lpChatStatus.hide()}),this.state(o)}},onNearChange:function(e){e?this.$lpChatStatus.stop(!0,!1).animate({bottom:0},"slow"):this.$lpChatStatus.stop(!0,!1).animate({bottom:-25},"slow")}},i}),define("common/livePerson/livePerson",["jquery","websiteInfo","userData","common/livePerson/livePersonButton","libs/jquery/plugins/jquery.nearfar"],function(e,t,n,i){return function(){e(function(){if(1===n.resellerId){window.lpTag=window.lpTag||{},"undefined"==typeof window.lpTag._tagCount?(window.lpTag={site:"51516811",section:lpTag.section||"",autoStart:lpTag.autoStart===!1?!1:!0,ovr:lpTag.ovr||{},_v:"1.5.1",_tagCount:1,protocol:location.protocol,isDom:!0,events:{bind:function(e,t,n){lpTag.defer(function(){lpTag.events.bind(e,t,n)},0)},trigger:function(e,t,n){lpTag.defer(function(){lpTag.events.trigger(e,t,n)},1)}},defer:function(e,t){0==t?(this._defB=this._defB||[],this._defB.push(e)):1==t?(this._defT=this._defT||[],this._defT.push(e)):(this._defL=this._defL||[],this._defL.push(e))},load:function(e,t,n){var i=e;e||(i=this.protocol+"//"+(this.ovr&&this.ovr.domain?this.ovr.domain:"lptag.liveperson.net")+"/tag/tag.js?site="+this.site);var a=document.createElement("script");a.setAttribute("charset",t?t:"UTF-8"),n&&a.setAttribute("id",n),a.setAttribute("src",i),document.getElementsByTagName("head").item(0).appendChild(a)},init:function(){this.load()},start:function(){this.autoStart=!0},vars:lpTag.vars||[],dbs:lpTag.dbs||[],ctn:lpTag.ctn||[],sdes:lpTag.sdes||[],ev:lpTag.ev||[]},lpTag.init()):window.lpTag._tagCount+=1;var e="unknown",i=t.accountTypes;for(var a in i)if(i.hasOwnProperty(a)&&i[a]===t.Account.AccountType){e=a;break}lpTag.section="default";var r=[{scope:"page",name:"unit",value:"godaddy-WSB"},{scope:"session",name:"language",value:n.locale},{scope:"visitor",name:"visitorFirstName",value:n.firstName},{scope:"visitor",name:"resellerId",value:n.resellerId},{scope:"visitor",name:"wsbPlanType",value:e},{scope:"visitor",name:"orionUid",value:n.orionUid},{scope:"visitor",name:"shopperId",value:n.shopperId}];lpTag.vars.push(r);lpTag.dbs.push({name:"WSB-godaddy-english",pid:"lpButtonDiv"})}});var a='<div id="lpButtonDivOnline" class="g-btn-lg" >Chat Support</div>',r='<div id="lpButtonDivOffline" class="g-btn-lg">Chat Offline</div>';i({bottom:"-30px"},{bottom:"-25px"},{bottom:"0px"},400,2e3,a,r)}});
//# sourceMappingURL=app.js.map