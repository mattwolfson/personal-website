/*! duel v2.5.8 - Built 2016-01-14, 12:01 PM PST - Copyright (c) 2016 */
define("starfield/sf.droplist",["starfield/sf.util","css!starfield/sf.droplist.css","css!starfield/sf.core.css","jq!starfield/jquery.mod","domReady!"],function(){return function(a){var b={options:{selectedIndex:0,width:250,listWidth:void 0,listMaxHeight:void 0,listHeight:void 0,autoOpen:!1,valueChangeElement:void 0,onOpen:void 0,onClose:void 0,onValueChanged:void 0,zIndex:void 0,disabled:!1,context:self,displayContext:self},_create:function(){var b=this;b._width=b.options.width,b._listWidth=b.options.listWidth?b.options.listWidth:b._width,b._enabled=b.options.disabled!==!0,b._context=$sf.util.context(b.options.context,b.options.displayContext);var c=b._context.isSingle()?b.element:b._context.ext.iframe();b._stackingParent=$sf.util.zIndex.getStackingParent(c),b._stackingParent="undefined"==typeof b._stackingParent?null:b._stackingParent,b._createMain(),b.options.valueChangeElement&&b.options.valueChangeElement.length>0&&(b.valueChangeElement=a(b.options.valueChangeElement)),b._createDropDown();var d=b.list.children("[data-selected]");0===d.length&&(d=b.list.children("li").eq(b.options.selectedIndex)),0===d.length&&(d=b.list.children("li").first()),d.length>1&&(d=d.eq(0)),b.selectItem(d,!0);var e=b.list.children("[data-highlighted]");e.length>0&&b.highlightItems(e,!0),b.options.autoOpen===!0&&this.open()},_createMain:function(){var b=this;b.element.wrap('<div class="'+b.baseClass+'-select" />'),b.wrapper=b.element.parent(),b.wrapper.css({width:b._width-38+"px"}),b._enabled||b.wrapper.addClass(b.baseClass+"-select-disabled"),b.boxContent=a('<div class="'+b.baseClass+'-selectcontent"></div>').append('<div class="'+b.baseClass+'-display"></div>').prependTo(b.wrapper),b.anchor=a('<div class="sf-droplist-selectbtn"><span class="'+b.baseClass+'-anchor"></span></div>').appendTo(b.wrapper),b.list=b.element,b.list.addClass(b.baseClass).hide()},_createDropDown:function(){var b=this,c={display:"none",position:null!==b._stackingParent?"fixed":"absolute","overflow-x":"hidden"};"number"==typeof b.options.listHeight?(c.height=b.options.listHeight+"px",c["overflow-y"]="auto"):"number"==typeof b.options.listMaxHeight?(c["max-height"]=b.options.listMaxHeight+"px",c["overflow-y"]="auto"):c["overflow-y"]="hidden",b._log("context is single = "+b._context.isSingle()),b.drop=a('<div class="sf-droplist-drop"></div>').appendTo($sf.util.zIndex.getLayer("flyout",a(b._context.ext.body()),b._context.isSingle()?b.element:b._context.ext.iframe())).width(b._listWidth).append(b.list).css(c),b.list.show(),b.anchor.bind("click.sfdl",function(){b._enabled&&b.toggle()}),b.boxContent.bind("click.sfdl",function(){b._enabled&&b.toggle()}),b.wrapper.parents().add(b._context.ext.window()).bind("scroll.sfdl",function(){b.close()}),a(b._context.ext.window()).bind("click.sfdl",function(c){b._blur(a(c.target))}),b._context.isSingle()||a(b._context.intr.window()).bind("click.sfdl",function(c){b._blur(a(c.target))}),b._attachItemClickHandler(b.list.children("li"))},_attachItemClickHandler:function(b){var c=this;b.click(function(){c.selectItem(a(this)),c.close()})},_positionList:function(){function b(b){var f=a(c._context.ext.window()).scrollTop(),h={top:f,bottom:f+a(c._context.ext.window()).height()},i={top:b,bottom:b+c.drop.outerHeight()},j="bottom"==d?-1:1;return i[d]*j<h[d]*j?g[e]:b}var c=this,d="bottom",e="top",f=c._context.isSingle()?c.wrapper.offset():c._context.ext.offset(c.wrapper,null!==c._stackingParent);c._context.isSingle()&&null!==c._stackingParent&&(f.top-=a(c._context.ext.window()).scrollTop(),f.left-=a(c._context.ext.window()).scrollLeft());var g={top:f.top-c.drop.outerHeight()+1,bottom:f.top+c.wrapper.outerHeight()-1},h={left:f.left+"px",top:b(g[d])+"px"};isNaN(c.options.zIndex)||(h.zIndex=c.options.zIndex),c.drop.css(h)},_blur:function(a){var b=$sf.util.jCompat.isEl(a,this.wrapper);b||(b=$sf.util.jCompat.findEl(this.wrapper,a).length>0),b||this.close()},destroy:function(b){this.isOpen()&&this.close(),this.boxContent.unbind(),this.anchor.unbind(),this.list.removeClass(this.baseClass).hide().insertBefore(this.wrapper).children().removeClass("sf-droplist-actv").unbind(),this.wrapper.parents().unbind("scroll.sfdl"),this.wrapper.remove(),a(this._context.ext.window()).unbind("scroll.sfdl").unbind("click.sfdl"),this._context.isSingle()||a(this._context.intr.window()).unbind("click.sfdl"),this.drop.remove(),this._execSuper("destroy",b)},selectItem:function(b,c){var d,e=this.selectedIndex();if(a.isPlainObject(b)&&(c=b.forceRefresh,b=b.item),"number"==typeof b)d=this.list.children("li:eq("+b+")");else{if(0===b.length)return b;d=b}if(c||e!==d.index()){this.boxContent.children().addClass("old").end().prepend("<div>"+d.children("[data-main]").html()+"</div>").children(".old").remove(),this.list.children("li").removeAttr("data-selected").removeClass("sf-droplist-actv"),d.attr("data-selected",!0).addClass("sf-droplist-actv");var f=d.attr("data-value");this.list.attr("data-value",f),!c&&a.isFunction(this.options.onValueChanged)&&this.options.onValueChanged(this.element,d,f);var g=this.valueChangeElement;g&&g.length>0&&g.each(function(){a(this).is("input")?a(this).val(f):a(this).text(f)})}},selectItemByValue:function(b,c){a.isPlainObject(b)&&(c=b.forceRefresh,b=b.value);var d=this.list.children('li[data-value="'+b+'"]');d.length>0&&this.selectItem(d,c)},highlightItems:function(b,c){var d=this;a.isPlainObject(b)&&!a.isArray(values)&&(c=b.preserveExisting,b=b.items),c=c===!0,c||d.list.children("li").removeAttr("data-highlighted").removeClass("sf-droplist-hlt"),0!==b.length&&a.each(b,function(){var b=this,c=b;if("number"==typeof b)c=d.list.children("li:eq("+b+")");else{if(0===a(b).length)return!0;c=a(b)}c.attr("data-highlighted",!0).addClass("sf-droplist-hlt")})},highlightItemsByValue:function(b,c){var d=this;if(a.isPlainObject(b)&&!a.isArray(b)&&(c=b.preserveExisting,b=b.values),null===b||a.isArray(b)){var e=null===b?[]:a.map(b,function(a){var b=d.list.children('li[data-value="'+a+'"]');return 0===b.length?null:b});d.highlightItems(e,c)}},open:function(){var b=this;b._positionList(),b.drop.show(),a(":sf-droplist(open)").not(b.element).sfDropList("close"),a(b._context.ext.window()).bind("resize.sfdl"+b.id.replace(/-_/g,""),function(){b.isOpen()&&b._positionList()}),a.isFunction(b.options.onOpen)&&b.options.onOpen(b.element)},close:function(){var b=this,c=!0;a.isFunction(b.options.onClose)&&(c=b.options.onClose(b.element)),c&&(b.drop.hide(),a(b._context.ext.window()).unbind("resize.sfdl"+b.id.replace(/-_/g,"")))},toggle:function(){this.isOpen()?this.close():this.open()},addItem:function(b){var c,d,e,f,g;if(!b)throw"You must provide arguments indicating what you'd like to add to the droplist.";"object"==typeof b?(d=b.html,c=b.text||b.value,e=b.value||b.text,f=b.index,g=b.classes):(c=b.toString(),e=c);var h=a("<li/>").attr("data-value",e);d?(h.html(d),h.find("[data-main]").length||h.children().first().attr("data-main","true")):c&&h.append(a('<div data-main="true"/>').text(c)),g&&h.addClass(g),0===f?h.prependTo(this.list):f?this.list.find("li:nth-child("+(f+1)+")").before(h):h.appendTo(this.list),this._attachItemClickHandler(h)},removeItem:function(a){var b,c;"number"==typeof a?b=a:"string"==typeof a?c=a:"index"in a?b=+a.index:c=a.value;var d,e;void 0===b?(d='li[data-value="'+c+'"]',e=c==this.val()):(d="li:nth-child("+(b+1)+")",e=b==this.selectedIndex()),this.list.find(d).remove(),e&&this.selectItem(0)},enable:function(){this.wrapper.removeClass(this.baseClass+"-select-disabled"),this._enabled=!0},disable:function(){this.close(),this.wrapper.addClass(this.baseClass+"-select-disabled"),this._enabled=!1},isOpen:function(){return this.drop.is(":visible")},val:function(){return this.list.children("li[data-selected]").attr("data-value")},selectedItem:function(){return this.list.children("li[data-selected]")},selectedIndex:function(){return this.list.children("li[data-selected]").index()},box:function(){return this.wrapper}};return $sf.util.selector("sf-droplist",{root:{selector:".sf-droplist",states:{open:function(a){return a.sfDropList("isOpen")},closed:function(a){return!a.sfDropList("isOpen")}},tests:{id:function(a,b){return a.attr("id")===b}}}}),$sf.util.module("DropList",b)}($sf.getjQuery())});