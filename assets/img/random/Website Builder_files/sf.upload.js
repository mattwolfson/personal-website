/*! duel v2.5.8 - Built 2016-01-14, 12:00 PM PST - Copyright (c) 2016 */
define("starfield/sf.upload",["i18n!starfield/sf.i18n/duel","css!starfield/sf.core.css","starfield/sf.alerts","jq!starfield/jquery.mod","css!starfield/sf.upload.css","domReady!"],function(i18n){return function($){sfUploadIFrame=function(a){this.mod=a,this.uploading=!1,this.uploads=[]},sfUploadXhr=function(a){this.mod=a,this.uploading=!1},sfUploadFlash=function(a){this.mod=a,this.uploading=!1};var watchTitle=function(a){var b,c,d,e;return b=function(){if($.browser.msie&&a.attachEvent&&void 0===a.originalTitle){if(a.originalTitle=a.title,Object.defineProperty){var b=$("title");b.length||(b=$("<title/>").text(a.originalTitle).appendTo("head")),Object.defineProperty(a,"title",{get:function(){return b.text()},set:function(c){return b.text(a.originalTitle=c)}})}a.attachEvent("onpropertychange",d)}},d=function(a){a&&"title"===a.propertyName&&setTimeout(e,0)},e=function(){a.title!==a.originalTitle&&(a.title=a.originalTitle)},c=function(){a.originalTitle&&(a.detachEvent("onpropertychange",d),Object.defineProperty&&(delete a.title,a.title=a.originalTitle),delete a.originalTitle)},{init:b,destroy:c}}(document),module={files:{},files_ar:[],options:{width:"100%",txt:i18n["sf.upload"],multiFile:!0,maxItems:999,maxUploads:void 0,modal:void 0,accept:"*",condensed:!1,uploadPath:void 0,uploaders:[sfUploadXhr,sfUploadFlash,sfUploadIFrame],ddEnabled:!0,expectData:!1,maxFileSize:0,showErrorHelper:!0,hideListOnFinish:!1,hideListOnFinishDelay:2e3,onGetUploader:void 0,onUpload:void 0,onSuccess:void 0,onProgress:void 0,onError:void 0,onClose:void 0,onStart:void 0,onFinish:void 0},_create:function(){if(!this.getUploadPath()&&0==$.isFunction(this.options.onUpload))return void alert("sfUpload: uploadPath or onUpload required.");1==this.options.maxItems&&(this.multiFile=!1),this.tuploads=0,this.element.parent().is(".sf-dialog-inner")&&(this.options.modal=this.element);var a=this;this.options.modal&&this.options.modal.sfDialog({onClose:function(){return 1==a.modalClosing?!0:(a.closeModal=!0,a.cancel())},onOpen:function(){a.closeModal=!1,a.modalClosing=!1}}),this.status=$('<span class="sf-upload-status"/>'),this.list=$('<ul class="sf-upload-list"/>'),this.scroller=$('<div class="sf-upload-scroller"/>').append(this.list).hide(),this.btns=$('<div class="sf-upload-btns"/>'),this.cancelYes=$('<input type="button" class="sf-btn-minor yes"/>').val(this.options.txt.yes),this.cancelNo=$('<input type="button" class="sf-btn-minor no"/>').val(this.options.txt.no),this.cancelAlert=$('<div data-style="warn"/>').html(this.options.txt.cancel).css({"margin-top":"20px"}).prepend($('<div style="float: right;"/>').append(this.cancelYes).append(this.cancelNo)).sfAlert({hideClose:!0}).hide(),this.closeModal=!1,this.modalClosing=!1,this.cancelYes=this.cancelAlert.find(".yes"),this.cancelNo=this.cancelAlert.find(".no"),this.cancelYes.bind("click",function(){a.cancelAlert.hide(),a.cancel(a.cancelFiles,!0),a.options.condensed&&(a.condensedEl=!1)}),this.cancelNo.bind("click",function(){a.closeModal=!1,a.cancelAlert.hide()}),this.element.addClass("sf-upload").append(this.status).append(this.scroller).append(this.btns).append(this.cancelAlert),this.initUploader()},uploaderReady:function(){if(this.upload.create(),this.updateStatus(),1==this.options.ddEnabled&&1==this.upload.isDDSupported()){var a=$('<div class="sf-upload-dd-instructions"/>').append(this.options.txt.dd_info),b=$('<div class="sf-upload-dd-foldername"/>').append(this.options.txt.dd_dest),c=$('<div class="sf-upload-dd-details"/>').append(this.options.txt.dd_limits),d=$('<div class="sf-upload-dd-content"/>').append(a).append(b).append(c),e=this,f=$('<div class="sf-upload-dd-zone-drop"/>').append(d).bind("dragover",function(a){a.stopPropagation(),a.preventDefault(),f.addClass("sf-upload-dd-zone-active")}).bind("dragleave",function(a){a.stopPropagation(),a.preventDefault(),f.removeClass("sf-upload-dd-zone-active")}),g=$('<a href="#" class="sf-upload-dd-zone-btn"/>').html(this.options.txt.dd_cancel).bind("dragover",function(a){a.stopPropagation(),a.preventDefault(),g.addClass("sf-upload-dd-zone-active")}).bind("dragleave",function(a){a.stopPropagation(),a.preventDefault(),g.removeClass("sf-upload-dd-zone-active")});this.dd=$('<div class="sf-upload-dd"/>').hide().append(f).append(g),$(document.body).append(this.dd),this.dd_enter=function(a){e.onDragOver(a)},this.dd_leave=function(a){e.onDragLeave(a)},this.dd_drop=function(a){e.onDragDrop(a)},document.addEventListener("dragenter",this.dd_enter),document.addEventListener("dragleave",this.dd_leave),document.addEventListener("drop",this.dd_drop)}},isDDInBounds:function(a){var b=$(window).width(),c=$(window).height();return a.clientX>=1&&a.clientX<=b-1&&a.clientY>=1&&a.clientY<=c-1},onDragOver:function(a){if(a&&a.dataTransfer&&a.dataTransfer.types)for(var b=a.dataTransfer.types,c=0;c<b.length;c++){if("text/html"==b[c]||"Text"==b[c])return;if("Files"==b[c])break}a.stopPropagation(),a.preventDefault(),0==this.dd.is(":visible")&&this.dd.show().find(".sf-upload-dd-zone-active").removeClass("sf-upload-dd-zone-active")},onDragEnd:function(a){a.stopPropagation(),a.preventDefault(),this.dd.hide()},onDragLeave:function(a){a.stopPropagation(),a.preventDefault(),0==this.isDDInBounds(a)&&this.dd.hide()},onDragDrop:function(a){a.stopPropagation(),a.preventDefault();var b=a.dataTransfer.files;if(this.dd.hide(),$(a.target).closest(".sf-upload-dd-zone-drop").length>0){var b=a.dataTransfer?a.dataTransfer.files:a.target.files;b&&"undefined"!=typeof b.length&&b.length>0&&(this.element.show(),this.addFiles(b),this.options.modal&&this.options.modal.sfDialog("open"))}},getUploadPath:function(a){return this.options.uploadPath},initUploader:function(a){this._log("initUploader: idx={0}".sfFormat(a));var b=this.options.uploaders,c=void 0;1==isNaN(a)&&(a=0);for(var d=a;d<b.length;d++){var e=b[d],f=e.isSupported(this,this.initUploader,d);if(f===!0){c||(c=e);break}if(f!==!1)return}1==$.isFunction(this.options.onGetUploader)&&(c=this.options.onGetUploader.call(this.element,c)),this.upload=new c(this),this.uploaderReady()},getFile:function(a){},addFiles:function(a){this._log("addFiles.files.length={0}".sfFormat(a.length));var b=[];this.options.condensed&&(this.condensedTotal=this.condensedTotalSize=this.condensedFinished=this.condensedFinishedSize=0);for(var c=0;c<a.length;c++){var d=a[c];if(this.tuploads>=this.options.maxItems||c>0&&0==this.options.multiFile){b.push(d);break}this.tuploads++,this.options.condensed&&(this.condensedTotal++,this.condensedTotalSize+=parseFloat(d.size)),this.addFile(d)||b.push(d)}this.tuploads>=this.options.maxItems&&this.btns.children(".sf-btn-file").hide(),this.onStart(b),this.uploadFiles()},addFile:function(a){var b=!0;return a.uploading=!1,a.finished=!1,a.error=!1,"undefined"!=typeof a.size&&this.options.maxFileSize>0&&a.size>this.options.maxFileSize&&(a.error=this.options.txt.maxSize,b=!1),this.files_ar.push(a),this.files[a.name]=a,this.options.condensed&&this.condensedEl?(a.li=this.condensedEl.removeClass("sf-upload-finished"),a.name_el=$(".sf-upload-name",this.condensedEl),a.size_el=$(".sf-upload-size",this.condensedEl),a.alert_el=$(".sf-upload-alert",this.condensedEl),a.bar_val_el=$(".sf-upload-value",this.condensedEl)):(a.retry_el=$('<a href="#" class="sf-upload-retry"/>').hide().text(this.options.txt.retry),a.name_el=$('<span class="sf-upload-name"/>').text(a.name),a.size_el=$('<span class="sf-upload-size"/>'),a.alert_el=$('<span class="sf-upload-alert"/>'),a.head_el=$('<div class="sf-upload-header"/>').append(a.retry_el).append(a.name_el).append(a.size_el).append(a.alert_el),a.bar_val_el=$('<span class="sf-upload-value"/>'),a.bar_el=$('<div class="sf-upload-bar"/>').append(a.bar_val_el),a.del_el=$('<a href="#" class="sf-icn sf-icn-rddelete"/>').append('<span class="sf-offscrn">x</span>').bind("click",{me:this,file:a},this.onCancel),(this.options.condensed||1==this.options.maxItems||0==this.options.multiFile)&&a.del_el.hide(),a.cont_el=$('<div class="sf-upload-content"/>').append(a.bar_el).append(a.del_el),this.options.condensed&&(a.head_el.addClass("sf-upload-condensed"),a.cont_el.addClass("sf-upload-condensed")),a.li=$("<li/>").append(a.head_el).append(a.cont_el),this.list.append(a.li),this.options.condensed&&(this.condensedEl=a.li)),this.updateStatus(a),b},delFile:function(a){delete this.files[a.name];for(var b=this.files_ar,c=0;c<b.length;c++){var d=b[c];if(d.name==a.name){this.cfile&&this.cfile.name==d.name&&delete this.cfile,b.splice(c,1),$("*",d.li).unbind(),d.li.remove(),this.updateStatus([]);break}}},tryAgain:function(a){},getFiles:function(a){"undefined"==typeof a&&(a={pending:!0,uploading:!0,finished:!0,errors:!0});for(var b=[],c=this.files_ar,d=0;d<c.length;d++){var e=c[d],f=e.error!==!1;(a.errors&&f||a.finished&&e.finished||a.uploading&&e.uploading&&!f&&!e.finished||a.pending&&!e.uploading&&!f&&!e.finished)&&b.push(e)}return b},showFile:function(a){var b=a.li.position().top,c=this.scroller.height(),d=a.li.outerHeight(!0),e=this.scroller.scrollTop(),f=e+c,g=b+d;if(e>b)this.scroller.scrollTop(b);else if(g>f){var h=g-c+10;this.scroller.scrollTop(h)}},sizeToString:function(a){var b=1024,c=b*b;return(a/(a>=c?c:b)).toFixed(1)+" "+(a>=c?"MB":"KB")},hideList:function(a){a="number"==typeof a?a:this.options.hideListOnFinishDelay;var b=this;setTimeout(function(){b.cancelAlert.hide(),b.scroller[a>0?"slideUp":"hide"](a>0?"slow":0,function(){b.options.modal&&b.options.modal.sfDialog("resize",{noanim:!1})})},a)},updateStatus:function(a){var a=this.files_ar;1==$.isArray(a)?fs=a:"object"==typeof a&&(fs=[a]);for(var b=0;b<fs.length;b++){var c=fs[b];if(this.cfile&&this.cfile.name==c.name?(c.error!==!1||1==c.finished)&&delete this.cfile:this.cfile||c.error!==!1||1==c.finished||(this.cfile=c,this.showFile(c)),this.options.condensed||c.size_el&&c.size_el.text(c.size?" ("+this.sizeToString(c.size)+")":""),c.error!==!1)c.logged||(c.logged=!0,this.options.condensed?(this.condensedFinished++,this.condensedTotalSize-=parseFloat(c.size)):(c.li.addClass("sf-upload-error"),c.bar_val_el.removeClass("sf-upload-unknown-value").css("width","0%")),c.alert_el.text(this.options.txt.error),this._log("sfUpload.Error["+c.name+"]: "+c.error));else if(1==c.finished)c.logged||(c.logged=!0,this.options.condensed?(this.condensedFinished++,this.condensedFinishedSize+=parseFloat(c.size)):(c.li.addClass("sf-upload-finished"),c.bar_val_el.removeClass("sf-upload-unknown-value").css("width","100%")),c.alert_el.text(this.options.txt.finished),this._log("sfUpload.Finished["+c.name+"]: Success"));else if(c.bar_val_el&&(!this.options.condensed||c==this.cfile))if(c.name_el.text(c.name),c.uploading||this.options.condensed?c.alert_el.text(this.options.txt.uploading):c.alert_el.text(this.options.txt.pending),this.options.condensed){var d=0,e=this.condensedTotal<=1?")":" of "+this.sizeToString(this.condensedTotalSize)+")";c.progress?(c.size&&(d=parseFloat(c.progress>c.size?c.size:c.progress)),c.size_el&&c.size_el.text(" ("+this.sizeToString(parseFloat(this.condensedFinishedSize+d))+e)):c.size_el&&c.size_el.text(" ("+this.sizeToString(this.condensedFinishedSize)+e),c.bar_val_el.removeClass("sf-upload-unknown-value").css("width",Math.round(100*parseFloat((this.condensedFinished+(d?parseFloat(d/c.size):0))/this.condensedTotal))+"%")}else c.size&&c.progress?(c.progress>c.size&&(c.progress=c.size),c.bar_val_el.removeClass("sf-upload-unknown-value").css("width",parseInt(c.progress/c.size*100)+"%")):(c.uploading?c.bar_val_el.addClass("sf-upload-unknown-value").css("width","100%"):c.bar_val_el.removeClass("sf-upload-unknown-value").css("width","0%"),0==c.finished&&1==c.uploading&&c.alert_el.text(this.options.txt.uploading))}if(0==this.files_ar.length)this.tuploads>=this.options.maxItems?this.status.html(this.options.txt.introMaxItems):1==this.upload.isDDSupported()&&1==this.options.ddEnabled?this.status.html(this.options.txt.introWithDrop):this.status.html(this.options.txt.intro),this.hideList(0),this.closeModal=!1;else{this.scroller.show();var f=this.getFiles({pending:!0,uploading:!0}).length,g=this.getFiles({finished:!0}),h=this.getFiles({errors:!0});if(f>0)this.status.html(this.options.txt.statusUploading.sfFormat(f));else{if(this.options.condensed&&(this.condensedEl.addClass("sf-upload-finished"),$(".sf-upload-value",this.condensedEl).css("width","100%"),$(".sf-upload-size, .sf-upload-name",this.condensedEl).text("")),this.status.html(this.options.txt.statusFinished.sfFormat(g.length,h.length)+"&nbsp;"),h.length>0&&this.options.showErrorHelper){for(var i="",b=0;b<h.length;b++){var c=h[b];i+="<strong>{0}</strong>: {1}<br/>".sfFormat(c.name,c.error)}var j=$("<span/>").appendTo(this.status);require("starfield/sf.tipper",function(){j.sfTipper({content:i,width:350})})}this.cancelAlert.hide(),this.closeModal=!1}}this.options.modal&&this.options.modal.sfDialog("resize")},uploadFiles:function(){this.upload.uploadFiles(),this.updateStatus()},uploadComplete:function(){this.updateStatus()},onStart:function(a){var b=this.options.onStart;if($.isFunction(b)){var c=this.getFiles({pending:!0,uploading:!0});b(c,a||[])}},onFinish:function(){var a=this.options.onFinish;this.options.hideListOnFinish===!0&&this.hideList(),$.isFunction(a)&&a()},onUpload:function(a,b){var c=this.options.onUpload,d=this.options.uploadPath;if(1==$.isFunction(c)){var e=this,f=c.call(this.element,a,d,function(c){b.call(e.upload,a,"string"==typeof c?c:d)});if(f===!1||"string"!=typeof f)return;d=f}b.call(this.upload,a,d)},onSuccess:function(a,b){var c=this.options.onSuccess;if(1==$.isFunction(c)){var d=this.getFiles({pending:!0,uploading:!0});c(a,d,b)}},onProgress:function(a){var b=this.options.onProgress;$.isFunction(b)&&b(a)},onError:function(a){var b=this.options.onError;if($.isFunction(b)){var c=this.getFiles({pending:!0,uploading:!0});b(a,c)}},cancel:function(a,b){a||(a=this.files_ar);var c,d=a.slice(0),e=!1;for(c=0;c<d.length;c++){var f=d[c];if(0==f.finished&&f.error===!1){e=!0;break}}if(1==e&&b!==!0)return this.cancelFiles=a,this.cancelAlert.show(),this.options.modal&&this.options.modal.sfDialog("resize"),!1;var g=this.closeModal;for(c=0;c<d.length;c++){var f=d[c];0==f.finished&&f.error===!1&&this.upload.cancel(f),this.delFile(f)}return this.options.modal&&1==g&&0==this.files_ar.length&&(this.closeModal=!1,this.modalClosing=!0,this.options.modal.sfDialog("close")),this.options.condensed&&(this.condensedEl=!1),!0},onCancel:function(a){return a.data.me.cancel([a.data.file])},destroy:function(a){this.cancel(!1,!0),this.upload&&(this.upload.destroy(),delete this.upload),this.dd&&($("*",this.dd).unbind(),this.dd.remove(),delete this.dd,document.removeEventListener("dragenter",this.dd_enter),document.removeEventListener("dragleave",this.dd_leave),document.removeEventListener("drop",this.dd_drop)),$("*",this.status).unbind(),$("*",this.scroller).unbind(),$("*",this.btns).unbind(),this.status.remove(),this.scroller.remove(),this.btns.remove(),this._execSuper("destroy",a)}},upiframe=sfUploadIFrame;upiframe.name="iframe",upiframe.isSupported=function(){return!0};var upiframep=upiframe.prototype;upiframep.isDDSupported=function(){return!1},upiframep.create=function(){var a={id:parseInt(1e4*Math.random()),uploading:!1,files:[]},b="file"+a.id;a.file_btn=$('<input type="file" size="0" />').attr("name",b).attr("id",b).attr("title",this.mod.options.txt.select).attr("accept",this.mod.options.accept).bind("change",{me:this,upload:a},this.onAddFiles),1==this.mod.options.multiFile&&a.file_btn.attr("multiple","multiple"),a.select_btn=$('<label class="sf-btn-minor sf-btn-file"/>').append(this.mod.options.txt.select).append(a.file_btn);var c="hifrm"+a.id,d="form"+a.id;a.form=$('<form method="post" enctype="multipart/form-data" />').attr("name",d).attr("id",d).attr("target",c).append(a.select_btn),a.iframe=$('<iframe name="{0}" width="0" height="0" border="0" style="width:0;height:0;border:none"/>'.sfFormat(c)).attr("id",c).bind("load",{me:this,upload:a},this.onLoad),this.mod.btns.append(a.iframe).append(a.form),this.uploads.push(a)},upiframep.onAddFiles=function(a){var b=a.data.me,c=a.data.upload,d=a.dataTransfer?a.dataTransfer.files:a.target.files;d&&"undefined"!=typeof d.length||(d=[{name:c.file_btn[0].value}]);for(var e=0;e<d.length;e++){var f=d[e];f.upload=c,c.files.push(f)}return b.mod.addFiles(d),!0},upiframep.onLoad=function(a){var b=a.data.me,c=a.data.upload;if(0!=c.uploading&&c.iframe&&c.iframe[0].parentNode){b.uploading=!1;for(var d=c.files,e=0;e<d.length;e++){var f=d[e];0==f.finished&&f.error===!1&&(f.finished=!0)}c.uploading=!1,c.form.remove();var g;if(b.mod.options.expectData){var h=c.iframe[0];try{h.contentDocument?g=h.contentDocument.body.innerHTML:h.contentWindow?g=h.contentWindow.document.body.innerHTML:h.document&&(g=h.document.body.innerHTML)}catch(i){g=void 0}}c.iframe.remove(),b.mod.onSuccess(d,g),b.mod.uploadComplete(),b.uploadFiles()}},upiframep.uploadFiles=function(){if(1!=this.uploading){if(0==this.uploads.length)return void this.mod.onFinish();var a=this.uploads.shift();this.uploading=!0,a.uploading=!0,a.form.hide(),this.mod.onUpload(a.files,function(b,c){if(0!=a.uploading){for(var d=a.files,e=0;e<d.length;e++){var f=d[e];f.uploading=!0,this.mod.updateStatus(f)}a.form.attr("action",c).submit()}}),this.create()}},upiframep.cancel=function(a){var b=a.upload;if(b&&b.uploading){b.uploading=!1,0==this.uploads.length&&(this.uploading=!1);for(var c=0;c<b.files.length;c++){var d=b.files[c];d.error="Cancelled",this.mod.delFile(d)}if(b.iframe&&b.iframe[0].parentNode){try{b.iframe.attr("src","javascript:false;"),b.iframe.remove()}catch(e){}try{b.form.remove()}catch(e){}}this.mod.onError(b.files)}},upiframep.destroy=function(){};var upxhr=sfUploadXhr;upxhr.name="xhr",upxhr.isSupported=function(){if("undefined"==typeof XMLHttpRequest)return!1;var a=new XMLHttpRequest;return"undefined"!=typeof a.upload&&"undefined"!=typeof File&&"undefined"!=typeof FormData};var upxhrp=upxhr.prototype;upxhrp.isDDSupported=function(){return!0},upxhrp.create=function(){var a="file"+parseInt(1e4*Math.random());this.file_btn=$('<input type="file" size="0" />').attr("name",a).attr("id",a).attr("title",this.mod.options.txt.select).attr("accept",this.mod.options.accept).bind("change",{me:this},this.onAddFiles),1==this.mod.options.multiFile&&this.file_btn.attr("multiple","multiple"),this.select_btn=$('<label class="sf-btn-minor sf-btn-file"/>').append(this.mod.options.txt.select).append(this.file_btn),this.mod.btns.append(this.select_btn)},upxhrp.onAddFiles=function(a){var b=a.data.me,c=a.data.upload,d=a.dataTransfer?a.dataTransfer.files:a.target.files;d&&"undefined"!=typeof d.length||(d=[{name:c.file_btn[0].value}]);for(var e=0;e<d.length;e++){var f=d[e];f.fileSize&&(f.size=f.fileSize),f.fileName&&(f.name=f.fileName)}return b.mod.addFiles(d),$(this).closest("label").remove(),b.create(),!0},upxhrp.onProgress=function(a){var b=this.file;b.progress=a.loaded,this.mod.updateStatus(b),this.mod.onProgress([b])},upxhrp.onComplete=function(){var a=this.file;if(a.uploading=!1,200==a.xhr.status){a.finished=!0;var b;if(this.mod.options.expectData)try{b=a.xhr.responseText}catch(c){b=void 0}this.mod.onSuccess([a],b)}else a.error=a.xhr.responseText,("string"!=typeof a.error||0==a.error.length)&&(a.error="Unknown"),this.mod.onError([a]);delete this.file,delete a.xhr,this.mod.updateStatus(a),this.uploading=!1,this.uploadFiles()},upxhrp.uploadFiles=function(){if(1!=this.uploading){delete this.file;var a=this.mod.getFiles({pending:!0});return a.length>0&&(this.file=a[0]),"undefined"==typeof this.file?(this.mod.updateStatus(),void this.mod.onFinish()):void this.uploadFile()}},upxhrp.uploadFile=function(){var a=this.file;"undefined"!=typeof a&&(this.uploading=!0,this.mod.onUpload([this.file],function(b,c){if(0!=this.uploading){var d=a.xhr=new XMLHttpRequest;a.uploading=!0,this.mod.updateStatus(a);var e=this;d.upload.onprogress=function(a){a.lengthComputable&&e.onProgress(a)},d.onreadystatechange=function(){4==d.readyState&&e.onComplete()},d.open("POST",c,!0);var f=new FormData;f.append(a.name,a),d.send(f)}}))},upxhrp._cancel=function(a){if("undefined"!=typeof a&&"undefined"!=typeof a.xhr){try{a.xhr.abort()}catch(b){}delete a.xhr}a.uploading=!1,a.error="Cancelled",this.mod.onError([a])},upxhrp.cancel=function(a){a?(this._cancel(a),this.uploading=!1,this.mod.delFile(a)):this.uploading=!1},upxhrp.destroy=function(){this.cancel()};var upflash=sfUploadFlash;upflash.name="flash",upflash.isSupported=function(a,b,c){return $sf.swfobject?$sf.swfobject.hasFlashPlayerVersion("9.0"):void require("starfield/sf.flash",function(){b.call(a,c)})};var upflashp=upflash.prototype;return upflashp.isDDSupported=function(){return!1},upflashp.create=function(){watchTitle.init(),this.flashid="sfUploadSwf"+parseInt(1e4*Math.random()),window[this.flashid+"self"]=this;var a=$("<div/>").attr("id",this.flashid);this.flash_wrapper=$("<div/>").css({position:"absolute",top:"0",left:"0"}).append(a),this.select_btn=$('<label class="sf-btn-minor sf-btn-file"/>').append(this.mod.options.txt.select).hide(),this.mod.btns.append(this.select_btn).append(this.flash_wrapper);var b={expectData:this.mod.options.expectData,fileUploadUrl:this.mod.getUploadPath(),filterName:"All Files (*.*)",filterFileList:"*",beforeSend:this.flashid+"self.onBeforeSend",fileProgress:this.flashid+"self.onFileProgress",fileUploaded:this.flashid+"self.onFileUploaded",filesSelected:this.flashid+"self.onFilesSelected",uploadError:this.flashid+"self.onUploadError",browseButton:"0,0,200,40,0",uploadButton:"999,0,0,0,0",hoverCursor:"arrow",mouseOverBrowse:this.flashid+"self.onSelectOver",mouseOutBrowse:this.flashid+"self.onSelectOut"},c={quality:"high",allowfullscreen:"true",allowscriptaccess:"always",salign:"tl",bgcolor:"#FFFFFF",wmode:"transparent",allowNetworking:"all"},d={id:this.flashid,name:this.flashid},e=$sf.require.img5_root+"/sf.upload/flash/SimpleUploader.swf",f=this;$sf.swfobject.embedSWF(e,this.flashid,"250","40","9.0.0","expressInstall.swf",b,c,d,function(a){f.flash_obj=a.ref,$(f.flash_obj).css({"vertical-align":"top"}),f.select_btn.css({display:""}),setTimeout(function(){f.onSelectOver()},0)})},upflashp.onSelectOver=function(){var a=this.select_btn;if(a.addClass("hover"),this.flash_obj){var b=a.position(),c=a.outerWidth(),d=a.outerHeight(),e="0,0,{0},{1},0".sfFormat(c,d);this.flash_wrapper.css(b);try{this.flash_obj.setButtonBrowseBtn(e)}catch(f){var g=this;setTimeout(function(){g.onSelectOver()},250)}}},upflashp.onSelectOut=function(){this.select_btn.removeClass("hover")},upflashp.onFilesSelected=function(a){return a=$.parseJSON(a).selectedFiles,this.mod._log("{0}.onFilesSelected.files.length={1}".sfFormat(this.flashid,a.length)),this.mod.addFiles(a),!0},upflashp.onFileProgress=function(a){a=$.parseJSON(a),this.mod._log("{0}.onFileProgress.file.progress={1}".sfFormat(this.flashid,a.progress));var b=this.file;b.progress=a.progress,this.mod.updateStatus(b),this.mod.onProgress([b])},upflashp.onFileUploaded=function(fileResponse){this.mod._log("{0}.onFileUploaded.file.fileGuid={1}".sfFormat(this.flashid,this.file.fileGuid));var f=this.file;f.uploading=!1,f.finished=!0;var response;if(this.mod.options.expectData&&fileResponse)try{response=eval("("+fileResponse+");"),response=response&&response.returnData?response.returnData:void 0}catch(e){response=void 0}this.mod.onSuccess([f],response),this.mod.updateStatus(f),this.uploading=!1,delete this.file,this.uploadFiles()},upflashp.onUploadError=function(a){this.mod._log("{0}.onUploadError.file.fileGuid={1}".sfFormat(this.flashid,this.file.fileGuid));var b=this.file;b.uploading=!1,b.error="Unknown Error: {0}".sfFormat(a.error),this.mod.onError([b]),this.mod.updateStatus(b),this.uploading=!1,delete this.file,this.uploadFiles()},upflashp.uploadFiles=function(){if(1!=this.uploading){delete this.file;var a=this.mod.getFiles({pending:!0});return a.length>0&&(this.file=a[0]),"undefined"==typeof this.file?(this.mod.updateStatus(),void this.mod.onFinish()):void this.uploadFile()}},upflashp.uploadFile=function(){var a=this.file;if("undefined"!=typeof a){this.uploading=!0;var b=this;this.mod.onUpload([this.file],function(c,d){if(0!=b.uploading){a.uploading=!0,b.mod.updateStatus(a),b.mod._log("{0}.uploadFile: id={1}, url={2}".sfFormat(b.flashid,a.fileGuid,d));try{b.flash_obj.SetConfig("fileUploadUrl",d),b.flash_obj.ContinueUpload(a.fileGuid)}catch(e){a.uploading=!1,a.error="ContinueUpload errored: "+e,this.mod._log("{0}.onError.file.fileGuid={1}, url={2}: {3}".sfFormat(b.flashid,a.fileGuid,d,a.error)),b.uploading=!1,delete b.file,b.mod.onError([a]),b.mod.updateStatus(),b.uploadFiles()}}})}},upflashp._cancel=function(a){if("undefined"!=typeof a)try{this.flash_obj.CancelFileUpload(a.fileGuid)}catch(b){}a.uploading=!1,a.error="Cancelled",this.mod.onError([a])},upflashp.cancel=function(a){a?(this._cancel(a),this.uploading=!1,this.mod.delFile(a)):this.uploading=!1,this.mod._siblings().length||watchTitle.destroy()},upflashp.destroy=function(){this.cancel()},$sf.util.module("Upload",module)}($sf.getjQuery())});